(function(){const tt=document.createElement("link").relList;if(tt&&tt.supports&&tt.supports("modulepreload"))return;for(const yt of document.querySelectorAll('link[rel="modulepreload"]'))b(yt);new MutationObserver(yt=>{for(const Et of yt)if(Et.type==="childList")for(const kt of Et.addedNodes)kt.tagName==="LINK"&&kt.rel==="modulepreload"&&b(kt)}).observe(document,{childList:!0,subtree:!0});function st(yt){const Et={};return yt.integrity&&(Et.integrity=yt.integrity),yt.referrerPolicy&&(Et.referrerPolicy=yt.referrerPolicy),yt.crossOrigin==="use-credentials"?Et.credentials="include":yt.crossOrigin==="anonymous"?Et.credentials="omit":Et.credentials="same-origin",Et}function b(yt){if(yt.ep)return;yt.ep=!0;const Et=st(yt);fetch(yt.href,Et)}})();var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(j){jsxRuntimeExports=j}},reactJsxRuntime_production_min={},reactExports={},react={get exports(){return reactExports},set exports(j){reactExports=j}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(j){return j===null||typeof j!="object"?null:(j=z$1&&j[z$1]||j["@@iterator"],typeof j=="function"?j:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(j,tt,st){this.props=j,this.context=tt,this.refs=D$1,this.updater=st||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(j,tt){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,tt,"setState")};E$1.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(j,tt,st){this.props=j,this.context=tt,this.refs=D$1,this.updater=st||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(j,tt,st){var b,yt={},Et=null,kt=null;if(tt!=null)for(b in tt.ref!==void 0&&(kt=tt.ref),tt.key!==void 0&&(Et=""+tt.key),tt)J.call(tt,b)&&!L$1.hasOwnProperty(b)&&(yt[b]=tt[b]);var Gt=arguments.length-2;if(Gt===1)yt.children=st;else if(1<Gt){for(var Vt=Array(Gt),an=0;an<Gt;an++)Vt[an]=arguments[an+2];yt.children=Vt}if(j&&j.defaultProps)for(b in Gt=j.defaultProps,Gt)yt[b]===void 0&&(yt[b]=Gt[b]);return{$$typeof:l$1,type:j,key:Et,ref:kt,props:yt,_owner:K$1.current}}function N$1(j,tt){return{$$typeof:l$1,type:j.type,key:tt,ref:j.ref,props:j.props,_owner:j._owner}}function O$1(j){return typeof j=="object"&&j!==null&&j.$$typeof===l$1}function escape$1(j){var tt={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(st){return tt[st]})}var P$1=/\/+/g;function Q$1(j,tt){return typeof j=="object"&&j!==null&&j.key!=null?escape$1(""+j.key):tt.toString(36)}function R$1(j,tt,st,b,yt){var Et=typeof j;(Et==="undefined"||Et==="boolean")&&(j=null);var kt=!1;if(j===null)kt=!0;else switch(Et){case"string":case"number":kt=!0;break;case"object":switch(j.$$typeof){case l$1:case n$1:kt=!0}}if(kt)return kt=j,yt=yt(kt),j=b===""?"."+Q$1(kt,0):b,I$1(yt)?(st="",j!=null&&(st=j.replace(P$1,"$&/")+"/"),R$1(yt,tt,st,"",function(an){return an})):yt!=null&&(O$1(yt)&&(yt=N$1(yt,st+(!yt.key||kt&&kt.key===yt.key?"":(""+yt.key).replace(P$1,"$&/")+"/")+j)),tt.push(yt)),1;if(kt=0,b=b===""?".":b+":",I$1(j))for(var Gt=0;Gt<j.length;Gt++){Et=j[Gt];var Vt=b+Q$1(Et,Gt);kt+=R$1(Et,tt,st,Vt,yt)}else if(Vt=A$1(j),typeof Vt=="function")for(j=Vt.call(j),Gt=0;!(Et=j.next()).done;)Et=Et.value,Vt=b+Q$1(Et,Gt++),kt+=R$1(Et,tt,st,Vt,yt);else if(Et==="object")throw tt=String(j),Error("Objects are not valid as a React child (found: "+(tt==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":tt)+"). If you meant to render a collection of children, use an array instead.");return kt}function S$1(j,tt,st){if(j==null)return j;var b=[],yt=0;return R$1(j,b,"","",function(Et){return tt.call(st,Et,yt++)}),b}function T$1(j){if(j._status===-1){var tt=j._result;tt=tt(),tt.then(function(st){(j._status===0||j._status===-1)&&(j._status=1,j._result=st)},function(st){(j._status===0||j._status===-1)&&(j._status=2,j._result=st)}),j._status===-1&&(j._status=0,j._result=tt)}if(j._status===1)return j._result.default;throw j._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(j,tt,st){S$1(j,function(){tt.apply(this,arguments)},st)},count:function(j){var tt=0;return S$1(j,function(){tt++}),tt},toArray:function(j){return S$1(j,function(tt){return tt})||[]},only:function(j){if(!O$1(j))throw Error("React.Children.only expected to receive a single React element child.");return j}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(j,tt,st){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var b=C$1({},j.props),yt=j.key,Et=j.ref,kt=j._owner;if(tt!=null){if(tt.ref!==void 0&&(Et=tt.ref,kt=K$1.current),tt.key!==void 0&&(yt=""+tt.key),j.type&&j.type.defaultProps)var Gt=j.type.defaultProps;for(Vt in tt)J.call(tt,Vt)&&!L$1.hasOwnProperty(Vt)&&(b[Vt]=tt[Vt]===void 0&&Gt!==void 0?Gt[Vt]:tt[Vt])}var Vt=arguments.length-2;if(Vt===1)b.children=st;else if(1<Vt){Gt=Array(Vt);for(var an=0;an<Vt;an++)Gt[an]=arguments[an+2];b.children=Gt}return{$$typeof:l$1,type:j.type,key:yt,ref:Et,props:b,_owner:kt}};react_production_min.createContext=function(j){return j={$$typeof:u,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:t,_context:j},j.Consumer=j};react_production_min.createElement=M$1;react_production_min.createFactory=function(j){var tt=M$1.bind(null,j);return tt.type=j,tt};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(j){return{$$typeof:v$1,render:j}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(j){return{$$typeof:y,_payload:{_status:-1,_result:j},_init:T$1}};react_production_min.memo=function(j,tt){return{$$typeof:x,type:j,compare:tt===void 0?null:tt}};react_production_min.startTransition=function(j){var tt=V$1.transition;V$1.transition={};try{j()}finally{V$1.transition=tt}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(j,tt){return U$1.current.useCallback(j,tt)};react_production_min.useContext=function(j){return U$1.current.useContext(j)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(j){return U$1.current.useDeferredValue(j)};react_production_min.useEffect=function(j,tt){return U$1.current.useEffect(j,tt)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(j,tt,st){return U$1.current.useImperativeHandle(j,tt,st)};react_production_min.useInsertionEffect=function(j,tt){return U$1.current.useInsertionEffect(j,tt)};react_production_min.useLayoutEffect=function(j,tt){return U$1.current.useLayoutEffect(j,tt)};react_production_min.useMemo=function(j,tt){return U$1.current.useMemo(j,tt)};react_production_min.useReducer=function(j,tt,st){return U$1.current.useReducer(j,tt,st)};react_production_min.useRef=function(j){return U$1.current.useRef(j)};react_production_min.useState=function(j){return U$1.current.useState(j)};react_production_min.useSyncExternalStore=function(j,tt,st){return U$1.current.useSyncExternalStore(j,tt,st)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";(function(j){j.exports=react_production_min})(react);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(j,tt,st){var b,yt={},Et=null,kt=null;st!==void 0&&(Et=""+st),tt.key!==void 0&&(Et=""+tt.key),tt.ref!==void 0&&(kt=tt.ref);for(b in tt)m$1.call(tt,b)&&!p$1.hasOwnProperty(b)&&(yt[b]=tt[b]);if(j&&j.defaultProps)for(b in tt=j.defaultProps,tt)yt[b]===void 0&&(yt[b]=tt[b]);return{$$typeof:k,type:j,key:Et,ref:kt,props:yt,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(j){j.exports=reactJsxRuntime_production_min})(jsxRuntime);const jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var client={},reactDomExports={},reactDom={get exports(){return reactDomExports},set exports(j){reactDomExports=j}},reactDom_production_min={},schedulerExports={},scheduler={get exports(){return schedulerExports},set exports(j){schedulerExports=j}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(j){function tt(Xn,ir){var zn=Xn.length;Xn.push(ir);e:for(;0<zn;){var nr=zn-1>>>1,$n=Xn[nr];if(0<yt($n,ir))Xn[nr]=ir,Xn[zn]=$n,zn=nr;else break e}}function st(Xn){return Xn.length===0?null:Xn[0]}function b(Xn){if(Xn.length===0)return null;var ir=Xn[0],zn=Xn.pop();if(zn!==ir){Xn[0]=zn;e:for(var nr=0,$n=Xn.length,Sr=$n>>>1;nr<Sr;){var Yn=2*(nr+1)-1,Xt=Xn[Yn],rn=Yn+1,Fn=Xn[rn];if(0>yt(Xt,zn))rn<$n&&0>yt(Fn,Xt)?(Xn[nr]=Fn,Xn[rn]=zn,nr=rn):(Xn[nr]=Xt,Xn[Yn]=zn,nr=Yn);else if(rn<$n&&0>yt(Fn,zn))Xn[nr]=Fn,Xn[rn]=zn,nr=rn;else break e}}return ir}function yt(Xn,ir){var zn=Xn.sortIndex-ir.sortIndex;return zn!==0?zn:Xn.id-ir.id}if(typeof performance=="object"&&typeof performance.now=="function"){var Et=performance;j.unstable_now=function(){return Et.now()}}else{var kt=Date,Gt=kt.now();j.unstable_now=function(){return kt.now()-Gt}}var Vt=[],an=[],Pn=1,mn=null,hn=3,wn=!1,_n=!1,$t=!1,bn=typeof setTimeout=="function"?setTimeout:null,Nt=typeof clearTimeout=="function"?clearTimeout:null,jt=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Yt(Xn){for(var ir=st(an);ir!==null;){if(ir.callback===null)b(an);else if(ir.startTime<=Xn)b(an),ir.sortIndex=ir.expirationTime,tt(Vt,ir);else break;ir=st(an)}}function Bn(Xn){if($t=!1,Yt(Xn),!_n)if(st(Vt)!==null)_n=!0,Ar(un);else{var ir=st(an);ir!==null&&Hr(Bn,ir.startTime-Xn)}}function un(Xn,ir){_n=!1,$t&&($t=!1,Nt(Wt),Wt=-1),wn=!0;var zn=hn;try{for(Yt(ir),mn=st(Vt);mn!==null&&(!(mn.expirationTime>ir)||Xn&&!pn());){var nr=mn.callback;if(typeof nr=="function"){mn.callback=null,hn=mn.priorityLevel;var $n=nr(mn.expirationTime<=ir);ir=j.unstable_now(),typeof $n=="function"?mn.callback=$n:mn===st(Vt)&&b(Vt),Yt(ir)}else b(Vt);mn=st(Vt)}if(mn!==null)var Sr=!0;else{var Yn=st(an);Yn!==null&&Hr(Bn,Yn.startTime-ir),Sr=!1}return Sr}finally{mn=null,hn=zn,wn=!1}}var Cn=!1,Qt=null,Wt=-1,Zt=5,En=-1;function pn(){return!(j.unstable_now()-En<Zt)}function er(){if(Qt!==null){var Xn=j.unstable_now();En=Xn;var ir=!0;try{ir=Qt(!0,Xn)}finally{ir?Ir():(Cn=!1,Qt=null)}}else Cn=!1}var Ir;if(typeof jt=="function")Ir=function(){jt(er)};else if(typeof MessageChannel<"u"){var Dr=new MessageChannel,zr=Dr.port2;Dr.port1.onmessage=er,Ir=function(){zr.postMessage(null)}}else Ir=function(){bn(er,0)};function Ar(Xn){Qt=Xn,Cn||(Cn=!0,Ir())}function Hr(Xn,ir){Wt=bn(function(){Xn(j.unstable_now())},ir)}j.unstable_IdlePriority=5,j.unstable_ImmediatePriority=1,j.unstable_LowPriority=4,j.unstable_NormalPriority=3,j.unstable_Profiling=null,j.unstable_UserBlockingPriority=2,j.unstable_cancelCallback=function(Xn){Xn.callback=null},j.unstable_continueExecution=function(){_n||wn||(_n=!0,Ar(un))},j.unstable_forceFrameRate=function(Xn){0>Xn||125<Xn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Zt=0<Xn?Math.floor(1e3/Xn):5},j.unstable_getCurrentPriorityLevel=function(){return hn},j.unstable_getFirstCallbackNode=function(){return st(Vt)},j.unstable_next=function(Xn){switch(hn){case 1:case 2:case 3:var ir=3;break;default:ir=hn}var zn=hn;hn=ir;try{return Xn()}finally{hn=zn}},j.unstable_pauseExecution=function(){},j.unstable_requestPaint=function(){},j.unstable_runWithPriority=function(Xn,ir){switch(Xn){case 1:case 2:case 3:case 4:case 5:break;default:Xn=3}var zn=hn;hn=Xn;try{return ir()}finally{hn=zn}},j.unstable_scheduleCallback=function(Xn,ir,zn){var nr=j.unstable_now();switch(typeof zn=="object"&&zn!==null?(zn=zn.delay,zn=typeof zn=="number"&&0<zn?nr+zn:nr):zn=nr,Xn){case 1:var $n=-1;break;case 2:$n=250;break;case 5:$n=1073741823;break;case 4:$n=1e4;break;default:$n=5e3}return $n=zn+$n,Xn={id:Pn++,callback:ir,priorityLevel:Xn,startTime:zn,expirationTime:$n,sortIndex:-1},zn>nr?(Xn.sortIndex=zn,tt(an,Xn),st(Vt)===null&&Xn===st(an)&&($t?(Nt(Wt),Wt=-1):$t=!0,Hr(Bn,zn-nr))):(Xn.sortIndex=$n,tt(Vt,Xn),_n||wn||(_n=!0,Ar(un))),Xn},j.unstable_shouldYield=pn,j.unstable_wrapCallback=function(Xn){var ir=hn;return function(){var zn=hn;hn=ir;try{return Xn.apply(this,arguments)}finally{hn=zn}}}})(scheduler_production_min);(function(j){j.exports=scheduler_production_min})(scheduler);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(j){for(var tt="https://reactjs.org/docs/error-decoder.html?invariant="+j,st=1;st<arguments.length;st++)tt+="&args[]="+encodeURIComponent(arguments[st]);return"Minified React error #"+j+"; visit "+tt+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(j,tt){ha(j,tt),ha(j+"Capture",tt)}function ha(j,tt){for(ea[j]=tt,j=0;j<tt.length;j++)da.add(tt[j])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(j){return ja.call(ma,j)?!0:ja.call(la,j)?!1:ka.test(j)?ma[j]=!0:(la[j]=!0,!1)}function pa(j,tt,st,b){if(st!==null&&st.type===0)return!1;switch(typeof tt){case"function":case"symbol":return!0;case"boolean":return b?!1:st!==null?!st.acceptsBooleans:(j=j.toLowerCase().slice(0,5),j!=="data-"&&j!=="aria-");default:return!1}}function qa(j,tt,st,b){if(tt===null||typeof tt>"u"||pa(j,tt,st,b))return!0;if(b)return!1;if(st!==null)switch(st.type){case 3:return!tt;case 4:return tt===!1;case 5:return isNaN(tt);case 6:return isNaN(tt)||1>tt}return!1}function v(j,tt,st,b,yt,Et,kt){this.acceptsBooleans=tt===2||tt===3||tt===4,this.attributeName=b,this.attributeNamespace=yt,this.mustUseProperty=st,this.propertyName=j,this.type=tt,this.sanitizeURL=Et,this.removeEmptyString=kt}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(j){z[j]=new v(j,0,!1,j,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(j){var tt=j[0];z[tt]=new v(tt,1,!1,j[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(j){z[j]=new v(j,2,!1,j.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(j){z[j]=new v(j,2,!1,j,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(j){z[j]=new v(j,3,!1,j.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(j){z[j]=new v(j,3,!0,j,null,!1,!1)});["capture","download"].forEach(function(j){z[j]=new v(j,4,!1,j,null,!1,!1)});["cols","rows","size","span"].forEach(function(j){z[j]=new v(j,6,!1,j,null,!1,!1)});["rowSpan","start"].forEach(function(j){z[j]=new v(j,5,!1,j.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(j){return j[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(j){var tt=j.replace(ra,sa);z[tt]=new v(tt,1,!1,j,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(j){z[j]=new v(j,1,!1,j.toLowerCase(),null,!0,!0)});function ta(j,tt,st,b){var yt=z.hasOwnProperty(tt)?z[tt]:null;(yt!==null?yt.type!==0:b||!(2<tt.length)||tt[0]!=="o"&&tt[0]!=="O"||tt[1]!=="n"&&tt[1]!=="N")&&(qa(tt,st,yt,b)&&(st=null),b||yt===null?oa(tt)&&(st===null?j.removeAttribute(tt):j.setAttribute(tt,""+st)):yt.mustUseProperty?j[yt.propertyName]=st===null?yt.type===3?!1:"":st:(tt=yt.attributeName,b=yt.attributeNamespace,st===null?j.removeAttribute(tt):(yt=yt.type,st=yt===3||yt===4&&st===!0?"":""+st,b?j.setAttributeNS(b,tt,st):j.setAttribute(tt,st))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(j){return j===null||typeof j!="object"?null:(j=Ja&&j[Ja]||j["@@iterator"],typeof j=="function"?j:null)}var A=Object.assign,La;function Ma(j){if(La===void 0)try{throw Error()}catch(st){var tt=st.stack.trim().match(/\n( *(at )?)/);La=tt&&tt[1]||""}return`
`+La+j}var Na=!1;function Oa(j,tt){if(!j||Na)return"";Na=!0;var st=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(tt)if(tt=function(){throw Error()},Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(an){var b=an}Reflect.construct(j,[],tt)}else{try{tt.call()}catch(an){b=an}j.call(tt.prototype)}else{try{throw Error()}catch(an){b=an}j()}}catch(an){if(an&&b&&typeof an.stack=="string"){for(var yt=an.stack.split(`
`),Et=b.stack.split(`
`),kt=yt.length-1,Gt=Et.length-1;1<=kt&&0<=Gt&&yt[kt]!==Et[Gt];)Gt--;for(;1<=kt&&0<=Gt;kt--,Gt--)if(yt[kt]!==Et[Gt]){if(kt!==1||Gt!==1)do if(kt--,Gt--,0>Gt||yt[kt]!==Et[Gt]){var Vt=`
`+yt[kt].replace(" at new "," at ");return j.displayName&&Vt.includes("<anonymous>")&&(Vt=Vt.replace("<anonymous>",j.displayName)),Vt}while(1<=kt&&0<=Gt);break}}}finally{Na=!1,Error.prepareStackTrace=st}return(j=j?j.displayName||j.name:"")?Ma(j):""}function Pa(j){switch(j.tag){case 5:return Ma(j.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return j=Oa(j.type,!1),j;case 11:return j=Oa(j.type.render,!1),j;case 1:return j=Oa(j.type,!0),j;default:return""}}function Qa(j){if(j==null)return null;if(typeof j=="function")return j.displayName||j.name||null;if(typeof j=="string")return j;switch(j){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof j=="object")switch(j.$$typeof){case Ca:return(j.displayName||"Context")+".Consumer";case Ba:return(j._context.displayName||"Context")+".Provider";case Da:var tt=j.render;return j=j.displayName,j||(j=tt.displayName||tt.name||"",j=j!==""?"ForwardRef("+j+")":"ForwardRef"),j;case Ga:return tt=j.displayName||null,tt!==null?tt:Qa(j.type)||"Memo";case Ha:tt=j._payload,j=j._init;try{return Qa(j(tt))}catch{}}return null}function Ra(j){var tt=j.type;switch(j.tag){case 24:return"Cache";case 9:return(tt.displayName||"Context")+".Consumer";case 10:return(tt._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return j=tt.render,j=j.displayName||j.name||"",tt.displayName||(j!==""?"ForwardRef("+j+")":"ForwardRef");case 7:return"Fragment";case 5:return tt;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(tt);case 8:return tt===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof tt=="function")return tt.displayName||tt.name||null;if(typeof tt=="string")return tt}return null}function Sa(j){switch(typeof j){case"boolean":case"number":case"string":case"undefined":return j;case"object":return j;default:return""}}function Ta(j){var tt=j.type;return(j=j.nodeName)&&j.toLowerCase()==="input"&&(tt==="checkbox"||tt==="radio")}function Ua(j){var tt=Ta(j)?"checked":"value",st=Object.getOwnPropertyDescriptor(j.constructor.prototype,tt),b=""+j[tt];if(!j.hasOwnProperty(tt)&&typeof st<"u"&&typeof st.get=="function"&&typeof st.set=="function"){var yt=st.get,Et=st.set;return Object.defineProperty(j,tt,{configurable:!0,get:function(){return yt.call(this)},set:function(kt){b=""+kt,Et.call(this,kt)}}),Object.defineProperty(j,tt,{enumerable:st.enumerable}),{getValue:function(){return b},setValue:function(kt){b=""+kt},stopTracking:function(){j._valueTracker=null,delete j[tt]}}}}function Va(j){j._valueTracker||(j._valueTracker=Ua(j))}function Wa(j){if(!j)return!1;var tt=j._valueTracker;if(!tt)return!0;var st=tt.getValue(),b="";return j&&(b=Ta(j)?j.checked?"true":"false":j.value),j=b,j!==st?(tt.setValue(j),!0):!1}function Xa(j){if(j=j||(typeof document<"u"?document:void 0),typeof j>"u")return null;try{return j.activeElement||j.body}catch{return j.body}}function Ya(j,tt){var st=tt.checked;return A({},tt,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:st??j._wrapperState.initialChecked})}function Za(j,tt){var st=tt.defaultValue==null?"":tt.defaultValue,b=tt.checked!=null?tt.checked:tt.defaultChecked;st=Sa(tt.value!=null?tt.value:st),j._wrapperState={initialChecked:b,initialValue:st,controlled:tt.type==="checkbox"||tt.type==="radio"?tt.checked!=null:tt.value!=null}}function ab(j,tt){tt=tt.checked,tt!=null&&ta(j,"checked",tt,!1)}function bb(j,tt){ab(j,tt);var st=Sa(tt.value),b=tt.type;if(st!=null)b==="number"?(st===0&&j.value===""||j.value!=st)&&(j.value=""+st):j.value!==""+st&&(j.value=""+st);else if(b==="submit"||b==="reset"){j.removeAttribute("value");return}tt.hasOwnProperty("value")?cb(j,tt.type,st):tt.hasOwnProperty("defaultValue")&&cb(j,tt.type,Sa(tt.defaultValue)),tt.checked==null&&tt.defaultChecked!=null&&(j.defaultChecked=!!tt.defaultChecked)}function db(j,tt,st){if(tt.hasOwnProperty("value")||tt.hasOwnProperty("defaultValue")){var b=tt.type;if(!(b!=="submit"&&b!=="reset"||tt.value!==void 0&&tt.value!==null))return;tt=""+j._wrapperState.initialValue,st||tt===j.value||(j.value=tt),j.defaultValue=tt}st=j.name,st!==""&&(j.name=""),j.defaultChecked=!!j._wrapperState.initialChecked,st!==""&&(j.name=st)}function cb(j,tt,st){(tt!=="number"||Xa(j.ownerDocument)!==j)&&(st==null?j.defaultValue=""+j._wrapperState.initialValue:j.defaultValue!==""+st&&(j.defaultValue=""+st))}var eb=Array.isArray;function fb(j,tt,st,b){if(j=j.options,tt){tt={};for(var yt=0;yt<st.length;yt++)tt["$"+st[yt]]=!0;for(st=0;st<j.length;st++)yt=tt.hasOwnProperty("$"+j[st].value),j[st].selected!==yt&&(j[st].selected=yt),yt&&b&&(j[st].defaultSelected=!0)}else{for(st=""+Sa(st),tt=null,yt=0;yt<j.length;yt++){if(j[yt].value===st){j[yt].selected=!0,b&&(j[yt].defaultSelected=!0);return}tt!==null||j[yt].disabled||(tt=j[yt])}tt!==null&&(tt.selected=!0)}}function gb(j,tt){if(tt.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},tt,{value:void 0,defaultValue:void 0,children:""+j._wrapperState.initialValue})}function hb(j,tt){var st=tt.value;if(st==null){if(st=tt.children,tt=tt.defaultValue,st!=null){if(tt!=null)throw Error(p(92));if(eb(st)){if(1<st.length)throw Error(p(93));st=st[0]}tt=st}tt==null&&(tt=""),st=tt}j._wrapperState={initialValue:Sa(st)}}function ib(j,tt){var st=Sa(tt.value),b=Sa(tt.defaultValue);st!=null&&(st=""+st,st!==j.value&&(j.value=st),tt.defaultValue==null&&j.defaultValue!==st&&(j.defaultValue=st)),b!=null&&(j.defaultValue=""+b)}function jb(j){var tt=j.textContent;tt===j._wrapperState.initialValue&&tt!==""&&tt!==null&&(j.value=tt)}function kb(j){switch(j){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(j,tt){return j==null||j==="http://www.w3.org/1999/xhtml"?kb(tt):j==="http://www.w3.org/2000/svg"&&tt==="foreignObject"?"http://www.w3.org/1999/xhtml":j}var mb,nb=function(j){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(tt,st,b,yt){MSApp.execUnsafeLocalFunction(function(){return j(tt,st,b,yt)})}:j}(function(j,tt){if(j.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in j)j.innerHTML=tt;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+tt.valueOf().toString()+"</svg>",tt=mb.firstChild;j.firstChild;)j.removeChild(j.firstChild);for(;tt.firstChild;)j.appendChild(tt.firstChild)}});function ob(j,tt){if(tt){var st=j.firstChild;if(st&&st===j.lastChild&&st.nodeType===3){st.nodeValue=tt;return}}j.textContent=tt}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(j){qb.forEach(function(tt){tt=tt+j.charAt(0).toUpperCase()+j.substring(1),pb[tt]=pb[j]})});function rb(j,tt,st){return tt==null||typeof tt=="boolean"||tt===""?"":st||typeof tt!="number"||tt===0||pb.hasOwnProperty(j)&&pb[j]?(""+tt).trim():tt+"px"}function sb(j,tt){j=j.style;for(var st in tt)if(tt.hasOwnProperty(st)){var b=st.indexOf("--")===0,yt=rb(st,tt[st],b);st==="float"&&(st="cssFloat"),b?j.setProperty(st,yt):j[st]=yt}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(j,tt){if(tt){if(tb[j]&&(tt.children!=null||tt.dangerouslySetInnerHTML!=null))throw Error(p(137,j));if(tt.dangerouslySetInnerHTML!=null){if(tt.children!=null)throw Error(p(60));if(typeof tt.dangerouslySetInnerHTML!="object"||!("__html"in tt.dangerouslySetInnerHTML))throw Error(p(61))}if(tt.style!=null&&typeof tt.style!="object")throw Error(p(62))}}function vb(j,tt){if(j.indexOf("-")===-1)return typeof tt.is=="string";switch(j){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(j){return j=j.target||j.srcElement||window,j.correspondingUseElement&&(j=j.correspondingUseElement),j.nodeType===3?j.parentNode:j}var yb=null,zb=null,Ab=null;function Bb(j){if(j=Cb(j)){if(typeof yb!="function")throw Error(p(280));var tt=j.stateNode;tt&&(tt=Db(tt),yb(j.stateNode,j.type,tt))}}function Eb(j){zb?Ab?Ab.push(j):Ab=[j]:zb=j}function Fb(){if(zb){var j=zb,tt=Ab;if(Ab=zb=null,Bb(j),tt)for(j=0;j<tt.length;j++)Bb(tt[j])}}function Gb(j,tt){return j(tt)}function Hb(){}var Ib=!1;function Jb(j,tt,st){if(Ib)return j(tt,st);Ib=!0;try{return Gb(j,tt,st)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(j,tt){var st=j.stateNode;if(st===null)return null;var b=Db(st);if(b===null)return null;st=b[tt];e:switch(tt){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(j=j.type,b=!(j==="button"||j==="input"||j==="select"||j==="textarea")),j=!b;break e;default:j=!1}if(j)return null;if(st&&typeof st!="function")throw Error(p(231,tt,typeof st));return st}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(j,tt,st,b,yt,Et,kt,Gt,Vt){var an=Array.prototype.slice.call(arguments,3);try{tt.apply(st,an)}catch(Pn){this.onError(Pn)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(j){Ob=!0,Pb=j}};function Tb(j,tt,st,b,yt,Et,kt,Gt,Vt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(j,tt,st,b,yt,Et,kt,Gt,Vt){if(Tb.apply(this,arguments),Ob){if(Ob){var an=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=an)}}function Vb(j){var tt=j,st=j;if(j.alternate)for(;tt.return;)tt=tt.return;else{j=tt;do tt=j,tt.flags&4098&&(st=tt.return),j=tt.return;while(j)}return tt.tag===3?st:null}function Wb(j){if(j.tag===13){var tt=j.memoizedState;if(tt===null&&(j=j.alternate,j!==null&&(tt=j.memoizedState)),tt!==null)return tt.dehydrated}return null}function Xb(j){if(Vb(j)!==j)throw Error(p(188))}function Yb(j){var tt=j.alternate;if(!tt){if(tt=Vb(j),tt===null)throw Error(p(188));return tt!==j?null:j}for(var st=j,b=tt;;){var yt=st.return;if(yt===null)break;var Et=yt.alternate;if(Et===null){if(b=yt.return,b!==null){st=b;continue}break}if(yt.child===Et.child){for(Et=yt.child;Et;){if(Et===st)return Xb(yt),j;if(Et===b)return Xb(yt),tt;Et=Et.sibling}throw Error(p(188))}if(st.return!==b.return)st=yt,b=Et;else{for(var kt=!1,Gt=yt.child;Gt;){if(Gt===st){kt=!0,st=yt,b=Et;break}if(Gt===b){kt=!0,b=yt,st=Et;break}Gt=Gt.sibling}if(!kt){for(Gt=Et.child;Gt;){if(Gt===st){kt=!0,st=Et,b=yt;break}if(Gt===b){kt=!0,b=Et,st=yt;break}Gt=Gt.sibling}if(!kt)throw Error(p(189))}}if(st.alternate!==b)throw Error(p(190))}if(st.tag!==3)throw Error(p(188));return st.stateNode.current===st?j:tt}function Zb(j){return j=Yb(j),j!==null?$b(j):null}function $b(j){if(j.tag===5||j.tag===6)return j;for(j=j.child;j!==null;){var tt=$b(j);if(tt!==null)return tt;j=j.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(j){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,j,void 0,(j.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(j){return j>>>=0,j===0?32:31-(pc(j)/qc|0)|0}var rc=64,sc=4194304;function tc(j){switch(j&-j){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return j&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return j&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return j}}function uc(j,tt){var st=j.pendingLanes;if(st===0)return 0;var b=0,yt=j.suspendedLanes,Et=j.pingedLanes,kt=st&268435455;if(kt!==0){var Gt=kt&~yt;Gt!==0?b=tc(Gt):(Et&=kt,Et!==0&&(b=tc(Et)))}else kt=st&~yt,kt!==0?b=tc(kt):Et!==0&&(b=tc(Et));if(b===0)return 0;if(tt!==0&&tt!==b&&!(tt&yt)&&(yt=b&-b,Et=tt&-tt,yt>=Et||yt===16&&(Et&4194240)!==0))return tt;if(b&4&&(b|=st&16),tt=j.entangledLanes,tt!==0)for(j=j.entanglements,tt&=b;0<tt;)st=31-oc(tt),yt=1<<st,b|=j[st],tt&=~yt;return b}function vc(j,tt){switch(j){case 1:case 2:case 4:return tt+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return tt+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(j,tt){for(var st=j.suspendedLanes,b=j.pingedLanes,yt=j.expirationTimes,Et=j.pendingLanes;0<Et;){var kt=31-oc(Et),Gt=1<<kt,Vt=yt[kt];Vt===-1?(!(Gt&st)||Gt&b)&&(yt[kt]=vc(Gt,tt)):Vt<=tt&&(j.expiredLanes|=Gt),Et&=~Gt}}function xc(j){return j=j.pendingLanes&-1073741825,j!==0?j:j&1073741824?1073741824:0}function yc(){var j=rc;return rc<<=1,!(rc&4194240)&&(rc=64),j}function zc(j){for(var tt=[],st=0;31>st;st++)tt.push(j);return tt}function Ac(j,tt,st){j.pendingLanes|=tt,tt!==536870912&&(j.suspendedLanes=0,j.pingedLanes=0),j=j.eventTimes,tt=31-oc(tt),j[tt]=st}function Bc(j,tt){var st=j.pendingLanes&~tt;j.pendingLanes=tt,j.suspendedLanes=0,j.pingedLanes=0,j.expiredLanes&=tt,j.mutableReadLanes&=tt,j.entangledLanes&=tt,tt=j.entanglements;var b=j.eventTimes;for(j=j.expirationTimes;0<st;){var yt=31-oc(st),Et=1<<yt;tt[yt]=0,b[yt]=-1,j[yt]=-1,st&=~Et}}function Cc(j,tt){var st=j.entangledLanes|=tt;for(j=j.entanglements;st;){var b=31-oc(st),yt=1<<b;yt&tt|j[b]&tt&&(j[b]|=tt),st&=~yt}}var C=0;function Dc(j){return j&=-j,1<j?4<j?j&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(j,tt){switch(j){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(tt.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(tt.pointerId)}}function Tc(j,tt,st,b,yt,Et){return j===null||j.nativeEvent!==Et?(j={blockedOn:tt,domEventName:st,eventSystemFlags:b,nativeEvent:Et,targetContainers:[yt]},tt!==null&&(tt=Cb(tt),tt!==null&&Fc(tt)),j):(j.eventSystemFlags|=b,tt=j.targetContainers,yt!==null&&tt.indexOf(yt)===-1&&tt.push(yt),j)}function Uc(j,tt,st,b,yt){switch(tt){case"focusin":return Lc=Tc(Lc,j,tt,st,b,yt),!0;case"dragenter":return Mc=Tc(Mc,j,tt,st,b,yt),!0;case"mouseover":return Nc=Tc(Nc,j,tt,st,b,yt),!0;case"pointerover":var Et=yt.pointerId;return Oc.set(Et,Tc(Oc.get(Et)||null,j,tt,st,b,yt)),!0;case"gotpointercapture":return Et=yt.pointerId,Pc.set(Et,Tc(Pc.get(Et)||null,j,tt,st,b,yt)),!0}return!1}function Vc(j){var tt=Wc(j.target);if(tt!==null){var st=Vb(tt);if(st!==null){if(tt=st.tag,tt===13){if(tt=Wb(st),tt!==null){j.blockedOn=tt,Ic(j.priority,function(){Gc(st)});return}}else if(tt===3&&st.stateNode.current.memoizedState.isDehydrated){j.blockedOn=st.tag===3?st.stateNode.containerInfo:null;return}}}j.blockedOn=null}function Xc(j){if(j.blockedOn!==null)return!1;for(var tt=j.targetContainers;0<tt.length;){var st=Yc(j.domEventName,j.eventSystemFlags,tt[0],j.nativeEvent);if(st===null){st=j.nativeEvent;var b=new st.constructor(st.type,st);wb=b,st.target.dispatchEvent(b),wb=null}else return tt=Cb(st),tt!==null&&Fc(tt),j.blockedOn=st,!1;tt.shift()}return!0}function Zc(j,tt,st){Xc(j)&&st.delete(tt)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(j,tt){j.blockedOn===tt&&(j.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(j){function tt(yt){return ad(yt,j)}if(0<Kc.length){ad(Kc[0],j);for(var st=1;st<Kc.length;st++){var b=Kc[st];b.blockedOn===j&&(b.blockedOn=null)}}for(Lc!==null&&ad(Lc,j),Mc!==null&&ad(Mc,j),Nc!==null&&ad(Nc,j),Oc.forEach(tt),Pc.forEach(tt),st=0;st<Qc.length;st++)b=Qc[st],b.blockedOn===j&&(b.blockedOn=null);for(;0<Qc.length&&(st=Qc[0],st.blockedOn===null);)Vc(st),st.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(j,tt,st,b){var yt=C,Et=cd.transition;cd.transition=null;try{C=1,fd(j,tt,st,b)}finally{C=yt,cd.transition=Et}}function gd(j,tt,st,b){var yt=C,Et=cd.transition;cd.transition=null;try{C=4,fd(j,tt,st,b)}finally{C=yt,cd.transition=Et}}function fd(j,tt,st,b){if(dd){var yt=Yc(j,tt,st,b);if(yt===null)hd(j,tt,b,id,st),Sc(j,b);else if(Uc(yt,j,tt,st,b))b.stopPropagation();else if(Sc(j,b),tt&4&&-1<Rc.indexOf(j)){for(;yt!==null;){var Et=Cb(yt);if(Et!==null&&Ec(Et),Et=Yc(j,tt,st,b),Et===null&&hd(j,tt,b,id,st),Et===yt)break;yt=Et}yt!==null&&b.stopPropagation()}else hd(j,tt,b,null,st)}}var id=null;function Yc(j,tt,st,b){if(id=null,j=xb(b),j=Wc(j),j!==null)if(tt=Vb(j),tt===null)j=null;else if(st=tt.tag,st===13){if(j=Wb(tt),j!==null)return j;j=null}else if(st===3){if(tt.stateNode.current.memoizedState.isDehydrated)return tt.tag===3?tt.stateNode.containerInfo:null;j=null}else tt!==j&&(j=null);return id=j,null}function jd(j){switch(j){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var j,tt=ld,st=tt.length,b,yt="value"in kd?kd.value:kd.textContent,Et=yt.length;for(j=0;j<st&&tt[j]===yt[j];j++);var kt=st-j;for(b=1;b<=kt&&tt[st-b]===yt[Et-b];b++);return md=yt.slice(j,1<b?1-b:void 0)}function od(j){var tt=j.keyCode;return"charCode"in j?(j=j.charCode,j===0&&tt===13&&(j=13)):j=tt,j===10&&(j=13),32<=j||j===13?j:0}function pd(){return!0}function qd(){return!1}function rd(j){function tt(st,b,yt,Et,kt){this._reactName=st,this._targetInst=yt,this.type=b,this.nativeEvent=Et,this.target=kt,this.currentTarget=null;for(var Gt in j)j.hasOwnProperty(Gt)&&(st=j[Gt],this[Gt]=st?st(Et):Et[Gt]);return this.isDefaultPrevented=(Et.defaultPrevented!=null?Et.defaultPrevented:Et.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(tt.prototype,{preventDefault:function(){this.defaultPrevented=!0;var st=this.nativeEvent;st&&(st.preventDefault?st.preventDefault():typeof st.returnValue!="unknown"&&(st.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var st=this.nativeEvent;st&&(st.stopPropagation?st.stopPropagation():typeof st.cancelBubble!="unknown"&&(st.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),tt}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(j){return j.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(j){return j.relatedTarget===void 0?j.fromElement===j.srcElement?j.toElement:j.fromElement:j.relatedTarget},movementX:function(j){return"movementX"in j?j.movementX:(j!==yd&&(yd&&j.type==="mousemove"?(wd=j.screenX-yd.screenX,xd=j.screenY-yd.screenY):xd=wd=0,yd=j),wd)},movementY:function(j){return"movementY"in j?j.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(j){return"clipboardData"in j?j.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(j){var tt=this.nativeEvent;return tt.getModifierState?tt.getModifierState(j):(j=Od[j])?!!tt[j]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(j){if(j.key){var tt=Md[j.key]||j.key;if(tt!=="Unidentified")return tt}return j.type==="keypress"?(j=od(j),j===13?"Enter":String.fromCharCode(j)):j.type==="keydown"||j.type==="keyup"?Nd[j.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(j){return j.type==="keypress"?od(j):0},keyCode:function(j){return j.type==="keydown"||j.type==="keyup"?j.keyCode:0},which:function(j){return j.type==="keypress"?od(j):j.type==="keydown"||j.type==="keyup"?j.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(j){return"deltaX"in j?j.deltaX:"wheelDeltaX"in j?-j.wheelDeltaX:0},deltaY:function(j){return"deltaY"in j?j.deltaY:"wheelDeltaY"in j?-j.wheelDeltaY:"wheelDelta"in j?-j.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(j,tt){switch(j){case"keyup":return $d.indexOf(tt.keyCode)!==-1;case"keydown":return tt.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(j){return j=j.detail,typeof j=="object"&&"data"in j?j.data:null}var ie=!1;function je(j,tt){switch(j){case"compositionend":return he(tt);case"keypress":return tt.which!==32?null:(fe=!0,ee);case"textInput":return j=tt.data,j===ee&&fe?null:j;default:return null}}function ke(j,tt){if(ie)return j==="compositionend"||!ae&&ge(j,tt)?(j=nd(),md=ld=kd=null,ie=!1,j):null;switch(j){case"paste":return null;case"keypress":if(!(tt.ctrlKey||tt.altKey||tt.metaKey)||tt.ctrlKey&&tt.altKey){if(tt.char&&1<tt.char.length)return tt.char;if(tt.which)return String.fromCharCode(tt.which)}return null;case"compositionend":return de&&tt.locale!=="ko"?null:tt.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(j){var tt=j&&j.nodeName&&j.nodeName.toLowerCase();return tt==="input"?!!le[j.type]:tt==="textarea"}function ne(j,tt,st,b){Eb(b),tt=oe(tt,"onChange"),0<tt.length&&(st=new td("onChange","change",null,st,b),j.push({event:st,listeners:tt}))}var pe=null,qe=null;function re(j){se(j,0)}function te(j){var tt=ue(j);if(Wa(tt))return j}function ve(j,tt){if(j==="change")return tt}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(j){if(j.propertyName==="value"&&te(qe)){var tt=[];ne(tt,qe,j,xb(j)),Jb(re,tt)}}function Ce(j,tt,st){j==="focusin"?(Ae(),pe=tt,qe=st,pe.attachEvent("onpropertychange",Be)):j==="focusout"&&Ae()}function De(j){if(j==="selectionchange"||j==="keyup"||j==="keydown")return te(qe)}function Ee(j,tt){if(j==="click")return te(tt)}function Fe(j,tt){if(j==="input"||j==="change")return te(tt)}function Ge(j,tt){return j===tt&&(j!==0||1/j===1/tt)||j!==j&&tt!==tt}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(j,tt){if(He(j,tt))return!0;if(typeof j!="object"||j===null||typeof tt!="object"||tt===null)return!1;var st=Object.keys(j),b=Object.keys(tt);if(st.length!==b.length)return!1;for(b=0;b<st.length;b++){var yt=st[b];if(!ja.call(tt,yt)||!He(j[yt],tt[yt]))return!1}return!0}function Je(j){for(;j&&j.firstChild;)j=j.firstChild;return j}function Ke(j,tt){var st=Je(j);j=0;for(var b;st;){if(st.nodeType===3){if(b=j+st.textContent.length,j<=tt&&b>=tt)return{node:st,offset:tt-j};j=b}e:{for(;st;){if(st.nextSibling){st=st.nextSibling;break e}st=st.parentNode}st=void 0}st=Je(st)}}function Le(j,tt){return j&&tt?j===tt?!0:j&&j.nodeType===3?!1:tt&&tt.nodeType===3?Le(j,tt.parentNode):"contains"in j?j.contains(tt):j.compareDocumentPosition?!!(j.compareDocumentPosition(tt)&16):!1:!1}function Me(){for(var j=window,tt=Xa();tt instanceof j.HTMLIFrameElement;){try{var st=typeof tt.contentWindow.location.href=="string"}catch{st=!1}if(st)j=tt.contentWindow;else break;tt=Xa(j.document)}return tt}function Ne(j){var tt=j&&j.nodeName&&j.nodeName.toLowerCase();return tt&&(tt==="input"&&(j.type==="text"||j.type==="search"||j.type==="tel"||j.type==="url"||j.type==="password")||tt==="textarea"||j.contentEditable==="true")}function Oe(j){var tt=Me(),st=j.focusedElem,b=j.selectionRange;if(tt!==st&&st&&st.ownerDocument&&Le(st.ownerDocument.documentElement,st)){if(b!==null&&Ne(st)){if(tt=b.start,j=b.end,j===void 0&&(j=tt),"selectionStart"in st)st.selectionStart=tt,st.selectionEnd=Math.min(j,st.value.length);else if(j=(tt=st.ownerDocument||document)&&tt.defaultView||window,j.getSelection){j=j.getSelection();var yt=st.textContent.length,Et=Math.min(b.start,yt);b=b.end===void 0?Et:Math.min(b.end,yt),!j.extend&&Et>b&&(yt=b,b=Et,Et=yt),yt=Ke(st,Et);var kt=Ke(st,b);yt&&kt&&(j.rangeCount!==1||j.anchorNode!==yt.node||j.anchorOffset!==yt.offset||j.focusNode!==kt.node||j.focusOffset!==kt.offset)&&(tt=tt.createRange(),tt.setStart(yt.node,yt.offset),j.removeAllRanges(),Et>b?(j.addRange(tt),j.extend(kt.node,kt.offset)):(tt.setEnd(kt.node,kt.offset),j.addRange(tt)))}}for(tt=[],j=st;j=j.parentNode;)j.nodeType===1&&tt.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof st.focus=="function"&&st.focus(),st=0;st<tt.length;st++)j=tt[st],j.element.scrollLeft=j.left,j.element.scrollTop=j.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(j,tt,st){var b=st.window===st?st.document:st.nodeType===9?st:st.ownerDocument;Te||Qe==null||Qe!==Xa(b)||(b=Qe,"selectionStart"in b&&Ne(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Se&&Ie(Se,b)||(Se=b,b=oe(Re,"onSelect"),0<b.length&&(tt=new td("onSelect","select",null,tt,st),j.push({event:tt,listeners:b}),tt.target=Qe)))}function Ve(j,tt){var st={};return st[j.toLowerCase()]=tt.toLowerCase(),st["Webkit"+j]="webkit"+tt,st["Moz"+j]="moz"+tt,st}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(j){if(Xe[j])return Xe[j];if(!We[j])return j;var tt=We[j],st;for(st in tt)if(tt.hasOwnProperty(st)&&st in Ye)return Xe[j]=tt[st];return j}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(j,tt){df.set(j,tt),fa(tt,[j])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(j,tt,st){var b=j.type||"unknown-event";j.currentTarget=st,Ub(b,tt,void 0,j),j.currentTarget=null}function se(j,tt){tt=(tt&4)!==0;for(var st=0;st<j.length;st++){var b=j[st],yt=b.event;b=b.listeners;e:{var Et=void 0;if(tt)for(var kt=b.length-1;0<=kt;kt--){var Gt=b[kt],Vt=Gt.instance,an=Gt.currentTarget;if(Gt=Gt.listener,Vt!==Et&&yt.isPropagationStopped())break e;nf(yt,Gt,an),Et=Vt}else for(kt=0;kt<b.length;kt++){if(Gt=b[kt],Vt=Gt.instance,an=Gt.currentTarget,Gt=Gt.listener,Vt!==Et&&yt.isPropagationStopped())break e;nf(yt,Gt,an),Et=Vt}}}if(Qb)throw j=Rb,Qb=!1,Rb=null,j}function D(j,tt){var st=tt[of];st===void 0&&(st=tt[of]=new Set);var b=j+"__bubble";st.has(b)||(pf(tt,j,2,!1),st.add(b))}function qf(j,tt,st){var b=0;tt&&(b|=4),pf(st,j,b,tt)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(j){if(!j[rf]){j[rf]=!0,da.forEach(function(st){st!=="selectionchange"&&(mf.has(st)||qf(st,!1,j),qf(st,!0,j))});var tt=j.nodeType===9?j:j.ownerDocument;tt===null||tt[rf]||(tt[rf]=!0,qf("selectionchange",!1,tt))}}function pf(j,tt,st,b){switch(jd(tt)){case 1:var yt=ed;break;case 4:yt=gd;break;default:yt=fd}st=yt.bind(null,tt,st,j),yt=void 0,!Lb||tt!=="touchstart"&&tt!=="touchmove"&&tt!=="wheel"||(yt=!0),b?yt!==void 0?j.addEventListener(tt,st,{capture:!0,passive:yt}):j.addEventListener(tt,st,!0):yt!==void 0?j.addEventListener(tt,st,{passive:yt}):j.addEventListener(tt,st,!1)}function hd(j,tt,st,b,yt){var Et=b;if(!(tt&1)&&!(tt&2)&&b!==null)e:for(;;){if(b===null)return;var kt=b.tag;if(kt===3||kt===4){var Gt=b.stateNode.containerInfo;if(Gt===yt||Gt.nodeType===8&&Gt.parentNode===yt)break;if(kt===4)for(kt=b.return;kt!==null;){var Vt=kt.tag;if((Vt===3||Vt===4)&&(Vt=kt.stateNode.containerInfo,Vt===yt||Vt.nodeType===8&&Vt.parentNode===yt))return;kt=kt.return}for(;Gt!==null;){if(kt=Wc(Gt),kt===null)return;if(Vt=kt.tag,Vt===5||Vt===6){b=Et=kt;continue e}Gt=Gt.parentNode}}b=b.return}Jb(function(){var an=Et,Pn=xb(st),mn=[];e:{var hn=df.get(j);if(hn!==void 0){var wn=td,_n=j;switch(j){case"keypress":if(od(st)===0)break e;case"keydown":case"keyup":wn=Rd;break;case"focusin":_n="focus",wn=Fd;break;case"focusout":_n="blur",wn=Fd;break;case"beforeblur":case"afterblur":wn=Fd;break;case"click":if(st.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":wn=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":wn=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":wn=Vd;break;case $e:case af:case bf:wn=Hd;break;case cf:wn=Xd;break;case"scroll":wn=vd;break;case"wheel":wn=Zd;break;case"copy":case"cut":case"paste":wn=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":wn=Td}var $t=(tt&4)!==0,bn=!$t&&j==="scroll",Nt=$t?hn!==null?hn+"Capture":null:hn;$t=[];for(var jt=an,Yt;jt!==null;){Yt=jt;var Bn=Yt.stateNode;if(Yt.tag===5&&Bn!==null&&(Yt=Bn,Nt!==null&&(Bn=Kb(jt,Nt),Bn!=null&&$t.push(tf(jt,Bn,Yt)))),bn)break;jt=jt.return}0<$t.length&&(hn=new wn(hn,_n,null,st,Pn),mn.push({event:hn,listeners:$t}))}}if(!(tt&7)){e:{if(hn=j==="mouseover"||j==="pointerover",wn=j==="mouseout"||j==="pointerout",hn&&st!==wb&&(_n=st.relatedTarget||st.fromElement)&&(Wc(_n)||_n[uf]))break e;if((wn||hn)&&(hn=Pn.window===Pn?Pn:(hn=Pn.ownerDocument)?hn.defaultView||hn.parentWindow:window,wn?(_n=st.relatedTarget||st.toElement,wn=an,_n=_n?Wc(_n):null,_n!==null&&(bn=Vb(_n),_n!==bn||_n.tag!==5&&_n.tag!==6)&&(_n=null)):(wn=null,_n=an),wn!==_n)){if($t=Bd,Bn="onMouseLeave",Nt="onMouseEnter",jt="mouse",(j==="pointerout"||j==="pointerover")&&($t=Td,Bn="onPointerLeave",Nt="onPointerEnter",jt="pointer"),bn=wn==null?hn:ue(wn),Yt=_n==null?hn:ue(_n),hn=new $t(Bn,jt+"leave",wn,st,Pn),hn.target=bn,hn.relatedTarget=Yt,Bn=null,Wc(Pn)===an&&($t=new $t(Nt,jt+"enter",_n,st,Pn),$t.target=Yt,$t.relatedTarget=bn,Bn=$t),bn=Bn,wn&&_n)t:{for($t=wn,Nt=_n,jt=0,Yt=$t;Yt;Yt=vf(Yt))jt++;for(Yt=0,Bn=Nt;Bn;Bn=vf(Bn))Yt++;for(;0<jt-Yt;)$t=vf($t),jt--;for(;0<Yt-jt;)Nt=vf(Nt),Yt--;for(;jt--;){if($t===Nt||Nt!==null&&$t===Nt.alternate)break t;$t=vf($t),Nt=vf(Nt)}$t=null}else $t=null;wn!==null&&wf(mn,hn,wn,$t,!1),_n!==null&&bn!==null&&wf(mn,bn,_n,$t,!0)}}e:{if(hn=an?ue(an):window,wn=hn.nodeName&&hn.nodeName.toLowerCase(),wn==="select"||wn==="input"&&hn.type==="file")var un=ve;else if(me(hn))if(we)un=Fe;else{un=De;var Cn=Ce}else(wn=hn.nodeName)&&wn.toLowerCase()==="input"&&(hn.type==="checkbox"||hn.type==="radio")&&(un=Ee);if(un&&(un=un(j,an))){ne(mn,un,st,Pn);break e}Cn&&Cn(j,hn,an),j==="focusout"&&(Cn=hn._wrapperState)&&Cn.controlled&&hn.type==="number"&&cb(hn,"number",hn.value)}switch(Cn=an?ue(an):window,j){case"focusin":(me(Cn)||Cn.contentEditable==="true")&&(Qe=Cn,Re=an,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(mn,st,Pn);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(mn,st,Pn)}var Qt;if(ae)e:{switch(j){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else ie?ge(j,st)&&(Wt="onCompositionEnd"):j==="keydown"&&st.keyCode===229&&(Wt="onCompositionStart");Wt&&(de&&st.locale!=="ko"&&(ie||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&ie&&(Qt=nd()):(kd=Pn,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Cn=oe(an,Wt),0<Cn.length&&(Wt=new Ld(Wt,j,null,st,Pn),mn.push({event:Wt,listeners:Cn}),Qt?Wt.data=Qt:(Qt=he(st),Qt!==null&&(Wt.data=Qt)))),(Qt=ce?je(j,st):ke(j,st))&&(an=oe(an,"onBeforeInput"),0<an.length&&(Pn=new Ld("onBeforeInput","beforeinput",null,st,Pn),mn.push({event:Pn,listeners:an}),Pn.data=Qt))}se(mn,tt)})}function tf(j,tt,st){return{instance:j,listener:tt,currentTarget:st}}function oe(j,tt){for(var st=tt+"Capture",b=[];j!==null;){var yt=j,Et=yt.stateNode;yt.tag===5&&Et!==null&&(yt=Et,Et=Kb(j,st),Et!=null&&b.unshift(tf(j,Et,yt)),Et=Kb(j,tt),Et!=null&&b.push(tf(j,Et,yt))),j=j.return}return b}function vf(j){if(j===null)return null;do j=j.return;while(j&&j.tag!==5);return j||null}function wf(j,tt,st,b,yt){for(var Et=tt._reactName,kt=[];st!==null&&st!==b;){var Gt=st,Vt=Gt.alternate,an=Gt.stateNode;if(Vt!==null&&Vt===b)break;Gt.tag===5&&an!==null&&(Gt=an,yt?(Vt=Kb(st,Et),Vt!=null&&kt.unshift(tf(st,Vt,Gt))):yt||(Vt=Kb(st,Et),Vt!=null&&kt.push(tf(st,Vt,Gt)))),st=st.return}kt.length!==0&&j.push({event:tt,listeners:kt})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(j){return(typeof j=="string"?j:""+j).replace(xf,`
`).replace(yf,"")}function Af(j,tt,st){if(tt=zf(tt),zf(j)!==tt&&st)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(j,tt){return j==="textarea"||j==="noscript"||typeof tt.children=="string"||typeof tt.children=="number"||typeof tt.dangerouslySetInnerHTML=="object"&&tt.dangerouslySetInnerHTML!==null&&tt.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(j){return Hf.resolve(null).then(j).catch(If)}:Ff;function If(j){setTimeout(function(){throw j})}function Kf(j,tt){var st=tt,b=0;do{var yt=st.nextSibling;if(j.removeChild(st),yt&&yt.nodeType===8)if(st=yt.data,st==="/$"){if(b===0){j.removeChild(yt),bd(tt);return}b--}else st!=="$"&&st!=="$?"&&st!=="$!"||b++;st=yt}while(st);bd(tt)}function Lf(j){for(;j!=null;j=j.nextSibling){var tt=j.nodeType;if(tt===1||tt===3)break;if(tt===8){if(tt=j.data,tt==="$"||tt==="$!"||tt==="$?")break;if(tt==="/$")return null}}return j}function Mf(j){j=j.previousSibling;for(var tt=0;j;){if(j.nodeType===8){var st=j.data;if(st==="$"||st==="$!"||st==="$?"){if(tt===0)return j;tt--}else st==="/$"&&tt++}j=j.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(j){var tt=j[Of];if(tt)return tt;for(var st=j.parentNode;st;){if(tt=st[uf]||st[Of]){if(st=tt.alternate,tt.child!==null||st!==null&&st.child!==null)for(j=Mf(j);j!==null;){if(st=j[Of])return st;j=Mf(j)}return tt}j=st,st=j.parentNode}return null}function Cb(j){return j=j[Of]||j[uf],!j||j.tag!==5&&j.tag!==6&&j.tag!==13&&j.tag!==3?null:j}function ue(j){if(j.tag===5||j.tag===6)return j.stateNode;throw Error(p(33))}function Db(j){return j[Pf]||null}var Sf=[],Tf=-1;function Uf(j){return{current:j}}function E(j){0>Tf||(j.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(j,tt){Tf++,Sf[Tf]=j.current,j.current=tt}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(j,tt){var st=j.type.contextTypes;if(!st)return Vf;var b=j.stateNode;if(b&&b.__reactInternalMemoizedUnmaskedChildContext===tt)return b.__reactInternalMemoizedMaskedChildContext;var yt={},Et;for(Et in st)yt[Et]=tt[Et];return b&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=tt,j.__reactInternalMemoizedMaskedChildContext=yt),yt}function Zf(j){return j=j.childContextTypes,j!=null}function $f(){E(Wf),E(H)}function ag(j,tt,st){if(H.current!==Vf)throw Error(p(168));G(H,tt),G(Wf,st)}function bg(j,tt,st){var b=j.stateNode;if(tt=tt.childContextTypes,typeof b.getChildContext!="function")return st;b=b.getChildContext();for(var yt in b)if(!(yt in tt))throw Error(p(108,Ra(j)||"Unknown",yt));return A({},st,b)}function cg(j){return j=(j=j.stateNode)&&j.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,j),G(Wf,Wf.current),!0}function dg(j,tt,st){var b=j.stateNode;if(!b)throw Error(p(169));st?(j=bg(j,tt,Xf),b.__reactInternalMemoizedMergedChildContext=j,E(Wf),E(H),G(H,j)):E(Wf),G(Wf,st)}var eg=null,fg=!1,gg=!1;function hg(j){eg===null?eg=[j]:eg.push(j)}function ig(j){fg=!0,hg(j)}function jg(){if(!gg&&eg!==null){gg=!0;var j=0,tt=C;try{var st=eg;for(C=1;j<st.length;j++){var b=st[j];do b=b(!0);while(b!==null)}eg=null,fg=!1}catch(yt){throw eg!==null&&(eg=eg.slice(j+1)),ac(fc,jg),yt}finally{C=tt,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(j,tt){kg[lg++]=ng,kg[lg++]=mg,mg=j,ng=tt}function ug(j,tt,st){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=j;var b=rg;j=sg;var yt=32-oc(b)-1;b&=~(1<<yt),st+=1;var Et=32-oc(tt)+yt;if(30<Et){var kt=yt-yt%5;Et=(b&(1<<kt)-1).toString(32),b>>=kt,yt-=kt,rg=1<<32-oc(tt)+yt|st<<yt|b,sg=Et+j}else rg=1<<Et|st<<yt|b,sg=j}function vg(j){j.return!==null&&(tg(j,1),ug(j,1,0))}function wg(j){for(;j===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;j===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(j,tt){var st=Bg(5,null,null,0);st.elementType="DELETED",st.stateNode=tt,st.return=j,tt=j.deletions,tt===null?(j.deletions=[st],j.flags|=16):tt.push(st)}function Cg(j,tt){switch(j.tag){case 5:var st=j.type;return tt=tt.nodeType!==1||st.toLowerCase()!==tt.nodeName.toLowerCase()?null:tt,tt!==null?(j.stateNode=tt,xg=j,yg=Lf(tt.firstChild),!0):!1;case 6:return tt=j.pendingProps===""||tt.nodeType!==3?null:tt,tt!==null?(j.stateNode=tt,xg=j,yg=null,!0):!1;case 13:return tt=tt.nodeType!==8?null:tt,tt!==null?(st=qg!==null?{id:rg,overflow:sg}:null,j.memoizedState={dehydrated:tt,treeContext:st,retryLane:1073741824},st=Bg(18,null,null,0),st.stateNode=tt,st.return=j,j.child=st,xg=j,yg=null,!0):!1;default:return!1}}function Dg(j){return(j.mode&1)!==0&&(j.flags&128)===0}function Eg(j){if(I){var tt=yg;if(tt){var st=tt;if(!Cg(j,tt)){if(Dg(j))throw Error(p(418));tt=Lf(st.nextSibling);var b=xg;tt&&Cg(j,tt)?Ag(b,st):(j.flags=j.flags&-4097|2,I=!1,xg=j)}}else{if(Dg(j))throw Error(p(418));j.flags=j.flags&-4097|2,I=!1,xg=j}}}function Fg(j){for(j=j.return;j!==null&&j.tag!==5&&j.tag!==3&&j.tag!==13;)j=j.return;xg=j}function Gg(j){if(j!==xg)return!1;if(!I)return Fg(j),I=!0,!1;var tt;if((tt=j.tag!==3)&&!(tt=j.tag!==5)&&(tt=j.type,tt=tt!=="head"&&tt!=="body"&&!Ef(j.type,j.memoizedProps)),tt&&(tt=yg)){if(Dg(j))throw Hg(),Error(p(418));for(;tt;)Ag(j,tt),tt=Lf(tt.nextSibling)}if(Fg(j),j.tag===13){if(j=j.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(p(317));e:{for(j=j.nextSibling,tt=0;j;){if(j.nodeType===8){var st=j.data;if(st==="/$"){if(tt===0){yg=Lf(j.nextSibling);break e}tt--}else st!=="$"&&st!=="$!"&&st!=="$?"||tt++}j=j.nextSibling}yg=null}}else yg=xg?Lf(j.stateNode.nextSibling):null;return!0}function Hg(){for(var j=yg;j;)j=Lf(j.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(j){zg===null?zg=[j]:zg.push(j)}var Kg=ua.ReactCurrentBatchConfig;function Lg(j,tt){if(j&&j.defaultProps){tt=A({},tt),j=j.defaultProps;for(var st in j)tt[st]===void 0&&(tt[st]=j[st]);return tt}return tt}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(j){var tt=Mg.current;E(Mg),j._currentValue=tt}function Sg(j,tt,st){for(;j!==null;){var b=j.alternate;if((j.childLanes&tt)!==tt?(j.childLanes|=tt,b!==null&&(b.childLanes|=tt)):b!==null&&(b.childLanes&tt)!==tt&&(b.childLanes|=tt),j===st)break;j=j.return}}function Tg(j,tt){Ng=j,Pg=Og=null,j=j.dependencies,j!==null&&j.firstContext!==null&&(j.lanes&tt&&(Ug=!0),j.firstContext=null)}function Vg(j){var tt=j._currentValue;if(Pg!==j)if(j={context:j,memoizedValue:tt,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=j,Ng.dependencies={lanes:0,firstContext:j}}else Og=Og.next=j;return tt}var Wg=null;function Xg(j){Wg===null?Wg=[j]:Wg.push(j)}function Yg(j,tt,st,b){var yt=tt.interleaved;return yt===null?(st.next=st,Xg(tt)):(st.next=yt.next,yt.next=st),tt.interleaved=st,Zg(j,b)}function Zg(j,tt){j.lanes|=tt;var st=j.alternate;for(st!==null&&(st.lanes|=tt),st=j,j=j.return;j!==null;)j.childLanes|=tt,st=j.alternate,st!==null&&(st.childLanes|=tt),st=j,j=j.return;return st.tag===3?st.stateNode:null}var $g=!1;function ah(j){j.updateQueue={baseState:j.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(j,tt){j=j.updateQueue,tt.updateQueue===j&&(tt.updateQueue={baseState:j.baseState,firstBaseUpdate:j.firstBaseUpdate,lastBaseUpdate:j.lastBaseUpdate,shared:j.shared,effects:j.effects})}function ch(j,tt){return{eventTime:j,lane:tt,tag:0,payload:null,callback:null,next:null}}function dh(j,tt,st){var b=j.updateQueue;if(b===null)return null;if(b=b.shared,K&2){var yt=b.pending;return yt===null?tt.next=tt:(tt.next=yt.next,yt.next=tt),b.pending=tt,Zg(j,st)}return yt=b.interleaved,yt===null?(tt.next=tt,Xg(b)):(tt.next=yt.next,yt.next=tt),b.interleaved=tt,Zg(j,st)}function eh(j,tt,st){if(tt=tt.updateQueue,tt!==null&&(tt=tt.shared,(st&4194240)!==0)){var b=tt.lanes;b&=j.pendingLanes,st|=b,tt.lanes=st,Cc(j,st)}}function fh(j,tt){var st=j.updateQueue,b=j.alternate;if(b!==null&&(b=b.updateQueue,st===b)){var yt=null,Et=null;if(st=st.firstBaseUpdate,st!==null){do{var kt={eventTime:st.eventTime,lane:st.lane,tag:st.tag,payload:st.payload,callback:st.callback,next:null};Et===null?yt=Et=kt:Et=Et.next=kt,st=st.next}while(st!==null);Et===null?yt=Et=tt:Et=Et.next=tt}else yt=Et=tt;st={baseState:b.baseState,firstBaseUpdate:yt,lastBaseUpdate:Et,shared:b.shared,effects:b.effects},j.updateQueue=st;return}j=st.lastBaseUpdate,j===null?st.firstBaseUpdate=tt:j.next=tt,st.lastBaseUpdate=tt}function gh(j,tt,st,b){var yt=j.updateQueue;$g=!1;var Et=yt.firstBaseUpdate,kt=yt.lastBaseUpdate,Gt=yt.shared.pending;if(Gt!==null){yt.shared.pending=null;var Vt=Gt,an=Vt.next;Vt.next=null,kt===null?Et=an:kt.next=an,kt=Vt;var Pn=j.alternate;Pn!==null&&(Pn=Pn.updateQueue,Gt=Pn.lastBaseUpdate,Gt!==kt&&(Gt===null?Pn.firstBaseUpdate=an:Gt.next=an,Pn.lastBaseUpdate=Vt))}if(Et!==null){var mn=yt.baseState;kt=0,Pn=an=Vt=null,Gt=Et;do{var hn=Gt.lane,wn=Gt.eventTime;if((b&hn)===hn){Pn!==null&&(Pn=Pn.next={eventTime:wn,lane:0,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null});e:{var _n=j,$t=Gt;switch(hn=tt,wn=st,$t.tag){case 1:if(_n=$t.payload,typeof _n=="function"){mn=_n.call(wn,mn,hn);break e}mn=_n;break e;case 3:_n.flags=_n.flags&-65537|128;case 0:if(_n=$t.payload,hn=typeof _n=="function"?_n.call(wn,mn,hn):_n,hn==null)break e;mn=A({},mn,hn);break e;case 2:$g=!0}}Gt.callback!==null&&Gt.lane!==0&&(j.flags|=64,hn=yt.effects,hn===null?yt.effects=[Gt]:hn.push(Gt))}else wn={eventTime:wn,lane:hn,tag:Gt.tag,payload:Gt.payload,callback:Gt.callback,next:null},Pn===null?(an=Pn=wn,Vt=mn):Pn=Pn.next=wn,kt|=hn;if(Gt=Gt.next,Gt===null){if(Gt=yt.shared.pending,Gt===null)break;hn=Gt,Gt=hn.next,hn.next=null,yt.lastBaseUpdate=hn,yt.shared.pending=null}}while(1);if(Pn===null&&(Vt=mn),yt.baseState=Vt,yt.firstBaseUpdate=an,yt.lastBaseUpdate=Pn,tt=yt.shared.interleaved,tt!==null){yt=tt;do kt|=yt.lane,yt=yt.next;while(yt!==tt)}else Et===null&&(yt.shared.lanes=0);hh|=kt,j.lanes=kt,j.memoizedState=mn}}function ih(j,tt,st){if(j=tt.effects,tt.effects=null,j!==null)for(tt=0;tt<j.length;tt++){var b=j[tt],yt=b.callback;if(yt!==null){if(b.callback=null,b=st,typeof yt!="function")throw Error(p(191,yt));yt.call(b)}}}var jh=new aa.Component().refs;function kh(j,tt,st,b){tt=j.memoizedState,st=st(b,tt),st=st==null?tt:A({},tt,st),j.memoizedState=st,j.lanes===0&&(j.updateQueue.baseState=st)}var nh={isMounted:function(j){return(j=j._reactInternals)?Vb(j)===j:!1},enqueueSetState:function(j,tt,st){j=j._reactInternals;var b=L(),yt=lh(j),Et=ch(b,yt);Et.payload=tt,st!=null&&(Et.callback=st),tt=dh(j,Et,yt),tt!==null&&(mh(tt,j,yt,b),eh(tt,j,yt))},enqueueReplaceState:function(j,tt,st){j=j._reactInternals;var b=L(),yt=lh(j),Et=ch(b,yt);Et.tag=1,Et.payload=tt,st!=null&&(Et.callback=st),tt=dh(j,Et,yt),tt!==null&&(mh(tt,j,yt,b),eh(tt,j,yt))},enqueueForceUpdate:function(j,tt){j=j._reactInternals;var st=L(),b=lh(j),yt=ch(st,b);yt.tag=2,tt!=null&&(yt.callback=tt),tt=dh(j,yt,b),tt!==null&&(mh(tt,j,b,st),eh(tt,j,b))}};function oh(j,tt,st,b,yt,Et,kt){return j=j.stateNode,typeof j.shouldComponentUpdate=="function"?j.shouldComponentUpdate(b,Et,kt):tt.prototype&&tt.prototype.isPureReactComponent?!Ie(st,b)||!Ie(yt,Et):!0}function ph(j,tt,st){var b=!1,yt=Vf,Et=tt.contextType;return typeof Et=="object"&&Et!==null?Et=Vg(Et):(yt=Zf(tt)?Xf:H.current,b=tt.contextTypes,Et=(b=b!=null)?Yf(j,yt):Vf),tt=new tt(st,Et),j.memoizedState=tt.state!==null&&tt.state!==void 0?tt.state:null,tt.updater=nh,j.stateNode=tt,tt._reactInternals=j,b&&(j=j.stateNode,j.__reactInternalMemoizedUnmaskedChildContext=yt,j.__reactInternalMemoizedMaskedChildContext=Et),tt}function qh(j,tt,st,b){j=tt.state,typeof tt.componentWillReceiveProps=="function"&&tt.componentWillReceiveProps(st,b),typeof tt.UNSAFE_componentWillReceiveProps=="function"&&tt.UNSAFE_componentWillReceiveProps(st,b),tt.state!==j&&nh.enqueueReplaceState(tt,tt.state,null)}function rh(j,tt,st,b){var yt=j.stateNode;yt.props=st,yt.state=j.memoizedState,yt.refs=jh,ah(j);var Et=tt.contextType;typeof Et=="object"&&Et!==null?yt.context=Vg(Et):(Et=Zf(tt)?Xf:H.current,yt.context=Yf(j,Et)),yt.state=j.memoizedState,Et=tt.getDerivedStateFromProps,typeof Et=="function"&&(kh(j,tt,Et,st),yt.state=j.memoizedState),typeof tt.getDerivedStateFromProps=="function"||typeof yt.getSnapshotBeforeUpdate=="function"||typeof yt.UNSAFE_componentWillMount!="function"&&typeof yt.componentWillMount!="function"||(tt=yt.state,typeof yt.componentWillMount=="function"&&yt.componentWillMount(),typeof yt.UNSAFE_componentWillMount=="function"&&yt.UNSAFE_componentWillMount(),tt!==yt.state&&nh.enqueueReplaceState(yt,yt.state,null),gh(j,st,yt,b),yt.state=j.memoizedState),typeof yt.componentDidMount=="function"&&(j.flags|=4194308)}function sh(j,tt,st){if(j=st.ref,j!==null&&typeof j!="function"&&typeof j!="object"){if(st._owner){if(st=st._owner,st){if(st.tag!==1)throw Error(p(309));var b=st.stateNode}if(!b)throw Error(p(147,j));var yt=b,Et=""+j;return tt!==null&&tt.ref!==null&&typeof tt.ref=="function"&&tt.ref._stringRef===Et?tt.ref:(tt=function(kt){var Gt=yt.refs;Gt===jh&&(Gt=yt.refs={}),kt===null?delete Gt[Et]:Gt[Et]=kt},tt._stringRef=Et,tt)}if(typeof j!="string")throw Error(p(284));if(!st._owner)throw Error(p(290,j))}return j}function th(j,tt){throw j=Object.prototype.toString.call(tt),Error(p(31,j==="[object Object]"?"object with keys {"+Object.keys(tt).join(", ")+"}":j))}function uh(j){var tt=j._init;return tt(j._payload)}function vh(j){function tt(Nt,jt){if(j){var Yt=Nt.deletions;Yt===null?(Nt.deletions=[jt],Nt.flags|=16):Yt.push(jt)}}function st(Nt,jt){if(!j)return null;for(;jt!==null;)tt(Nt,jt),jt=jt.sibling;return null}function b(Nt,jt){for(Nt=new Map;jt!==null;)jt.key!==null?Nt.set(jt.key,jt):Nt.set(jt.index,jt),jt=jt.sibling;return Nt}function yt(Nt,jt){return Nt=wh(Nt,jt),Nt.index=0,Nt.sibling=null,Nt}function Et(Nt,jt,Yt){return Nt.index=Yt,j?(Yt=Nt.alternate,Yt!==null?(Yt=Yt.index,Yt<jt?(Nt.flags|=2,jt):Yt):(Nt.flags|=2,jt)):(Nt.flags|=1048576,jt)}function kt(Nt){return j&&Nt.alternate===null&&(Nt.flags|=2),Nt}function Gt(Nt,jt,Yt,Bn){return jt===null||jt.tag!==6?(jt=xh(Yt,Nt.mode,Bn),jt.return=Nt,jt):(jt=yt(jt,Yt),jt.return=Nt,jt)}function Vt(Nt,jt,Yt,Bn){var un=Yt.type;return un===ya?Pn(Nt,jt,Yt.props.children,Bn,Yt.key):jt!==null&&(jt.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===Ha&&uh(un)===jt.type)?(Bn=yt(jt,Yt.props),Bn.ref=sh(Nt,jt,Yt),Bn.return=Nt,Bn):(Bn=yh(Yt.type,Yt.key,Yt.props,null,Nt.mode,Bn),Bn.ref=sh(Nt,jt,Yt),Bn.return=Nt,Bn)}function an(Nt,jt,Yt,Bn){return jt===null||jt.tag!==4||jt.stateNode.containerInfo!==Yt.containerInfo||jt.stateNode.implementation!==Yt.implementation?(jt=zh(Yt,Nt.mode,Bn),jt.return=Nt,jt):(jt=yt(jt,Yt.children||[]),jt.return=Nt,jt)}function Pn(Nt,jt,Yt,Bn,un){return jt===null||jt.tag!==7?(jt=Ah(Yt,Nt.mode,Bn,un),jt.return=Nt,jt):(jt=yt(jt,Yt),jt.return=Nt,jt)}function mn(Nt,jt,Yt){if(typeof jt=="string"&&jt!==""||typeof jt=="number")return jt=xh(""+jt,Nt.mode,Yt),jt.return=Nt,jt;if(typeof jt=="object"&&jt!==null){switch(jt.$$typeof){case va:return Yt=yh(jt.type,jt.key,jt.props,null,Nt.mode,Yt),Yt.ref=sh(Nt,null,jt),Yt.return=Nt,Yt;case wa:return jt=zh(jt,Nt.mode,Yt),jt.return=Nt,jt;case Ha:var Bn=jt._init;return mn(Nt,Bn(jt._payload),Yt)}if(eb(jt)||Ka(jt))return jt=Ah(jt,Nt.mode,Yt,null),jt.return=Nt,jt;th(Nt,jt)}return null}function hn(Nt,jt,Yt,Bn){var un=jt!==null?jt.key:null;if(typeof Yt=="string"&&Yt!==""||typeof Yt=="number")return un!==null?null:Gt(Nt,jt,""+Yt,Bn);if(typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case va:return Yt.key===un?Vt(Nt,jt,Yt,Bn):null;case wa:return Yt.key===un?an(Nt,jt,Yt,Bn):null;case Ha:return un=Yt._init,hn(Nt,jt,un(Yt._payload),Bn)}if(eb(Yt)||Ka(Yt))return un!==null?null:Pn(Nt,jt,Yt,Bn,null);th(Nt,Yt)}return null}function wn(Nt,jt,Yt,Bn,un){if(typeof Bn=="string"&&Bn!==""||typeof Bn=="number")return Nt=Nt.get(Yt)||null,Gt(jt,Nt,""+Bn,un);if(typeof Bn=="object"&&Bn!==null){switch(Bn.$$typeof){case va:return Nt=Nt.get(Bn.key===null?Yt:Bn.key)||null,Vt(jt,Nt,Bn,un);case wa:return Nt=Nt.get(Bn.key===null?Yt:Bn.key)||null,an(jt,Nt,Bn,un);case Ha:var Cn=Bn._init;return wn(Nt,jt,Yt,Cn(Bn._payload),un)}if(eb(Bn)||Ka(Bn))return Nt=Nt.get(Yt)||null,Pn(jt,Nt,Bn,un,null);th(jt,Bn)}return null}function _n(Nt,jt,Yt,Bn){for(var un=null,Cn=null,Qt=jt,Wt=jt=0,Zt=null;Qt!==null&&Wt<Yt.length;Wt++){Qt.index>Wt?(Zt=Qt,Qt=null):Zt=Qt.sibling;var En=hn(Nt,Qt,Yt[Wt],Bn);if(En===null){Qt===null&&(Qt=Zt);break}j&&Qt&&En.alternate===null&&tt(Nt,Qt),jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En,Qt=Zt}if(Wt===Yt.length)return st(Nt,Qt),I&&tg(Nt,Wt),un;if(Qt===null){for(;Wt<Yt.length;Wt++)Qt=mn(Nt,Yt[Wt],Bn),Qt!==null&&(jt=Et(Qt,jt,Wt),Cn===null?un=Qt:Cn.sibling=Qt,Cn=Qt);return I&&tg(Nt,Wt),un}for(Qt=b(Nt,Qt);Wt<Yt.length;Wt++)Zt=wn(Qt,Nt,Wt,Yt[Wt],Bn),Zt!==null&&(j&&Zt.alternate!==null&&Qt.delete(Zt.key===null?Wt:Zt.key),jt=Et(Zt,jt,Wt),Cn===null?un=Zt:Cn.sibling=Zt,Cn=Zt);return j&&Qt.forEach(function(pn){return tt(Nt,pn)}),I&&tg(Nt,Wt),un}function $t(Nt,jt,Yt,Bn){var un=Ka(Yt);if(typeof un!="function")throw Error(p(150));if(Yt=un.call(Yt),Yt==null)throw Error(p(151));for(var Cn=un=null,Qt=jt,Wt=jt=0,Zt=null,En=Yt.next();Qt!==null&&!En.done;Wt++,En=Yt.next()){Qt.index>Wt?(Zt=Qt,Qt=null):Zt=Qt.sibling;var pn=hn(Nt,Qt,En.value,Bn);if(pn===null){Qt===null&&(Qt=Zt);break}j&&Qt&&pn.alternate===null&&tt(Nt,Qt),jt=Et(pn,jt,Wt),Cn===null?un=pn:Cn.sibling=pn,Cn=pn,Qt=Zt}if(En.done)return st(Nt,Qt),I&&tg(Nt,Wt),un;if(Qt===null){for(;!En.done;Wt++,En=Yt.next())En=mn(Nt,En.value,Bn),En!==null&&(jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En);return I&&tg(Nt,Wt),un}for(Qt=b(Nt,Qt);!En.done;Wt++,En=Yt.next())En=wn(Qt,Nt,Wt,En.value,Bn),En!==null&&(j&&En.alternate!==null&&Qt.delete(En.key===null?Wt:En.key),jt=Et(En,jt,Wt),Cn===null?un=En:Cn.sibling=En,Cn=En);return j&&Qt.forEach(function(er){return tt(Nt,er)}),I&&tg(Nt,Wt),un}function bn(Nt,jt,Yt,Bn){if(typeof Yt=="object"&&Yt!==null&&Yt.type===ya&&Yt.key===null&&(Yt=Yt.props.children),typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case va:e:{for(var un=Yt.key,Cn=jt;Cn!==null;){if(Cn.key===un){if(un=Yt.type,un===ya){if(Cn.tag===7){st(Nt,Cn.sibling),jt=yt(Cn,Yt.props.children),jt.return=Nt,Nt=jt;break e}}else if(Cn.elementType===un||typeof un=="object"&&un!==null&&un.$$typeof===Ha&&uh(un)===Cn.type){st(Nt,Cn.sibling),jt=yt(Cn,Yt.props),jt.ref=sh(Nt,Cn,Yt),jt.return=Nt,Nt=jt;break e}st(Nt,Cn);break}else tt(Nt,Cn);Cn=Cn.sibling}Yt.type===ya?(jt=Ah(Yt.props.children,Nt.mode,Bn,Yt.key),jt.return=Nt,Nt=jt):(Bn=yh(Yt.type,Yt.key,Yt.props,null,Nt.mode,Bn),Bn.ref=sh(Nt,jt,Yt),Bn.return=Nt,Nt=Bn)}return kt(Nt);case wa:e:{for(Cn=Yt.key;jt!==null;){if(jt.key===Cn)if(jt.tag===4&&jt.stateNode.containerInfo===Yt.containerInfo&&jt.stateNode.implementation===Yt.implementation){st(Nt,jt.sibling),jt=yt(jt,Yt.children||[]),jt.return=Nt,Nt=jt;break e}else{st(Nt,jt);break}else tt(Nt,jt);jt=jt.sibling}jt=zh(Yt,Nt.mode,Bn),jt.return=Nt,Nt=jt}return kt(Nt);case Ha:return Cn=Yt._init,bn(Nt,jt,Cn(Yt._payload),Bn)}if(eb(Yt))return _n(Nt,jt,Yt,Bn);if(Ka(Yt))return $t(Nt,jt,Yt,Bn);th(Nt,Yt)}return typeof Yt=="string"&&Yt!==""||typeof Yt=="number"?(Yt=""+Yt,jt!==null&&jt.tag===6?(st(Nt,jt.sibling),jt=yt(jt,Yt),jt.return=Nt,Nt=jt):(st(Nt,jt),jt=xh(Yt,Nt.mode,Bn),jt.return=Nt,Nt=jt),kt(Nt)):st(Nt,jt)}return bn}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(j){if(j===Dh)throw Error(p(174));return j}function Ih(j,tt){switch(G(Gh,tt),G(Fh,j),G(Eh,Dh),j=tt.nodeType,j){case 9:case 11:tt=(tt=tt.documentElement)?tt.namespaceURI:lb(null,"");break;default:j=j===8?tt.parentNode:tt,tt=j.namespaceURI||null,j=j.tagName,tt=lb(tt,j)}E(Eh),G(Eh,tt)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(j){Hh(Gh.current);var tt=Hh(Eh.current),st=lb(tt,j.type);tt!==st&&(G(Fh,j),G(Eh,st))}function Lh(j){Fh.current===j&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(j){for(var tt=j;tt!==null;){if(tt.tag===13){var st=tt.memoizedState;if(st!==null&&(st=st.dehydrated,st===null||st.data==="$?"||st.data==="$!"))return tt}else if(tt.tag===19&&tt.memoizedProps.revealOrder!==void 0){if(tt.flags&128)return tt}else if(tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===j)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===j)return null;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}return null}var Nh=[];function Oh(){for(var j=0;j<Nh.length;j++)Nh[j]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(j,tt){if(tt===null)return!1;for(var st=0;st<tt.length&&st<j.length;st++)if(!He(j[st],tt[st]))return!1;return!0}function Xh(j,tt,st,b,yt,Et){if(Rh=Et,N=tt,tt.memoizedState=null,tt.updateQueue=null,tt.lanes=0,Ph.current=j===null||j.memoizedState===null?Yh:Zh,j=st(b,yt),Th){Et=0;do{if(Th=!1,Uh=0,25<=Et)throw Error(p(301));Et+=1,P=O=null,tt.updateQueue=null,Ph.current=$h,j=st(b,yt)}while(Th)}if(Ph.current=ai,tt=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,tt)throw Error(p(300));return j}function bi(){var j=Uh!==0;return Uh=0,j}function ci(){var j={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=j:P=P.next=j,P}function di(){if(O===null){var j=N.alternate;j=j!==null?j.memoizedState:null}else j=O.next;var tt=P===null?N.memoizedState:P.next;if(tt!==null)P=tt,O=j;else{if(j===null)throw Error(p(310));O=j,j={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=j:P=P.next=j}return P}function ei(j,tt){return typeof tt=="function"?tt(j):tt}function fi(j){var tt=di(),st=tt.queue;if(st===null)throw Error(p(311));st.lastRenderedReducer=j;var b=O,yt=b.baseQueue,Et=st.pending;if(Et!==null){if(yt!==null){var kt=yt.next;yt.next=Et.next,Et.next=kt}b.baseQueue=yt=Et,st.pending=null}if(yt!==null){Et=yt.next,b=b.baseState;var Gt=kt=null,Vt=null,an=Et;do{var Pn=an.lane;if((Rh&Pn)===Pn)Vt!==null&&(Vt=Vt.next={lane:0,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null}),b=an.hasEagerState?an.eagerState:j(b,an.action);else{var mn={lane:Pn,action:an.action,hasEagerState:an.hasEagerState,eagerState:an.eagerState,next:null};Vt===null?(Gt=Vt=mn,kt=b):Vt=Vt.next=mn,N.lanes|=Pn,hh|=Pn}an=an.next}while(an!==null&&an!==Et);Vt===null?kt=b:Vt.next=Gt,He(b,tt.memoizedState)||(Ug=!0),tt.memoizedState=b,tt.baseState=kt,tt.baseQueue=Vt,st.lastRenderedState=b}if(j=st.interleaved,j!==null){yt=j;do Et=yt.lane,N.lanes|=Et,hh|=Et,yt=yt.next;while(yt!==j)}else yt===null&&(st.lanes=0);return[tt.memoizedState,st.dispatch]}function gi(j){var tt=di(),st=tt.queue;if(st===null)throw Error(p(311));st.lastRenderedReducer=j;var b=st.dispatch,yt=st.pending,Et=tt.memoizedState;if(yt!==null){st.pending=null;var kt=yt=yt.next;do Et=j(Et,kt.action),kt=kt.next;while(kt!==yt);He(Et,tt.memoizedState)||(Ug=!0),tt.memoizedState=Et,tt.baseQueue===null&&(tt.baseState=Et),st.lastRenderedState=Et}return[Et,b]}function hi(){}function ii(j,tt){var st=N,b=di(),yt=tt(),Et=!He(b.memoizedState,yt);if(Et&&(b.memoizedState=yt,Ug=!0),b=b.queue,ji(ki.bind(null,st,b,j),[j]),b.getSnapshot!==tt||Et||P!==null&&P.memoizedState.tag&1){if(st.flags|=2048,li(9,mi.bind(null,st,b,yt,tt),void 0,null),R===null)throw Error(p(349));Rh&30||ni(st,tt,yt)}return yt}function ni(j,tt,st){j.flags|=16384,j={getSnapshot:tt,value:st},tt=N.updateQueue,tt===null?(tt={lastEffect:null,stores:null},N.updateQueue=tt,tt.stores=[j]):(st=tt.stores,st===null?tt.stores=[j]:st.push(j))}function mi(j,tt,st,b){tt.value=st,tt.getSnapshot=b,oi(tt)&&pi(j)}function ki(j,tt,st){return st(function(){oi(tt)&&pi(j)})}function oi(j){var tt=j.getSnapshot;j=j.value;try{var st=tt();return!He(j,st)}catch{return!0}}function pi(j){var tt=Zg(j,1);tt!==null&&mh(tt,j,1,-1)}function qi(j){var tt=ci();return typeof j=="function"&&(j=j()),tt.memoizedState=tt.baseState=j,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:j},tt.queue=j,j=j.dispatch=ri.bind(null,N,j),[tt.memoizedState,j]}function li(j,tt,st,b){return j={tag:j,create:tt,destroy:st,deps:b,next:null},tt=N.updateQueue,tt===null?(tt={lastEffect:null,stores:null},N.updateQueue=tt,tt.lastEffect=j.next=j):(st=tt.lastEffect,st===null?tt.lastEffect=j.next=j:(b=st.next,st.next=j,j.next=b,tt.lastEffect=j)),j}function si(){return di().memoizedState}function ti(j,tt,st,b){var yt=ci();N.flags|=j,yt.memoizedState=li(1|tt,st,void 0,b===void 0?null:b)}function ui(j,tt,st,b){var yt=di();b=b===void 0?null:b;var Et=void 0;if(O!==null){var kt=O.memoizedState;if(Et=kt.destroy,b!==null&&Wh(b,kt.deps)){yt.memoizedState=li(tt,st,Et,b);return}}N.flags|=j,yt.memoizedState=li(1|tt,st,Et,b)}function vi(j,tt){return ti(8390656,8,j,tt)}function ji(j,tt){return ui(2048,8,j,tt)}function wi(j,tt){return ui(4,2,j,tt)}function xi(j,tt){return ui(4,4,j,tt)}function yi(j,tt){if(typeof tt=="function")return j=j(),tt(j),function(){tt(null)};if(tt!=null)return j=j(),tt.current=j,function(){tt.current=null}}function zi(j,tt,st){return st=st!=null?st.concat([j]):null,ui(4,4,yi.bind(null,tt,j),st)}function Ai(){}function Bi(j,tt){var st=di();tt=tt===void 0?null:tt;var b=st.memoizedState;return b!==null&&tt!==null&&Wh(tt,b[1])?b[0]:(st.memoizedState=[j,tt],j)}function Ci(j,tt){var st=di();tt=tt===void 0?null:tt;var b=st.memoizedState;return b!==null&&tt!==null&&Wh(tt,b[1])?b[0]:(j=j(),st.memoizedState=[j,tt],j)}function Di(j,tt,st){return Rh&21?(He(st,tt)||(st=yc(),N.lanes|=st,hh|=st,j.baseState=!0),tt):(j.baseState&&(j.baseState=!1,Ug=!0),j.memoizedState=st)}function Ei(j,tt){var st=C;C=st!==0&&4>st?st:4,j(!0);var b=Qh.transition;Qh.transition={};try{j(!1),tt()}finally{C=st,Qh.transition=b}}function Fi(){return di().memoizedState}function Gi(j,tt,st){var b=lh(j);if(st={lane:b,action:st,hasEagerState:!1,eagerState:null,next:null},Hi(j))Ii(tt,st);else if(st=Yg(j,tt,st,b),st!==null){var yt=L();mh(st,j,b,yt),Ji(st,tt,b)}}function ri(j,tt,st){var b=lh(j),yt={lane:b,action:st,hasEagerState:!1,eagerState:null,next:null};if(Hi(j))Ii(tt,yt);else{var Et=j.alternate;if(j.lanes===0&&(Et===null||Et.lanes===0)&&(Et=tt.lastRenderedReducer,Et!==null))try{var kt=tt.lastRenderedState,Gt=Et(kt,st);if(yt.hasEagerState=!0,yt.eagerState=Gt,He(Gt,kt)){var Vt=tt.interleaved;Vt===null?(yt.next=yt,Xg(tt)):(yt.next=Vt.next,Vt.next=yt),tt.interleaved=yt;return}}catch{}finally{}st=Yg(j,tt,yt,b),st!==null&&(yt=L(),mh(st,j,b,yt),Ji(st,tt,b))}}function Hi(j){var tt=j.alternate;return j===N||tt!==null&&tt===N}function Ii(j,tt){Th=Sh=!0;var st=j.pending;st===null?tt.next=tt:(tt.next=st.next,st.next=tt),j.pending=tt}function Ji(j,tt,st){if(st&4194240){var b=tt.lanes;b&=j.pendingLanes,st|=b,tt.lanes=st,Cc(j,st)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(j,tt){return ci().memoizedState=[j,tt===void 0?null:tt],j},useContext:Vg,useEffect:vi,useImperativeHandle:function(j,tt,st){return st=st!=null?st.concat([j]):null,ti(4194308,4,yi.bind(null,tt,j),st)},useLayoutEffect:function(j,tt){return ti(4194308,4,j,tt)},useInsertionEffect:function(j,tt){return ti(4,2,j,tt)},useMemo:function(j,tt){var st=ci();return tt=tt===void 0?null:tt,j=j(),st.memoizedState=[j,tt],j},useReducer:function(j,tt,st){var b=ci();return tt=st!==void 0?st(tt):tt,b.memoizedState=b.baseState=tt,j={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j,lastRenderedState:tt},b.queue=j,j=j.dispatch=Gi.bind(null,N,j),[b.memoizedState,j]},useRef:function(j){var tt=ci();return j={current:j},tt.memoizedState=j},useState:qi,useDebugValue:Ai,useDeferredValue:function(j){return ci().memoizedState=j},useTransition:function(){var j=qi(!1),tt=j[0];return j=Ei.bind(null,j[1]),ci().memoizedState=j,[tt,j]},useMutableSource:function(){},useSyncExternalStore:function(j,tt,st){var b=N,yt=ci();if(I){if(st===void 0)throw Error(p(407));st=st()}else{if(st=tt(),R===null)throw Error(p(349));Rh&30||ni(b,tt,st)}yt.memoizedState=st;var Et={value:st,getSnapshot:tt};return yt.queue=Et,vi(ki.bind(null,b,Et,j),[j]),b.flags|=2048,li(9,mi.bind(null,b,Et,st,tt),void 0,null),st},useId:function(){var j=ci(),tt=R.identifierPrefix;if(I){var st=sg,b=rg;st=(b&~(1<<32-oc(b)-1)).toString(32)+st,tt=":"+tt+"R"+st,st=Uh++,0<st&&(tt+="H"+st.toString(32)),tt+=":"}else st=Vh++,tt=":"+tt+"r"+st.toString(32)+":";return j.memoizedState=tt},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var tt=di();return Di(tt,O.memoizedState,j)},useTransition:function(){var j=fi(ei)[0],tt=di().memoizedState;return[j,tt]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(j){var tt=di();return O===null?tt.memoizedState=j:Di(tt,O.memoizedState,j)},useTransition:function(){var j=gi(ei)[0],tt=di().memoizedState;return[j,tt]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(j,tt){try{var st="",b=tt;do st+=Pa(b),b=b.return;while(b);var yt=st}catch(Et){yt=`
Error generating stack: `+Et.message+`
`+Et.stack}return{value:j,source:tt,stack:yt,digest:null}}function Li(j,tt,st){return{value:j,source:null,stack:st??null,digest:tt??null}}function Mi(j,tt){try{console.error(tt.value)}catch(st){setTimeout(function(){throw st})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(j,tt,st){st=ch(-1,st),st.tag=3,st.payload={element:null};var b=tt.value;return st.callback=function(){Pi||(Pi=!0,Qi=b),Mi(j,tt)},st}function Ri(j,tt,st){st=ch(-1,st),st.tag=3;var b=j.type.getDerivedStateFromError;if(typeof b=="function"){var yt=tt.value;st.payload=function(){return b(yt)},st.callback=function(){Mi(j,tt)}}var Et=j.stateNode;return Et!==null&&typeof Et.componentDidCatch=="function"&&(st.callback=function(){Mi(j,tt),typeof b!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var kt=tt.stack;this.componentDidCatch(tt.value,{componentStack:kt!==null?kt:""})}),st}function Ti(j,tt,st){var b=j.pingCache;if(b===null){b=j.pingCache=new Ni;var yt=new Set;b.set(tt,yt)}else yt=b.get(tt),yt===void 0&&(yt=new Set,b.set(tt,yt));yt.has(st)||(yt.add(st),j=Ui.bind(null,j,tt,st),tt.then(j,j))}function Vi(j){do{var tt;if((tt=j.tag===13)&&(tt=j.memoizedState,tt=tt!==null?tt.dehydrated!==null:!0),tt)return j;j=j.return}while(j!==null);return null}function Wi(j,tt,st,b,yt){return j.mode&1?(j.flags|=65536,j.lanes=yt,j):(j===tt?j.flags|=65536:(j.flags|=128,st.flags|=131072,st.flags&=-52805,st.tag===1&&(st.alternate===null?st.tag=17:(tt=ch(-1,1),tt.tag=2,dh(st,tt,1))),st.lanes|=1),j)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(j,tt,st,b){tt.child=j===null?Ch(tt,null,st,b):Bh(tt,j.child,st,b)}function Zi(j,tt,st,b,yt){st=st.render;var Et=tt.ref;return Tg(tt,yt),b=Xh(j,tt,st,b,Et,yt),st=bi(),j!==null&&!Ug?(tt.updateQueue=j.updateQueue,tt.flags&=-2053,j.lanes&=~yt,$i(j,tt,yt)):(I&&st&&vg(tt),tt.flags|=1,Yi(j,tt,b,yt),tt.child)}function aj(j,tt,st,b,yt){if(j===null){var Et=st.type;return typeof Et=="function"&&!bj(Et)&&Et.defaultProps===void 0&&st.compare===null&&st.defaultProps===void 0?(tt.tag=15,tt.type=Et,cj(j,tt,Et,b,yt)):(j=yh(st.type,null,b,tt,tt.mode,yt),j.ref=tt.ref,j.return=tt,tt.child=j)}if(Et=j.child,!(j.lanes&yt)){var kt=Et.memoizedProps;if(st=st.compare,st=st!==null?st:Ie,st(kt,b)&&j.ref===tt.ref)return $i(j,tt,yt)}return tt.flags|=1,j=wh(Et,b),j.ref=tt.ref,j.return=tt,tt.child=j}function cj(j,tt,st,b,yt){if(j!==null){var Et=j.memoizedProps;if(Ie(Et,b)&&j.ref===tt.ref)if(Ug=!1,tt.pendingProps=b=Et,(j.lanes&yt)!==0)j.flags&131072&&(Ug=!0);else return tt.lanes=j.lanes,$i(j,tt,yt)}return dj(j,tt,st,b,yt)}function ej(j,tt,st){var b=tt.pendingProps,yt=b.children,Et=j!==null?j.memoizedState:null;if(b.mode==="hidden")if(!(tt.mode&1))tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=st;else{if(!(st&1073741824))return j=Et!==null?Et.baseLanes|st:st,tt.lanes=tt.childLanes=1073741824,tt.memoizedState={baseLanes:j,cachePool:null,transitions:null},tt.updateQueue=null,G(fj,gj),gj|=j,null;tt.memoizedState={baseLanes:0,cachePool:null,transitions:null},b=Et!==null?Et.baseLanes:st,G(fj,gj),gj|=b}else Et!==null?(b=Et.baseLanes|st,tt.memoizedState=null):b=st,G(fj,gj),gj|=b;return Yi(j,tt,yt,st),tt.child}function hj(j,tt){var st=tt.ref;(j===null&&st!==null||j!==null&&j.ref!==st)&&(tt.flags|=512,tt.flags|=2097152)}function dj(j,tt,st,b,yt){var Et=Zf(st)?Xf:H.current;return Et=Yf(tt,Et),Tg(tt,yt),st=Xh(j,tt,st,b,Et,yt),b=bi(),j!==null&&!Ug?(tt.updateQueue=j.updateQueue,tt.flags&=-2053,j.lanes&=~yt,$i(j,tt,yt)):(I&&b&&vg(tt),tt.flags|=1,Yi(j,tt,st,yt),tt.child)}function ij(j,tt,st,b,yt){if(Zf(st)){var Et=!0;cg(tt)}else Et=!1;if(Tg(tt,yt),tt.stateNode===null)jj(j,tt),ph(tt,st,b),rh(tt,st,b,yt),b=!0;else if(j===null){var kt=tt.stateNode,Gt=tt.memoizedProps;kt.props=Gt;var Vt=kt.context,an=st.contextType;typeof an=="object"&&an!==null?an=Vg(an):(an=Zf(st)?Xf:H.current,an=Yf(tt,an));var Pn=st.getDerivedStateFromProps,mn=typeof Pn=="function"||typeof kt.getSnapshotBeforeUpdate=="function";mn||typeof kt.UNSAFE_componentWillReceiveProps!="function"&&typeof kt.componentWillReceiveProps!="function"||(Gt!==b||Vt!==an)&&qh(tt,kt,b,an),$g=!1;var hn=tt.memoizedState;kt.state=hn,gh(tt,b,kt,yt),Vt=tt.memoizedState,Gt!==b||hn!==Vt||Wf.current||$g?(typeof Pn=="function"&&(kh(tt,st,Pn,b),Vt=tt.memoizedState),(Gt=$g||oh(tt,st,Gt,b,hn,Vt,an))?(mn||typeof kt.UNSAFE_componentWillMount!="function"&&typeof kt.componentWillMount!="function"||(typeof kt.componentWillMount=="function"&&kt.componentWillMount(),typeof kt.UNSAFE_componentWillMount=="function"&&kt.UNSAFE_componentWillMount()),typeof kt.componentDidMount=="function"&&(tt.flags|=4194308)):(typeof kt.componentDidMount=="function"&&(tt.flags|=4194308),tt.memoizedProps=b,tt.memoizedState=Vt),kt.props=b,kt.state=Vt,kt.context=an,b=Gt):(typeof kt.componentDidMount=="function"&&(tt.flags|=4194308),b=!1)}else{kt=tt.stateNode,bh(j,tt),Gt=tt.memoizedProps,an=tt.type===tt.elementType?Gt:Lg(tt.type,Gt),kt.props=an,mn=tt.pendingProps,hn=kt.context,Vt=st.contextType,typeof Vt=="object"&&Vt!==null?Vt=Vg(Vt):(Vt=Zf(st)?Xf:H.current,Vt=Yf(tt,Vt));var wn=st.getDerivedStateFromProps;(Pn=typeof wn=="function"||typeof kt.getSnapshotBeforeUpdate=="function")||typeof kt.UNSAFE_componentWillReceiveProps!="function"&&typeof kt.componentWillReceiveProps!="function"||(Gt!==mn||hn!==Vt)&&qh(tt,kt,b,Vt),$g=!1,hn=tt.memoizedState,kt.state=hn,gh(tt,b,kt,yt);var _n=tt.memoizedState;Gt!==mn||hn!==_n||Wf.current||$g?(typeof wn=="function"&&(kh(tt,st,wn,b),_n=tt.memoizedState),(an=$g||oh(tt,st,an,b,hn,_n,Vt)||!1)?(Pn||typeof kt.UNSAFE_componentWillUpdate!="function"&&typeof kt.componentWillUpdate!="function"||(typeof kt.componentWillUpdate=="function"&&kt.componentWillUpdate(b,_n,Vt),typeof kt.UNSAFE_componentWillUpdate=="function"&&kt.UNSAFE_componentWillUpdate(b,_n,Vt)),typeof kt.componentDidUpdate=="function"&&(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate=="function"&&(tt.flags|=1024)):(typeof kt.componentDidUpdate!="function"||Gt===j.memoizedProps&&hn===j.memoizedState||(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate!="function"||Gt===j.memoizedProps&&hn===j.memoizedState||(tt.flags|=1024),tt.memoizedProps=b,tt.memoizedState=_n),kt.props=b,kt.state=_n,kt.context=Vt,b=an):(typeof kt.componentDidUpdate!="function"||Gt===j.memoizedProps&&hn===j.memoizedState||(tt.flags|=4),typeof kt.getSnapshotBeforeUpdate!="function"||Gt===j.memoizedProps&&hn===j.memoizedState||(tt.flags|=1024),b=!1)}return kj(j,tt,st,b,Et,yt)}function kj(j,tt,st,b,yt,Et){hj(j,tt);var kt=(tt.flags&128)!==0;if(!b&&!kt)return yt&&dg(tt,st,!1),$i(j,tt,Et);b=tt.stateNode,Xi.current=tt;var Gt=kt&&typeof st.getDerivedStateFromError!="function"?null:b.render();return tt.flags|=1,j!==null&&kt?(tt.child=Bh(tt,j.child,null,Et),tt.child=Bh(tt,null,Gt,Et)):Yi(j,tt,Gt,Et),tt.memoizedState=b.state,yt&&dg(tt,st,!0),tt.child}function lj(j){var tt=j.stateNode;tt.pendingContext?ag(j,tt.pendingContext,tt.pendingContext!==tt.context):tt.context&&ag(j,tt.context,!1),Ih(j,tt.containerInfo)}function mj(j,tt,st,b,yt){return Ig(),Jg(yt),tt.flags|=256,Yi(j,tt,st,b),tt.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(j){return{baseLanes:j,cachePool:null,transitions:null}}function pj(j,tt,st){var b=tt.pendingProps,yt=M.current,Et=!1,kt=(tt.flags&128)!==0,Gt;if((Gt=kt)||(Gt=j!==null&&j.memoizedState===null?!1:(yt&2)!==0),Gt?(Et=!0,tt.flags&=-129):(j===null||j.memoizedState!==null)&&(yt|=1),G(M,yt&1),j===null)return Eg(tt),j=tt.memoizedState,j!==null&&(j=j.dehydrated,j!==null)?(tt.mode&1?j.data==="$!"?tt.lanes=8:tt.lanes=1073741824:tt.lanes=1,null):(kt=b.children,j=b.fallback,Et?(b=tt.mode,Et=tt.child,kt={mode:"hidden",children:kt},!(b&1)&&Et!==null?(Et.childLanes=0,Et.pendingProps=kt):Et=qj(kt,b,0,null),j=Ah(j,b,st,null),Et.return=tt,j.return=tt,Et.sibling=j,tt.child=Et,tt.child.memoizedState=oj(st),tt.memoizedState=nj,j):rj(tt,kt));if(yt=j.memoizedState,yt!==null&&(Gt=yt.dehydrated,Gt!==null))return sj(j,tt,kt,b,Gt,yt,st);if(Et){Et=b.fallback,kt=tt.mode,yt=j.child,Gt=yt.sibling;var Vt={mode:"hidden",children:b.children};return!(kt&1)&&tt.child!==yt?(b=tt.child,b.childLanes=0,b.pendingProps=Vt,tt.deletions=null):(b=wh(yt,Vt),b.subtreeFlags=yt.subtreeFlags&14680064),Gt!==null?Et=wh(Gt,Et):(Et=Ah(Et,kt,st,null),Et.flags|=2),Et.return=tt,b.return=tt,b.sibling=Et,tt.child=b,b=Et,Et=tt.child,kt=j.child.memoizedState,kt=kt===null?oj(st):{baseLanes:kt.baseLanes|st,cachePool:null,transitions:kt.transitions},Et.memoizedState=kt,Et.childLanes=j.childLanes&~st,tt.memoizedState=nj,b}return Et=j.child,j=Et.sibling,b=wh(Et,{mode:"visible",children:b.children}),!(tt.mode&1)&&(b.lanes=st),b.return=tt,b.sibling=null,j!==null&&(st=tt.deletions,st===null?(tt.deletions=[j],tt.flags|=16):st.push(j)),tt.child=b,tt.memoizedState=null,b}function rj(j,tt){return tt=qj({mode:"visible",children:tt},j.mode,0,null),tt.return=j,j.child=tt}function tj(j,tt,st,b){return b!==null&&Jg(b),Bh(tt,j.child,null,st),j=rj(tt,tt.pendingProps.children),j.flags|=2,tt.memoizedState=null,j}function sj(j,tt,st,b,yt,Et,kt){if(st)return tt.flags&256?(tt.flags&=-257,b=Li(Error(p(422))),tj(j,tt,kt,b)):tt.memoizedState!==null?(tt.child=j.child,tt.flags|=128,null):(Et=b.fallback,yt=tt.mode,b=qj({mode:"visible",children:b.children},yt,0,null),Et=Ah(Et,yt,kt,null),Et.flags|=2,b.return=tt,Et.return=tt,b.sibling=Et,tt.child=b,tt.mode&1&&Bh(tt,j.child,null,kt),tt.child.memoizedState=oj(kt),tt.memoizedState=nj,Et);if(!(tt.mode&1))return tj(j,tt,kt,null);if(yt.data==="$!"){if(b=yt.nextSibling&&yt.nextSibling.dataset,b)var Gt=b.dgst;return b=Gt,Et=Error(p(419)),b=Li(Et,b,void 0),tj(j,tt,kt,b)}if(Gt=(kt&j.childLanes)!==0,Ug||Gt){if(b=R,b!==null){switch(kt&-kt){case 4:yt=2;break;case 16:yt=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:yt=32;break;case 536870912:yt=268435456;break;default:yt=0}yt=yt&(b.suspendedLanes|kt)?0:yt,yt!==0&&yt!==Et.retryLane&&(Et.retryLane=yt,Zg(j,yt),mh(b,j,yt,-1))}return uj(),b=Li(Error(p(421))),tj(j,tt,kt,b)}return yt.data==="$?"?(tt.flags|=128,tt.child=j.child,tt=vj.bind(null,j),yt._reactRetry=tt,null):(j=Et.treeContext,yg=Lf(yt.nextSibling),xg=tt,I=!0,zg=null,j!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=j.id,sg=j.overflow,qg=tt),tt=rj(tt,b.children),tt.flags|=4096,tt)}function wj(j,tt,st){j.lanes|=tt;var b=j.alternate;b!==null&&(b.lanes|=tt),Sg(j.return,tt,st)}function xj(j,tt,st,b,yt){var Et=j.memoizedState;Et===null?j.memoizedState={isBackwards:tt,rendering:null,renderingStartTime:0,last:b,tail:st,tailMode:yt}:(Et.isBackwards=tt,Et.rendering=null,Et.renderingStartTime=0,Et.last=b,Et.tail=st,Et.tailMode=yt)}function yj(j,tt,st){var b=tt.pendingProps,yt=b.revealOrder,Et=b.tail;if(Yi(j,tt,b.children,st),b=M.current,b&2)b=b&1|2,tt.flags|=128;else{if(j!==null&&j.flags&128)e:for(j=tt.child;j!==null;){if(j.tag===13)j.memoizedState!==null&&wj(j,st,tt);else if(j.tag===19)wj(j,st,tt);else if(j.child!==null){j.child.return=j,j=j.child;continue}if(j===tt)break e;for(;j.sibling===null;){if(j.return===null||j.return===tt)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}b&=1}if(G(M,b),!(tt.mode&1))tt.memoizedState=null;else switch(yt){case"forwards":for(st=tt.child,yt=null;st!==null;)j=st.alternate,j!==null&&Mh(j)===null&&(yt=st),st=st.sibling;st=yt,st===null?(yt=tt.child,tt.child=null):(yt=st.sibling,st.sibling=null),xj(tt,!1,yt,st,Et);break;case"backwards":for(st=null,yt=tt.child,tt.child=null;yt!==null;){if(j=yt.alternate,j!==null&&Mh(j)===null){tt.child=yt;break}j=yt.sibling,yt.sibling=st,st=yt,yt=j}xj(tt,!0,st,null,Et);break;case"together":xj(tt,!1,null,null,void 0);break;default:tt.memoizedState=null}return tt.child}function jj(j,tt){!(tt.mode&1)&&j!==null&&(j.alternate=null,tt.alternate=null,tt.flags|=2)}function $i(j,tt,st){if(j!==null&&(tt.dependencies=j.dependencies),hh|=tt.lanes,!(st&tt.childLanes))return null;if(j!==null&&tt.child!==j.child)throw Error(p(153));if(tt.child!==null){for(j=tt.child,st=wh(j,j.pendingProps),tt.child=st,st.return=tt;j.sibling!==null;)j=j.sibling,st=st.sibling=wh(j,j.pendingProps),st.return=tt;st.sibling=null}return tt.child}function zj(j,tt,st){switch(tt.tag){case 3:lj(tt),Ig();break;case 5:Kh(tt);break;case 1:Zf(tt.type)&&cg(tt);break;case 4:Ih(tt,tt.stateNode.containerInfo);break;case 10:var b=tt.type._context,yt=tt.memoizedProps.value;G(Mg,b._currentValue),b._currentValue=yt;break;case 13:if(b=tt.memoizedState,b!==null)return b.dehydrated!==null?(G(M,M.current&1),tt.flags|=128,null):st&tt.child.childLanes?pj(j,tt,st):(G(M,M.current&1),j=$i(j,tt,st),j!==null?j.sibling:null);G(M,M.current&1);break;case 19:if(b=(st&tt.childLanes)!==0,j.flags&128){if(b)return yj(j,tt,st);tt.flags|=128}if(yt=tt.memoizedState,yt!==null&&(yt.rendering=null,yt.tail=null,yt.lastEffect=null),G(M,M.current),b)break;return null;case 22:case 23:return tt.lanes=0,ej(j,tt,st)}return $i(j,tt,st)}var Aj,Bj,Cj,Dj;Aj=function(j,tt){for(var st=tt.child;st!==null;){if(st.tag===5||st.tag===6)j.appendChild(st.stateNode);else if(st.tag!==4&&st.child!==null){st.child.return=st,st=st.child;continue}if(st===tt)break;for(;st.sibling===null;){if(st.return===null||st.return===tt)return;st=st.return}st.sibling.return=st.return,st=st.sibling}};Bj=function(){};Cj=function(j,tt,st,b){var yt=j.memoizedProps;if(yt!==b){j=tt.stateNode,Hh(Eh.current);var Et=null;switch(st){case"input":yt=Ya(j,yt),b=Ya(j,b),Et=[];break;case"select":yt=A({},yt,{value:void 0}),b=A({},b,{value:void 0}),Et=[];break;case"textarea":yt=gb(j,yt),b=gb(j,b),Et=[];break;default:typeof yt.onClick!="function"&&typeof b.onClick=="function"&&(j.onclick=Bf)}ub(st,b);var kt;st=null;for(an in yt)if(!b.hasOwnProperty(an)&&yt.hasOwnProperty(an)&&yt[an]!=null)if(an==="style"){var Gt=yt[an];for(kt in Gt)Gt.hasOwnProperty(kt)&&(st||(st={}),st[kt]="")}else an!=="dangerouslySetInnerHTML"&&an!=="children"&&an!=="suppressContentEditableWarning"&&an!=="suppressHydrationWarning"&&an!=="autoFocus"&&(ea.hasOwnProperty(an)?Et||(Et=[]):(Et=Et||[]).push(an,null));for(an in b){var Vt=b[an];if(Gt=yt!=null?yt[an]:void 0,b.hasOwnProperty(an)&&Vt!==Gt&&(Vt!=null||Gt!=null))if(an==="style")if(Gt){for(kt in Gt)!Gt.hasOwnProperty(kt)||Vt&&Vt.hasOwnProperty(kt)||(st||(st={}),st[kt]="");for(kt in Vt)Vt.hasOwnProperty(kt)&&Gt[kt]!==Vt[kt]&&(st||(st={}),st[kt]=Vt[kt])}else st||(Et||(Et=[]),Et.push(an,st)),st=Vt;else an==="dangerouslySetInnerHTML"?(Vt=Vt?Vt.__html:void 0,Gt=Gt?Gt.__html:void 0,Vt!=null&&Gt!==Vt&&(Et=Et||[]).push(an,Vt)):an==="children"?typeof Vt!="string"&&typeof Vt!="number"||(Et=Et||[]).push(an,""+Vt):an!=="suppressContentEditableWarning"&&an!=="suppressHydrationWarning"&&(ea.hasOwnProperty(an)?(Vt!=null&&an==="onScroll"&&D("scroll",j),Et||Gt===Vt||(Et=[])):(Et=Et||[]).push(an,Vt))}st&&(Et=Et||[]).push("style",st);var an=Et;(tt.updateQueue=an)&&(tt.flags|=4)}};Dj=function(j,tt,st,b){st!==b&&(tt.flags|=4)};function Ej(j,tt){if(!I)switch(j.tailMode){case"hidden":tt=j.tail;for(var st=null;tt!==null;)tt.alternate!==null&&(st=tt),tt=tt.sibling;st===null?j.tail=null:st.sibling=null;break;case"collapsed":st=j.tail;for(var b=null;st!==null;)st.alternate!==null&&(b=st),st=st.sibling;b===null?tt||j.tail===null?j.tail=null:j.tail.sibling=null:b.sibling=null}}function S(j){var tt=j.alternate!==null&&j.alternate.child===j.child,st=0,b=0;if(tt)for(var yt=j.child;yt!==null;)st|=yt.lanes|yt.childLanes,b|=yt.subtreeFlags&14680064,b|=yt.flags&14680064,yt.return=j,yt=yt.sibling;else for(yt=j.child;yt!==null;)st|=yt.lanes|yt.childLanes,b|=yt.subtreeFlags,b|=yt.flags,yt.return=j,yt=yt.sibling;return j.subtreeFlags|=b,j.childLanes=st,tt}function Fj(j,tt,st){var b=tt.pendingProps;switch(wg(tt),tt.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(tt),null;case 1:return Zf(tt.type)&&$f(),S(tt),null;case 3:return b=tt.stateNode,Jh(),E(Wf),E(H),Oh(),b.pendingContext&&(b.context=b.pendingContext,b.pendingContext=null),(j===null||j.child===null)&&(Gg(tt)?tt.flags|=4:j===null||j.memoizedState.isDehydrated&&!(tt.flags&256)||(tt.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(j,tt),S(tt),null;case 5:Lh(tt);var yt=Hh(Gh.current);if(st=tt.type,j!==null&&tt.stateNode!=null)Cj(j,tt,st,b,yt),j.ref!==tt.ref&&(tt.flags|=512,tt.flags|=2097152);else{if(!b){if(tt.stateNode===null)throw Error(p(166));return S(tt),null}if(j=Hh(Eh.current),Gg(tt)){b=tt.stateNode,st=tt.type;var Et=tt.memoizedProps;switch(b[Of]=tt,b[Pf]=Et,j=(tt.mode&1)!==0,st){case"dialog":D("cancel",b),D("close",b);break;case"iframe":case"object":case"embed":D("load",b);break;case"video":case"audio":for(yt=0;yt<lf.length;yt++)D(lf[yt],b);break;case"source":D("error",b);break;case"img":case"image":case"link":D("error",b),D("load",b);break;case"details":D("toggle",b);break;case"input":Za(b,Et),D("invalid",b);break;case"select":b._wrapperState={wasMultiple:!!Et.multiple},D("invalid",b);break;case"textarea":hb(b,Et),D("invalid",b)}ub(st,Et),yt=null;for(var kt in Et)if(Et.hasOwnProperty(kt)){var Gt=Et[kt];kt==="children"?typeof Gt=="string"?b.textContent!==Gt&&(Et.suppressHydrationWarning!==!0&&Af(b.textContent,Gt,j),yt=["children",Gt]):typeof Gt=="number"&&b.textContent!==""+Gt&&(Et.suppressHydrationWarning!==!0&&Af(b.textContent,Gt,j),yt=["children",""+Gt]):ea.hasOwnProperty(kt)&&Gt!=null&&kt==="onScroll"&&D("scroll",b)}switch(st){case"input":Va(b),db(b,Et,!0);break;case"textarea":Va(b),jb(b);break;case"select":case"option":break;default:typeof Et.onClick=="function"&&(b.onclick=Bf)}b=yt,tt.updateQueue=b,b!==null&&(tt.flags|=4)}else{kt=yt.nodeType===9?yt:yt.ownerDocument,j==="http://www.w3.org/1999/xhtml"&&(j=kb(st)),j==="http://www.w3.org/1999/xhtml"?st==="script"?(j=kt.createElement("div"),j.innerHTML="<script><\/script>",j=j.removeChild(j.firstChild)):typeof b.is=="string"?j=kt.createElement(st,{is:b.is}):(j=kt.createElement(st),st==="select"&&(kt=j,b.multiple?kt.multiple=!0:b.size&&(kt.size=b.size))):j=kt.createElementNS(j,st),j[Of]=tt,j[Pf]=b,Aj(j,tt,!1,!1),tt.stateNode=j;e:{switch(kt=vb(st,b),st){case"dialog":D("cancel",j),D("close",j),yt=b;break;case"iframe":case"object":case"embed":D("load",j),yt=b;break;case"video":case"audio":for(yt=0;yt<lf.length;yt++)D(lf[yt],j);yt=b;break;case"source":D("error",j),yt=b;break;case"img":case"image":case"link":D("error",j),D("load",j),yt=b;break;case"details":D("toggle",j),yt=b;break;case"input":Za(j,b),yt=Ya(j,b),D("invalid",j);break;case"option":yt=b;break;case"select":j._wrapperState={wasMultiple:!!b.multiple},yt=A({},b,{value:void 0}),D("invalid",j);break;case"textarea":hb(j,b),yt=gb(j,b),D("invalid",j);break;default:yt=b}ub(st,yt),Gt=yt;for(Et in Gt)if(Gt.hasOwnProperty(Et)){var Vt=Gt[Et];Et==="style"?sb(j,Vt):Et==="dangerouslySetInnerHTML"?(Vt=Vt?Vt.__html:void 0,Vt!=null&&nb(j,Vt)):Et==="children"?typeof Vt=="string"?(st!=="textarea"||Vt!=="")&&ob(j,Vt):typeof Vt=="number"&&ob(j,""+Vt):Et!=="suppressContentEditableWarning"&&Et!=="suppressHydrationWarning"&&Et!=="autoFocus"&&(ea.hasOwnProperty(Et)?Vt!=null&&Et==="onScroll"&&D("scroll",j):Vt!=null&&ta(j,Et,Vt,kt))}switch(st){case"input":Va(j),db(j,b,!1);break;case"textarea":Va(j),jb(j);break;case"option":b.value!=null&&j.setAttribute("value",""+Sa(b.value));break;case"select":j.multiple=!!b.multiple,Et=b.value,Et!=null?fb(j,!!b.multiple,Et,!1):b.defaultValue!=null&&fb(j,!!b.multiple,b.defaultValue,!0);break;default:typeof yt.onClick=="function"&&(j.onclick=Bf)}switch(st){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}}b&&(tt.flags|=4)}tt.ref!==null&&(tt.flags|=512,tt.flags|=2097152)}return S(tt),null;case 6:if(j&&tt.stateNode!=null)Dj(j,tt,j.memoizedProps,b);else{if(typeof b!="string"&&tt.stateNode===null)throw Error(p(166));if(st=Hh(Gh.current),Hh(Eh.current),Gg(tt)){if(b=tt.stateNode,st=tt.memoizedProps,b[Of]=tt,(Et=b.nodeValue!==st)&&(j=xg,j!==null))switch(j.tag){case 3:Af(b.nodeValue,st,(j.mode&1)!==0);break;case 5:j.memoizedProps.suppressHydrationWarning!==!0&&Af(b.nodeValue,st,(j.mode&1)!==0)}Et&&(tt.flags|=4)}else b=(st.nodeType===9?st:st.ownerDocument).createTextNode(b),b[Of]=tt,tt.stateNode=b}return S(tt),null;case 13:if(E(M),b=tt.memoizedState,j===null||j.memoizedState!==null&&j.memoizedState.dehydrated!==null){if(I&&yg!==null&&tt.mode&1&&!(tt.flags&128))Hg(),Ig(),tt.flags|=98560,Et=!1;else if(Et=Gg(tt),b!==null&&b.dehydrated!==null){if(j===null){if(!Et)throw Error(p(318));if(Et=tt.memoizedState,Et=Et!==null?Et.dehydrated:null,!Et)throw Error(p(317));Et[Of]=tt}else Ig(),!(tt.flags&128)&&(tt.memoizedState=null),tt.flags|=4;S(tt),Et=!1}else zg!==null&&(Gj(zg),zg=null),Et=!0;if(!Et)return tt.flags&65536?tt:null}return tt.flags&128?(tt.lanes=st,tt):(b=b!==null,b!==(j!==null&&j.memoizedState!==null)&&b&&(tt.child.flags|=8192,tt.mode&1&&(j===null||M.current&1?T===0&&(T=3):uj())),tt.updateQueue!==null&&(tt.flags|=4),S(tt),null);case 4:return Jh(),Bj(j,tt),j===null&&sf(tt.stateNode.containerInfo),S(tt),null;case 10:return Rg(tt.type._context),S(tt),null;case 17:return Zf(tt.type)&&$f(),S(tt),null;case 19:if(E(M),Et=tt.memoizedState,Et===null)return S(tt),null;if(b=(tt.flags&128)!==0,kt=Et.rendering,kt===null)if(b)Ej(Et,!1);else{if(T!==0||j!==null&&j.flags&128)for(j=tt.child;j!==null;){if(kt=Mh(j),kt!==null){for(tt.flags|=128,Ej(Et,!1),b=kt.updateQueue,b!==null&&(tt.updateQueue=b,tt.flags|=4),tt.subtreeFlags=0,b=st,st=tt.child;st!==null;)Et=st,j=b,Et.flags&=14680066,kt=Et.alternate,kt===null?(Et.childLanes=0,Et.lanes=j,Et.child=null,Et.subtreeFlags=0,Et.memoizedProps=null,Et.memoizedState=null,Et.updateQueue=null,Et.dependencies=null,Et.stateNode=null):(Et.childLanes=kt.childLanes,Et.lanes=kt.lanes,Et.child=kt.child,Et.subtreeFlags=0,Et.deletions=null,Et.memoizedProps=kt.memoizedProps,Et.memoizedState=kt.memoizedState,Et.updateQueue=kt.updateQueue,Et.type=kt.type,j=kt.dependencies,Et.dependencies=j===null?null:{lanes:j.lanes,firstContext:j.firstContext}),st=st.sibling;return G(M,M.current&1|2),tt.child}j=j.sibling}Et.tail!==null&&B()>Hj&&(tt.flags|=128,b=!0,Ej(Et,!1),tt.lanes=4194304)}else{if(!b)if(j=Mh(kt),j!==null){if(tt.flags|=128,b=!0,st=j.updateQueue,st!==null&&(tt.updateQueue=st,tt.flags|=4),Ej(Et,!0),Et.tail===null&&Et.tailMode==="hidden"&&!kt.alternate&&!I)return S(tt),null}else 2*B()-Et.renderingStartTime>Hj&&st!==1073741824&&(tt.flags|=128,b=!0,Ej(Et,!1),tt.lanes=4194304);Et.isBackwards?(kt.sibling=tt.child,tt.child=kt):(st=Et.last,st!==null?st.sibling=kt:tt.child=kt,Et.last=kt)}return Et.tail!==null?(tt=Et.tail,Et.rendering=tt,Et.tail=tt.sibling,Et.renderingStartTime=B(),tt.sibling=null,st=M.current,G(M,b?st&1|2:st&1),tt):(S(tt),null);case 22:case 23:return Ij(),b=tt.memoizedState!==null,j!==null&&j.memoizedState!==null!==b&&(tt.flags|=8192),b&&tt.mode&1?gj&1073741824&&(S(tt),tt.subtreeFlags&6&&(tt.flags|=8192)):S(tt),null;case 24:return null;case 25:return null}throw Error(p(156,tt.tag))}function Jj(j,tt){switch(wg(tt),tt.tag){case 1:return Zf(tt.type)&&$f(),j=tt.flags,j&65536?(tt.flags=j&-65537|128,tt):null;case 3:return Jh(),E(Wf),E(H),Oh(),j=tt.flags,j&65536&&!(j&128)?(tt.flags=j&-65537|128,tt):null;case 5:return Lh(tt),null;case 13:if(E(M),j=tt.memoizedState,j!==null&&j.dehydrated!==null){if(tt.alternate===null)throw Error(p(340));Ig()}return j=tt.flags,j&65536?(tt.flags=j&-65537|128,tt):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(tt.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(j,tt){var st=j.ref;if(st!==null)if(typeof st=="function")try{st(null)}catch(b){W(j,tt,b)}else st.current=null}function Nj(j,tt,st){try{st()}catch(b){W(j,tt,b)}}var Oj=!1;function Pj(j,tt){if(Cf=dd,j=Me(),Ne(j)){if("selectionStart"in j)var st={start:j.selectionStart,end:j.selectionEnd};else e:{st=(st=j.ownerDocument)&&st.defaultView||window;var b=st.getSelection&&st.getSelection();if(b&&b.rangeCount!==0){st=b.anchorNode;var yt=b.anchorOffset,Et=b.focusNode;b=b.focusOffset;try{st.nodeType,Et.nodeType}catch{st=null;break e}var kt=0,Gt=-1,Vt=-1,an=0,Pn=0,mn=j,hn=null;t:for(;;){for(var wn;mn!==st||yt!==0&&mn.nodeType!==3||(Gt=kt+yt),mn!==Et||b!==0&&mn.nodeType!==3||(Vt=kt+b),mn.nodeType===3&&(kt+=mn.nodeValue.length),(wn=mn.firstChild)!==null;)hn=mn,mn=wn;for(;;){if(mn===j)break t;if(hn===st&&++an===yt&&(Gt=kt),hn===Et&&++Pn===b&&(Vt=kt),(wn=mn.nextSibling)!==null)break;mn=hn,hn=mn.parentNode}mn=wn}st=Gt===-1||Vt===-1?null:{start:Gt,end:Vt}}else st=null}st=st||{start:0,end:0}}else st=null;for(Df={focusedElem:j,selectionRange:st},dd=!1,V=tt;V!==null;)if(tt=V,j=tt.child,(tt.subtreeFlags&1028)!==0&&j!==null)j.return=tt,V=j;else for(;V!==null;){tt=V;try{var _n=tt.alternate;if(tt.flags&1024)switch(tt.tag){case 0:case 11:case 15:break;case 1:if(_n!==null){var $t=_n.memoizedProps,bn=_n.memoizedState,Nt=tt.stateNode,jt=Nt.getSnapshotBeforeUpdate(tt.elementType===tt.type?$t:Lg(tt.type,$t),bn);Nt.__reactInternalSnapshotBeforeUpdate=jt}break;case 3:var Yt=tt.stateNode.containerInfo;Yt.nodeType===1?Yt.textContent="":Yt.nodeType===9&&Yt.documentElement&&Yt.removeChild(Yt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Bn){W(tt,tt.return,Bn)}if(j=tt.sibling,j!==null){j.return=tt.return,V=j;break}V=tt.return}return _n=Oj,Oj=!1,_n}function Qj(j,tt,st){var b=tt.updateQueue;if(b=b!==null?b.lastEffect:null,b!==null){var yt=b=b.next;do{if((yt.tag&j)===j){var Et=yt.destroy;yt.destroy=void 0,Et!==void 0&&Nj(tt,st,Et)}yt=yt.next}while(yt!==b)}}function Rj(j,tt){if(tt=tt.updateQueue,tt=tt!==null?tt.lastEffect:null,tt!==null){var st=tt=tt.next;do{if((st.tag&j)===j){var b=st.create;st.destroy=b()}st=st.next}while(st!==tt)}}function Sj(j){var tt=j.ref;if(tt!==null){var st=j.stateNode;switch(j.tag){case 5:j=st;break;default:j=st}typeof tt=="function"?tt(j):tt.current=j}}function Tj(j){var tt=j.alternate;tt!==null&&(j.alternate=null,Tj(tt)),j.child=null,j.deletions=null,j.sibling=null,j.tag===5&&(tt=j.stateNode,tt!==null&&(delete tt[Of],delete tt[Pf],delete tt[of],delete tt[Qf],delete tt[Rf])),j.stateNode=null,j.return=null,j.dependencies=null,j.memoizedProps=null,j.memoizedState=null,j.pendingProps=null,j.stateNode=null,j.updateQueue=null}function Uj(j){return j.tag===5||j.tag===3||j.tag===4}function Vj(j){e:for(;;){for(;j.sibling===null;){if(j.return===null||Uj(j.return))return null;j=j.return}for(j.sibling.return=j.return,j=j.sibling;j.tag!==5&&j.tag!==6&&j.tag!==18;){if(j.flags&2||j.child===null||j.tag===4)continue e;j.child.return=j,j=j.child}if(!(j.flags&2))return j.stateNode}}function Wj(j,tt,st){var b=j.tag;if(b===5||b===6)j=j.stateNode,tt?st.nodeType===8?st.parentNode.insertBefore(j,tt):st.insertBefore(j,tt):(st.nodeType===8?(tt=st.parentNode,tt.insertBefore(j,st)):(tt=st,tt.appendChild(j)),st=st._reactRootContainer,st!=null||tt.onclick!==null||(tt.onclick=Bf));else if(b!==4&&(j=j.child,j!==null))for(Wj(j,tt,st),j=j.sibling;j!==null;)Wj(j,tt,st),j=j.sibling}function Xj(j,tt,st){var b=j.tag;if(b===5||b===6)j=j.stateNode,tt?st.insertBefore(j,tt):st.appendChild(j);else if(b!==4&&(j=j.child,j!==null))for(Xj(j,tt,st),j=j.sibling;j!==null;)Xj(j,tt,st),j=j.sibling}var X=null,Yj=!1;function Zj(j,tt,st){for(st=st.child;st!==null;)ak(j,tt,st),st=st.sibling}function ak(j,tt,st){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,st)}catch{}switch(st.tag){case 5:U||Mj(st,tt);case 6:var b=X,yt=Yj;X=null,Zj(j,tt,st),X=b,Yj=yt,X!==null&&(Yj?(j=X,st=st.stateNode,j.nodeType===8?j.parentNode.removeChild(st):j.removeChild(st)):X.removeChild(st.stateNode));break;case 18:X!==null&&(Yj?(j=X,st=st.stateNode,j.nodeType===8?Kf(j.parentNode,st):j.nodeType===1&&Kf(j,st),bd(j)):Kf(X,st.stateNode));break;case 4:b=X,yt=Yj,X=st.stateNode.containerInfo,Yj=!0,Zj(j,tt,st),X=b,Yj=yt;break;case 0:case 11:case 14:case 15:if(!U&&(b=st.updateQueue,b!==null&&(b=b.lastEffect,b!==null))){yt=b=b.next;do{var Et=yt,kt=Et.destroy;Et=Et.tag,kt!==void 0&&(Et&2||Et&4)&&Nj(st,tt,kt),yt=yt.next}while(yt!==b)}Zj(j,tt,st);break;case 1:if(!U&&(Mj(st,tt),b=st.stateNode,typeof b.componentWillUnmount=="function"))try{b.props=st.memoizedProps,b.state=st.memoizedState,b.componentWillUnmount()}catch(Gt){W(st,tt,Gt)}Zj(j,tt,st);break;case 21:Zj(j,tt,st);break;case 22:st.mode&1?(U=(b=U)||st.memoizedState!==null,Zj(j,tt,st),U=b):Zj(j,tt,st);break;default:Zj(j,tt,st)}}function bk(j){var tt=j.updateQueue;if(tt!==null){j.updateQueue=null;var st=j.stateNode;st===null&&(st=j.stateNode=new Lj),tt.forEach(function(b){var yt=ck.bind(null,j,b);st.has(b)||(st.add(b),b.then(yt,yt))})}}function dk(j,tt){var st=tt.deletions;if(st!==null)for(var b=0;b<st.length;b++){var yt=st[b];try{var Et=j,kt=tt,Gt=kt;e:for(;Gt!==null;){switch(Gt.tag){case 5:X=Gt.stateNode,Yj=!1;break e;case 3:X=Gt.stateNode.containerInfo,Yj=!0;break e;case 4:X=Gt.stateNode.containerInfo,Yj=!0;break e}Gt=Gt.return}if(X===null)throw Error(p(160));ak(Et,kt,yt),X=null,Yj=!1;var Vt=yt.alternate;Vt!==null&&(Vt.return=null),yt.return=null}catch(an){W(yt,tt,an)}}if(tt.subtreeFlags&12854)for(tt=tt.child;tt!==null;)ek(tt,j),tt=tt.sibling}function ek(j,tt){var st=j.alternate,b=j.flags;switch(j.tag){case 0:case 11:case 14:case 15:if(dk(tt,j),fk(j),b&4){try{Qj(3,j,j.return),Rj(3,j)}catch($t){W(j,j.return,$t)}try{Qj(5,j,j.return)}catch($t){W(j,j.return,$t)}}break;case 1:dk(tt,j),fk(j),b&512&&st!==null&&Mj(st,st.return);break;case 5:if(dk(tt,j),fk(j),b&512&&st!==null&&Mj(st,st.return),j.flags&32){var yt=j.stateNode;try{ob(yt,"")}catch($t){W(j,j.return,$t)}}if(b&4&&(yt=j.stateNode,yt!=null)){var Et=j.memoizedProps,kt=st!==null?st.memoizedProps:Et,Gt=j.type,Vt=j.updateQueue;if(j.updateQueue=null,Vt!==null)try{Gt==="input"&&Et.type==="radio"&&Et.name!=null&&ab(yt,Et),vb(Gt,kt);var an=vb(Gt,Et);for(kt=0;kt<Vt.length;kt+=2){var Pn=Vt[kt],mn=Vt[kt+1];Pn==="style"?sb(yt,mn):Pn==="dangerouslySetInnerHTML"?nb(yt,mn):Pn==="children"?ob(yt,mn):ta(yt,Pn,mn,an)}switch(Gt){case"input":bb(yt,Et);break;case"textarea":ib(yt,Et);break;case"select":var hn=yt._wrapperState.wasMultiple;yt._wrapperState.wasMultiple=!!Et.multiple;var wn=Et.value;wn!=null?fb(yt,!!Et.multiple,wn,!1):hn!==!!Et.multiple&&(Et.defaultValue!=null?fb(yt,!!Et.multiple,Et.defaultValue,!0):fb(yt,!!Et.multiple,Et.multiple?[]:"",!1))}yt[Pf]=Et}catch($t){W(j,j.return,$t)}}break;case 6:if(dk(tt,j),fk(j),b&4){if(j.stateNode===null)throw Error(p(162));yt=j.stateNode,Et=j.memoizedProps;try{yt.nodeValue=Et}catch($t){W(j,j.return,$t)}}break;case 3:if(dk(tt,j),fk(j),b&4&&st!==null&&st.memoizedState.isDehydrated)try{bd(tt.containerInfo)}catch($t){W(j,j.return,$t)}break;case 4:dk(tt,j),fk(j);break;case 13:dk(tt,j),fk(j),yt=j.child,yt.flags&8192&&(Et=yt.memoizedState!==null,yt.stateNode.isHidden=Et,!Et||yt.alternate!==null&&yt.alternate.memoizedState!==null||(gk=B())),b&4&&bk(j);break;case 22:if(Pn=st!==null&&st.memoizedState!==null,j.mode&1?(U=(an=U)||Pn,dk(tt,j),U=an):dk(tt,j),fk(j),b&8192){if(an=j.memoizedState!==null,(j.stateNode.isHidden=an)&&!Pn&&j.mode&1)for(V=j,Pn=j.child;Pn!==null;){for(mn=V=Pn;V!==null;){switch(hn=V,wn=hn.child,hn.tag){case 0:case 11:case 14:case 15:Qj(4,hn,hn.return);break;case 1:Mj(hn,hn.return);var _n=hn.stateNode;if(typeof _n.componentWillUnmount=="function"){b=hn,st=hn.return;try{tt=b,_n.props=tt.memoizedProps,_n.state=tt.memoizedState,_n.componentWillUnmount()}catch($t){W(b,st,$t)}}break;case 5:Mj(hn,hn.return);break;case 22:if(hn.memoizedState!==null){hk(mn);continue}}wn!==null?(wn.return=hn,V=wn):hk(mn)}Pn=Pn.sibling}e:for(Pn=null,mn=j;;){if(mn.tag===5){if(Pn===null){Pn=mn;try{yt=mn.stateNode,an?(Et=yt.style,typeof Et.setProperty=="function"?Et.setProperty("display","none","important"):Et.display="none"):(Gt=mn.stateNode,Vt=mn.memoizedProps.style,kt=Vt!=null&&Vt.hasOwnProperty("display")?Vt.display:null,Gt.style.display=rb("display",kt))}catch($t){W(j,j.return,$t)}}}else if(mn.tag===6){if(Pn===null)try{mn.stateNode.nodeValue=an?"":mn.memoizedProps}catch($t){W(j,j.return,$t)}}else if((mn.tag!==22&&mn.tag!==23||mn.memoizedState===null||mn===j)&&mn.child!==null){mn.child.return=mn,mn=mn.child;continue}if(mn===j)break e;for(;mn.sibling===null;){if(mn.return===null||mn.return===j)break e;Pn===mn&&(Pn=null),mn=mn.return}Pn===mn&&(Pn=null),mn.sibling.return=mn.return,mn=mn.sibling}}break;case 19:dk(tt,j),fk(j),b&4&&bk(j);break;case 21:break;default:dk(tt,j),fk(j)}}function fk(j){var tt=j.flags;if(tt&2){try{e:{for(var st=j.return;st!==null;){if(Uj(st)){var b=st;break e}st=st.return}throw Error(p(160))}switch(b.tag){case 5:var yt=b.stateNode;b.flags&32&&(ob(yt,""),b.flags&=-33);var Et=Vj(j);Xj(j,Et,yt);break;case 3:case 4:var kt=b.stateNode.containerInfo,Gt=Vj(j);Wj(j,Gt,kt);break;default:throw Error(p(161))}}catch(Vt){W(j,j.return,Vt)}j.flags&=-3}tt&4096&&(j.flags&=-4097)}function ik(j,tt,st){V=j,jk(j)}function jk(j,tt,st){for(var b=(j.mode&1)!==0;V!==null;){var yt=V,Et=yt.child;if(yt.tag===22&&b){var kt=yt.memoizedState!==null||Kj;if(!kt){var Gt=yt.alternate,Vt=Gt!==null&&Gt.memoizedState!==null||U;Gt=Kj;var an=U;if(Kj=kt,(U=Vt)&&!an)for(V=yt;V!==null;)kt=V,Vt=kt.child,kt.tag===22&&kt.memoizedState!==null?kk(yt):Vt!==null?(Vt.return=kt,V=Vt):kk(yt);for(;Et!==null;)V=Et,jk(Et),Et=Et.sibling;V=yt,Kj=Gt,U=an}lk(j)}else yt.subtreeFlags&8772&&Et!==null?(Et.return=yt,V=Et):lk(j)}}function lk(j){for(;V!==null;){var tt=V;if(tt.flags&8772){var st=tt.alternate;try{if(tt.flags&8772)switch(tt.tag){case 0:case 11:case 15:U||Rj(5,tt);break;case 1:var b=tt.stateNode;if(tt.flags&4&&!U)if(st===null)b.componentDidMount();else{var yt=tt.elementType===tt.type?st.memoizedProps:Lg(tt.type,st.memoizedProps);b.componentDidUpdate(yt,st.memoizedState,b.__reactInternalSnapshotBeforeUpdate)}var Et=tt.updateQueue;Et!==null&&ih(tt,Et,b);break;case 3:var kt=tt.updateQueue;if(kt!==null){if(st=null,tt.child!==null)switch(tt.child.tag){case 5:st=tt.child.stateNode;break;case 1:st=tt.child.stateNode}ih(tt,kt,st)}break;case 5:var Gt=tt.stateNode;if(st===null&&tt.flags&4){st=Gt;var Vt=tt.memoizedProps;switch(tt.type){case"button":case"input":case"select":case"textarea":Vt.autoFocus&&st.focus();break;case"img":Vt.src&&(st.src=Vt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(tt.memoizedState===null){var an=tt.alternate;if(an!==null){var Pn=an.memoizedState;if(Pn!==null){var mn=Pn.dehydrated;mn!==null&&bd(mn)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||tt.flags&512&&Sj(tt)}catch(hn){W(tt,tt.return,hn)}}if(tt===j){V=null;break}if(st=tt.sibling,st!==null){st.return=tt.return,V=st;break}V=tt.return}}function hk(j){for(;V!==null;){var tt=V;if(tt===j){V=null;break}var st=tt.sibling;if(st!==null){st.return=tt.return,V=st;break}V=tt.return}}function kk(j){for(;V!==null;){var tt=V;try{switch(tt.tag){case 0:case 11:case 15:var st=tt.return;try{Rj(4,tt)}catch(Vt){W(tt,st,Vt)}break;case 1:var b=tt.stateNode;if(typeof b.componentDidMount=="function"){var yt=tt.return;try{b.componentDidMount()}catch(Vt){W(tt,yt,Vt)}}var Et=tt.return;try{Sj(tt)}catch(Vt){W(tt,Et,Vt)}break;case 5:var kt=tt.return;try{Sj(tt)}catch(Vt){W(tt,kt,Vt)}}}catch(Vt){W(tt,tt.return,Vt)}if(tt===j){V=null;break}var Gt=tt.sibling;if(Gt!==null){Gt.return=tt.return,V=Gt;break}V=tt.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(j){return j.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(j=C,j!==0||(j=window.event,j=j===void 0?16:jd(j.type)),j):1}function mh(j,tt,st,b){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(j,st,b),(!(K&2)||j!==R)&&(j===R&&(!(K&2)&&(rk|=st),T===4&&Dk(j,Z)),Ek(j,b),st===1&&K===0&&!(tt.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(j,tt){var st=j.callbackNode;wc(j,tt);var b=uc(j,j===R?Z:0);if(b===0)st!==null&&bc(st),j.callbackNode=null,j.callbackPriority=0;else if(tt=b&-b,j.callbackPriority!==tt){if(st!=null&&bc(st),tt===1)j.tag===0?ig(Fk.bind(null,j)):hg(Fk.bind(null,j)),Jf(function(){!(K&6)&&jg()}),st=null;else{switch(Dc(b)){case 1:st=fc;break;case 4:st=gc;break;case 16:st=hc;break;case 536870912:st=jc;break;default:st=hc}st=Gk(st,Hk.bind(null,j))}j.callbackPriority=tt,j.callbackNode=st}}function Hk(j,tt){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var st=j.callbackNode;if(Ik()&&j.callbackNode!==st)return null;var b=uc(j,j===R?Z:0);if(b===0)return null;if(b&30||b&j.expiredLanes||tt)tt=Jk(j,b);else{tt=b;var yt=K;K|=2;var Et=Kk();(R!==j||Z!==tt)&&(vk=null,Hj=B()+500,Lk(j,tt));do try{Mk();break}catch(Gt){Nk(j,Gt)}while(1);Qg(),nk.current=Et,K=yt,Y!==null?tt=0:(R=null,Z=0,tt=T)}if(tt!==0){if(tt===2&&(yt=xc(j),yt!==0&&(b=yt,tt=Ok(j,yt))),tt===1)throw st=qk,Lk(j,0),Dk(j,b),Ek(j,B()),st;if(tt===6)Dk(j,b);else{if(yt=j.current.alternate,!(b&30)&&!Pk(yt)&&(tt=Jk(j,b),tt===2&&(Et=xc(j),Et!==0&&(b=Et,tt=Ok(j,Et))),tt===1))throw st=qk,Lk(j,0),Dk(j,b),Ek(j,B()),st;switch(j.finishedWork=yt,j.finishedLanes=b,tt){case 0:case 1:throw Error(p(345));case 2:Qk(j,uk,vk);break;case 3:if(Dk(j,b),(b&130023424)===b&&(tt=gk+500-B(),10<tt)){if(uc(j,0)!==0)break;if(yt=j.suspendedLanes,(yt&b)!==b){L(),j.pingedLanes|=j.suspendedLanes&yt;break}j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),tt);break}Qk(j,uk,vk);break;case 4:if(Dk(j,b),(b&4194240)===b)break;for(tt=j.eventTimes,yt=-1;0<b;){var kt=31-oc(b);Et=1<<kt,kt=tt[kt],kt>yt&&(yt=kt),b&=~Et}if(b=yt,b=B()-b,b=(120>b?120:480>b?480:1080>b?1080:1920>b?1920:3e3>b?3e3:4320>b?4320:1960*mk(b/1960))-b,10<b){j.timeoutHandle=Ff(Qk.bind(null,j,uk,vk),b);break}Qk(j,uk,vk);break;case 5:Qk(j,uk,vk);break;default:throw Error(p(329))}}}return Ek(j,B()),j.callbackNode===st?Hk.bind(null,j):null}function Ok(j,tt){var st=tk;return j.current.memoizedState.isDehydrated&&(Lk(j,tt).flags|=256),j=Jk(j,tt),j!==2&&(tt=uk,uk=st,tt!==null&&Gj(tt)),j}function Gj(j){uk===null?uk=j:uk.push.apply(uk,j)}function Pk(j){for(var tt=j;;){if(tt.flags&16384){var st=tt.updateQueue;if(st!==null&&(st=st.stores,st!==null))for(var b=0;b<st.length;b++){var yt=st[b],Et=yt.getSnapshot;yt=yt.value;try{if(!He(Et(),yt))return!1}catch{return!1}}}if(st=tt.child,tt.subtreeFlags&16384&&st!==null)st.return=tt,tt=st;else{if(tt===j)break;for(;tt.sibling===null;){if(tt.return===null||tt.return===j)return!0;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}}return!0}function Dk(j,tt){for(tt&=~sk,tt&=~rk,j.suspendedLanes|=tt,j.pingedLanes&=~tt,j=j.expirationTimes;0<tt;){var st=31-oc(tt),b=1<<st;j[st]=-1,tt&=~b}}function Fk(j){if(K&6)throw Error(p(327));Ik();var tt=uc(j,0);if(!(tt&1))return Ek(j,B()),null;var st=Jk(j,tt);if(j.tag!==0&&st===2){var b=xc(j);b!==0&&(tt=b,st=Ok(j,b))}if(st===1)throw st=qk,Lk(j,0),Dk(j,tt),Ek(j,B()),st;if(st===6)throw Error(p(345));return j.finishedWork=j.current.alternate,j.finishedLanes=tt,Qk(j,uk,vk),Ek(j,B()),null}function Rk(j,tt){var st=K;K|=1;try{return j(tt)}finally{K=st,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(j){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var tt=K;K|=1;var st=pk.transition,b=C;try{if(pk.transition=null,C=1,j)return j()}finally{C=b,pk.transition=st,K=tt,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(j,tt){j.finishedWork=null,j.finishedLanes=0;var st=j.timeoutHandle;if(st!==-1&&(j.timeoutHandle=-1,Gf(st)),Y!==null)for(st=Y.return;st!==null;){var b=st;switch(wg(b),b.tag){case 1:b=b.type.childContextTypes,b!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(b);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(b.type._context);break;case 22:case 23:Ij()}st=st.return}if(R=j,Y=j=wh(j.current,null),Z=gj=tt,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(tt=0;tt<Wg.length;tt++)if(st=Wg[tt],b=st.interleaved,b!==null){st.interleaved=null;var yt=b.next,Et=st.pending;if(Et!==null){var kt=Et.next;Et.next=yt,b.next=kt}st.pending=b}Wg=null}return j}function Nk(j,tt){do{var st=Y;try{if(Qg(),Ph.current=ai,Sh){for(var b=N.memoizedState;b!==null;){var yt=b.queue;yt!==null&&(yt.pending=null),b=b.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,st===null||st.return===null){T=1,qk=tt,Y=null;break}e:{var Et=j,kt=st.return,Gt=st,Vt=tt;if(tt=Z,Gt.flags|=32768,Vt!==null&&typeof Vt=="object"&&typeof Vt.then=="function"){var an=Vt,Pn=Gt,mn=Pn.tag;if(!(Pn.mode&1)&&(mn===0||mn===11||mn===15)){var hn=Pn.alternate;hn?(Pn.updateQueue=hn.updateQueue,Pn.memoizedState=hn.memoizedState,Pn.lanes=hn.lanes):(Pn.updateQueue=null,Pn.memoizedState=null)}var wn=Vi(kt);if(wn!==null){wn.flags&=-257,Wi(wn,kt,Gt,Et,tt),wn.mode&1&&Ti(Et,an,tt),tt=wn,Vt=an;var _n=tt.updateQueue;if(_n===null){var $t=new Set;$t.add(Vt),tt.updateQueue=$t}else _n.add(Vt);break e}else{if(!(tt&1)){Ti(Et,an,tt),uj();break e}Vt=Error(p(426))}}else if(I&&Gt.mode&1){var bn=Vi(kt);if(bn!==null){!(bn.flags&65536)&&(bn.flags|=256),Wi(bn,kt,Gt,Et,tt),Jg(Ki(Vt,Gt));break e}}Et=Vt=Ki(Vt,Gt),T!==4&&(T=2),tk===null?tk=[Et]:tk.push(Et),Et=kt;do{switch(Et.tag){case 3:Et.flags|=65536,tt&=-tt,Et.lanes|=tt;var Nt=Oi(Et,Vt,tt);fh(Et,Nt);break e;case 1:Gt=Vt;var jt=Et.type,Yt=Et.stateNode;if(!(Et.flags&128)&&(typeof jt.getDerivedStateFromError=="function"||Yt!==null&&typeof Yt.componentDidCatch=="function"&&(Si===null||!Si.has(Yt)))){Et.flags|=65536,tt&=-tt,Et.lanes|=tt;var Bn=Ri(Et,Gt,tt);fh(Et,Bn);break e}}Et=Et.return}while(Et!==null)}Tk(st)}catch(un){tt=un,Y===st&&st!==null&&(Y=st=st.return);continue}break}while(1)}function Kk(){var j=nk.current;return nk.current=ai,j===null?ai:j}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(j,tt){var st=K;K|=2;var b=Kk();(R!==j||Z!==tt)&&(vk=null,Lk(j,tt));do try{Uk();break}catch(yt){Nk(j,yt)}while(1);if(Qg(),K=st,nk.current=b,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(j){var tt=Wk(j.alternate,j,gj);j.memoizedProps=j.pendingProps,tt===null?Tk(j):Y=tt,ok.current=null}function Tk(j){var tt=j;do{var st=tt.alternate;if(j=tt.return,tt.flags&32768){if(st=Jj(st,tt),st!==null){st.flags&=32767,Y=st;return}if(j!==null)j.flags|=32768,j.subtreeFlags=0,j.deletions=null;else{T=6,Y=null;return}}else if(st=Fj(st,tt,gj),st!==null){Y=st;return}if(tt=tt.sibling,tt!==null){Y=tt;return}Y=tt=j}while(tt!==null);T===0&&(T=5)}function Qk(j,tt,st){var b=C,yt=pk.transition;try{pk.transition=null,C=1,Xk(j,tt,st,b)}finally{pk.transition=yt,C=b}return null}function Xk(j,tt,st,b){do Ik();while(xk!==null);if(K&6)throw Error(p(327));st=j.finishedWork;var yt=j.finishedLanes;if(st===null)return null;if(j.finishedWork=null,j.finishedLanes=0,st===j.current)throw Error(p(177));j.callbackNode=null,j.callbackPriority=0;var Et=st.lanes|st.childLanes;if(Bc(j,Et),j===R&&(Y=R=null,Z=0),!(st.subtreeFlags&2064)&&!(st.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),Et=(st.flags&15990)!==0,st.subtreeFlags&15990||Et){Et=pk.transition,pk.transition=null;var kt=C;C=1;var Gt=K;K|=4,ok.current=null,Pj(j,st),ek(st,j),Oe(Df),dd=!!Cf,Df=Cf=null,j.current=st,ik(st),dc(),K=Gt,C=kt,pk.transition=Et}else j.current=st;if(wk&&(wk=!1,xk=j,yk=yt),Et=j.pendingLanes,Et===0&&(Si=null),mc(st.stateNode),Ek(j,B()),tt!==null)for(b=j.onRecoverableError,st=0;st<tt.length;st++)yt=tt[st],b(yt.value,{componentStack:yt.stack,digest:yt.digest});if(Pi)throw Pi=!1,j=Qi,Qi=null,j;return yk&1&&j.tag!==0&&Ik(),Et=j.pendingLanes,Et&1?j===Ak?zk++:(zk=0,Ak=j):zk=0,jg(),null}function Ik(){if(xk!==null){var j=Dc(yk),tt=pk.transition,st=C;try{if(pk.transition=null,C=16>j?16:j,xk===null)var b=!1;else{if(j=xk,xk=null,yk=0,K&6)throw Error(p(331));var yt=K;for(K|=4,V=j.current;V!==null;){var Et=V,kt=Et.child;if(V.flags&16){var Gt=Et.deletions;if(Gt!==null){for(var Vt=0;Vt<Gt.length;Vt++){var an=Gt[Vt];for(V=an;V!==null;){var Pn=V;switch(Pn.tag){case 0:case 11:case 15:Qj(8,Pn,Et)}var mn=Pn.child;if(mn!==null)mn.return=Pn,V=mn;else for(;V!==null;){Pn=V;var hn=Pn.sibling,wn=Pn.return;if(Tj(Pn),Pn===an){V=null;break}if(hn!==null){hn.return=wn,V=hn;break}V=wn}}}var _n=Et.alternate;if(_n!==null){var $t=_n.child;if($t!==null){_n.child=null;do{var bn=$t.sibling;$t.sibling=null,$t=bn}while($t!==null)}}V=Et}}if(Et.subtreeFlags&2064&&kt!==null)kt.return=Et,V=kt;else e:for(;V!==null;){if(Et=V,Et.flags&2048)switch(Et.tag){case 0:case 11:case 15:Qj(9,Et,Et.return)}var Nt=Et.sibling;if(Nt!==null){Nt.return=Et.return,V=Nt;break e}V=Et.return}}var jt=j.current;for(V=jt;V!==null;){kt=V;var Yt=kt.child;if(kt.subtreeFlags&2064&&Yt!==null)Yt.return=kt,V=Yt;else e:for(kt=jt;V!==null;){if(Gt=V,Gt.flags&2048)try{switch(Gt.tag){case 0:case 11:case 15:Rj(9,Gt)}}catch(un){W(Gt,Gt.return,un)}if(Gt===kt){V=null;break e}var Bn=Gt.sibling;if(Bn!==null){Bn.return=Gt.return,V=Bn;break e}V=Gt.return}}if(K=yt,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,j)}catch{}b=!0}return b}finally{C=st,pk.transition=tt}}return!1}function Yk(j,tt,st){tt=Ki(st,tt),tt=Oi(j,tt,1),j=dh(j,tt,1),tt=L(),j!==null&&(Ac(j,1,tt),Ek(j,tt))}function W(j,tt,st){if(j.tag===3)Yk(j,j,st);else for(;tt!==null;){if(tt.tag===3){Yk(tt,j,st);break}else if(tt.tag===1){var b=tt.stateNode;if(typeof tt.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Si===null||!Si.has(b))){j=Ki(st,j),j=Ri(tt,j,1),tt=dh(tt,j,1),j=L(),tt!==null&&(Ac(tt,1,j),Ek(tt,j));break}}tt=tt.return}}function Ui(j,tt,st){var b=j.pingCache;b!==null&&b.delete(tt),tt=L(),j.pingedLanes|=j.suspendedLanes&st,R===j&&(Z&st)===st&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(j,0):sk|=st),Ek(j,tt)}function Zk(j,tt){tt===0&&(j.mode&1?(tt=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):tt=1);var st=L();j=Zg(j,tt),j!==null&&(Ac(j,tt,st),Ek(j,st))}function vj(j){var tt=j.memoizedState,st=0;tt!==null&&(st=tt.retryLane),Zk(j,st)}function ck(j,tt){var st=0;switch(j.tag){case 13:var b=j.stateNode,yt=j.memoizedState;yt!==null&&(st=yt.retryLane);break;case 19:b=j.stateNode;break;default:throw Error(p(314))}b!==null&&b.delete(tt),Zk(j,st)}var Wk;Wk=function(j,tt,st){if(j!==null)if(j.memoizedProps!==tt.pendingProps||Wf.current)Ug=!0;else{if(!(j.lanes&st)&&!(tt.flags&128))return Ug=!1,zj(j,tt,st);Ug=!!(j.flags&131072)}else Ug=!1,I&&tt.flags&1048576&&ug(tt,ng,tt.index);switch(tt.lanes=0,tt.tag){case 2:var b=tt.type;jj(j,tt),j=tt.pendingProps;var yt=Yf(tt,H.current);Tg(tt,st),yt=Xh(null,tt,b,j,yt,st);var Et=bi();return tt.flags|=1,typeof yt=="object"&&yt!==null&&typeof yt.render=="function"&&yt.$$typeof===void 0?(tt.tag=1,tt.memoizedState=null,tt.updateQueue=null,Zf(b)?(Et=!0,cg(tt)):Et=!1,tt.memoizedState=yt.state!==null&&yt.state!==void 0?yt.state:null,ah(tt),yt.updater=nh,tt.stateNode=yt,yt._reactInternals=tt,rh(tt,b,j,st),tt=kj(null,tt,b,!0,Et,st)):(tt.tag=0,I&&Et&&vg(tt),Yi(null,tt,yt,st),tt=tt.child),tt;case 16:b=tt.elementType;e:{switch(jj(j,tt),j=tt.pendingProps,yt=b._init,b=yt(b._payload),tt.type=b,yt=tt.tag=$k(b),j=Lg(b,j),yt){case 0:tt=dj(null,tt,b,j,st);break e;case 1:tt=ij(null,tt,b,j,st);break e;case 11:tt=Zi(null,tt,b,j,st);break e;case 14:tt=aj(null,tt,b,Lg(b.type,j),st);break e}throw Error(p(306,b,""))}return tt;case 0:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),dj(j,tt,b,yt,st);case 1:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),ij(j,tt,b,yt,st);case 3:e:{if(lj(tt),j===null)throw Error(p(387));b=tt.pendingProps,Et=tt.memoizedState,yt=Et.element,bh(j,tt),gh(tt,b,null,st);var kt=tt.memoizedState;if(b=kt.element,Et.isDehydrated)if(Et={element:b,isDehydrated:!1,cache:kt.cache,pendingSuspenseBoundaries:kt.pendingSuspenseBoundaries,transitions:kt.transitions},tt.updateQueue.baseState=Et,tt.memoizedState=Et,tt.flags&256){yt=Ki(Error(p(423)),tt),tt=mj(j,tt,b,st,yt);break e}else if(b!==yt){yt=Ki(Error(p(424)),tt),tt=mj(j,tt,b,st,yt);break e}else for(yg=Lf(tt.stateNode.containerInfo.firstChild),xg=tt,I=!0,zg=null,st=Ch(tt,null,b,st),tt.child=st;st;)st.flags=st.flags&-3|4096,st=st.sibling;else{if(Ig(),b===yt){tt=$i(j,tt,st);break e}Yi(j,tt,b,st)}tt=tt.child}return tt;case 5:return Kh(tt),j===null&&Eg(tt),b=tt.type,yt=tt.pendingProps,Et=j!==null?j.memoizedProps:null,kt=yt.children,Ef(b,yt)?kt=null:Et!==null&&Ef(b,Et)&&(tt.flags|=32),hj(j,tt),Yi(j,tt,kt,st),tt.child;case 6:return j===null&&Eg(tt),null;case 13:return pj(j,tt,st);case 4:return Ih(tt,tt.stateNode.containerInfo),b=tt.pendingProps,j===null?tt.child=Bh(tt,null,b,st):Yi(j,tt,b,st),tt.child;case 11:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),Zi(j,tt,b,yt,st);case 7:return Yi(j,tt,tt.pendingProps,st),tt.child;case 8:return Yi(j,tt,tt.pendingProps.children,st),tt.child;case 12:return Yi(j,tt,tt.pendingProps.children,st),tt.child;case 10:e:{if(b=tt.type._context,yt=tt.pendingProps,Et=tt.memoizedProps,kt=yt.value,G(Mg,b._currentValue),b._currentValue=kt,Et!==null)if(He(Et.value,kt)){if(Et.children===yt.children&&!Wf.current){tt=$i(j,tt,st);break e}}else for(Et=tt.child,Et!==null&&(Et.return=tt);Et!==null;){var Gt=Et.dependencies;if(Gt!==null){kt=Et.child;for(var Vt=Gt.firstContext;Vt!==null;){if(Vt.context===b){if(Et.tag===1){Vt=ch(-1,st&-st),Vt.tag=2;var an=Et.updateQueue;if(an!==null){an=an.shared;var Pn=an.pending;Pn===null?Vt.next=Vt:(Vt.next=Pn.next,Pn.next=Vt),an.pending=Vt}}Et.lanes|=st,Vt=Et.alternate,Vt!==null&&(Vt.lanes|=st),Sg(Et.return,st,tt),Gt.lanes|=st;break}Vt=Vt.next}}else if(Et.tag===10)kt=Et.type===tt.type?null:Et.child;else if(Et.tag===18){if(kt=Et.return,kt===null)throw Error(p(341));kt.lanes|=st,Gt=kt.alternate,Gt!==null&&(Gt.lanes|=st),Sg(kt,st,tt),kt=Et.sibling}else kt=Et.child;if(kt!==null)kt.return=Et;else for(kt=Et;kt!==null;){if(kt===tt){kt=null;break}if(Et=kt.sibling,Et!==null){Et.return=kt.return,kt=Et;break}kt=kt.return}Et=kt}Yi(j,tt,yt.children,st),tt=tt.child}return tt;case 9:return yt=tt.type,b=tt.pendingProps.children,Tg(tt,st),yt=Vg(yt),b=b(yt),tt.flags|=1,Yi(j,tt,b,st),tt.child;case 14:return b=tt.type,yt=Lg(b,tt.pendingProps),yt=Lg(b.type,yt),aj(j,tt,b,yt,st);case 15:return cj(j,tt,tt.type,tt.pendingProps,st);case 17:return b=tt.type,yt=tt.pendingProps,yt=tt.elementType===b?yt:Lg(b,yt),jj(j,tt),tt.tag=1,Zf(b)?(j=!0,cg(tt)):j=!1,Tg(tt,st),ph(tt,b,yt),rh(tt,b,yt,st),kj(null,tt,b,!0,j,st);case 19:return yj(j,tt,st);case 22:return ej(j,tt,st)}throw Error(p(156,tt.tag))};function Gk(j,tt){return ac(j,tt)}function al(j,tt,st,b){this.tag=j,this.key=st,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=tt,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(j,tt,st,b){return new al(j,tt,st,b)}function bj(j){return j=j.prototype,!(!j||!j.isReactComponent)}function $k(j){if(typeof j=="function")return bj(j)?1:0;if(j!=null){if(j=j.$$typeof,j===Da)return 11;if(j===Ga)return 14}return 2}function wh(j,tt){var st=j.alternate;return st===null?(st=Bg(j.tag,tt,j.key,j.mode),st.elementType=j.elementType,st.type=j.type,st.stateNode=j.stateNode,st.alternate=j,j.alternate=st):(st.pendingProps=tt,st.type=j.type,st.flags=0,st.subtreeFlags=0,st.deletions=null),st.flags=j.flags&14680064,st.childLanes=j.childLanes,st.lanes=j.lanes,st.child=j.child,st.memoizedProps=j.memoizedProps,st.memoizedState=j.memoizedState,st.updateQueue=j.updateQueue,tt=j.dependencies,st.dependencies=tt===null?null:{lanes:tt.lanes,firstContext:tt.firstContext},st.sibling=j.sibling,st.index=j.index,st.ref=j.ref,st}function yh(j,tt,st,b,yt,Et){var kt=2;if(b=j,typeof j=="function")bj(j)&&(kt=1);else if(typeof j=="string")kt=5;else e:switch(j){case ya:return Ah(st.children,yt,Et,tt);case za:kt=8,yt|=8;break;case Aa:return j=Bg(12,st,tt,yt|2),j.elementType=Aa,j.lanes=Et,j;case Ea:return j=Bg(13,st,tt,yt),j.elementType=Ea,j.lanes=Et,j;case Fa:return j=Bg(19,st,tt,yt),j.elementType=Fa,j.lanes=Et,j;case Ia:return qj(st,yt,Et,tt);default:if(typeof j=="object"&&j!==null)switch(j.$$typeof){case Ba:kt=10;break e;case Ca:kt=9;break e;case Da:kt=11;break e;case Ga:kt=14;break e;case Ha:kt=16,b=null;break e}throw Error(p(130,j==null?j:typeof j,""))}return tt=Bg(kt,st,tt,yt),tt.elementType=j,tt.type=b,tt.lanes=Et,tt}function Ah(j,tt,st,b){return j=Bg(7,j,b,tt),j.lanes=st,j}function qj(j,tt,st,b){return j=Bg(22,j,b,tt),j.elementType=Ia,j.lanes=st,j.stateNode={isHidden:!1},j}function xh(j,tt,st){return j=Bg(6,j,null,tt),j.lanes=st,j}function zh(j,tt,st){return tt=Bg(4,j.children!==null?j.children:[],j.key,tt),tt.lanes=st,tt.stateNode={containerInfo:j.containerInfo,pendingChildren:null,implementation:j.implementation},tt}function bl(j,tt,st,b,yt){this.tag=tt,this.containerInfo=j,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=b,this.onRecoverableError=yt,this.mutableSourceEagerHydrationData=null}function cl(j,tt,st,b,yt,Et,kt,Gt,Vt){return j=new bl(j,tt,st,Gt,Vt),tt===1?(tt=1,Et===!0&&(tt|=8)):tt=0,Et=Bg(3,null,null,tt),j.current=Et,Et.stateNode=j,Et.memoizedState={element:b,isDehydrated:st,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(Et),j}function dl(j,tt,st){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:b==null?null:""+b,children:j,containerInfo:tt,implementation:st}}function el(j){if(!j)return Vf;j=j._reactInternals;e:{if(Vb(j)!==j||j.tag!==1)throw Error(p(170));var tt=j;do{switch(tt.tag){case 3:tt=tt.stateNode.context;break e;case 1:if(Zf(tt.type)){tt=tt.stateNode.__reactInternalMemoizedMergedChildContext;break e}}tt=tt.return}while(tt!==null);throw Error(p(171))}if(j.tag===1){var st=j.type;if(Zf(st))return bg(j,st,tt)}return tt}function fl(j,tt,st,b,yt,Et,kt,Gt,Vt){return j=cl(st,b,!0,j,yt,Et,kt,Gt,Vt),j.context=el(null),st=j.current,b=L(),yt=lh(st),Et=ch(b,yt),Et.callback=tt??null,dh(st,Et,yt),j.current.lanes=yt,Ac(j,yt,b),Ek(j,b),j}function gl(j,tt,st,b){var yt=tt.current,Et=L(),kt=lh(yt);return st=el(st),tt.context===null?tt.context=st:tt.pendingContext=st,tt=ch(Et,kt),tt.payload={element:j},b=b===void 0?null:b,b!==null&&(tt.callback=b),j=dh(yt,tt,kt),j!==null&&(mh(j,yt,kt,Et),eh(j,yt,kt)),kt}function hl(j){if(j=j.current,!j.child)return null;switch(j.child.tag){case 5:return j.child.stateNode;default:return j.child.stateNode}}function il(j,tt){if(j=j.memoizedState,j!==null&&j.dehydrated!==null){var st=j.retryLane;j.retryLane=st!==0&&st<tt?st:tt}}function jl(j,tt){il(j,tt),(j=j.alternate)&&il(j,tt)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(j){console.error(j)};function ml(j){this._internalRoot=j}nl.prototype.render=ml.prototype.render=function(j){var tt=this._internalRoot;if(tt===null)throw Error(p(409));gl(j,tt,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var j=this._internalRoot;if(j!==null){this._internalRoot=null;var tt=j.containerInfo;Sk(function(){gl(null,j,null,null)}),tt[uf]=null}};function nl(j){this._internalRoot=j}nl.prototype.unstable_scheduleHydration=function(j){if(j){var tt=Hc();j={blockedOn:null,target:j,priority:tt};for(var st=0;st<Qc.length&&tt!==0&&tt<Qc[st].priority;st++);Qc.splice(st,0,j),st===0&&Vc(j)}};function ol(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11)}function pl(j){return!(!j||j.nodeType!==1&&j.nodeType!==9&&j.nodeType!==11&&(j.nodeType!==8||j.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(j,tt,st,b,yt){if(yt){if(typeof b=="function"){var Et=b;b=function(){var an=hl(kt);Et.call(an)}}var kt=fl(tt,b,j,0,null,!1,!1,"",ql);return j._reactRootContainer=kt,j[uf]=kt.current,sf(j.nodeType===8?j.parentNode:j),Sk(),kt}for(;yt=j.lastChild;)j.removeChild(yt);if(typeof b=="function"){var Gt=b;b=function(){var an=hl(Vt);Gt.call(an)}}var Vt=cl(j,0,!1,null,null,!1,!1,"",ql);return j._reactRootContainer=Vt,j[uf]=Vt.current,sf(j.nodeType===8?j.parentNode:j),Sk(function(){gl(tt,Vt,st,b)}),Vt}function sl(j,tt,st,b,yt){var Et=st._reactRootContainer;if(Et){var kt=Et;if(typeof yt=="function"){var Gt=yt;yt=function(){var Vt=hl(kt);Gt.call(Vt)}}gl(tt,kt,j,yt)}else kt=rl(st,tt,j,yt,b);return hl(kt)}Ec=function(j){switch(j.tag){case 3:var tt=j.stateNode;if(tt.current.memoizedState.isDehydrated){var st=tc(tt.pendingLanes);st!==0&&(Cc(tt,st|1),Ek(tt,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var b=Zg(j,1);if(b!==null){var yt=L();mh(b,j,1,yt)}}),jl(j,1)}};Fc=function(j){if(j.tag===13){var tt=Zg(j,134217728);if(tt!==null){var st=L();mh(tt,j,134217728,st)}jl(j,134217728)}};Gc=function(j){if(j.tag===13){var tt=lh(j),st=Zg(j,tt);if(st!==null){var b=L();mh(st,j,tt,b)}jl(j,tt)}};Hc=function(){return C};Ic=function(j,tt){var st=C;try{return C=j,tt()}finally{C=st}};yb=function(j,tt,st){switch(tt){case"input":if(bb(j,st),tt=st.name,st.type==="radio"&&tt!=null){for(st=j;st.parentNode;)st=st.parentNode;for(st=st.querySelectorAll("input[name="+JSON.stringify(""+tt)+'][type="radio"]'),tt=0;tt<st.length;tt++){var b=st[tt];if(b!==j&&b.form===j.form){var yt=Db(b);if(!yt)throw Error(p(90));Wa(b),bb(b,yt)}}}break;case"textarea":ib(j,st);break;case"select":tt=st.value,tt!=null&&fb(j,!!st.multiple,tt,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(j){return j=Zb(j),j===null?null:j.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(j,tt){var st=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(tt))throw Error(p(200));return dl(j,tt,null,st)};reactDom_production_min.createRoot=function(j,tt){if(!ol(j))throw Error(p(299));var st=!1,b="",yt=ll;return tt!=null&&(tt.unstable_strictMode===!0&&(st=!0),tt.identifierPrefix!==void 0&&(b=tt.identifierPrefix),tt.onRecoverableError!==void 0&&(yt=tt.onRecoverableError)),tt=cl(j,1,!1,null,null,st,!1,b,yt),j[uf]=tt.current,sf(j.nodeType===8?j.parentNode:j),new ml(tt)};reactDom_production_min.findDOMNode=function(j){if(j==null)return null;if(j.nodeType===1)return j;var tt=j._reactInternals;if(tt===void 0)throw typeof j.render=="function"?Error(p(188)):(j=Object.keys(j).join(","),Error(p(268,j)));return j=Zb(tt),j=j===null?null:j.stateNode,j};reactDom_production_min.flushSync=function(j){return Sk(j)};reactDom_production_min.hydrate=function(j,tt,st){if(!pl(tt))throw Error(p(200));return sl(null,j,tt,!0,st)};reactDom_production_min.hydrateRoot=function(j,tt,st){if(!ol(j))throw Error(p(405));var b=st!=null&&st.hydratedSources||null,yt=!1,Et="",kt=ll;if(st!=null&&(st.unstable_strictMode===!0&&(yt=!0),st.identifierPrefix!==void 0&&(Et=st.identifierPrefix),st.onRecoverableError!==void 0&&(kt=st.onRecoverableError)),tt=fl(tt,null,j,1,st??null,yt,!1,Et,kt),j[uf]=tt.current,sf(j),b)for(j=0;j<b.length;j++)st=b[j],yt=st._getVersion,yt=yt(st._source),tt.mutableSourceEagerHydrationData==null?tt.mutableSourceEagerHydrationData=[st,yt]:tt.mutableSourceEagerHydrationData.push(st,yt);return new nl(tt)};reactDom_production_min.render=function(j,tt,st){if(!pl(tt))throw Error(p(200));return sl(null,j,tt,!1,st)};reactDom_production_min.unmountComponentAtNode=function(j){if(!pl(j))throw Error(p(40));return j._reactRootContainer?(Sk(function(){sl(null,null,j,!1,function(){j._reactRootContainer=null,j[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(j,tt,st,b){if(!pl(st))throw Error(p(200));if(j==null||j._reactInternals===void 0)throw Error(p(38));return sl(j,tt,st,!1,b)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";(function(j){function tt(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(tt)}catch(st){console.error(st)}}tt(),j.exports=reactDom_production_min})(reactDom);var m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;function Loader(){return jsx("div",{className:"loader",children:jsx("h2",{children:"Loading"})})}/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={798:function(j,tt,st){var b=st(352),yt=st.n(b)()(function(Et){return Et[1]});yt.push([j.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),tt.Z=yt},898:function(j,tt,st){var b=st(352),yt=st.n(b)()(function(Et){return Et[1]});yt.push([j.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),tt.Z=yt},513:function(j,tt,st){var b=st(352),yt=st.n(b)()(function(Et){return Et[1]});yt.push([j.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),tt.Z=yt},476:function(j){var tt;tt=function(){return function(st){var b={};function yt(Et){if(b[Et])return b[Et].exports;var kt=b[Et]={i:Et,l:!1,exports:{}};return st[Et].call(kt.exports,kt,kt.exports,yt),kt.l=!0,kt.exports}return yt.m=st,yt.c=b,yt.i=function(Et){return Et},yt.d=function(Et,kt,Gt){yt.o(Et,kt)||Object.defineProperty(Et,kt,{configurable:!1,enumerable:!0,get:Gt})},yt.n=function(Et){var kt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return yt.d(kt,"a",kt),kt},yt.o=function(Et,kt){return Object.prototype.hasOwnProperty.call(Et,kt)},yt.p="",yt(yt.s=5)}([function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et={convertToObject:function(kt){var Gt=kt.substring(kt.indexOf("{")+1).trim().slice(0,-1),Vt={};return Gt.split(";").map(function(an){if(an=an.trim()){var Pn=an.split(":");Vt[Pn[0].trim()]=Pn[1].trim()}}),Vt},getFromSheets:function(kt){var Gt=document.styleSheets;for(var Vt in Gt){var an=null;try{an=Gt[Vt].rules||Gt[Vt].cssRules}catch{}if(an){for(var Pn in an)if(an[Pn].selectorText&&an[Pn].selectorText.split(",").indexOf(kt)!=-1)return an[Pn].cssText?Et.convertToObject(an[Pn].cssText):Et.convertToObject(an[Pn].style.cssText)}}return{}},getPropertyDefault:function(kt){return kt=="timing-function"?"ease":kt=="iteration-count"?1:kt=="direction"?"normal":kt=="fill-mode"?"none":null}};b.default=Et},function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et={generateId:function(){for(var kt="",Gt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Vt=0;Vt<8;++Vt)kt+=Gt.charAt(Math.floor(Math.random()*Gt.length));return kt},frameToString:function(kt){var Gt="";for(var Vt in kt)Gt+=Vt+":"+kt[Vt]+";";return Gt},convertTimeToMs:function(kt){if(!kt)return 0;if(typeof kt=="number")return kt;var Gt=parseFloat(kt);return kt.indexOf("ms")!=-1?Gt:1e3*Gt},prefixes:["","-webkit-","-moz-","-o-"]};b.default=Et},function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et,kt=(Et=yt(0))&&Et.__esModule?Et:{default:Et};b.default=function Gt(Vt,an){if(function(hn,wn){if(!(hn instanceof wn))throw new TypeError("Cannot call a class as a function")}(this,Gt),this.styles=typeof Vt=="string"?kt.default.getFromSheets(Vt):Vt,typeof an=="string"){var Pn=kt.default.getFromSheets(an);for(var mn in this.options={},Pn)this.options[mn.replace("animation-","")]=Pn[mn]}else this.options=typeof an=="number"?{duration:an}:an}},function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et=function(){function mn(hn,wn){for(var _n=0;_n<wn.length;_n++){var $t=wn[_n];$t.enumerable=$t.enumerable||!1,$t.configurable=!0,"value"in $t&&($t.writable=!0),Object.defineProperty(hn,$t.key,$t)}}return function(hn,wn,_n){return wn&&mn(hn.prototype,wn),_n&&mn(hn,_n),hn}}(),kt=an(yt(4)),Gt=an(yt(1)),Vt=an(yt(0));function an(mn){return mn&&mn.__esModule?mn:{default:mn}}var Pn=function(){function mn(hn,wn,_n,$t){if(function(jt,Yt){if(!(jt instanceof Yt))throw new TypeError("Cannot call a class as a function")}(this,mn),hn.constructor===Array?this.doms=hn:this.doms=[hn],wn.constructor===Array?this.frames=wn:this.frames=[wn],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},_n!=null&&_n!=null)if(typeof _n=="boolean")this.options.instant=_n;else if(typeof _n=="number")this.options.count=_n,typeof $t=="boolean"&&(this.options.instant=$t);else for(var bn in _n)bn=="pauseAt"&&_n.pauseAt.constructor!==Array?this.options[bn]=[_n[bn]]:this.options[bn]=_n[bn];for(var Nt in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=Gt.default.prefixes:this.prefixes=[""],hn)this.countRemainder[Nt]=this.options.count-1;this.options.instant&&this.play()}return Et(mn,[{key:"play",value:function(){var hn=this;for(var wn in this.clear(),this.promiseSupported&&(this.promise=new Promise(function($t){hn.promiseResolve=$t})),this.doms){var _n=this.makeAnimation(this.doms[wn]);this.animations[wn]=_n.names,this.styleDoms[wn]=_n.styleDom,this.superSets[wn]=this.makeSuperSet(this.doms[wn],this.animations[wn]),this.playAnimation(this.doms[wn],this.superSets[wn]),this.eventHandler[wn]=this.handleAnimationEnd.bind(this,wn),this.doms[wn].addEventListener("animationend",this.eventHandler[wn])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(hn){if(!hn){for(var wn in this.doms)this.clear(wn);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var _n=this.styleDoms[hn];for(var $t in _n&&_n.parentNode&&_n.parentNode.removeChild(_n),this.superSets[hn])for(var bn in this.prefixes)this.doms[hn].style[this.prefixes[bn]+"animation-"+$t]=null;for(var Nt in this.prefixes)this.doms[hn].style[this.prefixes[Nt]+"animation-play-state"]=null;this.doms[hn].removeEventListener("animationend",this.eventHandler[hn]),this.countRemainder[hn]=this.options.count-1}},{key:"replay",value:function(hn){var wn=this.doms[hn],_n=wn.cloneNode(!0);wn.parentNode.replaceChild(_n,wn),this.doms[hn].removeEventListener("animationend",this.eventHandler[hn]),this.doms[hn]=_n,this.doms[hn].addEventListener("animationend",this.eventHandler[hn])}},{key:"pause",value:function(){for(var hn in this.doms)this.pauseDom(this.doms[hn])}},{key:"resume",value:function(){for(var hn in this.doms)this.resumeDom(this.doms[hn])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(hn,wn){var _n=wn.animationName,$t=_n.substring(_n.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt($t))&&this.pauseDom(this.doms[hn]),$t==this.frames.length&&(this.countRemainder[hn]==-1?this.replay(hn):this.countRemainder[hn]>0?(this.countRemainder[hn]--,this.replay(hn)):(this.options.applyOnEnd&&this.applyOnEnd(hn),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(hn){for(var wn in this.prefixes)hn.style[this.prefixes[wn]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(hn){for(var wn in this.prefixes)hn.style[this.prefixes[wn]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(hn){var wn=this.newFrames[this.frames.length];for(var _n in wn)this.doms[hn].style[_n]=wn[_n]}},{key:"makeAnimation",value:function(hn){var wn={},_n=[],$t={};for(var bn in this.frames)for(var Nt in _n.push(this.frames[bn].styles),_n[bn])$t[Nt]=!0;var jt=window.getComputedStyle(hn);for(var Yt in $t)wn[Yt]=jt[Yt];_n.unshift(wn);for(var Bn=[_n[0]],un=1;un<_n.length;++un){var Cn=JSON.parse(JSON.stringify(Bn[un-1]));for(var Qt in _n[un])Cn[Qt]=_n[un][Qt];Bn.push(Cn)}return this.newFrames=Bn,kt.default.make(Bn,this.prefixes)}},{key:"makeSuperSet",value:function(hn,wn){var _n=0,$t={};for(var bn in this.frames)for(var Nt in this.frames[bn].options)$t[Nt]="";$t.name="",$t.duration="",$t.delay="";for(var jt=0;jt<this.frames.length;++jt){if(jt)for(var Yt in $t)$t[Yt]+=",";var Bn=Gt.default.convertTimeToMs(this.frames[jt].options.duration),un=Gt.default.convertTimeToMs(this.frames[jt].options.delay);for(var Cn in jt<this.options.startFrom&&(Bn=0,un=0),$t.name+=wn[jt],$t.duration+=Bn+"ms",$t.delay+=_n+un+"ms",$t)Cn!="name"&&Cn!="duration"&&Cn!="delay"&&($t[Cn]+=this.frames[jt].options[Cn]?this.frames[jt].options[Cn]:Vt.default.getPropertyDefault(Cn));var Qt=this.frames[jt].options["iteration-count"];_n+=Bn*parseInt(Qt||1)+un}return $t}},{key:"playAnimation",value:function(hn,wn){for(var _n in wn)for(var $t in this.prefixes)hn.style[this.prefixes[$t]+"animation-"+_n]=wn[_n];this.options.pauseAt.includes(0)&&this.pauseDom(hn)}}]),mn}();b.default=Pn},function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0});var Et,kt=(Et=yt(1))&&Et.__esModule?Et:{default:Et},Gt={make:function(Vt,an){for(var Pn=[],mn="",hn="atr-"+kt.default.generateId(),wn=document.createElement("style"),_n=0;_n<Vt.length-1;++_n)Pn.push(hn+"-"+(_n+1)),mn+=Gt.makeFromTwoFrames(Vt[_n],Vt[_n+1],Pn[_n],an);return wn.innerHTML=mn,wn.class="foo",document.getElementsByTagName("head")[0].appendChild(wn),{names:Pn,styleDom:wn}},makeFromTwoFrames:function(Vt,an,Pn,mn){var hn="";for(var wn in mn)hn+="@"+mn[wn]+"keyframes "+Pn+" {",hn+="0%",hn+="{"+kt.default.frameToString(Vt)+"}",hn+="100%",hn+="{"+kt.default.frameToString(an)+"}",hn+="}";return hn}};b.default=Gt},function(st,b,yt){Object.defineProperty(b,"__esModule",{value:!0}),b.Queue=b.Frame=void 0;var Et=Gt(yt(2)),kt=Gt(yt(3));function Gt(Vt){return Vt&&Vt.__esModule?Vt:{default:Vt}}b.Frame=Et.default,b.Queue=kt.default}])},j.exports=tt()},352:function(j){j.exports=function(tt){var st=[];return st.toString=function(){return this.map(function(b){var yt=tt(b);return b[2]?"@media ".concat(b[2]," {").concat(yt,"}"):yt}).join("")},st.i=function(b,yt,Et){typeof b=="string"&&(b=[[null,b,""]]);var kt={};if(Et)for(var Gt=0;Gt<this.length;Gt++){var Vt=this[Gt][0];Vt!=null&&(kt[Vt]=!0)}for(var an=0;an<b.length;an++){var Pn=[].concat(b[an]);Et&&kt[Pn[0]]||(yt&&(Pn[2]?Pn[2]="".concat(yt," and ").concat(Pn[2]):Pn[2]=yt),st.push(Pn))}},st}},388:function(j){j.exports=function tt(st,b,yt){function Et(Vt,an){if(!b[Vt]){if(!st[Vt]){if(kt)return kt(Vt,!0);throw new Error("Cannot find module '"+Vt+"'")}var Pn=b[Vt]={exports:{}};st[Vt][0].call(Pn.exports,function(mn){return Et(st[Vt][1][mn]||mn)},Pn,Pn.exports,tt,st,b,yt)}return b[Vt].exports}for(var kt=void 0,Gt=0;Gt<yt.length;Gt++)Et(yt[Gt]);return Et}({1:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){var wn=tt("crypto");function _n(un,Cn){return function(Qt,Wt){var Zt;if((Zt=Wt.algorithm!=="passthrough"?wn.createHash(Wt.algorithm):new Bn).write===void 0&&(Zt.write=Zt.update,Zt.end=Zt.update),Yt(Wt,Zt).dispatch(Qt),Zt.update||Zt.end(""),Zt.digest)return Zt.digest(Wt.encoding==="buffer"?void 0:Wt.encoding);var En=Zt.read();return Wt.encoding!=="buffer"?En.toString(Wt.encoding):En}(un,Cn=Nt(un,Cn))}(b=st.exports=_n).sha1=function(un){return _n(un)},b.keys=function(un){return _n(un,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},b.MD5=function(un){return _n(un,{algorithm:"md5",encoding:"hex"})},b.keysMD5=function(un){return _n(un,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var $t=wn.getHashes?wn.getHashes().slice():["sha1","md5"];$t.push("passthrough");var bn=["buffer","hex","binary","base64"];function Nt(un,Cn){Cn=Cn||{};var Qt={};if(Qt.algorithm=Cn.algorithm||"sha1",Qt.encoding=Cn.encoding||"hex",Qt.excludeValues=!!Cn.excludeValues,Qt.algorithm=Qt.algorithm.toLowerCase(),Qt.encoding=Qt.encoding.toLowerCase(),Qt.ignoreUnknown=Cn.ignoreUnknown===!0,Qt.respectType=Cn.respectType!==!1,Qt.respectFunctionNames=Cn.respectFunctionNames!==!1,Qt.respectFunctionProperties=Cn.respectFunctionProperties!==!1,Qt.unorderedArrays=Cn.unorderedArrays===!0,Qt.unorderedSets=Cn.unorderedSets!==!1,Qt.unorderedObjects=Cn.unorderedObjects!==!1,Qt.replacer=Cn.replacer||void 0,Qt.excludeKeys=Cn.excludeKeys||void 0,un===void 0)throw new Error("Object argument required.");for(var Wt=0;Wt<$t.length;++Wt)$t[Wt].toLowerCase()===Qt.algorithm.toLowerCase()&&(Qt.algorithm=$t[Wt]);if($t.indexOf(Qt.algorithm)===-1)throw new Error('Algorithm "'+Qt.algorithm+'"  not supported. supported values: '+$t.join(", "));if(bn.indexOf(Qt.encoding)===-1&&Qt.algorithm!=="passthrough")throw new Error('Encoding "'+Qt.encoding+'"  not supported. supported values: '+bn.join(", "));return Qt}function jt(un){if(typeof un=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(un))!=null}function Yt(un,Cn,Qt){function Wt(Zt){return Cn.update?Cn.update(Zt,"utf8"):Cn.write(Zt,"utf8")}return Qt=Qt||[],{dispatch:function(Zt){return un.replacer&&(Zt=un.replacer(Zt)),this["_"+(Zt===null?"null":typeof Zt)](Zt)},_object:function(Zt){var En,pn=Object.prototype.toString.call(Zt),er=/\[object (.*)\]/i.exec(pn);if(er=(er=er?er[1]:"unknown:["+pn+"]").toLowerCase(),0<=(En=Qt.indexOf(Zt)))return this.dispatch("[CIRCULAR:"+En+"]");if(Qt.push(Zt),kt!==void 0&&kt.isBuffer&&kt.isBuffer(Zt))return Wt("buffer:"),Wt(Zt);if(er==="object"||er==="function"||er==="asyncfunction"){var Ir=Object.keys(Zt);un.unorderedObjects&&(Ir=Ir.sort()),un.respectType===!1||jt(Zt)||Ir.splice(0,0,"prototype","__proto__","constructor"),un.excludeKeys&&(Ir=Ir.filter(function(zr){return!un.excludeKeys(zr)})),Wt("object:"+Ir.length+":");var Dr=this;return Ir.forEach(function(zr){Dr.dispatch(zr),Wt(":"),un.excludeValues||Dr.dispatch(Zt[zr]),Wt(",")})}if(!this["_"+er]){if(un.ignoreUnknown)return Wt("["+er+"]");throw new Error('Unknown object type "'+er+'"')}this["_"+er](Zt)},_array:function(Zt,En){En=En!==void 0?En:un.unorderedArrays!==!1;var pn=this;if(Wt("array:"+Zt.length+":"),!En||Zt.length<=1)return Zt.forEach(function(Dr){return pn.dispatch(Dr)});var er=[],Ir=Zt.map(function(Dr){var zr=new Bn,Ar=Qt.slice();return Yt(un,zr,Ar).dispatch(Dr),er=er.concat(Ar.slice(Qt.length)),zr.read().toString()});return Qt=Qt.concat(er),Ir.sort(),this._array(Ir,!1)},_date:function(Zt){return Wt("date:"+Zt.toJSON())},_symbol:function(Zt){return Wt("symbol:"+Zt.toString())},_error:function(Zt){return Wt("error:"+Zt.toString())},_boolean:function(Zt){return Wt("bool:"+Zt.toString())},_string:function(Zt){Wt("string:"+Zt.length+":"),Wt(Zt.toString())},_function:function(Zt){Wt("fn:"),jt(Zt)?this.dispatch("[native]"):this.dispatch(Zt.toString()),un.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(Zt.name)),un.respectFunctionProperties&&this._object(Zt)},_number:function(Zt){return Wt("number:"+Zt.toString())},_xml:function(Zt){return Wt("xml:"+Zt.toString())},_null:function(){return Wt("Null")},_undefined:function(){return Wt("Undefined")},_regexp:function(Zt){return Wt("regex:"+Zt.toString())},_uint8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint8clampedarray:function(Zt){return Wt("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(Zt))},_int8array:function(Zt){return Wt("uint8array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int16array:function(Zt){return Wt("uint16array:"),this.dispatch(Array.prototype.slice.call(Zt))},_uint32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_int32array:function(Zt){return Wt("uint32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float32array:function(Zt){return Wt("float32array:"),this.dispatch(Array.prototype.slice.call(Zt))},_float64array:function(Zt){return Wt("float64array:"),this.dispatch(Array.prototype.slice.call(Zt))},_arraybuffer:function(Zt){return Wt("arraybuffer:"),this.dispatch(new Uint8Array(Zt))},_url:function(Zt){return Wt("url:"+Zt.toString())},_map:function(Zt){Wt("map:");var En=Array.from(Zt);return this._array(En,un.unorderedSets!==!1)},_set:function(Zt){Wt("set:");var En=Array.from(Zt);return this._array(En,un.unorderedSets!==!1)},_file:function(Zt){return Wt("file:"),this.dispatch([Zt.name,Zt.size,Zt.type,Zt.lastModfied])},_blob:function(){if(un.ignoreUnknown)return Wt("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return Wt("domwindow")},_bigint:function(Zt){return Wt("bigint:"+Zt.toString())},_process:function(){return Wt("process")},_timer:function(){return Wt("timer")},_pipe:function(){return Wt("pipe")},_tcp:function(){return Wt("tcp")},_udp:function(){return Wt("udp")},_tty:function(){return Wt("tty")},_statwatcher:function(){return Wt("statwatcher")},_securecontext:function(){return Wt("securecontext")},_connection:function(){return Wt("connection")},_zlib:function(){return Wt("zlib")},_context:function(){return Wt("context")},_nodescript:function(){return Wt("nodescript")},_httpparser:function(){return Wt("httpparser")},_dataview:function(){return Wt("dataview")},_signal:function(){return Wt("signal")},_fsevent:function(){return Wt("fsevent")},_tlswrap:function(){return Wt("tlswrap")}}}function Bn(){return{buf:"",write:function(un){this.buf+=un},end:function(un){this.buf+=un},read:function(){return this.buf}}}b.writeToStream=function(un,Cn,Qt){return Qt===void 0&&(Qt=Cn,Cn={}),Yt(Cn=Nt(un,Cn),Qt).dispatch(un)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){(function(wn){var _n=typeof Uint8Array<"u"?Uint8Array:Array,$t="+".charCodeAt(0),bn="/".charCodeAt(0),Nt="0".charCodeAt(0),jt="a".charCodeAt(0),Yt="A".charCodeAt(0),Bn="-".charCodeAt(0),un="_".charCodeAt(0);function Cn(Qt){var Wt=Qt.charCodeAt(0);return Wt===$t||Wt===Bn?62:Wt===bn||Wt===un?63:Wt<Nt?-1:Wt<Nt+10?Wt-Nt+26+26:Wt<Yt+26?Wt-Yt:Wt<jt+26?Wt-jt+26:void 0}wn.toByteArray=function(Qt){var Wt,Zt;if(0<Qt.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var En=Qt.length,pn=Qt.charAt(En-2)==="="?2:Qt.charAt(En-1)==="="?1:0,er=new _n(3*Qt.length/4-pn),Ir=0<pn?Qt.length-4:Qt.length,Dr=0;function zr(Ar){er[Dr++]=Ar}for(Wt=0;Wt<Ir;Wt+=4,0)zr((16711680&(Zt=Cn(Qt.charAt(Wt))<<18|Cn(Qt.charAt(Wt+1))<<12|Cn(Qt.charAt(Wt+2))<<6|Cn(Qt.charAt(Wt+3))))>>16),zr((65280&Zt)>>8),zr(255&Zt);return pn==2?zr(255&(Zt=Cn(Qt.charAt(Wt))<<2|Cn(Qt.charAt(Wt+1))>>4)):pn==1&&(zr((Zt=Cn(Qt.charAt(Wt))<<10|Cn(Qt.charAt(Wt+1))<<4|Cn(Qt.charAt(Wt+2))>>2)>>8&255),zr(255&Zt)),er},wn.fromByteArray=function(Qt){var Wt,Zt,En,pn,er=Qt.length%3,Ir="";function Dr(zr){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(zr)}for(Wt=0,En=Qt.length-er;Wt<En;Wt+=3)Ir+=Dr((pn=Zt=(Qt[Wt]<<16)+(Qt[Wt+1]<<8)+Qt[Wt+2])>>18&63)+Dr(pn>>12&63)+Dr(pn>>6&63)+Dr(63&pn);switch(er){case 1:Ir+=Dr((Zt=Qt[Qt.length-1])>>2),Ir+=Dr(Zt<<4&63),Ir+="==";break;case 2:Ir+=Dr((Zt=(Qt[Qt.length-2]<<8)+Qt[Qt.length-1])>>10),Ir+=Dr(Zt>>4&63),Ir+=Dr(Zt<<2&63),Ir+="="}return Ir}})(b===void 0?this.base64js={}:b)}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(tt,st,b){(function(yt,Et,$t,Gt,Vt,an,Pn,mn,hn){var wn=tt("base64-js"),_n=tt("ieee754");function $t(Xt,rn,Fn){if(!(this instanceof $t))return new $t(Xt,rn,Fn);var Nr,kr,jr,Ss,zs,Ao=typeof Xt;if(rn==="base64"&&Ao=="string")for(Xt=(Nr=Xt).trim?Nr.trim():Nr.replace(/^\s+|\s+$/g,"");Xt.length%4!=0;)Xt+="=";if(Ao=="number")kr=Dr(Xt);else if(Ao=="string")kr=$t.byteLength(Xt,rn);else{if(Ao!="object")throw new Error("First argument needs to be a number, array or string.");kr=Dr(Xt.length)}if($t._useTypedArrays?jr=$t._augment(new Uint8Array(kr)):((jr=this).length=kr,jr._isBuffer=!0),$t._useTypedArrays&&typeof Xt.byteLength=="number")jr._set(Xt);else if(zr(zs=Xt)||$t.isBuffer(zs)||zs&&typeof zs=="object"&&typeof zs.length=="number")for(Ss=0;Ss<kr;Ss++)$t.isBuffer(Xt)?jr[Ss]=Xt.readUInt8(Ss):jr[Ss]=Xt[Ss];else if(Ao=="string")jr.write(Xt,0,rn);else if(Ao=="number"&&!$t._useTypedArrays&&!Fn)for(Ss=0;Ss<kr;Ss++)jr[Ss]=0;return jr}function bn(Xt,rn,Fn,Nr){Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+1<Xt.length,"Trying to read beyond buffer length"));var kr,jr=Xt.length;if(!(jr<=rn))return Fn?(kr=Xt[rn],rn+1<jr&&(kr|=Xt[rn+1]<<8)):(kr=Xt[rn]<<8,rn+1<jr&&(kr|=Xt[rn+1])),kr}function Nt(Xt,rn,Fn,Nr){Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+3<Xt.length,"Trying to read beyond buffer length"));var kr,jr=Xt.length;if(!(jr<=rn))return Fn?(rn+2<jr&&(kr=Xt[rn+2]<<16),rn+1<jr&&(kr|=Xt[rn+1]<<8),kr|=Xt[rn],rn+3<jr&&(kr+=Xt[rn+3]<<24>>>0)):(rn+1<jr&&(kr=Xt[rn+1]<<16),rn+2<jr&&(kr|=Xt[rn+2]<<8),rn+3<jr&&(kr|=Xt[rn+3]),kr+=Xt[rn]<<24>>>0),kr}function jt(Xt,rn,Fn,Nr){if(Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+1<Xt.length,"Trying to read beyond buffer length")),!(Xt.length<=rn)){var kr=bn(Xt,rn,Fn,!0);return 32768&kr?-1*(65535-kr+1):kr}}function Yt(Xt,rn,Fn,Nr){if(Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn!=null,"missing offset"),Yn(rn+3<Xt.length,"Trying to read beyond buffer length")),!(Xt.length<=rn)){var kr=Nt(Xt,rn,Fn,!0);return 2147483648&kr?-1*(4294967295-kr+1):kr}}function Bn(Xt,rn,Fn,Nr){return Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn+3<Xt.length,"Trying to read beyond buffer length")),_n.read(Xt,rn,Fn,23,4)}function un(Xt,rn,Fn,Nr){return Nr||(Yn(typeof Fn=="boolean","missing or invalid endian"),Yn(rn+7<Xt.length,"Trying to read beyond buffer length")),_n.read(Xt,rn,Fn,52,8)}function Cn(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+1<Xt.length,"trying to write beyond buffer length"),nr(rn,65535));var jr=Xt.length;if(!(jr<=Fn))for(var Ss=0,zs=Math.min(jr-Fn,2);Ss<zs;Ss++)Xt[Fn+Ss]=(rn&255<<8*(Nr?Ss:1-Ss))>>>8*(Nr?Ss:1-Ss)}function Qt(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+3<Xt.length,"trying to write beyond buffer length"),nr(rn,4294967295));var jr=Xt.length;if(!(jr<=Fn))for(var Ss=0,zs=Math.min(jr-Fn,4);Ss<zs;Ss++)Xt[Fn+Ss]=rn>>>8*(Nr?Ss:3-Ss)&255}function Wt(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+1<Xt.length,"Trying to write beyond buffer length"),$n(rn,32767,-32768)),Xt.length<=Fn||Cn(Xt,0<=rn?rn:65535+rn+1,Fn,Nr,kr)}function Zt(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+3<Xt.length,"Trying to write beyond buffer length"),$n(rn,2147483647,-2147483648)),Xt.length<=Fn||Qt(Xt,0<=rn?rn:4294967295+rn+1,Fn,Nr,kr)}function En(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+3<Xt.length,"Trying to write beyond buffer length"),Sr(rn,34028234663852886e22,-34028234663852886e22)),Xt.length<=Fn||_n.write(Xt,rn,Fn,Nr,23,4)}function pn(Xt,rn,Fn,Nr,kr){kr||(Yn(rn!=null,"missing value"),Yn(typeof Nr=="boolean","missing or invalid endian"),Yn(Fn!=null,"missing offset"),Yn(Fn+7<Xt.length,"Trying to write beyond buffer length"),Sr(rn,17976931348623157e292,-17976931348623157e292)),Xt.length<=Fn||_n.write(Xt,rn,Fn,Nr,52,8)}b.Buffer=$t,b.SlowBuffer=$t,b.INSPECT_MAX_BYTES=50,$t.poolSize=8192,$t._useTypedArrays=function(){try{var Xt=new ArrayBuffer(0),rn=new Uint8Array(Xt);return rn.foo=function(){return 42},rn.foo()===42&&typeof rn.subarray=="function"}catch{return!1}}(),$t.isEncoding=function(Xt){switch(String(Xt).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},$t.isBuffer=function(Xt){return!(Xt==null||!Xt._isBuffer)},$t.byteLength=function(Xt,rn){var Fn;switch(Xt+="",rn||"utf8"){case"hex":Fn=Xt.length/2;break;case"utf8":case"utf-8":Fn=Hr(Xt).length;break;case"ascii":case"binary":case"raw":Fn=Xt.length;break;case"base64":Fn=Xn(Xt).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Fn=2*Xt.length;break;default:throw new Error("Unknown encoding")}return Fn},$t.concat=function(Xt,rn){if(Yn(zr(Xt),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),Xt.length===0)return new $t(0);if(Xt.length===1)return Xt[0];if(typeof rn!="number")for(kr=rn=0;kr<Xt.length;kr++)rn+=Xt[kr].length;for(var Fn=new $t(rn),Nr=0,kr=0;kr<Xt.length;kr++){var jr=Xt[kr];jr.copy(Fn,Nr),Nr+=jr.length}return Fn},$t.prototype.write=function(Xt,rn,Fn,Nr){var kr;isFinite(rn)?isFinite(Fn)||(Nr=Fn,Fn=void 0):(kr=Nr,Nr=rn,rn=Fn,Fn=kr),rn=Number(rn)||0;var jr,Ss,zs,Ao,Zs,Lo,$s,qo=this.length-rn;switch((!Fn||qo<(Fn=Number(Fn)))&&(Fn=qo),Nr=String(Nr||"utf8").toLowerCase()){case"hex":jr=function(yo,Hu,vu,ba){vu=Number(vu)||0;var Ro=yo.length-vu;(!ba||Ro<(ba=Number(ba)))&&(ba=Ro);var Gl=Hu.length;Yn(Gl%2==0,"Invalid hex string"),Gl/2<ba&&(ba=Gl/2);for(var To=0;To<ba;To++){var Wu=parseInt(Hu.substr(2*To,2),16);Yn(!isNaN(Wu),"Invalid hex string"),yo[vu+To]=Wu}return $t._charsWritten=2*To,To}(this,Xt,rn,Fn);break;case"utf8":case"utf-8":Zs=Xt,Lo=rn,$s=Fn,jr=$t._charsWritten=ir(Hr(Zs),this,Lo,$s);break;case"ascii":case"binary":jr=function(yo,Hu,vu,ba){return $t._charsWritten=ir(function(Ro){for(var Gl=[],To=0;To<Ro.length;To++)Gl.push(255&Ro.charCodeAt(To));return Gl}(Hu),yo,vu,ba)}(this,Xt,rn,Fn);break;case"base64":Ss=Xt,zs=rn,Ao=Fn,jr=$t._charsWritten=ir(Xn(Ss),this,zs,Ao);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":jr=function(yo,Hu,vu,ba){return $t._charsWritten=ir(function(Ro){for(var Gl,To,Wu,Pu=[],Oo=0;Oo<Ro.length;Oo++)To=(Gl=Ro.charCodeAt(Oo))>>8,Wu=Gl%256,Pu.push(Wu),Pu.push(To);return Pu}(Hu),yo,vu,ba)}(this,Xt,rn,Fn);break;default:throw new Error("Unknown encoding")}return jr},$t.prototype.toString=function(Xt,rn,Fn){var Nr,kr,jr,Ss,zs=this;if(Xt=String(Xt||"utf8").toLowerCase(),rn=Number(rn)||0,(Fn=Fn!==void 0?Number(Fn):Fn=zs.length)===rn)return"";switch(Xt){case"hex":Nr=function(Ao,Zs,Lo){var $s=Ao.length;(!Zs||Zs<0)&&(Zs=0),(!Lo||Lo<0||$s<Lo)&&(Lo=$s);for(var qo="",yo=Zs;yo<Lo;yo++)qo+=Ar(Ao[yo]);return qo}(zs,rn,Fn);break;case"utf8":case"utf-8":Nr=function(Ao,Zs,Lo){var $s="",qo="";Lo=Math.min(Ao.length,Lo);for(var yo=Zs;yo<Lo;yo++)Ao[yo]<=127?($s+=zn(qo)+String.fromCharCode(Ao[yo]),qo=""):qo+="%"+Ao[yo].toString(16);return $s+zn(qo)}(zs,rn,Fn);break;case"ascii":case"binary":Nr=function(Ao,Zs,Lo){var $s="";Lo=Math.min(Ao.length,Lo);for(var qo=Zs;qo<Lo;qo++)$s+=String.fromCharCode(Ao[qo]);return $s}(zs,rn,Fn);break;case"base64":kr=zs,Ss=Fn,Nr=(jr=rn)===0&&Ss===kr.length?wn.fromByteArray(kr):wn.fromByteArray(kr.slice(jr,Ss));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Nr=function(Ao,Zs,Lo){for(var $s=Ao.slice(Zs,Lo),qo="",yo=0;yo<$s.length;yo+=2)qo+=String.fromCharCode($s[yo]+256*$s[yo+1]);return qo}(zs,rn,Fn);break;default:throw new Error("Unknown encoding")}return Nr},$t.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},$t.prototype.copy=function(Xt,rn,Fn,Nr){if(Fn=Fn||0,Nr||Nr===0||(Nr=this.length),rn=rn||0,Nr!==Fn&&Xt.length!==0&&this.length!==0){Yn(Fn<=Nr,"sourceEnd < sourceStart"),Yn(0<=rn&&rn<Xt.length,"targetStart out of bounds"),Yn(0<=Fn&&Fn<this.length,"sourceStart out of bounds"),Yn(0<=Nr&&Nr<=this.length,"sourceEnd out of bounds"),Nr>this.length&&(Nr=this.length),Xt.length-rn<Nr-Fn&&(Nr=Xt.length-rn+Fn);var kr=Nr-Fn;if(kr<100||!$t._useTypedArrays)for(var jr=0;jr<kr;jr++)Xt[jr+rn]=this[jr+Fn];else Xt._set(this.subarray(Fn,Fn+kr),rn)}},$t.prototype.slice=function(Xt,rn){var Fn=this.length;if(Xt=Ir(Xt,Fn,0),rn=Ir(rn,Fn,Fn),$t._useTypedArrays)return $t._augment(this.subarray(Xt,rn));for(var Nr=rn-Xt,kr=new $t(Nr,void 0,!0),jr=0;jr<Nr;jr++)kr[jr]=this[jr+Xt];return kr},$t.prototype.get=function(Xt){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(Xt)},$t.prototype.set=function(Xt,rn){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(Xt,rn)},$t.prototype.readUInt8=function(Xt,rn){if(rn||(Yn(Xt!=null,"missing offset"),Yn(Xt<this.length,"Trying to read beyond buffer length")),!(Xt>=this.length))return this[Xt]},$t.prototype.readUInt16LE=function(Xt,rn){return bn(this,Xt,!0,rn)},$t.prototype.readUInt16BE=function(Xt,rn){return bn(this,Xt,!1,rn)},$t.prototype.readUInt32LE=function(Xt,rn){return Nt(this,Xt,!0,rn)},$t.prototype.readUInt32BE=function(Xt,rn){return Nt(this,Xt,!1,rn)},$t.prototype.readInt8=function(Xt,rn){if(rn||(Yn(Xt!=null,"missing offset"),Yn(Xt<this.length,"Trying to read beyond buffer length")),!(Xt>=this.length))return 128&this[Xt]?-1*(255-this[Xt]+1):this[Xt]},$t.prototype.readInt16LE=function(Xt,rn){return jt(this,Xt,!0,rn)},$t.prototype.readInt16BE=function(Xt,rn){return jt(this,Xt,!1,rn)},$t.prototype.readInt32LE=function(Xt,rn){return Yt(this,Xt,!0,rn)},$t.prototype.readInt32BE=function(Xt,rn){return Yt(this,Xt,!1,rn)},$t.prototype.readFloatLE=function(Xt,rn){return Bn(this,Xt,!0,rn)},$t.prototype.readFloatBE=function(Xt,rn){return Bn(this,Xt,!1,rn)},$t.prototype.readDoubleLE=function(Xt,rn){return un(this,Xt,!0,rn)},$t.prototype.readDoubleBE=function(Xt,rn){return un(this,Xt,!1,rn)},$t.prototype.writeUInt8=function(Xt,rn,Fn){Fn||(Yn(Xt!=null,"missing value"),Yn(rn!=null,"missing offset"),Yn(rn<this.length,"trying to write beyond buffer length"),nr(Xt,255)),rn>=this.length||(this[rn]=Xt)},$t.prototype.writeUInt16LE=function(Xt,rn,Fn){Cn(this,Xt,rn,!0,Fn)},$t.prototype.writeUInt16BE=function(Xt,rn,Fn){Cn(this,Xt,rn,!1,Fn)},$t.prototype.writeUInt32LE=function(Xt,rn,Fn){Qt(this,Xt,rn,!0,Fn)},$t.prototype.writeUInt32BE=function(Xt,rn,Fn){Qt(this,Xt,rn,!1,Fn)},$t.prototype.writeInt8=function(Xt,rn,Fn){Fn||(Yn(Xt!=null,"missing value"),Yn(rn!=null,"missing offset"),Yn(rn<this.length,"Trying to write beyond buffer length"),$n(Xt,127,-128)),rn>=this.length||(0<=Xt?this.writeUInt8(Xt,rn,Fn):this.writeUInt8(255+Xt+1,rn,Fn))},$t.prototype.writeInt16LE=function(Xt,rn,Fn){Wt(this,Xt,rn,!0,Fn)},$t.prototype.writeInt16BE=function(Xt,rn,Fn){Wt(this,Xt,rn,!1,Fn)},$t.prototype.writeInt32LE=function(Xt,rn,Fn){Zt(this,Xt,rn,!0,Fn)},$t.prototype.writeInt32BE=function(Xt,rn,Fn){Zt(this,Xt,rn,!1,Fn)},$t.prototype.writeFloatLE=function(Xt,rn,Fn){En(this,Xt,rn,!0,Fn)},$t.prototype.writeFloatBE=function(Xt,rn,Fn){En(this,Xt,rn,!1,Fn)},$t.prototype.writeDoubleLE=function(Xt,rn,Fn){pn(this,Xt,rn,!0,Fn)},$t.prototype.writeDoubleBE=function(Xt,rn,Fn){pn(this,Xt,rn,!1,Fn)},$t.prototype.fill=function(Xt,rn,Fn){if(Xt=Xt||0,rn=rn||0,Fn=Fn||this.length,typeof Xt=="string"&&(Xt=Xt.charCodeAt(0)),Yn(typeof Xt=="number"&&!isNaN(Xt),"value is not a number"),Yn(rn<=Fn,"end < start"),Fn!==rn&&this.length!==0){Yn(0<=rn&&rn<this.length,"start out of bounds"),Yn(0<=Fn&&Fn<=this.length,"end out of bounds");for(var Nr=rn;Nr<Fn;Nr++)this[Nr]=Xt}},$t.prototype.inspect=function(){for(var Xt=[],rn=this.length,Fn=0;Fn<rn;Fn++)if(Xt[Fn]=Ar(this[Fn]),Fn===b.INSPECT_MAX_BYTES){Xt[Fn+1]="...";break}return"<Buffer "+Xt.join(" ")+">"},$t.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if($t._useTypedArrays)return new $t(this).buffer;for(var Xt=new Uint8Array(this.length),rn=0,Fn=Xt.length;rn<Fn;rn+=1)Xt[rn]=this[rn];return Xt.buffer};var er=$t.prototype;function Ir(Xt,rn,Fn){return typeof Xt!="number"?Fn:rn<=(Xt=~~Xt)?rn:0<=Xt||0<=(Xt+=rn)?Xt:0}function Dr(Xt){return(Xt=~~Math.ceil(+Xt))<0?0:Xt}function zr(Xt){return(Array.isArray||function(rn){return Object.prototype.toString.call(rn)==="[object Array]"})(Xt)}function Ar(Xt){return Xt<16?"0"+Xt.toString(16):Xt.toString(16)}function Hr(Xt){for(var rn=[],Fn=0;Fn<Xt.length;Fn++){var Nr=Xt.charCodeAt(Fn);if(Nr<=127)rn.push(Xt.charCodeAt(Fn));else{var kr=Fn;55296<=Nr&&Nr<=57343&&Fn++;for(var jr=encodeURIComponent(Xt.slice(kr,Fn+1)).substr(1).split("%"),Ss=0;Ss<jr.length;Ss++)rn.push(parseInt(jr[Ss],16))}}return rn}function Xn(Xt){return wn.toByteArray(Xt)}function ir(Xt,rn,Fn,Nr){for(var kr=0;kr<Nr&&!(kr+Fn>=rn.length||kr>=Xt.length);kr++)rn[kr+Fn]=Xt[kr];return kr}function zn(Xt){try{return decodeURIComponent(Xt)}catch{return String.fromCharCode(65533)}}function nr(Xt,rn){Yn(typeof Xt=="number","cannot write a non-number as a number"),Yn(0<=Xt,"specified a negative value for writing an unsigned value"),Yn(Xt<=rn,"value is larger than maximum value for type"),Yn(Math.floor(Xt)===Xt,"value has a fractional component")}function $n(Xt,rn,Fn){Yn(typeof Xt=="number","cannot write a non-number as a number"),Yn(Xt<=rn,"value larger than maximum allowed value"),Yn(Fn<=Xt,"value smaller than minimum allowed value"),Yn(Math.floor(Xt)===Xt,"value has a fractional component")}function Sr(Xt,rn,Fn){Yn(typeof Xt=="number","cannot write a non-number as a number"),Yn(Xt<=rn,"value larger than maximum allowed value"),Yn(Fn<=Xt,"value smaller than minimum allowed value")}function Yn(Xt,rn){if(!Xt)throw new Error(rn||"Failed assertion")}$t._augment=function(Xt){return Xt._isBuffer=!0,Xt._get=Xt.get,Xt._set=Xt.set,Xt.get=er.get,Xt.set=er.set,Xt.write=er.write,Xt.toString=er.toString,Xt.toLocaleString=er.toString,Xt.toJSON=er.toJSON,Xt.copy=er.copy,Xt.slice=er.slice,Xt.readUInt8=er.readUInt8,Xt.readUInt16LE=er.readUInt16LE,Xt.readUInt16BE=er.readUInt16BE,Xt.readUInt32LE=er.readUInt32LE,Xt.readUInt32BE=er.readUInt32BE,Xt.readInt8=er.readInt8,Xt.readInt16LE=er.readInt16LE,Xt.readInt16BE=er.readInt16BE,Xt.readInt32LE=er.readInt32LE,Xt.readInt32BE=er.readInt32BE,Xt.readFloatLE=er.readFloatLE,Xt.readFloatBE=er.readFloatBE,Xt.readDoubleLE=er.readDoubleLE,Xt.readDoubleBE=er.readDoubleBE,Xt.writeUInt8=er.writeUInt8,Xt.writeUInt16LE=er.writeUInt16LE,Xt.writeUInt16BE=er.writeUInt16BE,Xt.writeUInt32LE=er.writeUInt32LE,Xt.writeUInt32BE=er.writeUInt32BE,Xt.writeInt8=er.writeInt8,Xt.writeInt16LE=er.writeInt16LE,Xt.writeInt16BE=er.writeInt16BE,Xt.writeInt32LE=er.writeInt32LE,Xt.writeInt32BE=er.writeInt32BE,Xt.writeFloatLE=er.writeFloatLE,Xt.writeFloatBE=er.writeFloatBE,Xt.writeDoubleLE=er.writeDoubleLE,Xt.writeDoubleBE=er.writeDoubleBE,Xt.fill=er.fill,Xt.inspect=er.inspect,Xt.toArrayBuffer=er.toArrayBuffer,Xt}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){kt=tt("buffer").Buffer;var wn=new kt(4);wn.fill(0),st.exports={hash:function(_n,$t,bn,Nt){return kt.isBuffer(_n)||(_n=new kt(_n)),function(jt,Yt,Bn){for(var un=new kt(Yt),Cn=Bn?un.writeInt32BE:un.writeInt32LE,Qt=0;Qt<jt.length;Qt++)Cn.call(un,jt[Qt],4*Qt,!0);return un}($t(function(jt,Yt){var Bn;jt.length%4!=0&&(Bn=jt.length+(4-jt.length%4),jt=kt.concat([jt,wn],Bn));for(var un=[],Cn=Yt?jt.readInt32BE:jt.readInt32LE,Qt=0;Qt<jt.length;Qt+=4)un.push(Cn.call(jt,Qt));return un}(_n,Nt),8*_n.length),bn,Nt)}}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){kt=tt("buffer").Buffer;var wn=tt("./sha"),_n=tt("./sha256"),$t=tt("./rng"),bn={sha1:wn,sha256:_n,md5:tt("./md5")},Nt=64,jt=new kt(Nt);function Yt(un,Cn){var Qt=bn[un=un||"sha1"],Wt=[];return Qt||Bn("algorithm:",un,"is not yet supported"),{update:function(Zt){return kt.isBuffer(Zt)||(Zt=new kt(Zt)),Wt.push(Zt),Zt.length,this},digest:function(Zt){var En=kt.concat(Wt),pn=Cn?function(er,Ir,Dr){kt.isBuffer(Ir)||(Ir=new kt(Ir)),kt.isBuffer(Dr)||(Dr=new kt(Dr)),Ir.length>Nt?Ir=er(Ir):Ir.length<Nt&&(Ir=kt.concat([Ir,jt],Nt));for(var zr=new kt(Nt),Ar=new kt(Nt),Hr=0;Hr<Nt;Hr++)zr[Hr]=54^Ir[Hr],Ar[Hr]=92^Ir[Hr];var Xn=er(kt.concat([zr,Dr]));return er(kt.concat([Ar,Xn]))}(Qt,Cn,En):Qt(En);return Wt=null,Zt?pn.toString(Zt):pn}}}function Bn(){var un=[].slice.call(arguments).join(" ");throw new Error([un,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}jt.fill(0),b.createHash=function(un){return Yt(un)},b.createHmac=Yt,b.randomBytes=function(un,Cn){if(!Cn||!Cn.call)return new kt($t(un));try{Cn.call(this,void 0,new kt($t(un)))}catch(Qt){Cn(Qt)}},function(un,Cn){for(var Qt in un)Cn(un[Qt])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(un){b[un]=function(){Bn("sorry,",un,"is not implemented yet")}})}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){var wn=tt("./helpers");function _n(un,Cn){un[Cn>>5]|=128<<Cn%32,un[14+(Cn+64>>>9<<4)]=Cn;for(var Qt=1732584193,Wt=-271733879,Zt=-1732584194,En=271733878,pn=0;pn<un.length;pn+=16){var er=Qt,Ir=Wt,Dr=Zt,zr=En;Qt=bn(Qt,Wt,Zt,En,un[pn+0],7,-680876936),En=bn(En,Qt,Wt,Zt,un[pn+1],12,-389564586),Zt=bn(Zt,En,Qt,Wt,un[pn+2],17,606105819),Wt=bn(Wt,Zt,En,Qt,un[pn+3],22,-1044525330),Qt=bn(Qt,Wt,Zt,En,un[pn+4],7,-176418897),En=bn(En,Qt,Wt,Zt,un[pn+5],12,1200080426),Zt=bn(Zt,En,Qt,Wt,un[pn+6],17,-1473231341),Wt=bn(Wt,Zt,En,Qt,un[pn+7],22,-45705983),Qt=bn(Qt,Wt,Zt,En,un[pn+8],7,1770035416),En=bn(En,Qt,Wt,Zt,un[pn+9],12,-1958414417),Zt=bn(Zt,En,Qt,Wt,un[pn+10],17,-42063),Wt=bn(Wt,Zt,En,Qt,un[pn+11],22,-1990404162),Qt=bn(Qt,Wt,Zt,En,un[pn+12],7,1804603682),En=bn(En,Qt,Wt,Zt,un[pn+13],12,-40341101),Zt=bn(Zt,En,Qt,Wt,un[pn+14],17,-1502002290),Qt=Nt(Qt,Wt=bn(Wt,Zt,En,Qt,un[pn+15],22,1236535329),Zt,En,un[pn+1],5,-165796510),En=Nt(En,Qt,Wt,Zt,un[pn+6],9,-1069501632),Zt=Nt(Zt,En,Qt,Wt,un[pn+11],14,643717713),Wt=Nt(Wt,Zt,En,Qt,un[pn+0],20,-373897302),Qt=Nt(Qt,Wt,Zt,En,un[pn+5],5,-701558691),En=Nt(En,Qt,Wt,Zt,un[pn+10],9,38016083),Zt=Nt(Zt,En,Qt,Wt,un[pn+15],14,-660478335),Wt=Nt(Wt,Zt,En,Qt,un[pn+4],20,-405537848),Qt=Nt(Qt,Wt,Zt,En,un[pn+9],5,568446438),En=Nt(En,Qt,Wt,Zt,un[pn+14],9,-1019803690),Zt=Nt(Zt,En,Qt,Wt,un[pn+3],14,-187363961),Wt=Nt(Wt,Zt,En,Qt,un[pn+8],20,1163531501),Qt=Nt(Qt,Wt,Zt,En,un[pn+13],5,-1444681467),En=Nt(En,Qt,Wt,Zt,un[pn+2],9,-51403784),Zt=Nt(Zt,En,Qt,Wt,un[pn+7],14,1735328473),Qt=jt(Qt,Wt=Nt(Wt,Zt,En,Qt,un[pn+12],20,-1926607734),Zt,En,un[pn+5],4,-378558),En=jt(En,Qt,Wt,Zt,un[pn+8],11,-2022574463),Zt=jt(Zt,En,Qt,Wt,un[pn+11],16,1839030562),Wt=jt(Wt,Zt,En,Qt,un[pn+14],23,-35309556),Qt=jt(Qt,Wt,Zt,En,un[pn+1],4,-1530992060),En=jt(En,Qt,Wt,Zt,un[pn+4],11,1272893353),Zt=jt(Zt,En,Qt,Wt,un[pn+7],16,-155497632),Wt=jt(Wt,Zt,En,Qt,un[pn+10],23,-1094730640),Qt=jt(Qt,Wt,Zt,En,un[pn+13],4,681279174),En=jt(En,Qt,Wt,Zt,un[pn+0],11,-358537222),Zt=jt(Zt,En,Qt,Wt,un[pn+3],16,-722521979),Wt=jt(Wt,Zt,En,Qt,un[pn+6],23,76029189),Qt=jt(Qt,Wt,Zt,En,un[pn+9],4,-640364487),En=jt(En,Qt,Wt,Zt,un[pn+12],11,-421815835),Zt=jt(Zt,En,Qt,Wt,un[pn+15],16,530742520),Qt=Yt(Qt,Wt=jt(Wt,Zt,En,Qt,un[pn+2],23,-995338651),Zt,En,un[pn+0],6,-198630844),En=Yt(En,Qt,Wt,Zt,un[pn+7],10,1126891415),Zt=Yt(Zt,En,Qt,Wt,un[pn+14],15,-1416354905),Wt=Yt(Wt,Zt,En,Qt,un[pn+5],21,-57434055),Qt=Yt(Qt,Wt,Zt,En,un[pn+12],6,1700485571),En=Yt(En,Qt,Wt,Zt,un[pn+3],10,-1894986606),Zt=Yt(Zt,En,Qt,Wt,un[pn+10],15,-1051523),Wt=Yt(Wt,Zt,En,Qt,un[pn+1],21,-2054922799),Qt=Yt(Qt,Wt,Zt,En,un[pn+8],6,1873313359),En=Yt(En,Qt,Wt,Zt,un[pn+15],10,-30611744),Zt=Yt(Zt,En,Qt,Wt,un[pn+6],15,-1560198380),Wt=Yt(Wt,Zt,En,Qt,un[pn+13],21,1309151649),Qt=Yt(Qt,Wt,Zt,En,un[pn+4],6,-145523070),En=Yt(En,Qt,Wt,Zt,un[pn+11],10,-1120210379),Zt=Yt(Zt,En,Qt,Wt,un[pn+2],15,718787259),Wt=Yt(Wt,Zt,En,Qt,un[pn+9],21,-343485551),Qt=Bn(Qt,er),Wt=Bn(Wt,Ir),Zt=Bn(Zt,Dr),En=Bn(En,zr)}return Array(Qt,Wt,Zt,En)}function $t(un,Cn,Qt,Wt,Zt,En){return Bn((pn=Bn(Bn(Cn,un),Bn(Wt,En)))<<(er=Zt)|pn>>>32-er,Qt);var pn,er}function bn(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn&Qt|~Cn&Wt,un,Cn,Zt,En,pn)}function Nt(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn&Wt|Qt&~Wt,un,Cn,Zt,En,pn)}function jt(un,Cn,Qt,Wt,Zt,En,pn){return $t(Cn^Qt^Wt,un,Cn,Zt,En,pn)}function Yt(un,Cn,Qt,Wt,Zt,En,pn){return $t(Qt^(Cn|~Wt),un,Cn,Zt,En,pn)}function Bn(un,Cn){var Qt=(65535&un)+(65535&Cn);return(un>>16)+(Cn>>16)+(Qt>>16)<<16|65535&Qt}st.exports=function(un){return wn.hash(un,_n,16)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){var wn;wn=function(_n){for(var $t,bn=new Array(_n),Nt=0;Nt<_n;Nt++)!(3&Nt)&&($t=4294967296*Math.random()),bn[Nt]=$t>>>((3&Nt)<<3)&255;return bn},st.exports=wn}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){var wn=tt("./helpers");function _n(Nt,jt){Nt[jt>>5]|=128<<24-jt%32,Nt[15+(jt+64>>9<<4)]=jt;for(var Yt,Bn,un,Cn,Qt,Wt=Array(80),Zt=1732584193,En=-271733879,pn=-1732584194,er=271733878,Ir=-1009589776,Dr=0;Dr<Nt.length;Dr+=16){for(var zr=Zt,Ar=En,Hr=pn,Xn=er,ir=Ir,zn=0;zn<80;zn++){Wt[zn]=zn<16?Nt[Dr+zn]:bn(Wt[zn-3]^Wt[zn-8]^Wt[zn-14]^Wt[zn-16],1);var nr=$t($t(bn(Zt,5),(un=En,Cn=pn,Qt=er,(Bn=zn)<20?un&Cn|~un&Qt:!(Bn<40)&&Bn<60?un&Cn|un&Qt|Cn&Qt:un^Cn^Qt)),$t($t(Ir,Wt[zn]),(Yt=zn)<20?1518500249:Yt<40?1859775393:Yt<60?-1894007588:-899497514));Ir=er,er=pn,pn=bn(En,30),En=Zt,Zt=nr}Zt=$t(Zt,zr),En=$t(En,Ar),pn=$t(pn,Hr),er=$t(er,Xn),Ir=$t(Ir,ir)}return Array(Zt,En,pn,er,Ir)}function $t(Nt,jt){var Yt=(65535&Nt)+(65535&jt);return(Nt>>16)+(jt>>16)+(Yt>>16)<<16|65535&Yt}function bn(Nt,jt){return Nt<<jt|Nt>>>32-jt}st.exports=function(Nt){return wn.hash(Nt,_n,20,!0)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){function wn(Nt,jt){var Yt=(65535&Nt)+(65535&jt);return(Nt>>16)+(jt>>16)+(Yt>>16)<<16|65535&Yt}function _n(Nt,jt){return Nt>>>jt|Nt<<32-jt}function $t(Nt,jt){var Yt,Bn,un,Cn,Qt,Wt,Zt,En,pn,er,Ir=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),Dr=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),zr=new Array(64);Nt[jt>>5]|=128<<24-jt%32,Nt[15+(jt+64>>9<<4)]=jt;for(var Ar,Hr,Xn,ir,zn,nr,$n,Sr,Yn=0;Yn<Nt.length;Yn+=16){Yt=Dr[0],Bn=Dr[1],un=Dr[2],Cn=Dr[3],Qt=Dr[4],Wt=Dr[5],Zt=Dr[6],En=Dr[7];for(var Xt=0;Xt<64;Xt++)zr[Xt]=Xt<16?Nt[Xt+Yn]:wn(wn(wn(_n(Sr=zr[Xt-2],17)^_n(Sr,19)^Sr>>>10,zr[Xt-7]),_n($n=zr[Xt-15],7)^_n($n,18)^$n>>>3),zr[Xt-16]),pn=wn(wn(wn(wn(En,_n(nr=Qt,6)^_n(nr,11)^_n(nr,25)),(zn=Qt)&Wt^~zn&Zt),Ir[Xt]),zr[Xt]),er=wn(_n(ir=Yt,2)^_n(ir,13)^_n(ir,22),(Ar=Yt)&(Hr=Bn)^Ar&(Xn=un)^Hr&Xn),En=Zt,Zt=Wt,Wt=Qt,Qt=wn(Cn,pn),Cn=un,un=Bn,Bn=Yt,Yt=wn(pn,er);Dr[0]=wn(Yt,Dr[0]),Dr[1]=wn(Bn,Dr[1]),Dr[2]=wn(un,Dr[2]),Dr[3]=wn(Cn,Dr[3]),Dr[4]=wn(Qt,Dr[4]),Dr[5]=wn(Wt,Dr[5]),Dr[6]=wn(Zt,Dr[6]),Dr[7]=wn(En,Dr[7])}return Dr}var bn=tt("./helpers");st.exports=function(Nt){return bn.hash(Nt,$t,32,!0)}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){function wn(){}(yt=st.exports={}).nextTick=function(){var _n=typeof window<"u"&&window.setImmediate,$t=typeof window<"u"&&window.postMessage&&window.addEventListener;if(_n)return function(Nt){return window.setImmediate(Nt)};if($t){var bn=[];return window.addEventListener("message",function(Nt){var jt=Nt.source;jt!==window&&jt!==null||Nt.data!=="process-tick"||(Nt.stopPropagation(),0<bn.length&&bn.shift()())},!0),function(Nt){bn.push(Nt),window.postMessage("process-tick","*")}}return function(Nt){setTimeout(Nt,0)}}(),yt.title="browser",yt.browser=!0,yt.env={},yt.argv=[],yt.on=wn,yt.addListener=wn,yt.once=wn,yt.off=wn,yt.removeListener=wn,yt.removeAllListeners=wn,yt.emit=wn,yt.binding=function(_n){throw new Error("process.binding is not supported")},yt.cwd=function(){return"/"},yt.chdir=function(_n){throw new Error("process.chdir is not supported")}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(tt,st,b){(function(yt,Et,kt,Gt,Vt,an,Pn,mn,hn){b.read=function(wn,_n,$t,bn,Nt){var jt,Yt,Bn=8*Nt-bn-1,un=(1<<Bn)-1,Cn=un>>1,Qt=-7,Wt=$t?Nt-1:0,Zt=$t?-1:1,En=wn[_n+Wt];for(Wt+=Zt,jt=En&(1<<-Qt)-1,En>>=-Qt,Qt+=Bn;0<Qt;jt=256*jt+wn[_n+Wt],Wt+=Zt,Qt-=8);for(Yt=jt&(1<<-Qt)-1,jt>>=-Qt,Qt+=bn;0<Qt;Yt=256*Yt+wn[_n+Wt],Wt+=Zt,Qt-=8);if(jt===0)jt=1-Cn;else{if(jt===un)return Yt?NaN:1/0*(En?-1:1);Yt+=Math.pow(2,bn),jt-=Cn}return(En?-1:1)*Yt*Math.pow(2,jt-bn)},b.write=function(wn,_n,$t,bn,Nt,jt){var Yt,Bn,un,Cn=8*jt-Nt-1,Qt=(1<<Cn)-1,Wt=Qt>>1,Zt=Nt===23?Math.pow(2,-24)-Math.pow(2,-77):0,En=bn?0:jt-1,pn=bn?1:-1,er=_n<0||_n===0&&1/_n<0?1:0;for(_n=Math.abs(_n),isNaN(_n)||_n===1/0?(Bn=isNaN(_n)?1:0,Yt=Qt):(Yt=Math.floor(Math.log(_n)/Math.LN2),_n*(un=Math.pow(2,-Yt))<1&&(Yt--,un*=2),2<=(_n+=1<=Yt+Wt?Zt/un:Zt*Math.pow(2,1-Wt))*un&&(Yt++,un/=2),Qt<=Yt+Wt?(Bn=0,Yt=Qt):1<=Yt+Wt?(Bn=(_n*un-1)*Math.pow(2,Nt),Yt+=Wt):(Bn=_n*Math.pow(2,Wt-1)*Math.pow(2,Nt),Yt=0));8<=Nt;wn[$t+En]=255&Bn,En+=pn,Bn/=256,Nt-=8);for(Yt=Yt<<Nt|Bn,Cn+=Nt;0<Cn;wn[$t+En]=255&Yt,En+=pn,Yt/=256,Cn-=8);wn[$t+En-pn]|=128*er}}).call(this,tt("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},tt("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(j){var tt=function(){function st($t){return Pn($t,mn(an(hn($t.length),$t),1/$t.length))}function b($t){return an(wn($t),$t)}function yt($t,bn){return mn($t,bn?1/($t.length-1):1/$t.length)}function Et($t){var bn=function(jt){var Yt,Bn=Math.pow(2,-52),un=1e-64/Bn,Cn=0,Qt=0,Wt=0,Zt=0,En=0,pn=_n(jt),er=pn.length,Ir=pn[0].length;if(er<Ir)throw"Need more rows than columns";var Dr=new Array(Ir),zr=new Array(Ir);for(Qt=0;Qt<Ir;Qt++)Dr[Qt]=zr[Qt]=0;var Ar=function Nr(kr,jr,Ss){Ss===void 0&&(Ss=0);var zs,Ao=kr[Ss],Zs=Array(Ao);if(Ss===kr.length-1){for(zs=Ao-2;zs>=0;zs-=2)Zs[zs+1]=jr,Zs[zs]=jr;return zs===-1&&(Zs[0]=jr),Zs}for(zs=Ao-1;zs>=0;zs--)Zs[zs]=Nr(kr,jr,Ss+1);return Zs}([Ir,Ir],0);function Hr(Nr,kr){return(Nr=Math.abs(Nr))>(kr=Math.abs(kr))?Nr*Math.sqrt(1+kr*kr/Nr/Nr):kr==0?Nr:kr*Math.sqrt(1+Nr*Nr/kr/kr)}var Xn=0,ir=0,zn=0,nr=0,$n=0,Sr=0,Yn=0;for(Qt=0;Qt<Ir;Qt++){for(Dr[Qt]=ir,Yn=0,En=Qt+1,Wt=Qt;Wt<er;Wt++)Yn+=pn[Wt][Qt]*pn[Wt][Qt];if(Yn<=un)ir=0;else for(Xn=pn[Qt][Qt],ir=Math.sqrt(Yn),Xn>=0&&(ir=-ir),zn=Xn*ir-Yn,pn[Qt][Qt]=Xn-ir,Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=Qt;Zt<er;Zt++)Yn+=pn[Zt][Qt]*pn[Zt][Wt];for(Xn=Yn/zn,Zt=Qt;Zt<er;Zt++)pn[Zt][Wt]+=Xn*pn[Zt][Qt]}for(zr[Qt]=ir,Yn=0,Wt=En;Wt<Ir;Wt++)Yn+=pn[Qt][Wt]*pn[Qt][Wt];if(Yn<=un)ir=0;else{for(Xn=pn[Qt][Qt+1],ir=Math.sqrt(Yn),Xn>=0&&(ir=-ir),zn=Xn*ir-Yn,pn[Qt][Qt+1]=Xn-ir,Wt=En;Wt<Ir;Wt++)Dr[Wt]=pn[Qt][Wt]/zn;for(Wt=En;Wt<er;Wt++){for(Yn=0,Zt=En;Zt<Ir;Zt++)Yn+=pn[Wt][Zt]*pn[Qt][Zt];for(Zt=En;Zt<Ir;Zt++)pn[Wt][Zt]+=Yn*Dr[Zt]}}($n=Math.abs(zr[Qt])+Math.abs(Dr[Qt]))>nr&&(nr=$n)}for(Qt=Ir-1;Qt!=-1;Qt+=-1){if(ir!=0){for(zn=ir*pn[Qt][Qt+1],Wt=En;Wt<Ir;Wt++)Ar[Wt][Qt]=pn[Qt][Wt]/zn;for(Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=En;Zt<Ir;Zt++)Yn+=pn[Qt][Zt]*Ar[Zt][Wt];for(Zt=En;Zt<Ir;Zt++)Ar[Zt][Wt]+=Yn*Ar[Zt][Qt]}}for(Wt=En;Wt<Ir;Wt++)Ar[Qt][Wt]=0,Ar[Wt][Qt]=0;Ar[Qt][Qt]=1,ir=Dr[Qt],En=Qt}for(Qt=Ir-1;Qt!=-1;Qt+=-1){for(En=Qt+1,ir=zr[Qt],Wt=En;Wt<Ir;Wt++)pn[Qt][Wt]=0;if(ir!=0){for(zn=pn[Qt][Qt]*ir,Wt=En;Wt<Ir;Wt++){for(Yn=0,Zt=En;Zt<er;Zt++)Yn+=pn[Zt][Qt]*pn[Zt][Wt];for(Xn=Yn/zn,Zt=Qt;Zt<er;Zt++)pn[Zt][Wt]+=Xn*pn[Zt][Qt]}for(Wt=Qt;Wt<er;Wt++)pn[Wt][Qt]=pn[Wt][Qt]/ir}else for(Wt=Qt;Wt<er;Wt++)pn[Wt][Qt]=0;pn[Qt][Qt]+=1}for(Bn*=nr,Zt=Ir-1;Zt!=-1;Zt+=-1)for(var Xt=0;Xt<50;Xt++){var rn=!1;for(En=Zt;En!=-1;En+=-1){if(Math.abs(Dr[En])<=Bn){rn=!0;break}if(Math.abs(zr[En-1])<=Bn)break}if(!rn){Cn=0,Yn=1;var Fn=En-1;for(Qt=En;Qt<Zt+1&&(Xn=Yn*Dr[Qt],Dr[Qt]=Cn*Dr[Qt],!(Math.abs(Xn)<=Bn));Qt++)for(zn=Hr(Xn,ir=zr[Qt]),zr[Qt]=zn,Cn=ir/zn,Yn=-Xn/zn,Wt=0;Wt<er;Wt++)$n=pn[Wt][Fn],Sr=pn[Wt][Qt],pn[Wt][Fn]=$n*Cn+Sr*Yn,pn[Wt][Qt]=-$n*Yn+Sr*Cn}if(Sr=zr[Zt],En==Zt){if(Sr<0)for(zr[Zt]=-Sr,Wt=0;Wt<Ir;Wt++)Ar[Wt][Zt]=-Ar[Wt][Zt];break}if(Xt>=49)throw"Error: no convergence.";for(nr=zr[En],ir=Hr(Xn=((($n=zr[Zt-1])-Sr)*($n+Sr)+((ir=Dr[Zt-1])-(zn=Dr[Zt]))*(ir+zn))/(2*zn*$n),1),Xn=Xn<0?((nr-Sr)*(nr+Sr)+zn*($n/(Xn-ir)-zn))/nr:((nr-Sr)*(nr+Sr)+zn*($n/(Xn+ir)-zn))/nr,Cn=1,Yn=1,Qt=En+1;Qt<Zt+1;Qt++){for(ir=Dr[Qt],$n=zr[Qt],zn=Yn*ir,ir*=Cn,Sr=Hr(Xn,zn),Dr[Qt-1]=Sr,Xn=nr*(Cn=Xn/Sr)+ir*(Yn=zn/Sr),ir=-nr*Yn+ir*Cn,zn=$n*Yn,$n*=Cn,Wt=0;Wt<Ir;Wt++)nr=Ar[Wt][Qt-1],Sr=Ar[Wt][Qt],Ar[Wt][Qt-1]=nr*Cn+Sr*Yn,Ar[Wt][Qt]=-nr*Yn+Sr*Cn;for(Sr=Hr(Xn,zn),zr[Qt-1]=Sr,Xn=(Cn=Xn/Sr)*ir+(Yn=zn/Sr)*$n,nr=-Yn*ir+Cn*$n,Wt=0;Wt<er;Wt++)$n=pn[Wt][Qt-1],Sr=pn[Wt][Qt],pn[Wt][Qt-1]=$n*Cn+Sr*Yn,pn[Wt][Qt]=-$n*Yn+Sr*Cn}Dr[En]=0,Dr[Zt]=Xn,zr[Zt]=nr}for(Qt=0;Qt<zr.length;Qt++)zr[Qt]<Bn&&(zr[Qt]=0);for(Qt=0;Qt<Ir;Qt++)for(Wt=Qt-1;Wt>=0;Wt--)if(zr[Wt]<zr[Qt]){for(Cn=zr[Wt],zr[Wt]=zr[Qt],zr[Qt]=Cn,Zt=0;Zt<pn.length;Zt++)Yt=pn[Zt][Qt],pn[Zt][Qt]=pn[Zt][Wt],pn[Zt][Wt]=Yt;for(Zt=0;Zt<Ar.length;Zt++)Yt=Ar[Zt][Qt],Ar[Zt][Qt]=Ar[Zt][Wt],Ar[Zt][Wt]=Yt;Qt=Wt}return{U:pn,S:zr,V:Ar}}($t);console.log(bn);var Nt=bn.U;return bn.S.map(function(jt,Yt){var Bn={};return Bn.eigenvalue=jt,Bn.vector=Nt.map(function(un,Cn){return-1*un[Yt]}),Bn})}function kt($t,...bn){var Nt=bn.map(function(Bn){return Bn.vector}),jt=an(Nt,wn(st($t))),Yt=mn(an(hn($t.length),$t),-1/$t.length);return{adjustedData:jt,formattedAdjustedData:Vt(jt,2),avgData:Yt,selectedVectors:Nt}}function Gt($t){return Et(yt(b(st($t)),!1))}function Vt($t,bn){var Nt=Math.pow(10,bn||2);return $t.map(function(jt,Yt){return jt.map(function(Bn){return Math.round(Bn*Nt)/Nt})})}function an($t,bn){if(!($t[0]&&bn[0]&&$t.length&&bn.length))throw new Error("Both A and B should be matrices");if(bn.length!==$t[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var Nt=[],jt=0;jt<$t.length;jt++){Nt[jt]=[];for(var Yt=0;Yt<bn[0].length;Yt++)for(var Bn=0;Bn<$t[0].length;Bn++)Nt[jt][Yt]=Nt[jt][Yt]?Nt[jt][Yt]+$t[jt][Bn]*bn[Bn][Yt]:$t[jt][Bn]*bn[Bn][Yt]}return Nt}function Pn($t,bn){if($t.length!==bn.length||$t[0].length!==bn[0].length)throw new Error("Both A and B should have the same dimensions");for(var Nt=[],jt=0;jt<$t.length;jt++){Nt[jt]=[];for(var Yt=0;Yt<bn[0].length;Yt++)Nt[jt][Yt]=$t[jt][Yt]-bn[jt][Yt]}return Nt}function mn($t,bn){for(var Nt=[],jt=0;jt<$t.length;jt++){Nt[jt]=[];for(var Yt=0;Yt<$t[0].length;Yt++)Nt[jt][Yt]=$t[jt][Yt]*bn}return Nt}function hn($t){for(var bn=[],Nt=0;Nt<$t;Nt++){bn[Nt]=[];for(var jt=0;jt<$t;jt++)bn[Nt][jt]=1}return bn}function wn($t){return _n($t)[0].map(function(bn,Nt){return $t.map(function(jt){return jt[Nt]})})}function _n($t){var bn=JSON.stringify($t);return JSON.parse(bn)}return{computeDeviationScores:b,computeDeviationMatrix:st,computeSVD:Et,computePercentageExplained:function($t,...bn){var Nt=$t.map(function(jt){return jt.eigenvalue}).reduce(function(jt,Yt){return jt+Yt});return bn.map(function(jt){return jt.eigenvalue}).reduce(function(jt,Yt){return jt+Yt})/Nt},computeOriginalData:function($t,bn,Nt){var jt=Pn(wn(an(wn(bn),$t)),Nt);return{originalData:jt,formattedOriginalData:Vt(jt,2)}},computeVarianceCovariance:yt,computeAdjustedData:kt,getEigenVectors:Gt,analyseTopResult:function($t){var bn=Gt($t).sort(function(Nt,jt){return jt.eigenvalue-Nt.eigenvalue});return console.log("Sorted Vectors",bn),kt($t,bn[0].vector)},transpose:wn,multiply:an,clone:_n,scale:mn}}();j.exports=tt},701:function(j){var tt=[];function st(Et){for(var kt=-1,Gt=0;Gt<tt.length;Gt++)if(tt[Gt].identifier===Et){kt=Gt;break}return kt}function b(Et,kt){for(var Gt={},Vt=[],an=0;an<Et.length;an++){var Pn=Et[an],mn=kt.base?Pn[0]+kt.base:Pn[0],hn=Gt[mn]||0,wn="".concat(mn," ").concat(hn);Gt[mn]=hn+1;var _n=st(wn),$t={css:Pn[1],media:Pn[2],sourceMap:Pn[3],supports:Pn[4],layer:Pn[5]};if(_n!==-1)tt[_n].references++,tt[_n].updater($t);else{var bn=yt($t,kt);kt.byIndex=an,tt.splice(an,0,{identifier:wn,updater:bn,references:1})}Vt.push(wn)}return Vt}function yt(Et,kt){var Gt=kt.domAPI(kt);return Gt.update(Et),function(Vt){if(Vt){if(Vt.css===Et.css&&Vt.media===Et.media&&Vt.sourceMap===Et.sourceMap&&Vt.supports===Et.supports&&Vt.layer===Et.layer)return;Gt.update(Et=Vt)}else Gt.remove()}}j.exports=function(Et,kt){var Gt=b(Et=Et||[],kt=kt||{});return function(Vt){Vt=Vt||[];for(var an=0;an<Gt.length;an++){var Pn=st(Gt[an]);tt[Pn].references--}for(var mn=b(Vt,kt),hn=0;hn<Gt.length;hn++){var wn=st(Gt[hn]);tt[wn].references===0&&(tt[wn].updater(),tt.splice(wn,1))}Gt=mn}}},182:function(j){j.exports=function(tt){var st=document.createElement("style");return tt.setAttributes(st,tt.attributes),tt.insert(st,tt.options),st}},850:function(j,tt,st){j.exports=function(b){var yt=st.nc;yt&&b.setAttribute("nonce",yt)}},236:function(j){j.exports=function(tt){var st=tt.insertStyleElement(tt);return{update:function(b){(function(yt,Et,kt){var Gt="";kt.supports&&(Gt+="@supports (".concat(kt.supports,") {")),kt.media&&(Gt+="@media ".concat(kt.media," {"));var Vt=kt.layer!==void 0;Vt&&(Gt+="@layer".concat(kt.layer.length>0?" ".concat(kt.layer):""," {")),Gt+=kt.css,Vt&&(Gt+="}"),kt.media&&(Gt+="}"),kt.supports&&(Gt+="}");var an=kt.sourceMap;an&&typeof btoa<"u"&&(Gt+=`
/`,Gt+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(an))))," *"),Gt+="/"),Et.styleTagTransform(Gt,yt,Et.options)})(st,tt,b)},remove:function(){(function(b){if(b.parentNode===null)return!1;b.parentNode.removeChild(b)})(st)}}}},213:function(j){j.exports=function(tt,st){if(st.styleSheet)st.styleSheet.cssText=tt;else{for(;st.firstChild;)st.removeChild(st.firstChild);st.appendChild(document.createTextNode(tt))}}},1:function(j){j.exports=function(){var tt={820:function(Et,kt,Gt){var Vt=Gt(537),an=Gt.n(Vt),Pn=Gt(645),mn=Gt.n(Pn)()(an());mn.push([Et.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),kt.Z=mn},645:function(Et){Et.exports=function(kt){var Gt=[];return Gt.toString=function(){return this.map(function(Vt){var an="",Pn=Vt[5]!==void 0;return Vt[4]&&(an+="@supports (".concat(Vt[4],") {")),Vt[2]&&(an+="@media ".concat(Vt[2]," {")),Pn&&(an+="@layer".concat(Vt[5].length>0?" ".concat(Vt[5]):""," {")),an+=kt(Vt),Pn&&(an+="}"),Vt[2]&&(an+="}"),Vt[4]&&(an+="}"),an}).join("")},Gt.i=function(Vt,an,Pn,mn,hn){typeof Vt=="string"&&(Vt=[[null,Vt,void 0]]);var wn={};if(Pn)for(var _n=0;_n<this.length;_n++){var $t=this[_n][0];$t!=null&&(wn[$t]=!0)}for(var bn=0;bn<Vt.length;bn++){var Nt=[].concat(Vt[bn]);Pn&&wn[Nt[0]]||(hn!==void 0&&(Nt[5]===void 0||(Nt[1]="@layer".concat(Nt[5].length>0?" ".concat(Nt[5]):""," {").concat(Nt[1],"}")),Nt[5]=hn),an&&(Nt[2]&&(Nt[1]="@media ".concat(Nt[2]," {").concat(Nt[1],"}")),Nt[2]=an),mn&&(Nt[4]?(Nt[1]="@supports (".concat(Nt[4],") {").concat(Nt[1],"}"),Nt[4]=mn):Nt[4]="".concat(mn)),Gt.push(Nt))}},Gt}},537:function(Et){Et.exports=function(kt){var Gt=kt[1],Vt=kt[3];if(!Vt)return Gt;if(typeof btoa=="function"){var an=btoa(unescape(encodeURIComponent(JSON.stringify(Vt)))),Pn="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(an),mn="/*# ".concat(Pn," */"),hn=Vt.sources.map(function(wn){return"/*# sourceURL=".concat(Vt.sourceRoot||"").concat(wn," */")});return[Gt].concat(hn).concat([mn]).join(`
`)}return[Gt].join(`
`)}},379:function(Et){var kt=[];function Gt(Pn){for(var mn=-1,hn=0;hn<kt.length;hn++)if(kt[hn].identifier===Pn){mn=hn;break}return mn}function Vt(Pn,mn){for(var hn={},wn=[],_n=0;_n<Pn.length;_n++){var $t=Pn[_n],bn=mn.base?$t[0]+mn.base:$t[0],Nt=hn[bn]||0,jt="".concat(bn," ").concat(Nt);hn[bn]=Nt+1;var Yt=Gt(jt),Bn={css:$t[1],media:$t[2],sourceMap:$t[3],supports:$t[4],layer:$t[5]};if(Yt!==-1)kt[Yt].references++,kt[Yt].updater(Bn);else{var un=an(Bn,mn);mn.byIndex=_n,kt.splice(_n,0,{identifier:jt,updater:un,references:1})}wn.push(jt)}return wn}function an(Pn,mn){var hn=mn.domAPI(mn);return hn.update(Pn),function(wn){if(wn){if(wn.css===Pn.css&&wn.media===Pn.media&&wn.sourceMap===Pn.sourceMap&&wn.supports===Pn.supports&&wn.layer===Pn.layer)return;hn.update(Pn=wn)}else hn.remove()}}Et.exports=function(Pn,mn){var hn=Vt(Pn=Pn||[],mn=mn||{});return function(wn){wn=wn||[];for(var _n=0;_n<hn.length;_n++){var $t=Gt(hn[_n]);kt[$t].references--}for(var bn=Vt(wn,mn),Nt=0;Nt<hn.length;Nt++){var jt=Gt(hn[Nt]);kt[jt].references===0&&(kt[jt].updater(),kt.splice(jt,1))}hn=bn}}},216:function(Et){Et.exports=function(kt){var Gt=document.createElement("style");return kt.setAttributes(Gt,kt.attributes),kt.insert(Gt,kt.options),Gt}},636:function(Et,kt,Gt){Et.exports=function(Vt){var an=Gt.nc;an&&Vt.setAttribute("nonce",an)}},795:function(Et){Et.exports=function(kt){var Gt=kt.insertStyleElement(kt);return{update:function(Vt){(function(an,Pn,mn){var hn="";mn.supports&&(hn+="@supports (".concat(mn.supports,") {")),mn.media&&(hn+="@media ".concat(mn.media," {"));var wn=mn.layer!==void 0;wn&&(hn+="@layer".concat(mn.layer.length>0?" ".concat(mn.layer):""," {")),hn+=mn.css,wn&&(hn+="}"),mn.media&&(hn+="}"),mn.supports&&(hn+="}");var _n=mn.sourceMap;_n&&typeof btoa<"u"&&(hn+=`
/`,hn+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(_n))))," *"),hn+="/"),Pn.styleTagTransform(hn,an,Pn.options)})(Gt,kt,Vt)},remove:function(){(function(Vt){if(Vt.parentNode===null)return!1;Vt.parentNode.removeChild(Vt)})(Gt)}}}},589:function(Et){Et.exports=function(kt,Gt){if(Gt.styleSheet)Gt.styleSheet.cssText=kt;else{for(;Gt.firstChild;)Gt.removeChild(Gt.firstChild);Gt.appendChild(document.createTextNode(kt))}}}},st={};function b(Et){var kt=st[Et];if(kt!==void 0)return kt.exports;var Gt=st[Et]={id:Et,exports:{}};return tt[Et](Gt,Gt.exports,b),Gt.exports}b.n=function(Et){var kt=Et&&Et.__esModule?function(){return Et.default}:function(){return Et};return b.d(kt,{a:kt}),kt},b.d=function(Et,kt){for(var Gt in kt)b.o(kt,Gt)&&!b.o(Et,Gt)&&Object.defineProperty(Et,Gt,{enumerable:!0,get:kt[Gt]})},b.o=function(Et,kt){return Object.prototype.hasOwnProperty.call(Et,kt)},b.nc=void 0;var yt={};return function(){b.d(yt,{default:function(){return zr}});var Et=b(379),kt=b.n(Et),Gt=b(795),Vt=b.n(Gt),an=b(636),Pn=b.n(an),mn=b(216),hn=b.n(mn),wn=b(589),_n=b.n(wn),$t=b(820),bn={};$t.Z&&$t.Z.locals&&(bn.locals=$t.Z.locals);var Nt,jt=0,Yt={};Yt.styleTagTransform=_n(),Yt.setAttributes=Pn(),Yt.insert=function(Ar,Hr){(Hr.target||document.head).appendChild(Ar)},Yt.domAPI=Vt(),Yt.insertStyleElement=hn(),bn.use=function(Ar){return Yt.options=Ar||{},jt++||(Nt=kt()($t.Z,Yt)),bn},bn.unuse=function(){jt>0&&!--jt&&(Nt(),Nt=null)};var Bn=bn;function un(Ar,Hr){return function(Xn){if(Array.isArray(Xn))return Xn}(Ar)||function(Xn,ir){var zn=Xn==null?null:typeof Symbol<"u"&&Xn[Symbol.iterator]||Xn["@@iterator"];if(zn!=null){var nr,$n,Sr=[],Yn=!0,Xt=!1;try{for(zn=zn.call(Xn);!(Yn=(nr=zn.next()).done)&&(Sr.push(nr.value),!ir||Sr.length!==ir);Yn=!0);}catch(rn){Xt=!0,$n=rn}finally{try{Yn||zn.return==null||zn.return()}finally{if(Xt)throw $n}}return Sr}}(Ar,Hr)||function(Xn,ir){if(Xn){if(typeof Xn=="string")return Cn(Xn,ir);var zn=Object.prototype.toString.call(Xn).slice(8,-1);return zn==="Object"&&Xn.constructor&&(zn=Xn.constructor.name),zn==="Map"||zn==="Set"?Array.from(Xn):zn==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(zn)?Cn(Xn,ir):void 0}}(Ar,Hr)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Cn(Ar,Hr){(Hr==null||Hr>Ar.length)&&(Hr=Ar.length);for(var Xn=0,ir=new Array(Hr);Xn<Hr;Xn++)ir[Xn]=Ar[Xn];return ir}function Qt(Ar,Hr){var Xn=Object.keys(Ar);if(Object.getOwnPropertySymbols){var ir=Object.getOwnPropertySymbols(Ar);Hr&&(ir=ir.filter(function(zn){return Object.getOwnPropertyDescriptor(Ar,zn).enumerable})),Xn.push.apply(Xn,ir)}return Xn}function Wt(Ar){for(var Hr=1;Hr<arguments.length;Hr++){var Xn=arguments[Hr]!=null?arguments[Hr]:{};Hr%2?Qt(Object(Xn),!0).forEach(function(ir){Zt(Ar,ir,Xn[ir])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ar,Object.getOwnPropertyDescriptors(Xn)):Qt(Object(Xn)).forEach(function(ir){Object.defineProperty(Ar,ir,Object.getOwnPropertyDescriptor(Xn,ir))})}return Ar}function Zt(Ar,Hr,Xn){return Hr in Ar?Object.defineProperty(Ar,Hr,{value:Xn,enumerable:!0,configurable:!0,writable:!0}):Ar[Hr]=Xn,Ar}function En(Ar,Hr){for(var Xn=0;Xn<Hr.length;Xn++){var ir=Hr[Xn];ir.enumerable=ir.enumerable||!1,ir.configurable=!0,"value"in ir&&(ir.writable=!0),Object.defineProperty(Ar,ir.key,ir)}}function pn(Ar){var Hr={};return Ar.reduce(function(Xn,ir){return Hr[ir]||(Hr[ir]=!0,Xn.push(ir)),Xn},[])}function er(Ar,Hr){requestAnimationFrame(function(){Hr.enter(),requestAnimationFrame(function(){Hr.active(),setTimeout(function(){Hr.leave()},Ar)})})}function Ir(Ar,Hr){try{var Xn=Ar.liElementsById[Hr.parent.id];Xn.classList.contains("treejs-node__close")||Xn.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Hr,"parent")&&Ir(Ar,Hr.parent)}function Dr(Ar,Hr){var Xn=Ar.liElementsById[Hr.id];Xn.classList.contains("treejs-node__close")&&Xn.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Hr,"children")&&Hr.children.forEach(function(ir){return Dr(Ar,ir)})}var zr=function(){function Ar(zn,nr){(function($n,Sr){if(!($n instanceof Sr))throw new TypeError("Cannot call a class as a function")})(this,Ar),Bn.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=zn,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},nr),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function($n){this.setValues(pn($n))}},disables:{get:function(){return this.getDisables()},set:function($n){this.setDisables(pn($n))}},selectedNodes:{get:function(){var $n=[],Sr=this.nodesById;return Object.keys(Sr).forEach(function(Yn){if(Object.prototype.hasOwnProperty.call(Sr,Yn)&&(Sr[Yn].status===1||Sr[Yn].status===2)){var Xt=Wt({},Sr[Yn]);delete Xt.parent,delete Xt.children,$n.push(Xt)}}),$n}},disabledNodes:{get:function(){var $n=[],Sr=this.nodesById;return Object.keys(Sr).forEach(function(Yn){if(Object.prototype.hasOwnProperty.call(Sr,Yn)&&Sr[Yn].disabled){var Xt=Wt({},Sr[Yn]);delete Xt.parent,$n.push(Xt)}}),$n}}}),this.init(this.options.data)}var Hr,Xn,ir;return Hr=Ar,ir=[{key:"onSwitcherClick",value:function(zn){var nr=zn.parentNode,$n=nr.lastChild,Sr=$n.scrollHeight;nr.classList.contains("treejs-node__close")?er(150,{enter:function(){$n.style.height=0,$n.style.opacity=0},active:function(){$n.style.height="".concat(Sr,"px"),$n.style.opacity=1},leave:function(){$n.style.height="",$n.style.opacity="",nr.classList.remove("treejs-node__close")}}):er(150,{enter:function(){$n.style.height="".concat(Sr,"px"),$n.style.opacity=1},active:function(){$n.style.height=0,$n.style.opacity=0},leave:function(){$n.style.height="",$n.style.opacity="",nr.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(zn){var nr,$n=(nr=zn,JSON.parse(JSON.stringify(nr))),Sr={},Yn={},Xt=[],rn=[];return function Fn(Nr,kr){Nr.forEach(function(jr){Sr[jr.id]=jr,jr.checked&&Xt.push(jr.id),jr.disabled&&rn.push(jr.id),kr&&(jr.parent=kr),jr.children&&jr.children.length?Fn(jr.children,jr):Yn[jr.id]=jr})}($n),{treeNodes:$n,nodesById:Sr,leafNodesById:Yn,defaultValues:Xt,defaultDisables:rn}}},{key:"createRootEle",value:function(){var zn=document.createElement("div");return zn.classList.add("treejs"),zn}},{key:"createUlEle",value:function(){var zn=document.createElement("ul");return zn.classList.add("treejs-nodes"),zn}},{key:"createLiEle",value:function(zn,nr){var $n=document.createElement("li");if($n.classList.add("treejs-node"),nr&&$n.classList.add("treejs-node__close"),zn.children&&zn.children.length){var Sr=document.createElement("span");Sr.classList.add("treejs-switcher"),$n.appendChild(Sr)}else $n.classList.add("treejs-placeholder");var Yn=document.createElement("span");Yn.classList.add("treejs-checkbox"),$n.appendChild(Yn);var Xt=document.createElement("span");Xt.classList.add("treejs-label");var rn=document.createTextNode(zn.text);return Xt.appendChild(rn),$n.appendChild(Xt),$n.nodeId=zn.id,$n}}],(Xn=[{key:"init",value:function(zn){var nr=Ar.parseTreeData(zn),$n=nr.treeNodes,Sr=nr.nodesById,Yn=nr.leafNodesById,Xt=nr.defaultValues,rn=nr.defaultDisables;this.treeNodes=$n,this.nodesById=Sr,this.leafNodesById=Yn,this.render(this.treeNodes);var Fn=this.options,Nr=Fn.values,kr=Fn.disables,jr=Fn.loaded;Nr&&Nr.length?this.setValues(Nr):Xt&&Xt.length&&this.setValues(Xt),kr&&kr.length?this.setDisables(kr):rn&&rn.length&&this.setDisables(rn),typeof jr=="function"&&jr.call(this)}},{key:"render",value:function(zn){var nr=Ar.createRootEle();nr.appendChild(this.buildTree(zn,0)),this.bindEvent(nr);var $n=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(Sr){for(;Sr.firstChild;)Sr.removeChild(Sr.firstChild)})($n),$n.appendChild(nr)}},{key:"buildTree",value:function(zn,nr){var $n=this,Sr=Ar.createUlEle();return zn&&zn.length&&zn.forEach(function(Yn){var Xt=Ar.createLiEle(Yn,nr===$n.options.closeDepth-1);$n.liElementsById[Yn.id]=Xt;var rn=null;Yn.children&&Yn.children.length&&(rn=$n.buildTree(Yn.children,nr+1)),rn&&Xt.appendChild(rn),Sr.appendChild(Xt)}),Sr}},{key:"bindEvent",value:function(zn){var nr=this;zn.addEventListener("click",function($n){var Sr=$n.target;Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-checkbox")?nr.onItemClick(Sr.parentNode.nodeId):Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-label")?nr.onItemLabelClick(Sr.parentNode.nodeId):Sr.nodeName==="LI"&&Sr.classList.contains("treejs-node")?nr.onItemClick(Sr.nodeId):Sr.nodeName==="SPAN"&&Sr.classList.contains("treejs-switcher")&&Ar.onSwitcherClick(Sr)},!1)}},{key:"onItemClick",value:function(zn){var nr=this.nodesById[zn],$n=this.options.onChange;nr.disabled||(this.setValue(zn),this.updateLiElements()),$n&&$n.call(this)}},{key:"onItemLabelClick",value:function(zn){var nr=this.options.onItemLabelClick;nr&&nr.call(this,zn)}},{key:"setValue",value:function(zn){var nr=this.nodesById[zn];if(nr){var $n=nr.status,Sr=$n===1||$n===2?0:2;nr.status=Sr,this.markWillUpdateNode(nr),this.walkUp(nr,"status"),this.walkDown(nr,"status")}}},{key:"getValues",value:function(){var zn=this,nr=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(zn.leafNodesById,$n)&&(zn.leafNodesById[$n].status!==1&&zn.leafNodesById[$n].status!==2||nr.push($n))}),nr}},{key:"setValues",value:function(zn){var nr=this;this.emptyNodesCheckStatus(),zn.forEach(function(Sr){nr.setValue(Sr)}),this.updateLiElements();var $n=this.options.onChange;$n&&$n.call(this)}},{key:"setDisable",value:function(zn){var nr=this.nodesById[zn];nr&&(nr.disabled||(nr.disabled=!0,this.markWillUpdateNode(nr),this.walkUp(nr,"disabled"),this.walkDown(nr,"disabled")))}},{key:"getDisables",value:function(){var zn=this,nr=[];return Object.keys(this.leafNodesById).forEach(function($n){Object.prototype.hasOwnProperty.call(zn.leafNodesById,$n)&&zn.leafNodesById[$n].disabled&&nr.push($n)}),nr}},{key:"setDisables",value:function(zn){var nr=this;this.emptyNodesDisable(),zn.forEach(function($n){nr.setDisable($n)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled||(zn.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(zn){zn.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,nr){var $n=un(nr,2),Sr=$n[0],Yn=$n[1];return Yn.status!==1&&Yn.status!==2||(zn[Sr]=Yn),zn},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(zn,nr){var $n=un(nr,2),Sr=$n[0],Yn=$n[1];return Yn.disabled&&(zn[Sr]=Yn),zn},{})}},{key:"updateLiElements",value:function(){var zn=this;Object.values(this.willUpdateNodesById).forEach(function(nr){zn.updateLiElement(nr)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(zn){this.willUpdateNodesById[zn.id]=zn}},{key:"walkUp",value:function(zn,nr){var $n=zn.parent;if($n){if(nr==="status"){var Sr,Yn=$n.children.reduce(function(rn,Fn){return Number.isNaN(Fn.status)?rn:rn+Fn.status},0);if(Sr=Yn?Yn===2*$n.children.length?2:1:0,$n.status===Sr)return;$n.status=Sr}else{var Xt=$n.children.reduce(function(rn,Fn){return rn&&Fn.disabled},!0);if($n.disabled===Xt)return;$n.disabled=Xt}this.markWillUpdateNode($n),this.walkUp($n,nr)}}},{key:"walkDown",value:function(zn,nr){var $n=this;zn.children&&zn.children.length&&zn.children.forEach(function(Sr){nr==="status"&&Sr.disabled||(Sr[nr]=zn[nr],$n.markWillUpdateNode(Sr),$n.walkDown(Sr,nr))})}},{key:"updateLiElement",value:function(zn){var nr=this.liElementsById[zn.id].classList;switch(zn.status){case 0:nr.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:nr.remove("treejs-node__checked"),nr.add("treejs-node__halfchecked");break;case 2:nr.remove("treejs-node__halfchecked"),nr.add("treejs-node__checked")}switch(zn.disabled){case!0:nr.contains("treejs-node__disabled")||nr.add("treejs-node__disabled");break;case!1:nr.contains("treejs-node__disabled")&&nr.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var zn=this;Object.keys(this.leafNodesById).forEach(function(nr){var $n=zn.leafNodesById[nr];Ir(zn,$n)})}},{key:"expandAll",value:function(){Dr(this,this.treeNodes[0])}}])&&En(Hr.prototype,Xn),ir&&En(Hr,ir),Object.defineProperty(Hr,"prototype",{writable:!1}),Ar}()}(),yt.default}()},819:function(j,tt){(function(st){const b="tp";function yt(bn){return Nt=>jt=>{if(!Nt&&jt===void 0)return{succeeded:!1,value:void 0};if(Nt&&jt===void 0)return{succeeded:!0,value:void 0};const Yt=bn(jt);return Yt!==void 0?{succeeded:!0,value:Yt}:{succeeded:!1,value:void 0}}}function Et(bn){return{custom:Nt=>yt(Nt)(bn),boolean:yt(Nt=>typeof Nt=="boolean"?Nt:void 0)(bn),number:yt(Nt=>typeof Nt=="number"?Nt:void 0)(bn),string:yt(Nt=>typeof Nt=="string"?Nt:void 0)(bn),function:yt(Nt=>typeof Nt=="function"?Nt:void 0)(bn),constant:Nt=>yt(jt=>jt===Nt?Nt:void 0)(bn),raw:yt(Nt=>Nt)(bn),object:Nt=>yt(jt=>{if((Yt=jt)!==null&&typeof Yt=="object")return function(Bn,un){return Object.keys(un).reduce((Cn,Qt)=>{if(Cn===void 0)return;const Wt=(0,un[Qt])(Bn[Qt]);return Wt.succeeded?Object.assign(Object.assign({},Cn),{[Qt]:Wt.value}):void 0},{})}(jt,Nt);var Yt})(bn),array:Nt=>yt(jt=>{if(Array.isArray(jt))return Yt=Nt,jt.reduce((Bn,un)=>{if(Bn===void 0)return;const Cn=Yt(un);return Cn.succeeded&&Cn.value!==void 0?[...Bn,Cn.value]:void 0},[]);var Yt})(bn)}}const kt={optional:Et(!0),required:Et(!1)};function Gt(bn,Nt,jt,Yt){return new(jt||(jt=Promise))(function(Bn,un){function Cn(Zt){try{Wt(Yt.next(Zt))}catch(En){un(En)}}function Qt(Zt){try{Wt(Yt.throw(Zt))}catch(En){un(En)}}function Wt(Zt){var En;Zt.done?Bn(Zt.value):(En=Zt.value,En instanceof jt?En:new jt(function(pn){pn(En)})).then(Cn,Qt)}Wt((Yt=Yt.apply(bn,Nt||[])).next())})}function Vt(bn){return Gt(this,void 0,void 0,function*(){const Nt=new Image;return Nt.crossOrigin="anonymous",new Promise((jt,Yt)=>{Nt.src=bn,Nt.onload=()=>{jt(Nt)},Nt.onerror=Yt})})}const an=(Pn="img",(bn,Nt)=>[b,"-",Pn,"v",bn?`_${bn}`:"",Nt?`-${Nt}`:""].join(""));var Pn;class mn{constructor(Nt,jt){this.element=Nt.createElement("div"),this.element.classList.add(an()),jt.viewProps.bindClassModifiers(this.element),this.input=Nt.createElement("input"),this.input.classList.add(an("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",jt.extensions.join(",")),this.image_=Nt.createElement("img"),this.image_.classList.add(an("image")),this.image_.classList.add(an(`image_${jt.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Yt=>{jt.clickCallback?jt.clickCallback(Yt,this.input):this.input.click()},this.element.classList.add(an("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(Nt){this.image_.src=Nt}changeDraggingState(Nt){const jt=this.element;Nt?jt==null||jt.classList.add(an("area_dragging")):jt==null||jt.classList.remove(an("area_dragging"))}}let hn=null;class wn{constructor(Nt,jt){this.value=jt.value,this.viewProps=jt.viewProps,this.view=new mn(Nt,{viewProps:this.viewProps,extensions:jt.extensions,imageFit:jt.imageFit,clickCallback:jt.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(Nt){const jt=(Nt==null?void 0:Nt.target).files;if(!jt||!jt.length)return;const Yt=jt[0];this.setValue(Yt)}onDrop(Nt){return Gt(this,void 0,void 0,function*(){Nt.preventDefault();try{const{dataTransfer:jt}=Nt,Yt=jt==null?void 0:jt.files[0];if(Yt)this.setValue(Yt);else{const Bn=jt==null?void 0:jt.getData("url");if(!Bn)throw new Error("No url");this.setValue(Bn)}}catch(jt){console.error("Could not parse the dropped image",jt)}finally{this.view.changeDraggingState(!1)}})}onDragOver(Nt){Nt.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(Nt){return Gt(this,void 0,void 0,function*(){Nt instanceof HTMLImageElement?this.updateImage(Nt.src):typeof Nt!="string"&&Nt?yield this.setValue(Nt):(Nt!=="placeholder"&&Nt||(Nt=(yield this.handlePlaceholderImage()).src),this.updateImage(Nt))})}updateImage(Nt){this.view.changeImage(Nt)}setValue(Nt){return Gt(this,void 0,void 0,function*(){if(Nt instanceof HTMLImageElement)this.value.setRawValue(Nt);else if(Nt instanceof File){const jt=URL.createObjectURL(Nt)+"#"+Nt.name;Nt.src=jt;const Yt=yield Vt(jt).catch(()=>{});this.value.setRawValue(Yt||Nt)}else Nt?this.value.setRawValue(yield Vt(Nt)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Gt(this,void 0,void 0,function*(){return hn||(hn=yield function(){const Nt=document.createElement("canvas");Nt.width=320,Nt.height=50;const jt=Nt.getContext("2d");return jt.fillStyle="#00000004",jt.fillRect(0,0,Nt.width,Nt.height),jt.fillStyle="#eee",jt.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',jt.textAlign="center",jt.textBaseline="middle",jt.fillText("No image",.5*Nt.width,.5*Nt.height),new Promise(Yt=>{Nt.toBlob(Bn=>{const un=new Image;un.src=URL.createObjectURL(Bn),un.isPlaceholder=!0,un.onload=()=>{Yt(un)}})})}()),hn})}}const _n=[".jpg",".png",".gif"],$t={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(bn,Nt){if(!(bn instanceof HTMLImageElement||typeof bn=="string"))return null;const jt=kt,Yt=function(Bn,un){const Cn=kt.required.object(un)(Bn);return Cn.succeeded?Cn.value:void 0}(Nt,{view:jt.required.constant("input-image"),acceptUrl:jt.optional.boolean,clickCallback:jt.optional.function,imageFit:jt.optional.custom(Bn=>Bn==="contain"||Bn==="cover"?Bn:void 0),extensions:jt.optional.array(jt.required.string)});return Yt?{initialValue:bn,params:Yt}:null},binding:{reader:bn=>Nt=>Nt.src!==void 0?Nt.src===""?"placeholder":Nt.src:Nt,writer:bn=>(Nt,jt)=>{Nt.write(jt)}},controller(bn){var Nt,jt;return new wn(bn.document,{value:bn.value,imageFit:(Nt=bn.params.imageFit)!==null&&Nt!==void 0?Nt:"cover",clickCallback:bn.params.clickCallback,viewProps:bn.viewProps,extensions:(jt=bn.params.extensions)!==null&&jt!==void 0?jt:_n})}};st.plugin=$t,Object.defineProperty(st,"__esModule",{value:!0})})(tt)},665:function(j,tt){(function(st){class b{constructor(ot){this.controller_=ot}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(ot){this.controller_.viewProps.set("disabled",ot)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(ot){this.controller_.viewProps.set("hidden",ot)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class yt{constructor(ot){this.target=ot}}class Et extends yt{constructor(ot,ht,Tt,Ht){super(ot),this.value=ht,this.presetKey=Tt,this.last=Ht==null||Ht}}class kt extends yt{constructor(ot,ht,Tt){super(ot),this.value=ht,this.presetKey=Tt}}class Gt extends yt{constructor(ot,ht){super(ot),this.expanded=ht}}function Vt(At){return At==null}function an(At,ot){if(At.length!==ot.length)return!1;for(let ht=0;ht<At.length;ht++)if(At[ht]!==ot[ht])return!1;return!0}const Pn={alreadydisposed:()=>"View has been already disposed",invalidparams:At=>`Invalid parameters for '${At.name}'`,nomatchingcontroller:At=>`No matching controller for '${At.key}'`,nomatchingview:At=>`No matching view for '${JSON.stringify(At.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:At=>`Property '${At.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class mn{constructor(ot){var ht;this.message=(ht=Pn[ot.type](ot.context))!==null&&ht!==void 0?ht:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=ot.type}static alreadyDisposed(){return new mn({type:"alreadydisposed"})}static notBindable(){return new mn({type:"notbindable"})}static propertyNotFound(ot){return new mn({type:"propertynotfound",context:{name:ot}})}static shouldNeverHappen(){return new mn({type:"shouldneverhappen"})}}class hn{constructor(ot,ht,Tt){this.obj_=ot,this.key_=ht,this.presetKey_=Tt??ht}static isBindable(ot){return ot!==null&&typeof ot=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(ot){this.obj_[this.key_]=ot}writeProperty(ot,ht){const Tt=this.read();if(!hn.isBindable(Tt))throw mn.notBindable();if(!(ot in Tt))throw mn.propertyNotFound(ot);Tt[ot]=ht}}class wn extends b{get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}get title(){var ot;return(ot=this.controller_.valueController.props.get("title"))!==null&&ot!==void 0?ot:""}set title(ot){this.controller_.valueController.props.set("title",ot)}on(ot,ht){const Tt=ht.bind(this);return this.controller_.valueController.emitter.on(ot,()=>{Tt(new yt(this))}),this}}class _n{constructor(){this.observers_={}}on(ot,ht){let Tt=this.observers_[ot];return Tt||(Tt=this.observers_[ot]=[]),Tt.push({handler:ht}),this}off(ot,ht){const Tt=this.observers_[ot];return Tt&&(this.observers_[ot]=Tt.filter(Ht=>Ht.handler!==ht)),this}emit(ot,ht){const Tt=this.observers_[ot];Tt&&Tt.forEach(Ht=>{Ht.handler(ht)})}}const $t="tp";function bn(At){return(ot,ht)=>[$t,"-",At,"v",ot?`_${ot}`:"",ht?`-${ht}`:""].join("")}function Nt(At){return At.rawValue}function jt(At,ot){var ht,Tt;At.emitter.on("change",(ht=Nt,Tt=ot,Ht=>Tt(ht(Ht)))),ot(At.rawValue)}function Yt(At,ot,ht){jt(At.value(ot),ht)}function Bn(At,ot){return ht=>{(function(Tt,Ht,vn){vn?Tt.classList.add(Ht):Tt.classList.remove(Ht)})(At,ot,ht)}}function un(At,ot){jt(At,ht=>{ot.textContent=ht??""})}const Cn=bn("btn");class Qt{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(Cn()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("button");Tt.classList.add(Cn("b")),ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.buttonElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(Cn("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht)}}class Wt{constructor(ot,ht){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=ht.props,this.viewProps=ht.viewProps,this.view=new Qt(ot,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Zt{constructor(ot,ht){var Tt;this.constraint_=ht==null?void 0:ht.constraint,this.equals_=(Tt=ht==null?void 0:ht.equals)!==null&&Tt!==void 0?Tt:(Ht,vn)=>Ht===vn,this.emitter=new _n,this.rawValue_=ot}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(ot){this.setRawValue(ot,{forceEmit:!1,last:!0})}setRawValue(ot,ht){const Tt=ht??{forceEmit:!1,last:!0},Ht=this.constraint_?this.constraint_.constrain(ot):ot;(!this.equals_(this.rawValue_,Ht)||Tt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=Ht,this.emitter.emit("change",{options:Tt,rawValue:Ht,sender:this}))}}class En{constructor(ot){this.emitter=new _n,this.value_=ot}get rawValue(){return this.value_}set rawValue(ot){this.setRawValue(ot,{forceEmit:!1,last:!0})}setRawValue(ot,ht){const Tt=ht??{forceEmit:!1,last:!0};(this.value_!==ot||Tt.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=ot,this.emitter.emit("change",{options:Tt,rawValue:this.value_,sender:this}))}}function pn(At,ot){const ht=ot==null?void 0:ot.constraint,Tt=ot==null?void 0:ot.equals;return ht||Tt?new Zt(At,ot):new En(At)}class er{constructor(ot){this.emitter=new _n,this.valMap_=ot;for(const ht in this.valMap_)this.valMap_[ht].emitter.on("change",()=>{this.emitter.emit("change",{key:ht,sender:this})})}static createCore(ot){return Object.keys(ot).reduce((ht,Tt)=>Object.assign(ht,{[Tt]:pn(ot[Tt])}),{})}static fromObject(ot){const ht=this.createCore(ot);return new er(ht)}get(ot){return this.valMap_[ot].rawValue}set(ot,ht){this.valMap_[ot].rawValue=ht}value(ot){return this.valMap_[ot]}}function Ir(At){return ot=>ht=>{if(!ot&&ht===void 0)return{succeeded:!1,value:void 0};if(ot&&ht===void 0)return{succeeded:!0,value:void 0};const Tt=At(ht);return Tt!==void 0?{succeeded:!0,value:Tt}:{succeeded:!1,value:void 0}}}function Dr(At){return{custom:ot=>Ir(ot)(At),boolean:Ir(ot=>typeof ot=="boolean"?ot:void 0)(At),number:Ir(ot=>typeof ot=="number"?ot:void 0)(At),string:Ir(ot=>typeof ot=="string"?ot:void 0)(At),function:Ir(ot=>typeof ot=="function"?ot:void 0)(At),constant:ot=>Ir(ht=>ht===ot?ot:void 0)(At),raw:Ir(ot=>ot)(At),object:ot=>Ir(ht=>{if((Tt=ht)!==null&&typeof Tt=="object")return function(Ht,vn){return Object.keys(vn).reduce((Rn,ar)=>{if(Rn===void 0)return;const Er=(0,vn[ar])(Ht[ar]);return Er.succeeded?Object.assign(Object.assign({},Rn),{[ar]:Er.value}):void 0},{})}(ht,ot);var Tt})(At),array:ot=>Ir(ht=>{if(Array.isArray(ht))return Tt=ot,ht.reduce((Ht,vn)=>{if(Ht===void 0)return;const Rn=Tt(vn);return Rn.succeeded&&Rn.value!==void 0?[...Ht,Rn.value]:void 0},[]);var Tt})(At)}}const zr={optional:Dr(!0),required:Dr(!1)};function Ar(At,ot){const ht=zr.required.object(ot)(At);return ht.succeeded?ht.value:void 0}const Hr=bn(""),Xn={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class ir{constructor(ot){this.parent_=null,this.blade=ot.blade,this.view=ot.view,this.viewProps=ot.viewProps;const ht=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(Tt=>{ht.classList.remove(Hr(void 0,Xn[Tt]))}),this.blade.get("positions").forEach(Tt=>{ht.classList.add(Hr(void 0,Xn[Tt]))})}),this.viewProps.handleDispose(()=>{(function(Tt){Tt&&Tt.parentElement&&Tt.parentElement.removeChild(Tt)})(ht)})}get parent(){return this.parent_}}const zn="http://www.w3.org/2000/svg";function nr(At){At.offsetHeight}function $n(At){return At.ontouchstart!==void 0}function Sr(){return new Function("return this")().document}const Yn={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Xt(At,ot){const ht=At.createElementNS(zn,"svg");return ht.innerHTML=Yn[ot],ht}function rn(At,ot,ht){At.insertBefore(ot,At.children[ht])}function Fn(At){At.parentElement&&At.parentElement.removeChild(At)}function Nr(At){for(;At.children.length>0;)At.removeChild(At.children[0])}function kr(At){return At.relatedTarget?At.relatedTarget:"explicitOriginalTarget"in At?At.explicitOriginalTarget:null}const jr=bn("lbl");class Ss{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(jr()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("div");Tt.classList.add(jr("l")),Yt(ht.props,"label",vn=>{Vt(vn)?this.element.classList.add(jr(void 0,"nol")):(this.element.classList.remove(jr(void 0,"nol")),function(Rn){for(;Rn.childNodes.length>0;)Rn.removeChild(Rn.childNodes[0])}(Tt),Tt.appendChild(function(Rn,ar){const Er=Rn.createDocumentFragment();return ar.split(`
`).map(ps=>Rn.createTextNode(ps)).forEach((ps,ws)=>{ws>0&&Er.appendChild(Rn.createElement("br")),Er.appendChild(ps)}),Er}(ot,vn)))}),this.element.appendChild(Tt),this.labelElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(jr("v")),this.element.appendChild(Ht),this.valueElement=Ht}}class zs extends ir{constructor(ot,ht){const Tt=ht.valueController.viewProps;super(Object.assign(Object.assign({},ht),{view:new Ss(ot,{props:ht.props,viewProps:Tt}),viewProps:Tt})),this.props=ht.props,this.valueController=ht.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Ao={id:"button",type:"blade",accept(At){const ot=zr,ht=Ar(At,{title:ot.required.string,view:ot.required.constant("button"),label:ot.optional.string});return ht?{params:ht}:null},controller:At=>new zs(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:new Wt(At.document,{props:er.fromObject({title:At.params.title}),viewProps:At.viewProps})}),api:At=>At.controller instanceof zs&&At.controller.valueController instanceof Wt?new wn(At.controller):null};class Zs extends ir{constructor(ot){super(ot),this.value=ot.value}}function Lo(){return new er({positions:pn([],{equals:an})})}class $s extends er{constructor(ot){super(ot)}static create(ot){const ht={completed:!0,expanded:ot,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},Tt=er.createCore(ht);return new $s(Tt)}get styleExpanded(){var ot;return(ot=this.get("temporaryExpanded"))!==null&&ot!==void 0?ot:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const ot=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Vt(ot)?`${ot}px`:"auto"}bindExpandedClass(ot,ht){const Tt=()=>{this.styleExpanded?ot.classList.add(ht):ot.classList.remove(ht)};Yt(this,"expanded",Tt),Yt(this,"temporaryExpanded",Tt)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function qo(At,ot){ot.style.height=At.styleHeight}function yo(At,ot){At.value("expanded").emitter.on("beforechange",()=>{At.set("completed",!1),Vt(At.get("expandedHeight"))&&At.set("expandedHeight",function(ht,Tt){let Ht=0;return function(vn,Rn){const ar=vn.style.transition;vn.style.transition="none",Rn(),vn.style.transition=ar}(Tt,()=>{ht.set("expandedHeight",null),ht.set("temporaryExpanded",!0),nr(Tt),Ht=Tt.clientHeight,ht.set("temporaryExpanded",null),nr(Tt)}),Ht}(At,ot)),At.set("shouldFixHeight",!0),nr(ot)}),At.emitter.on("change",()=>{qo(At,ot)}),qo(At,ot),ot.addEventListener("transitionend",ht=>{ht.propertyName==="height"&&At.cleanUpTransition()})}class Hu extends b{constructor(ot,ht){super(ot),this.rackApi_=ht}}class vu{constructor(ot){this.emitter=new _n,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=ot}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(ot){for(const ht of this.allItems())if(ot(ht))return ht;return null}includes(ot){return this.cache_.has(ot)}add(ot,ht){if(this.includes(ot))throw mn.shouldNeverHappen();const Tt=ht!==void 0?ht:this.items_.length;this.items_.splice(Tt,0,ot),this.cache_.add(ot);const Ht=this.extract_(ot);Ht&&(Ht.emitter.on("add",this.onSubListAdd_),Ht.emitter.on("remove",this.onSubListRemove_),Ht.allItems().forEach(vn=>{this.cache_.add(vn)})),this.emitter.emit("add",{index:Tt,item:ot,root:this,target:this})}remove(ot){const ht=this.items_.indexOf(ot);if(ht<0)return;this.items_.splice(ht,1),this.cache_.delete(ot);const Tt=this.extract_(ot);Tt&&(Tt.emitter.off("add",this.onSubListAdd_),Tt.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:ht,item:ot,root:this,target:this})}onSubListAdd_(ot){this.cache_.add(ot.item),this.emitter.emit("add",{index:ot.index,item:ot.item,root:this,target:ot.target})}onSubListRemove_(ot){this.cache_.delete(ot.item),this.emitter.emit("remove",{index:ot.index,item:ot.item,root:this,target:ot.target})}}class ba extends b{constructor(ot){super(ot),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new _n,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(ot){const ht=ot.sender.target.read();this.emitter_.emit("change",{event:new Et(this,ht,this.controller_.binding.target.presetKey,ot.options.last)})}}class Ro extends zs{constructor(ot,ht){super(ot,ht),this.binding=ht.binding}}class Gl extends b{constructor(ot){super(ot),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new _n,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(ot){const ht=ot.sender.target.read();this.emitter_.emit("update",{event:new kt(this,ht,this.controller_.binding.target.presetKey)})}}class To extends zs{constructor(ot,ht){super(ot,ht),this.binding=ht.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Wu(At){return At instanceof Yp?At.apiSet_:At instanceof Hu?At.rackApi_.apiSet_:null}function Pu(At,ot){const ht=At.find(Tt=>Tt.controller_===ot);if(!ht)throw mn.shouldNeverHappen();return ht}function Oo(At,ot,ht){if(!hn.isBindable(At))throw mn.notBindable();return new hn(At,ot,ht)}class Yp extends b{constructor(ot,ht){super(ot),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new _n,this.apiSet_=new vu(Wu),this.pool_=ht;const Tt=this.controller_.rack;Tt.emitter.on("add",this.onRackAdd_),Tt.emitter.on("remove",this.onRackRemove_),Tt.emitter.on("inputchange",this.onRackInputChange_),Tt.emitter.on("monitorupdate",this.onRackMonitorUpdate_),Tt.children.forEach(Ht=>{this.setUpApi_(Ht)})}get children(){return this.controller_.rack.children.map(ot=>Pu(this.apiSet_,ot))}addInput(ot,ht,Tt){const Ht=Tt||{},vn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createInput(vn,Oo(ot,ht,Ht.presetKey),Ht),ar=new ba(Rn);return this.add(ar,Ht.index)}addMonitor(ot,ht,Tt){const Ht=Tt||{},vn=this.controller_.view.element.ownerDocument,Rn=this.pool_.createMonitor(vn,Oo(ot,ht),Ht),ar=new Gl(Rn);return this.add(ar,Ht.index)}addFolder(ot){return function(ht,Tt){return ht.addBlade(Object.assign(Object.assign({},Tt),{view:"folder"}))}(this,ot)}addButton(ot){return function(ht,Tt){return ht.addBlade(Object.assign(Object.assign({},Tt),{view:"button"}))}(this,ot)}addSeparator(ot){return function(ht,Tt){const Ht=Tt||{};return ht.addBlade(Object.assign(Object.assign({},Ht),{view:"separator"}))}(this,ot)}addTab(ot){return function(ht,Tt){return ht.addBlade(Object.assign(Object.assign({},Tt),{view:"tab"}))}(this,ot)}add(ot,ht){this.controller_.rack.add(ot.controller_,ht);const Tt=this.apiSet_.find(Ht=>Ht.controller_===ot.controller_);return Tt&&this.apiSet_.remove(Tt),this.apiSet_.add(ot),ot}remove(ot){this.controller_.rack.remove(ot.controller_)}addBlade(ot){const ht=this.controller_.view.element.ownerDocument,Tt=this.pool_.createBlade(ht,ot),Ht=this.pool_.createBladeApi(Tt);return this.add(Ht,ot.index)}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}setUpApi_(ot){this.apiSet_.find(ht=>ht.controller_===ot)||this.apiSet_.add(this.pool_.createBladeApi(ot))}onRackAdd_(ot){this.setUpApi_(ot.bladeController)}onRackRemove_(ot){if(ot.isRoot){const ht=Pu(this.apiSet_,ot.bladeController);this.apiSet_.remove(ht)}}onRackInputChange_(ot){const ht=ot.bladeController;if(ht instanceof Ro){const Tt=Pu(this.apiSet_,ht),Ht=ht.binding;this.emitter_.emit("change",{event:new Et(Tt,Ht.target.read(),Ht.target.presetKey,ot.options.last)})}else if(ht instanceof Zs){const Tt=Pu(this.apiSet_,ht);this.emitter_.emit("change",{event:new Et(Tt,ht.value.rawValue,void 0,ot.options.last)})}}onRackMonitorUpdate_(ot){if(!(ot.bladeController instanceof To))throw mn.shouldNeverHappen();const ht=Pu(this.apiSet_,ot.bladeController),Tt=ot.bladeController.binding;this.emitter_.emit("update",{event:new kt(ht,Tt.target.read(),Tt.target.presetKey)})}}class Yo extends Hu{constructor(ot,ht){super(ot,new Yp(ot.rackController,ht)),this.emitter_=new _n,this.controller_.foldable.value("expanded").emitter.on("change",Tt=>{this.emitter_.emit("fold",{event:new Gt(this,Tt.sender.rawValue)})}),this.rackApi_.on("change",Tt=>{this.emitter_.emit("change",{event:Tt})}),this.rackApi_.on("update",Tt=>{this.emitter_.emit("update",{event:Tt})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(ot){this.controller_.foldable.set("expanded",ot)}get title(){return this.controller_.props.get("title")}set title(ot){this.controller_.props.set("title",ot)}get children(){return this.rackApi_.children}addInput(ot,ht,Tt){return this.rackApi_.addInput(ot,ht,Tt)}addMonitor(ot,ht,Tt){return this.rackApi_.addMonitor(ot,ht,Tt)}addFolder(ot){return this.rackApi_.addFolder(ot)}addButton(ot){return this.rackApi_.addButton(ot)}addSeparator(ot){return this.rackApi_.addSeparator(ot)}addTab(ot){return this.rackApi_.addTab(ot)}add(ot,ht){return this.rackApi_.add(ot,ht)}remove(ot){this.rackApi_.remove(ot)}addBlade(ot){return this.rackApi_.addBlade(ot)}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}}class _u extends ir{constructor(ot){super({blade:ot.blade,view:ot.view,viewProps:ot.rackController.viewProps}),this.rackController=ot.rackController}}class g1{constructor(ot,ht){const Tt=bn(ht.viewName);this.element=ot.createElement("div"),this.element.classList.add(Tt()),ht.viewProps.bindClassModifiers(this.element)}}function Xo(At){return At instanceof Gm?At.rack:At instanceof _u?At.rackController.rack:null}function Xp(At){const ot=Xo(At);return ot?ot.bcSet_:null}class Ko{constructor(ot){var ht;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new _n,this.blade_=ot??null,(ht=this.blade_)===null||ht===void 0||ht.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new vu(Xp),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(ot,ht){ot.parent&&ot.parent.remove(ot),ot.parent_=this,this.bcSet_.add(ot,ht)}remove(ot){ot.parent_=null,this.bcSet_.remove(ot)}find(ot){return this.bcSet_.allItems().filter(ht=>ht instanceof ot)}onSetAdd_(ot){this.updatePositions_();const ht=ot.target===ot.root;if(this.emitter.emit("add",{bladeController:ot.item,index:ot.index,isRoot:ht,sender:this}),!ht)return;const Tt=ot.item;if(Tt.viewProps.emitter.on("change",this.onChildViewPropsChange_),Tt.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),Tt.viewProps.handleDispose(this.onChildDispose_),Tt instanceof Ro)Tt.binding.emitter.on("change",this.onChildInputChange_);else if(Tt instanceof To)Tt.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(Tt instanceof Zs)Tt.value.emitter.on("change",this.onChildValueChange_);else{const Ht=Xo(Tt);if(Ht){const vn=Ht.emitter;vn.on("layout",this.onDescendantLayout_),vn.on("inputchange",this.onDescendantInputChange_),vn.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(ot){this.updatePositions_();const ht=ot.target===ot.root;if(this.emitter.emit("remove",{bladeController:ot.item,isRoot:ht,sender:this}),!ht)return;const Tt=ot.item;if(Tt instanceof Ro)Tt.binding.emitter.off("change",this.onChildInputChange_);else if(Tt instanceof To)Tt.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(Tt instanceof Zs)Tt.value.emitter.off("change",this.onChildValueChange_);else{const Ht=Xo(Tt);if(Ht){const vn=Ht.emitter;vn.off("layout",this.onDescendantLayout_),vn.off("inputchange",this.onDescendantInputChange_),vn.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const ot=this.bcSet_.items.filter(Ht=>!Ht.viewProps.get("hidden")),ht=ot[0],Tt=ot[ot.length-1];this.bcSet_.items.forEach(Ht=>{const vn=[];Ht===ht&&(vn.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||vn.push("veryfirst")),Ht===Tt&&(vn.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||vn.push("verylast")),Ht.blade.set("positions",vn)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(ot){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(ot=>ot.viewProps.get("disposed")).forEach(ot=>{this.bcSet_.remove(ot)})}onChildInputChange_(ot){const ht=function(Tt,Ht){for(let vn=0;vn<Tt.length;vn++){const Rn=Tt[vn];if(Rn instanceof Ro&&Rn.binding===Ht)return Rn}return null}(this.find(Ro),ot.sender);if(!ht)throw mn.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ht,options:ot.options,sender:this})}onChildMonitorUpdate_(ot){const ht=function(Tt,Ht){for(let vn=0;vn<Tt.length;vn++){const Rn=Tt[vn];if(Rn instanceof To&&Rn.binding===Ht)return Rn}return null}(this.find(To),ot.sender);if(!ht)throw mn.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:ht,sender:this})}onChildValueChange_(ot){const ht=function(Tt,Ht){for(let vn=0;vn<Tt.length;vn++){const Rn=Tt[vn];if(Rn instanceof Zs&&Rn.value===Ht)return Rn}return null}(this.find(Zs),ot.sender);if(!ht)throw mn.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:ht,options:ot.options,sender:this})}onDescendantLayout_(ot){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(ot){this.emitter.emit("inputchange",{bladeController:ot.bladeController,options:ot.options,sender:this})}onDescendantMonitorUpdate_(ot){this.emitter.emit("monitorupdate",{bladeController:ot.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Gm extends ir{constructor(ot,ht){super(Object.assign(Object.assign({},ht),{view:new g1(ot,{viewName:"brk",viewProps:ht.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const Tt=new Ko(ht.root?void 0:ht.blade);Tt.emitter.on("add",this.onRackAdd_),Tt.emitter.on("remove",this.onRackRemove_),this.rack=Tt,this.viewProps.handleDispose(()=>{for(let Ht=this.rack.children.length-1;Ht>=0;Ht--)this.rack.children[Ht].viewProps.set("disposed",!0)})}onRackAdd_(ot){ot.isRoot&&rn(this.view.element,ot.bladeController.view.element,ot.index)}onRackRemove_(ot){ot.isRoot&&Fn(ot.bladeController.view.element)}}const fA=bn("cnt");class vo{constructor(ot,ht){this.className_=bn(ht.viewName||"fld"),this.element=ot.createElement("div"),this.element.classList.add(this.className_(),fA()),ht.viewProps.bindClassModifiers(this.element),this.foldable_=ht.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Yt(this.foldable_,"completed",Bn(this.element,this.className_(void 0,"cpl")));const Tt=ot.createElement("button");Tt.classList.add(this.className_("b")),Yt(ht.props,"title",ar=>{Vt(ar)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.buttonElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(this.className_("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht),this.titleElement=Ht;const vn=ot.createElement("div");vn.classList.add(this.className_("m")),this.buttonElement.appendChild(vn);const Rn=ht.containerElement;Rn.classList.add(this.className_("c")),this.element.appendChild(Rn),this.containerElement=Rn}}class Qo extends _u{constructor(ot,ht){var Tt;const Ht=$s.create((Tt=ht.expanded)===null||Tt===void 0||Tt),vn=new Gm(ot,{blade:ht.blade,root:ht.root,viewProps:ht.viewProps});super(Object.assign(Object.assign({},ht),{rackController:vn,view:new vo(ot,{containerElement:vn.view.element,foldable:Ht,props:ht.props,viewName:ht.root?"rot":void 0,viewProps:ht.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=ht.props,this.foldable=Ht,yo(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const vm={id:"folder",type:"blade",accept(At){const ot=zr,ht=Ar(At,{title:ot.required.string,view:ot.required.constant("folder"),expanded:ot.optional.boolean});return ht?{params:ht}:null},controller:At=>new Qo(At.document,{blade:At.blade,expanded:At.params.expanded,props:er.fromObject({title:At.params.title}),viewProps:At.viewProps}),api:At=>At.controller instanceof Qo?new Yo(At.controller,At.pool):null};class qu extends Zs{constructor(ot,ht){const Tt=ht.valueController.viewProps;super(Object.assign(Object.assign({},ht),{value:ht.valueController.value,view:new Ss(ot,{props:ht.props,viewProps:Tt}),viewProps:Tt})),this.props=ht.props,this.valueController=ht.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class ly extends b{}const mA=bn("spr");class c_{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(mA()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("hr");Tt.classList.add(mA("r")),this.element.appendChild(Tt)}}class jn extends ir{constructor(ot,ht){super(Object.assign(Object.assign({},ht),{view:new c_(ot,{viewProps:ht.viewProps})}))}}const Hl={id:"separator",type:"blade",accept(At){const ot=Ar(At,{view:zr.required.constant("separator")});return ot?{params:ot}:null},controller:At=>new jn(At.document,{blade:At.blade,viewProps:At.viewProps}),api:At=>At.controller instanceof jn?new ly(At.controller):null},_m=bn("");function Hm(At,ot){return Bn(At,_m(void 0,ot))}class so extends er{constructor(ot){super(ot)}static create(ot){var ht,Tt;const Ht=ot??{},vn={disabled:(ht=Ht.disabled)!==null&&ht!==void 0&&ht,disposed:!1,hidden:(Tt=Ht.hidden)!==null&&Tt!==void 0&&Tt},Rn=er.createCore(vn);return new so(Rn)}bindClassModifiers(ot){Yt(this,"disabled",Hm(ot,"disabled")),Yt(this,"hidden",Hm(ot,"hidden"))}bindDisabled(ot){Yt(this,"disabled",ht=>{ot.disabled=ht})}bindTabIndex(ot){Yt(this,"disabled",ht=>{ot.tabIndex=ht?-1:0})}handleDispose(ot){this.value("disposed").emitter.on("change",ht=>{ht&&ot()})}}const eo=bn("tbi");class Sw{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(eo()),ht.viewProps.bindClassModifiers(this.element),Yt(ht.props,"selected",vn=>{vn?this.element.classList.add(eo(void 0,"sel")):this.element.classList.remove(eo(void 0,"sel"))});const Tt=ot.createElement("button");Tt.classList.add(eo("b")),ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.buttonElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(eo("t")),un(ht.props.value("title"),Ht),this.buttonElement.appendChild(Ht),this.titleElement=Ht}}class Cw{constructor(ot,ht){this.emitter=new _n,this.onClick_=this.onClick_.bind(this),this.props=ht.props,this.viewProps=ht.viewProps,this.view=new Sw(ot,{props:ht.props,viewProps:ht.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Yu{constructor(ot,ht){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Cw(ot,{props:ht.itemProps,viewProps:so.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Gm(ot,{blade:Lo(),viewProps:so.create()}),this.props=ht.props,Yt(this.props,"selected",Tt=>{this.itemController.props.set("selected",Tt),this.contentController.viewProps.set("hidden",!Tt)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class Ap{constructor(ot,ht){this.controller_=ot,this.rackApi_=ht}get title(){var ot;return(ot=this.controller_.itemController.props.get("title"))!==null&&ot!==void 0?ot:""}set title(ot){this.controller_.itemController.props.set("title",ot)}get selected(){return this.controller_.props.get("selected")}set selected(ot){this.controller_.props.set("selected",ot)}get children(){return this.rackApi_.children}addButton(ot){return this.rackApi_.addButton(ot)}addFolder(ot){return this.rackApi_.addFolder(ot)}addSeparator(ot){return this.rackApi_.addSeparator(ot)}addTab(ot){return this.rackApi_.addTab(ot)}add(ot,ht){this.rackApi_.add(ot,ht)}remove(ot){this.rackApi_.remove(ot)}addInput(ot,ht,Tt){return this.rackApi_.addInput(ot,ht,Tt)}addMonitor(ot,ht,Tt){return this.rackApi_.addMonitor(ot,ht,Tt)}addBlade(ot){return this.rackApi_.addBlade(ot)}}class cy extends Hu{constructor(ot,ht){super(ot,new Yp(ot.rackController,ht)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new _n,this.pageApiMap_=new Map,this.rackApi_.on("change",Tt=>{this.emitter_.emit("change",{event:Tt})}),this.rackApi_.on("update",Tt=>{this.emitter_.emit("update",{event:Tt})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(Tt=>{this.setUpPageApi_(Tt)})}get pages(){return this.controller_.pageSet.items.map(ot=>{const ht=this.pageApiMap_.get(ot);if(!ht)throw mn.shouldNeverHappen();return ht})}addPage(ot){const ht=this.controller_.view.element.ownerDocument,Tt=new Yu(ht,{itemProps:er.fromObject({selected:!1,title:ot.title}),props:er.fromObject({selected:!1})});this.controller_.add(Tt,ot.index);const Ht=this.pageApiMap_.get(Tt);if(!Ht)throw mn.shouldNeverHappen();return Ht}removePage(ot){this.controller_.remove(ot)}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}setUpPageApi_(ot){const ht=this.rackApi_.apiSet_.find(Ht=>Ht.controller_===ot.contentController);if(!ht)throw mn.shouldNeverHappen();const Tt=new Ap(ot,ht);this.pageApiMap_.set(ot,Tt)}onPageAdd_(ot){this.setUpPageApi_(ot.item)}onPageRemove_(ot){if(!this.pageApiMap_.get(ot.item))throw mn.shouldNeverHappen();this.pageApiMap_.delete(ot.item)}}const yp=bn("tab");class bv{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(yp(),fA()),ht.viewProps.bindClassModifiers(this.element),jt(ht.empty,Bn(this.element,yp(void 0,"nop")));const Tt=ot.createElement("div");Tt.classList.add(yp("i")),this.element.appendChild(Tt),this.itemsElement=Tt;const Ht=ht.contentsElement;Ht.classList.add(yp("c")),this.element.appendChild(Ht),this.contentsElement=Ht}}class gA extends _u{constructor(ot,ht){const Tt=new Gm(ot,{blade:ht.blade,viewProps:ht.viewProps}),Ht=pn(!0);super({blade:ht.blade,rackController:Tt,view:new bv(ot,{contentsElement:Tt.view.element,empty:Ht,viewProps:ht.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new vu(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=Ht,this.applyPages_()}get pageSet(){return this.pageSet_}add(ot,ht){this.pageSet_.add(ot,ht??this.pageSet_.items.length)}remove(ot){this.pageSet_.remove(this.pageSet_.items[ot])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(ot){const ht=ot.item;rn(this.view.itemsElement,ht.itemController.view.element,ot.index),this.rackController.rack.add(ht.contentController,ot.index),ht.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(ot){const ht=ot.item;Fn(ht.itemController.view.element),this.rackController.rack.remove(ht.contentController),ht.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const ot=this.pageSet_.items.findIndex(ht=>ht.props.get("selected"));ot<0?this.pageSet_.items.forEach((ht,Tt)=>{ht.props.set("selected",Tt===0)}):this.pageSet_.items.forEach((ht,Tt)=>{ht.props.set("selected",Tt===ot)})}onPageSelectedChange_(ot){if(ot.rawValue){const ht=this.pageSet_.items.findIndex(Tt=>Tt.props.value("selected")===ot.sender);this.pageSet_.items.forEach((Tt,Ht)=>{Tt.props.set("selected",Ht===ht)})}else this.keepSelection_()}}const ip={id:"tab",type:"blade",accept(At){const ot=zr,ht=Ar(At,{pages:ot.required.array(ot.required.object({title:ot.required.string})),view:ot.required.constant("tab")});return ht&&ht.pages.length!==0?{params:ht}:null},controller(At){const ot=new gA(At.document,{blade:At.blade,viewProps:At.viewProps});return At.params.pages.forEach(ht=>{const Tt=new Yu(At.document,{itemProps:er.fromObject({selected:!1,title:ht.title}),props:er.fromObject({selected:!1})});ot.add(Tt)}),ot},api:At=>At.controller instanceof gA?new cy(At.controller,At.pool):null};class uy{constructor(){this.disabled=!1,this.emitter=new _n}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class v1{constructor(ot,ht){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=ot,this.emitter=new _n,this.interval_=ht,this.setTimer_()}get disabled(){return this.disabled_}set disabled(ot){this.disabled_=ot,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const ot=this.doc_.defaultView;ot&&ot.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const ot=this.doc_.defaultView;ot&&(this.timerId_=ot.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ev{constructor(ot){this.constraints=ot}constrain(ot){return this.constraints.reduce((ht,Tt)=>Tt.constrain(ht),ot)}}function rp(At,ot){if(At instanceof ot)return At;if(At instanceof Ev){const ht=At.constraints.reduce((Tt,Ht)=>Tt||(Ht instanceof ot?Ht:null),null);if(ht)return ht}return null}class Sv{constructor(ot){this.options=ot}constrain(ot){const ht=this.options;return ht.length===0||ht.filter(Tt=>Tt.value===ot).length>0?ot:ht[0].value}}class wo{constructor(ot){this.maxValue=ot.max,this.minValue=ot.min}constrain(ot){let ht=ot;return Vt(this.minValue)||(ht=Math.max(ht,this.minValue)),Vt(this.maxValue)||(ht=Math.min(ht,this.maxValue)),ht}}class wp{constructor(ot){this.step=ot}constrain(ot){return(ot<0?-Math.round(-ot/this.step):Math.round(ot/this.step))*this.step}}const Au=bn("lst");class u_{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),this.props_=ht.props,this.element=ot.createElement("div"),this.element.classList.add(Au()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("select");Tt.classList.add(Au("s")),Yt(this.props_,"options",vn=>{Nr(Tt),vn.forEach((Rn,ar)=>{const Er=ot.createElement("option");Er.dataset.index=String(ar),Er.textContent=Rn.text,Er.value=String(Rn.value),Tt.appendChild(Er)})}),ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.selectElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(Au("m")),Ht.appendChild(Xt(ot,"dropdown")),this.element.appendChild(Ht),ht.value.emitter.on("change",this.onValueChange_),this.value_=ht.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class _c{constructor(ot,ht){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.view=new u_(ot,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(ot){const ht=ot.currentTarget.selectedOptions.item(0);if(!ht)return;const Tt=Number(ht.dataset.index);this.value.rawValue=this.props.get("options")[Tt].value}}const ns=bn("pop");class a0{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(ns()),ht.viewProps.bindClassModifiers(this.element),jt(ht.shows,Bn(this.element,ns(void 0,"v")))}}class ss{constructor(ot,ht){this.shows=pn(!1),this.viewProps=ht.viewProps,this.view=new a0(ot,{shows:this.shows,viewProps:this.viewProps})}}const Kp=bn("txt");class Cv{constructor(ot,ht){this.onChange_=this.onChange_.bind(this),this.element=ot.createElement("div"),this.element.classList.add(Kp()),ht.viewProps.bindClassModifiers(this.element),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_);const Tt=ot.createElement("input");Tt.classList.add(Kp("i")),Tt.type="text",ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,ht.value.emitter.on("change",this.onChange_),this.value_=ht.value,this.refresh()}refresh(){const ot=this.props_.get("formatter");this.inputElement.value=ot(this.value_.rawValue)}onChange_(){this.refresh()}}class ho{constructor(ot,ht){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=ht.parser,this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Cv(ot,{props:ht.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ot){const ht=ot.currentTarget.value,Tt=this.parser_(ht);Vt(Tt)||(this.value.rawValue=Tt),this.view.refresh()}}function qs(At){return At!=="false"&&!!At}function Wm(At){return function(ot){return String(ot)}(At)}class vA{constructor(ot){this.text=ot}evaluate(){return Number(this.text)}toString(){return this.text}}const Mv={"**":(At,ot)=>Math.pow(At,ot),"*":(At,ot)=>At*ot,"/":(At,ot)=>At/ot,"%":(At,ot)=>At%ot,"+":(At,ot)=>At+ot,"-":(At,ot)=>At-ot,"<<":(At,ot)=>At<<ot,">>":(At,ot)=>At>>ot,">>>":(At,ot)=>At>>>ot,"&":(At,ot)=>At&ot,"^":(At,ot)=>At^ot,"|":(At,ot)=>At|ot};class l0{constructor(ot,ht,Tt){this.left=ht,this.operator=ot,this.right=Tt}evaluate(){const ot=Mv[this.operator];if(!ot)throw new Error(`unexpected binary operator: '${this.operator}`);return ot(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ys={"+":At=>At,"-":At=>-At,"~":At=>~At};class hy{constructor(ot,ht){this.operator=ot,this.expression=ht}evaluate(){const ot=Ys[this.operator];if(!ot)throw new Error(`unexpected unary operator: '${this.operator}`);return ot(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function c0(At){return(ot,ht)=>{for(let Tt=0;Tt<At.length;Tt++){const Ht=At[Tt](ot,ht);if(Ht!=="")return Ht}return""}}function Tv(At,ot){var ht;const Tt=At.substr(ot).match(/^\s+/);return(ht=Tt&&Tt[0])!==null&&ht!==void 0?ht:""}function Iv(At,ot){var ht;const Tt=At.substr(ot).match(/^[0-9]+/);return(ht=Tt&&Tt[0])!==null&&ht!==void 0?ht:""}function xo(At,ot){const ht=At.substr(ot,1);if(ot+=1,ht.toLowerCase()!=="e")return"";const Tt=function(Ht,vn){const Rn=Iv(Ht,vn);if(Rn!=="")return Rn;const ar=Ht.substr(vn,1);if(ar!=="-"&&ar!=="+")return"";const Er=Iv(Ht,vn+=1);return Er===""?"":ar+Er}(At,ot);return Tt===""?"":ht+Tt}function po(At,ot){const ht=At.substr(ot,1);if(ht==="0")return ht;const Tt=function(Ht,vn){const Rn=Ht.substr(vn,1);return Rn.match(/^[1-9]$/)?Rn:""}(At,ot);return ot+=Tt.length,Tt===""?"":Tt+Iv(At,ot)}const qm=c0([function(At,ot){const ht=po(At,ot);if(ot+=ht.length,ht==="")return"";const Tt=At.substr(ot,1);if(ot+=Tt.length,Tt!==".")return"";const Ht=Iv(At,ot);return ht+Tt+Ht+xo(At,ot+=Ht.length)},function(At,ot){const ht=At.substr(ot,1);if(ot+=ht.length,ht!==".")return"";const Tt=Iv(At,ot);return ot+=Tt.length,Tt===""?"":ht+Tt+xo(At,ot)},function(At,ot){const ht=po(At,ot);return ot+=ht.length,ht===""?"":ht+xo(At,ot)}]),Xu=c0([function(At,ot){const ht=At.substr(ot,2);if(ot+=ht.length,ht.toLowerCase()!=="0b")return"";const Tt=function(Ht,vn){var Rn;const ar=Ht.substr(vn).match(/^[01]+/);return(Rn=ar&&ar[0])!==null&&Rn!==void 0?Rn:""}(At,ot);return Tt===""?"":ht+Tt},function(At,ot){const ht=At.substr(ot,2);if(ot+=ht.length,ht.toLowerCase()!=="0o")return"";const Tt=function(Ht,vn){var Rn;const ar=Ht.substr(vn).match(/^[0-7]+/);return(Rn=ar&&ar[0])!==null&&Rn!==void 0?Rn:""}(At,ot);return Tt===""?"":ht+Tt},function(At,ot){const ht=At.substr(ot,2);if(ot+=ht.length,ht.toLowerCase()!=="0x")return"";const Tt=function(Ht,vn){var Rn;const ar=Ht.substr(vn).match(/^[0-9a-f]+/i);return(Rn=ar&&ar[0])!==null&&Rn!==void 0?Rn:""}(At,ot);return Tt===""?"":ht+Tt}]),dy=c0([Xu,qm]);function u0(At,ot){return function(ht,Tt){const Ht=dy(ht,Tt);return Tt+=Ht.length,Ht===""?null:{evaluable:new vA(Ht),cursor:Tt}}(At,ot)||function(ht,Tt){const Ht=ht.substr(Tt,1);if(Tt+=Ht.length,Ht!=="(")return null;const vn=eu(ht,Tt);if(!vn)return null;Tt=vn.cursor,Tt+=Tv(ht,Tt).length;const Rn=ht.substr(Tt,1);return Tt+=Rn.length,Rn!==")"?null:{evaluable:vn.evaluable,cursor:Tt}}(At,ot)}function h0(At,ot,ht){ht+=Tv(ot,ht).length;const Tt=At.filter(Ht=>ot.startsWith(Ht,ht))[0];return Tt?(ht+=Tt.length,{cursor:ht+=Tv(ot,ht).length,operator:Tt}):null}const h_=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((At,ot)=>function(ht,Tt){return(Ht,vn)=>{const Rn=ht(Ht,vn);if(!Rn)return null;vn=Rn.cursor;let ar=Rn.evaluable;for(;;){const Er=h0(Tt,Ht,vn);if(!Er)break;vn=Er.cursor;const ps=ht(Ht,vn);if(!ps)return null;vn=ps.cursor,ar=new l0(Er.operator,ar,ps.evaluable)}return ar?{cursor:vn,evaluable:ar}:null}}(At,ot),function At(ot,ht){const Tt=u0(ot,ht);if(Tt)return Tt;const Ht=ot.substr(ht,1);if(ht+=Ht.length,Ht!=="+"&&Ht!=="-"&&Ht!=="~")return null;const vn=At(ot,ht);return vn?{cursor:ht=vn.cursor,evaluable:new hy(Ht,vn.evaluable)}:null});function eu(At,ot){return ot+=Tv(At,ot).length,h_(At,ot)}function Fl(At){var ot;const ht=function(Tt){const Ht=eu(Tt,0);return Ht?Ht.cursor+Tv(Tt,Ht.cursor).length!==Tt.length?null:Ht.evaluable:null}(At);return(ot=ht==null?void 0:ht.evaluate())!==null&&ot!==void 0?ot:null}function xp(At){if(typeof At=="number")return At;if(typeof At=="string"){const ot=Fl(At);if(!Vt(ot))return ot}return 0}function d0(At){return String(At)}function No(At){return ot=>ot.toFixed(Math.max(Math.min(At,20),0))}const py=No(0);function Dv(At){return py(At)+"%"}function _1(At){return String(At)}function p0(At){return At}function Jp(At,ot){for(;At.length<ot;)At.push(void 0)}function Xs(At){const ot=[];return Jp(ot,At),pn(ot)}function Mw(At){const ot=At.indexOf(void 0);return ot<0?At:At.slice(0,ot)}function f0({primary:At,secondary:ot,forward:ht,backward:Tt}){let Ht=!1;function vn(Rn){Ht||(Ht=!0,Rn(),Ht=!1)}At.emitter.on("change",Rn=>{vn(()=>{ot.setRawValue(ht(At,ot),Rn.options)})}),ot.emitter.on("change",Rn=>{vn(()=>{At.setRawValue(Tt(At,ot),Rn.options)}),vn(()=>{ot.setRawValue(ht(At,ot),Rn.options)})}),vn(()=>{ot.setRawValue(ht(At,ot),{forceEmit:!1,last:!0})})}function Ru(At,ot){const ht=At*(ot.altKey?.1:1)*(ot.shiftKey?10:1);return ot.upKey?+ht:ot.downKey?-ht:0}function d_(At){return{altKey:At.altKey,downKey:At.key==="ArrowDown",shiftKey:At.shiftKey,upKey:At.key==="ArrowUp"}}function tu(At){return{altKey:At.altKey,downKey:At.key==="ArrowLeft",shiftKey:At.shiftKey,upKey:At.key==="ArrowRight"}}function nu(At){return function(ot){return ot==="ArrowUp"||ot==="ArrowDown"}(At)||At==="ArrowLeft"||At==="ArrowRight"}function m0(At,ot){const ht=ot.ownerDocument.defaultView,Tt=ot.getBoundingClientRect();return{x:At.pageX-((ht&&ht.scrollX||0)+Tt.left),y:At.pageY-((ht&&ht.scrollY||0)+Tt.top)}}class iu{constructor(ot){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=ot,this.emitter=new _n,ot.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),ot.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),ot.addEventListener("touchend",this.onTouchEnd_),ot.addEventListener("mousedown",this.onMouseDown_)}computePosition_(ot){const ht=this.elem_.getBoundingClientRect();return{bounds:{width:ht.width,height:ht.height},point:ot?{x:ot.x,y:ot.y}:null}}onMouseDown_(ot){var ht;ot.preventDefault(),(ht=ot.currentTarget)===null||ht===void 0||ht.focus();const Tt=this.elem_.ownerDocument;Tt.addEventListener("mousemove",this.onDocumentMouseMove_),Tt.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:ot.altKey,data:this.computePosition_(m0(ot,this.elem_)),sender:this,shiftKey:ot.shiftKey})}onDocumentMouseMove_(ot){this.emitter.emit("move",{altKey:ot.altKey,data:this.computePosition_(m0(ot,this.elem_)),sender:this,shiftKey:ot.shiftKey})}onDocumentMouseUp_(ot){const ht=this.elem_.ownerDocument;ht.removeEventListener("mousemove",this.onDocumentMouseMove_),ht.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:ot.altKey,data:this.computePosition_(m0(ot,this.elem_)),sender:this,shiftKey:ot.shiftKey})}onTouchStart_(ot){ot.preventDefault();const ht=ot.targetTouches.item(0),Tt=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:ot.altKey,data:this.computePosition_(ht?{x:ht.clientX-Tt.left,y:ht.clientY-Tt.top}:void 0),sender:this,shiftKey:ot.shiftKey}),this.lastTouch_=ht}onTouchMove_(ot){const ht=ot.targetTouches.item(0),Tt=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:ot.altKey,data:this.computePosition_(ht?{x:ht.clientX-Tt.left,y:ht.clientY-Tt.top}:void 0),sender:this,shiftKey:ot.shiftKey}),this.lastTouch_=ht}onTouchEnd_(ot){var ht;const Tt=(ht=ot.targetTouches.item(0))!==null&&ht!==void 0?ht:this.lastTouch_,Ht=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:ot.altKey,data:this.computePosition_(Tt?{x:Tt.clientX-Ht.left,y:Tt.clientY-Ht.top}:void 0),sender:this,shiftKey:ot.shiftKey})}}function to(At,ot,ht,Tt,Ht){return Tt+(At-ot)/(ht-ot)*(Ht-Tt)}function Wl(At){return String(At.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function _o(At,ot,ht){return Math.min(Math.max(At,ot),ht)}function fy(At,ot){return(At%ot+ot)%ot}const bp=bn("txt");class Pv{constructor(ot,ht){this.onChange_=this.onChange_.bind(this),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_),this.element=ot.createElement("div"),this.element.classList.add(bp(),bp(void 0,"num")),ht.arrayPosition&&this.element.classList.add(bp(void 0,ht.arrayPosition)),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("input");Tt.classList.add(bp("i")),Tt.type="text",ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=ht.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(bp()),this.inputElement.classList.add(bp("i"));const Ht=ot.createElement("div");Ht.classList.add(bp("k")),this.element.appendChild(Ht),this.knobElement=Ht;const vn=ot.createElementNS(zn,"svg");vn.classList.add(bp("g")),this.knobElement.appendChild(vn);const Rn=ot.createElementNS(zn,"path");Rn.classList.add(bp("gb")),vn.appendChild(Rn),this.guideBodyElem_=Rn;const ar=ot.createElementNS(zn,"path");ar.classList.add(bp("gh")),vn.appendChild(ar),this.guideHeadElem_=ar;const Er=ot.createElement("div");Er.classList.add(bn("tt")()),this.knobElement.appendChild(Er),this.tooltipElem_=Er,ht.value.emitter.on("change",this.onChange_),this.value=ht.value,this.refresh()}onDraggingChange_(ot){if(ot.rawValue===null)return void this.element.classList.remove(bp(void 0,"drg"));this.element.classList.add(bp(void 0,"drg"));const ht=ot.rawValue/this.props_.get("draggingScale"),Tt=ht+(ht>0?-1:ht<0?1:0),Ht=_o(-Tt,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${Tt+Ht},0 L${Tt},4 L${Tt+Ht},8`,`M ${ht},-1 L${ht},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${ht},4`);const vn=this.props_.get("formatter");this.tooltipElem_.textContent=vn(this.value.rawValue),this.tooltipElem_.style.left=`${ht}px`}refresh(){const ot=this.props_.get("formatter");this.inputElement.value=ot(this.value.rawValue)}onChange_(){this.refresh()}}class g0{constructor(ot,ht){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ht.baseStep,this.parser_=ht.parser,this.props=ht.props,this.value=ht.value,this.viewProps=ht.viewProps,this.dragging_=pn(null),this.view=new Pv(ot,{arrayPosition:ht.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const Tt=new iu(this.view.knobElement);Tt.emitter.on("down",this.onPointerDown_),Tt.emitter.on("move",this.onPointerMove_),Tt.emitter.on("up",this.onPointerUp_)}onInputChange_(ot){const ht=ot.currentTarget.value,Tt=this.parser_(ht);Vt(Tt)||(this.value.rawValue=Tt),this.view.refresh()}onInputKeyDown_(ot){const ht=Ru(this.baseStep_,d_(ot));ht!==0&&this.value.setRawValue(this.value.rawValue+ht,{forceEmit:!1,last:!1})}onInputKeyUp_(ot){Ru(this.baseStep_,d_(ot))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(ot){if(!ot.point)return null;const ht=ot.point.x-ot.bounds.width/2;return this.originRawValue_+ht*this.props.get("draggingScale")}onPointerMove_(ot){const ht=this.computeDraggingValue_(ot.data);ht!==null&&(this.value.setRawValue(ht,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(ot){const ht=this.computeDraggingValue_(ot.data);ht!==null&&(this.value.setRawValue(ht,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Jo=bn("sld");class Tw{constructor(ot,ht){this.onChange_=this.onChange_.bind(this),this.props_=ht.props,this.props_.emitter.on("change",this.onChange_),this.element=ot.createElement("div"),this.element.classList.add(Jo()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("div");Tt.classList.add(Jo("t")),ht.viewProps.bindTabIndex(Tt),this.element.appendChild(Tt),this.trackElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(Jo("k")),this.trackElement.appendChild(Ht),this.knobElement=Ht,ht.value.emitter.on("change",this.onChange_),this.value=ht.value,this.update_()}update_(){const ot=_o(to(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${ot}%`}onChange_(){this.update_()}}class Iw{constructor(ot,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=ht.baseStep,this.value=ht.value,this.viewProps=ht.viewProps,this.props=ht.props,this.view=new Tw(ot,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iu(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ot,ht){ot.point&&this.value.setRawValue(to(_o(ot.point.x,0,ot.bounds.width),0,ot.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),ht)}onPointerDownOrMove_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerUp_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!0,last:!0})}onKeyDown_(ot){const ht=Ru(this.baseStep_,tu(ot));ht!==0&&this.value.setRawValue(this.value.rawValue+ht,{forceEmit:!1,last:!1})}onKeyUp_(ot){Ru(this.baseStep_,tu(ot))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const yu=bn("sldtxt");class Dw{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(yu());const Tt=ot.createElement("div");Tt.classList.add(yu("s")),this.sliderView_=ht.sliderView,Tt.appendChild(this.sliderView_.element),this.element.appendChild(Tt);const Ht=ot.createElement("div");Ht.classList.add(yu("t")),this.textView_=ht.textView,Ht.appendChild(this.textView_.element),this.element.appendChild(Ht)}}class Ep{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.sliderC_=new Iw(ot,{baseStep:ht.baseStep,props:ht.sliderProps,value:ht.value,viewProps:this.viewProps}),this.textC_=new g0(ot,{baseStep:ht.baseStep,parser:ht.parser,props:ht.textProps,value:ht.value,viewProps:ht.viewProps}),this.view=new Dw(ot,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Rv(At,ot){At.write(ot)}function p_(At){const ot=zr;return Array.isArray(At)?ot.required.array(ot.required.object({text:ot.required.string,value:ot.required.raw}))(At).value:typeof At=="object"?ot.required.raw(At).value:void 0}function A1(At){if(At==="inline"||At==="popup")return At}function Am(At){const ot=zr;return ot.required.object({max:ot.optional.number,min:ot.optional.number,step:ot.optional.number})(At).value}function v0(At){if(Array.isArray(At))return At;const ot=[];return Object.keys(At).forEach(ht=>{ot.push({text:ht,value:At[ht]})}),ot}function Zo(At){return Vt(At)?null:new Sv(v0(At))}function my(At){const ot=At?rp(At,Sv):null;return ot?ot.options:null}function gy(At,ot){const ht=At&&rp(At,wp);return ht?Wl(ht.step):Math.max(Wl(ot),2)}function Ym(At){const ot=function(ht){const Tt=ht?rp(ht,wp):null;return Tt?Tt.step:null}(At);return ot??1}function _0(At,ot){var ht;const Tt=At&&rp(At,wp),Ht=Math.abs((ht=Tt==null?void 0:Tt.step)!==null&&ht!==void 0?ht:ot);return Ht===0?.1:Math.pow(10,Math.floor(Math.log10(Ht))-1)}const f_=bn("ckb");class vy{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),this.element=ot.createElement("div"),this.element.classList.add(f_()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("label");Tt.classList.add(f_("l")),this.element.appendChild(Tt);const Ht=ot.createElement("input");Ht.classList.add(f_("i")),Ht.type="checkbox",Tt.appendChild(Ht),this.inputElement=Ht,ht.viewProps.bindDisabled(this.inputElement);const vn=ot.createElement("div");vn.classList.add(f_("w")),Tt.appendChild(vn);const Rn=Xt(ot,"check");vn.appendChild(Rn),ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class DS{constructor(ot,ht){this.onInputChange_=this.onInputChange_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new vy(ot,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(ot){const ht=ot.currentTarget;this.value.rawValue=ht.checked}}const y1={id:"input-bool",type:"input",accept:(At,ot)=>{if(typeof At!="boolean")return null;const ht=Ar(ot,{options:zr.optional.custom(p_)});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>qs,constraint:At=>function(ot){const ht=[],Tt=Zo(ot.options);return Tt&&ht.push(Tt),new Ev(ht)}(At.params),writer:At=>Rv},controller:At=>{var ot;const ht=At.document,Tt=At.value,Ht=At.constraint;return Ht&&rp(Ht,Sv)?new _c(ht,{props:er.fromObject({options:(ot=my(Ht))!==null&&ot!==void 0?ot:[]}),value:Tt,viewProps:At.viewProps}):new DS(ht,{value:Tt,viewProps:At.viewProps})}},Xm=bn("col");class _y{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(Xm()),ht.foldable.bindExpandedClass(this.element,Xm(void 0,"expanded")),Yt(ht.foldable,"completed",Bn(this.element,Xm(void 0,"cpl")));const Tt=ot.createElement("div");Tt.classList.add(Xm("h")),this.element.appendChild(Tt);const Ht=ot.createElement("div");Ht.classList.add(Xm("s")),Tt.appendChild(Ht),this.swatchElement=Ht;const vn=ot.createElement("div");if(vn.classList.add(Xm("t")),Tt.appendChild(vn),this.textElement=vn,ht.pickerLayout==="inline"){const Rn=ot.createElement("div");Rn.classList.add(Xm("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}function Ts(At,ot,ht){const Tt=fy(At,360),Ht=_o(ot/100,0,1),vn=_o(ht/100,0,1),Rn=vn*Ht,ar=Rn*(1-Math.abs(Tt/60%2-1)),Er=vn-Rn;let ps,ws,ls;return[ps,ws,ls]=Tt>=0&&Tt<60?[Rn,ar,0]:Tt>=60&&Tt<120?[ar,Rn,0]:Tt>=120&&Tt<180?[0,Rn,ar]:Tt>=180&&Tt<240?[0,ar,Rn]:Tt>=240&&Tt<300?[ar,0,Rn]:[Rn,0,ar],[255*(ps+Er),255*(ws+Er),255*(ls+Er)]}function Cl(At){return[At[0],At[1],At[2]]}function Pw(At,ot){return[At[0],At[1],At[2],ot]}const A0={hsl:{hsl:(At,ot,ht)=>[At,ot,ht],hsv:function(At,ot,ht){const Tt=ht+ot*(100-Math.abs(2*ht-100))/200;return[At,Tt!==0?ot*(100-Math.abs(2*ht-100))/Tt:0,ht+ot*(100-Math.abs(2*ht-100))/200]},rgb:function(At,ot,ht){const Tt=(At%360+360)%360,Ht=_o(ot/100,0,1),vn=_o(ht/100,0,1),Rn=(1-Math.abs(2*vn-1))*Ht,ar=Rn*(1-Math.abs(Tt/60%2-1)),Er=vn-Rn/2;let ps,ws,ls;return[ps,ws,ls]=Tt>=0&&Tt<60?[Rn,ar,0]:Tt>=60&&Tt<120?[ar,Rn,0]:Tt>=120&&Tt<180?[0,Rn,ar]:Tt>=180&&Tt<240?[0,ar,Rn]:Tt>=240&&Tt<300?[ar,0,Rn]:[Rn,0,ar],[255*(ps+Er),255*(ws+Er),255*(ls+Er)]}},hsv:{hsl:function(At,ot,ht){const Tt=100-Math.abs(ht*(200-ot)/100-100);return[At,Tt!==0?ot*ht/Tt:0,ht*(200-ot)/200]},hsv:(At,ot,ht)=>[At,ot,ht],rgb:Ts},rgb:{hsl:function(At,ot,ht){const Tt=_o(At/255,0,1),Ht=_o(ot/255,0,1),vn=_o(ht/255,0,1),Rn=Math.max(Tt,Ht,vn),ar=Math.min(Tt,Ht,vn),Er=Rn-ar;let ps=0,ws=0;const ls=(ar+Rn)/2;return Er!==0&&(ws=Er/(1-Math.abs(Rn+ar-1)),ps=Tt===Rn?(Ht-vn)/Er:Ht===Rn?2+(vn-Tt)/Er:4+(Tt-Ht)/Er,ps=ps/6+(ps<0?1:0)),[360*ps,100*ws,100*ls]},hsv:function(At,ot,ht){const Tt=_o(At/255,0,1),Ht=_o(ot/255,0,1),vn=_o(ht/255,0,1),Rn=Math.max(Tt,Ht,vn),ar=Rn-Math.min(Tt,Ht,vn);let Er;return Er=ar===0?0:Rn===Tt?((Ht-vn)/ar%6+6)%6*60:Rn===Ht?60*((vn-Tt)/ar+2):60*((Tt-Ht)/ar+4),[Er,100*(Rn===0?0:ar/Rn),100*Rn]},rgb:(At,ot,ht)=>[At,ot,ht]}},_A={hsl:At=>{var ot;return[fy(At[0],360),_o(At[1],0,100),_o(At[2],0,100),_o((ot=At[3])!==null&&ot!==void 0?ot:1,0,1)]},hsv:At=>{var ot;return[fy(At[0],360),_o(At[1],0,100),_o(At[2],0,100),_o((ot=At[3])!==null&&ot!==void 0?ot:1,0,1)]},rgb:At=>{var ot;return[_o(At[0],0,255),_o(At[1],0,255),_o(At[2],0,255),_o((ot=At[3])!==null&&ot!==void 0?ot:1,0,1)]}};function wu(At,ot){return typeof At=="object"&&!Vt(At)&&ot in At&&typeof At[ot]=="number"}class ys{constructor(ot,ht){this.mode_=ht,this.comps_=_A[ht](ot)}static black(){return new ys([0,0,0],"rgb")}static fromObject(ot){const ht="a"in ot?[ot.r,ot.g,ot.b,ot.a]:[ot.r,ot.g,ot.b];return new ys(ht,"rgb")}static toRgbaObject(ot){return ot.toRgbaObject()}static isRgbColorObject(ot){return wu(ot,"r")&&wu(ot,"g")&&wu(ot,"b")}static isRgbaColorObject(ot){return this.isRgbColorObject(ot)&&wu(ot,"a")}static isColorObject(ot){return this.isRgbColorObject(ot)}static equals(ot,ht){if(ot.mode_!==ht.mode_)return!1;const Tt=ot.comps_,Ht=ht.comps_;for(let vn=0;vn<Tt.length;vn++)if(Tt[vn]!==Ht[vn])return!1;return!0}get mode(){return this.mode_}getComponents(ot){return Pw((ht=Cl(this.comps_),Tt=this.mode_,Ht=ot||this.mode_,A0[Tt][Ht](...ht)),this.comps_[3]);var ht,Tt,Ht}toRgbaObject(){const ot=this.getComponents("rgb");return{r:ot[0],g:ot[1],b:ot[2],a:ot[3]}}}const ym=bn("colp");class AA{constructor(ot,ht){this.alphaViews_=null,this.element=ot.createElement("div"),this.element.classList.add(ym());const Tt=ot.createElement("div");Tt.classList.add(ym("hsv"));const Ht=ot.createElement("div");Ht.classList.add(ym("sv")),this.svPaletteView_=ht.svPaletteView,Ht.appendChild(this.svPaletteView_.element),Tt.appendChild(Ht);const vn=ot.createElement("div");vn.classList.add(ym("h")),this.hPaletteView_=ht.hPaletteView,vn.appendChild(this.hPaletteView_.element),Tt.appendChild(vn),this.element.appendChild(Tt);const Rn=ot.createElement("div");if(Rn.classList.add(ym("rgb")),this.textView_=ht.textView,Rn.appendChild(this.textView_.element),this.element.appendChild(Rn),ht.alphaViews){this.alphaViews_={palette:ht.alphaViews.palette,text:ht.alphaViews.text};const ar=ot.createElement("div");ar.classList.add(ym("a"));const Er=ot.createElement("div");Er.classList.add(ym("ap")),Er.appendChild(this.alphaViews_.palette.element),ar.appendChild(Er);const ps=ot.createElement("div");ps.classList.add(ym("at")),ps.appendChild(this.alphaViews_.text.element),ar.appendChild(ps),this.element.appendChild(ar)}}get allFocusableElements(){const ot=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(ht=>ht.inputElement)];return this.alphaViews_&&ot.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),ot}}function yA(At){const ot=zr;return Ar(At,{alpha:ot.optional.boolean,expanded:ot.optional.boolean,picker:ot.optional.custom(A1)})}function Bv(At){return At?.1:1}function Bu(At,ot){const ht=At.match(/^(.+)%$/);return Math.min(ht?.01*parseFloat(ht[1])*ot:parseFloat(At),ot)}const Km={deg:At=>At,grad:At=>360*At/400,rad:At=>360*At/(2*Math.PI),turn:At=>360*At};function Io(At){const ot=At.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!ot)return parseFloat(At);const ht=parseFloat(ot[1]),Tt=ot[2];return Km[Tt](ht)}const Ay={"func.rgb":At=>{const ot=At.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ot)return null;const ht=[Bu(ot[1],255),Bu(ot[2],255),Bu(ot[3],255)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])?null:new ys(ht,"rgb")},"func.rgba":At=>{const ot=At.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ot)return null;const ht=[Bu(ot[1],255),Bu(ot[2],255),Bu(ot[3],255),Bu(ot[4],1)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])||isNaN(ht[3])?null:new ys(ht,"rgb")},"func.hsl":At=>{const ot=At.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ot)return null;const ht=[Io(ot[1]),Bu(ot[2],100),Bu(ot[3],100)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])?null:new ys(ht,"hsl")},"func.hsla":At=>{const ot=At.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!ot)return null;const ht=[Io(ot[1]),Bu(ot[2],100),Bu(ot[3],100),Bu(ot[4],1)];return isNaN(ht[0])||isNaN(ht[1])||isNaN(ht[2])||isNaN(ht[3])?null:new ys(ht,"hsl")},"hex.rgb":At=>{const ot=At.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ot)return new ys([parseInt(ot[1]+ot[1],16),parseInt(ot[2]+ot[2],16),parseInt(ot[3]+ot[3],16)],"rgb");const ht=At.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ht?new ys([parseInt(ht[1],16),parseInt(ht[2],16),parseInt(ht[3],16)],"rgb"):null},"hex.rgba":At=>{const ot=At.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(ot)return new ys([parseInt(ot[1]+ot[1],16),parseInt(ot[2]+ot[2],16),parseInt(ot[3]+ot[3],16),to(parseInt(ot[4]+ot[4],16),0,255,0,1)],"rgb");const ht=At.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return ht?new ys([parseInt(ht[1],16),parseInt(ht[2],16),parseInt(ht[3],16),to(parseInt(ht[4],16),0,255,0,1)],"rgb"):null}};function Cr(At){return Object.keys(Ay).reduce((ot,ht)=>ot||((0,Ay[ht])(At)?ht:null),null)}const ru=At=>{const ot=Cr(At);return ot?Ay[ot](At):null};function w1(At){return At==="func.hsla"||At==="func.rgba"||At==="hex.rgba"}function Rw(At){if(typeof At=="string"){const ot=ru(At);if(ot)return ot}return ys.black()}function y0(At){const ot=_o(Math.floor(At),0,255).toString(16);return ot.length===1?`0${ot}`:ot}function w0(At,ot="#"){return`${ot}${Cl(At.getComponents("rgb")).map(y0).join("")}`}function Zp(At,ot="#"){const ht=At.getComponents("rgb");return`${ot}${[ht[0],ht[1],ht[2],255*ht[3]].map(y0).join("")}`}function wA(At){const ot=No(0);return`rgb(${Cl(At.getComponents("rgb")).map(ht=>ot(ht)).join(", ")})`}function m_(At){const ot=No(2),ht=No(0);return`rgba(${At.getComponents("rgb").map((Tt,Ht)=>(Ht===3?ot:ht)(Tt)).join(", ")})`}const xu={"func.hsl":function(At){const ot=[No(0),Dv,Dv];return`hsl(${Cl(At.getComponents("hsl")).map((ht,Tt)=>ot[Tt](ht)).join(", ")})`},"func.hsla":function(At){const ot=[No(0),Dv,Dv,No(2)];return`hsla(${At.getComponents("hsl").map((ht,Tt)=>ot[Tt](ht)).join(", ")})`},"func.rgb":wA,"func.rgba":m_,"hex.rgb":w0,"hex.rgba":Zp};function yy(At){return xu[At]}const $o=bn("apl");class Sp{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=ot.createElement("div"),this.element.classList.add($o()),ht.viewProps.bindTabIndex(this.element);const Tt=ot.createElement("div");Tt.classList.add($o("b")),this.element.appendChild(Tt);const Ht=ot.createElement("div");Ht.classList.add($o("c")),Tt.appendChild(Ht),this.colorElem_=Ht;const vn=ot.createElement("div");vn.classList.add($o("m")),this.element.appendChild(vn),this.markerElem_=vn;const Rn=ot.createElement("div");Rn.classList.add($o("p")),this.markerElem_.appendChild(Rn),this.previewElem_=Rn,this.update_()}update_(){const ot=this.value.rawValue,ht=ot.getComponents("rgb"),Tt=new ys([ht[0],ht[1],ht[2],0],"rgb"),Ht=new ys([ht[0],ht[1],ht[2],255],"rgb"),vn=["to right",m_(Tt),m_(Ht)];this.colorElem_.style.background=`linear-gradient(${vn.join(",")})`,this.previewElem_.style.backgroundColor=m_(ot);const Rn=to(ht[3],0,1,0,100);this.markerElem_.style.left=`${Rn}%`}onValueChange_(){this.update_()}}class g_{constructor(ot,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Sp(ot,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ot,ht){if(!ot.point)return;const Tt=ot.point.x/ot.bounds.width,Ht=this.value.rawValue,[vn,Rn,ar]=Ht.getComponents("hsv");this.value.setRawValue(new ys([vn,Rn,ar,Tt],"hsv"),ht)}onPointerDown_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerMove_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerUp_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!0,last:!0})}onKeyDown_(ot){const ht=Ru(Bv(!0),tu(ot));if(ht===0)return;const Tt=this.value.rawValue,[Ht,vn,Rn,ar]=Tt.getComponents("hsv");this.value.setRawValue(new ys([Ht,vn,Rn,ar+ht],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ot){Ru(Bv(!0),tu(ot))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const sp=bn("coltxt");class wy{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(sp());const Tt=ot.createElement("div");Tt.classList.add(sp("m")),this.modeElem_=function(Rn){const ar=Rn.createElement("select");return ar.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Er,ps)=>{const ws=Rn.createElement("option");return ws.textContent=ps.text,ws.value=ps.value,Er.appendChild(ws),Er},Rn.createDocumentFragment())),ar}(ot),this.modeElem_.classList.add(sp("ms")),Tt.appendChild(this.modeSelectElement);const Ht=ot.createElement("div");Ht.classList.add(sp("mm")),Ht.appendChild(Xt(ot,"dropdown")),Tt.appendChild(Ht),this.element.appendChild(Tt);const vn=ot.createElement("div");vn.classList.add(sp("w")),this.element.appendChild(vn),this.textsElem_=vn,this.textViews_=ht.textViews,this.applyTextViews_(),jt(ht.colorMode,Rn=>{this.modeElem_.value=Rn})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(ot){this.textViews_=ot,this.applyTextViews_()}applyTextViews_(){Nr(this.textsElem_);const ot=this.element.ownerDocument;this.textViews_.forEach(ht=>{const Tt=ot.createElement("div");Tt.classList.add(sp("c")),Tt.appendChild(ht.element),this.textsElem_.appendChild(Tt)})}}const ts=No(0),Cp={rgb:()=>new wo({min:0,max:255}),hsl:At=>new wo(At===0?{min:0,max:360}:{min:0,max:100}),hsv:At=>new wo(At===0?{min:0,max:360}:{min:0,max:100})};function xA(At,ot,ht){return new g0(At,{arrayPosition:ht===0?"fst":ht===2?"lst":"mid",baseStep:Bv(!1),parser:ot.parser,props:er.fromObject({draggingScale:1,formatter:ts}),value:pn(0,{constraint:Cp[ot.colorMode](ht)}),viewProps:ot.viewProps})}class x0{constructor(ot,ht){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=ht.parser,this.value=ht.value,this.viewProps=ht.viewProps,this.colorMode=pn(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(ot),this.view=new wy(ot,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(ot){const ht={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},Tt=[xA(ot,ht,0),xA(ot,ht,1),xA(ot,ht,2)];return Tt.forEach((Ht,vn)=>{f0({primary:this.value,secondary:Ht.value,forward:Rn=>Rn.rawValue.getComponents(this.colorMode.rawValue)[vn],backward:(Rn,ar)=>{const Er=this.colorMode.rawValue,ps=Rn.rawValue.getComponents(Er);return ps[vn]=ar.rawValue,new ys(Pw(Cl(ps),ps[3]),Er)}})}),Tt}onModeSelectChange_(ot){const ht=ot.currentTarget;this.colorMode.rawValue=ht.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const v_=bn("hpl");class Bw{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=ot.createElement("div"),this.element.classList.add(v_()),ht.viewProps.bindTabIndex(this.element);const Tt=ot.createElement("div");Tt.classList.add(v_("c")),this.element.appendChild(Tt);const Ht=ot.createElement("div");Ht.classList.add(v_("m")),this.element.appendChild(Ht),this.markerElem_=Ht,this.update_()}update_(){const ot=this.value.rawValue,[ht]=ot.getComponents("hsv");this.markerElem_.style.backgroundColor=wA(new ys([ht,100,100],"hsv"));const Tt=to(ht,0,360,0,100);this.markerElem_.style.left=`${Tt}%`}onValueChange_(){this.update_()}}class zl{constructor(ot,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Bw(ot,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ot,ht){if(!ot.point)return;const Tt=to(_o(ot.point.x,0,ot.bounds.width),0,ot.bounds.width,0,359),Ht=this.value.rawValue,[,vn,Rn,ar]=Ht.getComponents("hsv");this.value.setRawValue(new ys([Tt,vn,Rn,ar],"hsv"),ht)}onPointerDown_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerMove_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerUp_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!0,last:!0})}onKeyDown_(ot){const ht=Ru(Bv(!1),tu(ot));if(ht===0)return;const Tt=this.value.rawValue,[Ht,vn,Rn,ar]=Tt.getComponents("hsv");this.value.setRawValue(new ys([Ht+ht,vn,Rn,ar],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ot){Ru(Bv(!1),tu(ot))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const fo=bn("svp");class Ku{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),this.value=ht.value,this.value.emitter.on("change",this.onValueChange_),this.element=ot.createElement("div"),this.element.classList.add(fo()),ht.viewProps.bindTabIndex(this.element);const Tt=ot.createElement("canvas");Tt.height=64,Tt.width=64,Tt.classList.add(fo("c")),this.element.appendChild(Tt),this.canvasElement=Tt;const Ht=ot.createElement("div");Ht.classList.add(fo("m")),this.element.appendChild(Ht),this.markerElem_=Ht,this.update_()}update_(){const ot=function(ps){const ws=ps.ownerDocument.defaultView;return ws&&"document"in ws?ps.getContext("2d"):null}(this.canvasElement);if(!ot)return;const ht=this.value.rawValue.getComponents("hsv"),Tt=this.canvasElement.width,Ht=this.canvasElement.height,vn=ot.getImageData(0,0,Tt,Ht),Rn=vn.data;for(let ps=0;ps<Ht;ps++)for(let ws=0;ws<Tt;ws++){const ls=to(ws,0,Tt,0,100),Fo=to(ps,0,Ht,100,0),Ml=Ts(ht[0],ls,Fo),Np=4*(ps*Tt+ws);Rn[Np]=Ml[0],Rn[Np+1]=Ml[1],Rn[Np+2]=Ml[2],Rn[Np+3]=255}ot.putImageData(vn,0,0);const ar=to(ht[1],0,100,0,100);this.markerElem_.style.left=`${ar}%`;const Er=to(ht[2],0,100,100,0);this.markerElem_.style.top=`${Er}%`}onValueChange_(){this.update_()}}class __{constructor(ot,ht){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Ku(ot,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iu(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(ot,ht){if(!ot.point)return;const Tt=to(ot.point.x,0,ot.bounds.width,0,100),Ht=to(ot.point.y,0,ot.bounds.height,100,0),[vn,,,Rn]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ys([vn,Tt,Ht,Rn],"hsv"),ht)}onPointerDown_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerMove_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerUp_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!0,last:!0})}onKeyDown_(ot){nu(ot.key)&&ot.preventDefault();const[ht,Tt,Ht,vn]=this.value.rawValue.getComponents("hsv"),Rn=Bv(!1),ar=Ru(Rn,tu(ot)),Er=Ru(Rn,d_(ot));ar===0&&Er===0||this.value.setRawValue(new ys([ht,Tt+ar,Ht+Er,vn],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(ot){const ht=Bv(!1),Tt=Ru(ht,tu(ot)),Ht=Ru(ht,d_(ot));Tt===0&&Ht===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class x1{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.hPaletteC_=new zl(ot,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new __(ot,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=ht.supportsAlpha?{palette:new g_(ot,{value:this.value,viewProps:this.viewProps}),text:new g0(ot,{parser:Fl,baseStep:.1,props:er.fromObject({draggingScale:.01,formatter:No(2)}),value:pn(0,{constraint:new wo({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&f0({primary:this.value,secondary:this.alphaIcs_.text.value,forward:Tt=>Tt.rawValue.getComponents()[3],backward:(Tt,Ht)=>{const vn=Tt.rawValue.getComponents();return vn[3]=Ht.rawValue,new ys(vn,Tt.rawValue.mode)}}),this.textC_=new x0(ot,{parser:Fl,value:this.value,viewProps:this.viewProps}),this.view=new AA(ot,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:ht.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const b0=bn("colsw");class xy{constructor(ot,ht){this.onValueChange_=this.onValueChange_.bind(this),ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.element=ot.createElement("div"),this.element.classList.add(b0()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("div");Tt.classList.add(b0("sw")),this.element.appendChild(Tt),this.swatchElem_=Tt;const Ht=ot.createElement("button");Ht.classList.add(b0("b")),ht.viewProps.bindDisabled(Ht),this.element.appendChild(Ht),this.buttonElement=Ht,this.update_()}update_(){const ot=this.value.rawValue;this.swatchElem_.style.backgroundColor=Zp(ot)}onValueChange_(){this.update_()}}class Mp{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new xy(ot,{value:this.value,viewProps:this.viewProps})}}class su{constructor(ot,ht){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.foldable_=$s.create(ht.expanded),this.swatchC_=new Mp(ot,{value:this.value,viewProps:this.viewProps});const Tt=this.swatchC_.view.buttonElement;Tt.addEventListener("blur",this.onButtonBlur_),Tt.addEventListener("click",this.onButtonClick_),this.textC_=new ho(ot,{parser:ht.parser,props:er.fromObject({formatter:ht.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new _y(ot,{foldable:this.foldable_,pickerLayout:ht.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=ht.pickerLayout==="popup"?new ss(ot,{viewProps:this.viewProps}):null;const Ht=new x1(ot,{supportsAlpha:ht.supportsAlpha,value:this.value,viewProps:this.viewProps});Ht.view.allFocusableElements.forEach(vn=>{vn.addEventListener("blur",this.onPopupChildBlur_),vn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Ht,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(Ht.view.element),f0({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:vn=>vn.rawValue,backward:(vn,Rn)=>Rn.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),yo(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(ot){if(!this.popC_)return;const ht=this.view.element,Tt=ot.relatedTarget;Tt&&ht.contains(Tt)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ot){if(!this.popC_)return;const ht=this.popC_.view.element,Tt=kr(ot);Tt&&ht.contains(Tt)||Tt&&Tt===this.swatchC_.view.buttonElement&&!$n(ht.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ot){this.popC_?ot.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ot.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function dn(At){return ys.isColorObject(At)?ys.fromObject(At):ys.black()}function Jm(At){return Cl(At.getComponents("rgb")).reduce((ot,ht)=>ot<<8|255&Math.floor(ht),0)}function Tp(At){return At.getComponents("rgb").reduce((ot,ht,Tt)=>ot<<8|255&Math.floor(Tt===3?255*ht:ht),0)>>>0}function E0(At){return typeof At!="number"?ys.black():new ys([(ot=At)>>16&255,ot>>8&255,255&ot],"rgb");var ot}function Zm(At){return typeof At!="number"?ys.black():new ys([(ot=At)>>24&255,ot>>16&255,ot>>8&255,to(255&ot,0,255,0,1)],"rgb");var ot}function S0(At,ot){const ht=ot.toRgbaObject();At.writeProperty("r",ht.r),At.writeProperty("g",ht.g),At.writeProperty("b",ht.b),At.writeProperty("a",ht.a)}function by(At,ot){const ht=ot.toRgbaObject();At.writeProperty("r",ht.r),At.writeProperty("g",ht.g),At.writeProperty("b",ht.b)}function $p(At){return"alpha"in At&&At.alpha===!0}function kv(At){return At?ot=>Zp(ot,"0x"):ot=>w0(ot,"0x")}const $m={id:"input-color-number",type:"input",accept:(At,ot)=>{if(typeof At!="number"||!("view"in ot)||ot.view!=="color")return null;const ht=yA(ot);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>$p(At.params)?Zm:E0,equals:ys.equals,writer:At=>function(ot){const ht=ot?Tp:Jm;return(Tt,Ht)=>{Rv(Tt,ht(Ht))}}($p(At.params))},controller:At=>{const ot=$p(At.params),ht="expanded"in At.params?At.params.expanded:void 0,Tt="picker"in At.params?At.params.picker:void 0;return new su(At.document,{expanded:ht!=null&&ht,formatter:kv(ot),parser:ru,pickerLayout:Tt??"popup",supportsAlpha:ot,value:At.value,viewProps:At.viewProps})}},_f={id:"input-color-object",type:"input",accept:(At,ot)=>{if(!ys.isColorObject(At))return null;const ht=yA(ot);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>dn,equals:ys.equals,writer:At=>{return ot=At.initialValue,ys.isRgbaColorObject(ot)?S0:by;var ot}},controller:At=>{const ot=ys.isRgbaColorObject(At.initialValue),ht="expanded"in At.params?At.params.expanded:void 0,Tt="picker"in At.params?At.params.picker:void 0,Ht=ot?Zp:w0;return new su(At.document,{expanded:ht!=null&&ht,formatter:Ht,parser:ru,pickerLayout:Tt??"popup",supportsAlpha:ot,value:At.value,viewProps:At.viewProps})}},Lv={id:"input-color-string",type:"input",accept:(At,ot)=>{if(typeof At!="string"||"view"in ot&&ot.view==="text"||!Cr(At))return null;const ht=yA(ot);return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>Rw,equals:ys.equals,writer:At=>{const ot=Cr(At.initialValue);if(!ot)throw mn.shouldNeverHappen();return function(ht){const Tt=yy(ht);return(Ht,vn)=>{Rv(Ht,Tt(vn))}}(ot)}},controller:At=>{const ot=Cr(At.initialValue);if(!ot)throw mn.shouldNeverHappen();const ht=yy(ot),Tt="expanded"in At.params?At.params.expanded:void 0,Ht="picker"in At.params?At.params.picker:void 0;return new su(At.document,{expanded:Tt!=null&&Tt,formatter:ht,parser:ru,pickerLayout:Ht??"popup",supportsAlpha:w1(ot),value:At.value,viewProps:At.viewProps})}};class Ju{constructor(ot){this.components=ot.components,this.asm_=ot.assembly}constrain(ot){const ht=this.asm_.toComponents(ot).map((Tt,Ht)=>{var vn,Rn;return(Rn=(vn=this.components[Ht])===null||vn===void 0?void 0:vn.constrain(Tt))!==null&&Rn!==void 0?Rn:Tt});return this.asm_.fromComponents(ht)}}const A_=bn("pndtxt");class Ey{constructor(ot,ht){this.textViews=ht.textViews,this.element=ot.createElement("div"),this.element.classList.add(A_()),this.textViews.forEach(Tt=>{const Ht=ot.createElement("div");Ht.classList.add(A_("a")),Ht.appendChild(Tt.element),this.element.appendChild(Ht)})}}class C0{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.acs_=ht.axes.map((Tt,Ht)=>function(vn,Rn,ar){return new g0(vn,{arrayPosition:ar===0?"fst":ar===Rn.axes.length-1?"lst":"mid",baseStep:Rn.axes[ar].baseStep,parser:Rn.parser,props:Rn.axes[ar].textProps,value:pn(0,{constraint:Rn.axes[ar].constraint}),viewProps:Rn.viewProps})}(ot,ht,Ht)),this.acs_.forEach((Tt,Ht)=>{f0({primary:this.value,secondary:Tt.value,forward:vn=>ht.assembly.toComponents(vn.rawValue)[Ht],backward:(vn,Rn)=>{const ar=ht.assembly.toComponents(vn.rawValue);return ar[Ht]=Rn.rawValue,ht.assembly.fromComponents(ar)}})}),this.view=new Ey(ot,{textViews:this.acs_.map(Tt=>Tt.view)})}}function Ov(At){const ot=[],ht=function(vn){return"step"in vn&&!Vt(vn.step)?new wp(vn.step):null}(At);ht&&ot.push(ht);const Tt=function(vn){return"max"in vn&&!Vt(vn.max)||"min"in vn&&!Vt(vn.min)?new wo({max:vn.max,min:vn.min}):null}(At);Tt&&ot.push(Tt);const Ht=Zo(At.options);return Ht&&ot.push(Ht),new Ev(ot)}function Sy(At){const[ot,ht]=function(Tt){const Ht=Tt?rp(Tt,wo):null;return Ht?[Ht.minValue,Ht.maxValue]:[void 0,void 0]}(At);return[ot??0,ht??100]}const no={id:"input-number",type:"input",accept:(At,ot)=>{if(typeof At!="number")return null;const ht=zr,Tt=Ar(ot,{format:ht.optional.function,max:ht.optional.number,min:ht.optional.number,options:ht.optional.custom(p_),step:ht.optional.number});return Tt?{initialValue:At,params:Tt}:null},binding:{reader:At=>xp,constraint:At=>Ov(At.params),writer:At=>Rv},controller:At=>{var ot,ht;const Tt=At.value,Ht=At.constraint;if(Ht&&rp(Ht,Sv))return new _c(At.document,{props:er.fromObject({options:(ot=my(Ht))!==null&&ot!==void 0?ot:[]}),value:Tt,viewProps:At.viewProps});const vn=(ht="format"in At.params?At.params.format:void 0)!==null&&ht!==void 0?ht:No(gy(Ht,Tt.rawValue));if(Ht&&rp(Ht,wo)){const[Rn,ar]=Sy(Ht);return new Ep(At.document,{baseStep:Ym(Ht),parser:Fl,sliderProps:er.fromObject({maxValue:ar,minValue:Rn}),textProps:er.fromObject({draggingScale:_0(Ht,Tt.rawValue),formatter:vn}),value:Tt,viewProps:At.viewProps})}return new g0(At.document,{baseStep:Ym(Ht),parser:Fl,props:er.fromObject({draggingScale:_0(Ht,Tt.rawValue),formatter:vn}),value:Tt,viewProps:At.viewProps})}};class Uo{constructor(ot=0,ht=0){this.x=ot,this.y=ht}getComponents(){return[this.x,this.y]}static isObject(ot){if(Vt(ot))return!1;const ht=ot.x,Tt=ot.y;return typeof ht=="number"&&typeof Tt=="number"}static equals(ot,ht){return ot.x===ht.x&&ot.y===ht.y}toObject(){return{x:this.x,y:this.y}}}const Ip={toComponents:At=>At.getComponents(),fromComponents:At=>new Uo(...At)},op=bn("p2d");class Dp{constructor(ot,ht){this.element=ot.createElement("div"),this.element.classList.add(op()),ht.viewProps.bindClassModifiers(this.element),jt(ht.expanded,Bn(this.element,op(void 0,"expanded")));const Tt=ot.createElement("div");Tt.classList.add(op("h")),this.element.appendChild(Tt);const Ht=ot.createElement("button");Ht.classList.add(op("b")),Ht.appendChild(Xt(ot,"p2dpad")),ht.viewProps.bindDisabled(Ht),Tt.appendChild(Ht),this.buttonElement=Ht;const vn=ot.createElement("div");if(vn.classList.add(op("t")),Tt.appendChild(vn),this.textElement=vn,ht.pickerLayout==="inline"){const Rn=ot.createElement("div");Rn.classList.add(op("p")),this.element.appendChild(Rn),this.pickerElement=Rn}else this.pickerElement=null}}const Nl=bn("p2dp");class Cy{constructor(ot,ht){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=ht.invertsY,this.maxValue_=ht.maxValue,this.element=ot.createElement("div"),this.element.classList.add(Nl()),ht.layout==="popup"&&this.element.classList.add(Nl(void 0,"p"));const Tt=ot.createElement("div");Tt.classList.add(Nl("p")),ht.viewProps.bindTabIndex(Tt),this.element.appendChild(Tt),this.padElement=Tt;const Ht=ot.createElementNS(zn,"svg");Ht.classList.add(Nl("g")),this.padElement.appendChild(Ht),this.svgElem_=Ht;const vn=ot.createElementNS(zn,"line");vn.classList.add(Nl("ax")),vn.setAttributeNS(null,"x1","0"),vn.setAttributeNS(null,"y1","50%"),vn.setAttributeNS(null,"x2","100%"),vn.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(vn);const Rn=ot.createElementNS(zn,"line");Rn.classList.add(Nl("ax")),Rn.setAttributeNS(null,"x1","50%"),Rn.setAttributeNS(null,"y1","0"),Rn.setAttributeNS(null,"x2","50%"),Rn.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(Rn);const ar=ot.createElementNS(zn,"line");ar.classList.add(Nl("l")),ar.setAttributeNS(null,"x1","50%"),ar.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(ar),this.lineElem_=ar;const Er=ot.createElement("div");Er.classList.add(Nl("m")),this.padElement.appendChild(Er),this.markerElem_=Er,ht.value.emitter.on("change",this.onValueChange_),this.value=ht.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[ot,ht]=this.value.rawValue.getComponents(),Tt=this.maxValue_,Ht=to(ot,-Tt,+Tt,0,100),vn=to(ht,-Tt,+Tt,0,100),Rn=this.invertsY_?100-vn:vn;this.lineElem_.setAttributeNS(null,"x2",`${Ht}%`),this.lineElem_.setAttributeNS(null,"y2",`${Rn}%`),this.markerElem_.style.left=`${Ht}%`,this.markerElem_.style.top=`${Rn}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function y_(At,ot,ht){return[Ru(ot[0],tu(At)),Ru(ot[1],d_(At))*(ht?1:-1)]}class wm{constructor(ot,ht){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.baseSteps_=ht.baseSteps,this.maxValue_=ht.maxValue,this.invertsY_=ht.invertsY,this.view=new Cy(ot,{invertsY:this.invertsY_,layout:ht.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new iu(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(ot,ht){if(!ot.point)return;const Tt=this.maxValue_,Ht=to(ot.point.x,0,ot.bounds.width,-Tt,+Tt),vn=to(this.invertsY_?ot.bounds.height-ot.point.y:ot.point.y,0,ot.bounds.height,-Tt,+Tt);this.value.setRawValue(new Uo(Ht,vn),ht)}onPointerDown_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerMove_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!1,last:!1})}onPointerUp_(ot){this.handlePointerEvent_(ot.data,{forceEmit:!0,last:!0})}onPadKeyDown_(ot){nu(ot.key)&&ot.preventDefault();const[ht,Tt]=y_(ot,this.baseSteps_,this.invertsY_);ht===0&&Tt===0||this.value.setRawValue(new Uo(this.value.rawValue.x+ht,this.value.rawValue.y+Tt),{forceEmit:!1,last:!1})}onPadKeyUp_(ot){const[ht,Tt]=y_(ot,this.baseSteps_,this.invertsY_);ht===0&&Tt===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class w_{constructor(ot,ht){var Tt,Ht;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.foldable_=$s.create(ht.expanded),this.popC_=ht.pickerLayout==="popup"?new ss(ot,{viewProps:this.viewProps}):null;const vn=new wm(ot,{baseSteps:[ht.axes[0].baseStep,ht.axes[1].baseStep],invertsY:ht.invertsY,layout:ht.pickerLayout,maxValue:ht.maxValue,value:this.value,viewProps:this.viewProps});vn.view.allFocusableElements.forEach(Rn=>{Rn.addEventListener("blur",this.onPopupChildBlur_),Rn.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=vn,this.textC_=new C0(ot,{assembly:Ip,axes:ht.axes,parser:ht.parser,value:this.value,viewProps:this.viewProps}),this.view=new Dp(ot,{expanded:this.foldable_.value("expanded"),pickerLayout:ht.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(Tt=this.view.buttonElement)===null||Tt===void 0||Tt.addEventListener("blur",this.onPadButtonBlur_),(Ht=this.view.buttonElement)===null||Ht===void 0||Ht.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),f0({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Rn=>Rn.rawValue,backward:(Rn,ar)=>ar.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),yo(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(ot){if(!this.popC_)return;const ht=this.view.element,Tt=ot.relatedTarget;Tt&&ht.contains(Tt)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(ot){if(!this.popC_)return;const ht=this.popC_.view.element,Tt=kr(ot);Tt&&ht.contains(Tt)||Tt&&Tt===this.view.buttonElement&&!$n(ht.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(ot){this.popC_?ot.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&ot.key==="Escape"&&this.view.buttonElement.focus()}}function bA(At){return Uo.isObject(At)?new Uo(At.x,At.y):new Uo}function My(At,ot){At.writeProperty("x",ot.x),At.writeProperty("y",ot.y)}function Nv(At){if(!At)return;const ot=[];return Vt(At.step)||ot.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||ot.push(new wo({max:At.max,min:At.min})),new Ev(ot)}function Is(At,ot){const ht=At&&rp(At,wo);if(ht)return Math.max(Math.abs(ht.minValue||0),Math.abs(ht.maxValue||0));const Tt=Ym(At);return Math.max(10*Math.abs(Tt),10*Math.abs(ot))}function bo(At,ot){const ht=ot instanceof Ju?ot.components[0]:void 0,Tt=ot instanceof Ju?ot.components[1]:void 0,Ht=Is(ht,At.x),vn=Is(Tt,At.y);return Math.max(Ht,vn)}function Yl(At,ot){return{baseStep:Ym(ot),constraint:ot,textProps:er.fromObject({draggingScale:_0(ot,At),formatter:No(gy(ot,At))})}}function Pp(At){if(!("y"in At))return!1;const ot=At.y;return!!ot&&"inverted"in ot&&!!ot.inverted}const _g={id:"input-point2d",type:"input",accept:(At,ot)=>{if(!Uo.isObject(At))return null;const ht=zr,Tt=Ar(ot,{expanded:ht.optional.boolean,picker:ht.optional.custom(A1),x:ht.optional.custom(Am),y:ht.optional.object({inverted:ht.optional.boolean,max:ht.optional.number,min:ht.optional.number,step:ht.optional.number})});return Tt?{initialValue:At,params:Tt}:null},binding:{reader:At=>bA,constraint:At=>{return ot=At.params,new Ju({assembly:Ip,components:[Nv("x"in ot?ot.x:void 0),Nv("y"in ot?ot.y:void 0)]});var ot},equals:Uo.equals,writer:At=>My},controller:At=>{const ot=At.document,ht=At.value,Tt=At.constraint;if(!(Tt instanceof Ju))throw mn.shouldNeverHappen();const Ht="expanded"in At.params?At.params.expanded:void 0,vn="picker"in At.params?At.params.picker:void 0;return new w_(ot,{axes:[Yl(ht.rawValue.x,Tt.components[0]),Yl(ht.rawValue.y,Tt.components[1])],expanded:Ht!=null&&Ht,invertsY:Pp(At.params),maxValue:bo(ht.rawValue,Tt),parser:Fl,pickerLayout:vn??"popup",value:ht,viewProps:At.viewProps})}};class Xl{constructor(ot=0,ht=0,Tt=0){this.x=ot,this.y=ht,this.z=Tt}getComponents(){return[this.x,this.y,this.z]}static isObject(ot){if(Vt(ot))return!1;const ht=ot.x,Tt=ot.y,Ht=ot.z;return typeof ht=="number"&&typeof Tt=="number"&&typeof Ht=="number"}static equals(ot,ht){return ot.x===ht.x&&ot.y===ht.y&&ot.z===ht.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const x_={toComponents:At=>At.getComponents(),fromComponents:At=>new Xl(...At)};function Zu(At){return Xl.isObject(At)?new Xl(At.x,At.y,At.z):new Xl}function kw(At,ot){At.writeProperty("x",ot.x),At.writeProperty("y",ot.y),At.writeProperty("z",ot.z)}function EA(At){if(!At)return;const ot=[];return Vt(At.step)||ot.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||ot.push(new wo({max:At.max,min:At.min})),new Ev(ot)}function em(At,ot){return{baseStep:Ym(ot),constraint:ot,textProps:er.fromObject({draggingScale:_0(ot,At),formatter:No(gy(ot,At))})}}const ku={id:"input-point3d",type:"input",accept:(At,ot)=>{if(!Xl.isObject(At))return null;const ht=zr,Tt=Ar(ot,{x:ht.optional.custom(Am),y:ht.optional.custom(Am),z:ht.optional.custom(Am)});return Tt?{initialValue:At,params:Tt}:null},binding:{reader:At=>Zu,constraint:At=>{return ot=At.params,new Ju({assembly:x_,components:[EA("x"in ot?ot.x:void 0),EA("y"in ot?ot.y:void 0),EA("z"in ot?ot.z:void 0)]});var ot},equals:Xl.equals,writer:At=>kw},controller:At=>{const ot=At.value,ht=At.constraint;if(!(ht instanceof Ju))throw mn.shouldNeverHappen();return new C0(At.document,{assembly:x_,axes:[em(ot.rawValue.x,ht.components[0]),em(ot.rawValue.y,ht.components[1]),em(ot.rawValue.z,ht.components[2])],parser:Fl,value:ot,viewProps:At.viewProps})}};class ev{constructor(ot=0,ht=0,Tt=0,Ht=0){this.x=ot,this.y=ht,this.z=Tt,this.w=Ht}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(ot){if(Vt(ot))return!1;const ht=ot.x,Tt=ot.y,Ht=ot.z,vn=ot.w;return typeof ht=="number"&&typeof Tt=="number"&&typeof Ht=="number"&&typeof vn=="number"}static equals(ot,ht){return ot.x===ht.x&&ot.y===ht.y&&ot.z===ht.z&&ot.w===ht.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const M0={toComponents:At=>At.getComponents(),fromComponents:At=>new ev(...At)};function ou(At){return ev.isObject(At)?new ev(At.x,At.y,At.z,At.w):new ev}function ap(At,ot){At.writeProperty("x",ot.x),At.writeProperty("y",ot.y),At.writeProperty("z",ot.z),At.writeProperty("w",ot.w)}function bu(At){if(!At)return;const ot=[];return Vt(At.step)||ot.push(new wp(At.step)),Vt(At.max)&&Vt(At.min)||ot.push(new wo({max:At.max,min:At.min})),new Ev(ot)}const xm={id:"input-point4d",type:"input",accept:(At,ot)=>{if(!ev.isObject(At))return null;const ht=zr,Tt=Ar(ot,{x:ht.optional.custom(Am),y:ht.optional.custom(Am),z:ht.optional.custom(Am),w:ht.optional.custom(Am)});return Tt?{initialValue:At,params:Tt}:null},binding:{reader:At=>ou,constraint:At=>{return ot=At.params,new Ju({assembly:M0,components:[bu("x"in ot?ot.x:void 0),bu("y"in ot?ot.y:void 0),bu("z"in ot?ot.z:void 0),bu("w"in ot?ot.w:void 0)]});var ot},equals:ev.equals,writer:At=>ap},controller:At=>{const ot=At.value,ht=At.constraint;if(!(ht instanceof Ju))throw mn.shouldNeverHappen();return new C0(At.document,{assembly:M0,axes:ot.rawValue.getComponents().map((Tt,Ht)=>{return vn=Tt,{baseStep:Ym(Rn=ht.components[Ht]),constraint:Rn,textProps:er.fromObject({draggingScale:_0(Rn,vn),formatter:No(gy(Rn,vn))})};var vn,Rn}),parser:Fl,value:ot,viewProps:At.viewProps})}},Ty={id:"input-string",type:"input",accept:(At,ot)=>{if(typeof At!="string")return null;const ht=Ar(ot,{options:zr.optional.custom(p_)});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>_1,constraint:At=>function(ot){const ht=[],Tt=Zo(ot.options);return Tt&&ht.push(Tt),new Ev(ht)}(At.params),writer:At=>Rv},controller:At=>{var ot;const ht=At.document,Tt=At.value,Ht=At.constraint;return Ht&&rp(Ht,Sv)?new _c(ht,{props:er.fromObject({options:(ot=my(Ht))!==null&&ot!==void 0?ot:[]}),value:Tt,viewProps:At.viewProps}):new ho(ht,{parser:vn=>vn,props:er.fromObject({formatter:p0}),value:Tt,viewProps:At.viewProps})}},Uv={defaultInterval:200,defaultLineCount:3},SA=bn("mll");class T0{constructor(ot,ht){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ht.formatter,this.element=ot.createElement("div"),this.element.classList.add(SA()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("textarea");Tt.classList.add(SA("i")),Tt.style.height=`calc(var(--bld-us) * ${ht.lineCount})`,Tt.readOnly=!0,ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.textareaElem_=Tt,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}update_(){const ot=this.textareaElem_,ht=ot.scrollTop===ot.scrollHeight-ot.clientHeight,Tt=[];this.value.rawValue.forEach(Ht=>{Ht!==void 0&&Tt.push(this.formatter_(Ht))}),ot.textContent=Tt.join(`
`),ht&&(ot.scrollTop=ot.scrollHeight)}onValueUpdate_(){this.update_()}}class Fv{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new T0(ot,{formatter:ht.formatter,lineCount:ht.lineCount,value:this.value,viewProps:this.viewProps})}}const Iy=bn("sgl");class Lw{constructor(ot,ht){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=ht.formatter,this.element=ot.createElement("div"),this.element.classList.add(Iy()),ht.viewProps.bindClassModifiers(this.element);const Tt=ot.createElement("input");Tt.classList.add(Iy("i")),Tt.readOnly=!0,Tt.type="text",ht.viewProps.bindDisabled(Tt),this.element.appendChild(Tt),this.inputElement=Tt,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}update_(){const ot=this.value.rawValue,ht=ot[ot.length-1];this.inputElement.value=ht!==void 0?this.formatter_(ht):""}onValueUpdate_(){this.update_()}}class Fs{constructor(ot,ht){this.value=ht.value,this.viewProps=ht.viewProps,this.view=new Lw(ot,{formatter:ht.formatter,value:this.value,viewProps:this.viewProps})}}const Rp={id:"monitor-bool",type:"monitor",accept:(At,ot)=>{if(typeof At!="boolean")return null;const ht=Ar(ot,{lineCount:zr.optional.number});return ht?{initialValue:At,params:ht}:null},binding:{reader:At=>qs},controller:At=>{var ot;return At.value.rawValue.length===1?new Fs(At.document,{formatter:Wm,value:At.value,viewProps:At.viewProps}):new Fv(At.document,{formatter:Wm,lineCount:(ot=At.params.lineCount)!==null&&ot!==void 0?ot:Uv.defaultLineCount,value:At.value,viewProps:At.viewProps})}};class bm{constructor(){this.emitter=new _n,this.index_=-1}get index(){return this.index_}set index(ot){this.index_!==ot&&(this.index_=ot,this.emitter.emit("change",{index:ot,sender:this}))}}const Lu=bn("grl");class tm{constructor(ot,ht){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=ot.createElement("div"),this.element.classList.add(Lu()),ht.viewProps.bindClassModifiers(this.element),this.formatter_=ht.formatter,this.minValue_=ht.minValue,this.maxValue_=ht.maxValue,this.cursor_=ht.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const Tt=ot.createElementNS(zn,"svg");Tt.classList.add(Lu("g")),Tt.style.height=`calc(var(--bld-us) * ${ht.lineCount})`,this.element.appendChild(Tt),this.svgElem_=Tt;const Ht=ot.createElementNS(zn,"polyline");this.svgElem_.appendChild(Ht),this.lineElem_=Ht;const vn=ot.createElement("div");vn.classList.add(Lu("t"),bn("tt")()),this.element.appendChild(vn),this.tooltipElem_=vn,ht.value.emitter.on("change",this.onValueUpdate_),this.value=ht.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const ot=this.svgElem_.getBoundingClientRect(),ht=this.value.rawValue.length-1,Tt=this.minValue_,Ht=this.maxValue_,vn=[];this.value.rawValue.forEach((ws,ls)=>{if(ws===void 0)return;const Fo=to(ls,0,ht,0,ot.width),Ml=to(ws,Tt,Ht,ot.height,0);vn.push([Fo,Ml].join(","))}),this.lineElem_.setAttributeNS(null,"points",vn.join(" "));const Rn=this.tooltipElem_,ar=this.value.rawValue[this.cursor_.index];if(ar===void 0)return void Rn.classList.remove(Lu("t","a"));const Er=to(this.cursor_.index,0,ht,0,ot.width),ps=to(ar,Tt,Ht,ot.height,0);Rn.style.left=`${Er}px`,Rn.style.top=`${ps}px`,Rn.textContent=`${this.formatter_(ar)}`,Rn.classList.contains(Lu("t","a"))||(Rn.classList.add(Lu("t","a"),Lu("t","in")),nr(Rn),Rn.classList.remove(Lu("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Bp{constructor(ot,ht){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=ht.value,this.viewProps=ht.viewProps,this.cursor_=new bm,this.view=new tm(ot,{cursor:this.cursor_,formatter:ht.formatter,lineCount:ht.lineCount,maxValue:ht.maxValue,minValue:ht.minValue,value:this.value,viewProps:this.viewProps}),$n(ot)){const Tt=new iu(this.view.element);Tt.emitter.on("down",this.onGraphPointerDown_),Tt.emitter.on("move",this.onGraphPointerMove_),Tt.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(ot){const ht=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(to(ot.offsetX,0,ht.width,0,this.value.rawValue.length))}onGraphPointerDown_(ot){this.onGraphPointerMove_(ot)}onGraphPointerMove_(ot){ot.data.point?this.cursor_.index=Math.floor(to(ot.data.point.x,0,ot.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function kp(At){return"format"in At&&!Vt(At.format)?At.format:No(2)}function Dy(At){return"view"in At&&At.view==="graph"}const b_={id:"monitor-number",type:"monitor",accept:(At,ot)=>{if(typeof At!="number")return null;const ht=zr,Tt=Ar(ot,{format:ht.optional.function,lineCount:ht.optional.number,max:ht.optional.number,min:ht.optional.number,view:ht.optional.string});return Tt?{initialValue:At,params:Tt}:null},binding:{defaultBufferSize:At=>Dy(At)?64:1,reader:At=>xp},controller:At=>Dy(At.params)?function(ot){var ht,Tt,Ht;return new Bp(ot.document,{formatter:kp(ot.params),lineCount:(ht=ot.params.lineCount)!==null&&ht!==void 0?ht:Uv.defaultLineCount,maxValue:(Tt="max"in ot.params?ot.params.max:null)!==null&&Tt!==void 0?Tt:100,minValue:(Ht="min"in ot.params?ot.params.min:null)!==null&&Ht!==void 0?Ht:0,value:ot.value,viewProps:ot.viewProps})}(At):function(ot){var ht;return ot.value.rawValue.length===1?new Fs(ot.document,{formatter:kp(ot.params),value:ot.value,viewProps:ot.viewProps}):new Fv(ot.document,{formatter:kp(ot.params),lineCount:(ht=ot.params.lineCount)!==null&&ht!==void 0?ht:Uv.defaultLineCount,value:ot.value,viewProps:ot.viewProps})}(At)},Py={id:"monitor-string",type:"monitor",accept:(At,ot)=>{if(typeof At!="string")return null;const ht=zr,Tt=Ar(ot,{lineCount:ht.optional.number,multiline:ht.optional.boolean});return Tt?{initialValue:At,params:Tt}:null},binding:{reader:At=>_1},controller:At=>{var ot;const ht=At.value;return ht.rawValue.length>1||"multiline"in At.params&&At.params.multiline?new Fv(At.document,{formatter:p0,lineCount:(ot=At.params.lineCount)!==null&&ot!==void 0?ot:Uv.defaultLineCount,value:ht,viewProps:At.viewProps}):new Fs(At.document,{formatter:p0,value:ht,viewProps:At.viewProps})}};class jv{constructor(ot){this.onValueChange_=this.onValueChange_.bind(this),this.reader=ot.reader,this.writer=ot.writer,this.emitter=new _n,this.value=ot.value,this.value.emitter.on("change",this.onValueChange_),this.target=ot.target,this.read()}read(){const ot=this.target.read();ot!==void 0&&(this.value.rawValue=this.reader(ot))}write_(ot){this.writer(this.target,ot)}onValueChange_(ot){this.write_(ot.rawValue),this.emitter.emit("change",{options:ot.options,rawValue:ot.rawValue,sender:this})}}class au{constructor(ot){this.onTick_=this.onTick_.bind(this),this.reader_=ot.reader,this.target=ot.target,this.emitter=new _n,this.value=ot.value,this.ticker=ot.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const ot=this.target.read();if(ot===void 0)return;const ht=this.value.rawValue,Tt=this.reader_(ot);this.value.rawValue=function(Ht,vn){const Rn=[...Mw(Ht),vn];return Rn.length>Ht.length?Rn.splice(0,Rn.length-Ht.length):Jp(Rn,Ht.length),Rn}(ht,Tt),this.emitter.emit("update",{rawValue:Tt,sender:this})}onTick_(ot){this.read()}}function b1(At,ot){return ot===0?new uy:new v1(At,ot??Uv.defaultInterval)}class lu{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(ot){ot.type==="blade"?this.pluginsMap_.blades.unshift(ot):ot.type==="input"?this.pluginsMap_.inputs.unshift(ot):ot.type==="monitor"&&this.pluginsMap_.monitors.unshift(ot)}createInput(ot,ht,Tt){if(Vt(ht.read()))throw new mn({context:{key:ht.key},type:"nomatchingcontroller"});const Ht=this.pluginsMap_.inputs.reduce((vn,Rn)=>vn||function(ar,Er){const ps=ar.accept(Er.target.read(),Er.params);if(Vt(ps))return null;const ws=zr,ls={target:Er.target,initialValue:ps.initialValue,params:ps.params},Fo=ar.binding.reader(ls),Ml=ar.binding.constraint?ar.binding.constraint(ls):void 0,Np=pn(Fo(ps.initialValue),{constraint:Ml,equals:ar.binding.equals}),Eu=new jv({reader:Fo,target:Er.target,value:Np,writer:ar.binding.writer(ls)}),lp=ws.optional.boolean(Er.params.disabled).value,nm=ws.optional.boolean(Er.params.hidden).value,I0=ar.controller({constraint:Ml,document:Er.document,initialValue:ps.initialValue,params:ps.params,value:Eu.value,viewProps:so.create({disabled:lp,hidden:nm})}),zv=ws.optional.string(Er.params.label).value;return new Ro(Er.document,{binding:Eu,blade:Lo(),props:er.fromObject({label:zv||Er.target.key}),valueController:I0})}(Rn,{document:ot,target:ht,params:Tt}),null);if(Ht)return Ht;throw new mn({context:{key:ht.key},type:"nomatchingcontroller"})}createMonitor(ot,ht,Tt){const Ht=this.pluginsMap_.monitors.reduce((vn,Rn)=>vn||function(ar,Er){var ps,ws,ls;const Fo=zr,Ml=ar.accept(Er.target.read(),Er.params);if(Vt(Ml))return null;const Np={target:Er.target,initialValue:Ml.initialValue,params:Ml.params},Eu=ar.binding.reader(Np),lp=(ws=(ps=Fo.optional.number(Er.params.bufferSize).value)!==null&&ps!==void 0?ps:ar.binding.defaultBufferSize&&ar.binding.defaultBufferSize(Ml.params))!==null&&ws!==void 0?ws:1,nm=Fo.optional.number(Er.params.interval).value,I0=new au({reader:Eu,target:Er.target,ticker:b1(Er.document,nm),value:Xs(lp)}),zv=Fo.optional.boolean(Er.params.disabled).value,C_=Fo.optional.boolean(Er.params.hidden).value,CA=ar.controller({document:Er.document,params:Ml.params,value:I0.value,viewProps:so.create({disabled:zv,hidden:C_})}),MA=(ls=Fo.optional.string(Er.params.label).value)!==null&&ls!==void 0?ls:Er.target.key;return new To(Er.document,{binding:I0,blade:Lo(),props:er.fromObject({label:MA}),valueController:CA})}(Rn,{document:ot,params:Tt,target:ht}),null);if(Ht)return Ht;throw new mn({context:{key:ht.key},type:"nomatchingcontroller"})}createBlade(ot,ht){const Tt=this.pluginsMap_.blades.reduce((Ht,vn)=>Ht||function(Rn,ar){const Er=Rn.accept(ar.params);if(!Er)return null;const ps=zr.optional.boolean(ar.params.disabled).value,ws=zr.optional.boolean(ar.params.hidden).value;return Rn.controller({blade:Lo(),document:ar.document,params:Object.assign(Object.assign({},Er.params),{disabled:ps,hidden:ws}),viewProps:so.create({disabled:ps,hidden:ws})})}(vn,{document:ot,params:ht}),null);if(!Tt)throw new mn({type:"nomatchingview",context:{params:ht}});return Tt}createBladeApi(ot){if(ot instanceof Ro)return new ba(ot);if(ot instanceof To)return new Gl(ot);if(ot instanceof Gm)return new Yp(ot,this);const ht=this.pluginsMap_.blades.reduce((Tt,Ht)=>Tt||Ht.api({controller:ot,pool:this}),null);if(!ht)throw mn.shouldNeverHappen();return ht}}class Em extends b{constructor(ot){super(ot),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}get options(){return this.controller_.valueController.props.get("options")}set options(ot){this.controller_.valueController.props.set("options",ot)}get value(){return this.controller_.valueController.value.rawValue}set value(ot){this.controller_.valueController.value.rawValue=ot}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}}class yl extends b{constructor(ot){super(ot),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(ot){this.controller_.valueController.sliderController.props.set("maxValue",ot)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(ot){this.controller_.valueController.sliderController.props.set("minValue",ot)}get value(){return this.controller_.valueController.value.rawValue}set value(ot){this.controller_.valueController.value.rawValue=ot}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}}class Lp extends b{constructor(ot){super(ot),this.emitter_=new _n,this.controller_.valueController.value.emitter.on("change",ht=>{this.emitter_.emit("change",{event:new Et(this,ht.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(ot){this.controller_.props.set("label",ot)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(ot){this.controller_.valueController.props.set("formatter",ot)}get value(){return this.controller_.valueController.value.rawValue}set value(ot){this.controller_.valueController.value.rawValue=ot}on(ot,ht){const Tt=ht.bind(this);return this.emitter_.on(ot,Ht=>{Tt(Ht.event)}),this}}const Co={id:"list",type:"blade",accept(At){const ot=zr,ht=Ar(At,{options:ot.required.custom(p_),value:ot.required.raw,view:ot.required.constant("list"),label:ot.optional.string});return ht?{params:ht}:null},controller(At){const ot=new _c(At.document,{props:er.fromObject({options:v0(At.params.options)}),value:pn(At.params.value),viewProps:At.viewProps});return new qu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:ot})},api:At=>At.controller instanceof qu&&At.controller.valueController instanceof _c?new Em(At.controller):null};class E_ extends Yo{constructor(ot,ht){super(ot,ht)}get element(){return this.controller_.view.element}importPreset(ot){(function(ht,Tt){ht.forEach(Ht=>{const vn=Tt[Ht.presetKey];vn!==void 0&&Ht.write(vn)})})(this.controller_.rackController.rack.find(Ro).map(ht=>ht.binding.target),ot),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(Ro).map(ot=>ot.binding.target).reduce((ot,ht)=>Object.assign(ot,{[ht.presetKey]:ht.read()}),{})}refresh(){this.controller_.rackController.rack.find(Ro).forEach(ot=>{ot.binding.read()}),this.controller_.rackController.rack.find(To).forEach(ot=>{ot.binding.read()})}}class Op extends Qo{constructor(ot,ht){super(ot,{expanded:ht.expanded,blade:ht.blade,props:ht.props,root:!0,viewProps:ht.viewProps})}}const S_={id:"slider",type:"blade",accept(At){const ot=zr,ht=Ar(At,{max:ot.required.number,min:ot.required.number,view:ot.required.constant("slider"),format:ot.optional.function,label:ot.optional.string,value:ot.optional.number});return ht?{params:ht}:null},controller(At){var ot,ht;const Tt=(ot=At.params.value)!==null&&ot!==void 0?ot:0,Ht=new Ep(At.document,{baseStep:1,parser:Fl,sliderProps:er.fromObject({maxValue:At.params.max,minValue:At.params.min}),textProps:er.fromObject({draggingScale:_0(void 0,Tt),formatter:(ht=At.params.format)!==null&&ht!==void 0?ht:d0}),value:pn(Tt),viewProps:At.viewProps});return new qu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:Ht})},api:At=>At.controller instanceof qu&&At.controller.valueController instanceof Ep?new yl(At.controller):null},Ou={id:"text",type:"blade",accept(At){const ot=zr,ht=Ar(At,{parse:ot.required.function,value:ot.required.raw,view:ot.required.constant("text"),format:ot.optional.function,label:ot.optional.string});return ht?{params:ht}:null},controller(At){var ot;const ht=new ho(At.document,{parser:At.params.parse,props:er.fromObject({formatter:(ot=At.params.format)!==null&&ot!==void 0?ot:Tt=>String(Tt)}),value:pn(At.params.value),viewProps:At.viewProps});return new qu(At.document,{blade:At.blade,props:er.fromObject({label:At.params.label}),valueController:ht})},api:At=>At.controller instanceof qu&&At.controller.valueController instanceof ho?new Lp(At.controller):null};function na(At,ot,ht){if(At.querySelector(`style[data-tp-style=${ot}]`))return;const Tt=At.createElement("style");Tt.dataset.tpStyle=ot,Tt.textContent=ht,At.head.appendChild(Tt)}const Ow=new class{constructor(At){const[ot,ht]=At.split("-"),Tt=ot.split(".");this.major=parseInt(Tt[0],10),this.minor=parseInt(Tt[1],10),this.patch=parseInt(Tt[2],10),this.prerelease=ht??null}toString(){const At=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[At,this.prerelease].join("-"):At}}("3.0.8");st.BladeApi=b,st.ButtonApi=wn,st.FolderApi=Yo,st.InputBindingApi=ba,st.ListApi=Em,st.MonitorBindingApi=Gl,st.Pane=class extends E_{constructor(At){var ot;const ht=At||{},Tt=(ot=ht.document)!==null&&ot!==void 0?ot:Sr(),Ht=function(){const vn=new lu;return[_g,ku,xm,Ty,no,Lv,_f,$m,y1,Rp,Py,b_,Ao,vm,Hl,ip].forEach(Rn=>{vn.register(Rn)}),vn}();super(new Op(Tt,{expanded:ht.expanded,blade:Lo(),props:er.fromObject({title:ht.title}),viewProps:so.create()}),Ht),this.pool_=Ht,this.containerElem_=ht.container||function(vn){const Rn=vn.createElement("div");return Rn.classList.add(bn("dfw")()),vn.body&&vn.body.appendChild(Rn),Rn}(Tt),this.containerElem_.appendChild(this.element),this.doc_=Tt,this.usesDefaultWrapper_=!ht.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw mn.alreadyDisposed();return this.doc_}dispose(){const At=this.containerElem_;if(!At)throw mn.alreadyDisposed();if(this.usesDefaultWrapper_){const ot=At.parentElement;ot&&ot.removeChild(At)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(At){("plugin"in At?[At.plugin]:"plugins"in At?At.plugins:[]).forEach(ot=>{this.pool_.register(ot),this.embedPluginStyle_(ot)})}embedPluginStyle_(At){At.css&&na(this.document,`plugin-${At.id}`,At.css)}setUpDefaultPlugins_(){na(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(At=>{this.embedPluginStyle_(At)}),this.registerPlugin({plugins:[S_,Co,ip,Ou]})}},st.SeparatorApi=ly,st.SliderApi=yl,st.TabApi=cy,st.TabPageApi=Ap,st.TextApi=Lp,st.TpChangeEvent=Et,st.VERSION=Ow,Object.defineProperty(st,"__esModule",{value:!0})})(tt)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(j){super(j),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(j,tt){const st=await super.loadAsync(j,tt);return st?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(st,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(j=!0,tt=!1){return j&&super.preload(),tt&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async j=>j.text()).then(j=>{const tt=j.indexOf("/* worker */");if(tt<1)throw new Error("unable to load decoder module");return j.substring(0,tt-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(j,tt,st){st.d(tt,{$TI:function(){return BE},$V:function(){return yD},$Vf:function(){return sI},$YQ:function(){return nC},A5E:function(){return aw},AHu:function(){return Fx},AXT:function(){return ox},Aip:function(){return uI},B02:function(){return an},BFQ:function(){return Sv},BG$:function(){return Mv},BKK:function(){return uw},BVF:function(){return Sr},BVQ:function(){return lx},BbS:function(){return X0},Bf4:function(){return To},BtG:function(){return ky},CJI:function(){return au},CN8:function(){return nI},CP7:function(){return Il},CaW:function(){return ns},CdI:function(){return $s},Cne:function(){return HC},CtA:function(){return v1},CtF:function(){return V0},D1R:function(){return vo},D9w:function(){return ip},DT1:function(){return jx},Djp:function(){return vA},DqL:function(){return hp},DvJ:function(){return Sm},E2K:function(){return Ev},EB7:function(){return sx},EJi:function(){return bC},EoG:function(){return Lo},F5T:function(){return lu},FDw:function(){return Qo},FE5:function(){return Mu},FIo:function(){return NT},FM8:function(){return Cr},FT0:function(){return SC},FUD:function(){return Iv},FvO:function(){return Tu},GG6:function(){return c0},GQ:function(){return Pm},GUF:function(){return to},GVz:function(){return x1},GZb:function(){return oI},Gih:function(){return Tv},Gql:function(){return BC},H$k:function(){return zA},HTd:function(){return g1},HW6:function(){return cI},HgB:function(){return f_},HkE:function(){return tC},Hmr:function(){return Ix},Hw6:function(){return x0},Hy8:function(){return ir},Hyl:function(){return lv},IEO:function(){return Qy},IFH:function(){return No},IKL:function(){return UT},ILR:function(){return wp},IOt:function(){return tu},Ilk:function(){return ts},Inb:function(){return f0},Ir4:function(){return _0},JOQ:function(){return D0},JQ4:function(){return jn},JUT:function(){return b0},JWc:function(){return gy},KI_:function(){return iu},Kgo:function(){return cx},KhW:function(){return Dr},Kj0:function(){return cu},Kz5:function(){return c_},L5g:function(){return q_},L5s:function(){return Wp},LBq:function(){return KT},LSk:function(){return Xm},LY2:function(){return yo},L_r:function(){return _y},Lcc:function(){return Bm},LgE:function(){return Mw},LgZ:function(){return Hr},LsT:function(){return mA},Ltg:function(){return fo},Lun:function(){return Fy},M5h:function(){return un},M6v:function(){return jr},M8C:function(){return Ay},Mig:function(){return QT},MyG:function(){return Iw},N$j:function(){return sC},N4l:function(){return Bn},NDo:function(){return Ao},NMF:function(){return h_},NYV:function(){return l0},Ns1:function(){return Ss},NwF:function(){return Dm},Ny0:function(){return oE},O7d:function(){return mx},OAl:function(){return Rv},OM3:function(){return Tt},OTo:function(){return Sw},OdW:function(){return $w},OoA:function(){return Yp},Ox3:function(){return VT},PA7:function(){return nu},PMe:function(){return PC},Pa4:function(){return dn},PeU:function(){return kt},Pnf:function(){return Fl},PpQ:function(){return xA},QM0:function(){return Ym},QRU:function(){return kC},QZ1:function(){return my},QmN:function(){return Et},Qpg:function(){return eI},R2R:function(){return j0},REq:function(){return cw},RNb:function(){return E_},ROQ:function(){return pC},RSm:function(){return Ax},Rki:function(){return tI},RlZ:function(){return $n},RsA:function(){return yt},RvT:function(){return p_},S2y:function(){return Vt},S3k:function(){return $y},S9g:function(){return ku},SJI:function(){return YT},SPe:function(){return $1},SUY:function(){return ME},Se2:function(){return Yn},Sm8:function(){return pn},So8:function(){return LC},SvJ:function(){return po},Syv:function(){return h0},T95:function(){return qu},TOt:function(){return dE},TUj:function(){return wD},TUv:function(){return rC},T_1:function(){return FE},T_J:function(){return Jo},T__:function(){return DT},T_f:function(){return GT},TlE:function(){return Co},Tme:function(){return Fs},Tn7:function(){return gE},TyD:function(){return Yo},U7:function(){return gC},UCm:function(){return Cw},USm:function(){return em},UY4:function(){return nE},UZH:function(){return b},Uk6:function(){return OT},UlW:function(){return _1},Uol:function(){return U0},V1s:function(){return By},V4E:function(){return lI},VLJ:function(){return zC},VYz:function(){return XT},Vdb:function(){return zn},Vj0:function(){return Up},Vkp:function(){return ru},VzW:function(){return Hl},W2J:function(){return v0},WMw:function(){return Yt},WTc:function(){return Op},WXh:function(){return vx},Wbm:function(){return Wt},WdD:function(){return Vs},Wid:function(){return xC},Wjw:function(){return jE},Wl3:function(){return _n},Wpd:function(){return nr},Wqd:function(){return _C},WwZ:function(){return Dv},Wzm:function(){return rx},XZw:function(){return hw},Xaj:function(){return Cn},Xcj:function(){return OC},XvJ:function(){return j_},Y8D:function(){return Ap},YBo:function(){return EC},YGz:function(){return qo},YKA:function(){return dy},YLQ:function(){return _u},YN5:function(){return rI},YT8:function(){return PT},Ywn:function(){return xy},Z6B:function(){return DS},ZAu:function(){return B0},ZQ6:function(){return N0},ZRs:function(){return bp},ZZA:function(){return wx},Zp0:function(){return Xv},Zr5:function(){return Xt},ZzF:function(){return E0},Zzh:function(){return ZT},_12:function(){return D_},_3:function(){return GC},_AM:function(){return Au},_C8:function(){return VA},_Li:function(){return $t},_MY:function(){return Pn},_YM:function(){return F0},_YX:function(){return Lx},_am:function(){return PS},_fP:function(){return su},_iA:function(){return mn},_kC:function(){return qv},_lf:function(){return xp},_sL:function(){return d0},a$l:function(){return ht},aCh:function(){return m0},aH4:function(){return Xo},aLr:function(){return Dp},aNw:function(){return hu},aVm:function(){return Ou},ad5:function(){return Wl},anP:function(){return D1},aq0:function(){return Nx},av9:function(){return uy},b5g:function(){return iC},bGH:function(){return Qt},b_z:function(){return Go},bdR:function(){return jt},blk:function(){return Gy},bnF:function(){return UA},brP:function(){return bv},bsb:function(){return qm},c8b:function(){return er},cBI:function(){return J0},cBK:function(){return TC},cJO:function(){return Ky},cLu:function(){return _m},cPb:function(){return Su},cRx:function(){return cy},cU9:function(){return MC},ce8:function(){return fy},cek:function(){return zT},cum:function(){return Am},dSO:function(){return Gl},dUE:function(){return z0},dYG:function(){return vE},dZ3:function(){return Hu},dd2:function(){return Ku},dj0:function(){return Zo},dpR:function(){return IC},dwk:function(){return wn},e62:function(){return ot},eD:function(){return Fn},eMJ:function(){return Tw},eaV:function(){return _c},ehD:function(){return bn},ejS:function(){return Wv},ekQ:function(){return Kp},epp:function(){return xu},fHI:function(){return uu},fO1:function(){return dC},fQA:function(){return NE},fQK:function(){return H1},fSK:function(){return Xn},fY$:function(){return ba},fto:function(){return a0},g8_:function(){return Wu},gH0:function(){return kx},gSk:function(){return py},g_z:function(){return ax},ghN:function(){return Ir},gi4:function(){return Wm},gti:function(){return vC},hEm:function(){return gA},hH6:function(){return G0},iAb:function(){return ly},iDF:function(){return hv},iKG:function(){return C1},iLg:function(){return Hp},iMs:function(){return kE},iUV:function(){return ao},iWC:function(){return zr},iWj:function(){return jw},i_9:function(){return SE},iiP:function(){return xo},irR:function(){return so},j4z:function(){return A1},j87:function(){return Ow},jAl:function(){return Xu},jFi:function(){return Nt},jZA:function(){return ho},jfJ:function(){return Pv},jwo:function(){return Dw},jyi:function(){return J1},jyz:function(){return tv},k0A:function(){return Hm},k74:function(){return Ar},kB5:function(){return Qv},kFz:function(){return Mp},kaV:function(){return yx},knz:function(){return Xs},kqm:function(){return G_},ksN:function(){return Nr},l0P:function(){return ss},l8J:function(){return vy},lCJ:function(){return At},lDi:function(){return Tx},lLk:function(){return Q0},lRF:function(){return Kw},lRj:function(){return fA},lb7:function(){return OA},lfu:function(){return CC},lk7:function(){return xE},m7l:function(){return bx},mSO:function(){return d_},mTL:function(){return _D},mXe:function(){return hE},m_w:function(){return qA},mzJ:function(){return HA},nls:function(){return cp},ntZ:function(){return hn},nvb:function(){return iI},o8S:function(){return jA},oAp:function(){return LM},oa8:function(){return gx},oqc:function(){return g0},p3g:function(){return __},p7A:function(){return QC},p7y:function(){return $a},pBf:function(){return Ts},pIN:function(){return eu},pKu:function(){return hy},pQR:function(){return Uu},ptH:function(){return Cv},qhX:function(){return zs},qkB:function(){return yp},qlB:function(){return na},qyh:function(){return Gm},rAo:function(){return S_},rBU:function(){return Kr},rDY:function(){return kM},rOj:function(){return Zt},r_:function(){return En},rnI:function(){return Jp},rpg:function(){return Pu},s4_:function(){return HT},sYA:function(){return Ex},tEQ:function(){return QA},tGC:function(){return Jv},tJx:function(){return UE},tUh:function(){return dv},tf:function(){return Px},tm_:function(){return Gt},trn:function(){return lw},u37:function(){return GA},u7G:function(){return W0},u9r:function(){return ls},uEv:function(){return u0},uL9:function(){return Zs},uWy:function(){return Oo},uXU:function(){return yu},ujx:function(){return aI},v3W:function(){return wo},v9Y:function(){return y1},vBJ:function(){return Em},vCF:function(){return rn},vCx:function(){return u_},vZf:function(){return Xp},vmT:function(){return jT},vpT:function(){return q1},vxC:function(){return Ro},w$m:function(){return kr},wJv:function(){return eo},wem:function(){return Ko},wk1:function(){return Yu},woe:function(){return sE},wuA:function(){return rp},x12:function(){return Hv},x5V:function(){return _o},xEZ:function(){return zl},xG9:function(){return $T},xJs:function(){return Ys},xWb:function(){return H_},xeV:function(){return Y1},xfE:function(){return vu},xo$:function(){return Jy},xoR:function(){return _x},xsS:function(){return yT},y$t:function(){return qy},y2t:function(){return qs},y8_:function(){return ow},yC1:function(){return Zy},yGw:function(){return Is},ybr:function(){return jy},yj7:function(){return mC},ylh:function(){return iw},yo9:function(){return B_},yt0:function(){return Ep},ywz:function(){return vm},yxD:function(){return H0},z$h:function(){return p0},z81:function(){return Ru},z8B:function(){return Vy},zHn:function(){return Nv},zbs:function(){return xx},zf8:function(){return rm},zob:function(){return $0}});const b="144dev",yt={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Et={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},kt=0,Gt=1,Vt=2,an=3,Pn=0,mn=1,hn=2,wn=3,_n=0,$t=1,bn=2,Nt=0,jt=1,Yt=2,Bn=3,un=4,Cn=5,Qt=100,Wt=101,Zt=102,En=103,pn=104,er=200,Ir=201,Dr=202,zr=203,Ar=204,Hr=205,Xn=206,ir=207,zn=208,nr=209,$n=210,Sr=0,Yn=1,Xt=2,rn=3,Fn=4,Nr=5,kr=6,jr=7,Ss=0,zs=1,Ao=2,Zs=0,Lo=1,$s=2,qo=3,yo=4,Hu=5,vu=300,ba=301,Ro=302,Gl=303,To=304,Wu=306,Pu=1e3,Oo=1001,Yp=1002,Yo=1003,_u=1004,g1=1004,Xo=1005,Xp=1005,Ko=1006,Gm=1007,fA=1007,vo=1008,Qo=1008,vm=1009,qu=1010,ly=1011,mA=1012,c_=1013,jn=1014,Hl=1015,_m=1016,Hm=1017,so=1018,eo=1020,Sw=1021,Cw=1022,Yu=1023,Ap=1024,cy=1025,yp=1026,bv=1027,gA=1028,ip=1029,uy=1030,v1=1031,Ev=1033,rp=33776,Sv=33777,wo=33778,wp=33779,Au=35840,u_=35841,_c=35842,ns=35843,a0=36196,ss=37492,Kp=37496,Cv=37808,ho=37809,qs=37810,Wm=37811,vA=37812,Mv=37813,l0=37814,Ys=37815,hy=37816,c0=37817,Tv=37818,Iv=37819,xo=37820,po=37821,qm=36492,Xu=2200,dy=2201,u0=2202,h0=2300,h_=2301,eu=2302,Fl=2400,xp=2401,d0=2402,No=2500,py=2501,Dv=0,_1=1,p0=2,Jp=3e3,Xs=3001,Mw=3004,f0=3005,Ru=3200,d_=3201,tu=0,nu=1,m0="",iu="srgb",to="srgb-linear",Wl=0,_o=7680,fy=7681,bp=7682,Pv=7683,g0=34055,Jo=34056,Tw=5386,Iw=512,yu=513,Dw=514,Ep=515,Rv=516,p_=517,A1=518,Am=519,v0=35044,Zo=35048,my=35040,gy=35045,Ym=35049,_0=35041,f_=35046,vy=35050,DS=35042,y1="100",Xm="300 es",_y=1035;class Ts{addEventListener(o,g){this._listeners===void 0&&(this._listeners={});const $=this._listeners;$[o]===void 0&&($[o]=[]),$[o].indexOf(g)===-1&&$[o].push(g)}hasEventListener(o,g){if(this._listeners===void 0)return!1;const $=this._listeners;return $[o]!==void 0&&$[o].indexOf(g)!==-1}removeEventListener(o,g){if(this._listeners===void 0)return;const $=this._listeners[o];if($!==void 0){const _e=$.indexOf(g);_e!==-1&&$.splice(_e,1)}}dispatchEvent(o){if(this._listeners===void 0)return;const g=this._listeners[o.type];if(g!==void 0){o.target=this;const $=g.slice(0);for(let _e=0,rt=$.length;_e<rt;_e++)$[_e].call(this,o);o.target=null}}}const Cl=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Pw=1234567;const A0=Math.PI/180,_A=180/Math.PI;function wu(){const ut=4294967295*Math.random()|0,o=4294967295*Math.random()|0,g=4294967295*Math.random()|0,$=4294967295*Math.random()|0;return(Cl[255&ut]+Cl[ut>>8&255]+Cl[ut>>16&255]+Cl[ut>>24&255]+"-"+Cl[255&o]+Cl[o>>8&255]+"-"+Cl[o>>16&15|64]+Cl[o>>24&255]+"-"+Cl[63&g|128]+Cl[g>>8&255]+"-"+Cl[g>>16&255]+Cl[g>>24&255]+Cl[255&$]+Cl[$>>8&255]+Cl[$>>16&255]+Cl[$>>24&255]).toLowerCase()}function ys(ut,o,g){return Math.max(o,Math.min(g,ut))}function ym(ut,o){return(ut%o+o)%o}function AA(ut,o,g){return(1-g)*ut+g*o}function yA(ut){return(ut&ut-1)==0&&ut!==0}function Bv(ut){return Math.pow(2,Math.ceil(Math.log(ut)/Math.LN2))}function Bu(ut){return Math.pow(2,Math.floor(Math.log(ut)/Math.LN2))}function Km(ut,o){switch(o.constructor){case Float32Array:return ut;case Uint16Array:return ut/65535;case Uint8Array:return ut/255;case Int16Array:return Math.max(ut/32767,-1);case Int8Array:return Math.max(ut/127,-1);default:throw new Error("Invalid component type.")}}function Io(ut,o){switch(o.constructor){case Float32Array:return ut;case Uint16Array:return Math.round(65535*ut);case Uint8Array:return Math.round(255*ut);case Int16Array:return Math.round(32767*ut);case Int8Array:return Math.round(127*ut);default:throw new Error("Invalid component type.")}}var Ay=Object.freeze({__proto__:null,DEG2RAD:A0,RAD2DEG:_A,generateUUID:wu,clamp:ys,euclideanModulo:ym,mapLinear:function(ut,o,g,$,_e){return $+(ut-o)*(_e-$)/(g-o)},inverseLerp:function(ut,o,g){return ut!==o?(g-ut)/(o-ut):0},lerp:AA,damp:function(ut,o,g,$){return AA(ut,o,1-Math.exp(-g*$))},pingpong:function(ut,o=1){return o-Math.abs(ym(ut,2*o)-o)},smoothstep:function(ut,o,g){return ut<=o?0:ut>=g?1:(ut=(ut-o)/(g-o))*ut*(3-2*ut)},smootherstep:function(ut,o,g){return ut<=o?0:ut>=g?1:(ut=(ut-o)/(g-o))*ut*ut*(ut*(6*ut-15)+10)},randInt:function(ut,o){return ut+Math.floor(Math.random()*(o-ut+1))},randFloat:function(ut,o){return ut+Math.random()*(o-ut)},randFloatSpread:function(ut){return ut*(.5-Math.random())},seededRandom:function(ut){ut!==void 0&&(Pw=ut);let o=Pw+=1831565813;return o=Math.imul(o^o>>>15,1|o),o^=o+Math.imul(o^o>>>7,61|o),((o^o>>>14)>>>0)/4294967296},degToRad:function(ut){return ut*A0},radToDeg:function(ut){return ut*_A},isPowerOfTwo:yA,ceilPowerOfTwo:Bv,floorPowerOfTwo:Bu,setQuaternionFromProperEuler:function(ut,o,g,$,_e){const rt=Math.cos,at=Math.sin,ct=rt(g/2),ft=at(g/2),mt=rt((o+$)/2),bt=at((o+$)/2),Mt=rt((o-$)/2),St=at((o-$)/2),It=rt(($-o)/2),Bt=at(($-o)/2);switch(_e){case"XYX":ut.set(ct*bt,ft*Mt,ft*St,ct*mt);break;case"YZY":ut.set(ft*St,ct*bt,ft*Mt,ct*mt);break;case"ZXZ":ut.set(ft*Mt,ft*St,ct*bt,ct*mt);break;case"XZX":ut.set(ct*bt,ft*Bt,ft*It,ct*mt);break;case"YXY":ut.set(ft*It,ct*bt,ft*Bt,ct*mt);break;case"ZYZ":ut.set(ft*Bt,ft*It,ct*bt,ct*mt);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+_e)}},normalize:Io,denormalize:Km});class Cr{constructor(o=0,g=0){Cr.prototype.isVector2=!0,this.x=o,this.y=g}get width(){return this.x}set width(o){this.x=o}get height(){return this.y}set height(o){this.y=o}set(o,g){return this.x=o,this.y=g,this}setScalar(o){return this.x=o,this.y=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y)}copy(o){return this.x=o.x,this.y=o.y,this}add(o){return this.x+=o.x,this.y+=o.y,this}addScalar(o){return this.x+=o,this.y+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this}subScalar(o){return this.x-=o,this.y-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this}multiply(o){return this.x*=o.x,this.y*=o.y,this}multiplyScalar(o){return this.x*=o,this.y*=o,this}divide(o){return this.x/=o.x,this.y/=o.y,this}divideScalar(o){return this.multiplyScalar(1/o)}applyMatrix3(o){const g=this.x,$=this.y,_e=o.elements;return this.x=_e[0]*g+_e[3]*$+_e[6],this.y=_e[1]*g+_e[4]*$+_e[7],this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(o){return this.x*o.x+this.y*o.y}cross(o){return this.x*o.y-this.y*o.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,$=this.y-o.y;return g*g+$*$}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this}equals(o){return o.x===this.x&&o.y===this.y}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this}rotateAround(o,g){const $=Math.cos(g),_e=Math.sin(g),rt=this.x-o.x,at=this.y-o.y;return this.x=rt*$-at*_e+o.x,this.y=rt*_e+at*$+o.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ru{constructor(){ru.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(o,g,$,_e,rt,at,ct,ft,mt){const bt=this.elements;return bt[0]=o,bt[1]=_e,bt[2]=ct,bt[3]=g,bt[4]=rt,bt[5]=ft,bt[6]=$,bt[7]=at,bt[8]=mt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(o){const g=this.elements,$=o.elements;return g[0]=$[0],g[1]=$[1],g[2]=$[2],g[3]=$[3],g[4]=$[4],g[5]=$[5],g[6]=$[6],g[7]=$[7],g[8]=$[8],this}extractBasis(o,g,$){return o.setFromMatrix3Column(this,0),g.setFromMatrix3Column(this,1),$.setFromMatrix3Column(this,2),this}setFromMatrix4(o){const g=o.elements;return this.set(g[0],g[4],g[8],g[1],g[5],g[9],g[2],g[6],g[10]),this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const $=o.elements,_e=g.elements,rt=this.elements,at=$[0],ct=$[3],ft=$[6],mt=$[1],bt=$[4],Mt=$[7],St=$[2],It=$[5],Bt=$[8],Dt=_e[0],Ut=_e[3],Ft=_e[6],zt=_e[1],Kt=_e[4],tn=_e[7],sn=_e[2],ln=_e[5],kn=_e[8];return rt[0]=at*Dt+ct*zt+ft*sn,rt[3]=at*Ut+ct*Kt+ft*ln,rt[6]=at*Ft+ct*tn+ft*kn,rt[1]=mt*Dt+bt*zt+Mt*sn,rt[4]=mt*Ut+bt*Kt+Mt*ln,rt[7]=mt*Ft+bt*tn+Mt*kn,rt[2]=St*Dt+It*zt+Bt*sn,rt[5]=St*Ut+It*Kt+Bt*ln,rt[8]=St*Ft+It*tn+Bt*kn,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[3]*=o,g[6]*=o,g[1]*=o,g[4]*=o,g[7]*=o,g[2]*=o,g[5]*=o,g[8]*=o,this}determinant(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8];return g*at*bt-g*ct*mt-$*rt*bt+$*ct*ft+_e*rt*mt-_e*at*ft}invert(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8],Mt=bt*at-ct*mt,St=ct*ft-bt*rt,It=mt*rt-at*ft,Bt=g*Mt+$*St+_e*It;if(Bt===0)return this.set(0,0,0,0,0,0,0,0,0);const Dt=1/Bt;return o[0]=Mt*Dt,o[1]=(_e*mt-bt*$)*Dt,o[2]=(ct*$-_e*at)*Dt,o[3]=St*Dt,o[4]=(bt*g-_e*ft)*Dt,o[5]=(_e*rt-ct*g)*Dt,o[6]=It*Dt,o[7]=($*ft-mt*g)*Dt,o[8]=(at*g-$*rt)*Dt,this}transpose(){let o;const g=this.elements;return o=g[1],g[1]=g[3],g[3]=o,o=g[2],g[2]=g[6],g[6]=o,o=g[5],g[5]=g[7],g[7]=o,this}getNormalMatrix(o){return this.setFromMatrix4(o).invert().transpose()}transposeIntoArray(o){const g=this.elements;return o[0]=g[0],o[1]=g[3],o[2]=g[6],o[3]=g[1],o[4]=g[4],o[5]=g[7],o[6]=g[2],o[7]=g[5],o[8]=g[8],this}setUvTransform(o,g,$,_e,rt,at,ct){const ft=Math.cos(rt),mt=Math.sin(rt);return this.set($*ft,$*mt,-$*(ft*at+mt*ct)+at+o,-_e*mt,_e*ft,-_e*(-mt*at+ft*ct)+ct+g,0,0,1),this}scale(o,g){const $=this.elements;return $[0]*=o,$[3]*=o,$[6]*=o,$[1]*=g,$[4]*=g,$[7]*=g,this}rotate(o){const g=Math.cos(o),$=Math.sin(o),_e=this.elements,rt=_e[0],at=_e[3],ct=_e[6],ft=_e[1],mt=_e[4],bt=_e[7];return _e[0]=g*rt+$*ft,_e[3]=g*at+$*mt,_e[6]=g*ct+$*bt,_e[1]=-$*rt+g*ft,_e[4]=-$*at+g*mt,_e[7]=-$*ct+g*bt,this}translate(o,g){const $=this.elements;return $[0]+=o*$[2],$[3]+=o*$[5],$[6]+=o*$[8],$[1]+=g*$[2],$[4]+=g*$[5],$[7]+=g*$[8],this}equals(o){const g=this.elements,$=o.elements;for(let _e=0;_e<9;_e++)if(g[_e]!==$[_e])return!1;return!0}fromArray(o,g=0){for(let $=0;$<9;$++)this.elements[$]=o[$+g];return this}toArray(o=[],g=0){const $=this.elements;return o[g]=$[0],o[g+1]=$[1],o[g+2]=$[2],o[g+3]=$[3],o[g+4]=$[4],o[g+5]=$[5],o[g+6]=$[6],o[g+7]=$[7],o[g+8]=$[8],o}clone(){return new this.constructor().fromArray(this.elements)}}function w1(ut){for(let o=ut.length-1;o>=0;--o)if(ut[o]>65535)return!0;return!1}const Rw={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function y0(ut,o){return new Rw[ut](o)}function w0(ut){return document.createElementNS("http://www.w3.org/1999/xhtml",ut)}function Zp(ut){return ut<.04045?.0773993808*ut:Math.pow(.9478672986*ut+.0521327014,2.4)}function wA(ut){return ut<.0031308?12.92*ut:1.055*Math.pow(ut,.41666)-.055}const m_={[iu]:{[to]:Zp},[to]:{[iu]:wA}},xu={legacyMode:!0,get workingColorSpace(){return to},set workingColorSpace(ut){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(ut,o,g){if(this.legacyMode||o===g||!o||!g)return ut;if(m_[o]&&m_[o][g]!==void 0){const $=m_[o][g];return ut.r=$(ut.r),ut.g=$(ut.g),ut.b=$(ut.b),ut}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(ut,o){return this.convert(ut,this.workingColorSpace,o)},toWorkingColorSpace:function(ut,o){return this.convert(ut,o,this.workingColorSpace)}},yy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$o={r:0,g:0,b:0},Sp={h:0,s:0,l:0},g_={h:0,s:0,l:0};function sp(ut,o,g){return g<0&&(g+=1),g>1&&(g-=1),g<1/6?ut+6*(o-ut)*g:g<.5?o:g<2/3?ut+6*(o-ut)*(2/3-g):ut}function wy(ut,o){return o.r=ut.r,o.g=ut.g,o.b=ut.b,o}class ts{constructor(o,g,$){return this.isColor=!0,this.r=1,this.g=1,this.b=1,g===void 0&&$===void 0?this.set(o):this.setRGB(o,g,$)}set(o){return o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o),this}setScalar(o){return this.r=o,this.g=o,this.b=o,this}setHex(o,g=iu){return o=Math.floor(o),this.r=(o>>16&255)/255,this.g=(o>>8&255)/255,this.b=(255&o)/255,xu.toWorkingColorSpace(this,g),this}setRGB(o,g,$,_e=to){return this.r=o,this.g=g,this.b=$,xu.toWorkingColorSpace(this,_e),this}setHSL(o,g,$,_e=to){if(o=ym(o,1),g=ys(g,0,1),$=ys($,0,1),g===0)this.r=this.g=this.b=$;else{const rt=$<=.5?$*(1+g):$+g-$*g,at=2*$-rt;this.r=sp(at,rt,o+1/3),this.g=sp(at,rt,o),this.b=sp(at,rt,o-1/3)}return xu.toWorkingColorSpace(this,_e),this}setStyle(o,g=iu){function $(rt){rt!==void 0&&parseFloat(rt)<1&&console.warn("THREE.Color: Alpha component of "+o+" will be ignored.")}let _e;if(_e=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(o)){let rt;const at=_e[1],ct=_e[2];switch(at){case"rgb":case"rgba":if(rt=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(255,parseInt(rt[1],10))/255,this.g=Math.min(255,parseInt(rt[2],10))/255,this.b=Math.min(255,parseInt(rt[3],10))/255,xu.toWorkingColorSpace(this,g),$(rt[4]),this;if(rt=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct))return this.r=Math.min(100,parseInt(rt[1],10))/100,this.g=Math.min(100,parseInt(rt[2],10))/100,this.b=Math.min(100,parseInt(rt[3],10))/100,xu.toWorkingColorSpace(this,g),$(rt[4]),this;break;case"hsl":case"hsla":if(rt=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(ct)){const ft=parseFloat(rt[1])/360,mt=parseFloat(rt[2])/100,bt=parseFloat(rt[3])/100;return $(rt[4]),this.setHSL(ft,mt,bt,g)}}}else if(_e=/^\#([A-Fa-f\d]+)$/.exec(o)){const rt=_e[1],at=rt.length;if(at===3)return this.r=parseInt(rt.charAt(0)+rt.charAt(0),16)/255,this.g=parseInt(rt.charAt(1)+rt.charAt(1),16)/255,this.b=parseInt(rt.charAt(2)+rt.charAt(2),16)/255,xu.toWorkingColorSpace(this,g),this;if(at===6)return this.r=parseInt(rt.charAt(0)+rt.charAt(1),16)/255,this.g=parseInt(rt.charAt(2)+rt.charAt(3),16)/255,this.b=parseInt(rt.charAt(4)+rt.charAt(5),16)/255,xu.toWorkingColorSpace(this,g),this}return o&&o.length>0?this.setColorName(o,g):this}setColorName(o,g=iu){const $=yy[o.toLowerCase()];return $!==void 0?this.setHex($,g):console.warn("THREE.Color: Unknown color "+o),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(o){return this.r=o.r,this.g=o.g,this.b=o.b,this}copySRGBToLinear(o){return this.r=Zp(o.r),this.g=Zp(o.g),this.b=Zp(o.b),this}copyLinearToSRGB(o){return this.r=wA(o.r),this.g=wA(o.g),this.b=wA(o.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(o=iu){return xu.fromWorkingColorSpace(wy(this,$o),o),ys(255*$o.r,0,255)<<16^ys(255*$o.g,0,255)<<8^ys(255*$o.b,0,255)<<0}getHexString(o=iu){return("000000"+this.getHex(o).toString(16)).slice(-6)}getHSL(o,g=to){xu.fromWorkingColorSpace(wy(this,$o),g);const $=$o.r,_e=$o.g,rt=$o.b,at=Math.max($,_e,rt),ct=Math.min($,_e,rt);let ft,mt;const bt=(ct+at)/2;if(ct===at)ft=0,mt=0;else{const Mt=at-ct;switch(mt=bt<=.5?Mt/(at+ct):Mt/(2-at-ct),at){case $:ft=(_e-rt)/Mt+(_e<rt?6:0);break;case _e:ft=(rt-$)/Mt+2;break;case rt:ft=($-_e)/Mt+4}ft/=6}return o.h=ft,o.s=mt,o.l=bt,o}getRGB(o,g=to){return xu.fromWorkingColorSpace(wy(this,$o),g),o.r=$o.r,o.g=$o.g,o.b=$o.b,o}getStyle(o=iu){return xu.fromWorkingColorSpace(wy(this,$o),o),o!==iu?`color(${o} ${$o.r} ${$o.g} ${$o.b})`:`rgb(${255*$o.r|0},${255*$o.g|0},${255*$o.b|0})`}offsetHSL(o,g,$){return this.getHSL(Sp),Sp.h+=o,Sp.s+=g,Sp.l+=$,this.setHSL(Sp.h,Sp.s,Sp.l),this}add(o){return this.r+=o.r,this.g+=o.g,this.b+=o.b,this}addColors(o,g){return this.r=o.r+g.r,this.g=o.g+g.g,this.b=o.b+g.b,this}addScalar(o){return this.r+=o,this.g+=o,this.b+=o,this}sub(o){return this.r=Math.max(0,this.r-o.r),this.g=Math.max(0,this.g-o.g),this.b=Math.max(0,this.b-o.b),this}multiply(o){return this.r*=o.r,this.g*=o.g,this.b*=o.b,this}multiplyScalar(o){return this.r*=o,this.g*=o,this.b*=o,this}lerp(o,g){return this.r+=(o.r-this.r)*g,this.g+=(o.g-this.g)*g,this.b+=(o.b-this.b)*g,this}lerpColors(o,g,$){return this.r=o.r+(g.r-o.r)*$,this.g=o.g+(g.g-o.g)*$,this.b=o.b+(g.b-o.b)*$,this}lerpHSL(o,g){this.getHSL(Sp),o.getHSL(g_);const $=AA(Sp.h,g_.h,g),_e=AA(Sp.s,g_.s,g),rt=AA(Sp.l,g_.l,g);return this.setHSL($,_e,rt),this}equals(o){return o.r===this.r&&o.g===this.g&&o.b===this.b}fromArray(o,g=0){return this.r=o[g],this.g=o[g+1],this.b=o[g+2],this}toArray(o=[],g=0){return o[g]=this.r,o[g+1]=this.g,o[g+2]=this.b,o}fromBufferAttribute(o,g){return this.r=o.getX(g),this.g=o.getY(g),this.b=o.getZ(g),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Cp;ts.NAMES=yy;class xA{static getDataURL(o,g=!1){if(/^data:/i.test(o.src)||typeof HTMLCanvasElement>"u")return o.src;let $;if(o instanceof HTMLCanvasElement)$=o;else{Cp===void 0&&(Cp=w0("canvas")),Cp.width=o.width,Cp.height=o.height;const _e=Cp.getContext("2d");o instanceof ImageData?_e.putImageData(o,0,0):_e.drawImage(o,0,0,o.width,o.height),$=Cp}return!g&&($.width>2048||$.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",o),$.toDataURL("image/jpeg",.6)):$.toDataURL("image/png")}static sRGBToLinear(o){if(typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap){const g=w0("canvas");g.width=o.width,g.height=o.height;const $=g.getContext("2d");$.drawImage(o,0,0,o.width,o.height);const _e=$.getImageData(0,0,o.width,o.height),rt=_e.data;for(let at=0;at<rt.length;at++)rt[at]=255*Zp(rt[at]/255);return $.putImageData(_e,0,0),g}if(o.data){const g=o.data.slice(0);for(let $=0;$<g.length;$++)g instanceof Uint8Array||g instanceof Uint8ClampedArray?g[$]=Math.floor(255*Zp(g[$]/255)):g[$]=Zp(g[$]);return{data:g,width:o.width,height:o.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),o}}class x0{constructor(o=null){this.isSource=!0,this.uuid=wu(),this.data=o,this.version=0}set needsUpdate(o){o===!0&&this.version++}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.images[this.uuid]!==void 0)return o.images[this.uuid];const $={uuid:this.uuid,url:""},_e=this.data;if(_e!==null){let rt;if(Array.isArray(_e)){rt=[];for(let at=0,ct=_e.length;at<ct;at++)_e[at].isDataTexture?rt.push(v_(_e[at].image)):rt.push(v_(_e[at]))}else rt=v_(_e);$.url=rt}return g||(o.images[this.uuid]=$),$}}function v_(ut){if(typeof HTMLImageElement<"u"&&ut instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ut instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ut instanceof ImageBitmap)return xA.getDataURL(ut);if(ut.data){let o=[];try{o=Array.from(ut.data)}catch(g){g.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(g),o=ut.data}return{data:o,width:ut.width,height:ut.height,type:ut.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Bw=0;class zl extends Ts{constructor(o=zl.DEFAULT_IMAGE,g=zl.DEFAULT_MAPPING,$=Oo,_e=Oo,rt=Ko,at=vo,ct=Yu,ft=vm,mt=1,bt=Jp){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Bw++}),this.uuid=wu(),this.name="",this.source=new x0(o),this.mipmaps=[],this.mapping=g,this.wrapS=$,this.wrapT=_e,this.magFilter=rt,this.minFilter=at,this.anisotropy=mt,this.format=ct,this.internalFormat=null,this.type=ft,this.offset=new Cr(0,0),this.repeat=new Cr(1,1),this.center=new Cr(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ru,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=bt,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(o){this.source.data=o}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(o){return this.name=o.name,this.source=o.source,this.mipmaps=o.mipmaps.slice(0),this.mapping=o.mapping,this.wrapS=o.wrapS,this.wrapT=o.wrapT,this.magFilter=o.magFilter,this.minFilter=o.minFilter,this.anisotropy=o.anisotropy,this.format=o.format,this.internalFormat=o.internalFormat,this.type=o.type,this.offset.copy(o.offset),this.repeat.copy(o.repeat),this.center.copy(o.center),this.rotation=o.rotation,this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrix.copy(o.matrix),this.generateMipmaps=o.generateMipmaps,this.premultiplyAlpha=o.premultiplyAlpha,this.flipY=o.flipY,this.unpackAlignment=o.unpackAlignment,this.encoding=o.encoding,this.userData=JSON.parse(JSON.stringify(o.userData)),this.needsUpdate=!0,this}toJSON(o){const g=o===void 0||typeof o=="string";if(!g&&o.textures[this.uuid]!==void 0)return o.textures[this.uuid];const $={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(o).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),g||(o.textures[this.uuid]=$),$}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(o){if(this.mapping!==vu)return o;if(o.applyMatrix3(this.matrix),o.x<0||o.x>1)switch(this.wrapS){case Pu:o.x=o.x-Math.floor(o.x);break;case Oo:o.x=o.x<0?0:1;break;case Yp:Math.abs(Math.floor(o.x)%2)===1?o.x=Math.ceil(o.x)-o.x:o.x=o.x-Math.floor(o.x)}if(o.y<0||o.y>1)switch(this.wrapT){case Pu:o.y=o.y-Math.floor(o.y);break;case Oo:o.y=o.y<0?0:1;break;case Yp:Math.abs(Math.floor(o.y)%2)===1?o.y=Math.ceil(o.y)-o.y:o.y=o.y-Math.floor(o.y)}return this.flipY&&(o.y=1-o.y),o}set needsUpdate(o){o===!0&&(this.version++,this.source.needsUpdate=!0)}}zl.DEFAULT_IMAGE=null,zl.DEFAULT_MAPPING=vu;class fo{constructor(o=0,g=0,$=0,_e=1){fo.prototype.isVector4=!0,this.x=o,this.y=g,this.z=$,this.w=_e}get width(){return this.z}set width(o){this.z=o}get height(){return this.w}set height(o){this.w=o}set(o,g,$,_e){return this.x=o,this.y=g,this.z=$,this.w=_e,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this.w=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setW(o){return this.w=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;case 3:this.w=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this.w=o.w!==void 0?o.w:1,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this.w+=o.w,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this.w+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this.w=o.w+g.w,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this.w+=o.w*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this.w-=o.w,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this.w-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this.w=o.w-g.w,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this.w*=o.w,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this.w*=o,this}applyMatrix4(o){const g=this.x,$=this.y,_e=this.z,rt=this.w,at=o.elements;return this.x=at[0]*g+at[4]*$+at[8]*_e+at[12]*rt,this.y=at[1]*g+at[5]*$+at[9]*_e+at[13]*rt,this.z=at[2]*g+at[6]*$+at[10]*_e+at[14]*rt,this.w=at[3]*g+at[7]*$+at[11]*_e+at[15]*rt,this}divideScalar(o){return this.multiplyScalar(1/o)}setAxisAngleFromQuaternion(o){this.w=2*Math.acos(o.w);const g=Math.sqrt(1-o.w*o.w);return g<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=o.x/g,this.y=o.y/g,this.z=o.z/g),this}setAxisAngleFromRotationMatrix(o){let g,$,_e,rt;const ft=o.elements,mt=ft[0],bt=ft[4],Mt=ft[8],St=ft[1],It=ft[5],Bt=ft[9],Dt=ft[2],Ut=ft[6],Ft=ft[10];if(Math.abs(bt-St)<.01&&Math.abs(Mt-Dt)<.01&&Math.abs(Bt-Ut)<.01){if(Math.abs(bt+St)<.1&&Math.abs(Mt+Dt)<.1&&Math.abs(Bt+Ut)<.1&&Math.abs(mt+It+Ft-3)<.1)return this.set(1,0,0,0),this;g=Math.PI;const Kt=(mt+1)/2,tn=(It+1)/2,sn=(Ft+1)/2,ln=(bt+St)/4,kn=(Mt+Dt)/4,Ln=(Bt+Ut)/4;return Kt>tn&&Kt>sn?Kt<.01?($=0,_e=.707106781,rt=.707106781):($=Math.sqrt(Kt),_e=ln/$,rt=kn/$):tn>sn?tn<.01?($=.707106781,_e=0,rt=.707106781):(_e=Math.sqrt(tn),$=ln/_e,rt=Ln/_e):sn<.01?($=.707106781,_e=.707106781,rt=0):(rt=Math.sqrt(sn),$=kn/rt,_e=Ln/rt),this.set($,_e,rt,g),this}let zt=Math.sqrt((Ut-Bt)*(Ut-Bt)+(Mt-Dt)*(Mt-Dt)+(St-bt)*(St-bt));return Math.abs(zt)<.001&&(zt=1),this.x=(Ut-Bt)/zt,this.y=(Mt-Dt)/zt,this.z=(St-bt)/zt,this.w=Math.acos((mt+It+Ft-1)/2),this}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this.w=Math.min(this.w,o.w),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this.w=Math.max(this.w,o.w),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this.w=Math.max(o.w,Math.min(g.w,this.w)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this.w=Math.max(o,Math.min(g,this.w)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z+this.w*o.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this.w+=(o.w-this.w)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this.z=o.z+(g.z-o.z)*$,this.w=o.w+(g.w-o.w)*$,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z&&o.w===this.w}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this.w=o[g+3],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o[g+3]=this.w,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this.w=o.getW(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ku extends Ts{constructor(o,g,$={}){super(),this.isWebGLRenderTarget=!0,this.width=o,this.height=g,this.depth=1,this.scissor=new fo(0,0,o,g),this.scissorTest=!1,this.viewport=new fo(0,0,o,g);const _e={width:o,height:g,depth:1};this.texture=new zl(_e,$.mapping,$.wrapS,$.wrapT,$.magFilter,$.minFilter,$.format,$.type,$.anisotropy,$.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=$.generateMipmaps!==void 0&&$.generateMipmaps,this.texture.internalFormat=$.internalFormat!==void 0?$.internalFormat:null,this.texture.minFilter=$.minFilter!==void 0?$.minFilter:Ko,this.depthBuffer=$.depthBuffer===void 0||$.depthBuffer,this.stencilBuffer=$.stencilBuffer!==void 0&&$.stencilBuffer,this.depthTexture=$.depthTexture!==void 0?$.depthTexture:null,this.samples=$.samples!==void 0?$.samples:0}setSize(o,g,$=1){this.width===o&&this.height===g&&this.depth===$||(this.width=o,this.height=g,this.depth=$,this.texture.image.width=o,this.texture.image.height=g,this.texture.image.depth=$,this.dispose()),this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g)}clone(){return new this.constructor().copy(this)}copy(o){this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.copy(o.viewport),this.texture=o.texture.clone(),this.texture.isRenderTargetTexture=!0;const g=Object.assign({},o.texture.image);return this.texture.source=new x0(g),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.samples=o.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class __ extends zl{constructor(o=null,g=1,$=1,_e=1){super(null),this.isDataArrayTexture=!0,this.image={data:o,width:g,height:$,depth:_e},this.magFilter=Yo,this.minFilter=Yo,this.wrapR=Oo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class x1 extends Ku{constructor(o,g,$){super(o,g),this.isWebGLArrayRenderTarget=!0,this.depth=$,this.texture=new __(null,o,g,$),this.texture.isRenderTargetTexture=!0}}class b0 extends zl{constructor(o=null,g=1,$=1,_e=1){super(null),this.isData3DTexture=!0,this.image={data:o,width:g,height:$,depth:_e},this.magFilter=Yo,this.minFilter=Yo,this.wrapR=Oo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class xy extends Ku{constructor(o,g,$){super(o,g),this.isWebGL3DRenderTarget=!0,this.depth=$,this.texture=new b0(null,o,g,$),this.texture.isRenderTargetTexture=!0}}class Mp extends Ku{constructor(o,g,$,_e={}){super(o,g,_e),this.isWebGLMultipleRenderTargets=!0;const rt=this.texture;this.texture=[];for(let at=0;at<$;at++)this.texture[at]=rt.clone(),this.texture[at].isRenderTargetTexture=!0}setSize(o,g,$=1){if(this.width!==o||this.height!==g||this.depth!==$){this.width=o,this.height=g,this.depth=$;for(let _e=0,rt=this.texture.length;_e<rt;_e++)this.texture[_e].image.width=o,this.texture[_e].image.height=g,this.texture[_e].image.depth=$;this.dispose()}return this.viewport.set(0,0,o,g),this.scissor.set(0,0,o,g),this}copy(o){this.dispose(),this.width=o.width,this.height=o.height,this.depth=o.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=o.depthBuffer,this.stencilBuffer=o.stencilBuffer,o.depthTexture!==null&&(this.depthTexture=o.depthTexture.clone()),this.texture.length=0;for(let g=0,$=o.texture.length;g<$;g++)this.texture[g]=o.texture[g].clone(),this.texture[g].isRenderTargetTexture=!0;return this}}class su{constructor(o=0,g=0,$=0,_e=1){this.isQuaternion=!0,this._x=o,this._y=g,this._z=$,this._w=_e}static slerpFlat(o,g,$,_e,rt,at,ct){let ft=$[_e+0],mt=$[_e+1],bt=$[_e+2],Mt=$[_e+3];const St=rt[at+0],It=rt[at+1],Bt=rt[at+2],Dt=rt[at+3];if(ct===0)return o[g+0]=ft,o[g+1]=mt,o[g+2]=bt,void(o[g+3]=Mt);if(ct===1)return o[g+0]=St,o[g+1]=It,o[g+2]=Bt,void(o[g+3]=Dt);if(Mt!==Dt||ft!==St||mt!==It||bt!==Bt){let Ut=1-ct;const Ft=ft*St+mt*It+bt*Bt+Mt*Dt,zt=Ft>=0?1:-1,Kt=1-Ft*Ft;if(Kt>Number.EPSILON){const sn=Math.sqrt(Kt),ln=Math.atan2(sn,Ft*zt);Ut=Math.sin(Ut*ln)/sn,ct=Math.sin(ct*ln)/sn}const tn=ct*zt;if(ft=ft*Ut+St*tn,mt=mt*Ut+It*tn,bt=bt*Ut+Bt*tn,Mt=Mt*Ut+Dt*tn,Ut===1-ct){const sn=1/Math.sqrt(ft*ft+mt*mt+bt*bt+Mt*Mt);ft*=sn,mt*=sn,bt*=sn,Mt*=sn}}o[g]=ft,o[g+1]=mt,o[g+2]=bt,o[g+3]=Mt}static multiplyQuaternionsFlat(o,g,$,_e,rt,at){const ct=$[_e],ft=$[_e+1],mt=$[_e+2],bt=$[_e+3],Mt=rt[at],St=rt[at+1],It=rt[at+2],Bt=rt[at+3];return o[g]=ct*Bt+bt*Mt+ft*It-mt*St,o[g+1]=ft*Bt+bt*St+mt*Mt-ct*It,o[g+2]=mt*Bt+bt*It+ct*St-ft*Mt,o[g+3]=bt*Bt-ct*Mt-ft*St-mt*It,o}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get w(){return this._w}set w(o){this._w=o,this._onChangeCallback()}set(o,g,$,_e){return this._x=o,this._y=g,this._z=$,this._w=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(o){return this._x=o.x,this._y=o.y,this._z=o.z,this._w=o.w,this._onChangeCallback(),this}setFromEuler(o,g){const $=o._x,_e=o._y,rt=o._z,at=o._order,ct=Math.cos,ft=Math.sin,mt=ct($/2),bt=ct(_e/2),Mt=ct(rt/2),St=ft($/2),It=ft(_e/2),Bt=ft(rt/2);switch(at){case"XYZ":this._x=St*bt*Mt+mt*It*Bt,this._y=mt*It*Mt-St*bt*Bt,this._z=mt*bt*Bt+St*It*Mt,this._w=mt*bt*Mt-St*It*Bt;break;case"YXZ":this._x=St*bt*Mt+mt*It*Bt,this._y=mt*It*Mt-St*bt*Bt,this._z=mt*bt*Bt-St*It*Mt,this._w=mt*bt*Mt+St*It*Bt;break;case"ZXY":this._x=St*bt*Mt-mt*It*Bt,this._y=mt*It*Mt+St*bt*Bt,this._z=mt*bt*Bt+St*It*Mt,this._w=mt*bt*Mt-St*It*Bt;break;case"ZYX":this._x=St*bt*Mt-mt*It*Bt,this._y=mt*It*Mt+St*bt*Bt,this._z=mt*bt*Bt-St*It*Mt,this._w=mt*bt*Mt+St*It*Bt;break;case"YZX":this._x=St*bt*Mt+mt*It*Bt,this._y=mt*It*Mt+St*bt*Bt,this._z=mt*bt*Bt-St*It*Mt,this._w=mt*bt*Mt-St*It*Bt;break;case"XZY":this._x=St*bt*Mt-mt*It*Bt,this._y=mt*It*Mt-St*bt*Bt,this._z=mt*bt*Bt+St*It*Mt,this._w=mt*bt*Mt+St*It*Bt;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+at)}return g!==!1&&this._onChangeCallback(),this}setFromAxisAngle(o,g){const $=g/2,_e=Math.sin($);return this._x=o.x*_e,this._y=o.y*_e,this._z=o.z*_e,this._w=Math.cos($),this._onChangeCallback(),this}setFromRotationMatrix(o){const g=o.elements,$=g[0],_e=g[4],rt=g[8],at=g[1],ct=g[5],ft=g[9],mt=g[2],bt=g[6],Mt=g[10],St=$+ct+Mt;if(St>0){const It=.5/Math.sqrt(St+1);this._w=.25/It,this._x=(bt-ft)*It,this._y=(rt-mt)*It,this._z=(at-_e)*It}else if($>ct&&$>Mt){const It=2*Math.sqrt(1+$-ct-Mt);this._w=(bt-ft)/It,this._x=.25*It,this._y=(_e+at)/It,this._z=(rt+mt)/It}else if(ct>Mt){const It=2*Math.sqrt(1+ct-$-Mt);this._w=(rt-mt)/It,this._x=(_e+at)/It,this._y=.25*It,this._z=(ft+bt)/It}else{const It=2*Math.sqrt(1+Mt-$-ct);this._w=(at-_e)/It,this._x=(rt+mt)/It,this._y=(ft+bt)/It,this._z=.25*It}return this._onChangeCallback(),this}setFromUnitVectors(o,g){let $=o.dot(g)+1;return $<Number.EPSILON?($=0,Math.abs(o.x)>Math.abs(o.z)?(this._x=-o.y,this._y=o.x,this._z=0,this._w=$):(this._x=0,this._y=-o.z,this._z=o.y,this._w=$)):(this._x=o.y*g.z-o.z*g.y,this._y=o.z*g.x-o.x*g.z,this._z=o.x*g.y-o.y*g.x,this._w=$),this.normalize()}angleTo(o){return 2*Math.acos(Math.abs(ys(this.dot(o),-1,1)))}rotateTowards(o,g){const $=this.angleTo(o);if($===0)return this;const _e=Math.min(1,g/$);return this.slerp(o,_e),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(o){return this._x*o._x+this._y*o._y+this._z*o._z+this._w*o._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let o=this.length();return o===0?(this._x=0,this._y=0,this._z=0,this._w=1):(o=1/o,this._x=this._x*o,this._y=this._y*o,this._z=this._z*o,this._w=this._w*o),this._onChangeCallback(),this}multiply(o){return this.multiplyQuaternions(this,o)}premultiply(o){return this.multiplyQuaternions(o,this)}multiplyQuaternions(o,g){const $=o._x,_e=o._y,rt=o._z,at=o._w,ct=g._x,ft=g._y,mt=g._z,bt=g._w;return this._x=$*bt+at*ct+_e*mt-rt*ft,this._y=_e*bt+at*ft+rt*ct-$*mt,this._z=rt*bt+at*mt+$*ft-_e*ct,this._w=at*bt-$*ct-_e*ft-rt*mt,this._onChangeCallback(),this}slerp(o,g){if(g===0)return this;if(g===1)return this.copy(o);const $=this._x,_e=this._y,rt=this._z,at=this._w;let ct=at*o._w+$*o._x+_e*o._y+rt*o._z;if(ct<0?(this._w=-o._w,this._x=-o._x,this._y=-o._y,this._z=-o._z,ct=-ct):this.copy(o),ct>=1)return this._w=at,this._x=$,this._y=_e,this._z=rt,this;const ft=1-ct*ct;if(ft<=Number.EPSILON){const It=1-g;return this._w=It*at+g*this._w,this._x=It*$+g*this._x,this._y=It*_e+g*this._y,this._z=It*rt+g*this._z,this.normalize(),this._onChangeCallback(),this}const mt=Math.sqrt(ft),bt=Math.atan2(mt,ct),Mt=Math.sin((1-g)*bt)/mt,St=Math.sin(g*bt)/mt;return this._w=at*Mt+this._w*St,this._x=$*Mt+this._x*St,this._y=_e*Mt+this._y*St,this._z=rt*Mt+this._z*St,this._onChangeCallback(),this}slerpQuaternions(o,g,$){return this.copy(o).slerp(g,$)}random(){const o=Math.random(),g=Math.sqrt(1-o),$=Math.sqrt(o),_e=2*Math.PI*Math.random(),rt=2*Math.PI*Math.random();return this.set(g*Math.cos(_e),$*Math.sin(rt),$*Math.cos(rt),g*Math.sin(_e))}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._w===this._w}fromArray(o,g=0){return this._x=o[g],this._y=o[g+1],this._z=o[g+2],this._w=o[g+3],this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._w,o}fromBufferAttribute(o,g){return this._x=o.getX(g),this._y=o.getY(g),this._z=o.getZ(g),this._w=o.getW(g),this}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class dn{constructor(o=0,g=0,$=0){dn.prototype.isVector3=!0,this.x=o,this.y=g,this.z=$}set(o,g,$){return $===void 0&&($=this.z),this.x=o,this.y=g,this.z=$,this}setScalar(o){return this.x=o,this.y=o,this.z=o,this}setX(o){return this.x=o,this}setY(o){return this.y=o,this}setZ(o){return this.z=o,this}setComponent(o,g){switch(o){case 0:this.x=g;break;case 1:this.y=g;break;case 2:this.z=g;break;default:throw new Error("index is out of range: "+o)}return this}getComponent(o){switch(o){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+o)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(o){return this.x=o.x,this.y=o.y,this.z=o.z,this}add(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this}addScalar(o){return this.x+=o,this.y+=o,this.z+=o,this}addVectors(o,g){return this.x=o.x+g.x,this.y=o.y+g.y,this.z=o.z+g.z,this}addScaledVector(o,g){return this.x+=o.x*g,this.y+=o.y*g,this.z+=o.z*g,this}sub(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this}subScalar(o){return this.x-=o,this.y-=o,this.z-=o,this}subVectors(o,g){return this.x=o.x-g.x,this.y=o.y-g.y,this.z=o.z-g.z,this}multiply(o){return this.x*=o.x,this.y*=o.y,this.z*=o.z,this}multiplyScalar(o){return this.x*=o,this.y*=o,this.z*=o,this}multiplyVectors(o,g){return this.x=o.x*g.x,this.y=o.y*g.y,this.z=o.z*g.z,this}applyEuler(o){return this.applyQuaternion(Tp.setFromEuler(o))}applyAxisAngle(o,g){return this.applyQuaternion(Tp.setFromAxisAngle(o,g))}applyMatrix3(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements;return this.x=rt[0]*g+rt[3]*$+rt[6]*_e,this.y=rt[1]*g+rt[4]*$+rt[7]*_e,this.z=rt[2]*g+rt[5]*$+rt[8]*_e,this}applyNormalMatrix(o){return this.applyMatrix3(o).normalize()}applyMatrix4(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements,at=1/(rt[3]*g+rt[7]*$+rt[11]*_e+rt[15]);return this.x=(rt[0]*g+rt[4]*$+rt[8]*_e+rt[12])*at,this.y=(rt[1]*g+rt[5]*$+rt[9]*_e+rt[13])*at,this.z=(rt[2]*g+rt[6]*$+rt[10]*_e+rt[14])*at,this}applyQuaternion(o){const g=this.x,$=this.y,_e=this.z,rt=o.x,at=o.y,ct=o.z,ft=o.w,mt=ft*g+at*_e-ct*$,bt=ft*$+ct*g-rt*_e,Mt=ft*_e+rt*$-at*g,St=-rt*g-at*$-ct*_e;return this.x=mt*ft+St*-rt+bt*-ct-Mt*-at,this.y=bt*ft+St*-at+Mt*-rt-mt*-ct,this.z=Mt*ft+St*-ct+mt*-at-bt*-rt,this}project(o){return this.applyMatrix4(o.matrixWorldInverse).applyMatrix4(o.projectionMatrix)}unproject(o){return this.applyMatrix4(o.projectionMatrixInverse).applyMatrix4(o.matrixWorld)}transformDirection(o){const g=this.x,$=this.y,_e=this.z,rt=o.elements;return this.x=rt[0]*g+rt[4]*$+rt[8]*_e,this.y=rt[1]*g+rt[5]*$+rt[9]*_e,this.z=rt[2]*g+rt[6]*$+rt[10]*_e,this.normalize()}divide(o){return this.x/=o.x,this.y/=o.y,this.z/=o.z,this}divideScalar(o){return this.multiplyScalar(1/o)}min(o){return this.x=Math.min(this.x,o.x),this.y=Math.min(this.y,o.y),this.z=Math.min(this.z,o.z),this}max(o){return this.x=Math.max(this.x,o.x),this.y=Math.max(this.y,o.y),this.z=Math.max(this.z,o.z),this}clamp(o,g){return this.x=Math.max(o.x,Math.min(g.x,this.x)),this.y=Math.max(o.y,Math.min(g.y,this.y)),this.z=Math.max(o.z,Math.min(g.z,this.z)),this}clampScalar(o,g){return this.x=Math.max(o,Math.min(g,this.x)),this.y=Math.max(o,Math.min(g,this.y)),this.z=Math.max(o,Math.min(g,this.z)),this}clampLength(o,g){const $=this.length();return this.divideScalar($||1).multiplyScalar(Math.max(o,Math.min(g,$)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(o){return this.x*o.x+this.y*o.y+this.z*o.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(o){return this.normalize().multiplyScalar(o)}lerp(o,g){return this.x+=(o.x-this.x)*g,this.y+=(o.y-this.y)*g,this.z+=(o.z-this.z)*g,this}lerpVectors(o,g,$){return this.x=o.x+(g.x-o.x)*$,this.y=o.y+(g.y-o.y)*$,this.z=o.z+(g.z-o.z)*$,this}cross(o){return this.crossVectors(this,o)}crossVectors(o,g){const $=o.x,_e=o.y,rt=o.z,at=g.x,ct=g.y,ft=g.z;return this.x=_e*ft-rt*ct,this.y=rt*at-$*ft,this.z=$*ct-_e*at,this}projectOnVector(o){const g=o.lengthSq();if(g===0)return this.set(0,0,0);const $=o.dot(this)/g;return this.copy(o).multiplyScalar($)}projectOnPlane(o){return Jm.copy(this).projectOnVector(o),this.sub(Jm)}reflect(o){return this.sub(Jm.copy(o).multiplyScalar(2*this.dot(o)))}angleTo(o){const g=Math.sqrt(this.lengthSq()*o.lengthSq());if(g===0)return Math.PI/2;const $=this.dot(o)/g;return Math.acos(ys($,-1,1))}distanceTo(o){return Math.sqrt(this.distanceToSquared(o))}distanceToSquared(o){const g=this.x-o.x,$=this.y-o.y,_e=this.z-o.z;return g*g+$*$+_e*_e}manhattanDistanceTo(o){return Math.abs(this.x-o.x)+Math.abs(this.y-o.y)+Math.abs(this.z-o.z)}setFromSpherical(o){return this.setFromSphericalCoords(o.radius,o.phi,o.theta)}setFromSphericalCoords(o,g,$){const _e=Math.sin(g)*o;return this.x=_e*Math.sin($),this.y=Math.cos(g)*o,this.z=_e*Math.cos($),this}setFromCylindrical(o){return this.setFromCylindricalCoords(o.radius,o.theta,o.y)}setFromCylindricalCoords(o,g,$){return this.x=o*Math.sin(g),this.y=$,this.z=o*Math.cos(g),this}setFromMatrixPosition(o){const g=o.elements;return this.x=g[12],this.y=g[13],this.z=g[14],this}setFromMatrixScale(o){const g=this.setFromMatrixColumn(o,0).length(),$=this.setFromMatrixColumn(o,1).length(),_e=this.setFromMatrixColumn(o,2).length();return this.x=g,this.y=$,this.z=_e,this}setFromMatrixColumn(o,g){return this.fromArray(o.elements,4*g)}setFromMatrix3Column(o,g){return this.fromArray(o.elements,3*g)}setFromEuler(o){return this.x=o._x,this.y=o._y,this.z=o._z,this}equals(o){return o.x===this.x&&o.y===this.y&&o.z===this.z}fromArray(o,g=0){return this.x=o[g],this.y=o[g+1],this.z=o[g+2],this}toArray(o=[],g=0){return o[g]=this.x,o[g+1]=this.y,o[g+2]=this.z,o}fromBufferAttribute(o,g){return this.x=o.getX(g),this.y=o.getY(g),this.z=o.getZ(g),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const o=2*(Math.random()-.5),g=Math.random()*Math.PI*2,$=Math.sqrt(1-o**2);return this.x=$*Math.cos(g),this.y=$*Math.sin(g),this.z=o,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Jm=new dn,Tp=new su;class E0{constructor(o=new dn(1/0,1/0,1/0),g=new dn(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromArray(o){let g=1/0,$=1/0,_e=1/0,rt=-1/0,at=-1/0,ct=-1/0;for(let ft=0,mt=o.length;ft<mt;ft+=3){const bt=o[ft],Mt=o[ft+1],St=o[ft+2];bt<g&&(g=bt),Mt<$&&($=Mt),St<_e&&(_e=St),bt>rt&&(rt=bt),Mt>at&&(at=Mt),St>ct&&(ct=St)}return this.min.set(g,$,_e),this.max.set(rt,at,ct),this}setFromBufferAttribute(o){let g=1/0,$=1/0,_e=1/0,rt=-1/0,at=-1/0,ct=-1/0;for(let ft=0,mt=o.count;ft<mt;ft++){const bt=o.getX(ft),Mt=o.getY(ft),St=o.getZ(ft);bt<g&&(g=bt),Mt<$&&($=Mt),St<_e&&(_e=St),bt>rt&&(rt=bt),Mt>at&&(at=Mt),St>ct&&(ct=St)}return this.min.set(g,$,_e),this.max.set(rt,at,ct),this}setFromPoints(o){this.makeEmpty();for(let g=0,$=o.length;g<$;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const $=S0.copy(g).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}setFromObject(o,g=!1){return this.makeEmpty(),this.expandByObject(o,g)}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(o){return this.isEmpty()?o.set(0,0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}expandByObject(o,g=!1){o.updateWorldMatrix(!1,!1);const $=o.geometry;if($!==void 0)if(g&&$.attributes!=null&&$.attributes.position!==void 0){const rt=$.attributes.position;for(let at=0,ct=rt.count;at<ct;at++)S0.fromBufferAttribute(rt,at).applyMatrix4(o.matrixWorld),this.expandByPoint(S0)}else $.boundingBox===null&&$.computeBoundingBox(),by.copy($.boundingBox),by.applyMatrix4(o.matrixWorld),this.union(by);const _e=o.children;for(let rt=0,at=_e.length;rt<at;rt++)this.expandByObject(_e[rt],g);return this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y||o.z<this.min.z||o.z>this.max.z)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y&&this.min.z<=o.min.z&&o.max.z<=this.max.z}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y),(o.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y||o.max.z<this.min.z||o.min.z>this.max.z)}intersectsSphere(o){return this.clampPoint(o.center,S0),S0.distanceToSquared(o.center)<=o.radius*o.radius}intersectsPlane(o){let g,$;return o.normal.x>0?(g=o.normal.x*this.min.x,$=o.normal.x*this.max.x):(g=o.normal.x*this.max.x,$=o.normal.x*this.min.x),o.normal.y>0?(g+=o.normal.y*this.min.y,$+=o.normal.y*this.max.y):(g+=o.normal.y*this.max.y,$+=o.normal.y*this.min.y),o.normal.z>0?(g+=o.normal.z*this.min.z,$+=o.normal.z*this.max.z):(g+=o.normal.z*this.max.z,$+=o.normal.z*this.min.z),g<=-o.constant&&$>=-o.constant}intersectsTriangle(o){if(this.isEmpty())return!1;this.getCenter(A_),Ey.subVectors(this.max,A_),$p.subVectors(o.a,A_),kv.subVectors(o.b,A_),$m.subVectors(o.c,A_),_f.subVectors(kv,$p),Lv.subVectors($m,kv),Ju.subVectors($p,$m);let g=[0,-_f.z,_f.y,0,-Lv.z,Lv.y,0,-Ju.z,Ju.y,_f.z,0,-_f.x,Lv.z,0,-Lv.x,Ju.z,0,-Ju.x,-_f.y,_f.x,0,-Lv.y,Lv.x,0,-Ju.y,Ju.x,0];return!!Sy(g,$p,kv,$m,Ey)&&(g=[1,0,0,0,1,0,0,0,1],!!Sy(g,$p,kv,$m,Ey)&&(C0.crossVectors(_f,Lv),g=[C0.x,C0.y,C0.z],Sy(g,$p,kv,$m,Ey)))}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return S0.copy(o).clamp(this.min,this.max).sub(o).length()}getBoundingSphere(o){return this.getCenter(o.center),o.radius=.5*this.getSize(S0).length(),o}intersect(o){return this.min.max(o.min),this.max.min(o.max),this.isEmpty()&&this.makeEmpty(),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}applyMatrix4(o){return this.isEmpty()||(Zm[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(o),Zm[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(o),Zm[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(o),Zm[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(o),Zm[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(o),Zm[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(o),Zm[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(o),Zm[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(o),this.setFromPoints(Zm)),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const Zm=[new dn,new dn,new dn,new dn,new dn,new dn,new dn,new dn],S0=new dn,by=new E0,$p=new dn,kv=new dn,$m=new dn,_f=new dn,Lv=new dn,Ju=new dn,A_=new dn,Ey=new dn,C0=new dn,Ov=new dn;function Sy(ut,o,g,$,_e){for(let rt=0,at=ut.length-3;rt<=at;rt+=3){Ov.fromArray(ut,rt);const ct=_e.x*Math.abs(Ov.x)+_e.y*Math.abs(Ov.y)+_e.z*Math.abs(Ov.z),ft=o.dot(Ov),mt=g.dot(Ov),bt=$.dot(Ov);if(Math.max(-Math.max(ft,mt,bt),Math.min(ft,mt,bt))>ct)return!1}return!0}const no=new E0,Uo=new dn,Ip=new dn,op=new dn;class Dp{constructor(o=new dn,g=-1){this.center=o,this.radius=g}set(o,g){return this.center.copy(o),this.radius=g,this}setFromPoints(o,g){const $=this.center;g!==void 0?$.copy(g):no.setFromPoints(o).getCenter($);let _e=0;for(let rt=0,at=o.length;rt<at;rt++)_e=Math.max(_e,$.distanceToSquared(o[rt]));return this.radius=Math.sqrt(_e),this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(o){return o.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(o){return o.distanceTo(this.center)-this.radius}intersectsSphere(o){const g=this.radius+o.radius;return o.center.distanceToSquared(this.center)<=g*g}intersectsBox(o){return o.intersectsSphere(this)}intersectsPlane(o){return Math.abs(o.distanceToPoint(this.center))<=this.radius}clampPoint(o,g){const $=this.center.distanceToSquared(o);return g.copy(o),$>this.radius*this.radius&&(g.sub(this.center).normalize(),g.multiplyScalar(this.radius).add(this.center)),g}getBoundingBox(o){return this.isEmpty()?(o.makeEmpty(),o):(o.set(this.center,this.center),o.expandByScalar(this.radius),o)}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}expandByPoint(o){op.subVectors(o,this.center);const g=op.lengthSq();if(g>this.radius*this.radius){const $=Math.sqrt(g),_e=.5*($-this.radius);this.center.add(op.multiplyScalar(_e/$)),this.radius+=_e}return this}union(o){return this.center.equals(o.center)===!0?Ip.set(0,0,1).multiplyScalar(o.radius):Ip.subVectors(o.center,this.center).normalize().multiplyScalar(o.radius),this.expandByPoint(Uo.copy(o.center).add(Ip)),this.expandByPoint(Uo.copy(o.center).sub(Ip)),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Nl=new dn,Cy=new dn,y_=new dn,wm=new dn,w_=new dn,bA=new dn,My=new dn;class Nv{constructor(o=new dn,g=new dn(0,0,-1)){this.origin=o,this.direction=g}set(o,g){return this.origin.copy(o),this.direction.copy(g),this}copy(o){return this.origin.copy(o.origin),this.direction.copy(o.direction),this}at(o,g){return g.copy(this.direction).multiplyScalar(o).add(this.origin)}lookAt(o){return this.direction.copy(o).sub(this.origin).normalize(),this}recast(o){return this.origin.copy(this.at(o,Nl)),this}closestPointToPoint(o,g){g.subVectors(o,this.origin);const $=g.dot(this.direction);return $<0?g.copy(this.origin):g.copy(this.direction).multiplyScalar($).add(this.origin)}distanceToPoint(o){return Math.sqrt(this.distanceSqToPoint(o))}distanceSqToPoint(o){const g=Nl.subVectors(o,this.origin).dot(this.direction);return g<0?this.origin.distanceToSquared(o):(Nl.copy(this.direction).multiplyScalar(g).add(this.origin),Nl.distanceToSquared(o))}distanceSqToSegment(o,g,$,_e){Cy.copy(o).add(g).multiplyScalar(.5),y_.copy(g).sub(o).normalize(),wm.copy(this.origin).sub(Cy);const rt=.5*o.distanceTo(g),at=-this.direction.dot(y_),ct=wm.dot(this.direction),ft=-wm.dot(y_),mt=wm.lengthSq(),bt=Math.abs(1-at*at);let Mt,St,It,Bt;if(bt>0)if(Mt=at*ft-ct,St=at*ct-ft,Bt=rt*bt,Mt>=0)if(St>=-Bt)if(St<=Bt){const Dt=1/bt;Mt*=Dt,St*=Dt,It=Mt*(Mt+at*St+2*ct)+St*(at*Mt+St+2*ft)+mt}else St=rt,Mt=Math.max(0,-(at*St+ct)),It=-Mt*Mt+St*(St+2*ft)+mt;else St=-rt,Mt=Math.max(0,-(at*St+ct)),It=-Mt*Mt+St*(St+2*ft)+mt;else St<=-Bt?(Mt=Math.max(0,-(-at*rt+ct)),St=Mt>0?-rt:Math.min(Math.max(-rt,-ft),rt),It=-Mt*Mt+St*(St+2*ft)+mt):St<=Bt?(Mt=0,St=Math.min(Math.max(-rt,-ft),rt),It=St*(St+2*ft)+mt):(Mt=Math.max(0,-(at*rt+ct)),St=Mt>0?rt:Math.min(Math.max(-rt,-ft),rt),It=-Mt*Mt+St*(St+2*ft)+mt);else St=at>0?-rt:rt,Mt=Math.max(0,-(at*St+ct)),It=-Mt*Mt+St*(St+2*ft)+mt;return $&&$.copy(this.direction).multiplyScalar(Mt).add(this.origin),_e&&_e.copy(y_).multiplyScalar(St).add(Cy),It}intersectSphere(o,g){Nl.subVectors(o.center,this.origin);const $=Nl.dot(this.direction),_e=Nl.dot(Nl)-$*$,rt=o.radius*o.radius;if(_e>rt)return null;const at=Math.sqrt(rt-_e),ct=$-at,ft=$+at;return ct<0&&ft<0?null:ct<0?this.at(ft,g):this.at(ct,g)}intersectsSphere(o){return this.distanceSqToPoint(o.center)<=o.radius*o.radius}distanceToPlane(o){const g=o.normal.dot(this.direction);if(g===0)return o.distanceToPoint(this.origin)===0?0:null;const $=-(this.origin.dot(o.normal)+o.constant)/g;return $>=0?$:null}intersectPlane(o,g){const $=this.distanceToPlane(o);return $===null?null:this.at($,g)}intersectsPlane(o){const g=o.distanceToPoint(this.origin);return g===0||o.normal.dot(this.direction)*g<0}intersectBox(o,g){let $,_e,rt,at,ct,ft;const mt=1/this.direction.x,bt=1/this.direction.y,Mt=1/this.direction.z,St=this.origin;return mt>=0?($=(o.min.x-St.x)*mt,_e=(o.max.x-St.x)*mt):($=(o.max.x-St.x)*mt,_e=(o.min.x-St.x)*mt),bt>=0?(rt=(o.min.y-St.y)*bt,at=(o.max.y-St.y)*bt):(rt=(o.max.y-St.y)*bt,at=(o.min.y-St.y)*bt),$>at||rt>_e?null:((rt>$||$!=$)&&($=rt),(at<_e||_e!=_e)&&(_e=at),Mt>=0?(ct=(o.min.z-St.z)*Mt,ft=(o.max.z-St.z)*Mt):(ct=(o.max.z-St.z)*Mt,ft=(o.min.z-St.z)*Mt),$>ft||ct>_e?null:((ct>$||$!=$)&&($=ct),(ft<_e||_e!=_e)&&(_e=ft),_e<0?null:this.at($>=0?$:_e,g)))}intersectsBox(o){return this.intersectBox(o,Nl)!==null}intersectTriangle(o,g,$,_e,rt){w_.subVectors(g,o),bA.subVectors($,o),My.crossVectors(w_,bA);let at,ct=this.direction.dot(My);if(ct>0){if(_e)return null;at=1}else{if(!(ct<0))return null;at=-1,ct=-ct}wm.subVectors(this.origin,o);const ft=at*this.direction.dot(bA.crossVectors(wm,bA));if(ft<0)return null;const mt=at*this.direction.dot(w_.cross(wm));if(mt<0||ft+mt>ct)return null;const bt=-at*wm.dot(My);return bt<0?null:this.at(bt/ct,rt)}applyMatrix4(o){return this.origin.applyMatrix4(o),this.direction.transformDirection(o),this}equals(o){return o.origin.equals(this.origin)&&o.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Is{constructor(){Is.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(o,g,$,_e,rt,at,ct,ft,mt,bt,Mt,St,It,Bt,Dt,Ut){const Ft=this.elements;return Ft[0]=o,Ft[4]=g,Ft[8]=$,Ft[12]=_e,Ft[1]=rt,Ft[5]=at,Ft[9]=ct,Ft[13]=ft,Ft[2]=mt,Ft[6]=bt,Ft[10]=Mt,Ft[14]=St,Ft[3]=It,Ft[7]=Bt,Ft[11]=Dt,Ft[15]=Ut,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Is().fromArray(this.elements)}copy(o){const g=this.elements,$=o.elements;return g[0]=$[0],g[1]=$[1],g[2]=$[2],g[3]=$[3],g[4]=$[4],g[5]=$[5],g[6]=$[6],g[7]=$[7],g[8]=$[8],g[9]=$[9],g[10]=$[10],g[11]=$[11],g[12]=$[12],g[13]=$[13],g[14]=$[14],g[15]=$[15],this}copyPosition(o){const g=this.elements,$=o.elements;return g[12]=$[12],g[13]=$[13],g[14]=$[14],this}setFromMatrix3(o){const g=o.elements;return this.set(g[0],g[3],g[6],0,g[1],g[4],g[7],0,g[2],g[5],g[8],0,0,0,0,1),this}extractBasis(o,g,$){return o.setFromMatrixColumn(this,0),g.setFromMatrixColumn(this,1),$.setFromMatrixColumn(this,2),this}makeBasis(o,g,$){return this.set(o.x,g.x,$.x,0,o.y,g.y,$.y,0,o.z,g.z,$.z,0,0,0,0,1),this}extractRotation(o){const g=this.elements,$=o.elements,_e=1/bo.setFromMatrixColumn(o,0).length(),rt=1/bo.setFromMatrixColumn(o,1).length(),at=1/bo.setFromMatrixColumn(o,2).length();return g[0]=$[0]*_e,g[1]=$[1]*_e,g[2]=$[2]*_e,g[3]=0,g[4]=$[4]*rt,g[5]=$[5]*rt,g[6]=$[6]*rt,g[7]=0,g[8]=$[8]*at,g[9]=$[9]*at,g[10]=$[10]*at,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromEuler(o){const g=this.elements,$=o.x,_e=o.y,rt=o.z,at=Math.cos($),ct=Math.sin($),ft=Math.cos(_e),mt=Math.sin(_e),bt=Math.cos(rt),Mt=Math.sin(rt);if(o.order==="XYZ"){const St=at*bt,It=at*Mt,Bt=ct*bt,Dt=ct*Mt;g[0]=ft*bt,g[4]=-ft*Mt,g[8]=mt,g[1]=It+Bt*mt,g[5]=St-Dt*mt,g[9]=-ct*ft,g[2]=Dt-St*mt,g[6]=Bt+It*mt,g[10]=at*ft}else if(o.order==="YXZ"){const St=ft*bt,It=ft*Mt,Bt=mt*bt,Dt=mt*Mt;g[0]=St+Dt*ct,g[4]=Bt*ct-It,g[8]=at*mt,g[1]=at*Mt,g[5]=at*bt,g[9]=-ct,g[2]=It*ct-Bt,g[6]=Dt+St*ct,g[10]=at*ft}else if(o.order==="ZXY"){const St=ft*bt,It=ft*Mt,Bt=mt*bt,Dt=mt*Mt;g[0]=St-Dt*ct,g[4]=-at*Mt,g[8]=Bt+It*ct,g[1]=It+Bt*ct,g[5]=at*bt,g[9]=Dt-St*ct,g[2]=-at*mt,g[6]=ct,g[10]=at*ft}else if(o.order==="ZYX"){const St=at*bt,It=at*Mt,Bt=ct*bt,Dt=ct*Mt;g[0]=ft*bt,g[4]=Bt*mt-It,g[8]=St*mt+Dt,g[1]=ft*Mt,g[5]=Dt*mt+St,g[9]=It*mt-Bt,g[2]=-mt,g[6]=ct*ft,g[10]=at*ft}else if(o.order==="YZX"){const St=at*ft,It=at*mt,Bt=ct*ft,Dt=ct*mt;g[0]=ft*bt,g[4]=Dt-St*Mt,g[8]=Bt*Mt+It,g[1]=Mt,g[5]=at*bt,g[9]=-ct*bt,g[2]=-mt*bt,g[6]=It*Mt+Bt,g[10]=St-Dt*Mt}else if(o.order==="XZY"){const St=at*ft,It=at*mt,Bt=ct*ft,Dt=ct*mt;g[0]=ft*bt,g[4]=-Mt,g[8]=mt*bt,g[1]=St*Mt+Dt,g[5]=at*bt,g[9]=It*Mt-Bt,g[2]=Bt*Mt-It,g[6]=ct*bt,g[10]=Dt*Mt+St}return g[3]=0,g[7]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,this}makeRotationFromQuaternion(o){return this.compose(Pp,o,_g)}lookAt(o,g,$){const _e=this.elements;return Zu.subVectors(o,g),Zu.lengthSq()===0&&(Zu.z=1),Zu.normalize(),Xl.crossVectors($,Zu),Xl.lengthSq()===0&&(Math.abs($.z)===1?Zu.x+=1e-4:Zu.z+=1e-4,Zu.normalize(),Xl.crossVectors($,Zu)),Xl.normalize(),x_.crossVectors(Zu,Xl),_e[0]=Xl.x,_e[4]=x_.x,_e[8]=Zu.x,_e[1]=Xl.y,_e[5]=x_.y,_e[9]=Zu.y,_e[2]=Xl.z,_e[6]=x_.z,_e[10]=Zu.z,this}multiply(o){return this.multiplyMatrices(this,o)}premultiply(o){return this.multiplyMatrices(o,this)}multiplyMatrices(o,g){const $=o.elements,_e=g.elements,rt=this.elements,at=$[0],ct=$[4],ft=$[8],mt=$[12],bt=$[1],Mt=$[5],St=$[9],It=$[13],Bt=$[2],Dt=$[6],Ut=$[10],Ft=$[14],zt=$[3],Kt=$[7],tn=$[11],sn=$[15],ln=_e[0],kn=_e[4],Ln=_e[8],qn=_e[12],Kn=_e[1],Un=_e[5],vr=_e[9],Pr=_e[13],mr=_e[2],Qr=_e[6],Gr=_e[10],lr=_e[14],dr=_e[3],Or=_e[7],_r=_e[11],Vr=_e[15];return rt[0]=at*ln+ct*Kn+ft*mr+mt*dr,rt[4]=at*kn+ct*Un+ft*Qr+mt*Or,rt[8]=at*Ln+ct*vr+ft*Gr+mt*_r,rt[12]=at*qn+ct*Pr+ft*lr+mt*Vr,rt[1]=bt*ln+Mt*Kn+St*mr+It*dr,rt[5]=bt*kn+Mt*Un+St*Qr+It*Or,rt[9]=bt*Ln+Mt*vr+St*Gr+It*_r,rt[13]=bt*qn+Mt*Pr+St*lr+It*Vr,rt[2]=Bt*ln+Dt*Kn+Ut*mr+Ft*dr,rt[6]=Bt*kn+Dt*Un+Ut*Qr+Ft*Or,rt[10]=Bt*Ln+Dt*vr+Ut*Gr+Ft*_r,rt[14]=Bt*qn+Dt*Pr+Ut*lr+Ft*Vr,rt[3]=zt*ln+Kt*Kn+tn*mr+sn*dr,rt[7]=zt*kn+Kt*Un+tn*Qr+sn*Or,rt[11]=zt*Ln+Kt*vr+tn*Gr+sn*_r,rt[15]=zt*qn+Kt*Pr+tn*lr+sn*Vr,this}multiplyScalar(o){const g=this.elements;return g[0]*=o,g[4]*=o,g[8]*=o,g[12]*=o,g[1]*=o,g[5]*=o,g[9]*=o,g[13]*=o,g[2]*=o,g[6]*=o,g[10]*=o,g[14]*=o,g[3]*=o,g[7]*=o,g[11]*=o,g[15]*=o,this}determinant(){const o=this.elements,g=o[0],$=o[4],_e=o[8],rt=o[12],at=o[1],ct=o[5],ft=o[9],mt=o[13],bt=o[2],Mt=o[6],St=o[10],It=o[14];return o[3]*(+rt*ft*Mt-_e*mt*Mt-rt*ct*St+$*mt*St+_e*ct*It-$*ft*It)+o[7]*(+g*ft*It-g*mt*St+rt*at*St-_e*at*It+_e*mt*bt-rt*ft*bt)+o[11]*(+g*mt*Mt-g*ct*It-rt*at*Mt+$*at*It+rt*ct*bt-$*mt*bt)+o[15]*(-_e*ct*bt-g*ft*Mt+g*ct*St+_e*at*Mt-$*at*St+$*ft*bt)}transpose(){const o=this.elements;let g;return g=o[1],o[1]=o[4],o[4]=g,g=o[2],o[2]=o[8],o[8]=g,g=o[6],o[6]=o[9],o[9]=g,g=o[3],o[3]=o[12],o[12]=g,g=o[7],o[7]=o[13],o[13]=g,g=o[11],o[11]=o[14],o[14]=g,this}setPosition(o,g,$){const _e=this.elements;return o.isVector3?(_e[12]=o.x,_e[13]=o.y,_e[14]=o.z):(_e[12]=o,_e[13]=g,_e[14]=$),this}invert(){const o=this.elements,g=o[0],$=o[1],_e=o[2],rt=o[3],at=o[4],ct=o[5],ft=o[6],mt=o[7],bt=o[8],Mt=o[9],St=o[10],It=o[11],Bt=o[12],Dt=o[13],Ut=o[14],Ft=o[15],zt=Mt*Ut*mt-Dt*St*mt+Dt*ft*It-ct*Ut*It-Mt*ft*Ft+ct*St*Ft,Kt=Bt*St*mt-bt*Ut*mt-Bt*ft*It+at*Ut*It+bt*ft*Ft-at*St*Ft,tn=bt*Dt*mt-Bt*Mt*mt+Bt*ct*It-at*Dt*It-bt*ct*Ft+at*Mt*Ft,sn=Bt*Mt*ft-bt*Dt*ft-Bt*ct*St+at*Dt*St+bt*ct*Ut-at*Mt*Ut,ln=g*zt+$*Kt+_e*tn+rt*sn;if(ln===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const kn=1/ln;return o[0]=zt*kn,o[1]=(Dt*St*rt-Mt*Ut*rt-Dt*_e*It+$*Ut*It+Mt*_e*Ft-$*St*Ft)*kn,o[2]=(ct*Ut*rt-Dt*ft*rt+Dt*_e*mt-$*Ut*mt-ct*_e*Ft+$*ft*Ft)*kn,o[3]=(Mt*ft*rt-ct*St*rt-Mt*_e*mt+$*St*mt+ct*_e*It-$*ft*It)*kn,o[4]=Kt*kn,o[5]=(bt*Ut*rt-Bt*St*rt+Bt*_e*It-g*Ut*It-bt*_e*Ft+g*St*Ft)*kn,o[6]=(Bt*ft*rt-at*Ut*rt-Bt*_e*mt+g*Ut*mt+at*_e*Ft-g*ft*Ft)*kn,o[7]=(at*St*rt-bt*ft*rt+bt*_e*mt-g*St*mt-at*_e*It+g*ft*It)*kn,o[8]=tn*kn,o[9]=(Bt*Mt*rt-bt*Dt*rt-Bt*$*It+g*Dt*It+bt*$*Ft-g*Mt*Ft)*kn,o[10]=(at*Dt*rt-Bt*ct*rt+Bt*$*mt-g*Dt*mt-at*$*Ft+g*ct*Ft)*kn,o[11]=(bt*ct*rt-at*Mt*rt-bt*$*mt+g*Mt*mt+at*$*It-g*ct*It)*kn,o[12]=sn*kn,o[13]=(bt*Dt*_e-Bt*Mt*_e+Bt*$*St-g*Dt*St-bt*$*Ut+g*Mt*Ut)*kn,o[14]=(Bt*ct*_e-at*Dt*_e-Bt*$*ft+g*Dt*ft+at*$*Ut-g*ct*Ut)*kn,o[15]=(at*Mt*_e-bt*ct*_e+bt*$*ft-g*Mt*ft-at*$*St+g*ct*St)*kn,this}scale(o){const g=this.elements,$=o.x,_e=o.y,rt=o.z;return g[0]*=$,g[4]*=_e,g[8]*=rt,g[1]*=$,g[5]*=_e,g[9]*=rt,g[2]*=$,g[6]*=_e,g[10]*=rt,g[3]*=$,g[7]*=_e,g[11]*=rt,this}getMaxScaleOnAxis(){const o=this.elements,g=o[0]*o[0]+o[1]*o[1]+o[2]*o[2],$=o[4]*o[4]+o[5]*o[5]+o[6]*o[6],_e=o[8]*o[8]+o[9]*o[9]+o[10]*o[10];return Math.sqrt(Math.max(g,$,_e))}makeTranslation(o,g,$){return this.set(1,0,0,o,0,1,0,g,0,0,1,$,0,0,0,1),this}makeRotationX(o){const g=Math.cos(o),$=Math.sin(o);return this.set(1,0,0,0,0,g,-$,0,0,$,g,0,0,0,0,1),this}makeRotationY(o){const g=Math.cos(o),$=Math.sin(o);return this.set(g,0,$,0,0,1,0,0,-$,0,g,0,0,0,0,1),this}makeRotationZ(o){const g=Math.cos(o),$=Math.sin(o);return this.set(g,-$,0,0,$,g,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(o,g){const $=Math.cos(g),_e=Math.sin(g),rt=1-$,at=o.x,ct=o.y,ft=o.z,mt=rt*at,bt=rt*ct;return this.set(mt*at+$,mt*ct-_e*ft,mt*ft+_e*ct,0,mt*ct+_e*ft,bt*ct+$,bt*ft-_e*at,0,mt*ft-_e*ct,bt*ft+_e*at,rt*ft*ft+$,0,0,0,0,1),this}makeScale(o,g,$){return this.set(o,0,0,0,0,g,0,0,0,0,$,0,0,0,0,1),this}makeShear(o,g,$,_e,rt,at){return this.set(1,$,rt,0,o,1,at,0,g,_e,1,0,0,0,0,1),this}compose(o,g,$){const _e=this.elements,rt=g._x,at=g._y,ct=g._z,ft=g._w,mt=rt+rt,bt=at+at,Mt=ct+ct,St=rt*mt,It=rt*bt,Bt=rt*Mt,Dt=at*bt,Ut=at*Mt,Ft=ct*Mt,zt=ft*mt,Kt=ft*bt,tn=ft*Mt,sn=$.x,ln=$.y,kn=$.z;return _e[0]=(1-(Dt+Ft))*sn,_e[1]=(It+tn)*sn,_e[2]=(Bt-Kt)*sn,_e[3]=0,_e[4]=(It-tn)*ln,_e[5]=(1-(St+Ft))*ln,_e[6]=(Ut+zt)*ln,_e[7]=0,_e[8]=(Bt+Kt)*kn,_e[9]=(Ut-zt)*kn,_e[10]=(1-(St+Dt))*kn,_e[11]=0,_e[12]=o.x,_e[13]=o.y,_e[14]=o.z,_e[15]=1,this}decompose(o,g,$){const _e=this.elements;let rt=bo.set(_e[0],_e[1],_e[2]).length();const at=bo.set(_e[4],_e[5],_e[6]).length(),ct=bo.set(_e[8],_e[9],_e[10]).length();this.determinant()<0&&(rt=-rt),o.x=_e[12],o.y=_e[13],o.z=_e[14],Yl.copy(this);const ft=1/rt,mt=1/at,bt=1/ct;return Yl.elements[0]*=ft,Yl.elements[1]*=ft,Yl.elements[2]*=ft,Yl.elements[4]*=mt,Yl.elements[5]*=mt,Yl.elements[6]*=mt,Yl.elements[8]*=bt,Yl.elements[9]*=bt,Yl.elements[10]*=bt,g.setFromRotationMatrix(Yl),$.x=rt,$.y=at,$.z=ct,this}makePerspective(o,g,$,_e,rt,at){const ct=this.elements,ft=2*rt/(g-o),mt=2*rt/($-_e),bt=(g+o)/(g-o),Mt=($+_e)/($-_e),St=-(at+rt)/(at-rt),It=-2*at*rt/(at-rt);return ct[0]=ft,ct[4]=0,ct[8]=bt,ct[12]=0,ct[1]=0,ct[5]=mt,ct[9]=Mt,ct[13]=0,ct[2]=0,ct[6]=0,ct[10]=St,ct[14]=It,ct[3]=0,ct[7]=0,ct[11]=-1,ct[15]=0,this}makeOrthographic(o,g,$,_e,rt,at){const ct=this.elements,ft=1/(g-o),mt=1/($-_e),bt=1/(at-rt),Mt=(g+o)*ft,St=($+_e)*mt,It=(at+rt)*bt;return ct[0]=2*ft,ct[4]=0,ct[8]=0,ct[12]=-Mt,ct[1]=0,ct[5]=2*mt,ct[9]=0,ct[13]=-St,ct[2]=0,ct[6]=0,ct[10]=-2*bt,ct[14]=-It,ct[3]=0,ct[7]=0,ct[11]=0,ct[15]=1,this}equals(o){const g=this.elements,$=o.elements;for(let _e=0;_e<16;_e++)if(g[_e]!==$[_e])return!1;return!0}fromArray(o,g=0){for(let $=0;$<16;$++)this.elements[$]=o[$+g];return this}toArray(o=[],g=0){const $=this.elements;return o[g]=$[0],o[g+1]=$[1],o[g+2]=$[2],o[g+3]=$[3],o[g+4]=$[4],o[g+5]=$[5],o[g+6]=$[6],o[g+7]=$[7],o[g+8]=$[8],o[g+9]=$[9],o[g+10]=$[10],o[g+11]=$[11],o[g+12]=$[12],o[g+13]=$[13],o[g+14]=$[14],o[g+15]=$[15],o}}const bo=new dn,Yl=new Is,Pp=new dn(0,0,0),_g=new dn(1,1,1),Xl=new dn,x_=new dn,Zu=new dn,kw=new Is,EA=new su;class em{constructor(o=0,g=0,$=0,_e=em.DefaultOrder){this.isEuler=!0,this._x=o,this._y=g,this._z=$,this._order=_e}get x(){return this._x}set x(o){this._x=o,this._onChangeCallback()}get y(){return this._y}set y(o){this._y=o,this._onChangeCallback()}get z(){return this._z}set z(o){this._z=o,this._onChangeCallback()}get order(){return this._order}set order(o){this._order=o,this._onChangeCallback()}set(o,g,$,_e=this._order){return this._x=o,this._y=g,this._z=$,this._order=_e,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(o){return this._x=o._x,this._y=o._y,this._z=o._z,this._order=o._order,this._onChangeCallback(),this}setFromRotationMatrix(o,g=this._order,$=!0){const _e=o.elements,rt=_e[0],at=_e[4],ct=_e[8],ft=_e[1],mt=_e[5],bt=_e[9],Mt=_e[2],St=_e[6],It=_e[10];switch(g){case"XYZ":this._y=Math.asin(ys(ct,-1,1)),Math.abs(ct)<.9999999?(this._x=Math.atan2(-bt,It),this._z=Math.atan2(-at,rt)):(this._x=Math.atan2(St,mt),this._z=0);break;case"YXZ":this._x=Math.asin(-ys(bt,-1,1)),Math.abs(bt)<.9999999?(this._y=Math.atan2(ct,It),this._z=Math.atan2(ft,mt)):(this._y=Math.atan2(-Mt,rt),this._z=0);break;case"ZXY":this._x=Math.asin(ys(St,-1,1)),Math.abs(St)<.9999999?(this._y=Math.atan2(-Mt,It),this._z=Math.atan2(-at,mt)):(this._y=0,this._z=Math.atan2(ft,rt));break;case"ZYX":this._y=Math.asin(-ys(Mt,-1,1)),Math.abs(Mt)<.9999999?(this._x=Math.atan2(St,It),this._z=Math.atan2(ft,rt)):(this._x=0,this._z=Math.atan2(-at,mt));break;case"YZX":this._z=Math.asin(ys(ft,-1,1)),Math.abs(ft)<.9999999?(this._x=Math.atan2(-bt,mt),this._y=Math.atan2(-Mt,rt)):(this._x=0,this._y=Math.atan2(ct,It));break;case"XZY":this._z=Math.asin(-ys(at,-1,1)),Math.abs(at)<.9999999?(this._x=Math.atan2(St,mt),this._y=Math.atan2(ct,rt)):(this._x=Math.atan2(-bt,It),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+g)}return this._order=g,$===!0&&this._onChangeCallback(),this}setFromQuaternion(o,g,$){return kw.makeRotationFromQuaternion(o),this.setFromRotationMatrix(kw,g,$)}setFromVector3(o,g=this._order){return this.set(o.x,o.y,o.z,g)}reorder(o){return EA.setFromEuler(this),this.setFromQuaternion(EA,o)}equals(o){return o._x===this._x&&o._y===this._y&&o._z===this._z&&o._order===this._order}fromArray(o){return this._x=o[0],this._y=o[1],this._z=o[2],o[3]!==void 0&&(this._order=o[3]),this._onChangeCallback(),this}toArray(o=[],g=0){return o[g]=this._x,o[g+1]=this._y,o[g+2]=this._z,o[g+3]=this._order,o}_onChange(o){return this._onChangeCallback=o,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}em.DefaultOrder="XYZ",em.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class ku{constructor(){this.mask=1}set(o){this.mask=(1<<o|0)>>>0}enable(o){this.mask|=1<<o|0}enableAll(){this.mask=-1}toggle(o){this.mask^=1<<o|0}disable(o){this.mask&=~(1<<o|0)}disableAll(){this.mask=0}test(o){return(this.mask&o.mask)!=0}isEnabled(o){return(this.mask&(1<<o|0))!=0}}let ev=0;const M0=new dn,ou=new su,ap=new Is,bu=new dn,xm=new dn,Ty=new dn,Uv=new su,SA=new dn(1,0,0),T0=new dn(0,1,0),Fv=new dn(0,0,1),Iy={type:"added"},Lw={type:"removed"};class Fs extends Ts{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ev++}),this.uuid=wu(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Fs.DefaultUp.clone();const o=new dn,g=new em,$=new su,_e=new dn(1,1,1);g._onChange(function(){$.setFromEuler(g,!1)}),$._onChange(function(){g.setFromQuaternion($,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:o},rotation:{configurable:!0,enumerable:!0,value:g},quaternion:{configurable:!0,enumerable:!0,value:$},scale:{configurable:!0,enumerable:!0,value:_e},modelViewMatrix:{value:new Is},normalMatrix:{value:new ru}}),this.matrix=new Is,this.matrixWorld=new Is,this.matrixAutoUpdate=Fs.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Fs.DefaultMatrixWorldAutoUpdate,this.layers=new ku,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(o,g,$,_e,rt,at){this.dispatchEvent({type:"beforeRender",renderer:o,scene:g,camera:$,geometry:_e,material:rt,group:at})}onAfterRender(){}applyMatrix4(o){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(o),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(o){return this.quaternion.premultiply(o),this}setRotationFromAxisAngle(o,g){this.quaternion.setFromAxisAngle(o,g)}setRotationFromEuler(o){this.quaternion.setFromEuler(o,!0)}setRotationFromMatrix(o){this.quaternion.setFromRotationMatrix(o)}setRotationFromQuaternion(o){this.quaternion.copy(o)}rotateOnAxis(o,g){return ou.setFromAxisAngle(o,g),this.quaternion.multiply(ou),this}rotateOnWorldAxis(o,g){return ou.setFromAxisAngle(o,g),this.quaternion.premultiply(ou),this}rotateX(o){return this.rotateOnAxis(SA,o)}rotateY(o){return this.rotateOnAxis(T0,o)}rotateZ(o){return this.rotateOnAxis(Fv,o)}translateOnAxis(o,g){return M0.copy(o).applyQuaternion(this.quaternion),this.position.add(M0.multiplyScalar(g)),this}translateX(o){return this.translateOnAxis(SA,o)}translateY(o){return this.translateOnAxis(T0,o)}translateZ(o){return this.translateOnAxis(Fv,o)}localToWorld(o){return o.applyMatrix4(this.matrixWorld)}worldToLocal(o){return o.applyMatrix4(ap.copy(this.matrixWorld).invert())}lookAt(o,g,$){o.isVector3?bu.copy(o):bu.set(o,g,$);const _e=this.parent;this.updateWorldMatrix(!0,!1),xm.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ap.lookAt(xm,bu,this.up):ap.lookAt(bu,xm,this.up),this.quaternion.setFromRotationMatrix(ap),_e&&(ap.extractRotation(_e.matrixWorld),ou.setFromRotationMatrix(ap),this.quaternion.premultiply(ou.invert()))}add(o){if(arguments.length>1){for(let g=0;g<arguments.length;g++)this.add(arguments[g]);return this}return o===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",o),this):(o&&o.isObject3D?(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o),o.dispatchEvent(Iy)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",o),this)}remove(o){if(arguments.length>1){for(let $=0;$<arguments.length;$++)this.remove(arguments[$]);return this}const g=this.children.indexOf(o);return g!==-1&&(o.parent=null,this.children.splice(g,1),o.dispatchEvent(Lw)),this}removeFromParent(){const o=this.parent;return o!==null&&o.remove(this),this}clear(){for(let o=0;o<this.children.length;o++){const g=this.children[o];g.parent=null,g.dispatchEvent(Lw)}return this.children.length=0,this}attach(o){return this.updateWorldMatrix(!0,!1),ap.copy(this.matrixWorld).invert(),o.parent!==null&&(o.parent.updateWorldMatrix(!0,!1),ap.multiply(o.parent.matrixWorld)),o.applyMatrix4(ap),this.add(o),o.updateWorldMatrix(!1,!0),this}getObjectById(o){return this.getObjectByProperty("id",o)}getObjectByName(o){return this.getObjectByProperty("name",o)}getObjectByProperty(o,g){if(this[o]===g)return this;for(let $=0,_e=this.children.length;$<_e;$++){const rt=this.children[$].getObjectByProperty(o,g);if(rt!==void 0)return rt}}getWorldPosition(o){return this.updateWorldMatrix(!0,!1),o.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xm,o,Ty),o}getWorldScale(o){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xm,Uv,o),o}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(g[8],g[9],g[10]).normalize()}raycast(){}traverse(o){o(this);const g=this.children;for(let $=0,_e=g.length;$<_e;$++)g[$].traverse(o)}traverseVisible(o){if(this.visible===!1)return;o(this);const g=this.children;for(let $=0,_e=g.length;$<_e;$++)g[$].traverseVisible(o)}traverseAncestors(o){const g=this.parent;g!==null&&(o(g),g.traverseAncestors(o))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(o){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||o)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,o=!0);const g=this.children;for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];rt.matrixWorldAutoUpdate!==!0&&o!==!0||rt.updateMatrixWorld(o)}}updateWorldMatrix(o,g){const $=this.parent;if(o===!0&&$!==null&&$.matrixWorldAutoUpdate===!0&&$.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),g===!0){const _e=this.children;for(let rt=0,at=_e.length;rt<at;rt++){const ct=_e[rt];ct.matrixWorldAutoUpdate===!0&&ct.updateWorldMatrix(!1,!0)}}}toJSON(o){const g=o===void 0||typeof o=="string",$={};g&&(o={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},$.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const _e={};function rt(ct,ft){return ct[ft.uuid]===void 0&&(ct[ft.uuid]=ft.toJSON(o)),ft.uuid}if(_e.uuid=this.uuid,_e.type=this.type,this.name!==""&&(_e.name=this.name),this.castShadow===!0&&(_e.castShadow=!0),this.receiveShadow===!0&&(_e.receiveShadow=!0),this.visible===!1&&(_e.visible=!1),this.frustumCulled===!1&&(_e.frustumCulled=!1),this.renderOrder!==0&&(_e.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(_e.userData=this.userData),_e.layers=this.layers.mask,_e.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(_e.matrixAutoUpdate=!1),this.isInstancedMesh&&(_e.type="InstancedMesh",_e.count=this.count,_e.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(_e.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?_e.background=this.background.toJSON():this.background.isTexture&&(_e.background=this.background.toJSON(o).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(_e.environment=this.environment.toJSON(o).uuid);else if(this.isMesh||this.isLine||this.isPoints){_e.geometry=rt(o.geometries,this.geometry);const ct=this.geometry.parameters;if(ct!==void 0&&ct.shapes!==void 0){const ft=ct.shapes;if(Array.isArray(ft))for(let mt=0,bt=ft.length;mt<bt;mt++){const Mt=ft[mt];rt(o.shapes,Mt)}else rt(o.shapes,ft)}}if(this.isSkinnedMesh&&(_e.bindMode=this.bindMode,_e.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(rt(o.skeletons,this.skeleton),_e.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const ct=[];for(let ft=0,mt=this.material.length;ft<mt;ft++)ct.push(rt(o.materials,this.material[ft]));_e.material=ct}else _e.material=rt(o.materials,this.material);if(this.children.length>0){_e.children=[];for(let ct=0;ct<this.children.length;ct++)_e.children.push(this.children[ct].toJSON(o).object)}if(this.animations.length>0){_e.animations=[];for(let ct=0;ct<this.animations.length;ct++){const ft=this.animations[ct];_e.animations.push(rt(o.animations,ft))}}if(g){const ct=at(o.geometries),ft=at(o.materials),mt=at(o.textures),bt=at(o.images),Mt=at(o.shapes),St=at(o.skeletons),It=at(o.animations),Bt=at(o.nodes);ct.length>0&&($.geometries=ct),ft.length>0&&($.materials=ft),mt.length>0&&($.textures=mt),bt.length>0&&($.images=bt),Mt.length>0&&($.shapes=Mt),St.length>0&&($.skeletons=St),It.length>0&&($.animations=It),Bt.length>0&&($.nodes=Bt)}return $.object=_e,$;function at(ct){const ft=[];for(const mt in ct){const bt=ct[mt];delete bt.metadata,ft.push(bt)}return ft}}clone(o){return new this.constructor().copy(this,o)}copy(o,g=!0){this.name=o.name,this.up.copy(o.up),this.position.copy(o.position),this.rotation.order=o.rotation.order,this.quaternion.copy(o.quaternion),this.scale.copy(o.scale),this.matrix.copy(o.matrix),this.matrixWorld.copy(o.matrixWorld),this.matrixAutoUpdate=o.matrixAutoUpdate,this.matrixWorldNeedsUpdate=o.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=o.matrixWorldAutoUpdate,this.layers.mask=o.layers.mask,this.visible=o.visible,this.castShadow=o.castShadow,this.receiveShadow=o.receiveShadow,this.frustumCulled=o.frustumCulled,this.renderOrder=o.renderOrder,this.userData={};for(const[$,_e]of Object.entries(o.userData))this.userData[$]=!_e||_e&&(_e.isTexture||_e.isObject3D)?_e:JSON.parse(JSON.stringify(_e));if(g===!0)for(let $=0;$<o.children.length;$++){const _e=o.children[$];this.add(_e.clone())}return this}}Fs.DefaultUp=new dn(0,1,0),Fs.DefaultMatrixAutoUpdate=!0,Fs.DefaultMatrixWorldAutoUpdate=!0;const Rp=new dn,bm=new dn,Lu=new dn,tm=new dn,Bp=new dn,kp=new dn,Dy=new dn,b_=new dn,Py=new dn,jv=new dn;class au{constructor(o=new dn,g=new dn,$=new dn){this.a=o,this.b=g,this.c=$}static getNormal(o,g,$,_e){_e.subVectors($,g),Rp.subVectors(o,g),_e.cross(Rp);const rt=_e.lengthSq();return rt>0?_e.multiplyScalar(1/Math.sqrt(rt)):_e.set(0,0,0)}static getBarycoord(o,g,$,_e,rt){Rp.subVectors(_e,g),bm.subVectors($,g),Lu.subVectors(o,g);const at=Rp.dot(Rp),ct=Rp.dot(bm),ft=Rp.dot(Lu),mt=bm.dot(bm),bt=bm.dot(Lu),Mt=at*mt-ct*ct;if(Mt===0)return rt.set(-2,-1,-1);const St=1/Mt,It=(mt*ft-ct*bt)*St,Bt=(at*bt-ct*ft)*St;return rt.set(1-It-Bt,Bt,It)}static containsPoint(o,g,$,_e){return this.getBarycoord(o,g,$,_e,tm),tm.x>=0&&tm.y>=0&&tm.x+tm.y<=1}static getUV(o,g,$,_e,rt,at,ct,ft){return this.getBarycoord(o,g,$,_e,tm),ft.set(0,0),ft.addScaledVector(rt,tm.x),ft.addScaledVector(at,tm.y),ft.addScaledVector(ct,tm.z),ft}static isFrontFacing(o,g,$,_e){return Rp.subVectors($,g),bm.subVectors(o,g),Rp.cross(bm).dot(_e)<0}set(o,g,$){return this.a.copy(o),this.b.copy(g),this.c.copy($),this}setFromPointsAndIndices(o,g,$,_e){return this.a.copy(o[g]),this.b.copy(o[$]),this.c.copy(o[_e]),this}setFromAttributeAndIndices(o,g,$,_e){return this.a.fromBufferAttribute(o,g),this.b.fromBufferAttribute(o,$),this.c.fromBufferAttribute(o,_e),this}clone(){return new this.constructor().copy(this)}copy(o){return this.a.copy(o.a),this.b.copy(o.b),this.c.copy(o.c),this}getArea(){return Rp.subVectors(this.c,this.b),bm.subVectors(this.a,this.b),.5*Rp.cross(bm).length()}getMidpoint(o){return o.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(o){return au.getNormal(this.a,this.b,this.c,o)}getPlane(o){return o.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(o,g){return au.getBarycoord(o,this.a,this.b,this.c,g)}getUV(o,g,$,_e,rt){return au.getUV(o,this.a,this.b,this.c,g,$,_e,rt)}containsPoint(o){return au.containsPoint(o,this.a,this.b,this.c)}isFrontFacing(o){return au.isFrontFacing(this.a,this.b,this.c,o)}intersectsBox(o){return o.intersectsTriangle(this)}closestPointToPoint(o,g){const $=this.a,_e=this.b,rt=this.c;let at,ct;Bp.subVectors(_e,$),kp.subVectors(rt,$),b_.subVectors(o,$);const ft=Bp.dot(b_),mt=kp.dot(b_);if(ft<=0&&mt<=0)return g.copy($);Py.subVectors(o,_e);const bt=Bp.dot(Py),Mt=kp.dot(Py);if(bt>=0&&Mt<=bt)return g.copy(_e);const St=ft*Mt-bt*mt;if(St<=0&&ft>=0&&bt<=0)return at=ft/(ft-bt),g.copy($).addScaledVector(Bp,at);jv.subVectors(o,rt);const It=Bp.dot(jv),Bt=kp.dot(jv);if(Bt>=0&&It<=Bt)return g.copy(rt);const Dt=It*mt-ft*Bt;if(Dt<=0&&mt>=0&&Bt<=0)return ct=mt/(mt-Bt),g.copy($).addScaledVector(kp,ct);const Ut=bt*Bt-It*Mt;if(Ut<=0&&Mt-bt>=0&&It-Bt>=0)return Dy.subVectors(rt,_e),ct=(Mt-bt)/(Mt-bt+(It-Bt)),g.copy(_e).addScaledVector(Dy,ct);const Ft=1/(Ut+Dt+St);return at=Dt*Ft,ct=St*Ft,g.copy($).addScaledVector(Bp,at).addScaledVector(kp,ct)}equals(o){return o.a.equals(this.a)&&o.b.equals(this.b)&&o.c.equals(this.c)}}let b1=0;class lu extends Ts{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:b1++}),this.uuid=wu(),this.name="",this.type="Material",this.blending=jt,this.side=_n,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=Ar,this.blendDst=Hr,this.blendEquation=Qt,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=rn,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Am,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=_o,this.stencilZFail=_o,this.stencilZPass=_o,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(o){this._alphaTest>0!=o>0&&this.version++,this._alphaTest=o}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(o){if(o!==void 0)for(const g in o){const $=o[g];if($===void 0){console.warn("THREE.Material: '"+g+"' parameter is undefined.");continue}const _e=this[g];_e!==void 0&&(_e&&_e.isColor?_e.set($):_e&&_e.isVector3&&$&&$.isVector3?_e.copy($):this[g]=$)}}toJSON(o){const g=o===void 0||typeof o=="string";g&&(o={textures:{},images:{}});const $={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function _e(rt){const at=[];for(const ct in rt){const ft=rt[ct];delete ft.metadata,at.push(ft)}return at}if($.uuid=this.uuid,$.type=this.type,this.name!==""&&($.name=this.name),this.color&&this.color.isColor&&($.color=this.color.getHex()),this.roughness!==void 0&&($.roughness=this.roughness),this.metalness!==void 0&&($.metalness=this.metalness),this.sheen!==void 0&&($.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&($.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&($.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&($.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&($.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&($.specular=this.specular.getHex()),this.specularIntensity!==void 0&&($.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&($.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&($.shininess=this.shininess),this.clearcoat!==void 0&&($.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&($.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&($.clearcoatMap=this.clearcoatMap.toJSON(o).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&($.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(o).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&($.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(o).uuid,$.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&($.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&($.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&($.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&($.iridescenceMap=this.iridescenceMap.toJSON(o).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&($.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(o).uuid),this.map&&this.map.isTexture&&($.map=this.map.toJSON(o).uuid),this.matcap&&this.matcap.isTexture&&($.matcap=this.matcap.toJSON(o).uuid),this.alphaMap&&this.alphaMap.isTexture&&($.alphaMap=this.alphaMap.toJSON(o).uuid),this.lightMap&&this.lightMap.isTexture&&($.lightMap=this.lightMap.toJSON(o).uuid,$.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&($.aoMap=this.aoMap.toJSON(o).uuid,$.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&($.bumpMap=this.bumpMap.toJSON(o).uuid,$.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&($.normalMap=this.normalMap.toJSON(o).uuid,$.normalMapType=this.normalMapType,$.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&($.displacementMap=this.displacementMap.toJSON(o).uuid,$.displacementScale=this.displacementScale,$.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&($.roughnessMap=this.roughnessMap.toJSON(o).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&($.metalnessMap=this.metalnessMap.toJSON(o).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&($.emissiveMap=this.emissiveMap.toJSON(o).uuid),this.specularMap&&this.specularMap.isTexture&&($.specularMap=this.specularMap.toJSON(o).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&($.specularIntensityMap=this.specularIntensityMap.toJSON(o).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&($.specularColorMap=this.specularColorMap.toJSON(o).uuid),this.envMap&&this.envMap.isTexture&&($.envMap=this.envMap.toJSON(o).uuid,this.combine!==void 0&&($.combine=this.combine)),this.envMapIntensity!==void 0&&($.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&($.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&($.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&($.gradientMap=this.gradientMap.toJSON(o).uuid),this.transmission!==void 0&&($.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&($.transmissionMap=this.transmissionMap.toJSON(o).uuid),this.thickness!==void 0&&($.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&($.thicknessMap=this.thicknessMap.toJSON(o).uuid),this.attenuationDistance!==void 0&&($.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&($.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&($.size=this.size),this.shadowSide!==null&&($.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&($.sizeAttenuation=this.sizeAttenuation),this.blending!==jt&&($.blending=this.blending),this.side!==_n&&($.side=this.side),this.vertexColors&&($.vertexColors=!0),this.opacity<1&&($.opacity=this.opacity),this.transparent===!0&&($.transparent=this.transparent),$.depthFunc=this.depthFunc,$.depthTest=this.depthTest,$.depthWrite=this.depthWrite,$.colorWrite=this.colorWrite,$.stencilWrite=this.stencilWrite,$.stencilWriteMask=this.stencilWriteMask,$.stencilFunc=this.stencilFunc,$.stencilRef=this.stencilRef,$.stencilFuncMask=this.stencilFuncMask,$.stencilFail=this.stencilFail,$.stencilZFail=this.stencilZFail,$.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&($.rotation=this.rotation),this.polygonOffset===!0&&($.polygonOffset=!0),this.polygonOffsetFactor!==0&&($.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&($.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&($.linewidth=this.linewidth),this.dashSize!==void 0&&($.dashSize=this.dashSize),this.gapSize!==void 0&&($.gapSize=this.gapSize),this.scale!==void 0&&($.scale=this.scale),this.dithering===!0&&($.dithering=!0),this.alphaTest>0&&($.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&($.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&($.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&($.wireframe=this.wireframe),this.wireframeLinewidth>1&&($.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&($.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&($.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&($.flatShading=this.flatShading),this.visible===!1&&($.visible=!1),this.toneMapped===!1&&($.toneMapped=!1),this.fog===!1&&($.fog=!1),JSON.stringify(this.userData)!=="{}"&&($.userData=this.userData),g){const rt=_e(o.textures),at=_e(o.images);rt.length>0&&($.textures=rt),at.length>0&&($.images=at)}return $}clone(){return new this.constructor().copy(this)}copy(o){this.name=o.name,this.blending=o.blending,this.side=o.side,this.vertexColors=o.vertexColors,this.opacity=o.opacity,this.transparent=o.transparent,this.blendSrc=o.blendSrc,this.blendDst=o.blendDst,this.blendEquation=o.blendEquation,this.blendSrcAlpha=o.blendSrcAlpha,this.blendDstAlpha=o.blendDstAlpha,this.blendEquationAlpha=o.blendEquationAlpha,this.depthFunc=o.depthFunc,this.depthTest=o.depthTest,this.depthWrite=o.depthWrite,this.stencilWriteMask=o.stencilWriteMask,this.stencilFunc=o.stencilFunc,this.stencilRef=o.stencilRef,this.stencilFuncMask=o.stencilFuncMask,this.stencilFail=o.stencilFail,this.stencilZFail=o.stencilZFail,this.stencilZPass=o.stencilZPass,this.stencilWrite=o.stencilWrite;const g=o.clippingPlanes;let $=null;if(g!==null){const _e=g.length;$=new Array(_e);for(let rt=0;rt!==_e;++rt)$[rt]=g[rt].clone()}this.clippingPlanes=$,this.clipIntersection=o.clipIntersection,this.clipShadows=o.clipShadows,this.shadowSide=o.shadowSide,this.colorWrite=o.colorWrite,this.precision=o.precision,this.polygonOffset=o.polygonOffset,this.polygonOffsetFactor=o.polygonOffsetFactor,this.polygonOffsetUnits=o.polygonOffsetUnits,this.dithering=o.dithering,this.alphaTest=o.alphaTest,this.alphaToCoverage=o.alphaToCoverage,this.premultipliedAlpha=o.premultipliedAlpha,this.visible=o.visible,this.toneMapped=o.toneMapped,this.userData={};for(const[_e,rt]of Object.entries(o.userData))this.userData[_e]=!rt||rt&&(rt.isTexture||rt.isObject3D)?rt:JSON.parse(JSON.stringify(rt));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(o){o===!0&&this.version++}}class Em extends lu{constructor(o){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ts(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}const yl=new dn,Lp=new Cr;class Co{constructor(o,g,$){if(Array.isArray(o))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=o,this.itemSize=g,this.count=o!==void 0?o.length/g:0,this.normalized=$===!0,this.usage=v0,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.name=o.name,this.array=new o.array.constructor(o.array),this.itemSize=o.itemSize,this.count=o.count,this.normalized=o.normalized,this.usage=o.usage,this}copyAt(o,g,$){o*=this.itemSize,$*=g.itemSize;for(let _e=0,rt=this.itemSize;_e<rt;_e++)this.array[o+_e]=g.array[$+_e];return this}copyArray(o){return this.array.set(o),this}applyMatrix3(o){if(this.itemSize===2)for(let g=0,$=this.count;g<$;g++)Lp.fromBufferAttribute(this,g),Lp.applyMatrix3(o),this.setXY(g,Lp.x,Lp.y);else if(this.itemSize===3)for(let g=0,$=this.count;g<$;g++)yl.fromBufferAttribute(this,g),yl.applyMatrix3(o),this.setXYZ(g,yl.x,yl.y,yl.z);return this}applyMatrix4(o){for(let g=0,$=this.count;g<$;g++)yl.fromBufferAttribute(this,g),yl.applyMatrix4(o),this.setXYZ(g,yl.x,yl.y,yl.z);return this}applyNormalMatrix(o){for(let g=0,$=this.count;g<$;g++)yl.fromBufferAttribute(this,g),yl.applyNormalMatrix(o),this.setXYZ(g,yl.x,yl.y,yl.z);return this}transformDirection(o){for(let g=0,$=this.count;g<$;g++)yl.fromBufferAttribute(this,g),yl.transformDirection(o),this.setXYZ(g,yl.x,yl.y,yl.z);return this}set(o,g=0){return this.array.set(o,g),this}getX(o){let g=this.array[o*this.itemSize];return this.normalized&&(g=Km(g,this.array)),g}setX(o,g){return this.normalized&&(g=Io(g,this.array)),this.array[o*this.itemSize]=g,this}getY(o){let g=this.array[o*this.itemSize+1];return this.normalized&&(g=Km(g,this.array)),g}setY(o,g){return this.normalized&&(g=Io(g,this.array)),this.array[o*this.itemSize+1]=g,this}getZ(o){let g=this.array[o*this.itemSize+2];return this.normalized&&(g=Km(g,this.array)),g}setZ(o,g){return this.normalized&&(g=Io(g,this.array)),this.array[o*this.itemSize+2]=g,this}getW(o){let g=this.array[o*this.itemSize+3];return this.normalized&&(g=Km(g,this.array)),g}setW(o,g){return this.normalized&&(g=Io(g,this.array)),this.array[o*this.itemSize+3]=g,this}setXY(o,g,$){return o*=this.itemSize,this.normalized&&(g=Io(g,this.array),$=Io($,this.array)),this.array[o+0]=g,this.array[o+1]=$,this}setXYZ(o,g,$,_e){return o*=this.itemSize,this.normalized&&(g=Io(g,this.array),$=Io($,this.array),_e=Io(_e,this.array)),this.array[o+0]=g,this.array[o+1]=$,this.array[o+2]=_e,this}setXYZW(o,g,$,_e,rt){return o*=this.itemSize,this.normalized&&(g=Io(g,this.array),$=Io($,this.array),_e=Io(_e,this.array),rt=Io(rt,this.array)),this.array[o+0]=g,this.array[o+1]=$,this.array[o+2]=_e,this.array[o+3]=rt,this}onUpload(o){return this.onUploadCallback=o,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const o={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(o.name=this.name),this.usage!==v0&&(o.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(o.updateRange=this.updateRange),o}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class E_ extends Co{constructor(o,g,$){super(new Int8Array(o),g,$)}}class Op extends Co{constructor(o,g,$){super(new Uint8Array(o),g,$)}}class S_ extends Co{constructor(o,g,$){super(new Uint8ClampedArray(o),g,$)}}class Ou extends Co{constructor(o,g,$){super(new Int16Array(o),g,$)}}class na extends Co{constructor(o,g,$){super(new Uint16Array(o),g,$)}}class Ow extends Co{constructor(o,g,$){super(new Int32Array(o),g,$)}}class At extends Co{constructor(o,g,$){super(new Uint32Array(o),g,$)}}class ot extends Co{constructor(o,g,$){super(new Uint16Array(o),g,$),this.isFloat16BufferAttribute=!0}}class ht extends Co{constructor(o,g,$){super(new Float32Array(o),g,$)}}class Tt extends Co{constructor(o,g,$){super(new Float64Array(o),g,$)}}let Ht=0;const vn=new Is,Rn=new Fs,ar=new dn,Er=new E0,ps=new E0,ws=new dn;class ls extends Ts{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ht++}),this.uuid=wu(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(o){return Array.isArray(o)?this.index=new(w1(o)?At:na)(o,1):this.index=o,this}getAttribute(o){return this.attributes[o]}setAttribute(o,g){return this.attributes[o]=g,this}deleteAttribute(o){return delete this.attributes[o],this}hasAttribute(o){return this.attributes[o]!==void 0}addGroup(o,g,$=0){this.groups.push({start:o,count:g,materialIndex:$})}clearGroups(){this.groups=[]}setDrawRange(o,g){this.drawRange.start=o,this.drawRange.count=g}applyMatrix4(o){const g=this.attributes.position;g!==void 0&&(g.applyMatrix4(o),g.needsUpdate=!0);const $=this.attributes.normal;if($!==void 0){const rt=new ru().getNormalMatrix(o);$.applyNormalMatrix(rt),$.needsUpdate=!0}const _e=this.attributes.tangent;return _e!==void 0&&(_e.transformDirection(o),_e.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(o){return vn.makeRotationFromQuaternion(o),this.applyMatrix4(vn),this}rotateX(o){return vn.makeRotationX(o),this.applyMatrix4(vn),this}rotateY(o){return vn.makeRotationY(o),this.applyMatrix4(vn),this}rotateZ(o){return vn.makeRotationZ(o),this.applyMatrix4(vn),this}translate(o,g,$){return vn.makeTranslation(o,g,$),this.applyMatrix4(vn),this}scale(o,g,$){return vn.makeScale(o,g,$),this.applyMatrix4(vn),this}lookAt(o){return Rn.lookAt(o),Rn.updateMatrix(),this.applyMatrix4(Rn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ar).negate(),this.translate(ar.x,ar.y,ar.z),this}setFromPoints(o){const g=[];for(let $=0,_e=o.length;$<_e;$++){const rt=o[$];g.push(rt.x,rt.y,rt.z||0)}return this.setAttribute("position",new ht(g,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new E0);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new dn(-1/0,-1/0,-1/0),new dn(1/0,1/0,1/0));if(o!==void 0){if(this.boundingBox.setFromBufferAttribute(o),g)for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];Er.setFromBufferAttribute(rt),this.morphTargetsRelative?(ws.addVectors(this.boundingBox.min,Er.min),this.boundingBox.expandByPoint(ws),ws.addVectors(this.boundingBox.max,Er.max),this.boundingBox.expandByPoint(ws)):(this.boundingBox.expandByPoint(Er.min),this.boundingBox.expandByPoint(Er.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Dp);const o=this.attributes.position,g=this.morphAttributes.position;if(o&&o.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new dn,1/0);if(o){const $=this.boundingSphere.center;if(Er.setFromBufferAttribute(o),g)for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt];ps.setFromBufferAttribute(ct),this.morphTargetsRelative?(ws.addVectors(Er.min,ps.min),Er.expandByPoint(ws),ws.addVectors(Er.max,ps.max),Er.expandByPoint(ws)):(Er.expandByPoint(ps.min),Er.expandByPoint(ps.max))}Er.getCenter($);let _e=0;for(let rt=0,at=o.count;rt<at;rt++)ws.fromBufferAttribute(o,rt),_e=Math.max(_e,$.distanceToSquared(ws));if(g)for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt],ft=this.morphTargetsRelative;for(let mt=0,bt=ct.count;mt<bt;mt++)ws.fromBufferAttribute(ct,mt),ft&&(ar.fromBufferAttribute(o,mt),ws.add(ar)),_e=Math.max(_e,$.distanceToSquared(ws))}this.boundingSphere.radius=Math.sqrt(_e),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const o=this.index,g=this.attributes;if(o===null||g.position===void 0||g.normal===void 0||g.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const $=o.array,_e=g.position.array,rt=g.normal.array,at=g.uv.array,ct=_e.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Co(new Float32Array(4*ct),4));const ft=this.getAttribute("tangent").array,mt=[],bt=[];for(let Kn=0;Kn<ct;Kn++)mt[Kn]=new dn,bt[Kn]=new dn;const Mt=new dn,St=new dn,It=new dn,Bt=new Cr,Dt=new Cr,Ut=new Cr,Ft=new dn,zt=new dn;function Kt(Kn,Un,vr){Mt.fromArray(_e,3*Kn),St.fromArray(_e,3*Un),It.fromArray(_e,3*vr),Bt.fromArray(at,2*Kn),Dt.fromArray(at,2*Un),Ut.fromArray(at,2*vr),St.sub(Mt),It.sub(Mt),Dt.sub(Bt),Ut.sub(Bt);const Pr=1/(Dt.x*Ut.y-Ut.x*Dt.y);isFinite(Pr)&&(Ft.copy(St).multiplyScalar(Ut.y).addScaledVector(It,-Dt.y).multiplyScalar(Pr),zt.copy(It).multiplyScalar(Dt.x).addScaledVector(St,-Ut.x).multiplyScalar(Pr),mt[Kn].add(Ft),mt[Un].add(Ft),mt[vr].add(Ft),bt[Kn].add(zt),bt[Un].add(zt),bt[vr].add(zt))}let tn=this.groups;tn.length===0&&(tn=[{start:0,count:$.length}]);for(let Kn=0,Un=tn.length;Kn<Un;++Kn){const vr=tn[Kn],Pr=vr.start;for(let mr=Pr,Qr=Pr+vr.count;mr<Qr;mr+=3)Kt($[mr+0],$[mr+1],$[mr+2])}const sn=new dn,ln=new dn,kn=new dn,Ln=new dn;function qn(Kn){kn.fromArray(rt,3*Kn),Ln.copy(kn);const Un=mt[Kn];sn.copy(Un),sn.sub(kn.multiplyScalar(kn.dot(Un))).normalize(),ln.crossVectors(Ln,Un);const vr=ln.dot(bt[Kn])<0?-1:1;ft[4*Kn]=sn.x,ft[4*Kn+1]=sn.y,ft[4*Kn+2]=sn.z,ft[4*Kn+3]=vr}for(let Kn=0,Un=tn.length;Kn<Un;++Kn){const vr=tn[Kn],Pr=vr.start;for(let mr=Pr,Qr=Pr+vr.count;mr<Qr;mr+=3)qn($[mr+0]),qn($[mr+1]),qn($[mr+2])}}computeVertexNormals(){const o=this.index,g=this.getAttribute("position");if(g!==void 0){let $=this.getAttribute("normal");if($===void 0)$=new Co(new Float32Array(3*g.count),3),this.setAttribute("normal",$);else for(let St=0,It=$.count;St<It;St++)$.setXYZ(St,0,0,0);const _e=new dn,rt=new dn,at=new dn,ct=new dn,ft=new dn,mt=new dn,bt=new dn,Mt=new dn;if(o)for(let St=0,It=o.count;St<It;St+=3){const Bt=o.getX(St+0),Dt=o.getX(St+1),Ut=o.getX(St+2);_e.fromBufferAttribute(g,Bt),rt.fromBufferAttribute(g,Dt),at.fromBufferAttribute(g,Ut),bt.subVectors(at,rt),Mt.subVectors(_e,rt),bt.cross(Mt),ct.fromBufferAttribute($,Bt),ft.fromBufferAttribute($,Dt),mt.fromBufferAttribute($,Ut),ct.add(bt),ft.add(bt),mt.add(bt),$.setXYZ(Bt,ct.x,ct.y,ct.z),$.setXYZ(Dt,ft.x,ft.y,ft.z),$.setXYZ(Ut,mt.x,mt.y,mt.z)}else for(let St=0,It=g.count;St<It;St+=3)_e.fromBufferAttribute(g,St+0),rt.fromBufferAttribute(g,St+1),at.fromBufferAttribute(g,St+2),bt.subVectors(at,rt),Mt.subVectors(_e,rt),bt.cross(Mt),$.setXYZ(St+0,bt.x,bt.y,bt.z),$.setXYZ(St+1,bt.x,bt.y,bt.z),$.setXYZ(St+2,bt.x,bt.y,bt.z);this.normalizeNormals(),$.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const o=this.attributes.normal;for(let g=0,$=o.count;g<$;g++)ws.fromBufferAttribute(o,g),ws.normalize(),o.setXYZ(g,ws.x,ws.y,ws.z)}toNonIndexed(){function o(ct,ft){const mt=ct.array,bt=ct.itemSize,Mt=ct.normalized,St=new mt.constructor(ft.length*bt);let It=0,Bt=0;for(let Dt=0,Ut=ft.length;Dt<Ut;Dt++){It=ct.isInterleavedBufferAttribute?ft[Dt]*ct.data.stride+ct.offset:ft[Dt]*bt;for(let Ft=0;Ft<bt;Ft++)St[Bt++]=mt[It++]}return new Co(St,bt,Mt)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const g=new ls,$=this.index.array,_e=this.attributes;for(const ct in _e){const ft=o(_e[ct],$);g.setAttribute(ct,ft)}const rt=this.morphAttributes;for(const ct in rt){const ft=[],mt=rt[ct];for(let bt=0,Mt=mt.length;bt<Mt;bt++){const St=o(mt[bt],$);ft.push(St)}g.morphAttributes[ct]=ft}g.morphTargetsRelative=this.morphTargetsRelative;const at=this.groups;for(let ct=0,ft=at.length;ct<ft;ct++){const mt=at[ct];g.addGroup(mt.start,mt.count,mt.materialIndex)}return g}toJSON(){const o={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),Object.keys(this.userData).length>0&&(o.userData=this.userData),this.parameters!==void 0){const ft=this.parameters;for(const mt in ft)ft[mt]!==void 0&&(o[mt]=ft[mt]);return o}o.data={attributes:{}};const g=this.index;g!==null&&(o.data.index={type:g.array.constructor.name,array:Array.prototype.slice.call(g.array)});const $=this.attributes;for(const ft in $){const mt=$[ft];o.data.attributes[ft]=mt.toJSON(o.data)}const _e={};let rt=!1;for(const ft in this.morphAttributes){const mt=this.morphAttributes[ft],bt=[];for(let Mt=0,St=mt.length;Mt<St;Mt++){const It=mt[Mt];bt.push(It.toJSON(o.data))}bt.length>0&&(_e[ft]=bt,rt=!0)}rt&&(o.data.morphAttributes=_e,o.data.morphTargetsRelative=this.morphTargetsRelative);const at=this.groups;at.length>0&&(o.data.groups=JSON.parse(JSON.stringify(at)));const ct=this.boundingSphere;return ct!==null&&(o.data.boundingSphere={center:ct.center.toArray(),radius:ct.radius}),o}clone(){return new this.constructor().copy(this)}copy(o){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const g={};this.name=o.name;const $=o.index;$!==null&&this.setIndex($.clone(g));const _e=o.attributes;for(const mt in _e){const bt=_e[mt];this.setAttribute(mt,bt.clone(g))}const rt=o.morphAttributes;for(const mt in rt){const bt=[],Mt=rt[mt];for(let St=0,It=Mt.length;St<It;St++)bt.push(Mt[St].clone(g));this.morphAttributes[mt]=bt}this.morphTargetsRelative=o.morphTargetsRelative;const at=o.groups;for(let mt=0,bt=at.length;mt<bt;mt++){const Mt=at[mt];this.addGroup(Mt.start,Mt.count,Mt.materialIndex)}const ct=o.boundingBox;ct!==null&&(this.boundingBox=ct.clone());const ft=o.boundingSphere;return ft!==null&&(this.boundingSphere=ft.clone()),this.drawRange.start=o.drawRange.start,this.drawRange.count=o.drawRange.count,this.userData=o.userData,o.parameters!==void 0&&(this.parameters=Object.assign({},o.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Fo=new Is,Ml=new Nv,Np=new Dp,Eu=new dn,lp=new dn,nm=new dn,I0=new dn,zv=new dn,C_=new dn,CA=new dn,MA=new dn,TA=new dn,Ry=new Cr,E1=new Cr,S1=new Cr,Nw=new dn,IA=new dn;class cu extends Fs{constructor(o=new ls,g=new Em){super(),this.isMesh=!0,this.type="Mesh",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),o.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=o.morphTargetInfluences.slice()),o.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},o.morphTargetDictionary)),this.material=o.material,this.geometry=o.geometry,this}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}raycast(o,g){const $=this.geometry,_e=this.material,rt=this.matrixWorld;if(_e===void 0||($.boundingSphere===null&&$.computeBoundingSphere(),Np.copy($.boundingSphere),Np.applyMatrix4(rt),o.ray.intersectsSphere(Np)===!1)||(Fo.copy(rt).invert(),Ml.copy(o.ray).applyMatrix4(Fo),$.boundingBox!==null&&Ml.intersectsBox($.boundingBox)===!1))return;let at;const ct=$.index,ft=$.attributes.position,mt=$.morphAttributes.position,bt=$.morphTargetsRelative,Mt=$.attributes.uv,St=$.attributes.uv2,It=$.groups,Bt=$.drawRange;if(ct!==null)if(Array.isArray(_e))for(let Dt=0,Ut=It.length;Dt<Ut;Dt++){const Ft=It[Dt],zt=_e[Ft.materialIndex];for(let Kt=Math.max(Ft.start,Bt.start),tn=Math.min(ct.count,Math.min(Ft.start+Ft.count,Bt.start+Bt.count));Kt<tn;Kt+=3){const sn=ct.getX(Kt),ln=ct.getX(Kt+1),kn=ct.getX(Kt+2);at=Uw(this,zt,o,Ml,ft,mt,bt,Mt,St,sn,ln,kn),at&&(at.faceIndex=Math.floor(Kt/3),at.face.materialIndex=Ft.materialIndex,g.push(at))}}else for(let Dt=Math.max(0,Bt.start),Ut=Math.min(ct.count,Bt.start+Bt.count);Dt<Ut;Dt+=3){const Ft=ct.getX(Dt),zt=ct.getX(Dt+1),Kt=ct.getX(Dt+2);at=Uw(this,_e,o,Ml,ft,mt,bt,Mt,St,Ft,zt,Kt),at&&(at.faceIndex=Math.floor(Dt/3),g.push(at))}else if(ft!==void 0)if(Array.isArray(_e))for(let Dt=0,Ut=It.length;Dt<Ut;Dt++){const Ft=It[Dt],zt=_e[Ft.materialIndex];for(let Kt=Math.max(Ft.start,Bt.start),tn=Math.min(ft.count,Math.min(Ft.start+Ft.count,Bt.start+Bt.count));Kt<tn;Kt+=3)at=Uw(this,zt,o,Ml,ft,mt,bt,Mt,St,Kt,Kt+1,Kt+2),at&&(at.faceIndex=Math.floor(Kt/3),at.face.materialIndex=Ft.materialIndex,g.push(at))}else for(let Dt=Math.max(0,Bt.start),Ut=Math.min(ft.count,Bt.start+Bt.count);Dt<Ut;Dt+=3)at=Uw(this,_e,o,Ml,ft,mt,bt,Mt,St,Dt,Dt+1,Dt+2),at&&(at.faceIndex=Math.floor(Dt/3),g.push(at))}}function Uw(ut,o,g,$,_e,rt,at,ct,ft,mt,bt,Mt){Eu.fromBufferAttribute(_e,mt),lp.fromBufferAttribute(_e,bt),nm.fromBufferAttribute(_e,Mt);const St=ut.morphTargetInfluences;if(rt&&St){CA.set(0,0,0),MA.set(0,0,0),TA.set(0,0,0);for(let Bt=0,Dt=rt.length;Bt<Dt;Bt++){const Ut=St[Bt],Ft=rt[Bt];Ut!==0&&(I0.fromBufferAttribute(Ft,mt),zv.fromBufferAttribute(Ft,bt),C_.fromBufferAttribute(Ft,Mt),at?(CA.addScaledVector(I0,Ut),MA.addScaledVector(zv,Ut),TA.addScaledVector(C_,Ut)):(CA.addScaledVector(I0.sub(Eu),Ut),MA.addScaledVector(zv.sub(lp),Ut),TA.addScaledVector(C_.sub(nm),Ut)))}Eu.add(CA),lp.add(MA),nm.add(TA)}ut.isSkinnedMesh&&(ut.boneTransform(mt,Eu),ut.boneTransform(bt,lp),ut.boneTransform(Mt,nm));const It=function(Bt,Dt,Ut,Ft,zt,Kt,tn,sn){let ln;if(ln=Dt.side===$t?Ft.intersectTriangle(tn,Kt,zt,!0,sn):Ft.intersectTriangle(zt,Kt,tn,Dt.side!==bn,sn),ln===null)return null;IA.copy(sn),IA.applyMatrix4(Bt.matrixWorld);const kn=Ut.ray.origin.distanceTo(IA);return kn<Ut.near||kn>Ut.far?null:{distance:kn,point:IA.clone(),object:Bt}}(ut,o,g,$,Eu,lp,nm,Nw);if(It){ct&&(Ry.fromBufferAttribute(ct,mt),E1.fromBufferAttribute(ct,bt),S1.fromBufferAttribute(ct,Mt),It.uv=au.getUV(Nw,Eu,lp,nm,Ry,E1,S1,new Cr)),ft&&(Ry.fromBufferAttribute(ft,mt),E1.fromBufferAttribute(ft,bt),S1.fromBufferAttribute(ft,Mt),It.uv2=au.getUV(Nw,Eu,lp,nm,Ry,E1,S1,new Cr));const Bt={a:mt,b:bt,c:Mt,normal:new dn,materialIndex:0};au.getNormal(Eu,lp,nm,Bt.normal),It.face=Bt}return It}class Sm extends ls{constructor(o=1,g=1,$=1,_e=1,rt=1,at=1){super(),this.type="BoxGeometry",this.parameters={width:o,height:g,depth:$,widthSegments:_e,heightSegments:rt,depthSegments:at};const ct=this;_e=Math.floor(_e),rt=Math.floor(rt),at=Math.floor(at);const ft=[],mt=[],bt=[],Mt=[];let St=0,It=0;function Bt(Dt,Ut,Ft,zt,Kt,tn,sn,ln,kn,Ln,qn){const Kn=tn/kn,Un=sn/Ln,vr=tn/2,Pr=sn/2,mr=ln/2,Qr=kn+1,Gr=Ln+1;let lr=0,dr=0;const Or=new dn;for(let _r=0;_r<Gr;_r++){const Vr=_r*Un-Pr;for(let fs=0;fs<Qr;fs++){const Ks=fs*Kn-vr;Or[Dt]=Ks*zt,Or[Ut]=Vr*Kt,Or[Ft]=mr,mt.push(Or.x,Or.y,Or.z),Or[Dt]=0,Or[Ut]=0,Or[Ft]=ln>0?1:-1,bt.push(Or.x,Or.y,Or.z),Mt.push(fs/kn),Mt.push(1-_r/Ln),lr+=1}}for(let _r=0;_r<Ln;_r++)for(let Vr=0;Vr<kn;Vr++){const fs=St+Vr+Qr*_r,Ks=St+Vr+Qr*(_r+1),gs=St+(Vr+1)+Qr*(_r+1),Qs=St+(Vr+1)+Qr*_r;ft.push(fs,Ks,Qs),ft.push(Ks,gs,Qs),dr+=6}ct.addGroup(It,dr,qn),It+=dr,St+=lr}Bt("z","y","x",-1,-1,$,g,o,at,rt,0),Bt("z","y","x",1,-1,$,g,-o,at,rt,1),Bt("x","z","y",1,1,o,$,g,_e,at,2),Bt("x","z","y",1,-1,o,$,-g,_e,at,3),Bt("x","y","z",1,-1,o,g,$,_e,rt,4),Bt("x","y","z",-1,-1,o,g,-$,_e,rt,5),this.setIndex(ft),this.setAttribute("position",new ht(mt,3)),this.setAttribute("normal",new ht(bt,3)),this.setAttribute("uv",new ht(Mt,2))}static fromJSON(o){return new Sm(o.width,o.height,o.depth,o.widthSegments,o.heightSegments,o.depthSegments)}}function M_(ut){const o={};for(const g in ut){o[g]={};for(const $ in ut[g]){const _e=ut[g][$];_e&&(_e.isColor||_e.isMatrix3||_e.isMatrix4||_e.isVector2||_e.isVector3||_e.isVector4||_e.isTexture||_e.isQuaternion)?o[g][$]=_e.clone():Array.isArray(_e)?o[g][$]=_e.slice():o[g][$]=_e}}return o}function $u(ut){const o={};for(let g=0;g<ut.length;g++){const $=M_(ut[g]);for(const _e in $)o[_e]=$[_e]}return o}const kM={clone:M_,merge:$u};class tv extends lu{constructor(o){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,o!==void 0&&this.setValues(o)}copy(o){return super.copy(o),this.fragmentShader=o.fragmentShader,this.vertexShader=o.vertexShader,this.uniforms=M_(o.uniforms),this.uniformsGroups=function(g){const $=[];for(let _e=0;_e<g.length;_e++)$.push(g[_e].clone());return $}(o.uniformsGroups),this.defines=Object.assign({},o.defines),this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.fog=o.fog,this.lights=o.lights,this.clipping=o.clipping,this.extensions=Object.assign({},o.extensions),this.glslVersion=o.glslVersion,this}toJSON(o){const g=super.toJSON(o);g.glslVersion=this.glslVersion,g.uniforms={};for(const _e in this.uniforms){const rt=this.uniforms[_e].value;rt&&rt.isTexture?g.uniforms[_e]={type:"t",value:rt.toJSON(o).uuid}:rt&&rt.isColor?g.uniforms[_e]={type:"c",value:rt.getHex()}:rt&&rt.isVector2?g.uniforms[_e]={type:"v2",value:rt.toArray()}:rt&&rt.isVector3?g.uniforms[_e]={type:"v3",value:rt.toArray()}:rt&&rt.isVector4?g.uniforms[_e]={type:"v4",value:rt.toArray()}:rt&&rt.isMatrix3?g.uniforms[_e]={type:"m3",value:rt.toArray()}:rt&&rt.isMatrix4?g.uniforms[_e]={type:"m4",value:rt.toArray()}:g.uniforms[_e]={value:rt}}Object.keys(this.defines).length>0&&(g.defines=this.defines),g.vertexShader=this.vertexShader,g.fragmentShader=this.fragmentShader;const $={};for(const _e in this.extensions)this.extensions[_e]===!0&&($[_e]=!0);return Object.keys($).length>0&&(g.extensions=$),g}}class By extends Fs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Is,this.projectionMatrix=new Is,this.projectionMatrixInverse=new Is}copy(o,g){return super.copy(o,g),this.matrixWorldInverse.copy(o.matrixWorldInverse),this.projectionMatrix.copy(o.projectionMatrix),this.projectionMatrixInverse.copy(o.projectionMatrixInverse),this}getWorldDirection(o){this.updateWorldMatrix(!0,!1);const g=this.matrixWorld.elements;return o.set(-g[8],-g[9],-g[10]).normalize()}updateMatrixWorld(o){super.updateMatrixWorld(o),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(o,g){super.updateWorldMatrix(o,g),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Su extends By{constructor(o=50,g=1,$=.1,_e=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=o,this.zoom=1,this.near=$,this.far=_e,this.focus=10,this.aspect=g,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.fov=o.fov,this.zoom=o.zoom,this.near=o.near,this.far=o.far,this.focus=o.focus,this.aspect=o.aspect,this.view=o.view===null?null:Object.assign({},o.view),this.filmGauge=o.filmGauge,this.filmOffset=o.filmOffset,this}setFocalLength(o){const g=.5*this.getFilmHeight()/o;this.fov=2*_A*Math.atan(g),this.updateProjectionMatrix()}getFocalLength(){const o=Math.tan(.5*A0*this.fov);return .5*this.getFilmHeight()/o}getEffectiveFOV(){return 2*_A*Math.atan(Math.tan(.5*A0*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(o,g,$,_e,rt,at){this.aspect=o/g,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=rt,this.view.height=at,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=this.near;let g=o*Math.tan(.5*A0*this.fov)/this.zoom,$=2*g,_e=this.aspect*$,rt=-.5*_e;const at=this.view;if(this.view!==null&&this.view.enabled){const ft=at.fullWidth,mt=at.fullHeight;rt+=at.offsetX*_e/ft,g-=at.offsetY*$/mt,_e*=at.width/ft,$*=at.height/mt}const ct=this.filmOffset;ct!==0&&(rt+=o*ct/this.getFilmWidth()),this.projectionMatrix.makePerspective(rt,rt+_e,g,g-$,o,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.fov=this.fov,g.object.zoom=this.zoom,g.object.near=this.near,g.object.far=this.far,g.object.focus=this.focus,g.object.aspect=this.aspect,this.view!==null&&(g.object.view=Object.assign({},this.view)),g.object.filmGauge=this.filmGauge,g.object.filmOffset=this.filmOffset,g}}const T_=90;class PS extends Fs{constructor(o,g,$){super(),this.type="CubeCamera",this.renderTarget=$;const _e=new Su(T_,1,o,g);_e.layers=this.layers,_e.up.set(0,-1,0),_e.lookAt(new dn(1,0,0)),this.add(_e);const rt=new Su(T_,1,o,g);rt.layers=this.layers,rt.up.set(0,-1,0),rt.lookAt(new dn(-1,0,0)),this.add(rt);const at=new Su(T_,1,o,g);at.layers=this.layers,at.up.set(0,0,1),at.lookAt(new dn(0,1,0)),this.add(at);const ct=new Su(T_,1,o,g);ct.layers=this.layers,ct.up.set(0,0,-1),ct.lookAt(new dn(0,-1,0)),this.add(ct);const ft=new Su(T_,1,o,g);ft.layers=this.layers,ft.up.set(0,-1,0),ft.lookAt(new dn(0,0,1)),this.add(ft);const mt=new Su(T_,1,o,g);mt.layers=this.layers,mt.up.set(0,-1,0),mt.lookAt(new dn(0,0,-1)),this.add(mt)}update(o,g){this.parent===null&&this.updateMatrixWorld();const $=this.renderTarget,[_e,rt,at,ct,ft,mt]=this.children,bt=o.getRenderTarget(),Mt=o.toneMapping,St=o.xr.enabled;o.toneMapping=Zs,o.xr.enabled=!1;const It=$.texture.generateMipmaps;$.texture.generateMipmaps=!1,o.setRenderTarget($,0),o.render(g,_e),o.setRenderTarget($,1),o.render(g,rt),o.setRenderTarget($,2),o.render(g,at),o.setRenderTarget($,3),o.render(g,ct),o.setRenderTarget($,4),o.render(g,ft),$.texture.generateMipmaps=It,o.setRenderTarget($,5),o.render(g,mt),o.setRenderTarget(bt),o.toneMapping=Mt,o.xr.enabled=St,$.texture.needsPMREMUpdate=!0}}class ky extends zl{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt){super(o=o!==void 0?o:[],g=g!==void 0?g:ba,$,_e,rt,at,ct,ft,mt,bt),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(o){this.image=o}}class LM extends Ku{constructor(o,g={}){super(o,o,g),this.isWebGLCubeRenderTarget=!0;const $={width:o,height:o,depth:1},_e=[$,$,$,$,$,$];this.texture=new ky(_e,g.mapping,g.wrapS,g.wrapT,g.magFilter,g.minFilter,g.format,g.type,g.anisotropy,g.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=g.generateMipmaps!==void 0&&g.generateMipmaps,this.texture.minFilter=g.minFilter!==void 0?g.minFilter:Ko}fromEquirectangularTexture(o,g){this.texture.type=g.type,this.texture.encoding=g.encoding,this.texture.generateMipmaps=g.generateMipmaps,this.texture.minFilter=g.minFilter,this.texture.magFilter=g.magFilter;const $={tEquirect:{value:null}},_e=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,rt=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,at=new Sm(5,5,5),ct=new tv({name:"CubemapFromEquirect",uniforms:M_($),vertexShader:_e,fragmentShader:rt,side:$t,blending:Nt});ct.uniforms.tEquirect.value=g;const ft=new cu(at,ct),mt=g.minFilter;return g.minFilter===vo&&(g.minFilter=Ko),new PS(1,10,this).update(o,ft),g.minFilter=mt,ft.geometry.dispose(),ft.material.dispose(),this}clear(o,g,$,_e){const rt=o.getRenderTarget();for(let at=0;at<6;at++)o.setRenderTarget(this,at),o.clear(g,$,_e);o.setRenderTarget(rt)}}const RS=new dn,I_=new dn,BS=new ru;class D0{constructor(o=new dn(1,0,0),g=0){this.isPlane=!0,this.normal=o,this.constant=g}set(o,g){return this.normal.copy(o),this.constant=g,this}setComponents(o,g,$,_e){return this.normal.set(o,g,$),this.constant=_e,this}setFromNormalAndCoplanarPoint(o,g){return this.normal.copy(o),this.constant=-g.dot(this.normal),this}setFromCoplanarPoints(o,g,$){const _e=RS.subVectors($,g).cross(I_.subVectors(o,g)).normalize();return this.setFromNormalAndCoplanarPoint(_e,o),this}copy(o){return this.normal.copy(o.normal),this.constant=o.constant,this}normalize(){const o=1/this.normal.length();return this.normal.multiplyScalar(o),this.constant*=o,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(o){return this.normal.dot(o)+this.constant}distanceToSphere(o){return this.distanceToPoint(o.center)-o.radius}projectPoint(o,g){return g.copy(this.normal).multiplyScalar(-this.distanceToPoint(o)).add(o)}intersectLine(o,g){const $=o.delta(RS),_e=this.normal.dot($);if(_e===0)return this.distanceToPoint(o.start)===0?g.copy(o.start):null;const rt=-(o.start.dot(this.normal)+this.constant)/_e;return rt<0||rt>1?null:g.copy($).multiplyScalar(rt).add(o.start)}intersectsLine(o){const g=this.distanceToPoint(o.start),$=this.distanceToPoint(o.end);return g<0&&$>0||$<0&&g>0}intersectsBox(o){return o.intersectsPlane(this)}intersectsSphere(o){return o.intersectsPlane(this)}coplanarPoint(o){return o.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(o,g){const $=g||BS.getNormalMatrix(o),_e=this.coplanarPoint(RS).applyMatrix4(o),rt=this.normal.applyMatrix3($).normalize();return this.constant=-_e.dot(rt),this}translate(o){return this.constant-=o.dot(this.normal),this}equals(o){return o.normal.equals(this.normal)&&o.constant===this.constant}clone(){return new this.constructor().copy(this)}}const DA=new Dp,Fw=new dn;class jw{constructor(o=new D0,g=new D0,$=new D0,_e=new D0,rt=new D0,at=new D0){this.planes=[o,g,$,_e,rt,at]}set(o,g,$,_e,rt,at){const ct=this.planes;return ct[0].copy(o),ct[1].copy(g),ct[2].copy($),ct[3].copy(_e),ct[4].copy(rt),ct[5].copy(at),this}copy(o){const g=this.planes;for(let $=0;$<6;$++)g[$].copy(o.planes[$]);return this}setFromProjectionMatrix(o){const g=this.planes,$=o.elements,_e=$[0],rt=$[1],at=$[2],ct=$[3],ft=$[4],mt=$[5],bt=$[6],Mt=$[7],St=$[8],It=$[9],Bt=$[10],Dt=$[11],Ut=$[12],Ft=$[13],zt=$[14],Kt=$[15];return g[0].setComponents(ct-_e,Mt-ft,Dt-St,Kt-Ut).normalize(),g[1].setComponents(ct+_e,Mt+ft,Dt+St,Kt+Ut).normalize(),g[2].setComponents(ct+rt,Mt+mt,Dt+It,Kt+Ft).normalize(),g[3].setComponents(ct-rt,Mt-mt,Dt-It,Kt-Ft).normalize(),g[4].setComponents(ct-at,Mt-bt,Dt-Bt,Kt-zt).normalize(),g[5].setComponents(ct+at,Mt+bt,Dt+Bt,Kt+zt).normalize(),this}intersectsObject(o){const g=o.geometry;return g.boundingSphere===null&&g.computeBoundingSphere(),DA.copy(g.boundingSphere).applyMatrix4(o.matrixWorld),this.intersectsSphere(DA)}intersectsSprite(o){return DA.center.set(0,0,0),DA.radius=.7071067811865476,DA.applyMatrix4(o.matrixWorld),this.intersectsSphere(DA)}intersectsSphere(o){const g=this.planes,$=o.center,_e=-o.radius;for(let rt=0;rt<6;rt++)if(g[rt].distanceToPoint($)<_e)return!1;return!0}intersectsBox(o){const g=this.planes;for(let $=0;$<6;$++){const _e=g[$];if(Fw.x=_e.normal.x>0?o.max.x:o.min.x,Fw.y=_e.normal.y>0?o.max.y:o.min.y,Fw.z=_e.normal.z>0?o.max.z:o.min.z,_e.distanceToPoint(Fw)<0)return!1}return!0}containsPoint(o){const g=this.planes;for(let $=0;$<6;$++)if(g[$].distanceToPoint(o)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function P0(){let ut=null,o=!1,g=null,$=null;function _e(rt,at){g(rt,at),$=ut.requestAnimationFrame(_e)}return{start:function(){o!==!0&&g!==null&&($=ut.requestAnimationFrame(_e),o=!0)},stop:function(){ut.cancelAnimationFrame($),o=!1},setAnimationLoop:function(rt){g=rt},setContext:function(rt){ut=rt}}}function Ly(ut,o){const g=o.isWebGL2,$=new WeakMap;return{get:function(_e){return _e.isInterleavedBufferAttribute&&(_e=_e.data),$.get(_e)},remove:function(_e){_e.isInterleavedBufferAttribute&&(_e=_e.data);const rt=$.get(_e);rt&&(ut.deleteBuffer(rt.buffer),$.delete(_e))},update:function(_e,rt){if(_e.isGLBufferAttribute){const ct=$.get(_e);return void((!ct||ct.version<_e.version)&&$.set(_e,{buffer:_e.buffer,type:_e.type,bytesPerElement:_e.elementSize,version:_e.version}))}_e.isInterleavedBufferAttribute&&(_e=_e.data);const at=$.get(_e);at===void 0?$.set(_e,function(ct,ft){const mt=ct.array,bt=ct.usage,Mt=ut.createBuffer();let St;if(ut.bindBuffer(ft,Mt),ut.bufferData(ft,mt,bt),ct.onUploadCallback(),mt instanceof Float32Array)St=5126;else if(mt instanceof Uint16Array)if(ct.isFloat16BufferAttribute){if(!g)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");St=5131}else St=5123;else if(mt instanceof Int16Array)St=5122;else if(mt instanceof Uint32Array)St=5125;else if(mt instanceof Int32Array)St=5124;else if(mt instanceof Int8Array)St=5120;else if(mt instanceof Uint8Array)St=5121;else{if(!(mt instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+mt);St=5121}return{buffer:Mt,type:St,bytesPerElement:mt.BYTES_PER_ELEMENT,version:ct.version}}(_e,rt)):at.version<_e.version&&(function(ct,ft,mt){const bt=ft.array,Mt=ft.updateRange;ut.bindBuffer(mt,ct),Mt.count===-1?ut.bufferSubData(mt,0,bt):(g?ut.bufferSubData(mt,Mt.offset*bt.BYTES_PER_ELEMENT,bt,Mt.offset,Mt.count):ut.bufferSubData(mt,Mt.offset*bt.BYTES_PER_ELEMENT,bt.subarray(Mt.offset,Mt.offset+Mt.count)),Mt.count=-1)}(at.buffer,_e,rt),at.version=_e.version)}}}class D_ extends ls{constructor(o=1,g=1,$=1,_e=1){super(),this.type="PlaneGeometry",this.parameters={width:o,height:g,widthSegments:$,heightSegments:_e};const rt=o/2,at=g/2,ct=Math.floor($),ft=Math.floor(_e),mt=ct+1,bt=ft+1,Mt=o/ct,St=g/ft,It=[],Bt=[],Dt=[],Ut=[];for(let Ft=0;Ft<bt;Ft++){const zt=Ft*St-at;for(let Kt=0;Kt<mt;Kt++){const tn=Kt*Mt-rt;Bt.push(tn,-zt,0),Dt.push(0,0,1),Ut.push(Kt/ct),Ut.push(1-Ft/ft)}}for(let Ft=0;Ft<ft;Ft++)for(let zt=0;zt<ct;zt++){const Kt=zt+mt*Ft,tn=zt+mt*(Ft+1),sn=zt+1+mt*(Ft+1),ln=zt+1+mt*Ft;It.push(Kt,tn,ln),It.push(tn,sn,ln)}this.setIndex(It),this.setAttribute("position",new ht(Bt,3)),this.setAttribute("normal",new ht(Dt,3)),this.setAttribute("uv",new ht(Ut,2))}static fromJSON(o){return new D_(o.width,o.height,o.widthSegments,o.heightSegments)}}const Vs={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},Kr={common:{diffuse:{value:new ts(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ru},uv2Transform:{value:new ru},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Cr(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ts(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ts(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ru}},sprite:{diffuse:{value:new ts(16777215)},opacity:{value:1},center:{value:new Cr(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ru}}},Up={basic:{uniforms:$u([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.fog]),vertexShader:Vs.meshbasic_vert,fragmentShader:Vs.meshbasic_frag},lambert:{uniforms:$u([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.fog,Kr.lights,{emissive:{value:new ts(0)}}]),vertexShader:Vs.meshlambert_vert,fragmentShader:Vs.meshlambert_frag},phong:{uniforms:$u([Kr.common,Kr.specularmap,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.fog,Kr.lights,{emissive:{value:new ts(0)},specular:{value:new ts(1118481)},shininess:{value:30}}]),vertexShader:Vs.meshphong_vert,fragmentShader:Vs.meshphong_frag},standard:{uniforms:$u([Kr.common,Kr.envmap,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.roughnessmap,Kr.metalnessmap,Kr.fog,Kr.lights,{emissive:{value:new ts(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Vs.meshphysical_vert,fragmentShader:Vs.meshphysical_frag},toon:{uniforms:$u([Kr.common,Kr.aomap,Kr.lightmap,Kr.emissivemap,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.gradientmap,Kr.fog,Kr.lights,{emissive:{value:new ts(0)}}]),vertexShader:Vs.meshtoon_vert,fragmentShader:Vs.meshtoon_frag},matcap:{uniforms:$u([Kr.common,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,Kr.fog,{matcap:{value:null}}]),vertexShader:Vs.meshmatcap_vert,fragmentShader:Vs.meshmatcap_frag},points:{uniforms:$u([Kr.points,Kr.fog]),vertexShader:Vs.points_vert,fragmentShader:Vs.points_frag},dashed:{uniforms:$u([Kr.common,Kr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Vs.linedashed_vert,fragmentShader:Vs.linedashed_frag},depth:{uniforms:$u([Kr.common,Kr.displacementmap]),vertexShader:Vs.depth_vert,fragmentShader:Vs.depth_frag},normal:{uniforms:$u([Kr.common,Kr.bumpmap,Kr.normalmap,Kr.displacementmap,{opacity:{value:1}}]),vertexShader:Vs.meshnormal_vert,fragmentShader:Vs.meshnormal_frag},sprite:{uniforms:$u([Kr.sprite,Kr.fog]),vertexShader:Vs.sprite_vert,fragmentShader:Vs.sprite_frag},background:{uniforms:{uvTransform:{value:new ru},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:Vs.background_vert,fragmentShader:Vs.background_frag},cube:{uniforms:$u([Kr.envmap,{opacity:{value:1}}]),vertexShader:Vs.cube_vert,fragmentShader:Vs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Vs.equirect_vert,fragmentShader:Vs.equirect_frag},distanceRGBA:{uniforms:$u([Kr.common,Kr.displacementmap,{referencePosition:{value:new dn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Vs.distanceRGBA_vert,fragmentShader:Vs.distanceRGBA_frag},shadow:{uniforms:$u([Kr.lights,Kr.fog,{color:{value:new ts(0)},opacity:{value:1}}]),vertexShader:Vs.shadow_vert,fragmentShader:Vs.shadow_frag}};function oD(ut,o,g,$,_e,rt){const at=new ts(0);let ct,ft,mt=_e===!0?0:1,bt=null,Mt=0,St=null;function It(Bt,Dt){g.buffers.color.setClear(Bt.r,Bt.g,Bt.b,Dt,rt)}return{getClearColor:function(){return at},setClearColor:function(Bt,Dt=1){at.set(Bt),mt=Dt,It(at,mt)},getClearAlpha:function(){return mt},setClearAlpha:function(Bt){mt=Bt,It(at,mt)},getPlaneMesh:function(){return ct},getBoxMesh:function(){return ft},getBoxMesh2:function(){return ft===void 0&&(ft=new cu(new Sm(1,1,1),new tv({name:"BackgroundCubeMaterial",uniforms:M_(Up.cube.uniforms),vertexShader:Up.cube.vertexShader,fragmentShader:Up.cube.fragmentShader,side:$t,depthTest:!1,depthWrite:!1,fog:!1})),ft.geometry.deleteAttribute("normal"),ft.geometry.deleteAttribute("uv"),ft.onBeforeRender=function(Bt,Dt,Ut){this.matrixWorld.copyPosition(Ut.matrixWorld)},Object.defineProperty(ft.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(ft)),ft},render:function(Bt,Dt){let Ut=!1,Ft=Dt.isScene===!0?Dt.background:null;Ft&&Ft.isTexture&&(Ft=o.get(Ft));const zt=ut.xr,Kt=zt.getSession&&zt.getSession();Kt&&Kt.environmentBlendMode==="additive"&&(Ft=null),Ft===null?It(at,mt):Ft&&Ft.isColor&&(It(Ft,1),Ut=!0),(ut.autoClear||Ut)&&ut.clear(ut.autoClearColor,ut.autoClearDepth,ut.autoClearStencil),Ft&&(Ft.isCubeTexture||Ft.mapping===Wu)?(ft===void 0&&(ft=new cu(new Sm(1,1,1),new tv({name:"BackgroundCubeMaterial",uniforms:M_(Up.cube.uniforms),vertexShader:Up.cube.vertexShader,fragmentShader:Up.cube.fragmentShader,side:$t,depthTest:!1,depthWrite:!1,fog:!1})),ft.geometry.deleteAttribute("normal"),ft.geometry.deleteAttribute("uv"),ft.onBeforeRender=function(tn,sn,ln){this.matrixWorld.copyPosition(ln.matrixWorld)},Object.defineProperty(ft.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),$.update(ft)),ft.material.uniforms.envMap.value=Ft,ft.material.uniforms.envMapRotation.value=Ft.rotation||0,ft.material.uniforms.flipEnvMap.value=Ft.isCubeTexture&&Ft.isRenderTargetTexture===!1?-1:1,bt===Ft&&Mt===Ft.version&&St===ut.toneMapping||(ft.material.needsUpdate=!0,bt=Ft,Mt=Ft.version,St=ut.toneMapping),ft.layers.enableAll(),Bt.unshift(ft,ft.geometry,ft.material,0,0,null)):Ft&&Ft.isTexture&&(ct===void 0&&(ct=new cu(new D_(2,2),new tv({name:"BackgroundMaterial",uniforms:M_(Up.background.uniforms),vertexShader:Up.background.vertexShader,fragmentShader:Up.background.fragmentShader,side:_n,depthTest:!1,depthWrite:!1,fog:!1})),ct.geometry.deleteAttribute("normal"),Object.defineProperty(ct.material,"map",{get:function(){return this.uniforms.t2D.value}}),$.update(ct)),ct.material.uniforms.t2D.value=Ft,ct.material.uniforms.flipX.value=Ft.userData.flipX||!1,ct.material.uniforms.flipY.value=Ft.userData.flipY||!1,Ft.matrixAutoUpdate===!0&&Ft.updateMatrix(),ct.material.uniforms.uvTransform.value.copy(Ft.matrix),bt===Ft&&Mt===Ft.version&&St===ut.toneMapping||(ct.material.needsUpdate=!0,bt=Ft,Mt=Ft.version,St=ut.toneMapping),ct.layers.enableAll(),Bt.unshift(ct,ct.geometry,ct.material,0,0,null))}}}function aD(ut,o,g,$){const _e=ut.getParameter(34921),rt=$.isWebGL2?null:o.get("OES_vertex_array_object"),at=$.isWebGL2||rt!==null,ct={},ft=It(null);let mt=ft,bt=!1;function Mt(sn){return $.isWebGL2?ut.bindVertexArray(sn):rt.bindVertexArrayOES(sn)}function St(sn){return $.isWebGL2?ut.deleteVertexArray(sn):rt.deleteVertexArrayOES(sn)}function It(sn){const ln=[],kn=[],Ln=[];for(let qn=0;qn<_e;qn++)ln[qn]=0,kn[qn]=0,Ln[qn]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:ln,enabledAttributes:kn,attributeDivisors:Ln,object:sn,attributes:{},index:null}}function Bt(){const sn=mt.newAttributes;for(let ln=0,kn=sn.length;ln<kn;ln++)sn[ln]=0}function Dt(sn){Ut(sn,0)}function Ut(sn,ln){const kn=mt.newAttributes,Ln=mt.enabledAttributes,qn=mt.attributeDivisors;kn[sn]=1,Ln[sn]===0&&(ut.enableVertexAttribArray(sn),Ln[sn]=1),qn[sn]!==ln&&(($.isWebGL2?ut:o.get("ANGLE_instanced_arrays"))[$.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](sn,ln),qn[sn]=ln)}function Ft(){const sn=mt.newAttributes,ln=mt.enabledAttributes;for(let kn=0,Ln=ln.length;kn<Ln;kn++)ln[kn]!==sn[kn]&&(ut.disableVertexAttribArray(kn),ln[kn]=0)}function zt(sn,ln,kn,Ln,qn,Kn){$.isWebGL2!==!0||kn!==5124&&kn!==5125?ut.vertexAttribPointer(sn,ln,kn,Ln,qn,Kn):ut.vertexAttribIPointer(sn,ln,kn,qn,Kn)}function Kt(){tn(),bt=!0,mt!==ft&&(mt=ft,Mt(mt.object))}function tn(){ft.geometry=null,ft.program=null,ft.wireframe=!1}return{setup:function(sn,ln,kn,Ln,qn){let Kn=!1;if(at){const Un=function(vr,Pr,mr){const Qr=mr.wireframe===!0;let Gr=ct[vr.id];Gr===void 0&&(Gr={},ct[vr.id]=Gr);let lr=Gr[Pr.id];lr===void 0&&(lr={},Gr[Pr.id]=lr);let dr=lr[Qr];return dr===void 0&&(dr=It($.isWebGL2?ut.createVertexArray():rt.createVertexArrayOES()),lr[Qr]=dr),dr}(Ln,kn,ln);mt!==Un&&(mt=Un,Mt(mt.object)),Kn=function(vr,Pr,mr,Qr){const Gr=mt.attributes,lr=Pr.attributes;let dr=0;const Or=mr.getAttributes();for(const _r in Or)if(Or[_r].location>=0){const Vr=Gr[_r];let fs=lr[_r];if(fs===void 0&&(_r==="instanceMatrix"&&vr.instanceMatrix&&(fs=vr.instanceMatrix),_r==="instanceColor"&&vr.instanceColor&&(fs=vr.instanceColor)),Vr===void 0||Vr.attribute!==fs||fs&&Vr.data!==fs.data)return!0;dr++}return mt.attributesNum!==dr||mt.index!==Qr}(sn,Ln,kn,qn),Kn&&function(vr,Pr,mr,Qr){const Gr={},lr=Pr.attributes;let dr=0;const Or=mr.getAttributes();for(const _r in Or)if(Or[_r].location>=0){let Vr=lr[_r];Vr===void 0&&(_r==="instanceMatrix"&&vr.instanceMatrix&&(Vr=vr.instanceMatrix),_r==="instanceColor"&&vr.instanceColor&&(Vr=vr.instanceColor));const fs={};fs.attribute=Vr,Vr&&Vr.data&&(fs.data=Vr.data),Gr[_r]=fs,dr++}mt.attributes=Gr,mt.attributesNum=dr,mt.index=Qr}(sn,Ln,kn,qn)}else{const Un=ln.wireframe===!0;mt.geometry===Ln.id&&mt.program===kn.id&&mt.wireframe===Un||(mt.geometry=Ln.id,mt.program=kn.id,mt.wireframe=Un,Kn=!0)}qn!==null&&g.update(qn,34963),(Kn||bt)&&(bt=!1,function(Un,vr,Pr,mr){if($.isWebGL2===!1&&(Un.isInstancedMesh||mr.isInstancedBufferGeometry)&&o.get("ANGLE_instanced_arrays")===null)return;Bt();const Qr=mr.attributes,Gr=Pr.getAttributes(),lr=vr.defaultAttributeValues;for(const dr in Gr){const Or=Gr[dr];if(Or.location>=0){let _r=Qr[dr];if(_r===void 0&&(dr==="instanceMatrix"&&Un.instanceMatrix&&(_r=Un.instanceMatrix),dr==="instanceColor"&&Un.instanceColor&&(_r=Un.instanceColor)),_r!==void 0){const Vr=_r.normalized,fs=_r.itemSize,Ks=g.get(_r);if(Ks===void 0)continue;const gs=Ks.buffer,Qs=Ks.type,In=Ks.bytesPerElement;if(_r.isInterleavedBufferAttribute){const yn=_r.data,tr=yn.stride,Wn=_r.offset;if(yn.isInstancedInterleavedBuffer){for(let Dn=0;Dn<Or.locationSize;Dn++)Ut(Or.location+Dn,yn.meshPerAttribute);Un.isInstancedMesh!==!0&&mr._maxInstanceCount===void 0&&(mr._maxInstanceCount=yn.meshPerAttribute*yn.count)}else for(let Dn=0;Dn<Or.locationSize;Dn++)Dt(Or.location+Dn);ut.bindBuffer(34962,gs);for(let Dn=0;Dn<Or.locationSize;Dn++)zt(Or.location+Dn,fs/Or.locationSize,Qs,Vr,tr*In,(Wn+fs/Or.locationSize*Dn)*In)}else{if(_r.isInstancedBufferAttribute){for(let yn=0;yn<Or.locationSize;yn++)Ut(Or.location+yn,_r.meshPerAttribute);Un.isInstancedMesh!==!0&&mr._maxInstanceCount===void 0&&(mr._maxInstanceCount=_r.meshPerAttribute*_r.count)}else for(let yn=0;yn<Or.locationSize;yn++)Dt(Or.location+yn);ut.bindBuffer(34962,gs);for(let yn=0;yn<Or.locationSize;yn++)zt(Or.location+yn,fs/Or.locationSize,Qs,Vr,fs*In,fs/Or.locationSize*yn*In)}}else if(lr!==void 0){const Vr=lr[dr];if(Vr!==void 0)switch(Vr.length){case 2:ut.vertexAttrib2fv(Or.location,Vr);break;case 3:ut.vertexAttrib3fv(Or.location,Vr);break;case 4:ut.vertexAttrib4fv(Or.location,Vr);break;default:ut.vertexAttrib1fv(Or.location,Vr)}}}}Ft()}(sn,ln,kn,Ln),qn!==null&&ut.bindBuffer(34963,g.get(qn).buffer))},reset:Kt,resetDefaultState:tn,dispose:function(){Kt();for(const sn in ct){const ln=ct[sn];for(const kn in ln){const Ln=ln[kn];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete ln[kn]}delete ct[sn]}},releaseStatesOfGeometry:function(sn){if(ct[sn.id]===void 0)return;const ln=ct[sn.id];for(const kn in ln){const Ln=ln[kn];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete ln[kn]}delete ct[sn.id]},releaseStatesOfProgram:function(sn){for(const ln in ct){const kn=ct[ln];if(kn[sn.id]===void 0)continue;const Ln=kn[sn.id];for(const qn in Ln)St(Ln[qn].object),delete Ln[qn];delete kn[sn.id]}},initAttributes:Bt,enableAttribute:Dt,disableUnusedAttributes:Ft}}function OM(ut,o,g,$){const _e=$.isWebGL2;let rt;this.setMode=function(at){rt=at},this.render=function(at,ct){ut.drawArrays(rt,at,ct),g.update(ct,rt,1)},this.renderInstances=function(at,ct,ft){if(ft===0)return;let mt,bt;if(_e)mt=ut,bt="drawArraysInstanced";else if(mt=o.get("ANGLE_instanced_arrays"),bt="drawArraysInstancedANGLE",mt===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");mt[bt](rt,at,ct,ft),g.update(ct,rt,ft)}}function NM(ut,o,g){let $;function _e(tn){if(tn==="highp"){if(ut.getShaderPrecisionFormat(35633,36338).precision>0&&ut.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";tn="mediump"}return tn==="mediump"&&ut.getShaderPrecisionFormat(35633,36337).precision>0&&ut.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const rt=typeof WebGL2RenderingContext<"u"&&ut instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&ut instanceof WebGL2ComputeRenderingContext;let at=g.precision!==void 0?g.precision:"highp";const ct=_e(at);ct!==at&&(console.warn("THREE.WebGLRenderer:",at,"not supported, using",ct,"instead."),at=ct);const ft=rt||o.has("WEBGL_draw_buffers"),mt=g.logarithmicDepthBuffer===!0,bt=ut.getParameter(34930),Mt=ut.getParameter(35660),St=ut.getParameter(3379),It=ut.getParameter(34076),Bt=ut.getParameter(34921),Dt=ut.getParameter(36347),Ut=ut.getParameter(36348),Ft=ut.getParameter(36349),zt=Mt>0,Kt=rt||o.has("OES_texture_float");return{isWebGL2:rt,drawBuffers:ft,getMaxAnisotropy:function(){if($!==void 0)return $;if(o.has("EXT_texture_filter_anisotropic")===!0){const tn=o.get("EXT_texture_filter_anisotropic");$=ut.getParameter(tn.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else $=0;return $},getMaxPrecision:_e,precision:at,logarithmicDepthBuffer:mt,maxTextures:bt,maxVertexTextures:Mt,maxTextureSize:St,maxCubemapSize:It,maxAttributes:Bt,maxVertexUniforms:Dt,maxVaryings:Ut,maxFragmentUniforms:Ft,vertexTextures:zt,floatFragmentTextures:Kt,floatVertexTextures:zt&&Kt,maxSamples:rt?ut.getParameter(36183):0}}function lD(ut){const o=this;let g=null,$=0,_e=!1,rt=!1;const at=new D0,ct=new ru,ft={value:null,needsUpdate:!1};function mt(){ft.value!==g&&(ft.value=g,ft.needsUpdate=$>0),o.numPlanes=$,o.numIntersection=0}function bt(Mt,St,It,Bt){const Dt=Mt!==null?Mt.length:0;let Ut=null;if(Dt!==0){if(Ut=ft.value,Bt!==!0||Ut===null){const Ft=It+4*Dt,zt=St.matrixWorldInverse;ct.getNormalMatrix(zt),(Ut===null||Ut.length<Ft)&&(Ut=new Float32Array(Ft));for(let Kt=0,tn=It;Kt!==Dt;++Kt,tn+=4)at.copy(Mt[Kt]).applyMatrix4(zt,ct),at.normal.toArray(Ut,tn),Ut[tn+3]=at.constant}ft.value=Ut,ft.needsUpdate=!0}return o.numPlanes=Dt,o.numIntersection=0,Ut}this.uniform=ft,this.numPlanes=0,this.numIntersection=0,this.init=function(Mt,St,It){const Bt=Mt.length!==0||St||$!==0||_e;return _e=St,g=bt(Mt,It,0),$=Mt.length,Bt},this.beginShadows=function(){rt=!0,bt(null)},this.endShadows=function(){rt=!1,mt()},this.setState=function(Mt,St,It){const Bt=Mt.clippingPlanes,Dt=Mt.clipIntersection,Ut=Mt.clipShadows,Ft=ut.get(Mt);if(!_e||Bt===null||Bt.length===0||rt&&!Ut)rt?bt(null):mt();else{const zt=rt?0:$,Kt=4*zt;let tn=Ft.clippingState||null;ft.value=tn,tn=bt(Bt,St,Kt,It);for(let sn=0;sn!==Kt;++sn)tn[sn]=g[sn];Ft.clippingState=tn,this.numIntersection=Dt?this.numPlanes:0,this.numPlanes+=zt}}}function cD(ut){let o=new WeakMap;function g(_e,rt){return rt===Gl?_e.mapping=ba:rt===To&&(_e.mapping=Ro),_e}function $(_e){const rt=_e.target;rt.removeEventListener("dispose",$);const at=o.get(rt);at!==void 0&&(o.delete(rt),at.dispose())}return{get:function(_e){if(_e&&_e.isTexture&&_e.isRenderTargetTexture===!1){const rt=_e.mapping;if(rt===Gl||rt===To){if(o.has(_e)){const at=o.get(_e).texture;return at.rotation=_e.rotation,g(at,_e.mapping)}{const at=_e.image;if(at&&at.height>0){const ct=new LM(at.height/2);return ct.fromEquirectangularTexture(ut,_e),ct.texture.rotation=_e.rotation,o.set(_e,ct),_e.addEventListener("dispose",$),g(ct.texture,_e.mapping)}return null}}}return _e},dispose:function(){o=new WeakMap}}}Up.physical={uniforms:$u([Up.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Cr(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new ts(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Cr},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ts(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ts(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Vs.meshphysical_vert,fragmentShader:Vs.meshphysical_frag};class C1 extends By{constructor(o=-1,g=1,$=1,_e=-1,rt=.1,at=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=o,this.right=g,this.top=$,this.bottom=_e,this.near=rt,this.far=at,this.updateProjectionMatrix()}copy(o,g){return super.copy(o,g),this.left=o.left,this.right=o.right,this.top=o.top,this.bottom=o.bottom,this.near=o.near,this.far=o.far,this.zoom=o.zoom,this.view=o.view===null?null:Object.assign({},o.view),this}setViewOffset(o,g,$,_e,rt,at){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=o,this.view.fullHeight=g,this.view.offsetX=$,this.view.offsetY=_e,this.view.width=rt,this.view.height=at,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const o=(this.right-this.left)/(2*this.zoom),g=(this.top-this.bottom)/(2*this.zoom),$=(this.right+this.left)/2,_e=(this.top+this.bottom)/2;let rt=$-o,at=$+o,ct=_e+g,ft=_e-g;if(this.view!==null&&this.view.enabled){const mt=(this.right-this.left)/this.view.fullWidth/this.zoom,bt=(this.top-this.bottom)/this.view.fullHeight/this.zoom;rt+=mt*this.view.offsetX,at=rt+mt*this.view.width,ct-=bt*this.view.offsetY,ft=ct-bt*this.view.height}this.projectionMatrix.makeOrthographic(rt,at,ct,ft,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(o){const g=super.toJSON(o);return g.object.zoom=this.zoom,g.object.left=this.left,g.object.right=this.right,g.object.top=this.top,g.object.bottom=this.bottom,g.object.near=this.near,g.object.far=this.far,this.view!==null&&(g.object.view=Object.assign({},this.view)),g}}const UM=[.125,.215,.35,.446,.526,.582],M1=new C1,T1=new ts;let I1=null;const Vv=(1+Math.sqrt(5))/2,PA=1/Vv,kS=[new dn(1,1,1),new dn(-1,1,1),new dn(1,1,-1),new dn(-1,1,-1),new dn(0,Vv,PA),new dn(0,Vv,-PA),new dn(PA,0,Vv),new dn(-PA,0,Vv),new dn(Vv,PA,0),new dn(-Vv,PA,0)];class D1{constructor(o){this._renderer=o,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(o,g=0,$=.1,_e=100){I1=this._renderer.getRenderTarget(),this._setSize(256);const rt=this._allocateTargets();return rt.depthBuffer=!0,this._sceneToCubeUV(o,$,_e,rt),g>0&&this._blur(rt,0,0,g),this._applyPMREM(rt),this._cleanup(rt),rt}fromEquirectangular(o,g=null){return this._fromTexture(o,g)}fromCubemap(o,g=null){return this._fromTexture(o,g)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=LS(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=P1(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(o){this._lodMax=Math.floor(Math.log2(o)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let o=0;o<this._lodPlanes.length;o++)this._lodPlanes[o].dispose()}_cleanup(o){this._renderer.setRenderTarget(I1),o.scissorTest=!1,Gs(o,0,0,o.width,o.height)}_fromTexture(o,g){o.mapping===ba||o.mapping===Ro?this._setSize(o.image.length===0?16:o.image[0].width||o.image[0].image.width):this._setSize(o.image.width/4),I1=this._renderer.getRenderTarget();const $=g||this._allocateTargets();return this._textureToCubeUV(o,$),this._applyPMREM($),this._cleanup($),$}_allocateTargets(){const o=3*Math.max(this._cubeSize,112),g=4*this._cubeSize,$={magFilter:Ko,minFilter:Ko,generateMipmaps:!1,type:_m,format:Yu,encoding:Jp,depthBuffer:!1},_e=FM(o,g,$);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==o){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=FM(o,g,$);const{_lodMax:rt}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(at){const ct=[],ft=[],mt=[];let bt=at;const Mt=at-4+1+UM.length;for(let St=0;St<Mt;St++){const It=Math.pow(2,bt);ft.push(It);let Bt=1/It;St>at-4?Bt=UM[St-at+4-1]:St===0&&(Bt=0),mt.push(Bt);const Dt=1/(It-2),Ut=-Dt,Ft=1+Dt,zt=[Ut,Ut,Ft,Ut,Ft,Ft,Ut,Ut,Ft,Ft,Ut,Ft],Kt=6,tn=6,sn=3,ln=2,kn=1,Ln=new Float32Array(sn*tn*Kt),qn=new Float32Array(ln*tn*Kt),Kn=new Float32Array(kn*tn*Kt);for(let vr=0;vr<Kt;vr++){const Pr=vr%3*2/3-1,mr=vr>2?0:-1,Qr=[Pr,mr,0,Pr+2/3,mr,0,Pr+2/3,mr+1,0,Pr,mr,0,Pr+2/3,mr+1,0,Pr,mr+1,0];Ln.set(Qr,sn*tn*vr),qn.set(zt,ln*tn*vr);const Gr=[vr,vr,vr,vr,vr,vr];Kn.set(Gr,kn*tn*vr)}const Un=new ls;Un.setAttribute("position",new Co(Ln,sn)),Un.setAttribute("uv",new Co(qn,ln)),Un.setAttribute("faceIndex",new Co(Kn,kn)),ct.push(Un),bt>4&&bt--}return{lodPlanes:ct,sizeLods:ft,sigmas:mt}}(rt)),this._blurMaterial=function(at,ct,ft){const mt=new Float32Array(20),bt=new dn(0,1,0);return new tv({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/ct,CUBEUV_TEXEL_HEIGHT:1/ft,CUBEUV_MAX_MIP:`${at}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:mt},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:bt}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Nt,depthTest:!1,depthWrite:!1})}(rt,o,g)}return _e}_compileMaterial(o){const g=new cu(this._lodPlanes[0],o);this._renderer.compile(g,M1)}_sceneToCubeUV(o,g,$,_e){const rt=new Su(90,1,g,$),at=[1,-1,1,1,1,1],ct=[1,1,1,-1,-1,-1],ft=this._renderer,mt=ft.autoClear,bt=ft.toneMapping;ft.getClearColor(T1),ft.toneMapping=Zs,ft.autoClear=!1;const Mt=new Em({name:"PMREM.Background",side:$t,depthWrite:!1,depthTest:!1}),St=new cu(new Sm,Mt);let It=!1;const Bt=o.background;Bt?Bt.isColor&&(Mt.color.copy(Bt),o.background=null,It=!0):(Mt.color.copy(T1),It=!0);for(let Dt=0;Dt<6;Dt++){const Ut=Dt%3;Ut===0?(rt.up.set(0,at[Dt],0),rt.lookAt(ct[Dt],0,0)):Ut===1?(rt.up.set(0,0,at[Dt]),rt.lookAt(0,ct[Dt],0)):(rt.up.set(0,at[Dt],0),rt.lookAt(0,0,ct[Dt]));const Ft=this._cubeSize;Gs(_e,Ut*Ft,Dt>2?Ft:0,Ft,Ft),ft.setRenderTarget(_e),It&&ft.render(St,rt),ft.render(o,rt)}St.geometry.dispose(),St.material.dispose(),ft.toneMapping=bt,ft.autoClear=mt,o.background=Bt}_textureToCubeUV(o,g){const $=this._renderer,_e=o.mapping===ba||o.mapping===Ro;_e?(this._cubemapMaterial===null&&(this._cubemapMaterial=LS()),this._cubemapMaterial.uniforms.flipEnvMap.value=o.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=P1());const rt=_e?this._cubemapMaterial:this._equirectMaterial,at=new cu(this._lodPlanes[0],rt);rt.uniforms.envMap.value=o;const ct=this._cubeSize;Gs(g,0,0,3*ct,2*ct),$.setRenderTarget(g),$.render(at,M1)}_applyPMREM(o){const g=this._renderer,$=g.autoClear;g.autoClear=!1;for(let _e=1;_e<this._lodPlanes.length;_e++){const rt=Math.sqrt(this._sigmas[_e]*this._sigmas[_e]-this._sigmas[_e-1]*this._sigmas[_e-1]),at=kS[(_e-1)%kS.length];this._blur(o,_e-1,_e,rt,at)}g.autoClear=$}_blur(o,g,$,_e,rt){const at=this._pingPongRenderTarget;this._halfBlur(o,at,g,$,_e,"latitudinal",rt),this._halfBlur(at,o,$,$,_e,"longitudinal",rt)}_halfBlur(o,g,$,_e,rt,at,ct){const ft=this._renderer,mt=this._blurMaterial;at!=="latitudinal"&&at!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const bt=new cu(this._lodPlanes[_e],mt),Mt=mt.uniforms,St=this._sizeLods[$]-1,It=isFinite(rt)?Math.PI/(2*St):2*Math.PI/39,Bt=rt/It,Dt=isFinite(rt)?1+Math.floor(3*Bt):20;Dt>20&&console.warn(`sigmaRadians, ${rt}, is too large and will clip, as it requested ${Dt} samples when the maximum is set to 20`);const Ut=[];let Ft=0;for(let tn=0;tn<20;++tn){const sn=tn/Bt,ln=Math.exp(-sn*sn/2);Ut.push(ln),tn===0?Ft+=ln:tn<Dt&&(Ft+=2*ln)}for(let tn=0;tn<Ut.length;tn++)Ut[tn]=Ut[tn]/Ft;Mt.envMap.value=o.texture,Mt.samples.value=Dt,Mt.weights.value=Ut,Mt.latitudinal.value=at==="latitudinal",ct&&(Mt.poleAxis.value=ct);const{_lodMax:zt}=this;Mt.dTheta.value=It,Mt.mipInt.value=zt-$;const Kt=this._sizeLods[_e];Gs(g,3*Kt*(_e>zt-4?_e-zt+4:0),4*(this._cubeSize-Kt),3*Kt,2*Kt),ft.setRenderTarget(g),ft.render(bt,M1)}}function FM(ut,o,g){const $=new Ku(ut,o,g);return $.texture.mapping=Wu,$.texture.name="PMREM.cubeUv",$.scissorTest=!0,$}function Gs(ut,o,g,$,_e){ut.viewport.set(o,g,$,_e),ut.scissor.set(o,g,$,_e)}function P1(){return new tv({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Nt,depthTest:!1,depthWrite:!1})}function LS(){return new tv({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Nt,depthTest:!1,depthWrite:!1})}function jM(ut){let o=new WeakMap,g=null;function $(_e){const rt=_e.target;rt.removeEventListener("dispose",$);const at=o.get(rt);at!==void 0&&(o.delete(rt),at.dispose())}return{get:function(_e){if(_e&&_e.isTexture){const rt=_e.mapping,at=rt===Gl||rt===To,ct=rt===ba||rt===Ro;if(at||ct){if(_e.isRenderTargetTexture&&_e.needsPMREMUpdate===!0){_e.needsPMREMUpdate=!1;let ft=o.get(_e);return g===null&&(g=new D1(ut)),ft=at?g.fromEquirectangular(_e,ft):g.fromCubemap(_e,ft),o.set(_e,ft),ft.texture}if(o.has(_e))return o.get(_e).texture;{const ft=_e.image;if(at&&ft&&ft.height>0||ct&&ft&&function(mt){let bt=0;for(let Mt=0;Mt<6;Mt++)mt[Mt]!==void 0&&bt++;return bt===6}(ft)){g===null&&(g=new D1(ut));const mt=at?g.fromEquirectangular(_e):g.fromCubemap(_e);return o.set(_e,mt),_e.addEventListener("dispose",$),mt.texture}return null}}}return _e},dispose:function(){o=new WeakMap,g!==null&&(g.dispose(),g=null)}}}function Yr(ut){const o={};function g($){if(o[$]!==void 0)return o[$];let _e;switch($){case"WEBGL_depth_texture":_e=ut.getExtension("WEBGL_depth_texture")||ut.getExtension("MOZ_WEBGL_depth_texture")||ut.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":_e=ut.getExtension("EXT_texture_filter_anisotropic")||ut.getExtension("MOZ_EXT_texture_filter_anisotropic")||ut.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":_e=ut.getExtension("WEBGL_compressed_texture_s3tc")||ut.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":_e=ut.getExtension("WEBGL_compressed_texture_pvrtc")||ut.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:_e=ut.getExtension($)}return o[$]=_e,_e}return{has:function($){return g($)!==null},init:function($){$.isWebGL2?g("EXT_color_buffer_float"):(g("WEBGL_depth_texture"),g("OES_texture_float"),g("OES_texture_half_float"),g("OES_texture_half_float_linear"),g("OES_standard_derivatives"),g("OES_element_index_uint"),g("OES_vertex_array_object"),g("ANGLE_instanced_arrays")),g("OES_texture_float_linear"),g("EXT_color_buffer_half_float"),g("WEBGL_multisampled_render_to_texture")},get:function($){const _e=g($);return _e===null&&console.warn("THREE.WebGLRenderer: "+$+" extension not supported."),_e}}}function Ns(ut,o,g,$){const _e={},rt=new WeakMap;function at(ft){const mt=ft.target;mt.index!==null&&o.remove(mt.index);for(const Mt in mt.attributes)o.remove(mt.attributes[Mt]);mt.removeEventListener("dispose",at),delete _e[mt.id];const bt=rt.get(mt);bt&&(o.remove(bt),rt.delete(mt)),$.releaseStatesOfGeometry(mt),mt.isInstancedBufferGeometry===!0&&delete mt._maxInstanceCount,g.memory.geometries--}function ct(ft){const mt=[],bt=ft.index,Mt=ft.attributes.position;let St=0;if(bt!==null){const Dt=bt.array;St=bt.version;for(let Ut=0,Ft=Dt.length;Ut<Ft;Ut+=3){const zt=Dt[Ut+0],Kt=Dt[Ut+1],tn=Dt[Ut+2];mt.push(zt,Kt,Kt,tn,tn,zt)}}else{const Dt=Mt.array;St=Mt.version;for(let Ut=0,Ft=Dt.length/3-1;Ut<Ft;Ut+=3){const zt=Ut+0,Kt=Ut+1,tn=Ut+2;mt.push(zt,Kt,Kt,tn,tn,zt)}}const It=new(w1(mt)?At:na)(mt,1);It.version=St;const Bt=rt.get(ft);Bt&&o.remove(Bt),rt.set(ft,It)}return{get:function(ft,mt){return _e[mt.id]===!0||(mt.addEventListener("dispose",at),_e[mt.id]=!0,g.memory.geometries++),mt},update:function(ft){const mt=ft.attributes;for(const Mt in mt)o.update(mt[Mt],34962);const bt=ft.morphAttributes;for(const Mt in bt){const St=bt[Mt];for(let It=0,Bt=St.length;It<Bt;It++)o.update(St[It],34962)}},getWireframeAttribute:function(ft){const mt=rt.get(ft);if(mt){const bt=ft.index;bt!==null&&mt.version<bt.version&&ct(ft)}else ct(ft);return rt.get(ft)}}}function Oy(ut,o,g,$){const _e=$.isWebGL2;let rt,at,ct;this.setMode=function(ft){rt=ft},this.setIndex=function(ft){at=ft.type,ct=ft.bytesPerElement},this.render=function(ft,mt){ut.drawElements(rt,mt,at,ft*ct),g.update(mt,rt,1)},this.renderInstances=function(ft,mt,bt){if(bt===0)return;let Mt,St;if(_e)Mt=ut,St="drawElementsInstanced";else if(Mt=o.get("ANGLE_instanced_arrays"),St="drawElementsInstancedANGLE",Mt===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");Mt[St](rt,mt,at,ft*ct,bt),g.update(mt,rt,bt)}}function nv(ut){const o={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:o,programs:null,autoReset:!0,reset:function(){o.frame++,o.calls=0,o.triangles=0,o.points=0,o.lines=0},update:function(g,$,_e){switch(o.calls++,$){case 4:o.triangles+=_e*(g/3);break;case 1:o.lines+=_e*(g/2);break;case 3:o.lines+=_e*(g-1);break;case 2:o.lines+=_e*g;break;case 0:o.points+=_e*g;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",$)}}}}function OS(ut,o){return ut[0]-o[0]}function NS(ut,o){return Math.abs(o[1])-Math.abs(ut[1])}function zM(ut,o,g){const $={},_e=new Float32Array(8),rt=new WeakMap,at=new fo,ct=[];for(let ft=0;ft<8;ft++)ct[ft]=[ft,0];return{update:function(ft,mt,bt,Mt){const St=ft.morphTargetInfluences;if(o.isWebGL2===!0){const It=mt.morphAttributes.position||mt.morphAttributes.normal||mt.morphAttributes.color,Bt=It!==void 0?It.length:0;let Dt=rt.get(mt);if(Dt===void 0||Dt.count!==Bt){Dt!==void 0&&Dt.texture.dispose();const zt=mt.morphAttributes.position!==void 0,Kt=mt.morphAttributes.normal!==void 0,tn=mt.morphAttributes.color!==void 0,sn=mt.morphAttributes.position||[],ln=mt.morphAttributes.normal||[],kn=mt.morphAttributes.color||[];let Ln=0;zt===!0&&(Ln=1),Kt===!0&&(Ln=2),tn===!0&&(Ln=3);let qn=mt.attributes.position.count*Ln,Kn=1;qn>o.maxTextureSize&&(Kn=Math.ceil(qn/o.maxTextureSize),qn=o.maxTextureSize);const Un=new Float32Array(qn*Kn*4*Bt),vr=new __(Un,qn,Kn,Bt);vr.type=Hl,vr.needsUpdate=!0;const Pr=4*Ln;for(let mr=0;mr<Bt;mr++){const Qr=sn[mr],Gr=ln[mr],lr=kn[mr],dr=qn*Kn*4*mr;for(let Or=0;Or<Qr.count;Or++){const _r=Or*Pr;zt===!0&&(at.fromBufferAttribute(Qr,Or),Un[dr+_r+0]=at.x,Un[dr+_r+1]=at.y,Un[dr+_r+2]=at.z,Un[dr+_r+3]=0),Kt===!0&&(at.fromBufferAttribute(Gr,Or),Un[dr+_r+4]=at.x,Un[dr+_r+5]=at.y,Un[dr+_r+6]=at.z,Un[dr+_r+7]=0),tn===!0&&(at.fromBufferAttribute(lr,Or),Un[dr+_r+8]=at.x,Un[dr+_r+9]=at.y,Un[dr+_r+10]=at.z,Un[dr+_r+11]=lr.itemSize===4?at.w:1)}}Dt={count:Bt,texture:vr,size:new Cr(qn,Kn)},rt.set(mt,Dt),mt.addEventListener("dispose",function mr(){vr.dispose(),rt.delete(mt),mt.removeEventListener("dispose",mr)})}let Ut=0;for(let zt=0;zt<St.length;zt++)Ut+=St[zt];const Ft=mt.morphTargetsRelative?1:1-Ut;Mt.getUniforms().setValue(ut,"morphTargetBaseInfluence",Ft),Mt.getUniforms().setValue(ut,"morphTargetInfluences",St),Mt.getUniforms().setValue(ut,"morphTargetsTexture",Dt.texture,g),Mt.getUniforms().setValue(ut,"morphTargetsTextureSize",Dt.size)}else{const It=St===void 0?0:St.length;let Bt=$[mt.id];if(Bt===void 0||Bt.length!==It){Bt=[];for(let Kt=0;Kt<It;Kt++)Bt[Kt]=[Kt,0];$[mt.id]=Bt}for(let Kt=0;Kt<It;Kt++){const tn=Bt[Kt];tn[0]=Kt,tn[1]=St[Kt]}Bt.sort(NS);for(let Kt=0;Kt<8;Kt++)Kt<It&&Bt[Kt][1]?(ct[Kt][0]=Bt[Kt][0],ct[Kt][1]=Bt[Kt][1]):(ct[Kt][0]=Number.MAX_SAFE_INTEGER,ct[Kt][1]=0);ct.sort(OS);const Dt=mt.morphAttributes.position,Ut=mt.morphAttributes.normal;let Ft=0;for(let Kt=0;Kt<8;Kt++){const tn=ct[Kt],sn=tn[0],ln=tn[1];sn!==Number.MAX_SAFE_INTEGER&&ln?(Dt&&mt.getAttribute("morphTarget"+Kt)!==Dt[sn]&&mt.setAttribute("morphTarget"+Kt,Dt[sn]),Ut&&mt.getAttribute("morphNormal"+Kt)!==Ut[sn]&&mt.setAttribute("morphNormal"+Kt,Ut[sn]),_e[Kt]=ln,Ft+=ln):(Dt&&mt.hasAttribute("morphTarget"+Kt)===!0&&mt.deleteAttribute("morphTarget"+Kt),Ut&&mt.hasAttribute("morphNormal"+Kt)===!0&&mt.deleteAttribute("morphNormal"+Kt),_e[Kt]=0)}const zt=mt.morphTargetsRelative?1:1-Ft;Mt.getUniforms().setValue(ut,"morphTargetBaseInfluence",zt),Mt.getUniforms().setValue(ut,"morphTargetInfluences",_e)}}}}function Bo(ut,o,g,$){let _e=new WeakMap;function rt(at){const ct=at.target;ct.removeEventListener("dispose",rt),g.remove(ct.instanceMatrix),ct.instanceColor!==null&&g.remove(ct.instanceColor)}return{update:function(at){const ct=$.render.frame,ft=at.geometry,mt=o.get(at,ft);return _e.get(mt)!==ct&&(o.update(mt),_e.set(mt,ct)),at.isInstancedMesh&&(at.hasEventListener("dispose",rt)===!1&&at.addEventListener("dispose",rt),g.update(at.instanceMatrix,34962),at.instanceColor!==null&&g.update(at.instanceColor,34962)),mt},dispose:function(){_e=new WeakMap}}}const VM=new zl,US=new __,FS=new b0,jS=new ky,QM=[],R1=[],zS=new Float32Array(16),Cm=new Float32Array(9),iv=new Float32Array(4);function Ny(ut,o,g){const $=ut[0];if($<=0||$>0)return ut;const _e=o*g;let rt=QM[_e];if(rt===void 0&&(rt=new Float32Array(_e),QM[_e]=rt),o!==0){$.toArray(rt,0);for(let at=1,ct=0;at!==o;++at)ct+=g,ut[at].toArray(rt,ct)}return rt}function Cu(ut,o){if(ut.length!==o.length)return!1;for(let g=0,$=ut.length;g<$;g++)if(ut[g]!==o[g])return!1;return!0}function Tl(ut,o){for(let g=0,$=o.length;g<$;g++)ut[g]=o[g]}function zw(ut,o){let g=R1[o];g===void 0&&(g=new Int32Array(o),R1[o]=g);for(let $=0;$!==o;++$)g[$]=ut.allocateTextureUnit();return g}function Vw(ut,o){const g=this.cache;g[0]!==o&&(ut.uniform1f(this.addr,o),g[0]=o)}function VS(ut,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y||(ut.uniform2f(this.addr,o.x,o.y),g[0]=o.x,g[1]=o.y);else{if(Cu(g,o))return;ut.uniform2fv(this.addr,o),Tl(g,o)}}function Qw(ut,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z||(ut.uniform3f(this.addr,o.x,o.y,o.z),g[0]=o.x,g[1]=o.y,g[2]=o.z);else if(o.r!==void 0)g[0]===o.r&&g[1]===o.g&&g[2]===o.b||(ut.uniform3f(this.addr,o.r,o.g,o.b),g[0]=o.r,g[1]=o.g,g[2]=o.b);else{if(Cu(g,o))return;ut.uniform3fv(this.addr,o),Tl(g,o)}}function GM(ut,o){const g=this.cache;if(o.x!==void 0)g[0]===o.x&&g[1]===o.y&&g[2]===o.z&&g[3]===o.w||(ut.uniform4f(this.addr,o.x,o.y,o.z,o.w),g[0]=o.x,g[1]=o.y,g[2]=o.z,g[3]=o.w);else{if(Cu(g,o))return;ut.uniform4fv(this.addr,o),Tl(g,o)}}function QS(ut,o){const g=this.cache,$=o.elements;if($===void 0){if(Cu(g,o))return;ut.uniformMatrix2fv(this.addr,!1,o),Tl(g,o)}else{if(Cu(g,$))return;iv.set($),ut.uniformMatrix2fv(this.addr,!1,iv),Tl(g,$)}}function Nu(ut,o){const g=this.cache,$=o.elements;if($===void 0){if(Cu(g,o))return;ut.uniformMatrix3fv(this.addr,!1,o),Tl(g,o)}else{if(Cu(g,$))return;Cm.set($),ut.uniformMatrix3fv(this.addr,!1,Cm),Tl(g,$)}}function rv(ut,o){const g=this.cache,$=o.elements;if($===void 0){if(Cu(g,o))return;ut.uniformMatrix4fv(this.addr,!1,o),Tl(g,o)}else{if(Cu(g,$))return;zS.set($),ut.uniformMatrix4fv(this.addr,!1,zS),Tl(g,$)}}function Gw(ut,o){const g=this.cache;g[0]!==o&&(ut.uniform1i(this.addr,o),g[0]=o)}function B1(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform2iv(this.addr,o),Tl(g,o))}function sv(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform3iv(this.addr,o),Tl(g,o))}function GS(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform4iv(this.addr,o),Tl(g,o))}function k1(ut,o){const g=this.cache;g[0]!==o&&(ut.uniform1ui(this.addr,o),g[0]=o)}function HM(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform2uiv(this.addr,o),Tl(g,o))}function L1(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform3uiv(this.addr,o),Tl(g,o))}function ov(ut,o){const g=this.cache;Cu(g,o)||(ut.uniform4uiv(this.addr,o),Tl(g,o))}function im(ut,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),g.setTexture2D(o||VM,_e)}function O1(ut,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),g.setTexture3D(o||FS,_e)}function WM(ut,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),g.setTextureCube(o||jS,_e)}function N1(ut,o,g){const $=this.cache,_e=g.allocateTextureUnit();$[0]!==_e&&(ut.uniform1i(this.addr,_e),$[0]=_e),g.setTexture2DArray(o||US,_e)}function qM(ut,o){ut.uniform1fv(this.addr,o)}function HS(ut,o){const g=Ny(o,this.size,2);ut.uniform2fv(this.addr,g)}function U1(ut,o){const g=Ny(o,this.size,3);ut.uniform3fv(this.addr,g)}function YM(ut,o){const g=Ny(o,this.size,4);ut.uniform4fv(this.addr,g)}function XM(ut,o){const g=Ny(o,this.size,4);ut.uniformMatrix2fv(this.addr,!1,g)}function uD(ut,o){const g=Ny(o,this.size,9);ut.uniformMatrix3fv(this.addr,!1,g)}function KM(ut,o){const g=Ny(o,this.size,16);ut.uniformMatrix4fv(this.addr,!1,g)}function JM(ut,o){ut.uniform1iv(this.addr,o)}function ZM(ut,o){ut.uniform2iv(this.addr,o)}function Fp(ut,o){ut.uniform3iv(this.addr,o)}function jo(ut,o){ut.uniform4iv(this.addr,o)}function $M(ut,o){ut.uniform1uiv(this.addr,o)}function RA(ut,o){ut.uniform2uiv(this.addr,o)}function jp(ut,o){ut.uniform3uiv(this.addr,o)}function P_(ut,o){ut.uniform4uiv(this.addr,o)}function xl(ut,o,g){const $=o.length,_e=zw(g,$);ut.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture2D(o[rt]||VM,_e[rt])}function eT(ut,o,g){const $=o.length,_e=zw(g,$);ut.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture3D(o[rt]||FS,_e[rt])}function WS(ut,o,g){const $=o.length,_e=zw(g,$);ut.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTextureCube(o[rt]||jS,_e[rt])}function tT(ut,o,g){const $=o.length,_e=zw(g,$);ut.uniform1iv(this.addr,_e);for(let rt=0;rt!==$;++rt)g.setTexture2DArray(o[rt]||US,_e[rt])}class nT{constructor(o,g,$){this.id=o,this.addr=$,this.cache=[],this.setValue=function(_e){switch(_e){case 5126:return Vw;case 35664:return VS;case 35665:return Qw;case 35666:return GM;case 35674:return QS;case 35675:return Nu;case 35676:return rv;case 5124:case 35670:return Gw;case 35667:case 35671:return B1;case 35668:case 35672:return sv;case 35669:case 35673:return GS;case 5125:return k1;case 36294:return HM;case 36295:return L1;case 36296:return ov;case 35678:case 36198:case 36298:case 36306:case 35682:return im;case 35679:case 36299:case 36307:return O1;case 35680:case 36300:case 36308:case 36293:return WM;case 36289:case 36303:case 36311:case 36292:return N1}}(g.type)}}class iT{constructor(o,g,$){this.id=o,this.addr=$,this.cache=[],this.size=g.size,this.setValue=function(_e){switch(_e){case 5126:return qM;case 35664:return HS;case 35665:return U1;case 35666:return YM;case 35674:return XM;case 35675:return uD;case 35676:return KM;case 5124:case 35670:return JM;case 35667:case 35671:return ZM;case 35668:case 35672:return Fp;case 35669:case 35673:return jo;case 5125:return $M;case 36294:return RA;case 36295:return jp;case 36296:return P_;case 35678:case 36198:case 36298:case 36306:case 35682:return xl;case 35679:case 36299:case 36307:return eT;case 35680:case 36300:case 36308:case 36293:return WS;case 36289:case 36303:case 36311:case 36292:return tT}}(g.type)}}class hD{constructor(o){this.id=o,this.seq=[],this.map={}}setValue(o,g,$){const _e=this.seq;for(let rt=0,at=_e.length;rt!==at;++rt){const ct=_e[rt];ct.setValue(o,g[ct.id],$)}}}const qS=/(\w+)(\])?(\[|\.)?/g;function rT(ut,o){ut.seq.push(o),ut.map[o.id]=o}function dD(ut,o,g){const $=ut.name,_e=$.length;for(qS.lastIndex=0;;){const rt=qS.exec($),at=qS.lastIndex;let ct=rt[1];const ft=rt[2]==="]",mt=rt[3];if(ft&&(ct|=0),mt===void 0||mt==="["&&at+2===_e){rT(g,mt===void 0?new nT(ct,ut,o):new iT(ct,ut,o));break}{let bt=g.map[ct];bt===void 0&&(bt=new hD(ct),rT(g,bt)),g=bt}}}class F1{constructor(o,g){this.seq=[],this.map={};const $=o.getProgramParameter(g,35718);for(let _e=0;_e<$;++_e){const rt=o.getActiveUniform(g,_e);dD(rt,o.getUniformLocation(g,rt.name),this)}}setValue(o,g,$,_e){const rt=this.map[g];rt!==void 0&&rt.setValue(o,$,_e)}setOptional(o,g,$){const _e=g[$];_e!==void 0&&this.setValue(o,$,_e)}static upload(o,g,$,_e){for(let rt=0,at=g.length;rt!==at;++rt){const ct=g[rt],ft=$[ct.id];ft.needsUpdate!==!1&&ct.setValue(o,ft.value,_e)}}static seqWithValue(o,g){const $=[];for(let _e=0,rt=o.length;_e!==rt;++_e){const at=o[_e];at.id in g&&$.push(at)}return $}}function sT(ut,o,g){const $=ut.createShader(o);return ut.shaderSource($,g),ut.compileShader($),$}let YS=0;function Hw(ut){switch(ut){case Jp:return["Linear","( value )"];case Xs:return["sRGB","( value )"];case f0:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",ut),["Linear","( value )"]}}function zo(ut,o,g){const $=ut.getShaderParameter(o,35713),_e=ut.getShaderInfoLog(o).trim();if($&&_e==="")return"";const rt=/ERROR: 0:(\d+)/.exec(_e);if(rt){const at=parseInt(rt[1]);return g.toUpperCase()+`

`+_e+`

`+function(ct,ft){const mt=ct.split(`
`),bt=[],Mt=Math.max(ft-6,0),St=Math.min(ft+6,mt.length);for(let It=Mt;It<St;It++){const Bt=It+1;bt.push(`${Bt===ft?">":" "} ${Bt}: ${mt[It]}`)}return bt.join(`
`)}(ut.getShaderSource(o),at)}return _e}function oT(ut,o){const g=Hw(o);return"vec4 "+ut+"( vec4 value ) { return "+g[0]+"ToLinear"+g[1]+"; }"}function aT(ut,o){const g=Hw(o);return"vec4 "+ut+"( vec4 value ) { return LinearTo"+g[0]+g[1]+"; }"}function j1(ut,o){let g;switch(o){case Lo:g="Linear";break;case $s:g="Reinhard";break;case qo:g="OptimizedCineon";break;case yo:g="ACESFilmic";break;case Hu:g="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",o),g="Linear"}return"vec3 "+ut+"( vec3 color ) { return "+g+"ToneMapping( color ); }"}function R_(ut){return ut!==""}function av(ut,o){const g=o.numSpotLightShadows+o.numSpotLightMaps-o.numSpotLightShadowsWithMaps;return ut.replace(/NUM_DIR_LIGHTS/g,o.numDirLights).replace(/NUM_SPOT_LIGHTS/g,o.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,o.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,g).replace(/NUM_RECT_AREA_LIGHTS/g,o.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,o.numPointLights).replace(/NUM_HEMI_LIGHTS/g,o.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,o.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,o.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,o.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,o.numPointLightShadows)}function XS(ut,o){return ut.replace(/NUM_CLIPPING_PLANES/g,o.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,o.numClippingPlanes-o.numClipIntersection)}const Ww=/^[ \t]*#include +<([\w\d./]+)>/gm;function R0(ut){return ut.replace(Ww,qw)}function qw(ut,o){const g=Vs[o];if(g===void 0)throw new Error("Can not resolve #include <"+o+">");return R0(g)}const z1=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Uy(ut){return ut.replace(z1,Yw)}function Yw(ut,o,g,$){let _e="";for(let rt=parseInt(o);rt<parseInt(g);rt++)_e+=$.replace(/\[\s*i\s*\]/g,"[ "+rt+" ]").replace(/UNROLLED_LOOP_INDEX/g,rt);return _e}function lT(ut){let o="precision "+ut.precision+` float;
precision `+ut.precision+" int;";return ut.precision==="highp"?o+=`
#define HIGH_PRECISION`:ut.precision==="mediump"?o+=`
#define MEDIUM_PRECISION`:ut.precision==="lowp"&&(o+=`
#define LOW_PRECISION`),o}function pD(ut,o,g,$){const _e=ut.getContext(),rt=g.defines;let at=g.vertexShader,ct=g.fragmentShader;const ft=function(Ln){let qn="SHADOWMAP_TYPE_BASIC";return Ln.shadowMapType===mn?qn="SHADOWMAP_TYPE_PCF":Ln.shadowMapType===hn?qn="SHADOWMAP_TYPE_PCF_SOFT":Ln.shadowMapType===wn&&(qn="SHADOWMAP_TYPE_VSM"),qn}(g),mt=function(Ln){let qn="ENVMAP_TYPE_CUBE";if(Ln.envMap)switch(Ln.envMapMode){case ba:case Ro:qn="ENVMAP_TYPE_CUBE";break;case Wu:qn="ENVMAP_TYPE_CUBE_UV"}return qn}(g),bt=function(Ln){let qn="ENVMAP_MODE_REFLECTION";return Ln.envMap&&Ln.envMapMode===Ro&&(qn="ENVMAP_MODE_REFRACTION"),qn}(g),Mt=function(Ln){let qn="ENVMAP_BLENDING_NONE";if(Ln.envMap)switch(Ln.combine){case Ss:qn="ENVMAP_BLENDING_MULTIPLY";break;case zs:qn="ENVMAP_BLENDING_MIX";break;case Ao:qn="ENVMAP_BLENDING_ADD"}return qn}(g),St=function(Ln){const qn=Ln.envMapCubeUVHeight;if(qn===null)return null;const Kn=Math.log2(qn)-2,Un=1/qn;return{texelWidth:1/(3*Math.max(Math.pow(2,Kn),112)),texelHeight:Un,maxMip:Kn}}(g),It=g.isWebGL2?"":function(Ln){return[Ln.extensionDerivatives||Ln.envMapCubeUVHeight||Ln.bumpMap||Ln.tangentSpaceNormalMap||Ln.clearcoatNormalMap||Ln.flatShading||Ln.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ln.extensionFragDepth||Ln.logarithmicDepthBuffer)&&Ln.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ln.extensionDrawBuffers&&Ln.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ln.extensionShaderTextureLOD||Ln.envMap||Ln.transmission)&&Ln.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(R_).join(`
`)}(g),Bt=function(Ln){const qn=[];for(const Kn in Ln){const Un=Ln[Kn];Un!==!1&&qn.push("#define "+Kn+" "+Un)}return qn.join(`
`)}(rt),Dt=_e.createProgram();let Ut,Ft,zt=g.glslVersion?"#version "+g.glslVersion+`
`:"";g.isRawShaderMaterial?(Ut=[Bt].filter(R_).join(`
`),Ut.length>0&&(Ut+=`
`),Ft=[It,Bt].filter(R_).join(`
`),Ft.length>0&&(Ft+=`
`)):(Ut=[lT(g),"#define SHADER_NAME "+g.shaderName,Bt,g.instancing?"#define USE_INSTANCING":"",g.instancingColor?"#define USE_INSTANCING_COLOR":"",g.supportsVertexTextures?"#define VERTEX_TEXTURES":"",g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+bt:"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.displacementMap&&g.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.flatShading?"#define FLAT_SHADED":"",g.skinning?"#define USE_SKINNING":"",g.morphTargets?"#define USE_MORPHTARGETS":"",g.morphNormals&&g.flatShading===!1?"#define USE_MORPHNORMALS":"",g.morphColors&&g.isWebGL2?"#define USE_MORPHCOLORS":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+g.morphTextureStride:"",g.morphTargetsCount>0&&g.isWebGL2?"#define MORPHTARGETS_COUNT "+g.morphTargetsCount:"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+ft:"",g.sizeAttenuation?"#define USE_SIZEATTENUATION":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(R_).join(`
`),Ft=[It,lT(g),"#define SHADER_NAME "+g.shaderName,Bt,g.useFog&&g.fog?"#define USE_FOG":"",g.useFog&&g.fogExp2?"#define FOG_EXP2":"",g.map?"#define USE_MAP":"",g.matcap?"#define USE_MATCAP":"",g.envMap?"#define USE_ENVMAP":"",g.envMap?"#define "+mt:"",g.envMap?"#define "+bt:"",g.envMap?"#define "+Mt:"",St?"#define CUBEUV_TEXEL_WIDTH "+St.texelWidth:"",St?"#define CUBEUV_TEXEL_HEIGHT "+St.texelHeight:"",St?"#define CUBEUV_MAX_MIP "+St.maxMip+".0":"",g.lightMap?"#define USE_LIGHTMAP":"",g.aoMap?"#define USE_AOMAP":"",g.emissiveMap?"#define USE_EMISSIVEMAP":"",g.bumpMap?"#define USE_BUMPMAP":"",g.normalMap?"#define USE_NORMALMAP":"",g.normalMap&&g.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",g.normalMap&&g.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",g.clearcoat?"#define USE_CLEARCOAT":"",g.clearcoatMap?"#define USE_CLEARCOATMAP":"",g.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",g.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",g.iridescence?"#define USE_IRIDESCENCE":"",g.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",g.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",g.specularMap?"#define USE_SPECULARMAP":"",g.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",g.specularColorMap?"#define USE_SPECULARCOLORMAP":"",g.roughnessMap?"#define USE_ROUGHNESSMAP":"",g.metalnessMap?"#define USE_METALNESSMAP":"",g.alphaMap?"#define USE_ALPHAMAP":"",g.alphaTest?"#define USE_ALPHATEST":"",g.sheen?"#define USE_SHEEN":"",g.sheenColorMap?"#define USE_SHEENCOLORMAP":"",g.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",g.transmission?"#define USE_TRANSMISSION":"",g.transmissionMap?"#define USE_TRANSMISSIONMAP":"",g.thicknessMap?"#define USE_THICKNESSMAP":"",g.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",g.vertexTangents?"#define USE_TANGENT":"",g.vertexColors||g.instancingColor?"#define USE_COLOR":"",g.vertexAlphas?"#define USE_COLOR_ALPHA":"",g.vertexUvs?"#define USE_UV":"",g.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",g.gradientMap?"#define USE_GRADIENTMAP":"",g.flatShading?"#define FLAT_SHADED":"",g.doubleSided?"#define DOUBLE_SIDED":"",g.flipSided?"#define FLIP_SIDED":"",g.shadowMapEnabled?"#define USE_SHADOWMAP":"",g.shadowMapEnabled?"#define "+ft:"",g.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",g.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",g.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",g.logarithmicDepthBuffer&&g.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",g.toneMapping!==Zs?"#define TONE_MAPPING":"",g.toneMapping!==Zs?Vs.tonemapping_pars_fragment:"",g.toneMapping!==Zs?j1("toneMapping",g.toneMapping):"",g.dithering?"#define DITHERING":"",g.opaque?"#define OPAQUE":"",Vs.encodings_pars_fragment,aT("linearToOutputTexel",g.outputEncoding),g.transmissionSamplerMapEncoding?oT("transmissionSamplerMapTexelToLinear",g.transmissionSamplerMapEncoding):"",g.useDepthPacking?"#define DEPTH_PACKING "+g.depthPacking:"",`
`].filter(R_).join(`
`)),at=R0(at),at=av(at,g),at=XS(at,g),ct=R0(ct),ct=av(ct,g),ct=XS(ct,g),at=Uy(at),ct=Uy(ct),g.isWebGL2&&g.isRawShaderMaterial!==!0&&(zt=`#version 300 es
`,Ut=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+Ut,Ft=["#define varying in",g.glslVersion===Xm?"":"layout(location = 0) out highp vec4 pc_fragColor;",g.glslVersion===Xm?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+Ft);const Kt=zt+Ft+ct,tn=sT(_e,35633,zt+Ut+at),sn=sT(_e,35632,Kt);if(_e.attachShader(Dt,tn),_e.attachShader(Dt,sn),g.index0AttributeName!==void 0?_e.bindAttribLocation(Dt,0,g.index0AttributeName):g.morphTargets===!0&&_e.bindAttribLocation(Dt,0,"position"),_e.linkProgram(Dt),ut.debug.checkShaderErrors){const Ln=_e.getProgramInfoLog(Dt).trim(),qn=_e.getShaderInfoLog(tn).trim(),Kn=_e.getShaderInfoLog(sn).trim();let Un=!0,vr=!0;if(_e.getProgramParameter(Dt,35714)===!1){Un=!1;const Pr=zo(_e,tn,"vertex"),mr=zo(_e,sn,"fragment");console.error("THREE.WebGLProgram: Shader Error "+_e.getError()+" - VALIDATE_STATUS "+_e.getProgramParameter(Dt,35715)+`

Program Info Log: `+Ln+`
`+Pr+`
`+mr)}else Ln!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ln):qn!==""&&Kn!==""||(vr=!1);vr&&(this.diagnostics={runnable:Un,programLog:Ln,vertexShader:{log:qn,prefix:Ut},fragmentShader:{log:Kn,prefix:Ft}})}let ln,kn;return _e.deleteShader(tn),_e.deleteShader(sn),this.getUniforms=function(){return ln===void 0&&(ln=new F1(_e,Dt)),ln},this.getAttributes=function(){return kn===void 0&&(kn=function(Ln,qn){const Kn={},Un=Ln.getProgramParameter(qn,35721);for(let vr=0;vr<Un;vr++){const Pr=Ln.getActiveAttrib(qn,vr),mr=Pr.name;let Qr=1;Pr.type===35674&&(Qr=2),Pr.type===35675&&(Qr=3),Pr.type===35676&&(Qr=4),Kn[mr]={type:Pr.type,location:Ln.getAttribLocation(qn,mr),locationSize:Qr}}return Kn}(_e,Dt)),kn},this.destroy=function(){$.releaseStatesOfProgram(this),_e.deleteProgram(Dt),this.program=void 0},this.name=g.shaderName,this.id=YS++,this.cacheKey=o,this.usedTimes=1,this.program=Dt,this.vertexShader=tn,this.fragmentShader=sn,this}let cT=0;class V1{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(o){const g=o.vertexShader,$=o.fragmentShader,_e=this._getShaderStage(g),rt=this._getShaderStage($),at=this._getShaderCacheForMaterial(o);return at.has(_e)===!1&&(at.add(_e),_e.usedTimes++),at.has(rt)===!1&&(at.add(rt),rt.usedTimes++),this}remove(o){const g=this.materialCache.get(o);for(const $ of g)$.usedTimes--,$.usedTimes===0&&this.shaderCache.delete($.code);return this.materialCache.delete(o),this}getVertexShaderID(o){return this._getShaderStage(o.vertexShader).id}getFragmentShaderID(o){return this._getShaderStage(o.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(o){const g=this.materialCache;let $=g.get(o);return $===void 0&&($=new Set,g.set(o,$)),$}_getShaderStage(o){const g=this.shaderCache;let $=g.get(o);return $===void 0&&($=new uT(o),g.set(o,$)),$}}class uT{constructor(o){this.id=cT++,this.code=o,this.usedTimes=0}}function fD(ut,o,g,$,_e,rt,at){const ct=new ku,ft=new V1,mt=[],bt=_e.isWebGL2,Mt=_e.logarithmicDepthBuffer,St=_e.vertexTextures;let It=_e.precision;const Bt={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(Dt,Ut,Ft,zt,Kt){const tn=zt.fog,sn=Kt.geometry,ln=Dt.isMeshStandardMaterial?zt.environment:null,kn=(Dt.isMeshStandardMaterial?g:o).get(Dt.envMap||ln),Ln=kn&&kn.mapping===Wu?kn.image.height:null,qn=Bt[Dt.type];Dt.precision!==null&&(It=_e.getMaxPrecision(Dt.precision),It!==Dt.precision&&console.warn("THREE.WebGLProgram.getParameters:",Dt.precision,"not supported, using",It,"instead."));const Kn=sn.morphAttributes.position||sn.morphAttributes.normal||sn.morphAttributes.color,Un=Kn!==void 0?Kn.length:0;let vr,Pr,mr,Qr,Gr=0;if(sn.morphAttributes.position!==void 0&&(Gr=1),sn.morphAttributes.normal!==void 0&&(Gr=2),sn.morphAttributes.color!==void 0&&(Gr=3),qn){const fs=Up[qn];vr=fs.vertexShader,Pr=fs.fragmentShader}else vr=Dt.vertexShader,Pr=Dt.fragmentShader,ft.update(Dt),mr=ft.getVertexShaderID(Dt),Qr=ft.getFragmentShaderID(Dt);const lr=ut.getRenderTarget(),dr=ut.userData&&ut.userData.transmissionRenderTarget,Or=Dt.alphaTest>0,_r=Dt.clearcoat>0,Vr=Dt.iridescence>0;return{isWebGL2:bt,shaderID:qn,shaderName:Dt.type,vertexShader:vr,fragmentShader:Pr,defines:Dt.defines,customVertexShaderID:mr,customFragmentShaderID:Qr,isRawShaderMaterial:Dt.isRawShaderMaterial===!0,glslVersion:Dt.glslVersion,precision:It,instancing:Kt.isInstancedMesh===!0,instancingColor:Kt.isInstancedMesh===!0&&Kt.instanceColor!==null,supportsVertexTextures:St,outputEncoding:lr===null?ut.outputEncoding:lr.isXRRenderTarget===!0||lr.texture.encoding!==Xs?lr.texture.encoding:Jp,map:!!Dt.map,matcap:!!Dt.matcap,envMap:!!kn,envMapMode:kn&&kn.mapping,envMapCubeUVHeight:Ln,lightMap:!!Dt.lightMap,aoMap:!!Dt.aoMap,emissiveMap:!!Dt.emissiveMap,bumpMap:!!Dt.bumpMap,normalMap:!!Dt.normalMap,objectSpaceNormalMap:Dt.normalMapType===nu,tangentSpaceNormalMap:Dt.normalMapType===tu,decodeVideoTexture:!!Dt.map&&Dt.map.isVideoTexture===!0&&Dt.map.encoding===Xs,clearcoat:_r,clearcoatMap:_r&&!!Dt.clearcoatMap,clearcoatRoughnessMap:_r&&!!Dt.clearcoatRoughnessMap,clearcoatNormalMap:_r&&!!Dt.clearcoatNormalMap,iridescence:Vr,iridescenceMap:Vr&&!!Dt.iridescenceMap,iridescenceThicknessMap:Vr&&!!Dt.iridescenceThicknessMap,displacementMap:!!Dt.displacementMap,roughnessMap:!!Dt.roughnessMap,metalnessMap:!!Dt.metalnessMap,specularMap:!!Dt.specularMap,specularIntensityMap:!!Dt.specularIntensityMap,specularColorMap:!!Dt.specularColorMap,opaque:Dt.transparent===!1&&Dt.blending===jt&&!(Dt.transmission>0),alphaMap:!!Dt.alphaMap,alphaTest:Or,gradientMap:!!Dt.gradientMap,sheen:Dt.sheen>0,sheenColorMap:!!Dt.sheenColorMap,sheenRoughnessMap:!!Dt.sheenRoughnessMap,transmission:Dt.transmission>0,transmissionMap:!!Dt.transmissionMap,transmissionSamplerMapEncoding:dr?dr.texture.encoding:Jp,thicknessMap:!!Dt.thicknessMap,combine:Dt.combine,vertexTangents:!!Dt.normalMap&&!!sn.attributes.tangent,vertexColors:Dt.vertexColors,vertexAlphas:Dt.vertexColors===!0&&!!sn.attributes.color&&sn.attributes.color.itemSize===4,vertexUvs:!!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatMap||Dt.clearcoatRoughnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.displacementMap||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheenColorMap||Dt.sheenRoughnessMap),uvsVertexOnly:!(Dt.map||Dt.bumpMap||Dt.normalMap||Dt.specularMap||Dt.alphaMap||Dt.emissiveMap||Dt.roughnessMap||Dt.metalnessMap||Dt.clearcoatNormalMap||Dt.iridescenceMap||Dt.iridescenceThicknessMap||Dt.transmission>0||Dt.transmissionMap||Dt.thicknessMap||Dt.specularIntensityMap||Dt.specularColorMap||Dt.sheen>0||Dt.sheenColorMap||Dt.sheenRoughnessMap||!Dt.displacementMap),fog:!!tn,useFog:Dt.fog===!0,fogExp2:tn&&tn.isFogExp2,flatShading:!!Dt.flatShading,sizeAttenuation:Dt.sizeAttenuation,logarithmicDepthBuffer:Mt,skinning:Kt.isSkinnedMesh===!0,morphTargets:sn.morphAttributes.position!==void 0,morphNormals:sn.morphAttributes.normal!==void 0,morphColors:sn.morphAttributes.color!==void 0,morphTargetsCount:Un,morphTextureStride:Gr,numDirLights:Ut.directional.length,numPointLights:Ut.point.length,numSpotLights:Ut.spot.length,numSpotLightMaps:Ut.spotLightMap.length,numRectAreaLights:Ut.rectArea.length,numHemiLights:Ut.hemi.length,numDirLightShadows:Ut.directionalShadowMap.length,numPointLightShadows:Ut.pointShadowMap.length,numSpotLightShadows:Ut.spotShadowMap.length,numSpotLightShadowsWithMaps:Ut.numSpotLightShadowsWithMaps,numClippingPlanes:at.numPlanes,numClipIntersection:at.numIntersection,dithering:Dt.dithering,shadowMapEnabled:ut.shadowMap.enabled&&Ft.length>0,shadowMapType:ut.shadowMap.type,toneMapping:Dt.toneMapped?ut.toneMapping:Zs,physicallyCorrectLights:ut.physicallyCorrectLights,premultipliedAlpha:Dt.premultipliedAlpha,doubleSided:Dt.side===bn,flipSided:Dt.side===$t,useDepthPacking:!!Dt.depthPacking,depthPacking:Dt.depthPacking||0,index0AttributeName:Dt.index0AttributeName,extensionDerivatives:Dt.extensions&&Dt.extensions.derivatives,extensionFragDepth:Dt.extensions&&Dt.extensions.fragDepth,extensionDrawBuffers:Dt.extensions&&Dt.extensions.drawBuffers,extensionShaderTextureLOD:Dt.extensions&&Dt.extensions.shaderTextureLOD,rendererExtensionFragDepth:bt||$.has("EXT_frag_depth"),rendererExtensionDrawBuffers:bt||$.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:bt||$.has("EXT_shader_texture_lod"),customProgramCacheKey:Dt.customProgramCacheKey()}},getProgramCacheKey:function(Dt){const Ut=[];if(Dt.shaderID?Ut.push(Dt.shaderID):(Ut.push(Dt.customVertexShaderID),Ut.push(Dt.customFragmentShaderID)),Dt.defines!==void 0)for(const Ft in Dt.defines)Ut.push(Ft),Ut.push(Dt.defines[Ft]);return Dt.isRawShaderMaterial===!1&&(function(Ft,zt){Ft.push(zt.precision),Ft.push(zt.outputEncoding),Ft.push(zt.envMapMode),Ft.push(zt.envMapCubeUVHeight),Ft.push(zt.combine),Ft.push(zt.vertexUvs),Ft.push(zt.fogExp2),Ft.push(zt.sizeAttenuation),Ft.push(zt.morphTargetsCount),Ft.push(zt.morphAttributeCount),Ft.push(zt.numDirLights),Ft.push(zt.numPointLights),Ft.push(zt.numSpotLights),Ft.push(zt.numSpotLightMaps),Ft.push(zt.numHemiLights),Ft.push(zt.numRectAreaLights),Ft.push(zt.numDirLightShadows),Ft.push(zt.numPointLightShadows),Ft.push(zt.numSpotLightShadows),Ft.push(zt.numSpotLightShadowsWithMaps),Ft.push(zt.shadowMapType),Ft.push(zt.toneMapping),Ft.push(zt.numClippingPlanes),Ft.push(zt.numClipIntersection),Ft.push(zt.depthPacking)}(Ut,Dt),function(Ft,zt){ct.disableAll(),zt.isWebGL2&&ct.enable(0),zt.supportsVertexTextures&&ct.enable(1),zt.instancing&&ct.enable(2),zt.instancingColor&&ct.enable(3),zt.map&&ct.enable(4),zt.matcap&&ct.enable(5),zt.envMap&&ct.enable(6),zt.lightMap&&ct.enable(7),zt.aoMap&&ct.enable(8),zt.emissiveMap&&ct.enable(9),zt.bumpMap&&ct.enable(10),zt.normalMap&&ct.enable(11),zt.objectSpaceNormalMap&&ct.enable(12),zt.tangentSpaceNormalMap&&ct.enable(13),zt.clearcoat&&ct.enable(14),zt.clearcoatMap&&ct.enable(15),zt.clearcoatRoughnessMap&&ct.enable(16),zt.clearcoatNormalMap&&ct.enable(17),zt.iridescence&&ct.enable(18),zt.iridescenceMap&&ct.enable(19),zt.iridescenceThicknessMap&&ct.enable(20),zt.displacementMap&&ct.enable(21),zt.specularMap&&ct.enable(22),zt.roughnessMap&&ct.enable(23),zt.metalnessMap&&ct.enable(24),zt.gradientMap&&ct.enable(25),zt.alphaMap&&ct.enable(26),zt.alphaTest&&ct.enable(27),zt.vertexColors&&ct.enable(28),zt.vertexAlphas&&ct.enable(29),zt.vertexUvs&&ct.enable(30),zt.vertexTangents&&ct.enable(31),zt.uvsVertexOnly&&ct.enable(32),Ft.push(ct.mask),ct.disableAll(),zt.fog&&ct.enable(0),zt.useFog&&ct.enable(1),zt.flatShading&&ct.enable(2),zt.logarithmicDepthBuffer&&ct.enable(3),zt.skinning&&ct.enable(4),zt.morphTargets&&ct.enable(5),zt.morphNormals&&ct.enable(6),zt.morphColors&&ct.enable(7),zt.premultipliedAlpha&&ct.enable(8),zt.shadowMapEnabled&&ct.enable(9),zt.physicallyCorrectLights&&ct.enable(10),zt.doubleSided&&ct.enable(11),zt.flipSided&&ct.enable(12),zt.useDepthPacking&&ct.enable(13),zt.dithering&&ct.enable(14),zt.specularIntensityMap&&ct.enable(15),zt.specularColorMap&&ct.enable(16),zt.transmission&&ct.enable(17),zt.transmissionMap&&ct.enable(18),zt.thicknessMap&&ct.enable(19),zt.sheen&&ct.enable(20),zt.sheenColorMap&&ct.enable(21),zt.sheenRoughnessMap&&ct.enable(22),zt.decodeVideoTexture&&ct.enable(23),zt.opaque&&ct.enable(24),Ft.push(ct.mask)}(Ut,Dt),Ut.push(ut.outputEncoding)),Ut.push(Dt.customProgramCacheKey),Ut.join()},getUniforms:function(Dt){const Ut=Bt[Dt.type];let Ft;if(Ut){const zt=Up[Ut];Ft=kM.clone(zt.uniforms)}else Ft=Dt.uniforms;return Ft},acquireProgram:function(Dt,Ut){let Ft;for(let zt=0,Kt=mt.length;zt<Kt;zt++){const tn=mt[zt];if(tn.cacheKey===Ut){Ft=tn,++Ft.usedTimes;break}}return Ft===void 0&&(Ft=new pD(ut,Ut,Dt,rt),mt.push(Ft)),Ft},releaseProgram:function(Dt){if(--Dt.usedTimes==0){const Ut=mt.indexOf(Dt);mt[Ut]=mt[mt.length-1],mt.pop(),Dt.destroy()}},releaseShaderCache:function(Dt){ft.remove(Dt)},programs:mt,dispose:function(){ft.dispose()}}}function hT(){let ut=new WeakMap;return{get:function(o){let g=ut.get(o);return g===void 0&&(g={},ut.set(o,g)),g},remove:function(o){ut.delete(o)},update:function(o,g,$){ut.get(o)[g]=$},dispose:function(){ut=new WeakMap}}}function dT(ut,o){return ut.groupOrder!==o.groupOrder?ut.groupOrder-o.groupOrder:ut.renderOrder!==o.renderOrder?ut.renderOrder-o.renderOrder:ut.material.id!==o.material.id?ut.material.id-o.material.id:ut.z!==o.z?ut.z-o.z:ut.id-o.id}function KS(ut,o){return ut.groupOrder!==o.groupOrder?ut.groupOrder-o.groupOrder:ut.renderOrder!==o.renderOrder?ut.renderOrder-o.renderOrder:ut.z!==o.z?o.z-ut.z:ut.id-o.id}function pT(){const ut=[];let o=0;const g=[],$=[],_e=[];function rt(at,ct,ft,mt,bt,Mt){let St=ut[o];return St===void 0?(St={id:at.id,object:at,geometry:ct,material:ft,groupOrder:mt,renderOrder:at.renderOrder,z:bt,group:Mt},ut[o]=St):(St.id=at.id,St.object=at,St.geometry=ct,St.material=ft,St.groupOrder=mt,St.renderOrder=at.renderOrder,St.z=bt,St.group=Mt),o++,St}return{opaque:g,transmissive:$,transparent:_e,init:function(){o=0,g.length=0,$.length=0,_e.length=0},push:function(at,ct,ft,mt,bt,Mt){const St=rt(at,ct,ft,mt,bt,Mt);ft.transmission>0?$.push(St):ft.transparent===!0?_e.push(St):g.push(St)},unshift:function(at,ct,ft,mt,bt,Mt){const St=rt(at,ct,ft,mt,bt,Mt);ft.transmission>0?$.unshift(St):ft.transparent===!0?_e.unshift(St):g.unshift(St)},finish:function(){for(let at=o,ct=ut.length;at<ct;at++){const ft=ut[at];if(ft.id===null)break;ft.id=null,ft.object=null,ft.geometry=null,ft.material=null,ft.group=null}},sort:function(at,ct){g.length>1&&g.sort(at||dT),$.length>1&&$.sort(ct||KS),_e.length>1&&_e.sort(ct||KS)}}}function JS(){let ut=new WeakMap;return{get:function(o,g){const $=ut.get(o);let _e;return $===void 0?(_e=new pT,ut.set(o,[_e])):g>=$.length?(_e=new pT,$.push(_e)):_e=$[g],_e},dispose:function(){ut=new WeakMap}}}function ZS(){const ut={};return{get:function(o){if(ut[o.id]!==void 0)return ut[o.id];let g;switch(o.type){case"DirectionalLight":g={direction:new dn,color:new ts};break;case"SpotLight":g={position:new dn,direction:new dn,color:new ts,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":g={position:new dn,color:new ts,distance:0,decay:0};break;case"HemisphereLight":g={direction:new dn,skyColor:new ts,groundColor:new ts};break;case"RectAreaLight":g={color:new ts,position:new dn,halfWidth:new dn,halfHeight:new dn}}return ut[o.id]=g,g}}}let Xw=0;function Q1(ut,o){return(o.castShadow?2:0)-(ut.castShadow?2:0)+(o.map?1:0)-(ut.map?1:0)}function fT(ut,o){const g=new ZS,$=function(){const ft={};return{get:function(mt){if(ft[mt.id]!==void 0)return ft[mt.id];let bt;switch(mt.type){case"DirectionalLight":case"SpotLight":bt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cr};break;case"PointLight":bt={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Cr,shadowCameraNear:1,shadowCameraFar:1e3}}return ft[mt.id]=bt,bt}}}(),_e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let ft=0;ft<9;ft++)_e.probe.push(new dn);const rt=new dn,at=new Is,ct=new Is;return{setup:function(ft,mt){let bt=0,Mt=0,St=0;for(let qn=0;qn<9;qn++)_e.probe[qn].set(0,0,0);let It=0,Bt=0,Dt=0,Ut=0,Ft=0,zt=0,Kt=0,tn=0,sn=0,ln=0;ft.sort(Q1);const kn=mt!==!0?Math.PI:1;for(let qn=0,Kn=ft.length;qn<Kn;qn++){const Un=ft[qn],vr=Un.color,Pr=Un.intensity,mr=Un.distance,Qr=Un.shadow&&Un.shadow.map?Un.shadow.map.texture:null;if(Un.isAmbientLight)bt+=vr.r*Pr*kn,Mt+=vr.g*Pr*kn,St+=vr.b*Pr*kn;else if(Un.isLightProbe)for(let Gr=0;Gr<9;Gr++)_e.probe[Gr].addScaledVector(Un.sh.coefficients[Gr],Pr);else if(Un.isDirectionalLight){const Gr=g.get(Un);if(Gr.color.copy(Un.color).multiplyScalar(Un.intensity*kn),Un.castShadow){const lr=Un.shadow,dr=$.get(Un);dr.shadowBias=lr.bias,dr.shadowNormalBias=lr.normalBias,dr.shadowRadius=lr.radius,dr.shadowMapSize=lr.mapSize,_e.directionalShadow[It]=dr,_e.directionalShadowMap[It]=Qr,_e.directionalShadowMatrix[It]=Un.shadow.matrix,zt++}_e.directional[It]=Gr,It++}else if(Un.isSpotLight){const Gr=g.get(Un);Gr.position.setFromMatrixPosition(Un.matrixWorld),Gr.color.copy(vr).multiplyScalar(Pr*kn),Gr.distance=mr,Gr.coneCos=Math.cos(Un.angle),Gr.penumbraCos=Math.cos(Un.angle*(1-Un.penumbra)),Gr.decay=Un.decay,_e.spot[Dt]=Gr;const lr=Un.shadow;if(Un.map&&(_e.spotLightMap[sn]=Un.map,sn++,lr.updateMatrices(Un),Un.castShadow&&ln++),_e.spotLightMatrix[Dt]=lr.matrix,Un.castShadow){const dr=$.get(Un);dr.shadowBias=lr.bias,dr.shadowNormalBias=lr.normalBias,dr.shadowRadius=lr.radius,dr.shadowMapSize=lr.mapSize,_e.spotShadow[Dt]=dr,_e.spotShadowMap[Dt]=Qr,tn++}Dt++}else if(Un.isRectAreaLight){const Gr=g.get(Un);Gr.color.copy(vr).multiplyScalar(Pr),Gr.halfWidth.set(.5*Un.width,0,0),Gr.halfHeight.set(0,.5*Un.height,0),_e.rectArea[Ut]=Gr,Ut++}else if(Un.isPointLight){const Gr=g.get(Un);if(Gr.color.copy(Un.color).multiplyScalar(Un.intensity*kn),Gr.distance=Un.distance,Gr.decay=Un.decay,Un.castShadow){const lr=Un.shadow,dr=$.get(Un);dr.shadowBias=lr.bias,dr.shadowNormalBias=lr.normalBias,dr.shadowRadius=lr.radius,dr.shadowMapSize=lr.mapSize,dr.shadowCameraNear=lr.camera.near,dr.shadowCameraFar=lr.camera.far,_e.pointShadow[Bt]=dr,_e.pointShadowMap[Bt]=Qr,_e.pointShadowMatrix[Bt]=Un.shadow.matrix,Kt++}_e.point[Bt]=Gr,Bt++}else if(Un.isHemisphereLight){const Gr=g.get(Un);Gr.skyColor.copy(Un.color).multiplyScalar(Pr*kn),Gr.groundColor.copy(Un.groundColor).multiplyScalar(Pr*kn),_e.hemi[Ft]=Gr,Ft++}}Ut>0&&(o.isWebGL2||ut.has("OES_texture_float_linear")===!0?(_e.rectAreaLTC1=Kr.LTC_FLOAT_1,_e.rectAreaLTC2=Kr.LTC_FLOAT_2):ut.has("OES_texture_half_float_linear")===!0?(_e.rectAreaLTC1=Kr.LTC_HALF_1,_e.rectAreaLTC2=Kr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),_e.ambient[0]=bt,_e.ambient[1]=Mt,_e.ambient[2]=St;const Ln=_e.hash;Ln.directionalLength===It&&Ln.pointLength===Bt&&Ln.spotLength===Dt&&Ln.rectAreaLength===Ut&&Ln.hemiLength===Ft&&Ln.numDirectionalShadows===zt&&Ln.numPointShadows===Kt&&Ln.numSpotShadows===tn&&Ln.numSpotMaps===sn||(_e.directional.length=It,_e.spot.length=Dt,_e.rectArea.length=Ut,_e.point.length=Bt,_e.hemi.length=Ft,_e.directionalShadow.length=zt,_e.directionalShadowMap.length=zt,_e.pointShadow.length=Kt,_e.pointShadowMap.length=Kt,_e.spotShadow.length=tn,_e.spotShadowMap.length=tn,_e.directionalShadowMatrix.length=zt,_e.pointShadowMatrix.length=Kt,_e.spotLightMatrix.length=tn+sn-ln,_e.spotLightMap.length=sn,_e.numSpotLightShadowsWithMaps=ln,Ln.directionalLength=It,Ln.pointLength=Bt,Ln.spotLength=Dt,Ln.rectAreaLength=Ut,Ln.hemiLength=Ft,Ln.numDirectionalShadows=zt,Ln.numPointShadows=Kt,Ln.numSpotShadows=tn,Ln.numSpotMaps=sn,_e.version=Xw++)},setupView:function(ft,mt){let bt=0,Mt=0,St=0,It=0,Bt=0;const Dt=mt.matrixWorldInverse;for(let Ut=0,Ft=ft.length;Ut<Ft;Ut++){const zt=ft[Ut];if(zt.isDirectionalLight){const Kt=_e.directional[bt];Kt.direction.setFromMatrixPosition(zt.matrixWorld),rt.setFromMatrixPosition(zt.target.matrixWorld),Kt.direction.sub(rt),Kt.direction.transformDirection(Dt),bt++}else if(zt.isSpotLight){const Kt=_e.spot[St];Kt.position.setFromMatrixPosition(zt.matrixWorld),Kt.position.applyMatrix4(Dt),Kt.direction.setFromMatrixPosition(zt.matrixWorld),rt.setFromMatrixPosition(zt.target.matrixWorld),Kt.direction.sub(rt),Kt.direction.transformDirection(Dt),St++}else if(zt.isRectAreaLight){const Kt=_e.rectArea[It];Kt.position.setFromMatrixPosition(zt.matrixWorld),Kt.position.applyMatrix4(Dt),ct.identity(),at.copy(zt.matrixWorld),at.premultiply(Dt),ct.extractRotation(at),Kt.halfWidth.set(.5*zt.width,0,0),Kt.halfHeight.set(0,.5*zt.height,0),Kt.halfWidth.applyMatrix4(ct),Kt.halfHeight.applyMatrix4(ct),It++}else if(zt.isPointLight){const Kt=_e.point[Mt];Kt.position.setFromMatrixPosition(zt.matrixWorld),Kt.position.applyMatrix4(Dt),Mt++}else if(zt.isHemisphereLight){const Kt=_e.hemi[Bt];Kt.direction.setFromMatrixPosition(zt.matrixWorld),Kt.direction.transformDirection(Dt),Bt++}}},state:_e}}function G1(ut,o){const g=new fT(ut,o),$=[],_e=[];return{init:function(){$.length=0,_e.length=0},state:{lightsArray:$,shadowsArray:_e,lights:g},setupLights:function(rt){g.setup($,rt)},setupLightsView:function(rt){g.setupView($,rt)},pushLight:function(rt){$.push(rt)},pushShadow:function(rt){_e.push(rt)}}}function mT(ut,o){let g=new WeakMap;return{get:function($,_e=0){const rt=g.get($);let at;return rt===void 0?(at=new G1(ut,o),g.set($,[at])):_e>=rt.length?(at=new G1(ut,o),rt.push(at)):at=rt[_e],at},dispose:function(){g=new WeakMap}}}class Kw extends lu{constructor(o){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Ru,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(o)}copy(o){return super.copy(o),this.depthPacking=o.depthPacking,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this}}class Fy extends lu{constructor(o){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new dn,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(o)}copy(o){return super.copy(o),this.referencePosition.copy(o.referencePosition),this.nearDistance=o.nearDistance,this.farDistance=o.farDistance,this.map=o.map,this.alphaMap=o.alphaMap,this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this}}function gT(ut,o,g){let $=new jw;const _e=new Cr,rt=new Cr,at=new fo,ct=new Kw({depthPacking:d_}),ft=new Fy,mt={},bt=g.maxTextureSize,Mt={0:$t,1:_n,2:bn},St=new tv({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Cr},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),It=St.clone();It.defines.HORIZONTAL_PASS=1;const Bt=new ls;Bt.setAttribute("position",new Co(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const Dt=new cu(Bt,St),Ut=this;function Ft(tn,sn){const ln=o.update(Dt);St.defines.VSM_SAMPLES!==tn.blurSamples&&(St.defines.VSM_SAMPLES=tn.blurSamples,It.defines.VSM_SAMPLES=tn.blurSamples,St.needsUpdate=!0,It.needsUpdate=!0),tn.mapPass===null&&(tn.mapPass=new Ku(_e.x,_e.y)),St.uniforms.shadow_pass.value=tn.map.texture,St.uniforms.resolution.value=tn.mapSize,St.uniforms.radius.value=tn.radius,ut.setRenderTarget(tn.mapPass),ut.clear(),ut.renderBufferDirect(sn,null,ln,St,Dt,null),It.uniforms.shadow_pass.value=tn.mapPass.texture,It.uniforms.resolution.value=tn.mapSize,It.uniforms.radius.value=tn.radius,ut.setRenderTarget(tn.map),ut.clear(),ut.renderBufferDirect(sn,null,ln,It,Dt,null)}function zt(tn,sn,ln,kn,Ln,qn){let Kn=null;const Un=ln.isPointLight===!0?tn.customDistanceMaterial:tn.customDepthMaterial;if(Kn=Un!==void 0?Un:ln.isPointLight===!0?ft:ct,ut.localClippingEnabled&&sn.clipShadows===!0&&Array.isArray(sn.clippingPlanes)&&sn.clippingPlanes.length!==0||sn.displacementMap&&sn.displacementScale!==0||sn.alphaMap&&sn.alphaTest>0){const vr=Kn.uuid,Pr=sn.uuid;let mr=mt[vr];mr===void 0&&(mr={},mt[vr]=mr);let Qr=mr[Pr];Qr===void 0&&(Qr=Kn.clone(),mr[Pr]=Qr),Kn=Qr}return Kn.visible=sn.visible,Kn.wireframe=sn.wireframe,Kn.side=qn===wn?sn.shadowSide!==null?sn.shadowSide:sn.side:sn.shadowSide!==null?sn.shadowSide:Mt[sn.side],Kn.alphaMap=sn.alphaMap,Kn.alphaTest=sn.alphaTest,Kn.clipShadows=sn.clipShadows,Kn.clippingPlanes=sn.clippingPlanes,Kn.clipIntersection=sn.clipIntersection,Kn.displacementMap=sn.displacementMap,Kn.displacementScale=sn.displacementScale,Kn.displacementBias=sn.displacementBias,Kn.wireframeLinewidth=sn.wireframeLinewidth,Kn.linewidth=sn.linewidth,ln.isPointLight===!0&&Kn.isMeshDistanceMaterial===!0&&(Kn.referencePosition.setFromMatrixPosition(ln.matrixWorld),Kn.nearDistance=kn,Kn.farDistance=Ln),Kn}function Kt(tn,sn,ln,kn,Ln){if(tn.visible===!1)return;if(tn.layers.test(sn.layers)&&(tn.isMesh||tn.isLine||tn.isPoints)&&(tn.castShadow||tn.receiveShadow&&Ln===wn)&&(!tn.frustumCulled||$.intersectsObject(tn))){tn.modelViewMatrix.multiplyMatrices(ln.matrixWorldInverse,tn.matrixWorld);const Kn=o.update(tn),Un=tn.material;if(Array.isArray(Un)){const vr=Kn.groups;for(let Pr=0,mr=vr.length;Pr<mr;Pr++){const Qr=vr[Pr],Gr=Un[Qr.materialIndex];if(Gr&&Gr.visible){const lr=zt(tn,Gr,kn,ln.near,ln.far,Ln);ut.renderBufferDirect(ln,null,Kn,lr,tn,Qr)}}}else if(Un.visible){const vr=zt(tn,Un,kn,ln.near,ln.far,Ln);ut.renderBufferDirect(ln,null,Kn,vr,tn,null)}}const qn=tn.children;for(let Kn=0,Un=qn.length;Kn<Un;Kn++)Kt(qn[Kn],sn,ln,kn,Ln)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mn,this.render=function(tn,sn,ln){if(Ut.enabled===!1||Ut.autoUpdate===!1&&Ut.needsUpdate===!1||tn.length===0)return;const kn=ut.getRenderTarget(),Ln=ut.getActiveCubeFace(),qn=ut.getActiveMipmapLevel(),Kn=ut.state;Kn.setBlending(Nt),Kn.buffers.color.setClear(1,1,1,1),Kn.buffers.depth.setTest(!0),Kn.setScissorTest(!1);for(let Un=0,vr=tn.length;Un<vr;Un++){const Pr=tn[Un],mr=Pr.shadow;if(mr===void 0){console.warn("THREE.WebGLShadowMap:",Pr,"has no shadow.");continue}if(mr.autoUpdate===!1&&mr.needsUpdate===!1)continue;_e.copy(mr.mapSize);const Qr=mr.getFrameExtents();if(_e.multiply(Qr),rt.copy(mr.mapSize),(_e.x>bt||_e.y>bt)&&(_e.x>bt&&(rt.x=Math.floor(bt/Qr.x),_e.x=rt.x*Qr.x,mr.mapSize.x=rt.x),_e.y>bt&&(rt.y=Math.floor(bt/Qr.y),_e.y=rt.y*Qr.y,mr.mapSize.y=rt.y)),mr.map===null){const lr=this.type!==wn?{minFilter:Yo,magFilter:Yo}:{};mr.map=new Ku(_e.x,_e.y,lr),mr.map.texture.name=Pr.name+".shadowMap",mr.camera.updateProjectionMatrix()}ut.setRenderTarget(mr.map),ut.clear();const Gr=mr.getViewportCount();for(let lr=0;lr<Gr;lr++){const dr=mr.getViewport(lr);at.set(rt.x*dr.x,rt.y*dr.y,rt.x*dr.z,rt.y*dr.w),Kn.viewport(at),mr.updateMatrices(Pr,lr),$=mr.getFrustum(),Kt(sn,ln,mr.camera,Pr,this.type)}mr.isPointLightShadow!==!0&&this.type===wn&&Ft(mr,ln),mr.needsUpdate=!1}Ut.needsUpdate=!1,ut.setRenderTarget(kn,Ln,qn)}}function $S(ut,o,g){const $=g.isWebGL2,_e=new function(){let Jt=!1;const hr=new fo;let Zn=null;const gr=new fo(0,0,0,0);return{setMask:function(wr){Zn===wr||Jt||(ut.colorMask(wr,wr,wr,wr),Zn=wr)},setLocked:function(wr){Jt=wr},setClear:function(wr,Xr,vs,Cs,js){js===!0&&(wr*=Cs,Xr*=Cs,vs*=Cs),hr.set(wr,Xr,vs,Cs),gr.equals(hr)===!1&&(ut.clearColor(wr,Xr,vs,Cs),gr.copy(hr))},reset:function(){Jt=!1,Zn=null,gr.set(-1,0,0,0)}}},rt=new function(){let Jt=!1,hr=null,Zn=null,gr=null;return{setTest:function(wr){wr?gs(2929):Qs(2929)},setMask:function(wr){hr===wr||Jt||(ut.depthMask(wr),hr=wr)},setFunc:function(wr){if(Zn!==wr){if(wr)switch(wr){case Sr:ut.depthFunc(512);break;case Yn:ut.depthFunc(519);break;case Xt:ut.depthFunc(513);break;case rn:ut.depthFunc(515);break;case Fn:ut.depthFunc(514);break;case Nr:ut.depthFunc(518);break;case kr:ut.depthFunc(516);break;case jr:ut.depthFunc(517);break;default:ut.depthFunc(515)}else ut.depthFunc(515);Zn=wr}},setLocked:function(wr){Jt=wr},setClear:function(wr){gr!==wr&&(ut.clearDepth(wr),gr=wr)},reset:function(){Jt=!1,hr=null,Zn=null,gr=null}}},at=new function(){let Jt=!1,hr=null,Zn=null,gr=null,wr=null,Xr=null,vs=null,Cs=null,js=null;return{setTest:function(bs){Jt||(bs?gs(2960):Qs(2960))},setMask:function(bs){hr===bs||Jt||(ut.stencilMask(bs),hr=bs)},setFunc:function(bs,Ms,Eo){Zn===bs&&gr===Ms&&wr===Eo||(ut.stencilFunc(bs,Ms,Eo),Zn=bs,gr=Ms,wr=Eo)},setOp:function(bs,Ms,Eo){Xr===bs&&vs===Ms&&Cs===Eo||(ut.stencilOp(bs,Ms,Eo),Xr=bs,vs=Ms,Cs=Eo)},setLocked:function(bs){Jt=bs},setClear:function(bs){js!==bs&&(ut.clearStencil(bs),js=bs)},reset:function(){Jt=!1,hr=null,Zn=null,gr=null,wr=null,Xr=null,vs=null,Cs=null,js=null}}},ct=new WeakMap,ft=new WeakMap;let mt={},bt={},Mt=new WeakMap,St=[],It=null,Bt=!1,Dt=null,Ut=null,Ft=null,zt=null,Kt=null,tn=null,sn=null,ln=!1,kn=null,Ln=null,qn=null,Kn=null,Un=null;const vr=ut.getParameter(35661);let Pr=!1,mr=0;const Qr=ut.getParameter(7938);Qr.indexOf("WebGL")!==-1?(mr=parseFloat(/^WebGL (\d)/.exec(Qr)[1]),Pr=mr>=1):Qr.indexOf("OpenGL ES")!==-1&&(mr=parseFloat(/^OpenGL ES (\d)/.exec(Qr)[1]),Pr=mr>=2);let Gr=null,lr={};const dr=ut.getParameter(3088),Or=ut.getParameter(2978),_r=new fo().fromArray(dr),Vr=new fo().fromArray(Or);function fs(Jt,hr,Zn){const gr=new Uint8Array(4),wr=ut.createTexture();ut.bindTexture(Jt,wr),ut.texParameteri(Jt,10241,9728),ut.texParameteri(Jt,10240,9728);for(let Xr=0;Xr<Zn;Xr++)ut.texImage2D(hr+Xr,0,6408,1,1,0,6408,5121,gr);return wr}const Ks={};function gs(Jt){mt[Jt]!==!0&&(ut.enable(Jt),mt[Jt]=!0)}function Qs(Jt){mt[Jt]!==!1&&(ut.disable(Jt),mt[Jt]=!1)}Ks[3553]=fs(3553,3553,1),Ks[34067]=fs(34067,34069,6),_e.setClear(0,0,0,1),rt.setClear(1),at.setClear(0),gs(2929),rt.setFunc(rn),Wn(!1),Dn(Gt),gs(2884),tr(Nt);const In={[Qt]:32774,[Wt]:32778,[Zt]:32779};if($)In[En]=32775,In[pn]=32776;else{const Jt=o.get("EXT_blend_minmax");Jt!==null&&(In[En]=Jt.MIN_EXT,In[pn]=Jt.MAX_EXT)}const yn={[er]:0,[Ir]:1,[Dr]:768,[Ar]:770,[$n]:776,[zn]:774,[Xn]:772,[zr]:769,[Hr]:771,[nr]:775,[ir]:773};function tr(Jt,hr,Zn,gr,wr,Xr,vs,Cs){if(Jt!==Nt){if(Bt===!1&&(gs(3042),Bt=!0),Jt===Cn)wr=wr||hr,Xr=Xr||Zn,vs=vs||gr,hr===Ut&&wr===Kt||(ut.blendEquationSeparate(In[hr],In[wr]),Ut=hr,Kt=wr),Zn===Ft&&gr===zt&&Xr===tn&&vs===sn||(ut.blendFuncSeparate(yn[Zn],yn[gr],yn[Xr],yn[vs]),Ft=Zn,zt=gr,tn=Xr,sn=vs),Dt=Jt,ln=null;else if(Jt!==Dt||Cs!==ln){if(Ut===Qt&&Kt===Qt||(ut.blendEquation(32774),Ut=Qt,Kt=Qt),Cs)switch(Jt){case jt:ut.blendFuncSeparate(1,771,1,771);break;case Yt:ut.blendFunc(1,1);break;case Bn:ut.blendFuncSeparate(0,769,0,1);break;case un:ut.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt)}else switch(Jt){case jt:ut.blendFuncSeparate(770,771,1,771);break;case Yt:ut.blendFunc(770,1);break;case Bn:ut.blendFuncSeparate(0,769,0,1);break;case un:ut.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Jt)}Ft=null,zt=null,tn=null,sn=null,Dt=Jt,ln=Cs}}else Bt===!0&&(Qs(3042),Bt=!1)}function Wn(Jt){kn!==Jt&&(Jt?ut.frontFace(2304):ut.frontFace(2305),kn=Jt)}function Dn(Jt){Jt!==kt?(gs(2884),Jt!==Ln&&(Jt===Gt?ut.cullFace(1029):Jt===Vt?ut.cullFace(1028):ut.cullFace(1032))):Qs(2884),Ln=Jt}function Gn(Jt,hr,Zn){Jt?(gs(32823),Kn===hr&&Un===Zn||(ut.polygonOffset(hr,Zn),Kn=hr,Un=Zn)):Qs(32823)}function ur(Jt){Jt===void 0&&(Jt=33984+vr-1),Gr!==Jt&&(ut.activeTexture(Jt),Gr=Jt)}return{buffers:{color:_e,depth:rt,stencil:at},enable:gs,disable:Qs,bindFramebuffer:function(Jt,hr){return bt[Jt]!==hr&&(ut.bindFramebuffer(Jt,hr),bt[Jt]=hr,$&&(Jt===36009&&(bt[36160]=hr),Jt===36160&&(bt[36009]=hr)),!0)},drawBuffers:function(Jt,hr){let Zn=St,gr=!1;if(Jt)if(Zn=Mt.get(hr),Zn===void 0&&(Zn=[],Mt.set(hr,Zn)),Jt.isWebGLMultipleRenderTargets){const wr=Jt.texture;if(Zn.length!==wr.length||Zn[0]!==36064){for(let Xr=0,vs=wr.length;Xr<vs;Xr++)Zn[Xr]=36064+Xr;Zn.length=wr.length,gr=!0}}else Zn[0]!==36064&&(Zn[0]=36064,gr=!0);else Zn[0]!==1029&&(Zn[0]=1029,gr=!0);gr&&(g.isWebGL2?ut.drawBuffers(Zn):o.get("WEBGL_draw_buffers").drawBuffersWEBGL(Zn))},useProgram:function(Jt){return It!==Jt&&(ut.useProgram(Jt),It=Jt,!0)},setBlending:tr,setMaterial:function(Jt,hr){Jt.side===bn?Qs(2884):gs(2884);let Zn=Jt.side===$t;hr&&(Zn=!Zn),Wn(Zn),Jt.blending===jt&&Jt.transparent===!1?tr(Nt):tr(Jt.blending,Jt.blendEquation,Jt.blendSrc,Jt.blendDst,Jt.blendEquationAlpha,Jt.blendSrcAlpha,Jt.blendDstAlpha,Jt.premultipliedAlpha),rt.setFunc(Jt.depthFunc),rt.setTest(Jt.depthTest),rt.setMask(Jt.depthWrite),_e.setMask(Jt.colorWrite);const gr=Jt.stencilWrite;at.setTest(gr),gr&&(at.setMask(Jt.stencilWriteMask),at.setFunc(Jt.stencilFunc,Jt.stencilRef,Jt.stencilFuncMask),at.setOp(Jt.stencilFail,Jt.stencilZFail,Jt.stencilZPass)),Gn(Jt.polygonOffset,Jt.polygonOffsetFactor,Jt.polygonOffsetUnits),Jt.alphaToCoverage===!0?gs(32926):Qs(32926)},setFlipSided:Wn,setCullFace:Dn,setLineWidth:function(Jt){Jt!==qn&&(Pr&&ut.lineWidth(Jt),qn=Jt)},setPolygonOffset:Gn,setScissorTest:function(Jt){Jt?gs(3089):Qs(3089)},activeTexture:ur,bindTexture:function(Jt,hr){Gr===null&&ur();let Zn=lr[Gr];Zn===void 0&&(Zn={type:void 0,texture:void 0},lr[Gr]=Zn),Zn.type===Jt&&Zn.texture===hr||(ut.bindTexture(Jt,hr||Ks[Jt]),Zn.type=Jt,Zn.texture=hr)},unbindTexture:function(){const Jt=lr[Gr];Jt!==void 0&&Jt.type!==void 0&&(ut.bindTexture(Jt.type,null),Jt.type=void 0,Jt.texture=void 0)},compressedTexImage2D:function(){try{ut.compressedTexImage2D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texImage2D:function(){try{ut.texImage2D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texImage3D:function(){try{ut.texImage3D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},updateUBOMapping:function(Jt,hr){let Zn=ft.get(hr);Zn===void 0&&(Zn=new WeakMap,ft.set(hr,Zn));let gr=Zn.get(Jt);gr===void 0&&(gr=ut.getUniformBlockIndex(hr,Jt.name),Zn.set(Jt,gr))},uniformBlockBinding:function(Jt,hr){const Zn=ft.get(hr).get(Jt);ct.get(Jt)!==Zn&&(ut.uniformBlockBinding(hr,Zn,Jt.__bindingPointIndex),ct.set(Jt,Zn))},texStorage2D:function(){try{ut.texStorage2D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texStorage3D:function(){try{ut.texStorage3D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texSubImage2D:function(){try{ut.texSubImage2D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},texSubImage3D:function(){try{ut.texSubImage3D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},compressedTexSubImage2D:function(){try{ut.compressedTexSubImage2D.apply(ut,arguments)}catch(Jt){console.error("THREE.WebGLState:",Jt)}},scissor:function(Jt){_r.equals(Jt)===!1&&(ut.scissor(Jt.x,Jt.y,Jt.z,Jt.w),_r.copy(Jt))},viewport:function(Jt){Vr.equals(Jt)===!1&&(ut.viewport(Jt.x,Jt.y,Jt.z,Jt.w),Vr.copy(Jt))},reset:function(){ut.disable(3042),ut.disable(2884),ut.disable(2929),ut.disable(32823),ut.disable(3089),ut.disable(2960),ut.disable(32926),ut.blendEquation(32774),ut.blendFunc(1,0),ut.blendFuncSeparate(1,0,1,0),ut.colorMask(!0,!0,!0,!0),ut.clearColor(0,0,0,0),ut.depthMask(!0),ut.depthFunc(513),ut.clearDepth(1),ut.stencilMask(4294967295),ut.stencilFunc(519,0,4294967295),ut.stencilOp(7680,7680,7680),ut.clearStencil(0),ut.cullFace(1029),ut.frontFace(2305),ut.polygonOffset(0,0),ut.activeTexture(33984),ut.bindFramebuffer(36160,null),$===!0&&(ut.bindFramebuffer(36009,null),ut.bindFramebuffer(36008,null)),ut.useProgram(null),ut.lineWidth(1),ut.scissor(0,0,ut.canvas.width,ut.canvas.height),ut.viewport(0,0,ut.canvas.width,ut.canvas.height),mt={},Gr=null,lr={},bt={},Mt=new WeakMap,St=[],It=null,Bt=!1,Dt=null,Ut=null,Ft=null,zt=null,Kt=null,tn=null,sn=null,ln=!1,kn=null,Ln=null,qn=null,Kn=null,Un=null,_r.set(0,0,ut.canvas.width,ut.canvas.height),Vr.set(0,0,ut.canvas.width,ut.canvas.height),_e.reset(),rt.reset(),at.reset()}}}function eC(ut,o,g,$,_e,rt,at){const ct=_e.isWebGL2,ft=_e.maxTextures,mt=_e.maxCubemapSize,bt=_e.maxTextureSize,Mt=_e.maxSamples,St=o.has("WEBGL_multisampled_render_to_texture")?o.get("WEBGL_multisampled_render_to_texture"):null,It=/OculusBrowser/g.test(navigator.userAgent),Bt=new WeakMap;let Dt;const Ut=new WeakMap;let Ft=!1;try{Ft=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function zt(In,yn){return Ft?new OffscreenCanvas(In,yn):w0("canvas")}function Kt(In,yn,tr,Wn){let Dn=1;if((In.width>Wn||In.height>Wn)&&(Dn=Wn/Math.max(In.width,In.height)),Dn<1||yn===!0){if(typeof HTMLImageElement<"u"&&In instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&In instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&In instanceof ImageBitmap){const Gn=yn?Bu:Math.floor,ur=Gn(Dn*In.width),Jt=Gn(Dn*In.height);Dt===void 0&&(Dt=zt(ur,Jt));const hr=tr?zt(ur,Jt):Dt;return hr.width=ur,hr.height=Jt,hr.getContext("2d").drawImage(In,0,0,ur,Jt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+In.width+"x"+In.height+") to ("+ur+"x"+Jt+")."),hr}return"data"in In&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+In.width+"x"+In.height+")."),In}return In}function tn(In){return yA(In.width)&&yA(In.height)}function sn(In,yn){return In.generateMipmaps&&yn&&In.minFilter!==Yo&&In.minFilter!==Ko}function ln(In){ut.generateMipmap(In)}function kn(In,yn,tr,Wn,Dn=!1){if(ct===!1)return yn;if(In!==null){if(ut[In]!==void 0)return ut[In];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+In+"'")}let Gn=yn;return yn===6403&&(tr===5126&&(Gn=33326),tr===5131&&(Gn=33325),tr===5121&&(Gn=33321)),yn===33319&&(tr===5126&&(Gn=33328),tr===5131&&(Gn=33327),tr===5121&&(Gn=33323)),yn===6408&&(tr===5126&&(Gn=34836),tr===5131&&(Gn=34842),tr===5121&&(Gn=Wn===Xs&&Dn===!1?35907:32856),tr===32819&&(Gn=32854),tr===32820&&(Gn=32855)),Gn!==33325&&Gn!==33326&&Gn!==33327&&Gn!==33328&&Gn!==34842&&Gn!==34836||o.get("EXT_color_buffer_float"),Gn}function Ln(In,yn,tr){return sn(In,tr)===!0||In.isFramebufferTexture&&In.minFilter!==Yo&&In.minFilter!==Ko?Math.log2(Math.max(yn.width,yn.height))+1:In.mipmaps!==void 0&&In.mipmaps.length>0?In.mipmaps.length:In.isCompressedTexture&&Array.isArray(In.image)?yn.mipmaps.length:1}function qn(In){return In===Yo||In===_u||In===Xo?9728:9729}function Kn(In){const yn=In.target;yn.removeEventListener("dispose",Kn),function(tr){const Wn=$.get(tr);if(Wn.__webglInit===void 0)return;const Dn=tr.source,Gn=Ut.get(Dn);if(Gn){const ur=Gn[Wn.__cacheKey];ur.usedTimes--,ur.usedTimes===0&&vr(tr),Object.keys(Gn).length===0&&Ut.delete(Dn)}$.remove(tr)}(yn),yn.isVideoTexture&&Bt.delete(yn)}function Un(In){const yn=In.target;yn.removeEventListener("dispose",Un),function(tr){const Wn=tr.texture,Dn=$.get(tr),Gn=$.get(Wn);if(Gn.__webglTexture!==void 0&&(ut.deleteTexture(Gn.__webglTexture),at.memory.textures--),tr.depthTexture&&tr.depthTexture.dispose(),tr.isWebGLCubeRenderTarget)for(let ur=0;ur<6;ur++)ut.deleteFramebuffer(Dn.__webglFramebuffer[ur]),Dn.__webglDepthbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthbuffer[ur]);else{if(ut.deleteFramebuffer(Dn.__webglFramebuffer),Dn.__webglDepthbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthbuffer),Dn.__webglMultisampledFramebuffer&&ut.deleteFramebuffer(Dn.__webglMultisampledFramebuffer),Dn.__webglColorRenderbuffer)for(let ur=0;ur<Dn.__webglColorRenderbuffer.length;ur++)Dn.__webglColorRenderbuffer[ur]&&ut.deleteRenderbuffer(Dn.__webglColorRenderbuffer[ur]);Dn.__webglDepthRenderbuffer&&ut.deleteRenderbuffer(Dn.__webglDepthRenderbuffer)}if(tr.isWebGLMultipleRenderTargets)for(let ur=0,Jt=Wn.length;ur<Jt;ur++){const hr=$.get(Wn[ur]);hr.__webglTexture&&(ut.deleteTexture(hr.__webglTexture),at.memory.textures--),$.remove(Wn[ur])}$.remove(Wn),$.remove(tr)}(yn)}function vr(In){const yn=$.get(In);ut.deleteTexture(yn.__webglTexture);const tr=In.source;delete Ut.get(tr)[yn.__cacheKey],at.memory.textures--}let Pr=0;function mr(In,yn){const tr=$.get(In);if(In.isVideoTexture&&function(Wn){const Dn=at.render.frame;Bt.get(Wn)!==Dn&&(Bt.set(Wn,Dn),Wn.update())}(In),In.isRenderTargetTexture===!1&&In.version>0&&tr.__version!==In.version){const Wn=In.image;if(Wn===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(Wn.complete!==!1)return void Or(tr,In,yn);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}g.activeTexture(33984+yn),g.bindTexture(3553,tr.__webglTexture)}const Qr={[Pu]:10497,[Oo]:33071,[Yp]:33648},Gr={[Yo]:9728,[_u]:9984,[Xo]:9986,[Ko]:9729,[Gm]:9985,[vo]:9987};function lr(In,yn,tr){if(tr?(ut.texParameteri(In,10242,Qr[yn.wrapS]),ut.texParameteri(In,10243,Qr[yn.wrapT]),In!==32879&&In!==35866||ut.texParameteri(In,32882,Qr[yn.wrapR]),ut.texParameteri(In,10240,Gr[yn.magFilter]),ut.texParameteri(In,10241,Gr[yn.minFilter])):(ut.texParameteri(In,10242,33071),ut.texParameteri(In,10243,33071),In!==32879&&In!==35866||ut.texParameteri(In,32882,33071),yn.wrapS===Oo&&yn.wrapT===Oo||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),ut.texParameteri(In,10240,qn(yn.magFilter)),ut.texParameteri(In,10241,qn(yn.minFilter)),yn.minFilter!==Yo&&yn.minFilter!==Ko&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),o.has("EXT_texture_filter_anisotropic")===!0){const Wn=o.get("EXT_texture_filter_anisotropic");if(yn.type===Hl&&o.has("OES_texture_float_linear")===!1||ct===!1&&yn.type===_m&&o.has("OES_texture_half_float_linear")===!1)return;(yn.anisotropy>1||$.get(yn).__currentAnisotropy)&&(ut.texParameterf(In,Wn.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(yn.anisotropy,_e.getMaxAnisotropy())),$.get(yn).__currentAnisotropy=yn.anisotropy)}}function dr(In,yn){let tr=!1;In.__webglInit===void 0&&(In.__webglInit=!0,yn.addEventListener("dispose",Kn));const Wn=yn.source;let Dn=Ut.get(Wn);Dn===void 0&&(Dn={},Ut.set(Wn,Dn));const Gn=function(ur){const Jt=[];return Jt.push(ur.wrapS),Jt.push(ur.wrapT),Jt.push(ur.magFilter),Jt.push(ur.minFilter),Jt.push(ur.anisotropy),Jt.push(ur.internalFormat),Jt.push(ur.format),Jt.push(ur.type),Jt.push(ur.generateMipmaps),Jt.push(ur.premultiplyAlpha),Jt.push(ur.flipY),Jt.push(ur.unpackAlignment),Jt.push(ur.encoding),Jt.join()}(yn);if(Gn!==In.__cacheKey){Dn[Gn]===void 0&&(Dn[Gn]={texture:ut.createTexture(),usedTimes:0},at.memory.textures++,tr=!0),Dn[Gn].usedTimes++;const ur=Dn[In.__cacheKey];ur!==void 0&&(Dn[In.__cacheKey].usedTimes--,ur.usedTimes===0&&vr(yn)),In.__cacheKey=Gn,In.__webglTexture=Dn[Gn].texture}return tr}function Or(In,yn,tr){let Wn=3553;yn.isDataArrayTexture&&(Wn=35866),yn.isData3DTexture&&(Wn=32879);const Dn=dr(In,yn),Gn=yn.source;if(g.activeTexture(33984+tr),g.bindTexture(Wn,In.__webglTexture),Gn.version!==Gn.__currentVersion||Dn===!0){ut.pixelStorei(37440,yn.flipY),ut.pixelStorei(37441,yn.premultiplyAlpha),ut.pixelStorei(3317,yn.unpackAlignment),ut.pixelStorei(37443,0);const ur=function(Ms){return!ct&&(Ms.wrapS!==Oo||Ms.wrapT!==Oo||Ms.minFilter!==Yo&&Ms.minFilter!==Ko)}(yn)&&tn(yn.image)===!1;let Jt=Kt(yn.image,ur,!1,bt);Jt=Qs(yn,Jt);const hr=tn(Jt)||ct,Zn=rt.convert(yn.format,yn.encoding);let gr,wr=rt.convert(yn.type),Xr=kn(yn.internalFormat,Zn,wr,yn.encoding,yn.isVideoTexture);lr(Wn,yn,hr);const vs=yn.mipmaps,Cs=ct&&yn.isVideoTexture!==!0,js=Gn.__currentVersion===void 0||Dn===!0,bs=Ln(yn,Jt,hr);if(yn.isDepthTexture)Xr=6402,ct?Xr=yn.type===Hl?36012:yn.type===jn?33190:yn.type===eo?35056:33189:yn.type===Hl&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),yn.format===yp&&Xr===6402&&yn.type!==mA&&yn.type!==jn&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),yn.type=jn,wr=rt.convert(yn.type)),yn.format===bv&&Xr===6402&&(Xr=34041,yn.type!==eo&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),yn.type=eo,wr=rt.convert(yn.type))),js&&(Cs?g.texStorage2D(3553,1,Xr,Jt.width,Jt.height):g.texImage2D(3553,0,Xr,Jt.width,Jt.height,0,Zn,wr,null));else if(yn.isDataTexture)if(vs.length>0&&hr){Cs&&js&&g.texStorage2D(3553,bs,Xr,vs[0].width,vs[0].height);for(let Ms=0,Eo=vs.length;Ms<Eo;Ms++)gr=vs[Ms],Cs?g.texSubImage2D(3553,Ms,0,0,gr.width,gr.height,Zn,wr,gr.data):g.texImage2D(3553,Ms,Xr,gr.width,gr.height,0,Zn,wr,gr.data);yn.generateMipmaps=!1}else Cs?(js&&g.texStorage2D(3553,bs,Xr,Jt.width,Jt.height),g.texSubImage2D(3553,0,0,0,Jt.width,Jt.height,Zn,wr,Jt.data)):g.texImage2D(3553,0,Xr,Jt.width,Jt.height,0,Zn,wr,Jt.data);else if(yn.isCompressedTexture){Cs&&js&&g.texStorage2D(3553,bs,Xr,vs[0].width,vs[0].height);for(let Ms=0,Eo=vs.length;Ms<Eo;Ms++)gr=vs[Ms],yn.format!==Yu?Zn!==null?Cs?g.compressedTexSubImage2D(3553,Ms,0,0,gr.width,gr.height,Zn,gr.data):g.compressedTexImage2D(3553,Ms,Xr,gr.width,gr.height,0,gr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Cs?g.texSubImage2D(3553,Ms,0,0,gr.width,gr.height,Zn,wr,gr.data):g.texImage2D(3553,Ms,Xr,gr.width,gr.height,0,Zn,wr,gr.data)}else if(yn.isDataArrayTexture)Cs?(js&&g.texStorage3D(35866,bs,Xr,Jt.width,Jt.height,Jt.depth),g.texSubImage3D(35866,0,0,0,0,Jt.width,Jt.height,Jt.depth,Zn,wr,Jt.data)):g.texImage3D(35866,0,Xr,Jt.width,Jt.height,Jt.depth,0,Zn,wr,Jt.data);else if(yn.isData3DTexture)Cs?(js&&g.texStorage3D(32879,bs,Xr,Jt.width,Jt.height,Jt.depth),g.texSubImage3D(32879,0,0,0,0,Jt.width,Jt.height,Jt.depth,Zn,wr,Jt.data)):g.texImage3D(32879,0,Xr,Jt.width,Jt.height,Jt.depth,0,Zn,wr,Jt.data);else if(yn.isFramebufferTexture){if(js)if(Cs)g.texStorage2D(3553,bs,Xr,Jt.width,Jt.height);else{let Ms=Jt.width,Eo=Jt.height;for(let lm=0;lm<bs;lm++)g.texImage2D(3553,lm,Xr,Ms,Eo,0,Zn,wr,null),Ms>>=1,Eo>>=1}}else if(vs.length>0&&hr){Cs&&js&&g.texStorage2D(3553,bs,Xr,vs[0].width,vs[0].height);for(let Ms=0,Eo=vs.length;Ms<Eo;Ms++)gr=vs[Ms],Cs?g.texSubImage2D(3553,Ms,0,0,Zn,wr,gr):g.texImage2D(3553,Ms,Xr,Zn,wr,gr);yn.generateMipmaps=!1}else Cs?(js&&g.texStorage2D(3553,bs,Xr,Jt.width,Jt.height),g.texSubImage2D(3553,0,0,0,Zn,wr,Jt)):g.texImage2D(3553,0,Xr,Zn,wr,Jt);sn(yn,hr)&&ln(Wn),Gn.__currentVersion=Gn.version,yn.onUpdate&&yn.onUpdate(yn)}In.__version=yn.version}function _r(In,yn,tr,Wn,Dn){const Gn=rt.convert(tr.format,tr.encoding),ur=rt.convert(tr.type),Jt=kn(tr.internalFormat,Gn,ur,tr.encoding);$.get(yn).__hasExternalTextures||(Dn===32879||Dn===35866?g.texImage3D(Dn,0,Jt,yn.width,yn.height,yn.depth,0,Gn,ur,null):g.texImage2D(Dn,0,Jt,yn.width,yn.height,0,Gn,ur,null)),g.bindFramebuffer(36160,In),gs(yn)?St.framebufferTexture2DMultisampleEXT(36160,Wn,Dn,$.get(tr).__webglTexture,0,Ks(yn)):ut.framebufferTexture2D(36160,Wn,Dn,$.get(tr).__webglTexture,0),g.bindFramebuffer(36160,null)}function Vr(In,yn,tr){if(ut.bindRenderbuffer(36161,In),yn.depthBuffer&&!yn.stencilBuffer){let Wn=33189;if(tr||gs(yn)){const Dn=yn.depthTexture;Dn&&Dn.isDepthTexture&&(Dn.type===Hl?Wn=36012:Dn.type===jn&&(Wn=33190));const Gn=Ks(yn);gs(yn)?St.renderbufferStorageMultisampleEXT(36161,Gn,Wn,yn.width,yn.height):ut.renderbufferStorageMultisample(36161,Gn,Wn,yn.width,yn.height)}else ut.renderbufferStorage(36161,Wn,yn.width,yn.height);ut.framebufferRenderbuffer(36160,36096,36161,In)}else if(yn.depthBuffer&&yn.stencilBuffer){const Wn=Ks(yn);tr&&gs(yn)===!1?ut.renderbufferStorageMultisample(36161,Wn,35056,yn.width,yn.height):gs(yn)?St.renderbufferStorageMultisampleEXT(36161,Wn,35056,yn.width,yn.height):ut.renderbufferStorage(36161,34041,yn.width,yn.height),ut.framebufferRenderbuffer(36160,33306,36161,In)}else{const Wn=yn.isWebGLMultipleRenderTargets===!0?yn.texture:[yn.texture];for(let Dn=0;Dn<Wn.length;Dn++){const Gn=Wn[Dn],ur=rt.convert(Gn.format,Gn.encoding),Jt=rt.convert(Gn.type),hr=kn(Gn.internalFormat,ur,Jt,Gn.encoding),Zn=Ks(yn);tr&&gs(yn)===!1?ut.renderbufferStorageMultisample(36161,Zn,hr,yn.width,yn.height):gs(yn)?St.renderbufferStorageMultisampleEXT(36161,Zn,hr,yn.width,yn.height):ut.renderbufferStorage(36161,hr,yn.width,yn.height)}}ut.bindRenderbuffer(36161,null)}function fs(In){const yn=$.get(In),tr=In.isWebGLCubeRenderTarget===!0;if(In.depthTexture&&!yn.__autoAllocateDepthBuffer){if(tr)throw new Error("target.depthTexture not supported in Cube render targets");(function(Wn,Dn){if(Dn&&Dn.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(g.bindFramebuffer(36160,Wn),!Dn.depthTexture||!Dn.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");$.get(Dn.depthTexture).__webglTexture&&Dn.depthTexture.image.width===Dn.width&&Dn.depthTexture.image.height===Dn.height||(Dn.depthTexture.image.width=Dn.width,Dn.depthTexture.image.height=Dn.height,Dn.depthTexture.needsUpdate=!0),mr(Dn.depthTexture,0);const Gn=$.get(Dn.depthTexture).__webglTexture,ur=Ks(Dn);if(Dn.depthTexture.format===yp)gs(Dn)?St.framebufferTexture2DMultisampleEXT(36160,36096,3553,Gn,0,ur):ut.framebufferTexture2D(36160,36096,3553,Gn,0);else{if(Dn.depthTexture.format!==bv)throw new Error("Unknown depthTexture format");gs(Dn)?St.framebufferTexture2DMultisampleEXT(36160,33306,3553,Gn,0,ur):ut.framebufferTexture2D(36160,33306,3553,Gn,0)}})(yn.__webglFramebuffer,In)}else if(tr){yn.__webglDepthbuffer=[];for(let Wn=0;Wn<6;Wn++)g.bindFramebuffer(36160,yn.__webglFramebuffer[Wn]),yn.__webglDepthbuffer[Wn]=ut.createRenderbuffer(),Vr(yn.__webglDepthbuffer[Wn],In,!1)}else g.bindFramebuffer(36160,yn.__webglFramebuffer),yn.__webglDepthbuffer=ut.createRenderbuffer(),Vr(yn.__webglDepthbuffer,In,!1);g.bindFramebuffer(36160,null)}function Ks(In){return Math.min(Mt,In.samples)}function gs(In){const yn=$.get(In);return ct&&In.samples>0&&o.has("WEBGL_multisampled_render_to_texture")===!0&&yn.__useRenderToTexture!==!1}function Qs(In,yn){const tr=In.encoding,Wn=In.format,Dn=In.type;return In.isCompressedTexture===!0||In.isVideoTexture===!0||In.format===_y||tr!==Jp&&(tr===Xs?ct===!1?o.has("EXT_sRGB")===!0&&Wn===Yu?(In.format=_y,In.minFilter=Ko,In.generateMipmaps=!1):yn=xA.sRGBToLinear(yn):Wn===Yu&&Dn===vm||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):tr===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",tr)),yn}this.allocateTextureUnit=function(){const In=Pr;return In>=ft&&console.warn("THREE.WebGLTextures: Trying to use "+In+" texture units while this GPU supports only "+ft),Pr+=1,In},this.resetTextureUnits=function(){Pr=0},this.setTexture2D=mr,this.setTexture2DArray=function(In,yn){const tr=$.get(In);In.version>0&&tr.__version!==In.version?Or(tr,In,yn):(g.activeTexture(33984+yn),g.bindTexture(35866,tr.__webglTexture))},this.setTexture3D=function(In,yn){const tr=$.get(In);In.version>0&&tr.__version!==In.version?Or(tr,In,yn):(g.activeTexture(33984+yn),g.bindTexture(32879,tr.__webglTexture))},this.setTextureCube=function(In,yn){const tr=$.get(In);In.version>0&&tr.__version!==In.version?function(Wn,Dn,Gn){if(Dn.image.length!==6)return;const ur=dr(Wn,Dn),Jt=Dn.source;if(g.activeTexture(33984+Gn),g.bindTexture(34067,Wn.__webglTexture),Jt.version!==Jt.__currentVersion||ur===!0){ut.pixelStorei(37440,Dn.flipY),ut.pixelStorei(37441,Dn.premultiplyAlpha),ut.pixelStorei(3317,Dn.unpackAlignment),ut.pixelStorei(37443,0);const hr=Dn.isCompressedTexture||Dn.image[0].isCompressedTexture,Zn=Dn.image[0]&&Dn.image[0].isDataTexture,gr=[];for(let Us=0;Us<6;Us++)gr[Us]=hr||Zn?Zn?Dn.image[Us].image:Dn.image[Us]:Kt(Dn.image[Us],!1,!0,mt),gr[Us]=Qs(Dn,gr[Us]);const wr=gr[0],Xr=tn(wr)||ct,vs=rt.convert(Dn.format,Dn.encoding),Cs=rt.convert(Dn.type),js=kn(Dn.internalFormat,vs,Cs,Dn.encoding),bs=ct&&Dn.isVideoTexture!==!0,Ms=Jt.__currentVersion===void 0||ur===!0;let Eo,lm=Ln(Dn,wr,Xr);if(lr(34067,Dn,Xr),hr){bs&&Ms&&g.texStorage2D(34067,lm,js,wr.width,wr.height);for(let Us=0;Us<6;Us++){Eo=gr[Us].mipmaps;for(let Do=0;Do<Eo.length;Do++){const Po=Eo[Do];Dn.format!==Yu?vs!==null?bs?g.compressedTexSubImage2D(34069+Us,Do,0,0,Po.width,Po.height,vs,Po.data):g.compressedTexImage2D(34069+Us,Do,js,Po.width,Po.height,0,Po.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):bs?g.texSubImage2D(34069+Us,Do,0,0,Po.width,Po.height,vs,Cs,Po.data):g.texImage2D(34069+Us,Do,js,Po.width,Po.height,0,vs,Cs,Po.data)}}}else{Eo=Dn.mipmaps,bs&&Ms&&(Eo.length>0&&lm++,g.texStorage2D(34067,lm,js,gr[0].width,gr[0].height));for(let Us=0;Us<6;Us++)if(Zn){bs?g.texSubImage2D(34069+Us,0,0,0,gr[Us].width,gr[Us].height,vs,Cs,gr[Us].data):g.texImage2D(34069+Us,0,js,gr[Us].width,gr[Us].height,0,vs,Cs,gr[Us].data);for(let Do=0;Do<Eo.length;Do++){const Po=Eo[Do].image[Us].image;bs?g.texSubImage2D(34069+Us,Do+1,0,0,Po.width,Po.height,vs,Cs,Po.data):g.texImage2D(34069+Us,Do+1,js,Po.width,Po.height,0,vs,Cs,Po.data)}}else{bs?g.texSubImage2D(34069+Us,0,0,0,vs,Cs,gr[Us]):g.texImage2D(34069+Us,0,js,vs,Cs,gr[Us]);for(let Do=0;Do<Eo.length;Do++){const Po=Eo[Do];bs?g.texSubImage2D(34069+Us,Do+1,0,0,vs,Cs,Po.image[Us]):g.texImage2D(34069+Us,Do+1,js,vs,Cs,Po.image[Us])}}}sn(Dn,Xr)&&ln(34067),Jt.__currentVersion=Jt.version,Dn.onUpdate&&Dn.onUpdate(Dn)}Wn.__version=Dn.version}(tr,In,yn):(g.activeTexture(33984+yn),g.bindTexture(34067,tr.__webglTexture))},this.rebindTextures=function(In,yn,tr){const Wn=$.get(In);yn!==void 0&&_r(Wn.__webglFramebuffer,In,In.texture,36064,3553),tr!==void 0&&fs(In)},this.setupRenderTarget=function(In){const yn=In.texture,tr=$.get(In),Wn=$.get(yn);In.addEventListener("dispose",Un),In.isWebGLMultipleRenderTargets!==!0&&(Wn.__webglTexture===void 0&&(Wn.__webglTexture=ut.createTexture()),Wn.__version=yn.version,at.memory.textures++);const Dn=In.isWebGLCubeRenderTarget===!0,Gn=In.isWebGLMultipleRenderTargets===!0,ur=tn(In)||ct;if(Dn){tr.__webglFramebuffer=[];for(let Jt=0;Jt<6;Jt++)tr.__webglFramebuffer[Jt]=ut.createFramebuffer()}else{if(tr.__webglFramebuffer=ut.createFramebuffer(),Gn)if(_e.drawBuffers){const Jt=In.texture;for(let hr=0,Zn=Jt.length;hr<Zn;hr++){const gr=$.get(Jt[hr]);gr.__webglTexture===void 0&&(gr.__webglTexture=ut.createTexture(),at.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(ct&&In.samples>0&&gs(In)===!1){const Jt=Gn?yn:[yn];tr.__webglMultisampledFramebuffer=ut.createFramebuffer(),tr.__webglColorRenderbuffer=[],g.bindFramebuffer(36160,tr.__webglMultisampledFramebuffer);for(let hr=0;hr<Jt.length;hr++){const Zn=Jt[hr];tr.__webglColorRenderbuffer[hr]=ut.createRenderbuffer(),ut.bindRenderbuffer(36161,tr.__webglColorRenderbuffer[hr]);const gr=rt.convert(Zn.format,Zn.encoding),wr=rt.convert(Zn.type),Xr=kn(Zn.internalFormat,gr,wr,Zn.encoding),vs=Ks(In);ut.renderbufferStorageMultisample(36161,vs,Xr,In.width,In.height),ut.framebufferRenderbuffer(36160,36064+hr,36161,tr.__webglColorRenderbuffer[hr])}ut.bindRenderbuffer(36161,null),In.depthBuffer&&(tr.__webglDepthRenderbuffer=ut.createRenderbuffer(),Vr(tr.__webglDepthRenderbuffer,In,!0)),g.bindFramebuffer(36160,null)}}if(Dn){g.bindTexture(34067,Wn.__webglTexture),lr(34067,yn,ur);for(let Jt=0;Jt<6;Jt++)_r(tr.__webglFramebuffer[Jt],In,yn,36064,34069+Jt);sn(yn,ur)&&ln(34067),g.unbindTexture()}else if(Gn){const Jt=In.texture;for(let hr=0,Zn=Jt.length;hr<Zn;hr++){const gr=Jt[hr],wr=$.get(gr);g.bindTexture(3553,wr.__webglTexture),lr(3553,gr,ur),_r(tr.__webglFramebuffer,In,gr,36064+hr,3553),sn(gr,ur)&&ln(3553)}g.unbindTexture()}else{let Jt=3553;(In.isWebGL3DRenderTarget||In.isWebGLArrayRenderTarget)&&(ct?Jt=In.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),g.bindTexture(Jt,Wn.__webglTexture),lr(Jt,yn,ur),_r(tr.__webglFramebuffer,In,yn,36064,Jt),sn(yn,ur)&&ln(Jt),g.unbindTexture()}In.depthBuffer&&fs(In)},this.updateRenderTargetMipmap=function(In){const yn=tn(In)||ct,tr=In.isWebGLMultipleRenderTargets===!0?In.texture:[In.texture],Wn=In.isWebGLCubeRenderTarget?34067:3553;for(let Dn=0,Gn=tr.length;Dn<Gn;Dn++){const ur=tr[Dn],Jt=$.get(ur),hr=Jt.__webglTexture;Jt.__version!==ur.version&&(g.bindTexture(Wn,hr),lr(Wn,ur,yn),g.unbindTexture(),Jt.__version=ur.version),sn(ur,yn)&&(g.bindTexture(Wn,hr),ln(Wn),g.unbindTexture())}},this.updateMultisampleRenderTarget=function(In){if(ct&&In.samples>0&&gs(In)===!1){const yn=In.isWebGLMultipleRenderTargets?In.texture:[In.texture],tr=In.width,Wn=In.height;let Dn=16384;const Gn=[],ur=In.stencilBuffer?33306:36096,Jt=$.get(In),hr=In.isWebGLMultipleRenderTargets===!0;if(hr)for(let Zn=0;Zn<yn.length;Zn++)g.bindFramebuffer(36160,Jt.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(36160,36064+Zn,36161,null),g.bindFramebuffer(36160,Jt.__webglFramebuffer),ut.framebufferTexture2D(36009,36064+Zn,3553,null,0);g.bindFramebuffer(36008,Jt.__webglMultisampledFramebuffer),g.bindFramebuffer(36009,Jt.__webglFramebuffer);for(let Zn=0;Zn<yn.length;Zn++){Gn.push(36064+Zn),In.depthBuffer&&Gn.push(ur);const gr=Jt.__ignoreDepthValues!==void 0&&Jt.__ignoreDepthValues;if(gr===!1&&(In.depthBuffer&&(Dn|=256),In.stencilBuffer&&(Dn|=1024)),hr&&ut.framebufferRenderbuffer(36008,36064,36161,Jt.__webglColorRenderbuffer[Zn]),gr===!0&&(ut.invalidateFramebuffer(36008,[ur]),ut.invalidateFramebuffer(36009,[ur])),hr){const wr=$.get(yn[Zn]).__webglTexture;ut.framebufferTexture2D(36009,36064,3553,wr,0)}ut.blitFramebuffer(0,0,tr,Wn,0,0,tr,Wn,Dn,9728),It&&ut.invalidateFramebuffer(36008,Gn)}if(g.bindFramebuffer(36008,null),g.bindFramebuffer(36009,null),hr)for(let Zn=0;Zn<yn.length;Zn++){g.bindFramebuffer(36160,Jt.__webglMultisampledFramebuffer),ut.framebufferRenderbuffer(36160,36064+Zn,36161,Jt.__webglColorRenderbuffer[Zn]);const gr=$.get(yn[Zn]).__webglTexture;g.bindFramebuffer(36160,Jt.__webglFramebuffer),ut.framebufferTexture2D(36009,36064+Zn,3553,gr,0)}g.bindFramebuffer(36009,Jt.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=fs,this.setupFrameBufferTexture=_r,this.useMultisampledRTT=gs}function H1(ut,o,g){const $=g.isWebGL2;return{convert:function(_e,rt=null){let at;if(_e===vm)return 5121;if(_e===Hm)return 32819;if(_e===so)return 32820;if(_e===qu)return 5120;if(_e===ly)return 5122;if(_e===mA)return 5123;if(_e===c_)return 5124;if(_e===jn)return 5125;if(_e===Hl)return 5126;if(_e===_m)return $?5131:(at=o.get("OES_texture_half_float"),at!==null?at.HALF_FLOAT_OES:null);if(_e===Sw)return 6406;if(_e===Yu)return 6408;if(_e===Ap)return 6409;if(_e===cy)return 6410;if(_e===yp)return 6402;if(_e===bv)return 34041;if(_e===gA)return 6403;if(_e===Cw)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(_e===_y)return at=o.get("EXT_sRGB"),at!==null?at.SRGB_ALPHA_EXT:null;if(_e===ip)return 36244;if(_e===uy)return 33319;if(_e===v1)return 33320;if(_e===Ev)return 36249;if(_e===rp||_e===Sv||_e===wo||_e===wp)if(rt===Xs){if(at=o.get("WEBGL_compressed_texture_s3tc_srgb"),at===null)return null;if(_e===rp)return at.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(_e===Sv)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(_e===wo)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(_e===wp)return at.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(at=o.get("WEBGL_compressed_texture_s3tc"),at===null)return null;if(_e===rp)return at.COMPRESSED_RGB_S3TC_DXT1_EXT;if(_e===Sv)return at.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(_e===wo)return at.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(_e===wp)return at.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(_e===Au||_e===u_||_e===_c||_e===ns){if(at=o.get("WEBGL_compressed_texture_pvrtc"),at===null)return null;if(_e===Au)return at.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(_e===u_)return at.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(_e===_c)return at.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(_e===ns)return at.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(_e===a0)return at=o.get("WEBGL_compressed_texture_etc1"),at!==null?at.COMPRESSED_RGB_ETC1_WEBGL:null;if(_e===ss||_e===Kp){if(at=o.get("WEBGL_compressed_texture_etc"),at===null)return null;if(_e===ss)return rt===Xs?at.COMPRESSED_SRGB8_ETC2:at.COMPRESSED_RGB8_ETC2;if(_e===Kp)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:at.COMPRESSED_RGBA8_ETC2_EAC}if(_e===Cv||_e===ho||_e===qs||_e===Wm||_e===vA||_e===Mv||_e===l0||_e===Ys||_e===hy||_e===c0||_e===Tv||_e===Iv||_e===xo||_e===po){if(at=o.get("WEBGL_compressed_texture_astc"),at===null)return null;if(_e===Cv)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:at.COMPRESSED_RGBA_ASTC_4x4_KHR;if(_e===ho)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:at.COMPRESSED_RGBA_ASTC_5x4_KHR;if(_e===qs)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:at.COMPRESSED_RGBA_ASTC_5x5_KHR;if(_e===Wm)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:at.COMPRESSED_RGBA_ASTC_6x5_KHR;if(_e===vA)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:at.COMPRESSED_RGBA_ASTC_6x6_KHR;if(_e===Mv)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:at.COMPRESSED_RGBA_ASTC_8x5_KHR;if(_e===l0)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:at.COMPRESSED_RGBA_ASTC_8x6_KHR;if(_e===Ys)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:at.COMPRESSED_RGBA_ASTC_8x8_KHR;if(_e===hy)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:at.COMPRESSED_RGBA_ASTC_10x5_KHR;if(_e===c0)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:at.COMPRESSED_RGBA_ASTC_10x6_KHR;if(_e===Tv)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:at.COMPRESSED_RGBA_ASTC_10x8_KHR;if(_e===Iv)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:at.COMPRESSED_RGBA_ASTC_10x10_KHR;if(_e===xo)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:at.COMPRESSED_RGBA_ASTC_12x10_KHR;if(_e===po)return rt===Xs?at.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:at.COMPRESSED_RGBA_ASTC_12x12_KHR}if(_e===qm){if(at=o.get("EXT_texture_compression_bptc"),at===null)return null;if(_e===qm)return rt===Xs?at.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:at.COMPRESSED_RGBA_BPTC_UNORM_EXT}return _e===eo?$?34042:(at=o.get("WEBGL_depth_texture"),at!==null?at.UNSIGNED_INT_24_8_WEBGL:null):ut[_e]!==void 0?ut[_e]:null}}}class tC extends Su{constructor(o=[]){super(),this.isArrayCamera=!0,this.cameras=o}}class B0 extends Fs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const vT={type:"move"};class W1{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new B0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new B0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new dn,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new dn),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new B0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new dn,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new dn),this._grip}dispatchEvent(o){return this._targetRay!==null&&this._targetRay.dispatchEvent(o),this._grip!==null&&this._grip.dispatchEvent(o),this._hand!==null&&this._hand.dispatchEvent(o),this}disconnect(o){return this.dispatchEvent({type:"disconnected",data:o}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(o,g,$){let _e=null,rt=null,at=null;const ct=this._targetRay,ft=this._grip,mt=this._hand;if(o&&g.session.visibilityState!=="visible-blurred"){if(mt&&o.hand){at=!0;for(const Dt of o.hand.values()){const Ut=g.getJointPose(Dt,$);if(mt.joints[Dt.jointName]===void 0){const zt=new B0;zt.matrixAutoUpdate=!1,zt.visible=!1,mt.joints[Dt.jointName]=zt,mt.add(zt)}const Ft=mt.joints[Dt.jointName];Ut!==null&&(Ft.matrix.fromArray(Ut.transform.matrix),Ft.matrix.decompose(Ft.position,Ft.rotation,Ft.scale),Ft.jointRadius=Ut.radius),Ft.visible=Ut!==null}const bt=mt.joints["index-finger-tip"],Mt=mt.joints["thumb-tip"],St=bt.position.distanceTo(Mt.position),It=.02,Bt=.005;mt.inputState.pinching&&St>It+Bt?(mt.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:o.handedness,target:this})):!mt.inputState.pinching&&St<=It-Bt&&(mt.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:o.handedness,target:this}))}else ft!==null&&o.gripSpace&&(rt=g.getPose(o.gripSpace,$),rt!==null&&(ft.matrix.fromArray(rt.transform.matrix),ft.matrix.decompose(ft.position,ft.rotation,ft.scale),rt.linearVelocity?(ft.hasLinearVelocity=!0,ft.linearVelocity.copy(rt.linearVelocity)):ft.hasLinearVelocity=!1,rt.angularVelocity?(ft.hasAngularVelocity=!0,ft.angularVelocity.copy(rt.angularVelocity)):ft.hasAngularVelocity=!1));ct!==null&&(_e=g.getPose(o.targetRaySpace,$),_e===null&&rt!==null&&(_e=rt),_e!==null&&(ct.matrix.fromArray(_e.transform.matrix),ct.matrix.decompose(ct.position,ct.rotation,ct.scale),_e.linearVelocity?(ct.hasLinearVelocity=!0,ct.linearVelocity.copy(_e.linearVelocity)):ct.hasLinearVelocity=!1,_e.angularVelocity?(ct.hasAngularVelocity=!0,ct.angularVelocity.copy(_e.angularVelocity)):ct.hasAngularVelocity=!1,this.dispatchEvent(vT)))}return ct!==null&&(ct.visible=_e!==null),ft!==null&&(ft.visible=rt!==null),mt!==null&&(mt.visible=at!==null),this}}class nC extends zl{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt){if((bt=bt!==void 0?bt:yp)!==yp&&bt!==bv)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");$===void 0&&bt===yp&&($=jn),$===void 0&&bt===bv&&($=eo),super(null,_e,rt,at,ct,ft,bt,$,mt),this.isDepthTexture=!0,this.image={width:o,height:g},this.magFilter=ct!==void 0?ct:Yo,this.minFilter=ft!==void 0?ft:Yo,this.flipY=!1,this.generateMipmaps=!1}}class Jw extends Ts{constructor(o,g){super();const $=this;let _e=null,rt=1,at=null,ct="local-floor",ft=null,mt=null,bt=null,Mt=null,St=null,It=null;const Bt=g.getContextAttributes();let Dt=null,Ut=null;const Ft=[],zt=[],Kt=new Su;Kt.layers.enable(1),Kt.viewport=new fo;const tn=new Su;tn.layers.enable(2),tn.viewport=new fo;const sn=[Kt,tn],ln=new tC;ln.layers.enable(1),ln.layers.enable(2);let kn=null,Ln=null;function qn(lr){const dr=zt.indexOf(lr.inputSource);if(dr===-1)return;const Or=Ft[dr];Or!==void 0&&Or.dispatchEvent({type:lr.type,data:lr.inputSource})}function Kn(){_e.removeEventListener("select",qn),_e.removeEventListener("selectstart",qn),_e.removeEventListener("selectend",qn),_e.removeEventListener("squeeze",qn),_e.removeEventListener("squeezestart",qn),_e.removeEventListener("squeezeend",qn),_e.removeEventListener("end",Kn),_e.removeEventListener("inputsourceschange",Un);for(let lr=0;lr<Ft.length;lr++){const dr=zt[lr];dr!==null&&(zt[lr]=null,Ft[lr].disconnect(dr))}kn=null,Ln=null,o.setRenderTarget(Dt),St=null,Mt=null,bt=null,_e=null,Ut=null,Gr.stop(),$.isPresenting=!1,$.dispatchEvent({type:"sessionend"})}function Un(lr){for(let dr=0;dr<lr.removed.length;dr++){const Or=lr.removed[dr],_r=zt.indexOf(Or);_r>=0&&(zt[_r]=null,Ft[_r].dispatchEvent({type:"disconnected",data:Or}))}for(let dr=0;dr<lr.added.length;dr++){const Or=lr.added[dr];let _r=zt.indexOf(Or);if(_r===-1){for(let fs=0;fs<Ft.length;fs++){if(fs>=zt.length){zt.push(Or),_r=fs;break}if(zt[fs]===null){zt[fs]=Or,_r=fs;break}}if(_r===-1)break}const Vr=Ft[_r];Vr&&Vr.dispatchEvent({type:"connected",data:Or})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(lr){let dr=Ft[lr];return dr===void 0&&(dr=new W1,Ft[lr]=dr),dr.getTargetRaySpace()},this.getControllerGrip=function(lr){let dr=Ft[lr];return dr===void 0&&(dr=new W1,Ft[lr]=dr),dr.getGripSpace()},this.getHand=function(lr){let dr=Ft[lr];return dr===void 0&&(dr=new W1,Ft[lr]=dr),dr.getHandSpace()},this.setFramebufferScaleFactor=function(lr){rt=lr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(lr){ct=lr,$.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return ft||at},this.setReferenceSpace=function(lr){ft=lr},this.getBaseLayer=function(){return Mt!==null?Mt:St},this.getBinding=function(){return bt},this.getFrame=function(){return It},this.getSession=function(){return _e},this.setSession=async function(lr){if(_e=lr,_e!==null){if(Dt=o.getRenderTarget(),_e.addEventListener("select",qn),_e.addEventListener("selectstart",qn),_e.addEventListener("selectend",qn),_e.addEventListener("squeeze",qn),_e.addEventListener("squeezestart",qn),_e.addEventListener("squeezeend",qn),_e.addEventListener("end",Kn),_e.addEventListener("inputsourceschange",Un),Bt.xrCompatible!==!0&&await g.makeXRCompatible(),_e.renderState.layers===void 0||o.capabilities.isWebGL2===!1){const dr={antialias:_e.renderState.layers!==void 0||Bt.antialias,alpha:Bt.alpha,depth:Bt.depth,stencil:Bt.stencil,framebufferScaleFactor:rt};St=new XRWebGLLayer(_e,g,dr),_e.updateRenderState({baseLayer:St}),Ut=new Ku(St.framebufferWidth,St.framebufferHeight,{format:Yu,type:vm,encoding:o.outputEncoding,stencilBuffer:Bt.stencil})}else{let dr=null,Or=null,_r=null;Bt.depth&&(_r=Bt.stencil?35056:33190,dr=Bt.stencil?bv:yp,Or=Bt.stencil?eo:jn);const Vr={colorFormat:32856,depthFormat:_r,scaleFactor:rt};bt=new XRWebGLBinding(_e,g),Mt=bt.createProjectionLayer(Vr),_e.updateRenderState({layers:[Mt]}),Ut=new Ku(Mt.textureWidth,Mt.textureHeight,{format:Yu,type:vm,depthTexture:new nC(Mt.textureWidth,Mt.textureHeight,Or,void 0,void 0,void 0,void 0,void 0,void 0,dr),stencilBuffer:Bt.stencil,encoding:o.outputEncoding,samples:Bt.antialias?4:0}),o.properties.get(Ut).__ignoreDepthValues=Mt.ignoreDepthValues}Ut.isXRRenderTarget=!0,this.setFoveation(1),ft=null,at=await _e.requestReferenceSpace(ct),Gr.setContext(_e),Gr.start(),$.isPresenting=!0,$.dispatchEvent({type:"sessionstart"})}};const vr=new dn,Pr=new dn;function mr(lr,dr){dr===null?lr.matrixWorld.copy(lr.matrix):lr.matrixWorld.multiplyMatrices(dr.matrixWorld,lr.matrix),lr.matrixWorldInverse.copy(lr.matrixWorld).invert()}this.updateCamera=function(lr){if(_e===null)return;ln.near=tn.near=Kt.near=lr.near,ln.far=tn.far=Kt.far=lr.far,kn===ln.near&&Ln===ln.far||(_e.updateRenderState({depthNear:ln.near,depthFar:ln.far}),kn=ln.near,Ln=ln.far);const dr=lr.parent,Or=ln.cameras;mr(ln,dr);for(let Vr=0;Vr<Or.length;Vr++)mr(Or[Vr],dr);ln.matrixWorld.decompose(ln.position,ln.quaternion,ln.scale),lr.matrix.copy(ln.matrix),lr.matrix.decompose(lr.position,lr.quaternion,lr.scale);const _r=lr.children;for(let Vr=0,fs=_r.length;Vr<fs;Vr++)_r[Vr].updateMatrixWorld(!0);Or.length===2?function(Vr,fs,Ks){vr.setFromMatrixPosition(fs.matrixWorld),Pr.setFromMatrixPosition(Ks.matrixWorld);const gs=vr.distanceTo(Pr),Qs=fs.projectionMatrix.elements,In=Ks.projectionMatrix.elements,yn=Qs[14]/(Qs[10]-1),tr=Qs[14]/(Qs[10]+1),Wn=(Qs[9]+1)/Qs[5],Dn=(Qs[9]-1)/Qs[5],Gn=(Qs[8]-1)/Qs[0],ur=(In[8]+1)/In[0],Jt=yn*Gn,hr=yn*ur,Zn=gs/(-Gn+ur),gr=Zn*-Gn;fs.matrixWorld.decompose(Vr.position,Vr.quaternion,Vr.scale),Vr.translateX(gr),Vr.translateZ(Zn),Vr.matrixWorld.compose(Vr.position,Vr.quaternion,Vr.scale),Vr.matrixWorldInverse.copy(Vr.matrixWorld).invert();const wr=yn+Zn,Xr=tr+Zn,vs=Jt-gr,Cs=hr+(gs-gr),js=Wn*tr/Xr*wr,bs=Dn*tr/Xr*wr;Vr.projectionMatrix.makePerspective(vs,Cs,js,bs,wr,Xr)}(ln,Kt,tn):ln.projectionMatrix.copy(Kt.projectionMatrix)},this.getCamera=function(){return ln},this.getFoveation=function(){return Mt!==null?Mt.fixedFoveation:St!==null?St.fixedFoveation:void 0},this.setFoveation=function(lr){Mt!==null&&(Mt.fixedFoveation=lr),St!==null&&St.fixedFoveation!==void 0&&(St.fixedFoveation=lr)};let Qr=null;this.onPreAnimationFrameCallback=null;const Gr=new P0;Gr.setAnimationLoop(function(lr,dr){if($.onPreAnimationFrameCallback&&$.onPreAnimationFrameCallback(lr,dr),mt=dr.getViewerPose(ft||at),It=dr,mt!==null){const Or=mt.views;St!==null&&(o.setRenderTargetFramebuffer(Ut,St.framebuffer),o.setRenderTarget(Ut));let _r=!1;Or.length!==ln.cameras.length&&(ln.cameras.length=0,_r=!0);for(let Vr=0;Vr<Or.length;Vr++){const fs=Or[Vr];let Ks=null;if(St!==null)Ks=St.getViewport(fs);else{const Qs=bt.getViewSubImage(Mt,fs);Ks=Qs.viewport,Vr===0&&(o.setRenderTargetTextures(Ut,Qs.colorTexture,Mt.ignoreDepthValues?void 0:Qs.depthStencilTexture),o.setRenderTarget(Ut))}let gs=sn[Vr];gs===void 0&&(gs=new Su,gs.layers.enable(Vr),gs.viewport=new fo,sn[Vr]=gs),gs.matrix.fromArray(fs.transform.matrix),gs.projectionMatrix.fromArray(fs.projectionMatrix),gs.viewport.set(Ks.x,Ks.y,Ks.width,Ks.height),Vr===0&&ln.matrix.copy(gs.matrix),_r===!0&&ln.cameras.push(gs)}}for(let Or=0;Or<Ft.length;Or++){const _r=zt[Or],Vr=Ft[Or];_r!==null&&Vr!==void 0&&Vr.update(_r,dr,ft||at)}Qr&&Qr(lr,dr),It=null}),this.setAnimationLoop=function(lr){Qr=lr},this.dispose=function(){}}}function _T(ut,o){function g($,_e){$.opacity.value=_e.opacity,_e.color&&$.diffuse.value.copy(_e.color),_e.emissive&&$.emissive.value.copy(_e.emissive).multiplyScalar(_e.emissiveIntensity),_e.map&&($.map.value=_e.map),_e.alphaMap&&($.alphaMap.value=_e.alphaMap),_e.bumpMap&&($.bumpMap.value=_e.bumpMap,$.bumpScale.value=_e.bumpScale,_e.side===$t&&($.bumpScale.value*=-1)),_e.displacementMap&&($.displacementMap.value=_e.displacementMap,$.displacementScale.value=_e.displacementScale,$.displacementBias.value=_e.displacementBias),_e.emissiveMap&&($.emissiveMap.value=_e.emissiveMap),_e.normalMap&&($.normalMap.value=_e.normalMap,$.normalScale.value.copy(_e.normalScale),_e.side===$t&&$.normalScale.value.negate()),_e.specularMap&&($.specularMap.value=_e.specularMap),_e.alphaTest>0&&($.alphaTest.value=_e.alphaTest);const rt=o.get(_e).envMap;if(rt){$.envMap.value=rt;const ft=o.get(_e).environment||rt;$.envMapRotation.value=ft?ft.rotation:0,$.flipEnvMap.value=rt.isCubeTexture&&rt.isRenderTargetTexture===!1?-1:1,$.reflectivity.value=_e.reflectivity,$.ior.value=_e.ior,$.refractionRatio.value=_e.refractionRatio}if(_e.lightMap){$.lightMap.value=_e.lightMap;const ft=ut.physicallyCorrectLights!==!0?Math.PI:1;$.lightMapIntensity.value=_e.lightMapIntensity*ft}let at,ct;_e.aoMap&&($.aoMap.value=_e.aoMap,$.aoMapIntensity.value=_e.aoMapIntensity),_e.map?at=_e.map:_e.specularMap?at=_e.specularMap:_e.displacementMap?at=_e.displacementMap:_e.normalMap?at=_e.normalMap:_e.bumpMap?at=_e.bumpMap:_e.roughnessMap?at=_e.roughnessMap:_e.metalnessMap?at=_e.metalnessMap:_e.alphaMap?at=_e.alphaMap:_e.emissiveMap?at=_e.emissiveMap:_e.clearcoatMap?at=_e.clearcoatMap:_e.clearcoatNormalMap?at=_e.clearcoatNormalMap:_e.clearcoatRoughnessMap?at=_e.clearcoatRoughnessMap:_e.iridescenceMap?at=_e.iridescenceMap:_e.iridescenceThicknessMap?at=_e.iridescenceThicknessMap:_e.specularIntensityMap?at=_e.specularIntensityMap:_e.specularColorMap?at=_e.specularColorMap:_e.transmissionMap?at=_e.transmissionMap:_e.thicknessMap?at=_e.thicknessMap:_e.sheenColorMap?at=_e.sheenColorMap:_e.sheenRoughnessMap&&(at=_e.sheenRoughnessMap),at!==void 0&&(at.isWebGLRenderTarget&&(at=at.texture),at.matrixAutoUpdate===!0&&at.updateMatrix(),$.uvTransform.value.copy(at.matrix)),_e.aoMap?ct=_e.aoMap:_e.lightMap&&(ct=_e.lightMap),ct!==void 0&&(ct.isWebGLRenderTarget&&(ct=ct.texture),ct.matrixAutoUpdate===!0&&ct.updateMatrix(),$.uv2Transform.value.copy(ct.matrix))}return{refreshFogUniforms:function($,_e){$.fogColor.value.copy(_e.color),_e.isFog?($.fogNear.value=_e.near,$.fogFar.value=_e.far):_e.isFogExp2&&($.fogDensity.value=_e.density)},refreshMaterialUniforms:function($,_e,rt,at,ct){_e.isMeshBasicMaterial||_e.isMeshLambertMaterial?g($,_e):_e.isMeshToonMaterial?(g($,_e),function(ft,mt){mt.gradientMap&&(ft.gradientMap.value=mt.gradientMap)}($,_e)):_e.isMeshPhongMaterial?(g($,_e),function(ft,mt){ft.specular.value.copy(mt.specular),ft.shininess.value=Math.max(mt.shininess,1e-4)}($,_e)):_e.isMeshStandardMaterial?(g($,_e),function(ft,mt){ft.roughness.value=mt.roughness,ft.metalness.value=mt.metalness,mt.roughnessMap&&(ft.roughnessMap.value=mt.roughnessMap),mt.metalnessMap&&(ft.metalnessMap.value=mt.metalnessMap),o.get(mt).envMap&&(ft.envMapIntensity.value=mt.envMapIntensity)}($,_e),_e.isMeshPhysicalMaterial&&function(ft,mt,bt){ft.ior.value=mt.ior,mt.sheen>0&&(ft.sheenColor.value.copy(mt.sheenColor).multiplyScalar(mt.sheen),ft.sheenRoughness.value=mt.sheenRoughness,mt.sheenColorMap&&(ft.sheenColorMap.value=mt.sheenColorMap),mt.sheenRoughnessMap&&(ft.sheenRoughnessMap.value=mt.sheenRoughnessMap)),mt.clearcoat>0&&(ft.clearcoat.value=mt.clearcoat,ft.clearcoatRoughness.value=mt.clearcoatRoughness,mt.clearcoatMap&&(ft.clearcoatMap.value=mt.clearcoatMap),mt.clearcoatRoughnessMap&&(ft.clearcoatRoughnessMap.value=mt.clearcoatRoughnessMap),mt.clearcoatNormalMap&&(ft.clearcoatNormalScale.value.copy(mt.clearcoatNormalScale),ft.clearcoatNormalMap.value=mt.clearcoatNormalMap,mt.side===$t&&ft.clearcoatNormalScale.value.negate())),mt.iridescence>0&&(ft.iridescence.value=mt.iridescence,ft.iridescenceIOR.value=mt.iridescenceIOR,ft.iridescenceThicknessMinimum.value=mt.iridescenceThicknessRange[0],ft.iridescenceThicknessMaximum.value=mt.iridescenceThicknessRange[1],mt.iridescenceMap&&(ft.iridescenceMap.value=mt.iridescenceMap),mt.iridescenceThicknessMap&&(ft.iridescenceThicknessMap.value=mt.iridescenceThicknessMap)),mt.transmission>0&&(ft.transmission.value=mt.transmission,ft.transmissionSamplerMap.value=bt.texture,ft.transmissionSamplerSize.value.set(bt.width,bt.height),mt.transmissionMap&&(ft.transmissionMap.value=mt.transmissionMap),ft.thickness.value=mt.thickness,mt.thicknessMap&&(ft.thicknessMap.value=mt.thicknessMap),ft.attenuationDistance.value=mt.attenuationDistance,ft.attenuationColor.value.copy(mt.attenuationColor)),ft.specularIntensity.value=mt.specularIntensity,ft.specularColor.value.copy(mt.specularColor),mt.specularIntensityMap&&(ft.specularIntensityMap.value=mt.specularIntensityMap),mt.specularColorMap&&(ft.specularColorMap.value=mt.specularColorMap)}($,_e,ct)):_e.isMeshMatcapMaterial?(g($,_e),function(ft,mt){mt.matcap&&(ft.matcap.value=mt.matcap)}($,_e)):_e.isMeshDepthMaterial?g($,_e):_e.isMeshDistanceMaterial?(g($,_e),function(ft,mt){ft.referencePosition.value.copy(mt.referencePosition),ft.nearDistance.value=mt.nearDistance,ft.farDistance.value=mt.farDistance}($,_e)):_e.isMeshNormalMaterial?g($,_e):_e.isLineBasicMaterial?(function(ft,mt){ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity}($,_e),_e.isLineDashedMaterial&&function(ft,mt){ft.dashSize.value=mt.dashSize,ft.totalSize.value=mt.dashSize+mt.gapSize,ft.scale.value=mt.scale}($,_e)):_e.isPointsMaterial?function(ft,mt,bt,Mt){let St;ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity,ft.size.value=mt.size*bt,ft.scale.value=.5*Mt,mt.map&&(ft.map.value=mt.map),mt.alphaMap&&(ft.alphaMap.value=mt.alphaMap),mt.alphaTest>0&&(ft.alphaTest.value=mt.alphaTest),mt.map?St=mt.map:mt.alphaMap&&(St=mt.alphaMap),St!==void 0&&(St.matrixAutoUpdate===!0&&St.updateMatrix(),ft.uvTransform.value.copy(St.matrix))}($,_e,rt,at):_e.isSpriteMaterial?function(ft,mt){let bt;ft.diffuse.value.copy(mt.color),ft.opacity.value=mt.opacity,ft.rotation.value=mt.rotation,mt.map&&(ft.map.value=mt.map),mt.alphaMap&&(ft.alphaMap.value=mt.alphaMap),mt.alphaTest>0&&(ft.alphaTest.value=mt.alphaTest),mt.map?bt=mt.map:mt.alphaMap&&(bt=mt.alphaMap),bt!==void 0&&(bt.matrixAutoUpdate===!0&&bt.updateMatrix(),ft.uvTransform.value.copy(bt.matrix))}($,_e):_e.isShadowMaterial?($.color.value.copy(_e.color),$.opacity.value=_e.opacity):_e.isShaderMaterial&&(_e.transmission!==void 0&&($.transmission&&($.transmission.value=_e.transmission),$.transmissionSamplerMap&&ct&&($.transmissionSamplerMap.value=ct?ct.texture:null),$.transmissionSamplerSize&&ct&&$.transmissionSamplerSize.value.set(ct.width,ct.height)),_e.uniformsNeedUpdate=!1)}}}function AT(ut,o,g,$){let _e={},rt={},at=[];const ct=g.isWebGL2?ut.getParameter(35375):0;function ft(Mt,St,It){const Bt=Mt.value;if(It[St]===void 0)return It[St]=typeof Bt=="number"?Bt:Bt.clone(),!0;if(typeof Bt=="number"){if(It[St]!==Bt)return It[St]=Bt,!0}else{const Dt=It[St];if(Dt.equals(Bt)===!1)return Dt.copy(Bt),!0}return!1}function mt(Mt){const St=Mt.value,It={boundary:0,storage:0};return typeof St=="number"?(It.boundary=4,It.storage=4):St.isVector2?(It.boundary=8,It.storage=8):St.isVector3||St.isColor?(It.boundary=16,It.storage=12):St.isVector4?(It.boundary=16,It.storage=16):St.isMatrix3?(It.boundary=48,It.storage=48):St.isMatrix4?(It.boundary=64,It.storage=64):St.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",St),It}function bt(Mt){const St=Mt.target;St.removeEventListener("dispose",bt);const It=at.indexOf(St.__bindingPointIndex);at.splice(It,1),ut.deleteBuffer(_e[St.id]),delete _e[St.id],delete rt[St.id]}return{bind:function(Mt,St){const It=St.program;$.uniformBlockBinding(Mt,It)},update:function(Mt,St){let It=_e[Mt.id];It===void 0&&(function(Ut){const Ft=Ut.uniforms;let zt=0,Kt=0;for(let tn=0,sn=Ft.length;tn<sn;tn++){const ln=Ft[tn],kn=mt(ln);if(ln.__data=new Float32Array(kn.storage/Float32Array.BYTES_PER_ELEMENT),ln.__offset=zt,tn>0){Kt=zt%16;const Ln=16-Kt;Kt!==0&&Ln-kn.boundary<0&&(zt+=16-Kt,ln.__offset=zt)}zt+=kn.storage}Kt=zt%16,Kt>0&&(zt+=16-Kt),Ut.__size=zt,Ut.__cache={}}(Mt),It=function(Ut){const Ft=function(){for(let sn=0;sn<ct;sn++)if(at.indexOf(sn)===-1)return at.push(sn),sn;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();Ut.__bindingPointIndex=Ft;const zt=ut.createBuffer(),Kt=Ut.__size,tn=Ut.usage;return ut.bindBuffer(35345,zt),ut.bufferData(35345,Kt,tn),ut.bindBuffer(35345,null),ut.bindBufferBase(35345,Ft,zt),zt}(Mt),_e[Mt.id]=It,Mt.addEventListener("dispose",bt));const Bt=St.program;$.updateUBOMapping(Mt,Bt);const Dt=o.render.frame;rt[Mt.id]!==Dt&&(function(Ut){const Ft=_e[Ut.id],zt=Ut.uniforms,Kt=Ut.__cache;ut.bindBuffer(35345,Ft);for(let tn=0,sn=zt.length;tn<sn;tn++){const ln=zt[tn];if(ft(ln,tn,Kt)===!0){const kn=ln.value,Ln=ln.__offset;typeof kn=="number"?(ln.__data[0]=kn,ut.bufferSubData(35345,Ln,ln.__data)):(ln.value.isMatrix3?(ln.__data[0]=ln.value.elements[0],ln.__data[1]=ln.value.elements[1],ln.__data[2]=ln.value.elements[2],ln.__data[3]=ln.value.elements[0],ln.__data[4]=ln.value.elements[3],ln.__data[5]=ln.value.elements[4],ln.__data[6]=ln.value.elements[5],ln.__data[7]=ln.value.elements[0],ln.__data[8]=ln.value.elements[6],ln.__data[9]=ln.value.elements[7],ln.__data[10]=ln.value.elements[8],ln.__data[11]=ln.value.elements[0]):kn.toArray(ln.__data),ut.bufferSubData(35345,Ln,ln.__data))}}ut.bindBuffer(35345,null)}(Mt),rt[Mt.id]=Dt)},dispose:function(){for(const Mt in _e)ut.deleteBuffer(_e[Mt]);at=[],_e={},rt={}}}}function Il(ut={}){this.isWebGLRenderer=!0;const o=ut.canvas!==void 0?ut.canvas:function(){const Sn=w0("canvas");return Sn.style.display="block",Sn}(),g=ut.context!==void 0?ut.context:null,$=ut.depth===void 0||ut.depth,_e=ut.stencil===void 0||ut.stencil,rt=ut.antialias!==void 0&&ut.antialias,at=ut.premultipliedAlpha===void 0||ut.premultipliedAlpha,ct=ut.preserveDrawingBuffer!==void 0&&ut.preserveDrawingBuffer,ft=ut.powerPreference!==void 0?ut.powerPreference:"default",mt=ut.failIfMajorPerformanceCaveat!==void 0&&ut.failIfMajorPerformanceCaveat;let bt;bt=g!==null?g.getContextAttributes().alpha:ut.alpha!==void 0&&ut.alpha;let Mt=null,St=null;const It=[],Bt=[];this.domElement=o,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Jp,this.physicallyCorrectLights=!1,this.toneMapping=Zs,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const Dt=this;let Ut=!1,Ft=0,zt=0,Kt=null,tn=-1,sn=null;const ln=new fo,kn=new fo;let Ln=null,qn=o.width,Kn=o.height,Un=1,vr=null,Pr=null;const mr=new fo(0,0,qn,Kn),Qr=new fo(0,0,qn,Kn);let Gr=!1;const lr=new jw;let dr=!1,Or=!1,_r=null;const Vr=new Is,fs=new Cr,Ks=new dn,gs={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Qs(){return Kt===null?Un:1}let In,yn,tr,Wn,Dn,Gn,ur,Jt,hr,Zn,gr,wr,Xr,vs,Cs,js,bs,Ms,Eo,lm,Us,Do,Po,zE,$r=g;function hI(Sn,fr){for(let br=0;br<Sn.length;br++){const yr=Sn[br],Ur=o.getContext(yr,fr);if(Ur!==null)return Ur}return null}try{const Sn={alpha:!0,depth:$,stencil:_e,antialias:rt,premultipliedAlpha:at,preserveDrawingBuffer:ct,powerPreference:ft,failIfMajorPerformanceCaveat:mt};if("setAttribute"in o&&o.setAttribute("data-engine",`three.js r${b}`),o.addEventListener("webglcontextlost",WC,!1),o.addEventListener("webglcontextrestored",pI,!1),o.addEventListener("webglcontextcreationerror",qC,!1),$r===null){const fr=["webgl2","webgl","experimental-webgl"];if(Dt.isWebGL1Renderer===!0&&fr.shift(),$r=hI(fr,Sn),$r===null)throw hI(fr)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}$r.getShaderPrecisionFormat===void 0&&($r.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Sn){throw console.error("THREE.WebGLRenderer: "+Sn.message),Sn}function dI(){In=new Yr($r),yn=new NM($r,In,ut),In.init(yn),Do=new H1($r,In,yn),tr=new $S($r,In,yn),Wn=new nv,Dn=new hT,Gn=new eC($r,In,tr,Dn,yn,Do,Wn),ur=new cD(Dt),Jt=new jM(Dt),hr=new Ly($r,yn),Po=new aD($r,In,hr,yn),Zn=new Ns($r,hr,Wn,Po),gr=new Bo($r,Zn,hr,Wn),Eo=new zM($r,yn,Gn),js=new lD(Dn),wr=new fD(Dt,ur,Jt,In,yn,Po,js),Xr=new _T(Dt,Dn),vs=new JS,Cs=new mT(In,yn),Ms=new oD(Dt,ur,tr,gr,bt,at),bs=new gT(Dt,gr,yn),zE=new AT($r,Wn,yn,tr),lm=new OM($r,In,Wn,yn),Us=new Oy($r,In,Wn,yn),Wn.programs=wr.programs,Dt.capabilities=yn,Dt.extensions=In,Dt.properties=Dn,Dt.renderLists=vs,Dt.shadowMap=bs,Dt.state=tr,Dt.info=Wn,Dt.background=Ms,Dt.cubeuvmaps=Jt}dI();const pp=new Jw(Dt,$r);function WC(Sn){Sn.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Ut=!0}function pI(){console.log("THREE.WebGLRenderer: Context Restored."),Ut=!1;const Sn=Wn.autoReset,fr=bs.enabled,br=bs.autoUpdate,yr=bs.needsUpdate,Ur=bs.type;dI(),Wn.autoReset=Sn,bs.enabled=fr,bs.autoUpdate=br,bs.needsUpdate=yr,bs.type=Ur}function qC(Sn){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Sn.statusMessage)}function io(Sn){const fr=Sn.target;fr.removeEventListener("dispose",io),function(br){(function(yr){const Ur=Dn.get(yr).programs;Ur!==void 0&&(Ur.forEach(function(cs){wr.releaseProgram(cs)}),yr.isShaderMaterial&&wr.releaseShaderCache(yr))})(br),Dn.remove(br)}(fr)}this.xr=pp,this.getContext=function(){return $r},this.getContextAttributes=function(){return $r.getContextAttributes()},this.forceContextLoss=function(){const Sn=In.get("WEBGL_lose_context");Sn&&Sn.loseContext()},this.forceContextRestore=function(){const Sn=In.get("WEBGL_lose_context");Sn&&Sn.restoreContext()},this.getPixelRatio=function(){return Un},this.setPixelRatio=function(Sn){Sn!==void 0&&(Un=Sn,this.setSize(qn,Kn,!1))},this.getSize=function(Sn){return Sn.set(qn,Kn)},this.setSize=function(Sn,fr,br){pp.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(qn=Sn,Kn=fr,o.width=Math.floor(Sn*Un),o.height=Math.floor(fr*Un),br!==!1&&(o.style.width=Sn+"px",o.style.height=fr+"px"),this.setViewport(0,0,Sn,fr))},this.getDrawingBufferSize=function(Sn){return Sn.set(qn*Un,Kn*Un).floor()},this.setDrawingBufferSize=function(Sn,fr,br){qn=Sn,Kn=fr,Un=br,o.width=Math.floor(Sn*br),o.height=Math.floor(fr*br),this.setViewport(0,0,Sn,fr)},this.getCurrentViewport=function(Sn){return Sn.copy(ln)},this.getViewport=function(Sn){return Sn.copy(mr)},this.setViewport=function(Sn,fr,br,yr){Sn.isVector4?mr.set(Sn.x,Sn.y,Sn.z,Sn.w):mr.set(Sn,fr,br,yr),tr.viewport(ln.copy(mr).multiplyScalar(Un).floor())},this.getScissor=function(Sn){return Sn.copy(Qr)},this.setScissor=function(Sn,fr,br,yr){Sn.isVector4?Qr.set(Sn.x,Sn.y,Sn.z,Sn.w):Qr.set(Sn,fr,br,yr),tr.scissor(kn.copy(Qr).multiplyScalar(Un).floor())},this.getScissorTest=function(){return Gr},this.setScissorTest=function(Sn){tr.setScissorTest(Gr=Sn)},this.setOpaqueSort=function(Sn){vr=Sn},this.setTransparentSort=function(Sn){Pr=Sn},this.getClearColor=function(Sn){return Sn.copy(Ms.getClearColor())},this.setClearColor=function(){Ms.setClearColor.apply(Ms,arguments)},this.getClearAlpha=function(){return Ms.getClearAlpha()},this.setClearAlpha=function(){Ms.setClearAlpha.apply(Ms,arguments)},this.clear=function(Sn=!0,fr=!0,br=!0){let yr=0;Sn&&(yr|=16384),fr&&(yr|=256),br&&(yr|=1024),$r.clear(yr)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){o.removeEventListener("webglcontextlost",WC,!1),o.removeEventListener("webglcontextrestored",pI,!1),o.removeEventListener("webglcontextcreationerror",qC,!1),vs.dispose(),Cs.dispose(),Dn.dispose(),ur.dispose(),Jt.dispose(),gr.dispose(),Po.dispose(),zE.dispose(),wr.dispose(),pp.dispose(),pp.removeEventListener("sessionstart",fp),pp.removeEventListener("sessionend",fI),_r&&(_r.dispose(),_r=null),YA.stop()},this.renderBufferDirect=function(Sn,fr,br,yr,Ur,cs){fr===null&&(fr=gs);const lo=Ur.isMesh&&Ur.matrixWorld.determinant()<0,Es=function(Fu,Gx,fv,Rs,Iu){Gx.isScene!==!0&&(Gx=gs),Gn.resetTextureUnits();const HE=Gx.fog,JC=Rs.isMeshStandardMaterial?Gx.environment:null,vI=Kt===null?Dt.outputEncoding:Kt.isXRRenderTarget===!0||Kt.texture.encoding&&Kt.texture.encoding!==Xs?Kt.texture.encoding:Jp,Hx=(Rs.isMeshStandardMaterial?Jt:ur).get(Rs.envMap||JC),Lm=Rs.vertexColors===!0&&!!fv.attributes.color&&fv.attributes.color.itemSize===4,bD=!!Rs.normalMap&&!!fv.attributes.tangent,_I=!!fv.morphAttributes.position,ZC=!!fv.morphAttributes.normal,ED=!!fv.morphAttributes.color,SD=Rs.toneMapped?Dt.toneMapping:Zs,WE=fv.morphAttributes.position||fv.morphAttributes.normal||fv.morphAttributes.color,CD=WE!==void 0?WE.length:0,ko=Dn.get(Rs),AI=St.state.lights;if(dr===!0&&(Or===!0||Fu!==sn)){const gp=Fu===sn&&Rs.id===tn;js.setState(Rs,Fu,gp)}let $v=!1;Rs.version===ko.__version?ko.needsLights&&ko.lightsStateVersion!==AI.state.version||ko.outputEncoding!==vI||Iu.isInstancedMesh&&ko.instancing===!1?$v=!0:Iu.isInstancedMesh||ko.instancing!==!0?Iu.isSkinnedMesh&&ko.skinning===!1?$v=!0:Iu.isSkinnedMesh||ko.skinning!==!0?ko.envMap!==Hx||Rs.fog===!0&&ko.fog!==HE?$v=!0:ko.numClippingPlanes===void 0||ko.numClippingPlanes===js.numPlanes&&ko.numIntersection===js.numIntersection?(ko.vertexAlphas!==Lm||ko.vertexTangents!==bD||ko.morphTargets!==_I||ko.morphNormals!==ZC||ko.morphColors!==ED||ko.toneMapping!==SD||yn.isWebGL2===!0&&ko.morphTargetsCount!==CD)&&($v=!0):$v=!0:$v=!0:$v=!0:($v=!0,ko.__version=Rs.version);let e0=ko.currentProgram;$v===!0&&(e0=zx(Rs,Gx,Iu));let qE=!1,XA=!1,mp=!1;const ju=e0.getUniforms(),mv=ko.uniforms;if(tr.useProgram(e0.program)&&(qE=!0,XA=!0,mp=!0),Rs.id!==tn&&(tn=Rs.id,XA=!0),qE||sn!==Fu){if(ju.setValue($r,"projectionMatrix",Fu.projectionMatrix),yn.logarithmicDepthBuffer&&ju.setValue($r,"logDepthBufFC",2/(Math.log(Fu.far+1)/Math.LN2)),sn!==Fu&&(sn=Fu,XA=!0,mp=!0),Rs.isShaderMaterial||Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshStandardMaterial||Rs.envMap){const gp=ju.map.cameraPosition;gp!==void 0&&gp.setValue($r,Ks.setFromMatrixPosition(Fu.matrixWorld))}(Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshLambertMaterial||Rs.isMeshBasicMaterial||Rs.isMeshStandardMaterial||Rs.isShaderMaterial)&&ju.setValue($r,"isOrthographic",Fu.isOrthographicCamera===!0),(Rs.isMeshPhongMaterial||Rs.isMeshToonMaterial||Rs.isMeshLambertMaterial||Rs.isMeshBasicMaterial||Rs.isMeshStandardMaterial||Rs.isShaderMaterial||Rs.isShadowMaterial||Iu.isSkinnedMesh)&&ju.setValue($r,"viewMatrix",Fu.matrixWorldInverse)}if(Iu.isSkinnedMesh){ju.setOptional($r,Iu,"bindMatrix"),ju.setOptional($r,Iu,"bindMatrixInverse");const gp=Iu.skeleton;gp&&(yn.floatVertexTextures?(gp.boneTexture===null&&gp.computeBoneTexture(),ju.setValue($r,"boneTexture",gp.boneTexture,Gn),ju.setValue($r,"boneTextureSize",gp.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const YE=fv.morphAttributes;var Om,Nm;(YE.position!==void 0||YE.normal!==void 0||YE.color!==void 0&&yn.isWebGL2===!0)&&Eo.update(Iu,fv,Rs,e0),(XA||ko.receiveShadow!==Iu.receiveShadow)&&(ko.receiveShadow=Iu.receiveShadow,ju.setValue($r,"receiveShadow",Iu.receiveShadow)),Rs.isMeshGouraudMaterial&&Rs.envMap!==null&&(mv.envMap.value=Hx,mv.flipEnvMap.value=Hx.isCubeTexture&&Hx.isRenderTargetTexture===!1?-1:1),XA&&(ju.setValue($r,"toneMappingExposure",Dt.toneMappingExposure),ko.needsLights&&(Nm=mp,(Om=mv).ambientLightColor.needsUpdate=Nm,Om.lightProbe.needsUpdate=Nm,Om.directionalLights.needsUpdate=Nm,Om.directionalLightShadows.needsUpdate=Nm,Om.pointLights.needsUpdate=Nm,Om.pointLightShadows.needsUpdate=Nm,Om.spotLights.needsUpdate=Nm,Om.spotLightShadows.needsUpdate=Nm,Om.rectAreaLights.needsUpdate=Nm,Om.hemisphereLights.needsUpdate=Nm),HE&&Rs.fog===!0&&Xr.refreshFogUniforms(mv,HE),Xr.refreshMaterialUniforms(mv,Rs,Un,Kn,Dt.userData.transmissionRenderTarget||_r),F1.upload($r,ko.uniformsList,mv,Gn)),Rs.isShaderMaterial&&Rs.uniformsNeedUpdate===!0&&(F1.upload($r,ko.uniformsList,mv,Gn),Rs.uniformsNeedUpdate=!1),Rs.isSpriteMaterial&&ju.setValue($r,"center",Iu.center),ju.setValue($r,"modelViewMatrix",Iu.modelViewMatrix),ju.setValue($r,"normalMatrix",Iu.normalMatrix),ju.setValue($r,"modelMatrix",Iu.matrixWorld);const $C=Rs.extraUniformsToUpload;if($C&&Object.entries($C).forEach(([gp,Wx])=>ju.setValue($r,gp,Wx.value,Gn)),Rs.isShaderMaterial||Rs.isRawShaderMaterial){const gp=Rs.uniformsGroups;for(let Wx=0,MD=gp.length;Wx<MD;Wx++)if(yn.isWebGL2){const yI=gp[Wx];zE.update(yI,e0),zE.bind(yI,e0)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return e0}(Sn,fr,br,yr,Ur);tr.setMaterial(yr,lo);let Js=br.index;const _l=br.attributes.position;if(Js===null){if(_l===void 0||_l.count===0)return}else if(Js.count===0)return;let co,Hs=1;yr.wireframe===!0&&(Js=Zn.getWireframeAttribute(br),Hs=2),Po.setup(Ur,yr,Es,br,Js);let Jl=lm;Js!==null&&(co=hr.get(Js),Jl=Us,Jl.setIndex(co));const Vx=Js!==null?Js.count:_l.count,km=br.drawRange.start*Hs,QE=br.drawRange.count*Hs,Zv=cs!==null?cs.start*Hs:0,XC=cs!==null?cs.count*Hs:1/0,GE=Math.max(km,Zv),KC=Math.min(Vx,km+QE,Zv+XC)-1,Qx=Math.max(0,KC-GE+1);if(Qx!==0){if(Ur.isMesh)yr.wireframe===!0?(tr.setLineWidth(yr.wireframeLinewidth*Qs()),Jl.setMode(1)):Jl.setMode(4);else if(Ur.isLine){let Fu=yr.linewidth;Fu===void 0&&(Fu=1),tr.setLineWidth(Fu*Qs()),Ur.isLineSegments?Jl.setMode(1):Ur.isLineLoop?Jl.setMode(2):Jl.setMode(3)}else Ur.isPoints?Jl.setMode(0):Ur.isSprite&&Jl.setMode(4);if(Ur.isInstancedMesh)Jl.renderInstances(GE,Qx,Ur.count);else if(br.isInstancedBufferGeometry){const Fu=Math.min(br.instanceCount,br._maxInstanceCount);Jl.renderInstances(GE,Qx,Fu)}else Jl.render(GE,Qx)}},this.compile=function(Sn,fr){function br(yr,Ur,cs){yr.transparent===!0&&yr.side===bn?(yr.side=$t,yr.needsUpdate=!0,zx(yr,Ur,cs),yr.side=_n,yr.needsUpdate=!0,zx(yr,Ur,cs),yr.side=bn):zx(yr,Ur,cs)}St=Cs.get(Sn),St.init(),Bt.push(St),Sn.traverseVisible(function(yr){yr.isLight&&yr.layers.test(fr.layers)&&(St.pushLight(yr),yr.castShadow&&St.pushShadow(yr))}),St.setupLights(Dt.physicallyCorrectLights),Sn.traverse(function(yr){const Ur=yr.material;if(Ur)if(Array.isArray(Ur))for(let cs=0;cs<Ur.length;cs++)br(Ur[cs],Sn,yr);else br(Ur,Sn,yr)}),Bt.pop(),St=null};let Bl=null;function fp(){YA.stop()}function fI(){YA.start()}const YA=new P0;function mI(Sn,fr,br,yr){if(Sn.visible===!1)return;if(Sn.layers.test(fr.layers)){if(Sn.isGroup)br=Sn.renderOrder;else if(Sn.isLOD)Sn.autoUpdate===!0&&Sn.update(fr);else if(Sn.isLight)St.pushLight(Sn),Sn.castShadow&&St.pushShadow(Sn);else if(Sn.isSprite){if(!Sn.frustumCulled||lr.intersectsSprite(Sn)){yr&&Ks.setFromMatrixPosition(Sn.matrixWorld).applyMatrix4(Vr);const cs=gr.update(Sn),lo=Sn.material;lo.visible&&Mt.push(Sn,cs,lo,br,Ks.z,null)}}else if((Sn.isMesh||Sn.isLine||Sn.isPoints)&&(Sn.isSkinnedMesh&&Sn.skeleton.frame!==Wn.render.frame&&(Sn.skeleton.update(),Sn.skeleton.frame=Wn.render.frame),!Sn.frustumCulled||lr.intersectsObject(Sn))){yr&&Ks.setFromMatrixPosition(Sn.matrixWorld).applyMatrix4(Vr);const cs=gr.update(Sn),lo=Sn.material;if(Array.isArray(lo)){const Es=cs.groups;for(let Js=0,_l=Es.length;Js<_l;Js++){const co=Es[Js],Hs=lo[co.materialIndex];Hs&&Hs.visible&&Mt.push(Sn,cs,Hs,br,Ks.z,co)}}else lo.visible&&Mt.push(Sn,cs,lo,br,Ks.z,null)}}const Ur=Sn.children;for(let cs=0,lo=Ur.length;cs<lo;cs++)mI(Ur[cs],fr,br,yr)}function gI(Sn,fr,br,yr){const Ur=Sn.opaque,cs=Sn.transmissive,lo=Sn.transparent;if(St.setupLightsView(br),Dt.userData.transmissionRender===void 0&&Dt.userData.renderTransmissionPass!==!1&&cs.length>0&&function(Es,Js,_l){console.error("three.js internal render transmission pass should not be called");const co=yn.isWebGL2;_r===null&&(_r=new Ku(1,1,{generateMipmaps:!0,type:In.has("EXT_color_buffer_half_float")?_m:vm,minFilter:vo,samples:co&&rt===!0?4:0})),Dt.getDrawingBufferSize(fs),co?_r.setSize(fs.x,fs.y):_r.setSize(Bu(fs.x),Bu(fs.y));const Hs=Dt.getRenderTarget();Dt.setRenderTarget(_r),Dt.clear();const Jl=Dt.toneMapping;Dt.toneMapping=Zs,VE(Es,Js,_l),Dt.toneMapping=Jl,Gn.updateMultisampleRenderTarget(_r),Gn.updateRenderTargetMipmap(_r),Dt.setRenderTarget(Hs)}([...Ur,...lo],fr,br),yr&&tr.viewport(ln.copy(yr)),Dt.userData.opaqueRender!==!1&&Ur.length>0&&VE(Ur,fr,br),Dt.userData.transparentRender!==!1&&lo.length>0&&VE(lo,fr,br),Dt.userData.transmissionRender!==!1&&cs.length>0){_r||(_r=new Ku(1,1));const Es=Dt.userData.transmissionRenderTarget.texture,Js=yn.isWebGL2,_l=Es.generateMipmaps,co=Es.minFilter;Js&&Dt.userData.blurTransmissionTarget&&(Es.generateMipmaps=!0,Es.minFilter=vo,Es.needsUpdate=!0,Gn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget)),VE(cs,fr,br),Js&&Dt.userData.blurTransmissionTarget&&(Es.generateMipmaps=_l,Es.minFilter=co,Es.needsUpdate=!0,Gn.updateRenderTargetMipmap(Dt.userData.transmissionRenderTarget))}tr.buffers.depth.setTest(!0),tr.buffers.depth.setMask(!0),tr.buffers.color.setMask(!0),tr.setPolygonOffset(!1)}function VE(Sn,fr,br){const yr={...Dt.userData};Dt.userData.opaqueRender=void 0,Dt.userData.transparentRender=void 0,Dt.userData.transmissionRender=void 0,Dt.userData.backgroundRender=void 0;const Ur=fr.isScene===!0?fr.overrideMaterial:null;for(let cs=0,lo=Sn.length;cs<lo;cs++){const Es=Sn[cs],Js=Es.object,_l=Es.geometry,co=Ur===null?Es.material:Ur,Hs=Es.group;Js.layers.test(br.layers)&&xD(Js,fr,br,_l,co,Hs)}Object.assign(Dt.userData,yr)}function xD(Sn,fr,br,yr,Ur,cs){Sn.onBeforeRender(Dt,fr,br,yr,Ur,cs),Sn.modelViewMatrix.multiplyMatrices(br.matrixWorldInverse,Sn.matrixWorld),Sn.normalMatrix.getNormalMatrix(Sn.modelViewMatrix),Ur.onBeforeRender(Dt,fr,br,yr,Sn,cs),Ur.transparent===!0&&Ur.side===bn?(Ur.side=$t,Ur.needsUpdate=!0,Dt.renderBufferDirect(br,fr,yr,Ur,Sn,cs),Ur.side=_n,Ur.needsUpdate=!0,Dt.renderBufferDirect(br,fr,yr,Ur,Sn,cs),Ur.side=bn):Dt.renderBufferDirect(br,fr,yr,Ur,Sn,cs),Sn.onAfterRender(Dt,fr,br,yr,Ur,cs),Ur.onAfterRender(Dt,fr,br,yr,Sn,cs)}function zx(Sn,fr,br){fr.isScene!==!0&&(fr=gs);const yr=Dn.get(Sn),Ur=St.state.lights,cs=St.state.shadowsArray,lo=Ur.state.version,Es=wr.getParameters(Sn,Ur.state,cs,fr,br),Js=wr.getProgramCacheKey(Es);let _l=yr.programs;yr.environment=Sn.isMeshStandardMaterial?fr.environment:null,yr.fog=fr.fog,yr.envMap=(Sn.isMeshStandardMaterial?Jt:ur).get(Sn.envMap||yr.environment),_l===void 0&&(Sn.addEventListener("dispose",io),_l=new Map,yr.programs=_l);let co=_l.get(Js);if(co!==void 0){if(yr.currentProgram===co&&yr.lightsStateVersion===lo)return YC(Sn,Es),co}else Es.uniforms=wr.getUniforms(Sn),Sn.onBuild(br,Es,Dt),Sn.onBeforeCompile(Es,Dt),co=wr.acquireProgram(Es,Js),_l.set(Js,co),yr.uniforms=Es.uniforms;const Hs=yr.uniforms;(Sn.isShaderMaterial||Sn.isRawShaderMaterial)&&Sn.clipping!==!0||(Hs.clippingPlanes=js.uniform),YC(Sn,Es),yr.needsLights=function(km){return km.isMeshLambertMaterial||km.isMeshToonMaterial||km.isMeshPhongMaterial||km.isMeshStandardMaterial||km.isShadowMaterial||km.isShaderMaterial&&km.lights===!0}(Sn),yr.lightsStateVersion=lo,yr.needsLights&&(Hs.ambientLightColor.value=Ur.state.ambient,Hs.lightProbe.value=Ur.state.probe,Hs.directionalLights.value=Ur.state.directional,Hs.directionalLightShadows.value=Ur.state.directionalShadow,Hs.spotLights.value=Ur.state.spot,Hs.spotLightShadows.value=Ur.state.spotShadow,Hs.rectAreaLights.value=Ur.state.rectArea,Hs.ltc_1.value=Ur.state.rectAreaLTC1,Hs.ltc_2.value=Ur.state.rectAreaLTC2,Hs.pointLights.value=Ur.state.point,Hs.pointLightShadows.value=Ur.state.pointShadow,Hs.hemisphereLights.value=Ur.state.hemi,Hs.directionalShadowMap.value=Ur.state.directionalShadowMap,Hs.directionalShadowMatrix.value=Ur.state.directionalShadowMatrix,Hs.spotShadowMap.value=Ur.state.spotShadowMap,Hs.spotLightMatrix.value=Ur.state.spotLightMatrix,Hs.spotLightMap.value=Ur.state.spotLightMap,Hs.pointShadowMap.value=Ur.state.pointShadowMap,Hs.pointShadowMatrix.value=Ur.state.pointShadowMatrix);const Jl=co.getUniforms(),Vx=F1.seqWithValue(Jl.seq,Hs);return yr.currentProgram=co,yr.uniformsList=Vx,co}function YC(Sn,fr){const br=Dn.get(Sn);br.outputEncoding=fr.outputEncoding,br.instancing=fr.instancing,br.skinning=fr.skinning,br.morphTargets=fr.morphTargets,br.morphNormals=fr.morphNormals,br.morphColors=fr.morphColors,br.morphTargetsCount=fr.morphTargetsCount,br.numClippingPlanes=fr.numClippingPlanes,br.numIntersection=fr.numClipIntersection,br.vertexAlphas=fr.vertexAlphas,br.vertexTangents=fr.vertexTangents,br.toneMapping=fr.toneMapping}YA.setAnimationLoop(function(Sn){Bl&&Bl(Sn)}),typeof self<"u"&&YA.setContext(self),this.setAnimationLoop=function(Sn){Bl=Sn,pp.setAnimationLoop(Sn),Sn===null?YA.stop():YA.start()},pp.addEventListener("sessionstart",fp),pp.addEventListener("sessionend",fI),this.render=function(Sn,fr){if(fr===void 0||fr.isCamera===!0){if(Ut!==!0){if(Sn.matrixWorldAutoUpdate===!0&&Sn.updateMatrixWorld(),fr.parent===null&&fr.matrixWorldAutoUpdate===!0&&fr.updateMatrixWorld(),pp.enabled===!0&&pp.isPresenting===!0&&(pp.cameraAutoUpdate===!0&&pp.updateCamera(fr),fr=pp.getCamera()),Sn.isScene===!0&&Sn.onBeforeRender(Dt,Sn,fr,Kt),St=Cs.get(Sn,Bt.length),St.init(),Bt.push(St),Vr.multiplyMatrices(fr.projectionMatrix,fr.matrixWorldInverse),lr.setFromProjectionMatrix(Vr),Or=this.localClippingEnabled,dr=js.init(this.clippingPlanes,Or,fr),Mt=vs.get(Sn,It.length),Mt.init(),It.push(Mt),mI(Sn,fr,0,Dt.sortObjects),Mt.finish(),Dt.sortObjects===!0&&Mt.sort(vr,Pr),Dt.userData.shadowMapRender){dr===!0&&js.beginShadows();const br=St.state.shadowsArray;br.length>0&&bs.render(br,Sn,fr),dr===!0&&js.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),Dt.userData.backgroundRender!==!1&&Ms.render(Mt,Sn),Dt.userData.sceneRender!==!1)if(St.setupLights(Dt.physicallyCorrectLights),fr.isArrayCamera){const br=fr.cameras;for(let yr=0,Ur=br.length;yr<Ur;yr++){const cs=br[yr];gI(Mt,Sn,cs,cs.viewport)}}else gI(Mt,Sn,fr);Kt!==null&&(Gn.updateMultisampleRenderTarget(Kt),Gn.updateRenderTargetMipmap(Kt)),Sn.isScene===!0&&Sn.onAfterRender(Dt,Sn,fr),Po.resetDefaultState(),tn=-1,sn=null,Bt.pop(),St=Bt.length>0?Bt[Bt.length-1]:null,It.pop(),Mt=It.length>0?It[It.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return Ft},this.getActiveMipmapLevel=function(){return zt},this.getRenderTarget=function(){return Kt},this.setRenderTargetTextures=function(Sn,fr,br){Dn.get(Sn.texture).__webglTexture=fr,Dn.get(Sn.depthTexture).__webglTexture=br;const yr=Dn.get(Sn);yr.__hasExternalTextures=!0,yr.__hasExternalTextures&&(yr.__autoAllocateDepthBuffer=br===void 0,yr.__autoAllocateDepthBuffer||In.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),yr.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Sn,fr){const br=Dn.get(Sn);br.__webglFramebuffer=fr,br.__useDefaultFramebuffer=fr===void 0},this.setRenderTarget=function(Sn,fr=0,br=0){Kt=Sn,Ft=fr,zt=br;let yr=!0;if(Sn){const Es=Dn.get(Sn);Es.__useDefaultFramebuffer!==void 0?(tr.bindFramebuffer(36160,null),yr=!1):Es.__webglFramebuffer===void 0?Gn.setupRenderTarget(Sn):Es.__hasExternalTextures&&Gn.rebindTextures(Sn,Dn.get(Sn.texture).__webglTexture,Dn.get(Sn.depthTexture).__webglTexture)}let Ur=null,cs=!1,lo=!1;if(Sn){const Es=Sn.texture;(Es.isData3DTexture||Es.isDataArrayTexture)&&(lo=!0);const Js=Dn.get(Sn).__webglFramebuffer;Sn.isWebGLCubeRenderTarget?(Ur=Js[fr],cs=!0):Ur=yn.isWebGL2&&Sn.samples>0&&Gn.useMultisampledRTT(Sn)===!1?Dn.get(Sn).__webglMultisampledFramebuffer:Js,ln.copy(Sn.viewport),kn.copy(Sn.scissor),Ln=Sn.scissorTest}else ln.copy(mr).multiplyScalar(Un).floor(),kn.copy(Qr).multiplyScalar(Un).floor(),Ln=Gr;if(tr.bindFramebuffer(36160,Ur)&&yn.drawBuffers&&yr&&tr.drawBuffers(Sn,Ur),tr.viewport(ln),tr.scissor(kn),tr.setScissorTest(Ln),cs){const Es=Dn.get(Sn.texture);$r.framebufferTexture2D(36160,36064,34069+fr,Es.__webglTexture,br)}else if(lo){const Es=Dn.get(Sn.texture),Js=fr||0;$r.framebufferTextureLayer(36160,36064,Es.__webglTexture,br||0,Js)}tn=-1},this.readRenderTargetPixels=function(Sn,fr,br,yr,Ur,cs,lo){if(!Sn||!Sn.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Es=Dn.get(Sn).__webglFramebuffer;if(Sn.isWebGLCubeRenderTarget&&lo!==void 0&&(Es=Es[lo]),Es){tr.bindFramebuffer(36160,Es);try{const Js=Sn.texture,_l=Js.format,co=Js.type;if(_l!==Yu&&Do.convert(_l)!==$r.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const Hs=co===_m&&(In.has("EXT_color_buffer_half_float")||yn.isWebGL2&&In.has("EXT_color_buffer_float"));if(!(co===vm||Do.convert(co)===$r.getParameter(35738)||co===Hl&&(yn.isWebGL2||In.has("OES_texture_float")||In.has("WEBGL_color_buffer_float"))||Hs))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");fr>=0&&fr<=Sn.width-yr&&br>=0&&br<=Sn.height-Ur&&$r.readPixels(fr,br,yr,Ur,Do.convert(_l),Do.convert(co),cs)}finally{const Js=Kt!==null?Dn.get(Kt).__webglFramebuffer:null;tr.bindFramebuffer(36160,Js)}}},this.copyFramebufferToTexture=function(Sn,fr,br=0){const yr=Math.pow(2,-br),Ur=Math.floor(fr.image.width*yr),cs=Math.floor(fr.image.height*yr);Gn.setTexture2D(fr,0),$r.copyTexSubImage2D(3553,br,0,0,Sn.x,Sn.y,Ur,cs),tr.unbindTexture()},this.copyTextureToTexture=function(Sn,fr,br,yr=0){const Ur=fr.image.width,cs=fr.image.height,lo=Do.convert(br.format),Es=Do.convert(br.type);Gn.setTexture2D(br,0),$r.pixelStorei(37440,br.flipY),$r.pixelStorei(37441,br.premultiplyAlpha),$r.pixelStorei(3317,br.unpackAlignment),fr.isDataTexture?$r.texSubImage2D(3553,yr,Sn.x,Sn.y,Ur,cs,lo,Es,fr.image.data):fr.isCompressedTexture?$r.compressedTexSubImage2D(3553,yr,Sn.x,Sn.y,fr.mipmaps[0].width,fr.mipmaps[0].height,lo,fr.mipmaps[0].data):$r.texSubImage2D(3553,yr,Sn.x,Sn.y,lo,Es,fr.image),yr===0&&br.generateMipmaps&&$r.generateMipmap(3553),tr.unbindTexture()},this.copyTextureToTexture3D=function(Sn,fr,br,yr,Ur=0){if(Dt.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const cs=Sn.max.x-Sn.min.x+1,lo=Sn.max.y-Sn.min.y+1,Es=Sn.max.z-Sn.min.z+1,Js=Do.convert(yr.format),_l=Do.convert(yr.type);let co;if(yr.isData3DTexture)Gn.setTexture3D(yr,0),co=32879;else{if(!yr.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Gn.setTexture2DArray(yr,0),co=35866}$r.pixelStorei(37440,yr.flipY),$r.pixelStorei(37441,yr.premultiplyAlpha),$r.pixelStorei(3317,yr.unpackAlignment);const Hs=$r.getParameter(3314),Jl=$r.getParameter(32878),Vx=$r.getParameter(3316),km=$r.getParameter(3315),QE=$r.getParameter(32877),Zv=br.isCompressedTexture?br.mipmaps[0]:br.image;$r.pixelStorei(3314,Zv.width),$r.pixelStorei(32878,Zv.height),$r.pixelStorei(3316,Sn.min.x),$r.pixelStorei(3315,Sn.min.y),$r.pixelStorei(32877,Sn.min.z),br.isDataTexture||br.isData3DTexture?$r.texSubImage3D(co,Ur,fr.x,fr.y,fr.z,cs,lo,Es,Js,_l,Zv.data):br.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),$r.compressedTexSubImage3D(co,Ur,fr.x,fr.y,fr.z,cs,lo,Es,Js,Zv.data)):$r.texSubImage3D(co,Ur,fr.x,fr.y,fr.z,cs,lo,Es,Js,_l,Zv),$r.pixelStorei(3314,Hs),$r.pixelStorei(32878,Jl),$r.pixelStorei(3316,Vx),$r.pixelStorei(3315,km),$r.pixelStorei(32877,QE),Ur===0&&yr.generateMipmaps&&$r.generateMipmap(co),tr.unbindTexture()},this.initTexture=function(Sn){Sn.isCubeTexture?Gn.setTextureCube(Sn,0):Sn.isData3DTexture?Gn.setTexture3D(Sn,0):Sn.isDataArrayTexture?Gn.setTexture2DArray(Sn,0):Gn.setTexture2D(Sn,0),tr.unbindTexture()},this.resetState=function(){Ft=0,zt=0,Kt=null,tr.reset(),Po.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class iC extends Il{}iC.prototype.isWebGL1Renderer=!0;class B_{constructor(o,g=25e-5){this.isFogExp2=!0,this.name="",this.color=new ts(o),this.density=g}clone(){return new B_(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class jy{constructor(o,g=1,$=1e3){this.isFog=!0,this.name="",this.color=new ts(o),this.near=g,this.far=$}clone(){return new jy(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class yT extends Fs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(o,g){return super.copy(o,g),o.background!==null&&(this.background=o.background.clone()),o.environment!==null&&(this.environment=o.environment.clone()),o.fog!==null&&(this.fog=o.fog.clone()),o.overrideMaterial!==null&&(this.overrideMaterial=o.overrideMaterial.clone()),this.matrixAutoUpdate=o.matrixAutoUpdate,this}toJSON(o){const g=super.toJSON(o);return this.fog!==null&&(g.object.fog=this.fog.toJSON()),g}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(o){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=o}}class q1{constructor(o,g){this.isInterleavedBuffer=!0,this.array=o,this.stride=g,this.count=o!==void 0?o.length/g:0,this.usage=v0,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=wu()}onUploadCallback(){}set needsUpdate(o){o===!0&&this.version++}setUsage(o){return this.usage=o,this}copy(o){return this.array=new o.array.constructor(o.array),this.count=o.count,this.stride=o.stride,this.usage=o.usage,this}copyAt(o,g,$){o*=this.stride,$*=g.stride;for(let _e=0,rt=this.stride;_e<rt;_e++)this.array[o+_e]=g.array[$+_e];return this}set(o,g=0){return this.array.set(o,g),this}clone(o){o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wu()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const g=new this.array.constructor(o.arrayBuffers[this.array.buffer._uuid]),$=new this.constructor(g,this.stride);return $.setUsage(this.usage),$}onUpload(o){return this.onUploadCallback=o,this}toJSON(o){return o.arrayBuffers===void 0&&(o.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=wu()),o.arrayBuffers[this.array.buffer._uuid]===void 0&&(o.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _h=new dn;class Qv{constructor(o,g,$,_e=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=o,this.itemSize=g,this.offset=$,this.normalized=_e===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(o){this.data.needsUpdate=o}applyMatrix4(o){for(let g=0,$=this.data.count;g<$;g++)_h.fromBufferAttribute(this,g),_h.applyMatrix4(o),this.setXYZ(g,_h.x,_h.y,_h.z);return this}applyNormalMatrix(o){for(let g=0,$=this.count;g<$;g++)_h.fromBufferAttribute(this,g),_h.applyNormalMatrix(o),this.setXYZ(g,_h.x,_h.y,_h.z);return this}transformDirection(o){for(let g=0,$=this.count;g<$;g++)_h.fromBufferAttribute(this,g),_h.transformDirection(o),this.setXYZ(g,_h.x,_h.y,_h.z);return this}setX(o,g){return this.normalized&&(g=Io(g,this.array)),this.data.array[o*this.data.stride+this.offset]=g,this}setY(o,g){return this.normalized&&(g=Io(g,this.array)),this.data.array[o*this.data.stride+this.offset+1]=g,this}setZ(o,g){return this.normalized&&(g=Io(g,this.array)),this.data.array[o*this.data.stride+this.offset+2]=g,this}setW(o,g){return this.normalized&&(g=Io(g,this.array)),this.data.array[o*this.data.stride+this.offset+3]=g,this}getX(o){let g=this.data.array[o*this.data.stride+this.offset];return this.normalized&&(g=Km(g,this.array)),g}getY(o){let g=this.data.array[o*this.data.stride+this.offset+1];return this.normalized&&(g=Km(g,this.array)),g}getZ(o){let g=this.data.array[o*this.data.stride+this.offset+2];return this.normalized&&(g=Km(g,this.array)),g}getW(o){let g=this.data.array[o*this.data.stride+this.offset+3];return this.normalized&&(g=Km(g,this.array)),g}setXY(o,g,$){return o=o*this.data.stride+this.offset,this.normalized&&(g=Io(g,this.array),$=Io($,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this}setXYZ(o,g,$,_e){return o=o*this.data.stride+this.offset,this.normalized&&(g=Io(g,this.array),$=Io($,this.array),_e=Io(_e,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this.data.array[o+2]=_e,this}setXYZW(o,g,$,_e,rt){return o=o*this.data.stride+this.offset,this.normalized&&(g=Io(g,this.array),$=Io($,this.array),_e=Io(_e,this.array),rt=Io(rt,this.array)),this.data.array[o+0]=g,this.data.array[o+1]=$,this.data.array[o+2]=_e,this.data.array[o+3]=rt,this}clone(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let rt=0;rt<this.itemSize;rt++)g.push(this.data.array[_e+rt])}return new Co(new this.array.constructor(g),this.itemSize,this.normalized)}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.clone(o)),new Qv(o.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(o){if(o===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const g=[];for(let $=0;$<this.count;$++){const _e=$*this.data.stride+this.offset;for(let rt=0;rt<this.itemSize;rt++)g.push(this.data.array[_e+rt])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:g,normalized:this.normalized}}return o.interleavedBuffers===void 0&&(o.interleavedBuffers={}),o.interleavedBuffers[this.data.uuid]===void 0&&(o.interleavedBuffers[this.data.uuid]=this.data.toJSON(o)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Y1 extends lu{constructor(o){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ts(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.rotation=o.rotation,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}let k_;const k0=new dn,BA=new dn,Gv=new dn,L0=new Cr,kA=new Cr,wT=new Is,L_=new dn,O_=new dn,Zw=new dn,X1=new Cr,K1=new Cr,xT=new Cr;class J1 extends Fs{constructor(o){if(super(),this.isSprite=!0,this.type="Sprite",k_===void 0){k_=new ls;const g=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),$=new q1(g,5);k_.setIndex([0,1,2,0,2,3]),k_.setAttribute("position",new Qv($,3,0,!1)),k_.setAttribute("uv",new Qv($,2,3,!1))}this.geometry=k_,this.material=o!==void 0?o:new Y1,this.center=new Cr(.5,.5)}raycast(o,g){o.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),BA.setFromMatrixScale(this.matrixWorld),wT.copy(o.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(o.camera.matrixWorldInverse,this.matrixWorld),Gv.setFromMatrixPosition(this.modelViewMatrix),o.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&BA.multiplyScalar(-Gv.z);const $=this.material.rotation;let _e,rt;$!==0&&(rt=Math.cos($),_e=Math.sin($));const at=this.center;O0(L_.set(-.5,-.5,0),Gv,at,BA,_e,rt),O0(O_.set(.5,-.5,0),Gv,at,BA,_e,rt),O0(Zw.set(.5,.5,0),Gv,at,BA,_e,rt),X1.set(0,0),K1.set(1,0),xT.set(1,1);let ct=o.ray.intersectTriangle(L_,O_,Zw,!1,k0);if(ct===null&&(O0(O_.set(-.5,.5,0),Gv,at,BA,_e,rt),K1.set(0,1),ct=o.ray.intersectTriangle(L_,Zw,O_,!1,k0),ct===null))return;const ft=o.ray.origin.distanceTo(k0);ft<o.near||ft>o.far||g.push({distance:ft,point:k0.clone(),uv:au.getUV(k0,L_,O_,Zw,X1,K1,xT,new Cr),face:null,object:this})}copy(o,g){return super.copy(o,g),o.center!==void 0&&this.center.copy(o.center),this.material=o.material,this}}function O0(ut,o,g,$,_e,rt){L0.subVectors(ut,g).addScalar(.5).multiply($),_e!==void 0?(kA.x=rt*L0.x-_e*L0.y,kA.y=_e*L0.x+rt*L0.y):kA.copy(L0),ut.copy(o),ut.x+=kA.x,ut.y+=kA.y,ut.applyMatrix4(wT)}const zy=new dn,bT=new dn;class Vy extends Fs{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(o){super.copy(o,!1);const g=o.levels;for(let $=0,_e=g.length;$<_e;$++){const rt=g[$];this.addLevel(rt.object.clone(),rt.distance)}return this.autoUpdate=o.autoUpdate,this}addLevel(o,g=0){g=Math.abs(g);const $=this.levels;let _e;for(_e=0;_e<$.length&&!(g<$[_e].distance);_e++);return $.splice(_e,0,{distance:g,object:o}),this.add(o),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(o){const g=this.levels;if(g.length>0){let $,_e;for($=1,_e=g.length;$<_e&&!(o<g[$].distance);$++);return g[$-1].object}return null}raycast(o,g){if(this.levels.length>0){zy.setFromMatrixPosition(this.matrixWorld);const $=o.ray.origin.distanceTo(zy);this.getObjectForDistance($).raycast(o,g)}}update(o){const g=this.levels;if(g.length>1){zy.setFromMatrixPosition(o.matrixWorld),bT.setFromMatrixPosition(this.matrixWorld);const $=zy.distanceTo(bT)/o.zoom;let _e,rt;for(g[0].object.visible=!0,_e=1,rt=g.length;_e<rt&&$>=g[_e].distance;_e++)g[_e-1].object.visible=!1,g[_e].object.visible=!0;for(this._currentLevel=_e-1;_e<rt;_e++)g[_e].object.visible=!1}}toJSON(o){const g=super.toJSON(o);this.autoUpdate===!1&&(g.object.autoUpdate=!1),g.object.levels=[];const $=this.levels;for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e];g.object.levels.push({object:at.object.uuid,distance:at.distance})}return g}}const LA=new dn,ET=new fo,ST=new fo,CT=new dn,Z1=new Is;class rC extends cu{constructor(o,g){super(o,g),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Is,this.bindMatrixInverse=new Is}copy(o,g){return super.copy(o,g),this.bindMode=o.bindMode,this.bindMatrix.copy(o.bindMatrix),this.bindMatrixInverse.copy(o.bindMatrixInverse),this.skeleton=o.skeleton,this}bind(o,g){this.skeleton=o,g===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),g=this.matrixWorld),this.bindMatrix.copy(g),this.bindMatrixInverse.copy(g).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const o=new fo,g=this.geometry.attributes.skinWeight;for(let $=0,_e=g.count;$<_e;$++){o.fromBufferAttribute(g,$);const rt=1/o.manhattanLength();rt!==1/0?o.multiplyScalar(rt):o.set(1,0,0,0),g.setXYZW($,o.x,o.y,o.z,o.w)}}updateMatrixWorld(o){super.updateMatrixWorld(o),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(o,g){const $=this.skeleton,_e=this.geometry;ET.fromBufferAttribute(_e.attributes.skinIndex,o),ST.fromBufferAttribute(_e.attributes.skinWeight,o),LA.copy(g).applyMatrix4(this.bindMatrix),g.set(0,0,0);for(let rt=0;rt<4;rt++){const at=ST.getComponent(rt);if(at!==0){const ct=ET.getComponent(rt);Z1.multiplyMatrices($.bones[ct].matrixWorld,$.boneInverses[ct]),g.addScaledVector(CT.copy(LA).applyMatrix4(Z1),at)}}return g.applyMatrix4(this.bindMatrixInverse)}}class sC extends Fs{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Qy extends zl{constructor(o=null,g=1,$=1,_e,rt,at,ct,ft,mt=Yo,bt=Yo,Mt,St){super(null,at,ct,ft,mt,bt,_e,rt,Mt,St),this.isDataTexture=!0,this.image={data:o,width:g,height:$},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const oC=new Is,MT=new Is;class $w{constructor(o=[],g=[]){this.uuid=wu(),this.bones=o.slice(0),this.boneInverses=g,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const o=this.bones,g=this.boneInverses;if(this.boneMatrices=new Float32Array(16*o.length),g.length===0)this.calculateInverses();else if(o.length!==g.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let $=0,_e=this.bones.length;$<_e;$++)this.boneInverses.push(new Is)}}calculateInverses(){this.boneInverses.length=0;for(let o=0,g=this.bones.length;o<g;o++){const $=new Is;this.bones[o]&&$.copy(this.bones[o].matrixWorld).invert(),this.boneInverses.push($)}}pose(){for(let o=0,g=this.bones.length;o<g;o++){const $=this.bones[o];$&&$.matrixWorld.copy(this.boneInverses[o]).invert()}for(let o=0,g=this.bones.length;o<g;o++){const $=this.bones[o];$&&($.parent&&$.parent.isBone?($.matrix.copy($.parent.matrixWorld).invert(),$.matrix.multiply($.matrixWorld)):$.matrix.copy($.matrixWorld),$.matrix.decompose($.position,$.quaternion,$.scale))}}update(){const o=this.bones,g=this.boneInverses,$=this.boneMatrices,_e=this.boneTexture;for(let rt=0,at=o.length;rt<at;rt++){const ct=o[rt]?o[rt].matrixWorld:MT;oC.multiplyMatrices(ct,g[rt]),oC.toArray($,16*rt)}_e!==null&&(_e.needsUpdate=!0)}clone(){return new $w(this.bones,this.boneInverses)}computeBoneTexture(){let o=Math.sqrt(4*this.bones.length);o=Bv(o),o=Math.max(o,4);const g=new Float32Array(o*o*4);g.set(this.boneMatrices);const $=new Qy(g,o,o,Yu,Hl);return $.needsUpdate=!0,this.boneMatrices=g,this.boneTexture=$,this.boneTextureSize=o,this}getBoneByName(o){for(let g=0,$=this.bones.length;g<$;g++){const _e=this.bones[g];if(_e.name===o)return _e}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(o,g){this.uuid=o.uuid;for(let $=0,_e=o.bones.length;$<_e;$++){const rt=o.bones[$];let at=g[rt];at===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",rt),at=new sC),this.bones.push(at),this.boneInverses.push(new Is().fromArray(o.boneInverses[$]))}return this.init(),this}toJSON(){const o={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};o.uuid=this.uuid;const g=this.bones,$=this.boneInverses;for(let _e=0,rt=g.length;_e<rt;_e++){const at=g[_e];o.bones.push(at.uuid);const ct=$[_e];o.boneInverses.push(ct.toArray())}return o}}class OA extends Co{constructor(o,g,$,_e=1){super(o,g,$),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=_e}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}toJSON(){const o=super.toJSON();return o.meshPerAttribute=this.meshPerAttribute,o.isInstancedBufferAttribute=!0,o}}const aC=new Is,TT=new Is,ex=[],tx=new cu;class $1 extends cu{constructor(o,g,$){super(o,g),this.isInstancedMesh=!0,this.instanceMatrix=new OA(new Float32Array(16*$),16),this.instanceColor=null,this.count=$,this.frustumCulled=!1}copy(o,g){return super.copy(o,g),this.instanceMatrix.copy(o.instanceMatrix),o.instanceColor!==null&&(this.instanceColor=o.instanceColor.clone()),this.count=o.count,this}getColorAt(o,g){g.fromArray(this.instanceColor.array,3*o)}getMatrixAt(o,g){g.fromArray(this.instanceMatrix.array,16*o)}raycast(o,g){const $=this.matrixWorld,_e=this.count;if(tx.geometry=this.geometry,tx.material=this.material,tx.material!==void 0)for(let rt=0;rt<_e;rt++){this.getMatrixAt(rt,aC),TT.multiplyMatrices($,aC),tx.matrixWorld=TT,tx.raycast(o,ex);for(let at=0,ct=ex.length;at<ct;at++){const ft=ex[at];ft.instanceId=rt,ft.object=this,g.push(ft)}ex.length=0}}setColorAt(o,g){this.instanceColor===null&&(this.instanceColor=new OA(new Float32Array(3*this.instanceMatrix.count),3)),g.toArray(this.instanceColor.array,3*o)}setMatrixAt(o,g){g.toArray(this.instanceMatrix.array,16*o)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class cp extends lu{constructor(o){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ts(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.linewidth=o.linewidth,this.linecap=o.linecap,this.linejoin=o.linejoin,this.fog=o.fog,this}}const eE=new dn,lC=new dn,cC=new Is,uC=new Nv,nx=new Dp;class Hv extends Fs{constructor(o=new ls,g=new cp){super(),this.isLine=!0,this.type="Line",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,$=[0];for(let _e=1,rt=g.count;_e<rt;_e++)eE.fromBufferAttribute(g,_e-1),lC.fromBufferAttribute(g,_e),$[_e]=$[_e-1],$[_e]+=eE.distanceTo(lC);o.setAttribute("lineDistance",new ht($,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(o,g){const $=this.geometry,_e=this.matrixWorld,rt=o.params.Line.threshold,at=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),nx.copy($.boundingSphere),nx.applyMatrix4(_e),nx.radius+=rt,o.ray.intersectsSphere(nx)===!1)return;cC.copy(_e).invert(),uC.copy(o.ray).applyMatrix4(cC);const ct=rt/((this.scale.x+this.scale.y+this.scale.z)/3),ft=ct*ct,mt=new dn,bt=new dn,Mt=new dn,St=new dn,It=this.isLineSegments?2:1,Bt=$.index,Dt=$.attributes.position;if(Bt!==null)for(let Ut=Math.max(0,at.start),Ft=Math.min(Bt.count,at.start+at.count)-1;Ut<Ft;Ut+=It){const zt=Bt.getX(Ut),Kt=Bt.getX(Ut+1);if(mt.fromBufferAttribute(Dt,zt),bt.fromBufferAttribute(Dt,Kt),uC.distanceSqToSegment(mt,bt,St,Mt)>ft)continue;St.applyMatrix4(this.matrixWorld);const tn=o.ray.origin.distanceTo(St);tn<o.near||tn>o.far||g.push({distance:tn,point:Mt.clone().applyMatrix4(this.matrixWorld),index:Ut,face:null,faceIndex:null,object:this})}else for(let Ut=Math.max(0,at.start),Ft=Math.min(Dt.count,at.start+at.count)-1;Ut<Ft;Ut+=It){if(mt.fromBufferAttribute(Dt,Ut),bt.fromBufferAttribute(Dt,Ut+1),uC.distanceSqToSegment(mt,bt,St,Mt)>ft)continue;St.applyMatrix4(this.matrixWorld);const zt=o.ray.origin.distanceTo(St);zt<o.near||zt>o.far||g.push({distance:zt,point:Mt.clone().applyMatrix4(this.matrixWorld),index:Ut,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}}const IT=new dn,tE=new dn;class Wv extends Hv{constructor(o,g){super(o,g),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const o=this.geometry;if(o.index===null){const g=o.attributes.position,$=[];for(let _e=0,rt=g.count;_e<rt;_e+=2)IT.fromBufferAttribute(g,_e),tE.fromBufferAttribute(g,_e+1),$[_e]=_e===0?0:$[_e-1],$[_e+1]=$[_e]+IT.distanceTo(tE);o.setAttribute("lineDistance",new ht($,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Gy extends Hv{constructor(o,g){super(o,g),this.isLineLoop=!0,this.type="LineLoop"}}class nE extends lu{constructor(o){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ts(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.alphaMap=o.alphaMap,this.size=o.size,this.sizeAttenuation=o.sizeAttenuation,this.fog=o.fog,this}}const hC=new Is,iE=new Nv,rE=new Dp,ix=new dn;class sE extends Fs{constructor(o=new ls,g=new nE){super(),this.isPoints=!0,this.type="Points",this.geometry=o,this.material=g,this.updateMorphTargets()}copy(o,g){return super.copy(o,g),this.material=o.material,this.geometry=o.geometry,this}raycast(o,g){const $=this.geometry,_e=this.matrixWorld,rt=o.params.Points.threshold,at=$.drawRange;if($.boundingSphere===null&&$.computeBoundingSphere(),rE.copy($.boundingSphere),rE.applyMatrix4(_e),rE.radius+=rt,o.ray.intersectsSphere(rE)===!1)return;hC.copy(_e).invert(),iE.copy(o.ray).applyMatrix4(hC);const ct=rt/((this.scale.x+this.scale.y+this.scale.z)/3),ft=ct*ct,mt=$.index,bt=$.attributes.position;if(mt!==null)for(let Mt=Math.max(0,at.start),St=Math.min(mt.count,at.start+at.count);Mt<St;Mt++){const It=mt.getX(Mt);ix.fromBufferAttribute(bt,It),Hy(ix,It,ft,_e,o,g,this)}else for(let Mt=Math.max(0,at.start),St=Math.min(bt.count,at.start+at.count);Mt<St;Mt++)ix.fromBufferAttribute(bt,Mt),Hy(ix,Mt,ft,_e,o,g,this)}updateMorphTargets(){const o=this.geometry.morphAttributes,g=Object.keys(o);if(g.length>0){const $=o[g[0]];if($!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let _e=0,rt=$.length;_e<rt;_e++){const at=$[_e].name||String(_e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[at]=_e}}}}}function Hy(ut,o,g,$,_e,rt,at){const ct=iE.distanceSqToPoint(ut);if(ct<g){const ft=new dn;iE.closestPointToPoint(ut,ft),ft.applyMatrix4($);const mt=_e.ray.origin.distanceTo(ft);if(mt<_e.near||mt>_e.far)return;rt.push({distance:mt,distanceToRay:Math.sqrt(ct),point:ft,index:o,face:null,object:at})}}class dC extends zl{constructor(o,g,$,_e,rt,at,ct,ft,mt){super(o,g,$,_e,rt,at,ct,ft,mt),this.isVideoTexture=!0,this.minFilter=at!==void 0?at:Ko,this.magFilter=rt!==void 0?rt:Ko,this.generateMipmaps=!1;const bt=this;"requestVideoFrameCallback"in o&&o.requestVideoFrameCallback(function Mt(){bt.needsUpdate=!0,o.requestVideoFrameCallback(Mt)})}clone(){return new this.constructor(this.image).copy(this)}update(){const o=this.image;!("requestVideoFrameCallback"in o)&&o.readyState>=o.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class rx extends zl{constructor(o,g,$){super({width:o,height:g}),this.isFramebufferTexture=!0,this.format=$,this.magFilter=Yo,this.minFilter=Yo,this.generateMipmaps=!1,this.needsUpdate=!0}}class sx extends zl{constructor(o,g,$,_e,rt,at,ct,ft,mt,bt,Mt,St){super(null,at,ct,ft,mt,bt,_e,rt,Mt,St),this.isCompressedTexture=!0,this.image={width:g,height:$},this.mipmaps=o,this.flipY=!1,this.generateMipmaps=!1}}class pC extends zl{constructor(o,g,$,_e,rt,at,ct,ft,mt){super(o,g,$,_e,rt,at,ct,ft,mt),this.isCanvasTexture=!0,this.needsUpdate=!0}}class lv{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(o,g){const $=this.getUtoTmapping(o);return this.getPoint($,g)}getPoints(o=5){const g=[];for(let $=0;$<=o;$++)g.push(this.getPoint($/o));return g}getSpacedPoints(o=5){const g=[];for(let $=0;$<=o;$++)g.push(this.getPointAt($/o));return g}getLength(){const o=this.getLengths();return o[o.length-1]}getLengths(o=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===o+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const g=[];let $,_e=this.getPoint(0),rt=0;g.push(0);for(let at=1;at<=o;at++)$=this.getPoint(at/o),rt+=$.distanceTo(_e),g.push(rt),_e=$;return this.cacheArcLengths=g,g}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(o,g){const $=this.getLengths();let _e=0;const rt=$.length;let at;at=g||o*$[rt-1];let ct,ft=0,mt=rt-1;for(;ft<=mt;)if(_e=Math.floor(ft+(mt-ft)/2),ct=$[_e]-at,ct<0)ft=_e+1;else{if(!(ct>0)){mt=_e;break}mt=_e-1}if(_e=mt,$[_e]===at)return _e/(rt-1);const bt=$[_e];return(_e+(at-bt)/($[_e+1]-bt))/(rt-1)}getTangent(o,g){let _e=o-1e-4,rt=o+1e-4;_e<0&&(_e=0),rt>1&&(rt=1);const at=this.getPoint(_e),ct=this.getPoint(rt),ft=g||(at.isVector2?new Cr:new dn);return ft.copy(ct).sub(at).normalize(),ft}getTangentAt(o,g){const $=this.getUtoTmapping(o);return this.getTangent($,g)}computeFrenetFrames(o,g){const $=new dn,_e=[],rt=[],at=[],ct=new dn,ft=new Is;for(let It=0;It<=o;It++){const Bt=It/o;_e[It]=this.getTangentAt(Bt,new dn)}rt[0]=new dn,at[0]=new dn;let mt=Number.MAX_VALUE;const bt=Math.abs(_e[0].x),Mt=Math.abs(_e[0].y),St=Math.abs(_e[0].z);bt<=mt&&(mt=bt,$.set(1,0,0)),Mt<=mt&&(mt=Mt,$.set(0,1,0)),St<=mt&&$.set(0,0,1),ct.crossVectors(_e[0],$).normalize(),rt[0].crossVectors(_e[0],ct),at[0].crossVectors(_e[0],rt[0]);for(let It=1;It<=o;It++){if(rt[It]=rt[It-1].clone(),at[It]=at[It-1].clone(),ct.crossVectors(_e[It-1],_e[It]),ct.length()>Number.EPSILON){ct.normalize();const Bt=Math.acos(ys(_e[It-1].dot(_e[It]),-1,1));rt[It].applyMatrix4(ft.makeRotationAxis(ct,Bt))}at[It].crossVectors(_e[It],rt[It])}if(g===!0){let It=Math.acos(ys(rt[0].dot(rt[o]),-1,1));It/=o,_e[0].dot(ct.crossVectors(rt[0],rt[o]))>0&&(It=-It);for(let Bt=1;Bt<=o;Bt++)rt[Bt].applyMatrix4(ft.makeRotationAxis(_e[Bt],It*Bt)),at[Bt].crossVectors(_e[Bt],rt[Bt])}return{tangents:_e,normals:rt,binormals:at}}clone(){return new this.constructor().copy(this)}copy(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}toJSON(){const o={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return o.arcLengthDivisions=this.arcLengthDivisions,o.type=this.type,o}fromJSON(o){return this.arcLengthDivisions=o.arcLengthDivisions,this}}class oE extends lv{constructor(o=0,g=0,$=1,_e=1,rt=0,at=2*Math.PI,ct=!1,ft=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=o,this.aY=g,this.xRadius=$,this.yRadius=_e,this.aStartAngle=rt,this.aEndAngle=at,this.aClockwise=ct,this.aRotation=ft}getPoint(o,g){const $=g||new Cr,_e=2*Math.PI;let rt=this.aEndAngle-this.aStartAngle;const at=Math.abs(rt)<Number.EPSILON;for(;rt<0;)rt+=_e;for(;rt>_e;)rt-=_e;rt<Number.EPSILON&&(rt=at?0:_e),this.aClockwise!==!0||at||(rt===_e?rt=-_e:rt-=_e);const ct=this.aStartAngle+o*rt;let ft=this.aX+this.xRadius*Math.cos(ct),mt=this.aY+this.yRadius*Math.sin(ct);if(this.aRotation!==0){const bt=Math.cos(this.aRotation),Mt=Math.sin(this.aRotation),St=ft-this.aX,It=mt-this.aY;ft=St*bt-It*Mt+this.aX,mt=St*Mt+It*bt+this.aY}return $.set(ft,mt)}copy(o){return super.copy(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}toJSON(){const o=super.toJSON();return o.aX=this.aX,o.aY=this.aY,o.xRadius=this.xRadius,o.yRadius=this.yRadius,o.aStartAngle=this.aStartAngle,o.aEndAngle=this.aEndAngle,o.aClockwise=this.aClockwise,o.aRotation=this.aRotation,o}fromJSON(o){return super.fromJSON(o),this.aX=o.aX,this.aY=o.aY,this.xRadius=o.xRadius,this.yRadius=o.yRadius,this.aStartAngle=o.aStartAngle,this.aEndAngle=o.aEndAngle,this.aClockwise=o.aClockwise,this.aRotation=o.aRotation,this}}class DT extends oE{constructor(o,g,$,_e,rt,at){super(o,g,$,$,_e,rt,at),this.isArcCurve=!0,this.type="ArcCurve"}}function aE(){let ut=0,o=0,g=0,$=0;function _e(rt,at,ct,ft){ut=rt,o=ct,g=-3*rt+3*at-2*ct-ft,$=2*rt-2*at+ct+ft}return{initCatmullRom:function(rt,at,ct,ft,mt){_e(at,ct,mt*(ct-rt),mt*(ft-at))},initNonuniformCatmullRom:function(rt,at,ct,ft,mt,bt,Mt){let St=(at-rt)/mt-(ct-rt)/(mt+bt)+(ct-at)/bt,It=(ct-at)/bt-(ft-at)/(bt+Mt)+(ft-ct)/Mt;St*=bt,It*=bt,_e(at,ct,St,It)},calc:function(rt){const at=rt*rt;return ut+o*rt+g*at+$*(at*rt)}}}const lE=new dn,cE=new aE,fC=new aE,uE=new aE;class PT extends lv{constructor(o=[],g=!1,$="centripetal",_e=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=o,this.closed=g,this.curveType=$,this.tension=_e}getPoint(o,g=new dn){const $=g,_e=this.points,rt=_e.length,at=(rt-(this.closed?0:1))*o;let ct,ft,mt=Math.floor(at),bt=at-mt;this.closed?mt+=mt>0?0:(Math.floor(Math.abs(mt)/rt)+1)*rt:bt===0&&mt===rt-1&&(mt=rt-2,bt=1),this.closed||mt>0?ct=_e[(mt-1)%rt]:(lE.subVectors(_e[0],_e[1]).add(_e[0]),ct=lE);const Mt=_e[mt%rt],St=_e[(mt+1)%rt];if(this.closed||mt+2<rt?ft=_e[(mt+2)%rt]:(lE.subVectors(_e[rt-1],_e[rt-2]).add(_e[rt-1]),ft=lE),this.curveType==="centripetal"||this.curveType==="chordal"){const It=this.curveType==="chordal"?.5:.25;let Bt=Math.pow(ct.distanceToSquared(Mt),It),Dt=Math.pow(Mt.distanceToSquared(St),It),Ut=Math.pow(St.distanceToSquared(ft),It);Dt<1e-4&&(Dt=1),Bt<1e-4&&(Bt=Dt),Ut<1e-4&&(Ut=Dt),cE.initNonuniformCatmullRom(ct.x,Mt.x,St.x,ft.x,Bt,Dt,Ut),fC.initNonuniformCatmullRom(ct.y,Mt.y,St.y,ft.y,Bt,Dt,Ut),uE.initNonuniformCatmullRom(ct.z,Mt.z,St.z,ft.z,Bt,Dt,Ut)}else this.curveType==="catmullrom"&&(cE.initCatmullRom(ct.x,Mt.x,St.x,ft.x,this.tension),fC.initCatmullRom(ct.y,Mt.y,St.y,ft.y,this.tension),uE.initCatmullRom(ct.z,Mt.z,St.z,ft.z,this.tension));return $.set(cE.calc(bt),fC.calc(bt),uE.calc(bt)),$}copy(o){super.copy(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(_e.clone())}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,$=this.points.length;g<$;g++){const _e=this.points[g];o.points.push(_e.toArray())}return o.closed=this.closed,o.curveType=this.curveType,o.tension=this.tension,o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(new dn().fromArray(_e))}return this.closed=o.closed,this.curveType=o.curveType,this.tension=o.tension,this}}function Wy(ut,o,g,$,_e){const rt=.5*($-o),at=.5*(_e-g),ct=ut*ut;return(2*g-2*$+rt+at)*(ut*ct)+(-3*g+3*$-2*rt-at)*ct+rt*ut+g}function NA(ut,o,g,$){return function(_e,rt){const at=1-_e;return at*at*rt}(ut,o)+function(_e,rt){return 2*(1-_e)*_e*rt}(ut,g)+function(_e,rt){return _e*_e*rt}(ut,$)}function Dl(ut,o,g,$,_e){return function(rt,at){const ct=1-rt;return ct*ct*ct*at}(ut,o)+function(rt,at){const ct=1-rt;return 3*ct*ct*rt*at}(ut,g)+function(rt,at){return 3*(1-rt)*rt*rt*at}(ut,$)+function(rt,at){return rt*rt*rt*at}(ut,_e)}class ox extends lv{constructor(o=new Cr,g=new Cr,$=new Cr,_e=new Cr){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=o,this.v1=g,this.v2=$,this.v3=_e}getPoint(o,g=new Cr){const $=g,_e=this.v0,rt=this.v1,at=this.v2,ct=this.v3;return $.set(Dl(o,_e.x,rt.x,at.x,ct.x),Dl(o,_e.y,rt.y,at.y,ct.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class mC extends lv{constructor(o=new dn,g=new dn,$=new dn,_e=new dn){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=o,this.v1=g,this.v2=$,this.v3=_e}getPoint(o,g=new dn){const $=g,_e=this.v0,rt=this.v1,at=this.v2,ct=this.v3;return $.set(Dl(o,_e.x,rt.x,at.x,ct.x),Dl(o,_e.y,rt.y,at.y,ct.y),Dl(o,_e.z,rt.z,at.z,ct.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this.v3.copy(o.v3),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o.v3=this.v3.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this.v3.fromArray(o.v3),this}}class ax extends lv{constructor(o=new Cr,g=new Cr){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=o,this.v2=g}getPoint(o,g=new Cr){const $=g;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,g){return this.getPoint(o,g)}getTangent(o,g){const $=g||new Cr;return $.copy(this.v2).sub(this.v1).normalize(),$}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class gC extends lv{constructor(o=new dn,g=new dn){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=o,this.v2=g}getPoint(o,g=new dn){const $=g;return o===1?$.copy(this.v2):($.copy(this.v2).sub(this.v1),$.multiplyScalar(o).add(this.v1)),$}getPointAt(o,g){return this.getPoint(o,g)}copy(o){return super.copy(o),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class N0 extends lv{constructor(o=new Cr,g=new Cr,$=new Cr){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=o,this.v1=g,this.v2=$}getPoint(o,g=new Cr){const $=g,_e=this.v0,rt=this.v1,at=this.v2;return $.set(NA(o,_e.x,rt.x,at.x),NA(o,_e.y,rt.y,at.y)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class hE extends lv{constructor(o=new dn,g=new dn,$=new dn){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=o,this.v1=g,this.v2=$}getPoint(o,g=new dn){const $=g,_e=this.v0,rt=this.v1,at=this.v2;return $.set(NA(o,_e.x,rt.x,at.x),NA(o,_e.y,rt.y,at.y),NA(o,_e.z,rt.z,at.z)),$}copy(o){return super.copy(o),this.v0.copy(o.v0),this.v1.copy(o.v1),this.v2.copy(o.v2),this}toJSON(){const o=super.toJSON();return o.v0=this.v0.toArray(),o.v1=this.v1.toArray(),o.v2=this.v2.toArray(),o}fromJSON(o){return super.fromJSON(o),this.v0.fromArray(o.v0),this.v1.fromArray(o.v1),this.v2.fromArray(o.v2),this}}class vC extends lv{constructor(o=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=o}getPoint(o,g=new Cr){const $=g,_e=this.points,rt=(_e.length-1)*o,at=Math.floor(rt),ct=rt-at,ft=_e[at===0?at:at-1],mt=_e[at],bt=_e[at>_e.length-2?_e.length-1:at+1],Mt=_e[at>_e.length-3?_e.length-1:at+2];return $.set(Wy(ct,ft.x,mt.x,bt.x,Mt.x),Wy(ct,ft.y,mt.y,bt.y,Mt.y)),$}copy(o){super.copy(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.points=[];for(let g=0,$=this.points.length;g<$;g++){const _e=this.points[g];o.points.push(_e.toArray())}return o}fromJSON(o){super.fromJSON(o),this.points=[];for(let g=0,$=o.points.length;g<$;g++){const _e=o.points[g];this.points.push(new Cr().fromArray(_e))}return this}}var mo=Object.freeze({__proto__:null,ArcCurve:DT,CatmullRomCurve3:PT,CubicBezierCurve:ox,CubicBezierCurve3:mC,EllipseCurve:oE,LineCurve:ax,LineCurve3:gC,QuadraticBezierCurve:N0,QuadraticBezierCurve3:hE,SplineCurve:vC});class _C extends lv{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(o){this.curves.push(o)}closePath(){const o=this.curves[0].getPoint(0),g=this.curves[this.curves.length-1].getPoint(1);o.equals(g)||this.curves.push(new ax(g,o))}getPoint(o,g){const $=o*this.getLength(),_e=this.getCurveLengths();let rt=0;for(;rt<_e.length;){if(_e[rt]>=$){const at=_e[rt]-$,ct=this.curves[rt],ft=ct.getLength(),mt=ft===0?0:1-at/ft;return ct.getPointAt(mt,g)}rt++}return null}getLength(){const o=this.getCurveLengths();return o[o.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const o=[];let g=0;for(let $=0,_e=this.curves.length;$<_e;$++)g+=this.curves[$].getLength(),o.push(g);return this.cacheLengths=o,o}getSpacedPoints(o=40){const g=[];for(let $=0;$<=o;$++)g.push(this.getPoint($/o));return this.autoClose&&g.push(g[0]),g}getPoints(o=12){const g=[];let $;for(let _e=0,rt=this.curves;_e<rt.length;_e++){const at=rt[_e],ct=at.isEllipseCurve?2*o:at.isLineCurve||at.isLineCurve3?1:at.isSplineCurve?o*at.points.length:o,ft=at.getPoints(ct);for(let mt=0;mt<ft.length;mt++){const bt=ft[mt];$&&$.equals(bt)||(g.push(bt),$=bt)}}return this.autoClose&&g.length>1&&!g[g.length-1].equals(g[0])&&g.push(g[0]),g}copy(o){super.copy(o),this.curves=[];for(let g=0,$=o.curves.length;g<$;g++){const _e=o.curves[g];this.curves.push(_e.clone())}return this.autoClose=o.autoClose,this}toJSON(){const o=super.toJSON();o.autoClose=this.autoClose,o.curves=[];for(let g=0,$=this.curves.length;g<$;g++){const _e=this.curves[g];o.curves.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.autoClose=o.autoClose,this.curves=[];for(let g=0,$=o.curves.length;g<$;g++){const _e=o.curves[g];this.curves.push(new mo[_e.type]().fromJSON(_e))}return this}}class qy extends _C{constructor(o){super(),this.type="Path",this.currentPoint=new Cr,o&&this.setFromPoints(o)}setFromPoints(o){this.moveTo(o[0].x,o[0].y);for(let g=1,$=o.length;g<$;g++)this.lineTo(o[g].x,o[g].y);return this}moveTo(o,g){return this.currentPoint.set(o,g),this}lineTo(o,g){const $=new ax(this.currentPoint.clone(),new Cr(o,g));return this.curves.push($),this.currentPoint.set(o,g),this}quadraticCurveTo(o,g,$,_e){const rt=new N0(this.currentPoint.clone(),new Cr(o,g),new Cr($,_e));return this.curves.push(rt),this.currentPoint.set($,_e),this}bezierCurveTo(o,g,$,_e,rt,at){const ct=new ox(this.currentPoint.clone(),new Cr(o,g),new Cr($,_e),new Cr(rt,at));return this.curves.push(ct),this.currentPoint.set(rt,at),this}splineThru(o){const g=[this.currentPoint.clone()].concat(o),$=new vC(g);return this.curves.push($),this.currentPoint.copy(o[o.length-1]),this}arc(o,g,$,_e,rt,at){const ct=this.currentPoint.x,ft=this.currentPoint.y;return this.absarc(o+ct,g+ft,$,_e,rt,at),this}absarc(o,g,$,_e,rt,at){return this.absellipse(o,g,$,$,_e,rt,at),this}ellipse(o,g,$,_e,rt,at,ct,ft){const mt=this.currentPoint.x,bt=this.currentPoint.y;return this.absellipse(o+mt,g+bt,$,_e,rt,at,ct,ft),this}absellipse(o,g,$,_e,rt,at,ct,ft){const mt=new oE(o,g,$,_e,rt,at,ct,ft);if(this.curves.length>0){const Mt=mt.getPoint(0);Mt.equals(this.currentPoint)||this.lineTo(Mt.x,Mt.y)}this.curves.push(mt);const bt=mt.getPoint(1);return this.currentPoint.copy(bt),this}copy(o){return super.copy(o),this.currentPoint.copy(o.currentPoint),this}toJSON(){const o=super.toJSON();return o.currentPoint=this.currentPoint.toArray(),o}fromJSON(o){return super.fromJSON(o),this.currentPoint.fromArray(o.currentPoint),this}}class $a extends ls{constructor(o=[new Cr(0,-.5),new Cr(.5,0),new Cr(0,.5)],g=12,$=0,_e=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:o,segments:g,phiStart:$,phiLength:_e},g=Math.floor(g),_e=ys(_e,0,2*Math.PI);const rt=[],at=[],ct=[],ft=[],mt=[],bt=1/g,Mt=new dn,St=new Cr,It=new dn,Bt=new dn,Dt=new dn;let Ut=0,Ft=0;for(let zt=0;zt<=o.length-1;zt++)switch(zt){case 0:Ut=o[zt+1].x-o[zt].x,Ft=o[zt+1].y-o[zt].y,It.x=1*Ft,It.y=-Ut,It.z=0*Ft,Dt.copy(It),It.normalize(),ft.push(It.x,It.y,It.z);break;case o.length-1:ft.push(Dt.x,Dt.y,Dt.z);break;default:Ut=o[zt+1].x-o[zt].x,Ft=o[zt+1].y-o[zt].y,It.x=1*Ft,It.y=-Ut,It.z=0*Ft,Bt.copy(It),It.x+=Dt.x,It.y+=Dt.y,It.z+=Dt.z,It.normalize(),ft.push(It.x,It.y,It.z),Dt.copy(Bt)}for(let zt=0;zt<=g;zt++){const Kt=$+zt*bt*_e,tn=Math.sin(Kt),sn=Math.cos(Kt);for(let ln=0;ln<=o.length-1;ln++){Mt.x=o[ln].x*tn,Mt.y=o[ln].y,Mt.z=o[ln].x*sn,at.push(Mt.x,Mt.y,Mt.z),St.x=zt/g,St.y=ln/(o.length-1),ct.push(St.x,St.y);const kn=ft[3*ln+0]*tn,Ln=ft[3*ln+1],qn=ft[3*ln+0]*sn;mt.push(kn,Ln,qn)}}for(let zt=0;zt<g;zt++)for(let Kt=0;Kt<o.length-1;Kt++){const tn=Kt+zt*o.length,sn=tn,ln=tn+o.length,kn=tn+o.length+1,Ln=tn+1;rt.push(sn,ln,Ln),rt.push(kn,Ln,ln)}this.setIndex(rt),this.setAttribute("position",new ht(at,3)),this.setAttribute("uv",new ht(ct,2)),this.setAttribute("normal",new ht(mt,3))}static fromJSON(o){return new $a(o.points,o.segments,o.phiStart,o.phiLength)}}class lx extends $a{constructor(o=1,g=1,$=4,_e=8){const rt=new qy;rt.absarc(0,-g/2,o,1.5*Math.PI,0),rt.absarc(0,g/2,o,0,.5*Math.PI),super(rt.getPoints($),_e),this.type="CapsuleGeometry",this.parameters={radius:o,height:g,capSegments:$,radialSegments:_e}}static fromJSON(o){return new lx(o.radius,o.length,o.capSegments,o.radialSegments)}}class rm extends ls{constructor(o=1,g=8,$=0,_e=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:o,segments:g,thetaStart:$,thetaLength:_e},g=Math.max(3,g);const rt=[],at=[],ct=[],ft=[],mt=new dn,bt=new Cr;at.push(0,0,0),ct.push(0,0,1),ft.push(.5,.5);for(let Mt=0,St=3;Mt<=g;Mt++,St+=3){const It=$+Mt/g*_e;mt.x=o*Math.cos(It),mt.y=o*Math.sin(It),at.push(mt.x,mt.y,mt.z),ct.push(0,0,1),bt.x=(at[St]/o+1)/2,bt.y=(at[St+1]/o+1)/2,ft.push(bt.x,bt.y)}for(let Mt=1;Mt<=g;Mt++)rt.push(Mt,Mt+1,0);this.setIndex(rt),this.setAttribute("position",new ht(at,3)),this.setAttribute("normal",new ht(ct,3)),this.setAttribute("uv",new ht(ft,2))}static fromJSON(o){return new rm(o.radius,o.segments,o.thetaStart,o.thetaLength)}}class uu extends ls{constructor(o=1,g=1,$=1,_e=8,rt=1,at=!1,ct=0,ft=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:o,radiusBottom:g,height:$,radialSegments:_e,heightSegments:rt,openEnded:at,thetaStart:ct,thetaLength:ft};const mt=this;_e=Math.floor(_e),rt=Math.floor(rt);const bt=[],Mt=[],St=[],It=[];let Bt=0;const Dt=[],Ut=$/2;let Ft=0;function zt(Kt){const tn=Bt,sn=new Cr,ln=new dn;let kn=0;const Ln=Kt===!0?o:g,qn=Kt===!0?1:-1;for(let Un=1;Un<=_e;Un++)Mt.push(0,Ut*qn,0),St.push(0,qn,0),It.push(.5,.5),Bt++;const Kn=Bt;for(let Un=0;Un<=_e;Un++){const vr=Un/_e*ft+ct,Pr=Math.cos(vr),mr=Math.sin(vr);ln.x=Ln*mr,ln.y=Ut*qn,ln.z=Ln*Pr,Mt.push(ln.x,ln.y,ln.z),St.push(0,qn,0),sn.x=.5*Pr+.5,sn.y=.5*mr*qn+.5,It.push(sn.x,sn.y),Bt++}for(let Un=0;Un<_e;Un++){const vr=tn+Un,Pr=Kn+Un;Kt===!0?bt.push(Pr,Pr+1,vr):bt.push(Pr+1,Pr,vr),kn+=3}mt.addGroup(Ft,kn,Kt===!0?1:2),Ft+=kn}(function(){const Kt=new dn,tn=new dn;let sn=0;const ln=(g-o)/$;for(let kn=0;kn<=rt;kn++){const Ln=[],qn=kn/rt,Kn=qn*(g-o)+o;for(let Un=0;Un<=_e;Un++){const vr=Un/_e,Pr=vr*ft+ct,mr=Math.sin(Pr),Qr=Math.cos(Pr);tn.x=Kn*mr,tn.y=-qn*$+Ut,tn.z=Kn*Qr,Mt.push(tn.x,tn.y,tn.z),Kt.set(mr,ln,Qr).normalize(),St.push(Kt.x,Kt.y,Kt.z),It.push(vr,1-qn),Ln.push(Bt++)}Dt.push(Ln)}for(let kn=0;kn<_e;kn++)for(let Ln=0;Ln<rt;Ln++){const qn=Dt[Ln][kn],Kn=Dt[Ln+1][kn],Un=Dt[Ln+1][kn+1],vr=Dt[Ln][kn+1];bt.push(qn,Kn,vr),bt.push(Kn,Un,vr),sn+=6}mt.addGroup(Ft,sn,0),Ft+=sn})(),at===!1&&(o>0&&zt(!0),g>0&&zt(!1)),this.setIndex(bt),this.setAttribute("position",new ht(Mt,3)),this.setAttribute("normal",new ht(St,3)),this.setAttribute("uv",new ht(It,2))}static fromJSON(o){return new uu(o.radiusTop,o.radiusBottom,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class Go extends uu{constructor(o=1,g=1,$=8,_e=1,rt=!1,at=0,ct=2*Math.PI){super(0,o,g,$,_e,rt,at,ct),this.type="ConeGeometry",this.parameters={radius:o,height:g,radialSegments:$,heightSegments:_e,openEnded:rt,thetaStart:at,thetaLength:ct}}static fromJSON(o){return new Go(o.radius,o.height,o.radialSegments,o.heightSegments,o.openEnded,o.thetaStart,o.thetaLength)}}class U0 extends ls{constructor(o=[],g=[],$=1,_e=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:o,indices:g,radius:$,detail:_e};const rt=[],at=[];function ct(St,It,Bt,Dt){const Ut=Dt+1,Ft=[];for(let zt=0;zt<=Ut;zt++){Ft[zt]=[];const Kt=St.clone().lerp(Bt,zt/Ut),tn=It.clone().lerp(Bt,zt/Ut),sn=Ut-zt;for(let ln=0;ln<=sn;ln++)Ft[zt][ln]=ln===0&&zt===Ut?Kt:Kt.clone().lerp(tn,ln/sn)}for(let zt=0;zt<Ut;zt++)for(let Kt=0;Kt<2*(Ut-zt)-1;Kt++){const tn=Math.floor(Kt/2);Kt%2==0?(ft(Ft[zt][tn+1]),ft(Ft[zt+1][tn]),ft(Ft[zt][tn])):(ft(Ft[zt][tn+1]),ft(Ft[zt+1][tn+1]),ft(Ft[zt+1][tn]))}}function ft(St){rt.push(St.x,St.y,St.z)}function mt(St,It){const Bt=3*St;It.x=o[Bt+0],It.y=o[Bt+1],It.z=o[Bt+2]}function bt(St,It,Bt,Dt){Dt<0&&St.x===1&&(at[It]=St.x-1),Bt.x===0&&Bt.z===0&&(at[It]=Dt/2/Math.PI+.5)}function Mt(St){return Math.atan2(St.z,-St.x)}(function(St){const It=new dn,Bt=new dn,Dt=new dn;for(let Ut=0;Ut<g.length;Ut+=3)mt(g[Ut+0],It),mt(g[Ut+1],Bt),mt(g[Ut+2],Dt),ct(It,Bt,Dt,St)})(_e),function(St){const It=new dn;for(let Bt=0;Bt<rt.length;Bt+=3)It.x=rt[Bt+0],It.y=rt[Bt+1],It.z=rt[Bt+2],It.normalize().multiplyScalar(St),rt[Bt+0]=It.x,rt[Bt+1]=It.y,rt[Bt+2]=It.z}($),function(){const St=new dn;for(let Bt=0;Bt<rt.length;Bt+=3){St.x=rt[Bt+0],St.y=rt[Bt+1],St.z=rt[Bt+2];const Dt=Mt(St)/2/Math.PI+.5,Ut=(It=St,Math.atan2(-It.y,Math.sqrt(It.x*It.x+It.z*It.z))/Math.PI+.5);at.push(Dt,1-Ut)}var It;(function(){const Bt=new dn,Dt=new dn,Ut=new dn,Ft=new dn,zt=new Cr,Kt=new Cr,tn=new Cr;for(let sn=0,ln=0;sn<rt.length;sn+=9,ln+=6){Bt.set(rt[sn+0],rt[sn+1],rt[sn+2]),Dt.set(rt[sn+3],rt[sn+4],rt[sn+5]),Ut.set(rt[sn+6],rt[sn+7],rt[sn+8]),zt.set(at[ln+0],at[ln+1]),Kt.set(at[ln+2],at[ln+3]),tn.set(at[ln+4],at[ln+5]),Ft.copy(Bt).add(Dt).add(Ut).divideScalar(3);const kn=Mt(Ft);bt(zt,ln+0,Bt,kn),bt(Kt,ln+2,Dt,kn),bt(tn,ln+4,Ut,kn)}})(),function(){for(let Bt=0;Bt<at.length;Bt+=6){const Dt=at[Bt+0],Ut=at[Bt+2],Ft=at[Bt+4],zt=Math.max(Dt,Ut,Ft),Kt=Math.min(Dt,Ut,Ft);zt>.9&&Kt<.1&&(Dt<.2&&(at[Bt+0]+=1),Ut<.2&&(at[Bt+2]+=1),Ft<.2&&(at[Bt+4]+=1))}}()}(),this.setAttribute("position",new ht(rt,3)),this.setAttribute("normal",new ht(rt.slice(),3)),this.setAttribute("uv",new ht(at,2)),_e===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(o){return new U0(o.vertices,o.indices,o.radius,o.details)}}class cx extends U0{constructor(o=1,g=0){const $=(1+Math.sqrt(5))/2,_e=1/$;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,-_e,-$,0,-_e,$,0,_e,-$,0,_e,$,0,-$,0,-_e,$,0,-_e,-$,0,_e,$,0,_e],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],o,g),this.type="DodecahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new cx(o.radius,o.detail)}}const cv=new dn,Yy=new dn,ux=new dn,Xy=new au;class dE extends ls{constructor(o=null,g=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:o,thresholdAngle:g},o!==null){const _e=Math.pow(10,4),rt=Math.cos(A0*g),at=o.getIndex(),ct=o.getAttribute("position"),ft=at?at.count:ct.count,mt=[0,0,0],bt=["a","b","c"],Mt=new Array(3),St={},It=[];for(let Bt=0;Bt<ft;Bt+=3){at?(mt[0]=at.getX(Bt),mt[1]=at.getX(Bt+1),mt[2]=at.getX(Bt+2)):(mt[0]=Bt,mt[1]=Bt+1,mt[2]=Bt+2);const{a:Dt,b:Ut,c:Ft}=Xy;if(Dt.fromBufferAttribute(ct,mt[0]),Ut.fromBufferAttribute(ct,mt[1]),Ft.fromBufferAttribute(ct,mt[2]),Xy.getNormal(ux),Mt[0]=`${Math.round(Dt.x*_e)},${Math.round(Dt.y*_e)},${Math.round(Dt.z*_e)}`,Mt[1]=`${Math.round(Ut.x*_e)},${Math.round(Ut.y*_e)},${Math.round(Ut.z*_e)}`,Mt[2]=`${Math.round(Ft.x*_e)},${Math.round(Ft.y*_e)},${Math.round(Ft.z*_e)}`,Mt[0]!==Mt[1]&&Mt[1]!==Mt[2]&&Mt[2]!==Mt[0])for(let zt=0;zt<3;zt++){const Kt=(zt+1)%3,tn=Mt[zt],sn=Mt[Kt],ln=Xy[bt[zt]],kn=Xy[bt[Kt]],Ln=`${tn}_${sn}`,qn=`${sn}_${tn}`;qn in St&&St[qn]?(ux.dot(St[qn].normal)<=rt&&(It.push(ln.x,ln.y,ln.z),It.push(kn.x,kn.y,kn.z)),St[qn]=null):Ln in St||(St[Ln]={index0:mt[zt],index1:mt[Kt],normal:ux.clone()})}}for(const Bt in St)if(St[Bt]){const{index0:Dt,index1:Ut}=St[Bt];cv.fromBufferAttribute(ct,Dt),Yy.fromBufferAttribute(ct,Ut),It.push(cv.x,cv.y,cv.z),It.push(Yy.x,Yy.y,Yy.z)}this.setAttribute("position",new ht(It,3))}}}class UA extends qy{constructor(o){super(o),this.uuid=wu(),this.type="Shape",this.holes=[]}getPointsHoles(o){const g=[];for(let $=0,_e=this.holes.length;$<_e;$++)g[$]=this.holes[$].getPoints(o);return g}extractPoints(o){return{shape:this.getPoints(o),holes:this.getPointsHoles(o)}}copy(o){super.copy(o),this.holes=[];for(let g=0,$=o.holes.length;g<$;g++){const _e=o.holes[g];this.holes.push(_e.clone())}return this}toJSON(){const o=super.toJSON();o.uuid=this.uuid,o.holes=[];for(let g=0,$=this.holes.length;g<$;g++){const _e=this.holes[g];o.holes.push(_e.toJSON())}return o}fromJSON(o){super.fromJSON(o),this.uuid=o.uuid,this.holes=[];for(let g=0,$=o.holes.length;g<$;g++){const _e=o.holes[g];this.holes.push(new qy().fromJSON(_e))}return this}}function RT(ut,o,g,$,_e){let rt,at;if(_e===function(ct,ft,mt,bt){let Mt=0;for(let St=ft,It=mt-bt;St<mt;St+=bt)Mt+=(ct[It]-ct[St])*(ct[St+1]+ct[It+1]),It=St;return Mt}(ut,o,g,$)>0)for(rt=o;rt<g;rt+=$)at=Qp(rt,ut[rt],ut[rt+1],at);else for(rt=g-$;rt>=o;rt-=$)at=Qp(rt,ut[rt],ut[rt+1],at);return at&&zp(at,at.next)&&(fx(at),at=at.next),at}function N_(ut,o){if(!ut)return ut;o||(o=ut);let g,$=ut;do if(g=!1,$.steiner||!zp($,$.next)&&ga($.prev,$,$.next)!==0)$=$.next;else{if(fx($),$=o=$.prev,$===$.next)break;g=!0}while(g||$!==o);return o}function hx(ut,o,g,$,_e,rt,at){if(!ut)return;!at&&rt&&function(bt,Mt,St,It){let Bt=bt;do Bt.z===null&&(Bt.z=pE(Bt.x,Bt.y,Mt,St,It)),Bt.prevZ=Bt.prev,Bt.nextZ=Bt.next,Bt=Bt.next;while(Bt!==bt);Bt.prevZ.nextZ=null,Bt.prevZ=null,function(Dt){let Ut,Ft,zt,Kt,tn,sn,ln,kn,Ln=1;do{for(Ft=Dt,Dt=null,tn=null,sn=0;Ft;){for(sn++,zt=Ft,ln=0,Ut=0;Ut<Ln&&(ln++,zt=zt.nextZ,zt);Ut++);for(kn=Ln;ln>0||kn>0&&zt;)ln!==0&&(kn===0||!zt||Ft.z<=zt.z)?(Kt=Ft,Ft=Ft.nextZ,ln--):(Kt=zt,zt=zt.nextZ,kn--),tn?tn.nextZ=Kt:Dt=Kt,Kt.prevZ=tn,tn=Kt;Ft=zt}tn.nextZ=null,Ln*=2}while(sn>1)}(Bt)}(ut,$,_e,rt);let ct,ft,mt=ut;for(;ut.prev!==ut.next;)if(ct=ut.prev,ft=ut.next,rt?dx(ut,$,_e,rt):BT(ut))o.push(ct.i/g),o.push(ut.i/g),o.push(ft.i/g),fx(ut),ut=ft.next,mt=ft.next;else if((ut=ft)===mt){at?at===1?hx(ut=kT(N_(ut),o,g),o,g,$,_e,rt,2):at===2&&AC(ut,o,g,$,_e,rt):hx(N_(ut),o,g,$,_e,rt,1);break}}function BT(ut){const o=ut.prev,g=ut,$=ut.next;if(ga(o,g,$)>=0)return!1;let _e=ut.next.next;for(;_e!==ut.prev;){if(Mm(o.x,o.y,g.x,g.y,$.x,$.y,_e.x,_e.y)&&ga(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function dx(ut,o,g,$){const _e=ut.prev,rt=ut,at=ut.next;if(ga(_e,rt,at)>=0)return!1;const ct=_e.x<rt.x?_e.x<at.x?_e.x:at.x:rt.x<at.x?rt.x:at.x,ft=_e.y<rt.y?_e.y<at.y?_e.y:at.y:rt.y<at.y?rt.y:at.y,mt=_e.x>rt.x?_e.x>at.x?_e.x:at.x:rt.x>at.x?rt.x:at.x,bt=_e.y>rt.y?_e.y>at.y?_e.y:at.y:rt.y>at.y?rt.y:at.y,Mt=pE(ct,ft,o,g,$),St=pE(mt,bt,o,g,$);let It=ut.prevZ,Bt=ut.nextZ;for(;It&&It.z>=Mt&&Bt&&Bt.z<=St;){if(It!==ut.prev&&It!==ut.next&&Mm(_e.x,_e.y,rt.x,rt.y,at.x,at.y,It.x,It.y)&&ga(It.prev,It,It.next)>=0||(It=It.prevZ,Bt!==ut.prev&&Bt!==ut.next&&Mm(_e.x,_e.y,rt.x,rt.y,at.x,at.y,Bt.x,Bt.y)&&ga(Bt.prev,Bt,Bt.next)>=0))return!1;Bt=Bt.nextZ}for(;It&&It.z>=Mt;){if(It!==ut.prev&&It!==ut.next&&Mm(_e.x,_e.y,rt.x,rt.y,at.x,at.y,It.x,It.y)&&ga(It.prev,It,It.next)>=0)return!1;It=It.prevZ}for(;Bt&&Bt.z<=St;){if(Bt!==ut.prev&&Bt!==ut.next&&Mm(_e.x,_e.y,rt.x,rt.y,at.x,at.y,Bt.x,Bt.y)&&ga(Bt.prev,Bt,Bt.next)>=0)return!1;Bt=Bt.nextZ}return!0}function kT(ut,o,g){let $=ut;do{const _e=$.prev,rt=$.next.next;!zp(_e,rt)&&U_(_e,$,$.next,rt)&&F_(_e,rt)&&F_(rt,_e)&&(o.push(_e.i/g),o.push($.i/g),o.push(rt.i/g),fx($),fx($.next),$=ut=rt),$=$.next}while($!==ut);return N_($)}function AC(ut,o,g,$,_e,rt){let at=ut;do{let ct=at.next.next;for(;ct!==at.prev;){if(at.i!==ct.i&&_d(at,ct)){let ft=fE(at,ct);return at=N_(at,at.next),ft=N_(ft,ft.next),hx(at,o,g,$,_e,rt),void hx(ft,o,g,$,_e,rt)}ct=ct.next}at=at.next}while(at!==ut)}function px(ut,o){return ut.x-o.x}function uv(ut,o){if(o=function(g,$){let _e=$;const rt=g.x,at=g.y;let ct,ft=-1/0;do{if(at<=_e.y&&at>=_e.next.y&&_e.next.y!==_e.y){const Bt=_e.x+(at-_e.y)*(_e.next.x-_e.x)/(_e.next.y-_e.y);if(Bt<=rt&&Bt>ft){if(ft=Bt,Bt===rt){if(at===_e.y)return _e;if(at===_e.next.y)return _e.next}ct=_e.x<_e.next.x?_e:_e.next}}_e=_e.next}while(_e!==$);if(!ct)return null;if(rt===ft)return ct;const mt=ct,bt=ct.x,Mt=ct.y;let St,It=1/0;_e=ct;do rt>=_e.x&&_e.x>=bt&&rt!==_e.x&&Mm(at<Mt?rt:ft,at,bt,Mt,at<Mt?ft:rt,at,_e.x,_e.y)&&(St=Math.abs(at-_e.y)/(rt-_e.x),F_(_e,g)&&(St<It||St===It&&(_e.x>ct.x||_e.x===ct.x&&LT(ct,_e)))&&(ct=_e,It=St)),_e=_e.next;while(_e!==mt);return ct}(ut,o),o){const g=fE(o,ut);N_(o,o.next),N_(g,g.next)}}function LT(ut,o){return ga(ut.prev,ut,o.prev)<0&&ga(o.next,ut,ut.next)<0}function pE(ut,o,g,$,_e){return(ut=1431655765&((ut=858993459&((ut=252645135&((ut=16711935&((ut=32767*(ut-g)*_e)|ut<<8))|ut<<4))|ut<<2))|ut<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-$)*_e)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function FA(ut){let o=ut,g=ut;do(o.x<g.x||o.x===g.x&&o.y<g.y)&&(g=o),o=o.next;while(o!==ut);return g}function Mm(ut,o,g,$,_e,rt,at,ct){return(_e-at)*(o-ct)-(ut-at)*(rt-ct)>=0&&(ut-at)*($-ct)-(g-at)*(o-ct)>=0&&(g-at)*(rt-ct)-(_e-at)*($-ct)>=0}function _d(ut,o){return ut.next.i!==o.i&&ut.prev.i!==o.i&&!function(g,$){let _e=g;do{if(_e.i!==g.i&&_e.next.i!==g.i&&_e.i!==$.i&&_e.next.i!==$.i&&U_(_e,_e.next,g,$))return!0;_e=_e.next}while(_e!==g);return!1}(ut,o)&&(F_(ut,o)&&F_(o,ut)&&function(g,$){let _e=g,rt=!1;const at=(g.x+$.x)/2,ct=(g.y+$.y)/2;do _e.y>ct!=_e.next.y>ct&&_e.next.y!==_e.y&&at<(_e.next.x-_e.x)*(ct-_e.y)/(_e.next.y-_e.y)+_e.x&&(rt=!rt),_e=_e.next;while(_e!==g);return rt}(ut,o)&&(ga(ut.prev,ut,o.prev)||ga(ut,o.prev,o))||zp(ut,o)&&ga(ut.prev,ut,ut.next)>0&&ga(o.prev,o,o.next)>0)}function ga(ut,o,g){return(o.y-ut.y)*(g.x-o.x)-(o.x-ut.x)*(g.y-o.y)}function zp(ut,o){return ut.x===o.x&&ut.y===o.y}function U_(ut,o,g,$){const _e=Vp(ga(ut,o,g)),rt=Vp(ga(ut,o,$)),at=Vp(ga(g,$,ut)),ct=Vp(ga(g,$,o));return _e!==rt&&at!==ct||!(_e!==0||!Tm(ut,g,o))||!(rt!==0||!Tm(ut,$,o))||!(at!==0||!Tm(g,ut,$))||!(ct!==0||!Tm(g,o,$))}function Tm(ut,o,g){return o.x<=Math.max(ut.x,g.x)&&o.x>=Math.min(ut.x,g.x)&&o.y<=Math.max(ut.y,g.y)&&o.y>=Math.min(ut.y,g.y)}function Vp(ut){return ut>0?1:ut<0?-1:0}function F_(ut,o){return ga(ut.prev,ut,ut.next)<0?ga(ut,o,ut.next)>=0&&ga(ut,ut.prev,o)>=0:ga(ut,o,ut.prev)<0||ga(ut,ut.next,o)<0}function fE(ut,o){const g=new yC(ut.i,ut.x,ut.y),$=new yC(o.i,o.x,o.y),_e=ut.next,rt=o.prev;return ut.next=o,o.prev=ut,g.next=_e,_e.prev=g,$.next=g,g.prev=$,rt.next=$,$.prev=rt,$}function Qp(ut,o,g,$){const _e=new yC(ut,o,g);return $?(_e.next=$.next,_e.prev=$,$.next.prev=_e,$.next=_e):(_e.prev=_e,_e.next=_e),_e}function fx(ut){ut.next.prev=ut.prev,ut.prev.next=ut.next,ut.prevZ&&(ut.prevZ.nextZ=ut.nextZ),ut.nextZ&&(ut.nextZ.prevZ=ut.prevZ)}function yC(ut,o,g){this.i=ut,this.x=o,this.y=g,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class hv{static area(o){const g=o.length;let $=0;for(let _e=g-1,rt=0;rt<g;_e=rt++)$+=o[_e].x*o[rt].y-o[rt].x*o[_e].y;return .5*$}static isClockWise(o){return hv.area(o)<0}static triangulateShape(o,g){const $=[],_e=[],rt=[];sm(o),mE($,o);let at=o.length;g.forEach(sm);for(let ft=0;ft<g.length;ft++)_e.push(at),at+=g[ft].length,mE($,g[ft]);const ct=function(ft,mt,bt=2){const Mt=mt&&mt.length,St=Mt?mt[0]*bt:ft.length;let It=RT(ft,0,St,bt,!0);const Bt=[];if(!It||It.next===It.prev)return Bt;let Dt,Ut,Ft,zt,Kt,tn,sn;if(Mt&&(It=function(ln,kn,Ln,qn){const Kn=[];let Un,vr,Pr,mr,Qr;for(Un=0,vr=kn.length;Un<vr;Un++)Pr=kn[Un]*qn,mr=Un<vr-1?kn[Un+1]*qn:ln.length,Qr=RT(ln,Pr,mr,qn,!1),Qr===Qr.next&&(Qr.steiner=!0),Kn.push(FA(Qr));for(Kn.sort(px),Un=0;Un<Kn.length;Un++)uv(Kn[Un],Ln),Ln=N_(Ln,Ln.next);return Ln}(ft,mt,It,bt)),ft.length>80*bt){Dt=Ft=ft[0],Ut=zt=ft[1];for(let ln=bt;ln<St;ln+=bt)Kt=ft[ln],tn=ft[ln+1],Kt<Dt&&(Dt=Kt),tn<Ut&&(Ut=tn),Kt>Ft&&(Ft=Kt),tn>zt&&(zt=tn);sn=Math.max(Ft-Dt,zt-Ut),sn=sn!==0?1/sn:0}return hx(It,Bt,bt,Dt,Ut,sn),Bt}($,_e);for(let ft=0;ft<ct.length;ft+=3)rt.push(ct.slice(ft,ft+3));return rt}}function sm(ut){const o=ut.length;o>2&&ut[o-1].equals(ut[0])&&ut.pop()}function mE(ut,o){for(let g=0;g<o.length;g++)ut.push(o[g].x),ut.push(o[g].y)}class mx extends ls{constructor(o=new UA([new Cr(.5,.5),new Cr(-.5,.5),new Cr(-.5,-.5),new Cr(.5,-.5)]),g={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:o,options:g},o=Array.isArray(o)?o:[o];const $=this,_e=[],rt=[];for(let ct=0,ft=o.length;ct<ft;ct++)at(o[ct]);function at(ct){const ft=[],mt=g.curveSegments!==void 0?g.curveSegments:12,bt=g.steps!==void 0?g.steps:1,Mt=g.depth!==void 0?g.depth:1;let St=g.bevelEnabled===void 0||g.bevelEnabled,It=g.bevelThickness!==void 0?g.bevelThickness:.2,Bt=g.bevelSize!==void 0?g.bevelSize:It-.1,Dt=g.bevelOffset!==void 0?g.bevelOffset:0,Ut=g.bevelSegments!==void 0?g.bevelSegments:3;const Ft=g.extrudePath,zt=g.UVGenerator!==void 0?g.UVGenerator:mD;let Kt,tn,sn,ln,kn,Ln=!1;Ft&&(Kt=Ft.getSpacedPoints(bt),Ln=!0,St=!1,tn=Ft.computeFrenetFrames(bt,!1),sn=new dn,ln=new dn,kn=new dn),St||(Ut=0,It=0,Bt=0,Dt=0);const qn=ct.extractPoints(mt);let Kn=qn.shape;const Un=qn.holes;if(!hv.isClockWise(Kn)){Kn=Kn.reverse();for(let Wn=0,Dn=Un.length;Wn<Dn;Wn++){const Gn=Un[Wn];hv.isClockWise(Gn)&&(Un[Wn]=Gn.reverse())}}const vr=hv.triangulateShape(Kn,Un),Pr=Kn;for(let Wn=0,Dn=Un.length;Wn<Dn;Wn++){const Gn=Un[Wn];Kn=Kn.concat(Gn)}function mr(Wn,Dn,Gn){return Dn||console.error("THREE.ExtrudeGeometry: vec does not exist"),Dn.clone().multiplyScalar(Gn).add(Wn)}const Qr=Kn.length,Gr=vr.length;function lr(Wn,Dn,Gn){let ur,Jt,hr;const Zn=Wn.x-Dn.x,gr=Wn.y-Dn.y,wr=Gn.x-Wn.x,Xr=Gn.y-Wn.y,vs=Zn*Zn+gr*gr,Cs=Zn*Xr-gr*wr;if(Math.abs(Cs)>Number.EPSILON){const js=Math.sqrt(vs),bs=Math.sqrt(wr*wr+Xr*Xr),Ms=Dn.x-gr/js,Eo=Dn.y+Zn/js,lm=((Gn.x-Xr/bs-Ms)*Xr-(Gn.y+wr/bs-Eo)*wr)/(Zn*Xr-gr*wr);ur=Ms+Zn*lm-Wn.x,Jt=Eo+gr*lm-Wn.y;const Us=ur*ur+Jt*Jt;if(Us<=2)return new Cr(ur,Jt);hr=Math.sqrt(Us/2)}else{let js=!1;Zn>Number.EPSILON?wr>Number.EPSILON&&(js=!0):Zn<-Number.EPSILON?wr<-Number.EPSILON&&(js=!0):Math.sign(gr)===Math.sign(Xr)&&(js=!0),js?(ur=-gr,Jt=Zn,hr=Math.sqrt(vs)):(ur=Zn,Jt=gr,hr=Math.sqrt(vs/2))}return new Cr(ur/hr,Jt/hr)}const dr=[];for(let Wn=0,Dn=Pr.length,Gn=Dn-1,ur=Wn+1;Wn<Dn;Wn++,Gn++,ur++)Gn===Dn&&(Gn=0),ur===Dn&&(ur=0),dr[Wn]=lr(Pr[Wn],Pr[Gn],Pr[ur]);const Or=[];let _r,Vr=dr.concat();for(let Wn=0,Dn=Un.length;Wn<Dn;Wn++){const Gn=Un[Wn];_r=[];for(let ur=0,Jt=Gn.length,hr=Jt-1,Zn=ur+1;ur<Jt;ur++,hr++,Zn++)hr===Jt&&(hr=0),Zn===Jt&&(Zn=0),_r[ur]=lr(Gn[ur],Gn[hr],Gn[Zn]);Or.push(_r),Vr=Vr.concat(_r)}for(let Wn=0;Wn<Ut;Wn++){const Dn=Wn/Ut,Gn=It*Math.cos(Dn*Math.PI/2),ur=Bt*Math.sin(Dn*Math.PI/2)+Dt;for(let Jt=0,hr=Pr.length;Jt<hr;Jt++){const Zn=mr(Pr[Jt],dr[Jt],ur);gs(Zn.x,Zn.y,-Gn)}for(let Jt=0,hr=Un.length;Jt<hr;Jt++){const Zn=Un[Jt];_r=Or[Jt];for(let gr=0,wr=Zn.length;gr<wr;gr++){const Xr=mr(Zn[gr],_r[gr],ur);gs(Xr.x,Xr.y,-Gn)}}}const fs=Bt+Dt;for(let Wn=0;Wn<Qr;Wn++){const Dn=St?mr(Kn[Wn],Vr[Wn],fs):Kn[Wn];Ln?(ln.copy(tn.normals[0]).multiplyScalar(Dn.x),sn.copy(tn.binormals[0]).multiplyScalar(Dn.y),kn.copy(Kt[0]).add(ln).add(sn),gs(kn.x,kn.y,kn.z)):gs(Dn.x,Dn.y,0)}for(let Wn=1;Wn<=bt;Wn++)for(let Dn=0;Dn<Qr;Dn++){const Gn=St?mr(Kn[Dn],Vr[Dn],fs):Kn[Dn];Ln?(ln.copy(tn.normals[Wn]).multiplyScalar(Gn.x),sn.copy(tn.binormals[Wn]).multiplyScalar(Gn.y),kn.copy(Kt[Wn]).add(ln).add(sn),gs(kn.x,kn.y,kn.z)):gs(Gn.x,Gn.y,Mt/bt*Wn)}for(let Wn=Ut-1;Wn>=0;Wn--){const Dn=Wn/Ut,Gn=It*Math.cos(Dn*Math.PI/2),ur=Bt*Math.sin(Dn*Math.PI/2)+Dt;for(let Jt=0,hr=Pr.length;Jt<hr;Jt++){const Zn=mr(Pr[Jt],dr[Jt],ur);gs(Zn.x,Zn.y,Mt+Gn)}for(let Jt=0,hr=Un.length;Jt<hr;Jt++){const Zn=Un[Jt];_r=Or[Jt];for(let gr=0,wr=Zn.length;gr<wr;gr++){const Xr=mr(Zn[gr],_r[gr],ur);Ln?gs(Xr.x,Xr.y+Kt[bt-1].y,Kt[bt-1].x+Gn):gs(Xr.x,Xr.y,Mt+Gn)}}}function Ks(Wn,Dn){let Gn=Wn.length;for(;--Gn>=0;){const ur=Gn;let Jt=Gn-1;Jt<0&&(Jt=Wn.length-1);for(let hr=0,Zn=bt+2*Ut;hr<Zn;hr++){const gr=Qr*hr,wr=Qr*(hr+1);In(Dn+ur+gr,Dn+Jt+gr,Dn+Jt+wr,Dn+ur+wr)}}}function gs(Wn,Dn,Gn){ft.push(Wn),ft.push(Dn),ft.push(Gn)}function Qs(Wn,Dn,Gn){yn(Wn),yn(Dn),yn(Gn);const ur=_e.length/3,Jt=zt.generateTopUV($,_e,ur-3,ur-2,ur-1);tr(Jt[0]),tr(Jt[1]),tr(Jt[2])}function In(Wn,Dn,Gn,ur){yn(Wn),yn(Dn),yn(ur),yn(Dn),yn(Gn),yn(ur);const Jt=_e.length/3,hr=zt.generateSideWallUV($,_e,Jt-6,Jt-3,Jt-2,Jt-1);tr(hr[0]),tr(hr[1]),tr(hr[3]),tr(hr[1]),tr(hr[2]),tr(hr[3])}function yn(Wn){_e.push(ft[3*Wn+0]),_e.push(ft[3*Wn+1]),_e.push(ft[3*Wn+2])}function tr(Wn){rt.push(Wn.x),rt.push(Wn.y)}(function(){const Wn=_e.length/3;if(St){let Dn=0,Gn=Qr*Dn;for(let ur=0;ur<Gr;ur++){const Jt=vr[ur];Qs(Jt[2]+Gn,Jt[1]+Gn,Jt[0]+Gn)}Dn=bt+2*Ut,Gn=Qr*Dn;for(let ur=0;ur<Gr;ur++){const Jt=vr[ur];Qs(Jt[0]+Gn,Jt[1]+Gn,Jt[2]+Gn)}}else{for(let Dn=0;Dn<Gr;Dn++){const Gn=vr[Dn];Qs(Gn[2],Gn[1],Gn[0])}for(let Dn=0;Dn<Gr;Dn++){const Gn=vr[Dn];Qs(Gn[0]+Qr*bt,Gn[1]+Qr*bt,Gn[2]+Qr*bt)}}$.addGroup(Wn,_e.length/3-Wn,0)})(),function(){const Wn=_e.length/3;let Dn=0;Ks(Pr,Dn),Dn+=Pr.length;for(let Gn=0,ur=Un.length;Gn<ur;Gn++){const Jt=Un[Gn];Ks(Jt,Dn),Dn+=Jt.length}$.addGroup(Wn,_e.length/3-Wn,1)}()}this.setAttribute("position",new ht(_e,3)),this.setAttribute("uv",new ht(rt,2)),this.computeVertexNormals()}toJSON(){const o=super.toJSON();return function(g,$,_e){if(_e.shapes=[],Array.isArray(g))for(let rt=0,at=g.length;rt<at;rt++){const ct=g[rt];_e.shapes.push(ct.uuid)}else _e.shapes.push(g.uuid);return _e.options=Object.assign({},$),$.extrudePath!==void 0&&(_e.options.extrudePath=$.extrudePath.toJSON()),_e}(this.parameters.shapes,this.parameters.options,o)}static fromJSON(o,g){const $=[];for(let rt=0,at=o.shapes.length;rt<at;rt++){const ct=g[o.shapes[rt]];$.push(ct)}const _e=o.options.extrudePath;return _e!==void 0&&(o.options.extrudePath=new mo[_e.type]().fromJSON(_e)),new mx($,o.options)}}const mD={generateTopUV:function(ut,o,g,$,_e){const rt=o[3*g],at=o[3*g+1],ct=o[3*$],ft=o[3*$+1],mt=o[3*_e],bt=o[3*_e+1];return[new Cr(rt,at),new Cr(ct,ft),new Cr(mt,bt)]},generateSideWallUV:function(ut,o,g,$,_e,rt){const at=o[3*g],ct=o[3*g+1],ft=o[3*g+2],mt=o[3*$],bt=o[3*$+1],Mt=o[3*$+2],St=o[3*_e],It=o[3*_e+1],Bt=o[3*_e+2],Dt=o[3*rt],Ut=o[3*rt+1],Ft=o[3*rt+2];return Math.abs(ct-bt)<Math.abs(at-mt)?[new Cr(at,1-ft),new Cr(mt,1-Mt),new Cr(St,1-Bt),new Cr(Dt,1-Ft)]:[new Cr(ct,1-ft),new Cr(bt,1-Mt),new Cr(It,1-Bt),new Cr(Ut,1-Ft)]}};class Ky extends U0{constructor(o=1,g=0){const $=(1+Math.sqrt(5))/2;super([-1,$,0,1,$,0,-1,-$,0,1,-$,0,0,-1,$,0,1,$,0,-1,-$,0,1,-$,$,0,-1,$,0,1,-$,0,-1,-$,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],o,g),this.type="IcosahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Ky(o.radius,o.detail)}}class Uu extends U0{constructor(o=1,g=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],o,g),this.type="OctahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new Uu(o.radius,o.detail)}}class jA extends ls{constructor(o=.5,g=1,$=8,_e=1,rt=0,at=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:o,outerRadius:g,thetaSegments:$,phiSegments:_e,thetaStart:rt,thetaLength:at},$=Math.max(3,$);const ct=[],ft=[],mt=[],bt=[];let Mt=o;const St=(g-o)/(_e=Math.max(1,_e)),It=new dn,Bt=new Cr;for(let Dt=0;Dt<=_e;Dt++){for(let Ut=0;Ut<=$;Ut++){const Ft=rt+Ut/$*at;It.x=Mt*Math.cos(Ft),It.y=Mt*Math.sin(Ft),ft.push(It.x,It.y,It.z),mt.push(0,0,1),Bt.x=(It.x/g+1)/2,Bt.y=(It.y/g+1)/2,bt.push(Bt.x,Bt.y)}Mt+=St}for(let Dt=0;Dt<_e;Dt++){const Ut=Dt*($+1);for(let Ft=0;Ft<$;Ft++){const zt=Ft+Ut,Kt=zt,tn=zt+$+1,sn=zt+$+2,ln=zt+1;ct.push(Kt,tn,ln),ct.push(tn,sn,ln)}}this.setIndex(ct),this.setAttribute("position",new ht(ft,3)),this.setAttribute("normal",new ht(mt,3)),this.setAttribute("uv",new ht(bt,2))}static fromJSON(o){return new jA(o.innerRadius,o.outerRadius,o.thetaSegments,o.phiSegments,o.thetaStart,o.thetaLength)}}class gx extends ls{constructor(o=new UA([new Cr(0,.5),new Cr(-.5,-.5),new Cr(.5,-.5)]),g=12){super(),this.type="ShapeGeometry",this.parameters={shapes:o,curveSegments:g};const $=[],_e=[],rt=[],at=[];let ct=0,ft=0;if(Array.isArray(o)===!1)mt(o);else for(let bt=0;bt<o.length;bt++)mt(o[bt]),this.addGroup(ct,ft,bt),ct+=ft,ft=0;function mt(bt){const Mt=_e.length/3,St=bt.extractPoints(g);let It=St.shape;const Bt=St.holes;hv.isClockWise(It)===!1&&(It=It.reverse());for(let Ut=0,Ft=Bt.length;Ut<Ft;Ut++){const zt=Bt[Ut];hv.isClockWise(zt)===!0&&(Bt[Ut]=zt.reverse())}const Dt=hv.triangulateShape(It,Bt);for(let Ut=0,Ft=Bt.length;Ut<Ft;Ut++){const zt=Bt[Ut];It=It.concat(zt)}for(let Ut=0,Ft=It.length;Ut<Ft;Ut++){const zt=It[Ut];_e.push(zt.x,zt.y,0),rt.push(0,0,1),at.push(zt.x,zt.y)}for(let Ut=0,Ft=Dt.length;Ut<Ft;Ut++){const zt=Dt[Ut],Kt=zt[0]+Mt,tn=zt[1]+Mt,sn=zt[2]+Mt;$.push(Kt,tn,sn),ft+=3}}this.setIndex($),this.setAttribute("position",new ht(_e,3)),this.setAttribute("normal",new ht(rt,3)),this.setAttribute("uv",new ht(at,2))}toJSON(){const o=super.toJSON();return function(g,$){if($.shapes=[],Array.isArray(g))for(let _e=0,rt=g.length;_e<rt;_e++){const at=g[_e];$.shapes.push(at.uuid)}else $.shapes.push(g.uuid);return $}(this.parameters.shapes,o)}static fromJSON(o,g){const $=[];for(let _e=0,rt=o.shapes.length;_e<rt;_e++){const at=g[o.shapes[_e]];$.push(at)}return new gx($,o.curveSegments)}}class Jy extends ls{constructor(o=1,g=32,$=16,_e=0,rt=2*Math.PI,at=0,ct=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:o,widthSegments:g,heightSegments:$,phiStart:_e,phiLength:rt,thetaStart:at,thetaLength:ct},g=Math.max(3,Math.floor(g)),$=Math.max(2,Math.floor($));const ft=Math.min(at+ct,Math.PI);let mt=0;const bt=[],Mt=new dn,St=new dn,It=[],Bt=[],Dt=[],Ut=[];for(let Ft=0;Ft<=$;Ft++){const zt=[],Kt=Ft/$;let tn=0;Ft==0&&at==0?tn=.5/g:Ft==$&&ft==Math.PI&&(tn=-.5/g);for(let sn=0;sn<=g;sn++){const ln=sn/g;Mt.x=-o*Math.cos(_e+ln*rt)*Math.sin(at+Kt*ct),Mt.y=o*Math.cos(at+Kt*ct),Mt.z=o*Math.sin(_e+ln*rt)*Math.sin(at+Kt*ct),Bt.push(Mt.x,Mt.y,Mt.z),St.copy(Mt).normalize(),Dt.push(St.x,St.y,St.z),Ut.push(ln+tn,1-Kt),zt.push(mt++)}bt.push(zt)}for(let Ft=0;Ft<$;Ft++)for(let zt=0;zt<g;zt++){const Kt=bt[Ft][zt+1],tn=bt[Ft][zt],sn=bt[Ft+1][zt],ln=bt[Ft+1][zt+1];(Ft!==0||at>0)&&It.push(Kt,tn,ln),(Ft!==$-1||ft<Math.PI)&&It.push(tn,sn,ln)}this.setIndex(It),this.setAttribute("position",new ht(Bt,3)),this.setAttribute("normal",new ht(Dt,3)),this.setAttribute("uv",new ht(Ut,2))}static fromJSON(o){return new Jy(o.radius,o.widthSegments,o.heightSegments,o.phiStart,o.phiLength,o.thetaStart,o.thetaLength)}}class zA extends U0{constructor(o=1,g=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],o,g),this.type="TetrahedronGeometry",this.parameters={radius:o,detail:g}}static fromJSON(o){return new zA(o.radius,o.detail)}}class j_ extends ls{constructor(o=1,g=.4,$=8,_e=6,rt=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:o,tube:g,radialSegments:$,tubularSegments:_e,arc:rt},$=Math.floor($),_e=Math.floor(_e);const at=[],ct=[],ft=[],mt=[],bt=new dn,Mt=new dn,St=new dn;for(let It=0;It<=$;It++)for(let Bt=0;Bt<=_e;Bt++){const Dt=Bt/_e*rt,Ut=It/$*Math.PI*2;Mt.x=(o+g*Math.cos(Ut))*Math.cos(Dt),Mt.y=(o+g*Math.cos(Ut))*Math.sin(Dt),Mt.z=g*Math.sin(Ut),ct.push(Mt.x,Mt.y,Mt.z),bt.x=o*Math.cos(Dt),bt.y=o*Math.sin(Dt),St.subVectors(Mt,bt).normalize(),ft.push(St.x,St.y,St.z),mt.push(Bt/_e),mt.push(It/$)}for(let It=1;It<=$;It++)for(let Bt=1;Bt<=_e;Bt++){const Dt=(_e+1)*It+Bt-1,Ut=(_e+1)*(It-1)+Bt-1,Ft=(_e+1)*(It-1)+Bt,zt=(_e+1)*It+Bt;at.push(Dt,Ut,zt),at.push(Ut,Ft,zt)}this.setIndex(at),this.setAttribute("position",new ht(ct,3)),this.setAttribute("normal",new ht(ft,3)),this.setAttribute("uv",new ht(mt,2))}static fromJSON(o){return new j_(o.radius,o.tube,o.radialSegments,o.tubularSegments,o.arc)}}class Mu extends ls{constructor(o=1,g=.4,$=64,_e=8,rt=2,at=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:o,tube:g,tubularSegments:$,radialSegments:_e,p:rt,q:at},$=Math.floor($),_e=Math.floor(_e);const ct=[],ft=[],mt=[],bt=[],Mt=new dn,St=new dn,It=new dn,Bt=new dn,Dt=new dn,Ut=new dn,Ft=new dn;for(let Kt=0;Kt<=$;++Kt){const tn=Kt/$*rt*Math.PI*2;zt(tn,rt,at,o,It),zt(tn+.01,rt,at,o,Bt),Ut.subVectors(Bt,It),Ft.addVectors(Bt,It),Dt.crossVectors(Ut,Ft),Ft.crossVectors(Dt,Ut),Dt.normalize(),Ft.normalize();for(let sn=0;sn<=_e;++sn){const ln=sn/_e*Math.PI*2,kn=-g*Math.cos(ln),Ln=g*Math.sin(ln);Mt.x=It.x+(kn*Ft.x+Ln*Dt.x),Mt.y=It.y+(kn*Ft.y+Ln*Dt.y),Mt.z=It.z+(kn*Ft.z+Ln*Dt.z),ft.push(Mt.x,Mt.y,Mt.z),St.subVectors(Mt,It).normalize(),mt.push(St.x,St.y,St.z),bt.push(Kt/$),bt.push(sn/_e)}}for(let Kt=1;Kt<=$;Kt++)for(let tn=1;tn<=_e;tn++){const sn=(_e+1)*(Kt-1)+(tn-1),ln=(_e+1)*Kt+(tn-1),kn=(_e+1)*Kt+tn,Ln=(_e+1)*(Kt-1)+tn;ct.push(sn,ln,Ln),ct.push(ln,kn,Ln)}function zt(Kt,tn,sn,ln,kn){const Ln=Math.cos(Kt),qn=Math.sin(Kt),Kn=sn/tn*Kt,Un=Math.cos(Kn);kn.x=ln*(2+Un)*.5*Ln,kn.y=ln*(2+Un)*qn*.5,kn.z=ln*Math.sin(Kn)*.5}this.setIndex(ct),this.setAttribute("position",new ht(ft,3)),this.setAttribute("normal",new ht(mt,3)),this.setAttribute("uv",new ht(bt,2))}static fromJSON(o){return new Mu(o.radius,o.tube,o.tubularSegments,o.radialSegments,o.p,o.q)}}class vx extends ls{constructor(o=new hE(new dn(-1,-1,0),new dn(-1,1,0),new dn(1,1,0)),g=64,$=1,_e=8,rt=!1){super(),this.type="TubeGeometry",this.parameters={path:o,tubularSegments:g,radius:$,radialSegments:_e,closed:rt};const at=o.computeFrenetFrames(g,rt);this.tangents=at.tangents,this.normals=at.normals,this.binormals=at.binormals;const ct=new dn,ft=new dn,mt=new Cr;let bt=new dn;const Mt=[],St=[],It=[],Bt=[];function Dt(Ut){bt=o.getPointAt(Ut/g,bt);const Ft=at.normals[Ut],zt=at.binormals[Ut];for(let Kt=0;Kt<=_e;Kt++){const tn=Kt/_e*Math.PI*2,sn=Math.sin(tn),ln=-Math.cos(tn);ft.x=ln*Ft.x+sn*zt.x,ft.y=ln*Ft.y+sn*zt.y,ft.z=ln*Ft.z+sn*zt.z,ft.normalize(),St.push(ft.x,ft.y,ft.z),ct.x=bt.x+$*ft.x,ct.y=bt.y+$*ft.y,ct.z=bt.z+$*ft.z,Mt.push(ct.x,ct.y,ct.z)}}(function(){for(let Ut=0;Ut<g;Ut++)Dt(Ut);Dt(rt===!1?g:0),function(){for(let Ut=0;Ut<=g;Ut++)for(let Ft=0;Ft<=_e;Ft++)mt.x=Ut/g,mt.y=Ft/_e,It.push(mt.x,mt.y)}(),function(){for(let Ut=1;Ut<=g;Ut++)for(let Ft=1;Ft<=_e;Ft++){const zt=(_e+1)*(Ut-1)+(Ft-1),Kt=(_e+1)*Ut+(Ft-1),tn=(_e+1)*Ut+Ft,sn=(_e+1)*(Ut-1)+Ft;Bt.push(zt,Kt,sn),Bt.push(Kt,tn,sn)}}()})(),this.setIndex(Bt),this.setAttribute("position",new ht(Mt,3)),this.setAttribute("normal",new ht(St,3)),this.setAttribute("uv",new ht(It,2))}toJSON(){const o=super.toJSON();return o.path=this.parameters.path.toJSON(),o}static fromJSON(o){return new vx(new mo[o.path.type]().fromJSON(o.path),o.tubularSegments,o.radius,o.radialSegments,o.closed)}}class OT extends ls{constructor(o=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:o},o!==null){const g=[],$=new Set,_e=new dn,rt=new dn;if(o.index!==null){const at=o.attributes.position,ct=o.index;let ft=o.groups;ft.length===0&&(ft=[{start:0,count:ct.count,materialIndex:0}]);for(let mt=0,bt=ft.length;mt<bt;++mt){const Mt=ft[mt],St=Mt.start;for(let It=St,Bt=St+Mt.count;It<Bt;It+=3)for(let Dt=0;Dt<3;Dt++){const Ut=ct.getX(It+Dt),Ft=ct.getX(It+(Dt+1)%3);_e.fromBufferAttribute(at,Ut),rt.fromBufferAttribute(at,Ft),wC(_e,rt,$)===!0&&(g.push(_e.x,_e.y,_e.z),g.push(rt.x,rt.y,rt.z))}}}else{const at=o.attributes.position;for(let ct=0,ft=at.count/3;ct<ft;ct++)for(let mt=0;mt<3;mt++){const bt=3*ct+mt,Mt=3*ct+(mt+1)%3;_e.fromBufferAttribute(at,bt),rt.fromBufferAttribute(at,Mt),wC(_e,rt,$)===!0&&(g.push(_e.x,_e.y,_e.z),g.push(rt.x,rt.y,rt.z))}}this.setAttribute("position",new ht(g,3))}}}function wC(ut,o,g){const $=`${ut.x},${ut.y},${ut.z}-${o.x},${o.y},${o.z}`,_e=`${o.x},${o.y},${o.z}-${ut.x},${ut.y},${ut.z}`;return g.has($)!==!0&&g.has(_e)!==!0&&(g.add($),g.add(_e),!0)}var Im=Object.freeze({__proto__:null,BoxGeometry:Sm,CapsuleGeometry:lx,CircleGeometry:rm,ConeGeometry:Go,CylinderGeometry:uu,DodecahedronGeometry:cx,EdgesGeometry:dE,ExtrudeGeometry:mx,IcosahedronGeometry:Ky,LatheGeometry:$a,OctahedronGeometry:Uu,PlaneGeometry:D_,PolyhedronGeometry:U0,RingGeometry:jA,ShapeGeometry:gx,SphereGeometry:Jy,TetrahedronGeometry:zA,TorusGeometry:j_,TorusKnotGeometry:Mu,TubeGeometry:vx,WireframeGeometry:OT});class gE extends lu{constructor(o){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ts(0),this.transparent=!0,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.fog=o.fog,this}}class NT extends tv{constructor(o){super(o),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class xC extends lu{constructor(o){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ts(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={STANDARD:""},this.color.copy(o.color),this.roughness=o.roughness,this.metalness=o.metalness,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.roughnessMap=o.roughnessMap,this.metalnessMap=o.metalnessMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.envMapIntensity=o.envMapIntensity,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class bC extends xC{constructor(o){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Cr(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ys(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(g){this.ior=(1+.4*g)/(1-.4*g)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ts(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ts(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ts(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(o)}get sheen(){return this._sheen}set sheen(o){this._sheen>0!=o>0&&this.version++,this._sheen=o}get clearcoat(){return this._clearcoat}set clearcoat(o){this._clearcoat>0!=o>0&&this.version++,this._clearcoat=o}get iridescence(){return this._iridescence}set iridescence(o){this._iridescence>0!=o>0&&this.version++,this._iridescence=o}get transmission(){return this._transmission}set transmission(o){this._transmission>0!=o>0&&this.version++,this._transmission=o}copy(o){return super.copy(o),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=o.clearcoat,this.clearcoatMap=o.clearcoatMap,this.clearcoatRoughness=o.clearcoatRoughness,this.clearcoatRoughnessMap=o.clearcoatRoughnessMap,this.clearcoatNormalMap=o.clearcoatNormalMap,this.clearcoatNormalScale.copy(o.clearcoatNormalScale),this.ior=o.ior,this.iridescence=o.iridescence,this.iridescenceMap=o.iridescenceMap,this.iridescenceIOR=o.iridescenceIOR,this.iridescenceThicknessRange=[...o.iridescenceThicknessRange],this.iridescenceThicknessMap=o.iridescenceThicknessMap,this.sheen=o.sheen,this.sheenColor.copy(o.sheenColor),this.sheenColorMap=o.sheenColorMap,this.sheenRoughness=o.sheenRoughness,this.sheenRoughnessMap=o.sheenRoughnessMap,this.transmission=o.transmission,this.transmissionMap=o.transmissionMap,this.thickness=o.thickness,this.thicknessMap=o.thicknessMap,this.attenuationDistance=o.attenuationDistance,this.attenuationColor.copy(o.attenuationColor),this.specularIntensity=o.specularIntensity,this.specularIntensityMap=o.specularIntensityMap,this.specularColor.copy(o.specularColor),this.specularColorMap=o.specularColorMap,this}}class _x extends lu{constructor(o){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ts(16777215),this.specular=new ts(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.specular.copy(o.specular),this.shininess=o.shininess,this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class UT extends lu{constructor(o){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ts(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.gradientMap=o.gradientMap,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.fog=o.fog,this}}class Ax extends lu{constructor(o){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(o)}copy(o){return super.copy(o),this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.flatShading=o.flatShading,this}}class EC extends lu{constructor(o){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ts(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ts(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ss,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.color.copy(o.color),this.map=o.map,this.lightMap=o.lightMap,this.lightMapIntensity=o.lightMapIntensity,this.aoMap=o.aoMap,this.aoMapIntensity=o.aoMapIntensity,this.emissive.copy(o.emissive),this.emissiveMap=o.emissiveMap,this.emissiveIntensity=o.emissiveIntensity,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.specularMap=o.specularMap,this.alphaMap=o.alphaMap,this.envMap=o.envMap,this.combine=o.combine,this.reflectivity=o.reflectivity,this.refractionRatio=o.refractionRatio,this.wireframe=o.wireframe,this.wireframeLinewidth=o.wireframeLinewidth,this.wireframeLinecap=o.wireframeLinecap,this.wireframeLinejoin=o.wireframeLinejoin,this.flatShading=o.flatShading,this.fog=o.fog,this}}class yx extends lu{constructor(o){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ts(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=tu,this.normalScale=new Cr(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(o)}copy(o){return super.copy(o),this.defines={MATCAP:""},this.color.copy(o.color),this.matcap=o.matcap,this.map=o.map,this.bumpMap=o.bumpMap,this.bumpScale=o.bumpScale,this.normalMap=o.normalMap,this.normalMapType=o.normalMapType,this.normalScale.copy(o.normalScale),this.displacementMap=o.displacementMap,this.displacementScale=o.displacementScale,this.displacementBias=o.displacementBias,this.alphaMap=o.alphaMap,this.flatShading=o.flatShading,this.fog=o.fog,this}}class SC extends cp{constructor(o){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(o)}copy(o){return super.copy(o),this.scale=o.scale,this.dashSize=o.dashSize,this.gapSize=o.gapSize,this}}function om(ut,o,g){return El(ut)?new ut.constructor(ut.subarray(o,g!==void 0?g:ut.length)):ut.slice(o,g)}function Gp(ut,o,g){return!ut||!g&&ut.constructor===o?ut:typeof o.BYTES_PER_ELEMENT=="number"?new o(ut):Array.prototype.slice.call(ut)}function El(ut){return ArrayBuffer.isView(ut)&&!(ut instanceof DataView)}function FT(ut){const o=ut.length,g=new Array(o);for(let $=0;$!==o;++$)g[$]=$;return g.sort(function($,_e){return ut[$]-ut[_e]}),g}function up(ut,o,g){const $=ut.length,_e=new ut.constructor($);for(let rt=0,at=0;at!==$;++rt){const ct=g[rt]*o;for(let ft=0;ft!==o;++ft)_e[at++]=ut[ct+ft]}return _e}function Pl(ut,o,g,$){let _e=1,rt=ut[0];for(;rt!==void 0&&rt[$]===void 0;)rt=ut[_e++];if(rt===void 0)return;let at=rt[$];if(at!==void 0)if(Array.isArray(at))do at=rt[$],at!==void 0&&(o.push(rt.time),g.push.apply(g,at)),rt=ut[_e++];while(rt!==void 0);else if(at.toArray!==void 0)do at=rt[$],at!==void 0&&(o.push(rt.time),at.toArray(g,g.length)),rt=ut[_e++];while(rt!==void 0);else do at=rt[$],at!==void 0&&(o.push(rt.time),g.push(at)),rt=ut[_e++];while(rt!==void 0)}var wx=Object.freeze({__proto__:null,arraySlice:om,convertArray:Gp,isTypedArray:El,getKeyframeOrder:FT,sortedArray:up,flattenJSON:Pl,subclip:function(ut,o,g,$,_e=30){const rt=ut.clone();rt.name=o;const at=[];for(let ft=0;ft<rt.tracks.length;++ft){const mt=rt.tracks[ft],bt=mt.getValueSize(),Mt=[],St=[];for(let It=0;It<mt.times.length;++It){const Bt=mt.times[It]*_e;if(!(Bt<g||Bt>=$)){Mt.push(mt.times[It]);for(let Dt=0;Dt<bt;++Dt)St.push(mt.values[It*bt+Dt])}}Mt.length!==0&&(mt.times=Gp(Mt,mt.times.constructor),mt.values=Gp(St,mt.values.constructor),at.push(mt))}rt.tracks=at;let ct=1/0;for(let ft=0;ft<rt.tracks.length;++ft)ct>rt.tracks[ft].times[0]&&(ct=rt.tracks[ft].times[0]);for(let ft=0;ft<rt.tracks.length;++ft)rt.tracks[ft].shift(-1*ct);return rt.resetDuration(),rt},makeClipAdditive:function(ut,o=0,g=ut,$=30){$<=0&&($=30);const _e=g.tracks.length,rt=o/$;for(let at=0;at<_e;++at){const ct=g.tracks[at],ft=ct.ValueTypeName;if(ft==="bool"||ft==="string")continue;const mt=ut.tracks.find(function(Ft){return Ft.name===ct.name&&Ft.ValueTypeName===ft});if(mt===void 0)continue;let bt=0;const Mt=ct.getValueSize();ct.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(bt=Mt/3);let St=0;const It=mt.getValueSize();mt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(St=It/3);const Bt=ct.times.length-1;let Dt;if(rt<=ct.times[0]){const Ft=bt,zt=Mt-bt;Dt=om(ct.values,Ft,zt)}else if(rt>=ct.times[Bt]){const Ft=Bt*Mt+bt,zt=Ft+Mt-bt;Dt=om(ct.values,Ft,zt)}else{const Ft=ct.createInterpolant(),zt=bt,Kt=Mt-bt;Ft.evaluate(rt),Dt=om(Ft.resultBuffer,zt,Kt)}ft==="quaternion"&&new su().fromArray(Dt).normalize().conjugate().toArray(Dt);const Ut=mt.times.length;for(let Ft=0;Ft<Ut;++Ft){const zt=Ft*It+St;if(ft==="quaternion")su.multiplyQuaternionsFlat(mt.values,zt,Dt,0,mt.values,zt);else{const Kt=It-2*St;for(let tn=0;tn<Kt;++tn)mt.values[zt+tn]-=Dt[tn]}}}return ut.blendMode=py,ut}});class VA{constructor(o,g,$,_e){this.parameterPositions=o,this._cachedIndex=0,this.resultBuffer=_e!==void 0?_e:new g.constructor($),this.sampleValues=g,this.valueSize=$,this.settings=null,this.DefaultSettings_={}}evaluate(o){const g=this.parameterPositions;let $=this._cachedIndex,_e=g[$],rt=g[$-1];e:{t:{let at;n:{i:if(!(o<_e)){for(let ct=$+2;;){if(_e===void 0){if(o<rt)break i;return $=g.length,this._cachedIndex=$,this.copySampleValue_($-1)}if($===ct)break;if(rt=_e,_e=g[++$],o<_e)break t}at=g.length;break n}if(o>=rt)break e;{const ct=g[1];o<ct&&($=2,rt=ct);for(let ft=$-2;;){if(rt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if($===ft)break;if(_e=rt,rt=g[--$-1],o>=rt)break t}at=$,$=0}}for(;$<at;){const ct=$+at>>>1;o<g[ct]?at=ct:$=ct+1}if(_e=g[$],rt=g[$-1],rt===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(_e===void 0)return $=g.length,this._cachedIndex=$,this.copySampleValue_($-1)}this._cachedIndex=$,this.intervalChanged_($,rt,_e)}return this.interpolate_($,rt,o,_e)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(o){const g=this.resultBuffer,$=this.sampleValues,_e=this.valueSize,rt=o*_e;for(let at=0;at!==_e;++at)g[at]=$[rt+at];return g}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class vE extends VA{constructor(o,g,$,_e){super(o,g,$,_e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Fl,endingEnd:Fl}}intervalChanged_(o,g,$){const _e=this.parameterPositions;let rt=o-2,at=o+1,ct=_e[rt],ft=_e[at];if(ct===void 0)switch(this.getSettings_().endingStart){case xp:rt=o,ct=2*g-$;break;case d0:rt=_e.length-2,ct=g+_e[rt]-_e[rt+1];break;default:rt=o,ct=$}if(ft===void 0)switch(this.getSettings_().endingEnd){case xp:at=o,ft=2*$-g;break;case d0:at=1,ft=$+_e[1]-_e[0];break;default:at=o-1,ft=g}const mt=.5*($-g),bt=this.valueSize;this._weightPrev=mt/(g-ct),this._weightNext=mt/(ft-$),this._offsetPrev=rt*bt,this._offsetNext=at*bt}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=o*ct,mt=ft-ct,bt=this._offsetPrev,Mt=this._offsetNext,St=this._weightPrev,It=this._weightNext,Bt=($-g)/(_e-g),Dt=Bt*Bt,Ut=Dt*Bt,Ft=-St*Ut+2*St*Dt-St*Bt,zt=(1+St)*Ut+(-1.5-2*St)*Dt+(-.5+St)*Bt+1,Kt=(-1-It)*Ut+(1.5+It)*Dt+.5*Bt,tn=It*Ut-It*Dt;for(let sn=0;sn!==ct;++sn)rt[sn]=Ft*at[bt+sn]+zt*at[mt+sn]+Kt*at[ft+sn]+tn*at[Mt+sn];return rt}}class CC extends VA{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=o*ct,mt=ft-ct,bt=($-g)/(_e-g),Mt=1-bt;for(let St=0;St!==ct;++St)rt[St]=at[mt+St]*Mt+at[ft+St]*bt;return rt}}class MC extends VA{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o){return this.copySampleValue_(o-1)}}class dv{constructor(o,g,$,_e){if(o===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(g===void 0||g.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+o);this.name=o,this.times=Gp(g,this.TimeBufferType),this.values=Gp($,this.ValueBufferType),this.setInterpolation(_e||this.DefaultInterpolation)}static toJSON(o){const g=o.constructor;let $;if(g.toJSON!==this.toJSON)$=g.toJSON(o);else{$={name:o.name,times:Gp(o.times,Array),values:Gp(o.values,Array)};const _e=o.getInterpolation();_e!==o.DefaultInterpolation&&($.interpolation=_e)}return $.type=o.ValueTypeName,$}InterpolantFactoryMethodDiscrete(o){return new MC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodLinear(o){return new CC(this.times,this.values,this.getValueSize(),o)}InterpolantFactoryMethodSmooth(o){return new vE(this.times,this.values,this.getValueSize(),o)}setInterpolation(o){let g;switch(o){case h0:g=this.InterpolantFactoryMethodDiscrete;break;case h_:g=this.InterpolantFactoryMethodLinear;break;case eu:g=this.InterpolantFactoryMethodSmooth}if(g===void 0){const $="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(o===this.DefaultInterpolation)throw new Error($);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",$),this}return this.createInterpolant=g,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return h0;case this.InterpolantFactoryMethodLinear:return h_;case this.InterpolantFactoryMethodSmooth:return eu}}getValueSize(){return this.values.length/this.times.length}shift(o){if(o!==0){const g=this.times;for(let $=0,_e=g.length;$!==_e;++$)g[$]+=o}return this}scale(o){if(o!==1){const g=this.times;for(let $=0,_e=g.length;$!==_e;++$)g[$]*=o}return this}trim(o,g){const $=this.times,_e=$.length;let rt=0,at=_e-1;for(;rt!==_e&&$[rt]<o;)++rt;for(;at!==-1&&$[at]>g;)--at;if(++at,rt!==0||at!==_e){rt>=at&&(at=Math.max(at,1),rt=at-1);const ct=this.getValueSize();this.times=om($,rt,at),this.values=om(this.values,rt*ct,at*ct)}return this}validate(){let o=!0;const g=this.getValueSize();g-Math.floor(g)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),o=!1);const $=this.times,_e=this.values,rt=$.length;rt===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),o=!1);let at=null;for(let ct=0;ct!==rt;ct++){const ft=$[ct];if(typeof ft=="number"&&isNaN(ft)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,ct,ft),o=!1;break}if(at!==null&&at>ft){console.error("THREE.KeyframeTrack: Out of order keys.",this,ct,ft,at),o=!1;break}at=ft}if(_e!==void 0&&El(_e))for(let ct=0,ft=_e.length;ct!==ft;++ct){const mt=_e[ct];if(isNaN(mt)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,ct,mt),o=!1;break}}return o}optimize(){const o=om(this.times),g=om(this.values),$=this.getValueSize(),_e=this.getInterpolation()===eu,rt=o.length-1;let at=1;for(let ct=1;ct<rt;++ct){let ft=!1;const mt=o[ct];if(mt!==o[ct+1]&&(ct!==1||mt!==o[0]))if(_e)ft=!0;else{const bt=ct*$,Mt=bt-$,St=bt+$;for(let It=0;It!==$;++It){const Bt=g[bt+It];if(Bt!==g[Mt+It]||Bt!==g[St+It]){ft=!0;break}}}if(ft){if(ct!==at){o[at]=o[ct];const bt=ct*$,Mt=at*$;for(let St=0;St!==$;++St)g[Mt+St]=g[bt+St]}++at}}if(rt>0){o[at]=o[rt];for(let ct=rt*$,ft=at*$,mt=0;mt!==$;++mt)g[ft+mt]=g[ct+mt];++at}return at!==o.length?(this.times=om(o,0,at),this.values=om(g,0,at*$)):(this.times=o,this.values=g),this}clone(){const o=om(this.times,0),g=om(this.values,0),$=new this.constructor(this.name,o,g);return $.createInterpolant=this.createInterpolant,$}}dv.prototype.TimeBufferType=Float32Array,dv.prototype.ValueBufferType=Float32Array,dv.prototype.DefaultInterpolation=h_;class F0 extends dv{}F0.prototype.ValueTypeName="bool",F0.prototype.ValueBufferType=Array,F0.prototype.DefaultInterpolation=h0,F0.prototype.InterpolantFactoryMethodLinear=void 0,F0.prototype.InterpolantFactoryMethodSmooth=void 0;class j0 extends dv{}j0.prototype.ValueTypeName="color";class z0 extends dv{}z0.prototype.ValueTypeName="number";class xx extends VA{constructor(o,g,$,_e){super(o,g,$,_e)}interpolate_(o,g,$,_e){const rt=this.resultBuffer,at=this.sampleValues,ct=this.valueSize,ft=($-g)/(_e-g);let mt=o*ct;for(let bt=mt+ct;mt!==bt;mt+=4)su.slerpFlat(rt,0,at,mt-ct,at,mt,ft);return rt}}class Hp extends dv{InterpolantFactoryMethodLinear(o){return new xx(this.times,this.values,this.getValueSize(),o)}}Hp.prototype.ValueTypeName="quaternion",Hp.prototype.DefaultInterpolation=h_,Hp.prototype.InterpolantFactoryMethodSmooth=void 0;class Dm extends dv{}Dm.prototype.ValueTypeName="string",Dm.prototype.ValueBufferType=Array,Dm.prototype.DefaultInterpolation=h0,Dm.prototype.InterpolantFactoryMethodLinear=void 0,Dm.prototype.InterpolantFactoryMethodSmooth=void 0;class Zy extends dv{}Zy.prototype.ValueTypeName="vector";class bx{constructor(o,g=-1,$,_e=No){this.name=o,this.tracks=$,this.duration=g,this.blendMode=_e,this.uuid=wu(),this.duration<0&&this.resetDuration()}static parse(o){const g=[],$=o.tracks,_e=1/(o.fps||1);for(let at=0,ct=$.length;at!==ct;++at)g.push(z_($[at]).scale(_e));const rt=new this(o.name,o.duration,g,o.blendMode);return rt.uuid=o.uuid,rt}static toJSON(o){const g=[],$=o.tracks,_e={name:o.name,duration:o.duration,tracks:g,uuid:o.uuid,blendMode:o.blendMode};for(let rt=0,at=$.length;rt!==at;++rt)g.push(dv.toJSON($[rt]));return _e}static CreateFromMorphTargetSequence(o,g,$,_e){const rt=g.length,at=[];for(let ct=0;ct<rt;ct++){let ft=[],mt=[];ft.push((ct+rt-1)%rt,ct,(ct+1)%rt),mt.push(0,1,0);const bt=FT(ft);ft=up(ft,1,bt),mt=up(mt,1,bt),_e||ft[0]!==0||(ft.push(rt),mt.push(mt[0])),at.push(new z0(".morphTargetInfluences["+g[ct].name+"]",ft,mt).scale(1/$))}return new this(o,-1,at)}static findByName(o,g){let $=o;if(!Array.isArray(o)){const _e=o;$=_e.geometry&&_e.geometry.animations||_e.animations}for(let _e=0;_e<$.length;_e++)if($[_e].name===g)return $[_e];return null}static CreateClipsFromMorphTargetSequences(o,g,$){const _e={},rt=/^([\w-]*?)([\d]+)$/;for(let ct=0,ft=o.length;ct<ft;ct++){const mt=o[ct],bt=mt.name.match(rt);if(bt&&bt.length>1){const Mt=bt[1];let St=_e[Mt];St||(_e[Mt]=St=[]),St.push(mt)}}const at=[];for(const ct in _e)at.push(this.CreateFromMorphTargetSequence(ct,_e[ct],g,$));return at}static parseAnimation(o,g){if(!o)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const $=function(bt,Mt,St,It,Bt){if(St.length!==0){const Dt=[],Ut=[];Pl(St,Dt,Ut,It),Dt.length!==0&&Bt.push(new bt(Mt,Dt,Ut))}},_e=[],rt=o.name||"default",at=o.fps||30,ct=o.blendMode;let ft=o.length||-1;const mt=o.hierarchy||[];for(let bt=0;bt<mt.length;bt++){const Mt=mt[bt].keys;if(Mt&&Mt.length!==0)if(Mt[0].morphTargets){const St={};let It;for(It=0;It<Mt.length;It++)if(Mt[It].morphTargets)for(let Bt=0;Bt<Mt[It].morphTargets.length;Bt++)St[Mt[It].morphTargets[Bt]]=-1;for(const Bt in St){const Dt=[],Ut=[];for(let Ft=0;Ft!==Mt[It].morphTargets.length;++Ft){const zt=Mt[It];Dt.push(zt.time),Ut.push(zt.morphTarget===Bt?1:0)}_e.push(new z0(".morphTargetInfluence["+Bt+"]",Dt,Ut))}ft=St.length*at}else{const St=".bones["+g[bt].name+"]";$(Zy,St+".position",Mt,"pos",_e),$(Hp,St+".quaternion",Mt,"rot",_e),$(Zy,St+".scale",Mt,"scl",_e)}}return _e.length===0?null:new this(rt,ft,_e,ct)}resetDuration(){let o=0;for(let g=0,$=this.tracks.length;g!==$;++g){const _e=this.tracks[g];o=Math.max(o,_e.times[_e.times.length-1])}return this.duration=o,this}trim(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].trim(0,this.duration);return this}validate(){let o=!0;for(let g=0;g<this.tracks.length;g++)o=o&&this.tracks[g].validate();return o}optimize(){for(let o=0;o<this.tracks.length;o++)this.tracks[o].optimize();return this}clone(){const o=[];for(let g=0;g<this.tracks.length;g++)o.push(this.tracks[g].clone());return new this.constructor(this.name,this.duration,o,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function z_(ut){if(ut.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const o=function(g){switch(g.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return z0;case"vector":case"vector2":case"vector3":case"vector4":return Zy;case"color":return j0;case"quaternion":return Hp;case"bool":case"boolean":return F0;case"string":return Dm}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+g)}(ut.type);if(ut.times===void 0){const g=[],$=[];Pl(ut.keys,g,$,"value"),ut.times=g,ut.values=$}return o.parse!==void 0?o.parse(ut):new o(ut.name,ut.times,ut.values,ut.interpolation)}const V0={enabled:!1,files:{},add:function(ut,o){this.enabled!==!1&&(this.files[ut]=o)},get:function(ut,o){return this.enabled===!1?o?Promise.resolve():void 0:o?Promise.resolve(this.files[ut]):this.files[ut]},remove:function(ut){delete this.files[ut]},clear:function(){this.files={}}};class Q0{constructor(o,g,$){const _e=this;let rt,at=!1,ct=0,ft=0;const mt=[];this.onStart=void 0,this.onLoad=o,this.onProgress=g,this.onError=$,this.itemStart=function(bt){ft++,at===!1&&_e.onStart!==void 0&&_e.onStart(bt,ct,ft),at=!0},this.itemEnd=function(bt){ct++,_e.onProgress!==void 0&&_e.onProgress(bt,ct,ft),ct===ft&&(at=!1,_e.onLoad!==void 0&&_e.onLoad())},this.itemError=function(bt){_e.onError!==void 0&&_e.onError(bt)},this.resolveURL=function(bt){return rt?rt(bt):bt},this.setURLModifier=function(bt){return rt=bt,this},this.addHandler=function(bt,Mt){return mt.push(bt,Mt),this},this.removeHandler=function(bt){const Mt=mt.indexOf(bt);return Mt!==-1&&mt.splice(Mt,2),this},this.getHandler=function(bt){for(let Mt=0,St=mt.length;Mt<St;Mt+=2){const It=mt[Mt],Bt=mt[Mt+1];if(It.global&&(It.lastIndex=0),It.test(bt))return Bt}return null}}}const QA=new Q0;class hu{constructor(o){this.manager=o!==void 0?o:QA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(o,g){const $=this;return new Promise(function(_e,rt){$.load(o,_e,g,rt)})}parse(){}setCrossOrigin(o){return this.crossOrigin=o,this}setWithCredentials(o){return this.withCredentials=o,this}setPath(o){return this.path=o,this}setResourcePath(o){return this.resourcePath=o,this}setRequestHeader(o){return this.requestHeader=o,this}}const Kl={};class gD extends Error{constructor(o,g){super(o),this.response=g}}class G0 extends hu{constructor(o){super(o),this.responseType="text"}load(o,g,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o),V0.get(o,this.responseType,this.mimeType).then(rt=>{if(rt!==void 0)return this.manager.itemStart(o),setTimeout(()=>{g&&g(rt),this.manager.itemEnd(o)},0),rt;if(Kl[o]!==void 0)return void Kl[o].push({onLoad:g,onProgress:$,onError:_e});Kl[o]=[],Kl[o].push({onLoad:g,onProgress:$,onError:_e});const at=new Request(o,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),ct=this.mimeType,ft=this.responseType;fetch(at).then(mt=>{if(mt.status===200||mt.status===0){if(mt.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||mt.body===void 0||mt.body.getReader===void 0)return mt;const bt=Kl[o],Mt=mt.body.getReader(),St=mt.headers.get("Content-Length"),It=St?parseInt(St):0,Bt=It!==0;let Dt=0;const Ut=new ReadableStream({start(Ft){(function zt(){Mt.read().then(({done:Kt,value:tn})=>{if(Kt)Ft.close();else{Dt+=tn.byteLength;const sn=new ProgressEvent("progress",{lengthComputable:Bt,loaded:Dt,total:It});for(let ln=0,kn=bt.length;ln<kn;ln++){const Ln=bt[ln];Ln.onProgress&&Ln.onProgress(sn)}Ft.enqueue(tn),zt()}})})()}});return new Response(Ut)}throw new gD(`fetch for "${mt.url}" responded with ${mt.status}: ${mt.statusText}`,mt)}).then(mt=>{switch(ft){case"arraybuffer":return mt.arrayBuffer();case"blob":return mt.blob();case"document":return mt.text().then(bt=>new DOMParser().parseFromString(bt,ct));case"json":return mt.json();default:if(ct===void 0)return mt.text();{const bt=/charset="?([^;"\s]*)"?/i.exec(ct),Mt=bt&&bt[1]?bt[1].toLowerCase():void 0,St=new TextDecoder(Mt);return mt.arrayBuffer().then(It=>St.decode(It))}}}).then(mt=>{V0.add(o,mt,this.responseType);const bt=Kl[o];delete Kl[o];for(let Mt=0,St=bt.length;Mt<St;Mt++){const It=bt[Mt];It.onLoad&&It.onLoad(mt)}}).catch(mt=>{const bt=Kl[o];if(bt===void 0)throw this.manager.itemError(o),mt;delete Kl[o];for(let Mt=0,St=bt.length;Mt<St;Mt++){const It=bt[Mt];It.onError&&It.onError(mt)}this.manager.itemError(o)}).finally(()=>{this.manager.itemEnd(o)}),this.manager.itemStart(o)})}setResponseType(o){return this.responseType=o,this}setMimeType(o){return this.mimeType=o,this}}class Ex extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new G0(this.manager);at.setPath(this.path),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g=[];for(let $=0;$<o.length;$++){const _e=bx.parse(o[$]);g.push(_e)}return g}}class hp extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=[],ct=new sx,ft=new G0(this.manager);ft.setPath(this.path),ft.setResponseType("arraybuffer"),ft.setRequestHeader(this.requestHeader),ft.setWithCredentials(rt.withCredentials);let mt=0;function bt(Mt){ft.load(o[Mt],function(St){const It=rt.parse(St,!0);at[Mt]={width:It.width,height:It.height,format:It.format,mipmaps:It.mipmaps},mt+=1,mt===6&&(It.mipmapCount===1&&(ct.minFilter=Ko),ct.image=at,ct.format=It.format,ct.needsUpdate=!0,g&&g(ct))},$,_e)}if(Array.isArray(o))for(let Mt=0,St=o.length;Mt<St;++Mt)bt(Mt);else ft.load(o,function(Mt){const St=rt.parse(Mt,!0);if(St.isCubemap){const It=St.mipmaps.length/St.mipmapCount;for(let Bt=0;Bt<It;Bt++){at[Bt]={mipmaps:[]};for(let Dt=0;Dt<St.mipmapCount;Dt++)at[Bt].mipmaps.push(St.mipmaps[Bt*St.mipmapCount+Dt]),at[Bt].format=St.format,at[Bt].width=St.width,at[Bt].height=St.height}ct.image=at}else ct.image.width=St.width,ct.image.height=St.height,ct.mipmaps=St.mipmaps;St.mipmapCount===1&&(ct.minFilter=Ko),ct.format=St.format,ct.needsUpdate=!0,g&&g(ct)},$,_e);return ct}}class $y extends hu{constructor(o){super(o)}load(o,g,$,_e){this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const rt=this,at=V0.get(o);if(at!==void 0)return rt.manager.itemStart(o),setTimeout(function(){g&&g(at),rt.manager.itemEnd(o)},0),at;const ct=w0("img");function ft(){bt(),V0.add(o,this),g&&g(this),rt.manager.itemEnd(o)}function mt(Mt){bt(),_e&&_e(Mt),rt.manager.itemError(o),rt.manager.itemEnd(o)}function bt(){ct.removeEventListener("load",ft,!1),ct.removeEventListener("error",mt,!1)}return ct.addEventListener("load",ft,!1),ct.addEventListener("error",mt,!1),o.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(ct.crossOrigin=this.crossOrigin),rt.manager.itemStart(o),ct.src=o,ct}}class TC extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=new ky,at=new $y(this.manager);at.setCrossOrigin(this.crossOrigin),at.setPath(this.path);let ct=0;function ft(mt){at.load(o[mt],function(bt){rt.images[mt]=bt,ct++,ct===6&&(rt.needsUpdate=!0,g&&g(rt))},void 0,_e)}for(let mt=0;mt<o.length;++mt)ft(mt);return rt}}class H0 extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new Qy,ct=new G0(this.manager);return ct.setResponseType("arraybuffer"),ct.setRequestHeader(this.requestHeader),ct.setPath(this.path),ct.setWithCredentials(rt.withCredentials),ct.load(o,function(ft){const mt=rt.parse(ft);mt&&(mt.image!==void 0?at.image=mt.image:mt.data!==void 0&&(at.image.width=mt.width,at.image.height=mt.height,at.image.data=mt.data,at.image.complete=!0),at.wrapS=mt.wrapS!==void 0?mt.wrapS:Oo,at.wrapT=mt.wrapT!==void 0?mt.wrapT:Oo,at.magFilter=mt.magFilter!==void 0?mt.magFilter:Ko,at.minFilter=mt.minFilter!==void 0?mt.minFilter:Ko,at.anisotropy=mt.anisotropy!==void 0?mt.anisotropy:1,mt.encoding!==void 0&&(at.encoding=mt.encoding),mt.flipY!==void 0&&(at.flipY=mt.flipY),mt.format!==void 0&&(at.format=mt.format),mt.type!==void 0&&(at.type=mt.type),mt.mipmaps!==void 0&&(at.mipmaps=mt.mipmaps,at.minFilter=vo),mt.mipmapCount===1&&(at.minFilter=Ko),mt.generateMipmaps!==void 0&&(at.generateMipmaps=mt.generateMipmaps),at.needsUpdate=!0,g&&g(at,mt))},$,_e),at}}class IC extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=new zl,at=new $y(this.manager);return at.setCrossOrigin(this.crossOrigin),at.setPath(this.path),at.load(o,function(ct){rt.image=ct,rt.needsUpdate=!0,g!==void 0&&g(rt)},$,_e),rt}}class qv extends Fs{constructor(o,g=1){super(),this.isLight=!0,this.type="Light",this.color=new ts(o),this.intensity=g}dispose(){}copy(o,g){return super.copy(o,g),this.color.copy(o.color),this.intensity=o.intensity,this}toJSON(o){const g=super.toJSON(o);return g.object.color=this.color.getHex(),g.object.intensity=this.intensity,this.groundColor!==void 0&&(g.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(g.object.distance=this.distance),this.angle!==void 0&&(g.object.angle=this.angle),this.decay!==void 0&&(g.object.decay=this.decay),this.penumbra!==void 0&&(g.object.penumbra=this.penumbra),this.shadow!==void 0&&(g.object.shadow=this.shadow.toJSON()),g}}class jT extends qv{constructor(o,g,$){super(o,$),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Fs.DefaultUp),this.updateMatrix(),this.groundColor=new ts(g)}copy(o,g){return super.copy(o,g),this.groundColor.copy(o.groundColor),this}}const DC=new Is,_E=new dn,AE=new dn;class Sx{constructor(o){this.camera=o,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Cr(512,512),this.map=null,this.mapPass=null,this.matrix=new Is,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new jw,this._frameExtents=new Cr(1,1),this._viewportCount=1,this._viewports=[new fo(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(o){const g=this.camera,$=this.matrix;_E.setFromMatrixPosition(o.matrixWorld),g.position.copy(_E),AE.setFromMatrixPosition(o.target.matrixWorld),g.lookAt(AE),g.updateMatrixWorld(),DC.multiplyMatrices(g.projectionMatrix,g.matrixWorldInverse),this._frustum.setFromProjectionMatrix(DC),$.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),$.multiply(g.projectionMatrix),$.multiply(g.matrixWorldInverse)}getViewport(o){return this._viewports[o]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(o){return this.camera=o.camera.clone(),this.bias=o.bias,this.normalBias=o.normalBias,this.radius=o.radius,this.mapSize.copy(o.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const o={};return this.bias!==0&&(o.bias=this.bias),this.normalBias!==0&&(o.normalBias=this.normalBias),this.radius!==1&&(o.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(o.mapSize=this.mapSize.toArray()),o.camera=this.camera.toJSON(!1).object,delete o.camera.matrix,o}}class Yv extends Sx{constructor(){super(new Su(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(o){const g=this.camera,$=2*_A*o.angle*this.focus,_e=this.mapSize.width/this.mapSize.height,rt=o.distance||g.far;$===g.fov&&_e===g.aspect&&rt===g.far||(g.fov=$,g.aspect=_e,g.far=rt,g.updateProjectionMatrix()),super.updateMatrices(o)}copy(o){return super.copy(o),this.focus=o.focus,this}}class PC extends qv{constructor(o,g,$=0,_e=Math.PI/3,rt=0,at=1){super(o,g),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Fs.DefaultUp),this.updateMatrix(),this.target=new Fs,this.distance=$,this.angle=_e,this.penumbra=rt,this.decay=at,this.map=null,this.shadow=new Yv}get power(){return this.intensity*Math.PI}set power(o){this.intensity=o/Math.PI}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.angle=o.angle,this.penumbra=o.penumbra,this.decay=o.decay,this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}const yE=new Is,Cx=new dn,Mx=new dn;class RC extends Sx{constructor(){super(new Su(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Cr(4,2),this._viewportCount=6,this._viewports=[new fo(2,1,1,1),new fo(0,1,1,1),new fo(3,1,1,1),new fo(1,1,1,1),new fo(3,0,1,1),new fo(1,0,1,1)],this._cubeDirections=[new dn(1,0,0),new dn(-1,0,0),new dn(0,0,1),new dn(0,0,-1),new dn(0,1,0),new dn(0,-1,0)],this._cubeUps=[new dn(0,1,0),new dn(0,1,0),new dn(0,1,0),new dn(0,1,0),new dn(0,0,1),new dn(0,0,-1)]}updateMatrices(o,g=0){const $=this.camera,_e=this.matrix,rt=o.distance||$.far;rt!==$.far&&($.far=rt,$.updateProjectionMatrix()),Cx.setFromMatrixPosition(o.matrixWorld),$.position.copy(Cx),Mx.copy($.position),Mx.add(this._cubeDirections[g]),$.up.copy(this._cubeUps[g]),$.lookAt(Mx),$.updateMatrixWorld(),_e.makeTranslation(-Cx.x,-Cx.y,-Cx.z),yE.multiplyMatrices($.projectionMatrix,$.matrixWorldInverse),this._frustum.setFromProjectionMatrix(yE)}}class zT extends qv{constructor(o,g,$=0,_e=1){super(o,g),this.isPointLight=!0,this.type="PointLight",this.distance=$,this.decay=_e,this.shadow=new RC}get power(){return 4*this.intensity*Math.PI}set power(o){this.intensity=o/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(o,g){return super.copy(o,g),this.distance=o.distance,this.decay=o.decay,this.shadow=o.shadow.clone(),this}}class wE extends Sx{constructor(){super(new C1(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class VT extends qv{constructor(o,g){super(o,g),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Fs.DefaultUp),this.updateMatrix(),this.target=new Fs,this.shadow=new wE}dispose(){this.shadow.dispose()}copy(o){return super.copy(o),this.target=o.target.clone(),this.shadow=o.shadow.clone(),this}}class QT extends qv{constructor(o,g){super(o,g),this.isAmbientLight=!0,this.type="AmbientLight"}}class GT extends qv{constructor(o,g,$=10,_e=10){super(o,g),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=$,this.height=_e}get power(){return this.intensity*this.width*this.height*Math.PI}set power(o){this.intensity=o/(this.width*this.height*Math.PI)}copy(o){return super.copy(o),this.width=o.width,this.height=o.height,this}toJSON(o){const g=super.toJSON(o);return g.object.width=this.width,g.object.height=this.height,g}}class Tx{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let o=0;o<9;o++)this.coefficients.push(new dn)}set(o){for(let g=0;g<9;g++)this.coefficients[g].copy(o[g]);return this}zero(){for(let o=0;o<9;o++)this.coefficients[o].set(0,0,0);return this}getAt(o,g){const $=o.x,_e=o.y,rt=o.z,at=this.coefficients;return g.copy(at[0]).multiplyScalar(.282095),g.addScaledVector(at[1],.488603*_e),g.addScaledVector(at[2],.488603*rt),g.addScaledVector(at[3],.488603*$),g.addScaledVector(at[4],$*_e*1.092548),g.addScaledVector(at[5],_e*rt*1.092548),g.addScaledVector(at[6],.315392*(3*rt*rt-1)),g.addScaledVector(at[7],$*rt*1.092548),g.addScaledVector(at[8],.546274*($*$-_e*_e)),g}getIrradianceAt(o,g){const $=o.x,_e=o.y,rt=o.z,at=this.coefficients;return g.copy(at[0]).multiplyScalar(.886227),g.addScaledVector(at[1],1.023328*_e),g.addScaledVector(at[2],1.023328*rt),g.addScaledVector(at[3],1.023328*$),g.addScaledVector(at[4],.858086*$*_e),g.addScaledVector(at[5],.858086*_e*rt),g.addScaledVector(at[6],.743125*rt*rt-.247708),g.addScaledVector(at[7],.858086*$*rt),g.addScaledVector(at[8],.429043*($*$-_e*_e)),g}add(o){for(let g=0;g<9;g++)this.coefficients[g].add(o.coefficients[g]);return this}addScaledSH(o,g){for(let $=0;$<9;$++)this.coefficients[$].addScaledVector(o.coefficients[$],g);return this}scale(o){for(let g=0;g<9;g++)this.coefficients[g].multiplyScalar(o);return this}lerp(o,g){for(let $=0;$<9;$++)this.coefficients[$].lerp(o.coefficients[$],g);return this}equals(o){for(let g=0;g<9;g++)if(!this.coefficients[g].equals(o.coefficients[g]))return!1;return!0}copy(o){return this.set(o.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(o,g=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].fromArray(o,g+3*_e);return this}toArray(o=[],g=0){const $=this.coefficients;for(let _e=0;_e<9;_e++)$[_e].toArray(o,g+3*_e);return o}static getBasisAt(o,g){const $=o.x,_e=o.y,rt=o.z;g[0]=.282095,g[1]=.488603*_e,g[2]=.488603*rt,g[3]=.488603*$,g[4]=1.092548*$*_e,g[5]=1.092548*_e*rt,g[6]=.315392*(3*rt*rt-1),g[7]=1.092548*$*rt,g[8]=.546274*($*$-_e*_e)}}class xE extends qv{constructor(o=new Tx,g=1){super(void 0,g),this.isLightProbe=!0,this.sh=o}copy(o){return super.copy(o),this.sh.copy(o.sh),this}fromJSON(o){return this.intensity=o.intensity,this.sh.fromArray(o.sh),this}toJSON(o){const g=super.toJSON(o);return g.object.sh=this.sh.toArray(),g}}class W0 extends hu{constructor(o){super(o),this.textures={}}load(o,g,$,_e){const rt=this,at=new G0(rt.manager);at.setPath(rt.path),at.setRequestHeader(rt.requestHeader),at.setWithCredentials(rt.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g=this.textures;function $(rt){return g[rt]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",rt),g[rt]}const _e=W0.createMaterialFromType(o.type);if(o.uuid!==void 0&&(_e.uuid=o.uuid),o.name!==void 0&&(_e.name=o.name),o.color!==void 0&&_e.color!==void 0&&_e.color.setHex(o.color),o.roughness!==void 0&&(_e.roughness=o.roughness),o.metalness!==void 0&&(_e.metalness=o.metalness),o.sheen!==void 0&&(_e.sheen=o.sheen),o.sheenColor!==void 0&&(_e.sheenColor=new ts().setHex(o.sheenColor)),o.sheenRoughness!==void 0&&(_e.sheenRoughness=o.sheenRoughness),o.emissive!==void 0&&_e.emissive!==void 0&&_e.emissive.setHex(o.emissive),o.specular!==void 0&&_e.specular!==void 0&&_e.specular.setHex(o.specular),o.specularIntensity!==void 0&&(_e.specularIntensity=o.specularIntensity),o.specularColor!==void 0&&_e.specularColor!==void 0&&_e.specularColor.setHex(o.specularColor),o.shininess!==void 0&&(_e.shininess=o.shininess),o.clearcoat!==void 0&&(_e.clearcoat=o.clearcoat),o.clearcoatRoughness!==void 0&&(_e.clearcoatRoughness=o.clearcoatRoughness),o.iridescence!==void 0&&(_e.iridescence=o.iridescence),o.iridescenceIOR!==void 0&&(_e.iridescenceIOR=o.iridescenceIOR),o.iridescenceThicknessRange!==void 0&&(_e.iridescenceThicknessRange=o.iridescenceThicknessRange),o.transmission!==void 0&&(_e.transmission=o.transmission),o.thickness!==void 0&&(_e.thickness=o.thickness),o.attenuationDistance!==void 0&&(_e.attenuationDistance=o.attenuationDistance),o.attenuationColor!==void 0&&_e.attenuationColor!==void 0&&_e.attenuationColor.setHex(o.attenuationColor),o.fog!==void 0&&(_e.fog=o.fog),o.flatShading!==void 0&&(_e.flatShading=o.flatShading),o.blending!==void 0&&(_e.blending=o.blending),o.combine!==void 0&&(_e.combine=o.combine),o.side!==void 0&&(_e.side=o.side),o.shadowSide!==void 0&&(_e.shadowSide=o.shadowSide),o.opacity!==void 0&&(_e.opacity=o.opacity),o.transparent!==void 0&&(_e.transparent=o.transparent),o.alphaTest!==void 0&&(_e.alphaTest=o.alphaTest),o.depthTest!==void 0&&(_e.depthTest=o.depthTest),o.depthWrite!==void 0&&(_e.depthWrite=o.depthWrite),o.colorWrite!==void 0&&(_e.colorWrite=o.colorWrite),o.stencilWrite!==void 0&&(_e.stencilWrite=o.stencilWrite),o.stencilWriteMask!==void 0&&(_e.stencilWriteMask=o.stencilWriteMask),o.stencilFunc!==void 0&&(_e.stencilFunc=o.stencilFunc),o.stencilRef!==void 0&&(_e.stencilRef=o.stencilRef),o.stencilFuncMask!==void 0&&(_e.stencilFuncMask=o.stencilFuncMask),o.stencilFail!==void 0&&(_e.stencilFail=o.stencilFail),o.stencilZFail!==void 0&&(_e.stencilZFail=o.stencilZFail),o.stencilZPass!==void 0&&(_e.stencilZPass=o.stencilZPass),o.wireframe!==void 0&&(_e.wireframe=o.wireframe),o.wireframeLinewidth!==void 0&&(_e.wireframeLinewidth=o.wireframeLinewidth),o.wireframeLinecap!==void 0&&(_e.wireframeLinecap=o.wireframeLinecap),o.wireframeLinejoin!==void 0&&(_e.wireframeLinejoin=o.wireframeLinejoin),o.rotation!==void 0&&(_e.rotation=o.rotation),o.linewidth!==1&&(_e.linewidth=o.linewidth),o.dashSize!==void 0&&(_e.dashSize=o.dashSize),o.gapSize!==void 0&&(_e.gapSize=o.gapSize),o.scale!==void 0&&(_e.scale=o.scale),o.polygonOffset!==void 0&&(_e.polygonOffset=o.polygonOffset),o.polygonOffsetFactor!==void 0&&(_e.polygonOffsetFactor=o.polygonOffsetFactor),o.polygonOffsetUnits!==void 0&&(_e.polygonOffsetUnits=o.polygonOffsetUnits),o.dithering!==void 0&&(_e.dithering=o.dithering),o.alphaToCoverage!==void 0&&(_e.alphaToCoverage=o.alphaToCoverage),o.premultipliedAlpha!==void 0&&(_e.premultipliedAlpha=o.premultipliedAlpha),o.visible!==void 0&&(_e.visible=o.visible),o.toneMapped!==void 0&&(_e.toneMapped=o.toneMapped),o.userData!==void 0&&(_e.userData=o.userData),o.vertexColors!==void 0&&(typeof o.vertexColors=="number"?_e.vertexColors=o.vertexColors>0:_e.vertexColors=o.vertexColors),o.uniforms!==void 0)for(const rt in o.uniforms){const at=o.uniforms[rt];switch(_e.uniforms[rt]={},at.type){case"t":_e.uniforms[rt].value=$(at.value);break;case"c":_e.uniforms[rt].value=new ts().setHex(at.value);break;case"v2":_e.uniforms[rt].value=new Cr().fromArray(at.value);break;case"v3":_e.uniforms[rt].value=new dn().fromArray(at.value);break;case"v4":_e.uniforms[rt].value=new fo().fromArray(at.value);break;case"m3":_e.uniforms[rt].value=new ru().fromArray(at.value);break;case"m4":_e.uniforms[rt].value=new Is().fromArray(at.value);break;default:_e.uniforms[rt].value=at.value}}if(o.defines!==void 0&&(_e.defines=o.defines),o.vertexShader!==void 0&&(_e.vertexShader=o.vertexShader),o.fragmentShader!==void 0&&(_e.fragmentShader=o.fragmentShader),o.glslVersion!==void 0&&(_e.glslVersion=o.glslVersion),o.extensions!==void 0)for(const rt in o.extensions)_e.extensions[rt]=o.extensions[rt];if(o.size!==void 0&&(_e.size=o.size),o.sizeAttenuation!==void 0&&(_e.sizeAttenuation=o.sizeAttenuation),o.map!==void 0&&(_e.map=$(o.map)),o.matcap!==void 0&&(_e.matcap=$(o.matcap)),o.alphaMap!==void 0&&(_e.alphaMap=$(o.alphaMap)),o.bumpMap!==void 0&&(_e.bumpMap=$(o.bumpMap)),o.bumpScale!==void 0&&(_e.bumpScale=o.bumpScale),o.normalMap!==void 0&&(_e.normalMap=$(o.normalMap)),o.normalMapType!==void 0&&(_e.normalMapType=o.normalMapType),o.normalScale!==void 0){let rt=o.normalScale;Array.isArray(rt)===!1&&(rt=[rt,rt]),_e.normalScale=new Cr().fromArray(rt)}return o.displacementMap!==void 0&&(_e.displacementMap=$(o.displacementMap)),o.displacementScale!==void 0&&(_e.displacementScale=o.displacementScale),o.displacementBias!==void 0&&(_e.displacementBias=o.displacementBias),o.roughnessMap!==void 0&&(_e.roughnessMap=$(o.roughnessMap)),o.metalnessMap!==void 0&&(_e.metalnessMap=$(o.metalnessMap)),o.emissiveMap!==void 0&&(_e.emissiveMap=$(o.emissiveMap)),o.emissiveIntensity!==void 0&&(_e.emissiveIntensity=o.emissiveIntensity),o.specularMap!==void 0&&(_e.specularMap=$(o.specularMap)),o.specularIntensityMap!==void 0&&(_e.specularIntensityMap=$(o.specularIntensityMap)),o.specularColorMap!==void 0&&(_e.specularColorMap=$(o.specularColorMap)),o.envMap!==void 0&&(_e.envMap=$(o.envMap)),o.envMapIntensity!==void 0&&(_e.envMapIntensity=o.envMapIntensity),o.reflectivity!==void 0&&(_e.reflectivity=o.reflectivity),o.refractionRatio!==void 0&&(_e.refractionRatio=o.refractionRatio),o.lightMap!==void 0&&(_e.lightMap=$(o.lightMap)),o.lightMapIntensity!==void 0&&(_e.lightMapIntensity=o.lightMapIntensity),o.aoMap!==void 0&&(_e.aoMap=$(o.aoMap)),o.aoMapIntensity!==void 0&&(_e.aoMapIntensity=o.aoMapIntensity),o.gradientMap!==void 0&&(_e.gradientMap=$(o.gradientMap)),o.clearcoatMap!==void 0&&(_e.clearcoatMap=$(o.clearcoatMap)),o.clearcoatRoughnessMap!==void 0&&(_e.clearcoatRoughnessMap=$(o.clearcoatRoughnessMap)),o.clearcoatNormalMap!==void 0&&(_e.clearcoatNormalMap=$(o.clearcoatNormalMap)),o.clearcoatNormalScale!==void 0&&(_e.clearcoatNormalScale=new Cr().fromArray(o.clearcoatNormalScale)),o.iridescenceMap!==void 0&&(_e.iridescenceMap=$(o.iridescenceMap)),o.iridescenceThicknessMap!==void 0&&(_e.iridescenceThicknessMap=$(o.iridescenceThicknessMap)),o.transmissionMap!==void 0&&(_e.transmissionMap=$(o.transmissionMap)),o.thicknessMap!==void 0&&(_e.thicknessMap=$(o.thicknessMap)),o.sheenColorMap!==void 0&&(_e.sheenColorMap=$(o.sheenColorMap)),o.sheenRoughnessMap!==void 0&&(_e.sheenRoughnessMap=$(o.sheenRoughnessMap)),_e}setTextures(o){return this.textures=o,this}static createMaterialFromType(o){return new{ShadowMaterial:gE,SpriteMaterial:Y1,RawShaderMaterial:NT,ShaderMaterial:tv,PointsMaterial:nE,MeshPhysicalMaterial:bC,MeshStandardMaterial:xC,MeshPhongMaterial:_x,MeshToonMaterial:UT,MeshNormalMaterial:Ax,MeshLambertMaterial:EC,MeshDepthMaterial:Kw,MeshDistanceMaterial:Fy,MeshBasicMaterial:Em,MeshMatcapMaterial:yx,LineDashedMaterial:SC,LineBasicMaterial:cp,Material:lu}[o]}}class Xv{static decodeText(o){if(typeof TextDecoder<"u")return new TextDecoder().decode(o);let g="";for(let $=0,_e=o.length;$<_e;$++)g+=String.fromCharCode(o[$]);try{return decodeURIComponent(escape(g))}catch{return g}}static extractUrlBase(o){const g=o.lastIndexOf("/");return g===-1?"./":o.slice(0,g+1)}static resolveURL(o,g){return typeof o!="string"||o===""?"":(/^https?:\/\//i.test(g)&&/^\//.test(o)&&(g=g.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(o)||/^data:.*,.*$/i.test(o)||/^blob:.*$/i.test(o)?o:g+o)}}class Wp extends ls{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(o){return super.copy(o),this.instanceCount=o.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const o=super.toJSON(this);return o.instanceCount=this.instanceCount,o.isInstancedBufferGeometry=!0,o}}class HT extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new G0(rt.manager);at.setPath(rt.path),at.setRequestHeader(rt.requestHeader),at.setWithCredentials(rt.withCredentials),at.load(o,function(ct){try{g(rt.parse(JSON.parse(ct)))}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}parse(o){const g={},$={};function _e(Mt,St){if(g[St]!==void 0)return g[St];const It=Mt.interleavedBuffers[St],Bt=function(Ft,zt){if($[zt]!==void 0)return $[zt];const Kt=Ft.arrayBuffers[zt],tn=new Uint32Array(Kt).buffer;return $[zt]=tn,tn}(Mt,It.buffer),Dt=y0(It.type,Bt),Ut=new q1(Dt,It.stride);return Ut.uuid=It.uuid,g[St]=Ut,Ut}const rt=o.isInstancedBufferGeometry?new Wp:new ls,at=o.data.index;if(at!==void 0){const Mt=y0(at.type,at.array);rt.setIndex(new Co(Mt,1))}const ct=o.data.attributes;for(const Mt in ct){const St=ct[Mt];let It;if(St.isInterleavedBufferAttribute){const Bt=_e(o.data,St.data);It=new Qv(Bt,St.itemSize,St.offset,St.normalized)}else{const Bt=y0(St.type,St.array);It=new(St.isInstancedBufferAttribute?OA:Co)(Bt,St.itemSize,St.normalized)}St.name!==void 0&&(It.name=St.name),St.usage!==void 0&&It.setUsage(St.usage),St.updateRange!==void 0&&(It.updateRange.offset=St.updateRange.offset,It.updateRange.count=St.updateRange.count),rt.setAttribute(Mt,It)}const ft=o.data.morphAttributes;if(ft)for(const Mt in ft){const St=ft[Mt],It=[];for(let Bt=0,Dt=St.length;Bt<Dt;Bt++){const Ut=St[Bt];let Ft;if(Ut.isInterleavedBufferAttribute){const zt=_e(o.data,Ut.data);Ft=new Qv(zt,Ut.itemSize,Ut.offset,Ut.normalized)}else{const zt=y0(Ut.type,Ut.array);Ft=new Co(zt,Ut.itemSize,Ut.normalized)}Ut.name!==void 0&&(Ft.name=Ut.name),It.push(Ft)}rt.morphAttributes[Mt]=It}o.data.morphTargetsRelative&&(rt.morphTargetsRelative=!0);const mt=o.data.groups||o.data.drawcalls||o.data.offsets;if(mt!==void 0)for(let Mt=0,St=mt.length;Mt!==St;++Mt){const It=mt[Mt];rt.addGroup(It.start,It.count,It.materialIndex)}const bt=o.data.boundingSphere;if(bt!==void 0){const Mt=new dn;bt.center!==void 0&&Mt.fromArray(bt.center),rt.boundingSphere=new Dp(Mt,bt.radius)}return o.name&&(rt.name=o.name),o.userData&&(rt.userData=o.userData),rt}}class BC extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=this.path===""?Xv.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||at;const ct=new G0(this.manager);ct.setPath(this.path),ct.setRequestHeader(this.requestHeader),ct.setWithCredentials(this.withCredentials),ct.load(o,function(ft){let mt=null;try{mt=JSON.parse(ft)}catch(Mt){return _e!==void 0&&_e(Mt),void console.error("THREE:ObjectLoader: Can't parse "+o+".",Mt.message)}const bt=mt.metadata;bt!==void 0&&bt.type!==void 0&&bt.type.toLowerCase()!=="geometry"?rt.parse(mt,g):console.error("THREE.ObjectLoader: Can't load "+o)},$,_e)}async loadAsync(o,g){const $=this.path===""?Xv.extractUrlBase(o):this.path;this.resourcePath=this.resourcePath||$;const _e=new G0(this.manager);_e.setPath(this.path),_e.setRequestHeader(this.requestHeader),_e.setWithCredentials(this.withCredentials);const rt=await _e.loadAsync(o,g),at=JSON.parse(rt),ct=at.metadata;if(ct===void 0||ct.type===void 0||ct.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+o);return await this.parseAsync(at)}parse(o,g){const $=this.parseAnimations(o.animations),_e=this.parseShapes(o.shapes),rt=this.parseGeometries(o.geometries,_e),at=this.parseImages(o.images,function(){g!==void 0&&g(mt)}),ct=this.parseTextures(o.textures,at),ft=this.parseMaterials(o.materials,ct),mt=this.parseObject(o.object,rt,ft,ct,$),bt=this.parseSkeletons(o.skeletons,mt);if(this.bindSkeletons(mt,bt),g!==void 0){let Mt=!1;for(const St in at)if(at[St].data instanceof HTMLImageElement){Mt=!0;break}Mt===!1&&g(mt)}return mt}async parseAsync(o){const g=this.parseAnimations(o.animations),$=this.parseShapes(o.shapes),_e=this.parseGeometries(o.geometries,$),rt=await this.parseImagesAsync(o.images),at=this.parseTextures(o.textures,rt),ct=this.parseMaterials(o.materials,at),ft=this.parseObject(o.object,_e,ct,at,g),mt=this.parseSkeletons(o.skeletons,ft);return this.bindSkeletons(ft,mt),ft}parseShapes(o){const g={};if(o!==void 0)for(let $=0,_e=o.length;$<_e;$++){const rt=new UA().fromJSON(o[$]);g[rt.uuid]=rt}return g}parseSkeletons(o,g){const $={},_e={};if(g.traverse(function(rt){rt.isBone&&(_e[rt.uuid]=rt)}),o!==void 0)for(let rt=0,at=o.length;rt<at;rt++){const ct=new $w().fromJSON(o[rt],_e);$[ct.uuid]=ct}return $}parseGeometries(o,g){const $={};if(o!==void 0){const _e=new HT;for(let rt=0,at=o.length;rt<at;rt++){let ct;const ft=o[rt];switch(ft.type){case"BufferGeometry":case"InstancedBufferGeometry":ct=_e.parse(ft);break;default:ft.type in Im?ct=Im[ft.type].fromJSON(ft,g):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${ft.type}"`)}ct.uuid=ft.uuid,ft.name!==void 0&&(ct.name=ft.name),ct.isBufferGeometry===!0&&ft.userData!==void 0&&(ct.userData=ft.userData),$[ft.uuid]=ct}}return $}parseMaterials(o,g){const $={},_e={};if(o!==void 0){const rt=new W0;rt.setTextures(g);for(let at=0,ct=o.length;at<ct;at++){const ft=o[at];$[ft.uuid]===void 0&&($[ft.uuid]=rt.parse(ft)),_e[ft.uuid]=$[ft.uuid]}}return _e}parseAnimations(o){const g={};if(o!==void 0)for(let $=0;$<o.length;$++){const _e=o[$],rt=bx.parse(_e);g[rt.uuid]=rt}return g}parseImages(o,g){const $=this,_e={};let rt;function at(ct){if(typeof ct=="string"){const ft=ct;return function(mt){return $.manager.itemStart(mt),rt.load(mt,function(){$.manager.itemEnd(mt)},void 0,function(){$.manager.itemError(mt),$.manager.itemEnd(mt)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ft)?ft:$.resourcePath+ft)}return ct.data?{data:y0(ct.type,ct.data),width:ct.width,height:ct.height,complete:!0}:null}if(o!==void 0&&o.length>0){const ct=new Q0(g);rt=new $y(ct),rt.setCrossOrigin(this.crossOrigin);for(let ft=0,mt=o.length;ft<mt;ft++){const bt=o[ft],Mt=bt.url;if(Array.isArray(Mt)){const St=[];for(let It=0,Bt=Mt.length;It<Bt;It++){const Dt=at(Mt[It]);Dt!==null&&(Dt instanceof HTMLImageElement?St.push(Dt):St.push(new Qy(Dt.data,Dt.width,Dt.height)))}_e[bt.uuid]=new x0(St)}else{const St=at(bt.url);_e[bt.uuid]=new x0(St)}}}return _e}async parseImagesAsync(o){const g=this,$={};let _e;async function rt(at){if(typeof at=="string"){const ct=at,ft=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ct)?ct:g.resourcePath+ct;return await _e.loadAsync(ft)}return at.data?{data:y0(at.type,at.data),width:at.width,height:at.height,complete:!0}:null}if(o!==void 0&&o.length>0){_e=new $y(this.manager),_e.setCrossOrigin(this.crossOrigin);for(let at=0,ct=o.length;at<ct;at++){const ft=o[at],mt=ft.url;if(Array.isArray(mt)){const bt=[];for(let Mt=0,St=mt.length;Mt<St;Mt++){const It=mt[Mt],Bt=await rt(It);Bt!==null&&(Bt instanceof HTMLImageElement?bt.push(Bt):bt.push(new Qy(Bt.data,Bt.width,Bt.height)))}$[ft.uuid]=new x0(bt)}else{const bt=await rt(ft.url);$[ft.uuid]=new x0(bt)}}}return $}parseTextures(o,g){function $(rt,at){return typeof rt=="number"?rt:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",rt),at[rt])}const _e={};if(o!==void 0)for(let rt=0,at=o.length;rt<at;rt++){const ct=o[rt];ct.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',ct.uuid),g[ct.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",ct.image);const ft=g[ct.image],mt=ft?ft.data:void 0;let bt;Array.isArray(mt)?(bt=new ky,mt.length===6&&(bt.needsUpdate=!0)):(bt=mt&&mt.data?new Qy:new zl,mt&&mt.complete&&(bt.needsUpdate=!0)),bt.source=ft,bt.uuid=ct.uuid,ct.name!==void 0&&(bt.name=ct.name),ct.mapping!==void 0&&(bt.mapping=$(ct.mapping,vD)),ct.offset!==void 0&&bt.offset.fromArray(ct.offset),ct.repeat!==void 0&&bt.repeat.fromArray(ct.repeat),ct.center!==void 0&&bt.center.fromArray(ct.center),ct.rotation!==void 0&&(bt.rotation=ct.rotation),ct.wrap!==void 0&&(bt.wrapS=$(ct.wrap[0],bE),bt.wrapT=$(ct.wrap[1],bE)),ct.format!==void 0&&(bt.format=ct.format),ct.type!==void 0&&(bt.type=ct.type),ct.encoding!==void 0&&(bt.encoding=ct.encoding),ct.minFilter!==void 0&&(bt.minFilter=$(ct.minFilter,WT)),ct.magFilter!==void 0&&(bt.magFilter=$(ct.magFilter,WT)),ct.anisotropy!==void 0&&(bt.anisotropy=ct.anisotropy),ct.flipY!==void 0&&(bt.flipY=ct.flipY),ct.premultiplyAlpha!==void 0&&(bt.premultiplyAlpha=ct.premultiplyAlpha),ct.unpackAlignment!==void 0&&(bt.unpackAlignment=ct.unpackAlignment),ct.userData!==void 0&&(bt.userData=ct.userData),_e[ct.uuid]=bt}return _e}parseObject(o,g,$,_e,rt){let at,ct,ft;function mt(St){return g[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",St),g[St]}function bt(St){if(St!==void 0){if(Array.isArray(St)){const It=[];for(let Bt=0,Dt=St.length;Bt<Dt;Bt++){const Ut=St[Bt];$[Ut]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",Ut),It.push($[Ut])}return It}return $[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",St),$[St]}}function Mt(St){return _e[St]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",St),_e[St]}switch(o.type){case"Scene":at=new yT,o.background!==void 0&&(Number.isInteger(o.background)?at.background=new ts(o.background):at.background=Mt(o.background)),o.environment!==void 0&&(at.environment=Mt(o.environment)),o.fog!==void 0&&(o.fog.type==="Fog"?at.fog=new jy(o.fog.color,o.fog.near,o.fog.far):o.fog.type==="FogExp2"&&(at.fog=new B_(o.fog.color,o.fog.density)));break;case"PerspectiveCamera":at=new Su(o.fov,o.aspect,o.near,o.far),o.focus!==void 0&&(at.focus=o.focus),o.zoom!==void 0&&(at.zoom=o.zoom),o.filmGauge!==void 0&&(at.filmGauge=o.filmGauge),o.filmOffset!==void 0&&(at.filmOffset=o.filmOffset),o.view!==void 0&&(at.view=Object.assign({},o.view));break;case"OrthographicCamera":at=new C1(o.left,o.right,o.top,o.bottom,o.near,o.far),o.zoom!==void 0&&(at.zoom=o.zoom),o.view!==void 0&&(at.view=Object.assign({},o.view));break;case"AmbientLight":at=new QT(o.color,o.intensity);break;case"DirectionalLight":at=new VT(o.color,o.intensity);break;case"PointLight":at=new zT(o.color,o.intensity,o.distance,o.decay);break;case"RectAreaLight":at=new GT(o.color,o.intensity,o.width,o.height);break;case"SpotLight":at=new PC(o.color,o.intensity,o.distance,o.angle,o.penumbra,o.decay);break;case"HemisphereLight":at=new jT(o.color,o.groundColor,o.intensity);break;case"LightProbe":at=new xE().fromJSON(o);break;case"SkinnedMesh":ct=mt(o.geometry),ft=bt(o.material),at=new rC(ct,ft),o.bindMode!==void 0&&(at.bindMode=o.bindMode),o.bindMatrix!==void 0&&at.bindMatrix.fromArray(o.bindMatrix),o.skeleton!==void 0&&(at.skeleton=o.skeleton);break;case"Mesh":ct=mt(o.geometry),ft=bt(o.material),at=new cu(ct,ft);break;case"InstancedMesh":ct=mt(o.geometry),ft=bt(o.material);const St=o.count,It=o.instanceMatrix,Bt=o.instanceColor;at=new $1(ct,ft,St),at.instanceMatrix=new OA(new Float32Array(It.array),16),Bt!==void 0&&(at.instanceColor=new OA(new Float32Array(Bt.array),Bt.itemSize));break;case"LOD":at=new Vy;break;case"Line":at=new Hv(mt(o.geometry),bt(o.material));break;case"LineLoop":at=new Gy(mt(o.geometry),bt(o.material));break;case"LineSegments":at=new Wv(mt(o.geometry),bt(o.material));break;case"PointCloud":case"Points":at=new sE(mt(o.geometry),bt(o.material));break;case"Sprite":at=new J1(bt(o.material));break;case"Group":at=new B0;break;case"Bone":at=new sC;break;default:at=new Fs}if(at.uuid=o.uuid,o.name!==void 0&&(at.name=o.name),o.matrix!==void 0?(at.matrix.fromArray(o.matrix),o.matrixAutoUpdate!==void 0&&(at.matrixAutoUpdate=o.matrixAutoUpdate),at.matrixAutoUpdate&&at.matrix.decompose(at.position,at.quaternion,at.scale)):(o.position!==void 0&&at.position.fromArray(o.position),o.rotation!==void 0&&at.rotation.fromArray(o.rotation),o.quaternion!==void 0&&at.quaternion.fromArray(o.quaternion),o.scale!==void 0&&at.scale.fromArray(o.scale)),o.castShadow!==void 0&&(at.castShadow=o.castShadow),o.receiveShadow!==void 0&&(at.receiveShadow=o.receiveShadow),o.shadow&&(o.shadow.bias!==void 0&&(at.shadow.bias=o.shadow.bias),o.shadow.normalBias!==void 0&&(at.shadow.normalBias=o.shadow.normalBias),o.shadow.radius!==void 0&&(at.shadow.radius=o.shadow.radius),o.shadow.mapSize!==void 0&&at.shadow.mapSize.fromArray(o.shadow.mapSize),o.shadow.camera!==void 0&&(at.shadow.camera=this.parseObject(o.shadow.camera))),o.visible!==void 0&&(at.visible=o.visible),o.frustumCulled!==void 0&&(at.frustumCulled=o.frustumCulled),o.renderOrder!==void 0&&(at.renderOrder=o.renderOrder),o.userData!==void 0&&(at.userData=o.userData),o.layers!==void 0&&(at.layers.mask=o.layers),o.children!==void 0){const St=o.children;for(let It=0;It<St.length;It++)at.add(this.parseObject(St[It],g,$,_e,rt))}if(o.animations!==void 0){const St=o.animations;for(let It=0;It<St.length;It++){const Bt=St[It];at.animations.push(rt[Bt])}}if(o.type==="LOD"){o.autoUpdate!==void 0&&(at.autoUpdate=o.autoUpdate);const St=o.levels;for(let It=0;It<St.length;It++){const Bt=St[It],Dt=at.getObjectByProperty("uuid",Bt.object);Dt!==void 0&&at.addLevel(Dt,Bt.distance)}}return at}bindSkeletons(o,g){Object.keys(g).length!==0&&o.traverse(function($){if($.isSkinnedMesh===!0&&$.skeleton!==void 0){const _e=g[$.skeleton];_e===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",$.skeleton):$.bind(_e,$.bindMatrix)}})}}const vD={UVMapping:vu,CubeReflectionMapping:ba,CubeRefractionMapping:Ro,EquirectangularReflectionMapping:Gl,EquirectangularRefractionMapping:To,CubeUVReflectionMapping:Wu},bE={RepeatWrapping:Pu,ClampToEdgeWrapping:Oo,MirroredRepeatWrapping:Yp},WT={NearestFilter:Yo,NearestMipmapNearestFilter:_u,NearestMipmapLinearFilter:Xo,LinearFilter:Ko,LinearMipmapNearestFilter:Gm,LinearMipmapLinearFilter:vo};class kC extends hu{constructor(o){super(o),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(o){return this.options=o,this}load(o,g,$,_e){o===void 0&&(o=""),this.path!==void 0&&(o=this.path+o),o=this.manager.resolveURL(o);const rt=this,at=V0.get(o);if(at!==void 0)return rt.manager.itemStart(o),setTimeout(function(){g&&g(at),rt.manager.itemEnd(o)},0),at;const ct={};ct.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",ct.headers=this.requestHeader,fetch(o,ct).then(function(ft){return ft.blob()}).then(function(ft){return createImageBitmap(ft,Object.assign(rt.options,{colorSpaceConversion:"none"}))}).then(function(ft){V0.add(o,ft),g&&g(ft),rt.manager.itemEnd(o)}).catch(function(ft){_e&&_e(ft),rt.manager.itemError(o),rt.manager.itemEnd(o)}),rt.manager.itemStart(o)}}let EE;const Ix={getContext:function(){return EE===void 0&&(EE=new(window.AudioContext||window.webkitAudioContext)),EE},setContext:function(ut){EE=ut}};class _D extends hu{constructor(o){super(o)}load(o,g,$,_e){const rt=this,at=new G0(this.manager);at.setResponseType("arraybuffer"),at.setPath(this.path),at.setRequestHeader(this.requestHeader),at.setWithCredentials(this.withCredentials),at.load(o,function(ct){try{const ft=ct.slice(0);Ix.getContext().decodeAudioData(ft,function(mt){g(mt)})}catch(ft){_e?_e(ft):console.error(ft),rt.manager.itemError(o)}},$,_e)}}class LC extends xE{constructor(o,g,$=1){super(void 0,$),this.isHemisphereLightProbe=!0;const _e=new ts().set(o),rt=new ts().set(g),at=new dn(_e.r,_e.g,_e.b),ct=new dn(rt.r,rt.g,rt.b),ft=Math.sqrt(Math.PI),mt=ft*Math.sqrt(.75);this.sh.coefficients[0].copy(at).add(ct).multiplyScalar(ft),this.sh.coefficients[1].copy(at).sub(ct).multiplyScalar(mt)}}class SE extends xE{constructor(o,g=1){super(void 0,g),this.isAmbientLightProbe=!0;const $=new ts().set(o);this.sh.coefficients[0].set($.r,$.g,$.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const ew=new Is,CE=new Is,q0=new Is;class GA{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Su,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Su,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(o){const g=this._cache;if(g.focus!==o.focus||g.fov!==o.fov||g.aspect!==o.aspect*this.aspect||g.near!==o.near||g.far!==o.far||g.zoom!==o.zoom||g.eyeSep!==this.eyeSep){g.focus=o.focus,g.fov=o.fov,g.aspect=o.aspect*this.aspect,g.near=o.near,g.far=o.far,g.zoom=o.zoom,g.eyeSep=this.eyeSep,q0.copy(o.projectionMatrix);const $=g.eyeSep/2,_e=$*g.near/g.focus,rt=g.near*Math.tan(A0*g.fov*.5)/g.zoom;let at,ct;CE.elements[12]=-$,ew.elements[12]=$,at=-rt*g.aspect+_e,ct=rt*g.aspect+_e,q0.elements[0]=2*g.near/(ct-at),q0.elements[8]=(ct+at)/(ct-at),this.cameraL.projectionMatrix.copy(q0),at=-rt*g.aspect-_e,ct=rt*g.aspect-_e,q0.elements[0]=2*g.near/(ct-at),q0.elements[8]=(ct+at)/(ct-at),this.cameraR.projectionMatrix.copy(q0)}this.cameraL.matrixWorld.copy(o.matrixWorld).multiply(CE),this.cameraR.matrixWorld.copy(o.matrixWorld).multiply(ew)}}class ME{constructor(o=!0){this.autoStart=o,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=qT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let o=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const g=qT();o=(g-this.oldTime)/1e3,this.oldTime=g,this.elapsedTime+=o}return o}}function qT(){return(typeof performance>"u"?Date:performance).now()}const V_=new dn,Y0=new su,AD=new dn,ep=new dn;class YT extends Fs{constructor(){super(),this.type="AudioListener",this.context=Ix.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ME}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(o){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=o,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}updateMatrixWorld(o){super.updateMatrixWorld(o);const g=this.context.listener,$=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(V_,Y0,AD),ep.set(0,0,-1).applyQuaternion(Y0),g.positionX){const _e=this.context.currentTime+this.timeDelta;g.positionX.linearRampToValueAtTime(V_.x,_e),g.positionY.linearRampToValueAtTime(V_.y,_e),g.positionZ.linearRampToValueAtTime(V_.z,_e),g.forwardX.linearRampToValueAtTime(ep.x,_e),g.forwardY.linearRampToValueAtTime(ep.y,_e),g.forwardZ.linearRampToValueAtTime(ep.z,_e),g.upX.linearRampToValueAtTime($.x,_e),g.upY.linearRampToValueAtTime($.y,_e),g.upZ.linearRampToValueAtTime($.z,_e)}else g.setPosition(V_.x,V_.y,V_.z),g.setOrientation(ep.x,ep.y,ep.z,$.x,$.y,$.z)}}class X0 extends Fs{constructor(o){super(),this.type="Audio",this.listener=o,this.context=o.context,this.gain=this.context.createGain(),this.gain.connect(o.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(o){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=o,this.connect(),this}setMediaElementSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(o),this.connect(),this}setMediaStreamSource(o){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(o),this.connect(),this}setBuffer(o){return this.buffer=o,this.sourceType="buffer",this.autoplay&&this.play(),this}play(o=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+o;const g=this.context.createBufferSource();return g.buffer=this.buffer,g.loop=this.loop,g.loopStart=this.loopStart,g.loopEnd=this.loopEnd,g.onended=this.onEnded.bind(this),g.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=g,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].connect(this.filters[o]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let o=1,g=this.filters.length;o<g;o++)this.filters[o-1].disconnect(this.filters[o]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(o){return o||(o=[]),this._connected===!0?(this.disconnect(),this.filters=o.slice(),this.connect()):this.filters=o.slice(),this}setDetune(o){if(this.detune=o,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(o){return this.setFilters(o?[o]:[])}setPlaybackRate(o){if(this.hasPlaybackControl!==!1)return this.playbackRate=o,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(o){if(this.hasPlaybackControl!==!1)return this.loop=o,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(o){return this.loopStart=o,this}setLoopEnd(o){return this.loopEnd=o,this}getVolume(){return this.gain.gain.value}setVolume(o){return this.gain.gain.setTargetAtTime(o,this.context.currentTime,.01),this}}const Q_=new dn,TE=new su,Dx=new dn,pv=new dn;class XT extends X0{constructor(o){super(o),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(o){return this.panner.refDistance=o,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(o){return this.panner.rolloffFactor=o,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(o){return this.panner.distanceModel=o,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(o){return this.panner.maxDistance=o,this}setDirectionalCone(o,g,$){return this.panner.coneInnerAngle=o,this.panner.coneOuterAngle=g,this.panner.coneOuterGain=$,this}updateMatrixWorld(o){if(super.updateMatrixWorld(o),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Q_,TE,Dx),pv.set(0,0,1).applyQuaternion(TE);const g=this.panner;if(g.positionX){const $=this.context.currentTime+this.listener.timeDelta;g.positionX.linearRampToValueAtTime(Q_.x,$),g.positionY.linearRampToValueAtTime(Q_.y,$),g.positionZ.linearRampToValueAtTime(Q_.z,$),g.orientationX.linearRampToValueAtTime(pv.x,$),g.orientationY.linearRampToValueAtTime(pv.y,$),g.orientationZ.linearRampToValueAtTime(pv.z,$)}else g.setPosition(Q_.x,Q_.y,Q_.z),g.setOrientation(pv.x,pv.y,pv.z)}}class G_{constructor(o,g=2048){this.analyser=o.context.createAnalyser(),this.analyser.fftSize=g,this.data=new Uint8Array(this.analyser.frequencyBinCount),o.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let o=0;const g=this.getFrequencyData();for(let $=0;$<g.length;$++)o+=g[$];return o/g.length}}class Px{constructor(o,g,$){let _e,rt,at;switch(this.binding=o,this.valueSize=$,g){case"quaternion":_e=this._slerp,rt=this._slerpAdditive,at=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*$),this._workIndex=5;break;case"string":case"bool":_e=this._select,rt=this._select,at=this._setAdditiveIdentityOther,this.buffer=new Array(5*$);break;default:_e=this._lerp,rt=this._lerpAdditive,at=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*$)}this._mixBufferRegion=_e,this._mixBufferRegionAdditive=rt,this._setIdentity=at,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(o,g){const $=this.buffer,_e=this.valueSize,rt=o*_e+_e;let at=this.cumulativeWeight;if(at===0){for(let ct=0;ct!==_e;++ct)$[rt+ct]=$[ct];at=g}else{at+=g;const ct=g/at;this._mixBufferRegion($,rt,0,ct,_e)}this.cumulativeWeight=at}accumulateAdditive(o){const g=this.buffer,$=this.valueSize,_e=$*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(g,_e,0,o,$),this.cumulativeWeightAdditive+=o}apply(o){const g=this.valueSize,$=this.buffer,_e=o*g+g,rt=this.cumulativeWeight,at=this.cumulativeWeightAdditive,ct=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,rt<1){const ft=g*this._origIndex;this._mixBufferRegion($,_e,ft,1-rt,g)}at>0&&this._mixBufferRegionAdditive($,_e,this._addIndex*g,1,g);for(let ft=g,mt=g+g;ft!==mt;++ft)if($[ft]!==$[ft+g]){ct.setValue($,_e);break}}saveOriginalState(){const o=this.binding,g=this.buffer,$=this.valueSize,_e=$*this._origIndex;o.getValue(g,_e);for(let rt=$,at=_e;rt!==at;++rt)g[rt]=g[_e+rt%$];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const o=3*this.valueSize;this.binding.setValue(this.buffer,o)}_setAdditiveIdentityNumeric(){const o=this._addIndex*this.valueSize,g=o+this.valueSize;for(let $=o;$<g;$++)this.buffer[$]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const o=this._origIndex*this.valueSize,g=this._addIndex*this.valueSize;for(let $=0;$<this.valueSize;$++)this.buffer[g+$]=this.buffer[o+$]}_select(o,g,$,_e,rt){if(_e>=.5)for(let at=0;at!==rt;++at)o[g+at]=o[$+at]}_slerp(o,g,$,_e){su.slerpFlat(o,g,o,g,o,$,_e)}_slerpAdditive(o,g,$,_e,rt){const at=this._workIndex*rt;su.multiplyQuaternionsFlat(o,at,o,g,o,$),su.slerpFlat(o,g,o,g,o,at,_e)}_lerp(o,g,$,_e,rt){const at=1-_e;for(let ct=0;ct!==rt;++ct){const ft=g+ct;o[ft]=o[ft]*at+o[$+ct]*_e}}_lerpAdditive(o,g,$,_e,rt){for(let at=0;at!==rt;++at){const ct=g+at;o[ct]=o[ct]+o[$+at]*_e}}}const Rx=new RegExp("[\\[\\]\\.:\\/]","g"),tw="[^\\[\\]\\.:\\/]",nw="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",IE=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",tw)+/(WCOD+)?/.source.replace("WCOD",nw)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",tw)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",tw)+"$"),Bx=["material","materials","bones","map"];class ao{constructor(o,g,$){this.path=g,this.parsedPath=$||ao.parseTrackName(g),this.node=ao.findNode(o,this.parsedPath.nodeName)||o,this.rootNode=o,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(o,g,$){return o&&o.isAnimationObjectGroup?new ao.Composite(o,g,$):new ao(o,g,$)}static sanitizeNodeName(o){return o.replace(/\s/g,"_").replace(Rx,"")}static parseTrackName(o){const g=IE.exec(o);if(g===null)throw new Error("PropertyBinding: Cannot parse trackName: "+o);const $={nodeName:g[2],objectName:g[3],objectIndex:g[4],propertyName:g[5],propertyIndex:g[6]},_e=$.nodeName&&$.nodeName.lastIndexOf(".");if(_e!==void 0&&_e!==-1){const rt=$.nodeName.substring(_e+1);Bx.indexOf(rt)!==-1&&($.nodeName=$.nodeName.substring(0,_e),$.objectName=rt)}if($.propertyName===null||$.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+o);return $}static findNode(o,g){if(g===void 0||g===""||g==="."||g===-1||g===o.name||g===o.uuid)return o;if(o.skeleton){const $=o.skeleton.getBoneByName(g);if($!==void 0)return $}if(o.children){const $=function(rt){for(let at=0;at<rt.length;at++){const ct=rt[at];if(ct.name===g||ct.uuid===g)return ct;const ft=$(ct.children);if(ft)return ft}return null},_e=$(o.children);if(_e)return _e}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(o,g){o[g]=this.targetObject[this.propertyName]}_getValue_array(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)o[g++]=$[_e]}_getValue_arrayElement(o,g){o[g]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(o,g){this.resolvedProperty.toArray(o,g)}_setValue_direct(o,g){this.targetObject[this.propertyName]=o[g]}_setValue_direct_setNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(o,g){this.targetObject[this.propertyName]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++]}_setValue_array_setNeedsUpdate(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(o,g){const $=this.resolvedProperty;for(let _e=0,rt=$.length;_e!==rt;++_e)$[_e]=o[g++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(o,g){this.resolvedProperty[this.propertyIndex]=o[g]}_setValue_arrayElement_setNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty[this.propertyIndex]=o[g],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(o,g){this.resolvedProperty.fromArray(o,g)}_setValue_fromArray_setNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(o,g){this.resolvedProperty.fromArray(o,g),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(o,g){this.bind(),this.getValue(o,g)}_setValue_unbound(o,g){this.bind(),this.setValue(o,g)}bind(){let o=this.node;const g=this.parsedPath,$=g.objectName,_e=g.propertyName;let rt=g.propertyIndex;if(o||(o=ao.findNode(this.rootNode,g.nodeName)||this.rootNode,this.node=o),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!o)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if($){let mt=g.objectIndex;switch($){case"materials":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);o=o.material.materials;break;case"bones":if(!o.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);o=o.skeleton.bones;for(let bt=0;bt<o.length;bt++)if(o[bt].name===mt){mt=bt;break}break;case"map":if(!o.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!o.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);o=o.material.map;break;default:if(o[$]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);o=o[$]}if(mt!==void 0){if(o[mt]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,o);o=o[mt]}}const at=o[_e];if(at===void 0){const mt=g.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+mt+"."+_e+" but it wasn't found.",o)}let ct=this.Versioning.None;this.targetObject=o,o.needsUpdate!==void 0?ct=this.Versioning.NeedsUpdate:o.matrixWorldNeedsUpdate!==void 0&&(ct=this.Versioning.MatrixWorldNeedsUpdate);let ft=this.BindingType.Direct;if(rt!==void 0){if(_e==="morphTargetInfluences"){if(!o.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!o.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);o.morphTargetDictionary[rt]!==void 0&&(rt=o.morphTargetDictionary[rt])}ft=this.BindingType.ArrayElement,this.resolvedProperty=at,this.propertyIndex=rt}else at.fromArray!==void 0&&at.toArray!==void 0?(ft=this.BindingType.HasFromToArray,this.resolvedProperty=at):Array.isArray(at)?(ft=this.BindingType.EntireArray,this.resolvedProperty=at):this.propertyName=_e;this.getValue=this.GetterByBindingType[ft],this.setValue=this.SetterByBindingTypeAndVersioning[ft][ct]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ao.Composite=class{constructor(ut,o,g){const $=g||ao.parseTrackName(o);this._targetGroup=ut,this._bindings=ut.subscribe_(o,$)}getValue(ut,o){this.bind();const g=this._targetGroup.nCachedObjects_,$=this._bindings[g];$!==void 0&&$.getValue(ut,o)}setValue(ut,o){const g=this._bindings;for(let $=this._targetGroup.nCachedObjects_,_e=g.length;$!==_e;++$)g[$].setValue(ut,o)}bind(){const ut=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=ut.length;o!==g;++o)ut[o].bind()}unbind(){const ut=this._bindings;for(let o=this._targetGroup.nCachedObjects_,g=ut.length;o!==g;++o)ut[o].unbind()}},ao.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},ao.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},ao.prototype.GetterByBindingType=[ao.prototype._getValue_direct,ao.prototype._getValue_array,ao.prototype._getValue_arrayElement,ao.prototype._getValue_toArray],ao.prototype.SetterByBindingTypeAndVersioning=[[ao.prototype._setValue_direct,ao.prototype._setValue_direct_setNeedsUpdate,ao.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ao.prototype._setValue_array,ao.prototype._setValue_array_setNeedsUpdate,ao.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ao.prototype._setValue_arrayElement,ao.prototype._setValue_arrayElement_setNeedsUpdate,ao.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ao.prototype._setValue_fromArray,ao.prototype._setValue_fromArray_setNeedsUpdate,ao.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class HA{constructor(){this.isAnimationObjectGroup=!0,this.uuid=wu(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const o={};this._indicesByUUID=o;for(let $=0,_e=arguments.length;$!==_e;++$)o[arguments[$].uuid]=$;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const g=this;this.stats={objects:{get total(){return g._objects.length},get inUse(){return this.total-g.nCachedObjects_}},get bindingsPerObject(){return g._bindings.length}}}add(){const o=this._objects,g=this._indicesByUUID,$=this._paths,_e=this._parsedPaths,rt=this._bindings,at=rt.length;let ct,ft=o.length,mt=this.nCachedObjects_;for(let bt=0,Mt=arguments.length;bt!==Mt;++bt){const St=arguments[bt],It=St.uuid;let Bt=g[It];if(Bt===void 0){Bt=ft++,g[It]=Bt,o.push(St);for(let Dt=0,Ut=at;Dt!==Ut;++Dt)rt[Dt].push(new ao(St,$[Dt],_e[Dt]))}else if(Bt<mt){ct=o[Bt];const Dt=--mt,Ut=o[Dt];g[Ut.uuid]=Bt,o[Bt]=Ut,g[It]=Dt,o[Dt]=St;for(let Ft=0,zt=at;Ft!==zt;++Ft){const Kt=rt[Ft],tn=Kt[Dt];let sn=Kt[Bt];Kt[Bt]=tn,sn===void 0&&(sn=new ao(St,$[Ft],_e[Ft])),Kt[Dt]=sn}}else o[Bt]!==ct&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=mt}remove(){const o=this._objects,g=this._indicesByUUID,$=this._bindings,_e=$.length;let rt=this.nCachedObjects_;for(let at=0,ct=arguments.length;at!==ct;++at){const ft=arguments[at],mt=ft.uuid,bt=g[mt];if(bt!==void 0&&bt>=rt){const Mt=rt++,St=o[Mt];g[St.uuid]=bt,o[bt]=St,g[mt]=Mt,o[Mt]=ft;for(let It=0,Bt=_e;It!==Bt;++It){const Dt=$[It],Ut=Dt[Mt],Ft=Dt[bt];Dt[bt]=Ut,Dt[Mt]=Ft}}}this.nCachedObjects_=rt}uncache(){const o=this._objects,g=this._indicesByUUID,$=this._bindings,_e=$.length;let rt=this.nCachedObjects_,at=o.length;for(let ct=0,ft=arguments.length;ct!==ft;++ct){const mt=arguments[ct].uuid,bt=g[mt];if(bt!==void 0)if(delete g[mt],bt<rt){const Mt=--rt,St=o[Mt],It=--at,Bt=o[It];g[St.uuid]=bt,o[bt]=St,g[Bt.uuid]=Mt,o[Mt]=Bt,o.pop();for(let Dt=0,Ut=_e;Dt!==Ut;++Dt){const Ft=$[Dt],zt=Ft[Mt],Kt=Ft[It];Ft[bt]=zt,Ft[Mt]=Kt,Ft.pop()}}else{const Mt=--at,St=o[Mt];Mt>0&&(g[St.uuid]=bt),o[bt]=St,o.pop();for(let It=0,Bt=_e;It!==Bt;++It){const Dt=$[It];Dt[bt]=Dt[Mt],Dt.pop()}}}this.nCachedObjects_=rt}subscribe_(o,g){const $=this._bindingsIndicesByPath;let _e=$[o];const rt=this._bindings;if(_e!==void 0)return rt[_e];const at=this._paths,ct=this._parsedPaths,ft=this._objects,mt=ft.length,bt=this.nCachedObjects_,Mt=new Array(mt);_e=rt.length,$[o]=_e,at.push(o),ct.push(g),rt.push(Mt);for(let St=bt,It=ft.length;St!==It;++St){const Bt=ft[St];Mt[St]=new ao(Bt,o,g)}return Mt}unsubscribe_(o){const g=this._bindingsIndicesByPath,$=g[o];if($!==void 0){const _e=this._paths,rt=this._parsedPaths,at=this._bindings,ct=at.length-1,ft=at[ct];g[o[ct]]=$,at[$]=ft,at.pop(),rt[$]=rt[ct],rt.pop(),_e[$]=_e[ct],_e.pop()}}}class DE{constructor(o,g,$=null,_e=g.blendMode){this._mixer=o,this._clip=g,this._localRoot=$,this.blendMode=_e;const rt=g.tracks,at=rt.length,ct=new Array(at),ft={endingStart:Fl,endingEnd:Fl};for(let mt=0;mt!==at;++mt){const bt=rt[mt].createInterpolant(null);ct[mt]=bt,bt.settings=ft}this._interpolantSettings=ft,this._interpolants=ct,this._propertyBindings=new Array(at),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=dy,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(o){return this._startTime=o,this}setLoop(o,g){return this.loop=o,this.repetitions=g,this}setEffectiveWeight(o){return this.weight=o,this._effectiveWeight=this.enabled?o:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(o){return this._scheduleFading(o,0,1)}fadeOut(o){return this._scheduleFading(o,1,0)}crossFadeFrom(o,g,$){if(o.fadeOut(g),this.fadeIn(g),$){const _e=this._clip.duration,rt=o._clip.duration,at=rt/_e,ct=_e/rt;o.warp(1,at,g),this.warp(ct,1,g)}return this}crossFadeTo(o,g,$){return o.crossFadeFrom(this,g,$)}stopFading(){const o=this._weightInterpolant;return o!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}setEffectiveTimeScale(o){return this.timeScale=o,this._effectiveTimeScale=this.paused?0:o,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(o){return this.timeScale=this._clip.duration/o,this.stopWarping()}syncWith(o){return this.time=o.time,this.timeScale=o.timeScale,this.stopWarping()}halt(o){return this.warp(this._effectiveTimeScale,0,o)}warp(o,g,$){const _e=this._mixer,rt=_e.time,at=this.timeScale;let ct=this._timeScaleInterpolant;ct===null&&(ct=_e._lendControlInterpolant(),this._timeScaleInterpolant=ct);const ft=ct.parameterPositions,mt=ct.sampleValues;return ft[0]=rt,ft[1]=rt+$,mt[0]=o/at,mt[1]=g/at,this}stopWarping(){const o=this._timeScaleInterpolant;return o!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(o)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(o,g,$,_e){if(!this.enabled)return void this._updateWeight(o);const rt=this._startTime;if(rt!==null){const ft=(o-rt)*$;ft<0||$===0?g=0:(this._startTime=null,g=$*ft)}g*=this._updateTimeScale(o);const at=this._updateTime(g),ct=this._updateWeight(o);if(ct>0){const ft=this._interpolants,mt=this._propertyBindings;if(this.blendMode===py)for(let bt=0,Mt=ft.length;bt!==Mt;++bt)ft[bt].evaluate(at),mt[bt].accumulateAdditive(ct);else for(let bt=0,Mt=ft.length;bt!==Mt;++bt)ft[bt].evaluate(at),mt[bt].accumulate(_e,ct)}}_updateWeight(o){let g=0;if(this.enabled){g=this.weight;const $=this._weightInterpolant;if($!==null){const _e=$.evaluate(o)[0];g*=_e,o>$.parameterPositions[1]&&(this.stopFading(),_e===0&&(this.enabled=!1))}}return this._effectiveWeight=g,g}_updateTimeScale(o){let g=0;if(!this.paused){g=this.timeScale;const $=this._timeScaleInterpolant;$!==null&&(g*=$.evaluate(o)[0],o>$.parameterPositions[1]&&(this.stopWarping(),g===0?this.paused=!0:this.timeScale=g))}return this._effectiveTimeScale=g,g}_updateTime(o){const g=this._clip.duration,$=this.loop;let _e=this.time+o,rt=this._loopCount;const at=$===u0;if(o===0)return rt===-1?_e:at&&(1&rt)==1?g-_e:_e;if($===Xu){rt===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(_e>=g)_e=g;else{if(!(_e<0)){this.time=_e;break e}_e=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o<0?-1:1})}}else{if(rt===-1&&(o>=0?(rt=0,this._setEndings(!0,this.repetitions===0,at)):this._setEndings(this.repetitions===0,!0,at)),_e>=g||_e<0){const ct=Math.floor(_e/g);_e-=g*ct,rt+=Math.abs(ct);const ft=this.repetitions-rt;if(ft<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,_e=o>0?g:0,this.time=_e,this._mixer.dispatchEvent({type:"finished",action:this,direction:o>0?1:-1});else{if(ft===1){const mt=o<0;this._setEndings(mt,!mt,at)}else this._setEndings(!1,!1,at);this._loopCount=rt,this.time=_e,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:ct})}}else this.time=_e;if(at&&(1&rt)==1)return g-_e}return _e}_setEndings(o,g,$){const _e=this._interpolantSettings;$?(_e.endingStart=xp,_e.endingEnd=xp):(_e.endingStart=o?this.zeroSlopeAtStart?xp:Fl:d0,_e.endingEnd=g?this.zeroSlopeAtEnd?xp:Fl:d0)}_scheduleFading(o,g,$){const _e=this._mixer,rt=_e.time;let at=this._weightInterpolant;at===null&&(at=_e._lendControlInterpolant(),this._weightInterpolant=at);const ct=at.parameterPositions,ft=at.sampleValues;return ct[0]=rt,ft[0]=g,ct[1]=rt+o,ft[1]=$,this}}const PE=new Float32Array(1);class OC extends Ts{constructor(o){super(),this._root=o,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(o,g){const $=o._localRoot||this._root,_e=o._clip.tracks,rt=_e.length,at=o._propertyBindings,ct=o._interpolants,ft=$.uuid,mt=this._bindingsByRootAndName;let bt=mt[ft];bt===void 0&&(bt={},mt[ft]=bt);for(let Mt=0;Mt!==rt;++Mt){const St=_e[Mt],It=St.name;let Bt=bt[It];if(Bt!==void 0)++Bt.referenceCount,at[Mt]=Bt;else{if(Bt=at[Mt],Bt!==void 0){Bt._cacheIndex===null&&(++Bt.referenceCount,this._addInactiveBinding(Bt,ft,It));continue}const Dt=g&&g._propertyBindings[Mt].binding.parsedPath;Bt=new Px(ao.create($,It,Dt),St.ValueTypeName,St.getValueSize()),++Bt.referenceCount,this._addInactiveBinding(Bt,ft,It),at[Mt]=Bt}ct[Mt].resultBuffer=Bt.buffer}}_activateAction(o){if(!this._isActiveAction(o)){if(o._cacheIndex===null){const $=(o._localRoot||this._root).uuid,_e=o._clip.uuid,rt=this._actionsByClip[_e];this._bindAction(o,rt&&rt.knownActions[0]),this._addInactiveAction(o,_e,$)}const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];rt.useCount++==0&&(this._lendBinding(rt),rt.saveOriginalState())}this._lendAction(o)}}_deactivateAction(o){if(this._isActiveAction(o)){const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];--rt.useCount==0&&(rt.restoreOriginalState(),this._takeBackBinding(rt))}this._takeBackAction(o)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const o=this;this.stats={actions:{get total(){return o._actions.length},get inUse(){return o._nActiveActions}},bindings:{get total(){return o._bindings.length},get inUse(){return o._nActiveBindings}},controlInterpolants:{get total(){return o._controlInterpolants.length},get inUse(){return o._nActiveControlInterpolants}}}}_isActiveAction(o){const g=o._cacheIndex;return g!==null&&g<this._nActiveActions}_addInactiveAction(o,g,$){const _e=this._actions,rt=this._actionsByClip;let at=rt[g];if(at===void 0)at={knownActions:[o],actionByRoot:{}},o._byClipCacheIndex=0,rt[g]=at;else{const ct=at.knownActions;o._byClipCacheIndex=ct.length,ct.push(o)}o._cacheIndex=_e.length,_e.push(o),at.actionByRoot[$]=o}_removeInactiveAction(o){const g=this._actions,$=g[g.length-1],_e=o._cacheIndex;$._cacheIndex=_e,g[_e]=$,g.pop(),o._cacheIndex=null;const rt=o._clip.uuid,at=this._actionsByClip,ct=at[rt],ft=ct.knownActions,mt=ft[ft.length-1],bt=o._byClipCacheIndex;mt._byClipCacheIndex=bt,ft[bt]=mt,ft.pop(),o._byClipCacheIndex=null,delete ct.actionByRoot[(o._localRoot||this._root).uuid],ft.length===0&&delete at[rt],this._removeInactiveBindingsForAction(o)}_removeInactiveBindingsForAction(o){const g=o._propertyBindings;for(let $=0,_e=g.length;$!==_e;++$){const rt=g[$];--rt.referenceCount==0&&this._removeInactiveBinding(rt)}}_lendAction(o){const g=this._actions,$=o._cacheIndex,_e=this._nActiveActions++,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_takeBackAction(o){const g=this._actions,$=o._cacheIndex,_e=--this._nActiveActions,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_addInactiveBinding(o,g,$){const _e=this._bindingsByRootAndName,rt=this._bindings;let at=_e[g];at===void 0&&(at={},_e[g]=at),at[$]=o,o._cacheIndex=rt.length,rt.push(o)}_removeInactiveBinding(o){const g=this._bindings,$=o.binding,_e=$.rootNode.uuid,rt=$.path,at=this._bindingsByRootAndName,ct=at[_e],ft=g[g.length-1],mt=o._cacheIndex;ft._cacheIndex=mt,g[mt]=ft,g.pop(),delete ct[rt],Object.keys(ct).length===0&&delete at[_e]}_lendBinding(o){const g=this._bindings,$=o._cacheIndex,_e=this._nActiveBindings++,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_takeBackBinding(o){const g=this._bindings,$=o._cacheIndex,_e=--this._nActiveBindings,rt=g[_e];o._cacheIndex=_e,g[_e]=o,rt._cacheIndex=$,g[$]=rt}_lendControlInterpolant(){const o=this._controlInterpolants,g=this._nActiveControlInterpolants++;let $=o[g];return $===void 0&&($=new CC(new Float32Array(2),new Float32Array(2),1,PE),$.__cacheIndex=g,o[g]=$),$}_takeBackControlInterpolant(o){const g=this._controlInterpolants,$=o.__cacheIndex,_e=--this._nActiveControlInterpolants,rt=g[_e];o.__cacheIndex=_e,g[_e]=o,rt.__cacheIndex=$,g[$]=rt}clipAction(o,g,$){const _e=g||this._root,rt=_e.uuid;let at=typeof o=="string"?bx.findByName(_e,o):o;const ct=at!==null?at.uuid:o,ft=this._actionsByClip[ct];let mt=null;if($===void 0&&($=at!==null?at.blendMode:No),ft!==void 0){const Mt=ft.actionByRoot[rt];if(Mt!==void 0&&Mt.blendMode===$)return Mt;mt=ft.knownActions[0],at===null&&(at=mt._clip)}if(at===null)return null;const bt=new DE(this,at,g,$);return this._bindAction(bt,mt),this._addInactiveAction(bt,ct,rt),bt}existingAction(o,g){const $=g||this._root,_e=$.uuid,rt=typeof o=="string"?bx.findByName($,o):o,at=rt?rt.uuid:o,ct=this._actionsByClip[at];return ct!==void 0&&ct.actionByRoot[_e]||null}stopAllAction(){const o=this._actions;for(let g=this._nActiveActions-1;g>=0;--g)o[g].stop();return this}update(o){o*=this.timeScale;const g=this._actions,$=this._nActiveActions,_e=this.time+=o,rt=Math.sign(o),at=this._accuIndex^=1;for(let mt=0;mt!==$;++mt)g[mt]._update(_e,o,rt,at);const ct=this._bindings,ft=this._nActiveBindings;for(let mt=0;mt!==ft;++mt)ct[mt].apply(at);return this}setTime(o){this.time=0;for(let g=0;g<this._actions.length;g++)this._actions[g].time=0;return this.update(o)}getRoot(){return this._root}uncacheClip(o){const g=this._actions,$=o.uuid,_e=this._actionsByClip,rt=_e[$];if(rt!==void 0){const at=rt.knownActions;for(let ct=0,ft=at.length;ct!==ft;++ct){const mt=at[ct];this._deactivateAction(mt);const bt=mt._cacheIndex,Mt=g[g.length-1];mt._cacheIndex=null,mt._byClipCacheIndex=null,Mt._cacheIndex=bt,g[bt]=Mt,g.pop(),this._removeInactiveBindingsForAction(mt)}delete _e[$]}}uncacheRoot(o){const g=o.uuid,$=this._actionsByClip;for(const rt in $){const at=$[rt].actionByRoot[g];at!==void 0&&(this._deactivateAction(at),this._removeInactiveAction(at))}const _e=this._bindingsByRootAndName[g];if(_e!==void 0)for(const rt in _e){const at=_e[rt];at.restoreOriginalState(),this._removeInactiveBinding(at)}}uncacheAction(o,g){const $=this.existingAction(o,g);$!==null&&(this._deactivateAction($),this._removeInactiveAction($))}}class H_{constructor(o){this.value=o}clone(){return new H_(this.value.clone===void 0?this.value:this.value.clone())}}let RE=0;class kx extends Ts{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:RE++}),this.name="",this.usage=v0,this.uniforms=[]}add(o){return this.uniforms.push(o),this}remove(o){const g=this.uniforms.indexOf(o);return g!==-1&&this.uniforms.splice(g,1),this}setName(o){return this.name=o,this}setUsage(o){return this.usage=o,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(o){this.name=o.name,this.usage=o.usage;const g=o.uniforms;this.uniforms.length=0;for(let $=0,_e=g.length;$<_e;$++)this.uniforms.push(g[$].clone());return this}clone(){return new this.constructor().copy(this)}}class BE extends q1{constructor(o,g,$=1){super(o,g),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=$}copy(o){return super.copy(o),this.meshPerAttribute=o.meshPerAttribute,this}clone(o){const g=super.clone(o);return g.meshPerAttribute=this.meshPerAttribute,g}toJSON(o){const g=super.toJSON(o);return g.isInstancedInterleavedBuffer=!0,g.meshPerAttribute=this.meshPerAttribute,g}}class iw{constructor(o,g,$,_e,rt){this.isGLBufferAttribute=!0,this.buffer=o,this.type=g,this.itemSize=$,this.elementSize=_e,this.count=rt,this.version=0}set needsUpdate(o){o===!0&&this.version++}setBuffer(o){return this.buffer=o,this}setType(o,g){return this.type=o,this.elementSize=g,this}setItemSize(o){return this.itemSize=o,this}setCount(o){return this.count=o,this}}class kE{constructor(o,g,$=0,_e=1/0){this.ray=new Nv(o,g),this.near=$,this.far=_e,this.camera=null,this.layers=new ku,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(o,g){this.ray.set(o,g)}setFromCamera(o,g){g.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(g.matrixWorld),this.ray.direction.set(o.x,o.y,.5).unproject(g).sub(this.ray.origin).normalize(),this.camera=g):g.isOrthographicCamera?(this.ray.origin.set(o.x,o.y,(g.near+g.far)/(g.near-g.far)).unproject(g),this.ray.direction.set(0,0,-1).transformDirection(g.matrixWorld),this.camera=g):console.error("THREE.Raycaster: Unsupported camera type: "+g.type)}intersectObject(o,g=!0,$=[]){return OE(o,this,$,g),$.sort(LE),$}intersectObjects(o,g=!0,$=[]){for(let _e=0,rt=o.length;_e<rt;_e++)OE(o[_e],this,$,g);return $.sort(LE),$}}function LE(ut,o){return ut.distance-o.distance}function OE(ut,o,g,$){if(ut.layers.test(o.layers)&&ut.raycast(o,g),$===!0){const _e=ut.children;for(let rt=0,at=_e.length;rt<at;rt++)OE(_e[rt],o,g,!0)}}class yD{constructor(o=1,g=0,$=0){return this.radius=o,this.phi=g,this.theta=$,this}set(o,g,$){return this.radius=o,this.phi=g,this.theta=$,this}copy(o){return this.radius=o.radius,this.phi=o.phi,this.theta=o.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,$){return this.radius=Math.sqrt(o*o+g*g+$*$),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(o,$),this.phi=Math.acos(ys(g/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class KT{constructor(o=1,g=0,$=0){return this.radius=o,this.theta=g,this.y=$,this}set(o,g,$){return this.radius=o,this.theta=g,this.y=$,this}copy(o){return this.radius=o.radius,this.theta=o.theta,this.y=o.y,this}setFromVector3(o){return this.setFromCartesianCoords(o.x,o.y,o.z)}setFromCartesianCoords(o,g,$){return this.radius=Math.sqrt(o*o+$*$),this.theta=Math.atan2(o,$),this.y=g,this}clone(){return new this.constructor().copy(this)}}const JT=new Cr;class wD{constructor(o=new Cr(1/0,1/0),g=new Cr(-1/0,-1/0)){this.isBox2=!0,this.min=o,this.max=g}set(o,g){return this.min.copy(o),this.max.copy(g),this}setFromPoints(o){this.makeEmpty();for(let g=0,$=o.length;g<$;g++)this.expandByPoint(o[g]);return this}setFromCenterAndSize(o,g){const $=JT.copy(g).multiplyScalar(.5);return this.min.copy(o).sub($),this.max.copy(o).add($),this}clone(){return new this.constructor().copy(this)}copy(o){return this.min.copy(o.min),this.max.copy(o.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(o){return this.isEmpty()?o.set(0,0):o.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(o){return this.isEmpty()?o.set(0,0):o.subVectors(this.max,this.min)}expandByPoint(o){return this.min.min(o),this.max.max(o),this}expandByVector(o){return this.min.sub(o),this.max.add(o),this}expandByScalar(o){return this.min.addScalar(-o),this.max.addScalar(o),this}containsPoint(o){return!(o.x<this.min.x||o.x>this.max.x||o.y<this.min.y||o.y>this.max.y)}containsBox(o){return this.min.x<=o.min.x&&o.max.x<=this.max.x&&this.min.y<=o.min.y&&o.max.y<=this.max.y}getParameter(o,g){return g.set((o.x-this.min.x)/(this.max.x-this.min.x),(o.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(o){return!(o.max.x<this.min.x||o.min.x>this.max.x||o.max.y<this.min.y||o.min.y>this.max.y)}clampPoint(o,g){return g.copy(o).clamp(this.min,this.max)}distanceToPoint(o){return JT.copy(o).clamp(this.min,this.max).sub(o).length()}intersect(o){return this.min.max(o.min),this.max.min(o.max),this}union(o){return this.min.min(o.min),this.max.max(o.max),this}translate(o){return this.min.add(o),this.max.add(o),this}equals(o){return o.min.equals(this.min)&&o.max.equals(this.max)}}const NC=new dn,rw=new dn;class ZT{constructor(o=new dn,g=new dn){this.start=o,this.end=g}set(o,g){return this.start.copy(o),this.end.copy(g),this}copy(o){return this.start.copy(o.start),this.end.copy(o.end),this}getCenter(o){return o.addVectors(this.start,this.end).multiplyScalar(.5)}delta(o){return o.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(o,g){return this.delta(g).multiplyScalar(o).add(this.start)}closestPointToPointParameter(o,g){NC.subVectors(o,this.start),rw.subVectors(this.end,this.start);const $=rw.dot(rw);let _e=rw.dot(NC)/$;return g&&(_e=ys(_e,0,1)),_e}closestPointToPoint(o,g,$){const _e=this.closestPointToPointParameter(o,g);return this.delta($).multiplyScalar(_e).add(this.start)}applyMatrix4(o){return this.start.applyMatrix4(o),this.end.applyMatrix4(o),this}equals(o){return o.start.equals(this.start)&&o.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const oo=new dn;class Tu extends Fs{constructor(o,g){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=g;const $=new ls,_e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let at=0,ct=1,ft=32;at<ft;at++,ct++){const mt=at/ft*Math.PI*2,bt=ct/ft*Math.PI*2;_e.push(Math.cos(mt),Math.sin(mt),1,Math.cos(bt),Math.sin(bt),1)}$.setAttribute("position",new ht(_e,3));const rt=new cp({fog:!1,toneMapped:!1});this.cone=new Wv($,rt),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const o=this.light.distance?this.light.distance:1e3,g=o*Math.tan(this.light.angle);this.cone.scale.set(g,g,o),oo.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(oo),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const tp=new dn,K0=new Is,W_=new Is;class Lx extends Wv{constructor(o){const g=UC(o),$=new ls,_e=[],rt=[],at=new ts(0,0,1),ct=new ts(0,1,0);for(let ft=0;ft<g.length;ft++){const mt=g[ft];mt.parent&&mt.parent.isBone&&(_e.push(0,0,0),_e.push(0,0,0),rt.push(at.r,at.g,at.b),rt.push(ct.r,ct.g,ct.b))}$.setAttribute("position",new ht(_e,3)),$.setAttribute("color",new ht(rt,3)),super($,new cp({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=o,this.bones=g,this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(o){const g=this.bones,$=this.geometry,_e=$.getAttribute("position");W_.copy(this.root.matrixWorld).invert();for(let rt=0,at=0;rt<g.length;rt++){const ct=g[rt];ct.parent&&ct.parent.isBone&&(K0.multiplyMatrices(W_,ct.matrixWorld),tp.setFromMatrixPosition(K0),_e.setXYZ(at,tp.x,tp.y,tp.z),K0.multiplyMatrices(W_,ct.parent.matrixWorld),tp.setFromMatrixPosition(K0),_e.setXYZ(at+1,tp.x,tp.y,tp.z),at+=2)}$.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(o)}}function UC(ut){const o=[];ut.isBone===!0&&o.push(ut);for(let g=0;g<ut.children.length;g++)o.push.apply(o,UC(ut.children[g]));return o}class $T extends cu{constructor(o,g,$){super(new Jy(g,4,2),new Em({wireframe:!0,fog:!1,toneMapped:!1})),this.light=o,this.light.updateMatrixWorld(),this.color=$,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const FC=new dn,Ox=new ts,jC=new ts;class eI extends Fs{constructor(o,g,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$;const _e=new Uu(g);_e.rotateY(.5*Math.PI),this.material=new Em({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const rt=_e.getAttribute("position"),at=new Float32Array(3*rt.count);_e.setAttribute("color",new Co(at,3)),this.add(new cu(_e,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const o=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const g=o.geometry.getAttribute("color");Ox.copy(this.light.color),jC.copy(this.light.groundColor);for(let $=0,_e=g.count;$<_e;$++){const rt=$<_e/2?Ox:jC;g.setXYZ($,rt.r,rt.g,rt.b)}g.needsUpdate=!0}o.lookAt(FC.setFromMatrixPosition(this.light.matrixWorld).negate())}}class zC extends Wv{constructor(o=10,g=10,$=4473924,_e=8947848){$=new ts($),_e=new ts(_e);const rt=g/2,at=o/g,ct=o/2,ft=[],mt=[];for(let Mt=0,St=0,It=-ct;Mt<=g;Mt++,It+=at){ft.push(-ct,0,It,ct,0,It),ft.push(It,0,-ct,It,0,ct);const Bt=Mt===rt?$:_e;Bt.toArray(mt,St),St+=3,Bt.toArray(mt,St),St+=3,Bt.toArray(mt,St),St+=3,Bt.toArray(mt,St),St+=3}const bt=new ls;bt.setAttribute("position",new ht(ft,3)),bt.setAttribute("color",new ht(mt,3)),super(bt,new cp({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Nx extends Wv{constructor(o=10,g=16,$=8,_e=64,rt=4473924,at=8947848){rt=new ts(rt),at=new ts(at);const ct=[],ft=[];if(g>1)for(let bt=0;bt<g;bt++){const Mt=bt/g*(2*Math.PI),St=Math.sin(Mt)*o,It=Math.cos(Mt)*o;ct.push(0,0,0),ct.push(St,0,It);const Bt=1&bt?rt:at;ft.push(Bt.r,Bt.g,Bt.b),ft.push(Bt.r,Bt.g,Bt.b)}for(let bt=0;bt<$;bt++){const Mt=1&bt?rt:at,St=o-o/$*bt;for(let It=0;It<_e;It++){let Bt=It/_e*(2*Math.PI),Dt=Math.sin(Bt)*St,Ut=Math.cos(Bt)*St;ct.push(Dt,0,Ut),ft.push(Mt.r,Mt.g,Mt.b),Bt=(It+1)/_e*(2*Math.PI),Dt=Math.sin(Bt)*St,Ut=Math.cos(Bt)*St,ct.push(Dt,0,Ut),ft.push(Mt.r,Mt.g,Mt.b)}}const mt=new ls;mt.setAttribute("position",new ht(ct,3)),mt.setAttribute("color",new ht(ft,3)),super(mt,new cp({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const xa=new dn,Kv=new dn,am=new dn;class J0 extends Fs{constructor(o,g,$){super(),this.light=o,this.light.updateMatrixWorld(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.color=$,g===void 0&&(g=1);let _e=new ls;_e.setAttribute("position",new ht([-g,g,0,g,g,0,g,-g,0,-g,-g,0,-g,g,0],3));const rt=new cp({fog:!1,toneMapped:!1});this.lightPlane=new Hv(_e,rt),this.add(this.lightPlane),_e=new ls,_e.setAttribute("position",new ht([0,0,0,0,0,1],3)),this.targetLine=new Hv(_e,rt),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){xa.setFromMatrixPosition(this.light.matrixWorld),Kv.setFromMatrixPosition(this.light.target.matrixWorld),am.subVectors(Kv,xa),this.lightPlane.lookAt(Kv),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Kv),this.targetLine.scale.z=am.length()}}const Z0=new dn,Rl=new By;class tI extends Wv{constructor(o){const g=new ls,$=new cp({color:16777215,vertexColors:!0,toneMapped:!1}),_e=[],rt=[],at={};function ct(Bt,Dt){ft(Bt),ft(Dt)}function ft(Bt){_e.push(0,0,0),rt.push(0,0,0),at[Bt]===void 0&&(at[Bt]=[]),at[Bt].push(_e.length/3-1)}ct("n1","n2"),ct("n2","n4"),ct("n4","n3"),ct("n3","n1"),ct("f1","f2"),ct("f2","f4"),ct("f4","f3"),ct("f3","f1"),ct("n1","f1"),ct("n2","f2"),ct("n3","f3"),ct("n4","f4"),ct("p","n1"),ct("p","n2"),ct("p","n3"),ct("p","n4"),ct("u1","u2"),ct("u2","u3"),ct("u3","u1"),ct("c","t"),ct("p","c"),ct("cn1","cn2"),ct("cn3","cn4"),ct("cf1","cf2"),ct("cf3","cf4"),g.setAttribute("position",new ht(_e,3)),g.setAttribute("color",new ht(rt,3)),super(g,$),this.type="CameraHelper",this.camera=o,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=o.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=at,this.update();const mt=new ts(16755200),bt=new ts(16711680),Mt=new ts(43775),St=new ts(16777215),It=new ts(3355443);this.setColors(mt,bt,Mt,St,It)}setColors(o,g,$,_e,rt){const at=this.geometry.getAttribute("color");at.setXYZ(0,o.r,o.g,o.b),at.setXYZ(1,o.r,o.g,o.b),at.setXYZ(2,o.r,o.g,o.b),at.setXYZ(3,o.r,o.g,o.b),at.setXYZ(4,o.r,o.g,o.b),at.setXYZ(5,o.r,o.g,o.b),at.setXYZ(6,o.r,o.g,o.b),at.setXYZ(7,o.r,o.g,o.b),at.setXYZ(8,o.r,o.g,o.b),at.setXYZ(9,o.r,o.g,o.b),at.setXYZ(10,o.r,o.g,o.b),at.setXYZ(11,o.r,o.g,o.b),at.setXYZ(12,o.r,o.g,o.b),at.setXYZ(13,o.r,o.g,o.b),at.setXYZ(14,o.r,o.g,o.b),at.setXYZ(15,o.r,o.g,o.b),at.setXYZ(16,o.r,o.g,o.b),at.setXYZ(17,o.r,o.g,o.b),at.setXYZ(18,o.r,o.g,o.b),at.setXYZ(19,o.r,o.g,o.b),at.setXYZ(20,o.r,o.g,o.b),at.setXYZ(21,o.r,o.g,o.b),at.setXYZ(22,o.r,o.g,o.b),at.setXYZ(23,o.r,o.g,o.b),at.setXYZ(24,g.r,g.g,g.b),at.setXYZ(25,g.r,g.g,g.b),at.setXYZ(26,g.r,g.g,g.b),at.setXYZ(27,g.r,g.g,g.b),at.setXYZ(28,g.r,g.g,g.b),at.setXYZ(29,g.r,g.g,g.b),at.setXYZ(30,g.r,g.g,g.b),at.setXYZ(31,g.r,g.g,g.b),at.setXYZ(32,$.r,$.g,$.b),at.setXYZ(33,$.r,$.g,$.b),at.setXYZ(34,$.r,$.g,$.b),at.setXYZ(35,$.r,$.g,$.b),at.setXYZ(36,$.r,$.g,$.b),at.setXYZ(37,$.r,$.g,$.b),at.setXYZ(38,_e.r,_e.g,_e.b),at.setXYZ(39,_e.r,_e.g,_e.b),at.setXYZ(40,rt.r,rt.g,rt.b),at.setXYZ(41,rt.r,rt.g,rt.b),at.setXYZ(42,rt.r,rt.g,rt.b),at.setXYZ(43,rt.r,rt.g,rt.b),at.setXYZ(44,rt.r,rt.g,rt.b),at.setXYZ(45,rt.r,rt.g,rt.b),at.setXYZ(46,rt.r,rt.g,rt.b),at.setXYZ(47,rt.r,rt.g,rt.b),at.setXYZ(48,rt.r,rt.g,rt.b),at.setXYZ(49,rt.r,rt.g,rt.b),at.needsUpdate=!0}update(){const o=this.geometry,g=this.pointMap;Rl.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ul("c",g,o,Rl,0,0,-1),Ul("t",g,o,Rl,0,0,1),Ul("n1",g,o,Rl,-1,-1,-1),Ul("n2",g,o,Rl,1,-1,-1),Ul("n3",g,o,Rl,-1,1,-1),Ul("n4",g,o,Rl,1,1,-1),Ul("f1",g,o,Rl,-1,-1,1),Ul("f2",g,o,Rl,1,-1,1),Ul("f3",g,o,Rl,-1,1,1),Ul("f4",g,o,Rl,1,1,1),Ul("u1",g,o,Rl,.7,1.1,-1),Ul("u2",g,o,Rl,-.7,1.1,-1),Ul("u3",g,o,Rl,0,2,-1),Ul("cf1",g,o,Rl,-1,0,1),Ul("cf2",g,o,Rl,1,0,1),Ul("cf3",g,o,Rl,0,-1,1),Ul("cf4",g,o,Rl,0,1,1),Ul("cn1",g,o,Rl,-1,0,-1),Ul("cn2",g,o,Rl,1,0,-1),Ul("cn3",g,o,Rl,0,-1,-1),Ul("cn4",g,o,Rl,0,1,-1),o.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Ul(ut,o,g,$,_e,rt,at){Z0.set(_e,rt,at).unproject($);const ct=o[ut];if(ct!==void 0){const ft=g.getAttribute("position");for(let mt=0,bt=ct.length;mt<bt;mt++)ft.setXYZ(ct[mt],Z0.x,Z0.y,Z0.z)}}const Ux=new E0;class NE extends Wv{constructor(o,g=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new Float32Array(24),rt=new ls;rt.setIndex(new Co($,1)),rt.setAttribute("position",new Co(_e,3)),super(rt,new cp({color:g,toneMapped:!1})),this.object=o,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(o){if(o!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Ux.setFromObject(this.object),Ux.isEmpty())return;const g=Ux.min,$=Ux.max,_e=this.geometry.attributes.position,rt=_e.array;rt[0]=$.x,rt[1]=$.y,rt[2]=$.z,rt[3]=g.x,rt[4]=$.y,rt[5]=$.z,rt[6]=g.x,rt[7]=g.y,rt[8]=$.z,rt[9]=$.x,rt[10]=g.y,rt[11]=$.z,rt[12]=$.x,rt[13]=$.y,rt[14]=g.z,rt[15]=g.x,rt[16]=$.y,rt[17]=g.z,rt[18]=g.x,rt[19]=g.y,rt[20]=g.z,rt[21]=$.x,rt[22]=g.y,rt[23]=g.z,_e.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(o){return this.object=o,this.update(),this}copy(o,g){return super.copy(o,g),this.object=o.object,this}}class Pm extends Wv{constructor(o,g=16776960){const $=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),_e=new ls;_e.setIndex(new Co($,1)),_e.setAttribute("position",new ht([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(_e,new cp({color:g,toneMapped:!1})),this.box=o,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(o){const g=this.box;g.isEmpty()||(g.getCenter(this.position),g.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(o))}}class UE extends Hv{constructor(o,g=1,$=16776960){const _e=$,rt=new ls;rt.setAttribute("position",new ht([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),rt.computeBoundingSphere(),super(rt,new cp({color:_e,toneMapped:!1})),this.type="PlaneHelper",this.plane=o,this.size=g;const at=new ls;at.setAttribute("position",new ht([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),at.computeBoundingSphere(),this.add(new cu(at,new Em({color:_e,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(o){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(o)}}const sw=new dn;let dp,WA;class Jv extends Fs{constructor(o=new dn(0,0,1),g=new dn(0,0,0),$=1,_e=16776960,rt=.2*$,at=.2*rt){super(),this.type="ArrowHelper",dp===void 0&&(dp=new ls,dp.setAttribute("position",new ht([0,0,0,0,1,0],3)),WA=new uu(0,.5,1,5,1),WA.translate(0,-.5,0)),this.position.copy(g),this.line=new Hv(dp,new cp({color:_e,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new cu(WA,new Em({color:_e,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(o),this.setLength($,rt,at)}setDirection(o){if(o.y>.99999)this.quaternion.set(0,0,0,1);else if(o.y<-.99999)this.quaternion.set(1,0,0,0);else{sw.set(o.z,0,-o.x).normalize();const g=Math.acos(o.y);this.quaternion.setFromAxisAngle(sw,g)}}setLength(o,g=.2*o,$=.2*g){this.line.scale.set(1,Math.max(1e-4,o-g),1),this.line.updateMatrix(),this.cone.scale.set($,g,$),this.cone.position.y=o,this.cone.updateMatrix()}setColor(o){this.line.material.color.set(o),this.cone.material.color.set(o)}copy(o){return super.copy(o,!1),this.line.copy(o.line),this.cone.copy(o.cone),this}}class ow extends Wv{constructor(o=1){const g=[0,0,0,o,0,0,0,0,0,0,o,0,0,0,0,0,0,o],$=new ls;$.setAttribute("position",new ht(g,3)),$.setAttribute("color",new ht([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super($,new cp({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(o,g,$){const _e=new ts,rt=this.geometry.attributes.color.array;return _e.set(o),_e.toArray(rt,0),_e.toArray(rt,3),_e.set(g),_e.toArray(rt,6),_e.toArray(rt,9),_e.set($),_e.toArray(rt,12),_e.toArray(rt,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class FE{constructor(){this.type="ShapePath",this.color=new ts,this.subPaths=[],this.currentPath=null}moveTo(o,g){return this.currentPath=new qy,this.subPaths.push(this.currentPath),this.currentPath.moveTo(o,g),this}lineTo(o,g){return this.currentPath.lineTo(o,g),this}quadraticCurveTo(o,g,$,_e){return this.currentPath.quadraticCurveTo(o,g,$,_e),this}bezierCurveTo(o,g,$,_e,rt,at){return this.currentPath.bezierCurveTo(o,g,$,_e,rt,at),this}splineThru(o){return this.currentPath.splineThru(o),this}toShapes(o,g){function $(zt){const Kt=[];for(let tn=0,sn=zt.length;tn<sn;tn++){const ln=zt[tn],kn=new UA;kn.curves=ln.curves,Kt.push(kn)}return Kt}function _e(zt,Kt){const tn=Kt.length;let sn=!1;for(let ln=tn-1,kn=0;kn<tn;ln=kn++){let Ln=Kt[ln],qn=Kt[kn],Kn=qn.x-Ln.x,Un=qn.y-Ln.y;if(Math.abs(Un)>Number.EPSILON){if(Un<0&&(Ln=Kt[kn],Kn=-Kn,qn=Kt[ln],Un=-Un),zt.y<Ln.y||zt.y>qn.y)continue;if(zt.y===Ln.y){if(zt.x===Ln.x)return!0}else{const vr=Un*(zt.x-Ln.x)-Kn*(zt.y-Ln.y);if(vr===0)return!0;if(vr<0)continue;sn=!sn}}else{if(zt.y!==Ln.y)continue;if(qn.x<=zt.x&&zt.x<=Ln.x||Ln.x<=zt.x&&zt.x<=qn.x)return!0}}return sn}const rt=hv.isClockWise,at=this.subPaths;if(at.length===0)return[];if(g===!0)return $(at);let ct,ft,mt;const bt=[];if(at.length===1)return ft=at[0],mt=new UA,mt.curves=ft.curves,bt.push(mt),bt;let Mt=!rt(at[0].getPoints());Mt=o?!Mt:Mt;const St=[],It=[];let Bt,Dt,Ut=[],Ft=0;It[Ft]=void 0,Ut[Ft]=[];for(let zt=0,Kt=at.length;zt<Kt;zt++)ft=at[zt],Bt=ft.getPoints(),ct=rt(Bt),ct=o?!ct:ct,ct?(!Mt&&It[Ft]&&Ft++,It[Ft]={s:new UA,p:Bt},It[Ft].s.curves=ft.curves,Mt&&Ft++,Ut[Ft]=[]):Ut[Ft].push({h:ft,p:Bt[0]});if(!It[0])return $(at);if(It.length>1){let zt=!1,Kt=0;for(let tn=0,sn=It.length;tn<sn;tn++)St[tn]=[];for(let tn=0,sn=It.length;tn<sn;tn++){const ln=Ut[tn];for(let kn=0;kn<ln.length;kn++){const Ln=ln[kn];let qn=!0;for(let Kn=0;Kn<It.length;Kn++)_e(Ln.p,It[Kn].p)&&(tn!==Kn&&Kt++,qn?(qn=!1,St[Kn].push(Ln)):zt=!0);qn&&St[tn].push(Ln)}}Kt>0&&zt===!1&&(Ut=St)}for(let zt=0,Kt=It.length;zt<Kt;zt++){mt=It[zt].s,bt.push(mt),Dt=Ut[zt];for(let tn=0,sn=Dt.length;tn<sn;tn++)mt.holes.push(Dt[tn].h)}return bt}}const Rm=VC();function VC(){const ut=new ArrayBuffer(4),o=new Float32Array(ut),g=new Uint32Array(ut),$=new Uint32Array(512),_e=new Uint32Array(512);for(let ft=0;ft<256;++ft){const mt=ft-127;mt<-27?($[ft]=0,$[256|ft]=32768,_e[ft]=24,_e[256|ft]=24):mt<-14?($[ft]=1024>>-mt-14,$[256|ft]=1024>>-mt-14|32768,_e[ft]=-mt-1,_e[256|ft]=-mt-1):mt<=15?($[ft]=mt+15<<10,$[256|ft]=mt+15<<10|32768,_e[ft]=13,_e[256|ft]=13):mt<128?($[ft]=31744,$[256|ft]=64512,_e[ft]=24,_e[256|ft]=24):($[ft]=31744,$[256|ft]=64512,_e[ft]=13,_e[256|ft]=13)}const rt=new Uint32Array(2048),at=new Uint32Array(64),ct=new Uint32Array(64);for(let ft=1;ft<1024;++ft){let mt=ft<<13,bt=0;for(;!(8388608&mt);)mt<<=1,bt-=8388608;mt&=-8388609,bt+=947912704,rt[ft]=mt|bt}for(let ft=1024;ft<2048;++ft)rt[ft]=939524096+(ft-1024<<13);for(let ft=1;ft<31;++ft)at[ft]=ft<<23;at[31]=1199570944,at[32]=2147483648;for(let ft=33;ft<63;++ft)at[ft]=2147483648+(ft-32<<23);at[63]=3347054592;for(let ft=1;ft<64;++ft)ft!==32&&(ct[ft]=1024);return{floatView:o,uint32View:g,baseTable:$,shiftTable:_e,mantissaTable:rt,exponentTable:at,offsetTable:ct}}var aw=Object.freeze({__proto__:null,toHalfFloat:function(ut){Math.abs(ut)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),ut=ys(ut,-65504,65504),Rm.floatView[0]=ut;const o=Rm.uint32View[0],g=o>>23&511;return Rm.baseTable[g]+((8388607&o)>>Rm.shiftTable[g])},fromHalfFloat:function(ut){const o=ut>>10;return Rm.uint32View[0]=Rm.mantissaTable[Rm.offsetTable[o]+(1023&ut)]+Rm.exponentTable[o],Rm.floatView[0]}});function Fx(){console.error("THREE.ImmediateRenderObject has been removed.")}class QC extends Ku{constructor(o,g,$){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(o,g,$),this.samples=4}}class nI extends __{constructor(o,g,$,_e){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(o,g,$,_e)}}class $0 extends b0{constructor(o,g,$,_e){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(o,g,$,_e)}}class iI extends Sm{constructor(o,g,$,_e,rt,at){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(o,g,$,_e,rt,at)}}class rI extends lx{constructor(o,g,$,_e){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(o,g,$,_e)}}class lw extends rm{constructor(o,g,$,_e){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(o,g,$,_e)}}class GC extends Go{constructor(o,g,$,_e,rt,at,ct){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(o,g,$,_e,rt,at,ct)}}class qA extends uu{constructor(o,g,$,_e,rt,at,ct,ft){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(o,g,$,_e,rt,at,ct,ft)}}class jx extends cx{constructor(o,g){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(o,g)}}class sI extends mx{constructor(o,g){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(o,g)}}class jE extends Ky{constructor(o,g){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(o,g)}}class oI extends $a{constructor(o,g,$,_e){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(o,g,$,_e)}}class cw extends Uu{constructor(o,g){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(o,g)}}class uw extends D_{constructor(o,g,$,_e){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(o,g,$,_e)}}class aI extends U0{constructor(o,g,$,_e){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(o,g,$,_e)}}class lI extends jA{constructor(o,g,$,_e,rt,at){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(o,g,$,_e,rt,at)}}class cI extends gx{constructor(o,g){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(o,g)}}class uI extends Jy{constructor(o,g,$,_e,rt,at,ct){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(o,g,$,_e,rt,at,ct)}}class q_ extends zA{constructor(o,g){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(o,g)}}class HC extends j_{constructor(o,g,$,_e,rt){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(o,g,$,_e,rt)}}class hw extends Mu{constructor(o,g,$,_e,rt,at){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(o,g,$,_e,rt,at)}}class Bm extends vx{constructor(o,g,$,_e,rt){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(o,g,$,_e,rt)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:b}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=b)},553:function(j,tt,st){st.d(tt,{_:function(){return Et}});var b=st(988);const yt=new WeakMap;class Et extends b.aNw{constructor(Vt){super(Vt),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(Vt){return this.decoderPath=Vt,this}setDecoderConfig(Vt){return this.decoderConfig=Vt,this}setWorkerLimit(Vt){return this.workerLimit=Vt,this}load(Vt,an,Pn,mn){const hn=new b.hH6(this.manager);hn.setPath(this.path),hn.setResponseType("arraybuffer"),hn.setRequestHeader(this.requestHeader),hn.setWithCredentials(this.withCredentials),hn.load(Vt,wn=>{this.decodeDracoFile(wn,an).catch(mn)},Pn,mn)}decodeDracoFile(Vt,an,Pn,mn){const hn={attributeIDs:Pn||this.defaultAttributeIDs,attributeTypes:mn||this.defaultAttributeTypes,useUniqueIDs:!!Pn};return this.decodeGeometry(Vt,hn).then(an)}decodeGeometry(Vt,an){const Pn=JSON.stringify(an);if(yt.has(Vt)){const $t=yt.get(Vt);if($t.key===Pn)return $t.promise;if(Vt.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let mn;const hn=this.workerNextTaskID++,wn=Vt.byteLength,_n=this._getWorker(hn,wn).then($t=>(mn=$t,new Promise((bn,Nt)=>{mn._callbacks[hn]={resolve:bn,reject:Nt},mn.postMessage({type:"decode",id:hn,taskConfig:an,buffer:Vt},[Vt])}))).then($t=>this._createGeometry($t.geometry));return _n.catch(()=>!0).then(()=>{mn&&hn&&this._releaseTask(mn,hn)}),yt.set(Vt,{key:Pn,promise:_n}),_n}_createGeometry(Vt){const an=new b.u9r;Vt.index&&an.setIndex(new b.TlE(Vt.index.array,1));for(let Pn=0;Pn<Vt.attributes.length;Pn++){const mn=Vt.attributes[Pn],hn=mn.name,wn=mn.array,_n=mn.itemSize;an.setAttribute(hn,new b.TlE(wn,_n))}return an}_loadLibrary(Vt,an){const Pn=new b.hH6(this.manager);return Pn.setPath(this.decoderPath),Pn.setResponseType(an),Pn.setWithCredentials(this.withCredentials),new Promise((mn,hn)=>{Pn.load(Vt,mn,void 0,hn)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const Vt=typeof WebAssembly!="object"||this.decoderConfig.type==="js",an=[];return Vt?an.push(this._loadLibrary("draco_decoder.js","text")):(an.push(this._loadLibrary("draco_wasm_wrapper.js","text")),an.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(an).then(Pn=>{const mn=Pn[0];Vt||(this.decoderConfig.wasmBinary=Pn[1]);const hn=kt.toString(),wn=["/* draco decoder */",mn,"","/* worker */",hn.substring(hn.indexOf("{")+1,hn.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([wn]))}),this.decoderPending}_getWorker(Vt,an){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const mn=new Worker(this.workerSourceURL);mn._callbacks={},mn._taskCosts={},mn._taskLoad=0,mn.postMessage({type:"init",decoderConfig:this.decoderConfig}),mn.onmessage=function(hn){const wn=hn.data;switch(wn.type){case"decode":mn._callbacks[wn.id].resolve(wn);break;case"error":mn._callbacks[wn.id].reject(wn);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+wn.type+'"')}},this.workerPool.push(mn)}else this.workerPool.sort(function(mn,hn){return mn._taskLoad>hn._taskLoad?-1:1});const Pn=this.workerPool[this.workerPool.length-1];return Pn._taskCosts[Vt]=an,Pn._taskLoad+=an,Pn})}_releaseTask(Vt,an){Vt._taskLoad-=Vt._taskCosts[an],delete Vt._callbacks[an],delete Vt._taskCosts[an]}debug(){console.log("Task load: ",this.workerPool.map(Vt=>Vt._taskLoad))}dispose(){for(let Vt=0;Vt<this.workerPool.length;++Vt)this.workerPool[Vt].terminate();return this.workerPool.length=0,this}}function kt(){let Gt,Vt;function an(Pn,mn,hn,wn,_n,$t){const bn=$t.num_components(),Nt=hn.num_points()*bn,jt=Nt*_n.BYTES_PER_ELEMENT,Yt=function(Cn,Qt){switch(Qt){case Float32Array:return Cn.DT_FLOAT32;case Int8Array:return Cn.DT_INT8;case Int16Array:return Cn.DT_INT16;case Int32Array:return Cn.DT_INT32;case Uint8Array:return Cn.DT_UINT8;case Uint16Array:return Cn.DT_UINT16;case Uint32Array:return Cn.DT_UINT32}}(Pn,_n),Bn=Pn._malloc(jt);mn.GetAttributeDataArrayForAllPoints(hn,$t,Yt,jt,Bn);const un=new _n(Pn.HEAPF32.buffer,Bn,Nt).slice();return Pn._free(Bn),{name:wn,array:un,itemSize:bn}}onmessage=function(Pn){const mn=Pn.data;switch(mn.type){case"init":Gt=mn.decoderConfig,Vt=new Promise(function(_n){Gt.onModuleLoaded=function($t){_n({draco:$t})},DracoDecoderModule(Gt)});break;case"decode":const hn=mn.buffer,wn=mn.taskConfig;Vt.then(_n=>{const $t=_n.draco,bn=new $t.Decoder,Nt=new $t.DecoderBuffer;Nt.Init(new Int8Array(hn),hn.byteLength);try{const jt=function(Bn,un,Cn,Qt){const Wt=Qt.attributeIDs,Zt=Qt.attributeTypes;let En,pn;const er=un.GetEncodedGeometryType(Cn);if(er===Bn.TRIANGULAR_MESH)En=new Bn.Mesh,pn=un.DecodeBufferToMesh(Cn,En);else{if(er!==Bn.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");En=new Bn.PointCloud,pn=un.DecodeBufferToPointCloud(Cn,En)}if(!pn.ok()||En.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+pn.error_msg());const Ir={index:null,attributes:[]};for(const Dr in Wt){const zr=self[Zt[Dr]];let Ar,Hr;if(Qt.useUniqueIDs)Hr=Wt[Dr],Ar=un.GetAttributeByUniqueId(En,Hr);else{if(Hr=un.GetAttributeId(En,Bn[Wt[Dr]]),Hr===-1)continue;Ar=un.GetAttribute(En,Hr)}Ir.attributes.push(an(Bn,un,En,Dr,zr,Ar))}return er===Bn.TRIANGULAR_MESH&&(Ir.index=function(Dr,zr,Ar){const Hr=3*Ar.num_faces(),Xn=4*Hr,ir=Dr._malloc(Xn);zr.GetTrianglesUInt32Array(Ar,Xn,ir);const zn=new Uint32Array(Dr.HEAPF32.buffer,ir,Hr).slice();return Dr._free(ir),{array:zn,itemSize:1}}(Bn,un,En)),Bn.destroy(En),Ir}($t,bn,Nt,wn),Yt=jt.attributes.map(Bn=>Bn.array.buffer);jt.index&&Yt.push(jt.index.array.buffer),self.postMessage({type:"decode",id:mn.id,geometry:jt},Yt)}catch(jt){console.error(jt),self.postMessage({type:"error",id:mn.id,error:jt.message})}finally{$t.destroy(Nt),$t.destroy(bn)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(j){var tt=__webpackgi_module_cache__[j];if(tt!==void 0)return tt.exports;var st=__webpackgi_module_cache__[j]={id:j,exports:{}};return __webpackgi_modules__[j].call(st.exports,st,st.exports,__webpackgi_require__),st.exports}__webpackgi_require__.n=function(j){var tt=j&&j.__esModule?function(){return j.default}:function(){return j};return __webpackgi_require__.d(tt,{a:tt}),tt},__webpackgi_require__.d=function(j,tt){for(var st in tt)__webpackgi_require__.o(tt,st)&&!__webpackgi_require__.o(j,st)&&Object.defineProperty(j,st,{enumerable:!0,get:tt[st]})},__webpackgi_require__.o=function(j,tt){return Object.prototype.hasOwnProperty.call(j,tt)},__webpackgi_require__.r=function(j){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(j,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(j,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{LY2:function(){return b.LY2},HRj:function(){return Am},li4:function(){return GB},FO5:function(){return HB},Nlh:function(){return VB},QvI:function(){return Ns},JHp:function(){return VS},bGH:function(){return b.bGH},NDo:function(){return b.NDo},gSk:function(){return b.gSk},WMw:function(){return b.WMw},OTo:function(){return b.OTo},Se2:function(){return b.Se2},cum:function(){return b.cum},Mig:function(){return b.Mig},B$7:function(){return D1},i_9:function(){return b.i_9},m7l:function(){return b.m7l},sYA:function(){return b.sYA},Xcj:function(){return b.Xcj},mzJ:function(){return b.mzJ},ZZA:function(){return b.ZZA},$Ph:function(){return Qp},T__:function(){return b.T__},HkE:function(){return b.HkE},tGC:function(){return b.tGC},g1S:function(){return Y_},I$C:function(){return eM},QIH:function(){return Gs},_JE:function(){return Y0},ksm:function(){return Yr},jl_:function(){return nm},b7R:function(){return $u},BDV:function(){return ps},Ea_:function(){return CA},qff:function(){return nm},tmC:function(){return Ml},BON:function(){return cD},P40:function(){return cu},wLL:function(){return Up},iHO:function(){return E1},BbS:function(){return b.BbS},kqm:function(){return b.kqm},Hmr:function(){return b.Hmr},SJI:function(){return b.SJI},mTL:function(){return b.mTL},y8_:function(){return b.y8_},_Li:function(){return b._Li},g56:function(){return _d},bj3:function(){return Zs},z81:function(){return b.z81},_MY:function(){return b._MY},yEv:function(){return CD},dFZ:function(){return F_},N$j:function(){return b.N$j},_YM:function(){return b._YM},TUj:function(){return b.TUj},ZzF:function(){return b.ZzF},qzb:function(){return Dr},GQ:function(){return b.GQ},nvb:function(){return b.nvb},DvJ:function(){return b.DvJ},fQA:function(){return b.fQA},cPz:function(){return ZS},TlE:function(){return b.TlE},u9r:function(){return b.u9r},s4_:function(){return b.s4_},T95:function(){return b.T95},F5w:function(){return y2},NlP:function(){return F2},$8Z:function(){return ey},YYN:function(){return ZA},CtF:function(){return b.CtF},V1s:function(){return b.V1s},jOv:function(){return Xu},Rki:function(){return b.Rki},pzV:function(){return Y2},itZ:function(){return up},qKx:function(){return Pl},vlJ:function(){return aM},nPO:function(){return $_},zcQ:function(){return SC},GH1:function(){return Gp},ROQ:function(){return b.ROQ},YN5:function(){return b.YN5},BVQ:function(){return b.BVQ},YT8:function(){return b.YT8},_DE:function(){return RE},YGz:function(){return b.YGz},trn:function(){return b.trn},zf8:function(){return b.zf8},uWy:function(){return b.uWy},wYQ:function(){return Im},SUY:function(){return b.SUY},Ilk:function(){return b.Ilk},R2R:function(){return b.R2R},epp:function(){return b.epp},xmJ:function(){return ep},GD$:function(){return lp},EB7:function(){return b.EB7},DqL:function(){return b.DqL},_3:function(){return b._3},b_z:function(){return b.b_z},OCn:function(){return eA},_am:function(){return b._am},kB7:function(){return YM},fY$:function(){return b.fY$},vxC:function(){return b.vxC},BtG:function(){return b.BtG},cBK:function(){return b.cBK},g8_:function(){return b.g8_},AXT:function(){return b.AXT},yj7:function(){return b.yj7},dYG:function(){return b.dYG},tm_:function(){return b.tm_},S2y:function(){return b.S2y},B02:function(){return b.B02},PeU:function(){return b.PeU},Hyl:function(){return b.Hyl},Wqd:function(){return b.Wqd},Xaj:function(){return b.Xaj},DUb:function(){return Mu},dZ3:function(){return b.dZ3},m_w:function(){return b.m_w},fHI:function(){return b.fHI},LBq:function(){return b.LBq},dHf:function(){return zB},Qww:function(){return C0.Q},CGV:function(){return eS},JUT:function(){return b.JUT},p3g:function(){return b.p3g},IEO:function(){return b.IEO},CN8:function(){return b.CN8},zob:function(){return b.zob},yxD:function(){return b.yxD},CUS:function(){return ko},A5E:function(){return b.A5E},zqG:function(){return cv},PfX:function(){return LM},Q1o:function(){return M_},jfJ:function(){return b.jfJ},T_J:function(){return b.T_J},tEQ:function(){return b.tEQ},gb4:function(){return Er},qkB:function(){return b.qkB},cvk:function(){return z_},HWo:function(){return Q0},brP:function(){return b.brP},$YQ:function(){return b.$YQ},X8d:function(){return MM},Zdt:function(){return JP},yNB:function(){return jo},h7x:function(){return $a},Ox3:function(){return b.Ox3},qtn:function(){return Vv},cBI:function(){return b.cBI},cU9:function(){return b.cU9},DT1:function(){return b.DT1},Kgo:function(){return b.Kgo},ehD:function(){return b.ehD},fhJ:function(){return zw},y1s:function(){return Vw},fSK:function(){return b.fSK},Vdb:function(){return b.Vdb},l8J:function(){return b.l8J},dj0:function(){return b.dj0},QM0:function(){return b.QM0},OIS:function(){return pp},q8b:function(){return NA},TOt:function(){return b.TOt},xaN:function(){return wn},Ny0:function(){return b.Ny0},NeD:function(){return TP},Zof:function(){return RS},eD:function(){return b.eD},jwo:function(){return b.jwo},dSO:function(){return b.dSO},Bf4:function(){return b.Bf4},USm:function(){return b.USm},pBf:function(){return b.pBf},$Vf:function(){return b.$Vf},O7d:function(){return b.O7d},ksq:function(){return Hs},gXf:function(){return AC},hH6:function(){return b.hH6},kpi:function(){return kE},DwZ:function(){return Qu},kN3:function(){return eR},e62:function(){return b.e62},a$l:function(){return b.a$l},OM3:function(){return b.OM3},VzW:function(){return b.VzW},ybr:function(){return b.ybr},yo9:function(){return b.yo9},$Bt:function(){return N0},Wzm:function(){return b.Wzm},Wl3:function(){return b.Wl3},iWj:function(){return b.iWj},DNz:function(){return Tl},m1M:function(){return Bo},ylh:function(){return b.ylh},v9Y:function(){return b.v9Y},LSk:function(){return b.LSk},LHE:function(){return Go},KE0:function(){return KD},KCF:function(){return LB},a4n:function(){return TD},zIH:function(){return x1},Hfk:function(){return $m},png:function(){return $p},tAj:function(){return kv},Eb_:function(){return _f},BT2:function(){return XC},_8p:function(){return yR},V5Z:function(){return Q_},s5b:function(){return TE},hkn:function(){return fy},GFY:function(){return nv},w$m:function(){return b.w$m},ksN:function(){return b.ksN},j4z:function(){return b.j4z},OAl:function(){return b.OAl},VLJ:function(){return b.VLJ},C73:function(){return zp},ZAu:function(){return b.ZAu},ibP:function(){return C_},_fI:function(){return lp},hUN:function(){return Hp},cLu:function(){return b.cLu},vmT:function(){return b.vmT},Qpg:function(){return b.Qpg},So8:function(){return b.So8},eOv:function(){return G2},Wjw:function(){return b.Wjw},cJO:function(){return b.cJO},QRU:function(){return b.QRU},S3k:function(){return b.S3k},PpQ:function(){return b.PpQ},AHu:function(){return b.AHu},q_9:function(){return Zo},ZRs:function(){return b.ZRs},oqc:function(){return b.oqc},T_x:function(){return Fo},lb7:function(){return b.lb7},L5s:function(){return b.L5s},$TI:function(){return b.$TI},SPe:function(){return b.SPe},aVm:function(){return b.aVm},j87:function(){return b.j87},RNb:function(){return b.RNb},Kz5:function(){return b.Kz5},vpT:function(){return b.vpT},kB5:function(){return b.kB5},_C8:function(){return b._C8},Syv:function(){return b.Syv},NMF:function(){return b.NMF},pIN:function(){return b.pIN},eMJ:function(){return b.eMJ},rN7:function(){return Mx},iUp:function(){return RC},GFd:function(){return WE},x5V:function(){return b.x5V},tUh:function(){return b.tUh},z8B:function(){return b.z8B},vcl:function(){return IE},GZb:function(){return b.GZb},p7y:function(){return b.p7y},S9g:function(){return b.S9g},Zr5:function(){return b.Zr5},vCF:function(){return b.vCF},yt0:function(){return b.yt0},uXU:function(){return b.uXU},_kC:function(){return b._kC},lk7:function(){return b.lk7},USc:function(){return H2},x12:function(){return b.x12},Zzh:function(){return b.Zzh},nls:function(){return b.nls},g_z:function(){return b.g_z},U7:function(){return b.U7},FT0:function(){return b.FT0},blk:function(){return b.blk},ejS:function(){return b.ejS},rnI:function(){return b.rnI},wem:function(){return b.wem},lfu:function(){return b.lfu},FDw:function(){return b.FDw},lRj:function(){return b.lRj},D1R:function(){return b.D1R},qyh:function(){return b.qyh},GUF:function(){return b.GUF},EoG:function(){return b.EoG},aNw:function(){return b.aNw},Zp0:function(){return b.Zp0},lLk:function(){return b.lLk},jAl:function(){return b.jAl},uEv:function(){return b.uEv},YKA:function(){return b.YKA},cRx:function(){return b.cRx},Y8D:function(){return b.Y8D},RsA:function(){return b.RsA},Y0m:function(){return Qx},F5T:function(){return b.F5T},EDU:function(){return o2},z$Q:function(){return o1},KA8:function(){return nu},XUj:function(){return v2},Me$:function(){return gw},u7G:function(){return b.u7G},PEk:function(){return v0},BG4:function(){return iP},M8C:function(){return b.M8C},Vkp:function(){return b.Vkp},yGw:function(){return b.yGw},Sm8:function(){return b.Sm8},Kj0:function(){return b.Kj0},vBJ:function(){return b.vBJ},QfV:function(){return Ep},lRF:function(){return b.lRF},Lun:function(){return b.Lun},YBo:function(){return b.YBo},kaV:function(){return b.kaV},RSm:function(){return b.RSm},xoR:function(){return b.xoR},EJi:function(){return b.EJi},Wid:function(){return b.Wid},iuj:function(){return yu},IKL:function(){return b.IKL},r_:function(){return b.r_},OoA:function(){return b.OoA},qhX:function(){return b.qhX},qPT:function(){return Qw},M5h:function(){return b.M5h},Ns1:function(){return b.Ns1},TyD:function(){return b.TyD},vZf:function(){return b.vZf},HTd:function(){return b.HTd},aH4:function(){return b.aH4},YLQ:function(){return b.YLQ},BVF:function(){return b.BVF},MyG:function(){return b.MyG},jFi:function(){return b.jFi},aCh:function(){return b.aCh},uL9:function(){return b.uL9},TNj:function(){return Uu},IFH:function(){return b.IFH},bdR:function(){return b.bdR},kM_:function(){return XM},M6v:function(){return b.M6v},RvT:function(){return b.RvT},dUE:function(){return b.dUE},oe_:function(){return _I},BuN:function(){return ZC},Tme:function(){return b.Tme},N9P:function(){return Ym},Gql:function(){return b.Gql},$XY:function(){return xy},O9d:function(){return $M},zEO:function(){return f_},qfx:function(){return rA},PA7:function(){return b.PA7},REq:function(){return b.REq},pQR:function(){return b.pQR},ghN:function(){return b.ghN},Hy8:function(){return b.Hy8},Wpd:function(){return b.Wpd},LgZ:function(){return b.LgZ},iWC:function(){return b.iWC},mqn:function(){return SU},SKe:function(){return po},iKG:function(){return b.iKG},_iA:function(){return b._iA},ntZ:function(){return b.ntZ},anP:function(){return b.anP},X2e:function(){return NB},FCo:function(){return r_},y$t:function(){return b.y$t},cPb:function(){return b.cPb},lmx:function(){return mo},JOQ:function(){return b.JOQ},BKK:function(){return b.BKK},_12:function(){return b._12},tJx:function(){return b.tJx},cek:function(){return b.cek},qD0:function(){return kS},xG9:function(){return b.xG9},wI8:function(){return iy},Sgv:function(){return tR},woe:function(){return b.woe},UY4:function(){return b.UY4},aq0:function(){return b.aq0},ujx:function(){return b.ujx},Uol:function(){return b.Uol},JiH:function(){return mM},VYz:function(){return b.VYz},_Pm:function(){return W0},EsW:function(){return Nu},iUV:function(){return b.iUV},tf:function(){return b.tf},ZQ6:function(){return b.ZQ6},mXe:function(){return b.mXe},_fP:function(){return b._fP},iLg:function(){return b.iLg},zbs:function(){return b.zbs},UZH:function(){return b.UZH},mSO:function(){return b.mSO},wk1:function(){return b.wk1},E2K:function(){return b.E2K},FUD:function(){return b.FUD},pKu:function(){return b.pKu},GG6:function(){return b.GG6},Gih:function(){return b.Gih},iiP:function(){return b.iiP},SvJ:function(){return b.SvJ},ptH:function(){return b.ptH},jZA:function(){return b.jZA},y2t:function(){return b.y2t},gi4:function(){return b.gi4},Djp:function(){return b.Djp},BG$:function(){return b.BG$},NYV:function(){return b.NYV},xJs:function(){return b.xJs},bsb:function(){return b.bsb},ekQ:function(){return b.ekQ},CaW:function(){return b.CaW},eaV:function(){return b.eaV},BFQ:function(){return b.BFQ},v3W:function(){return b.v3W},ILR:function(){return b.ILR},UCm:function(){return b.UCm},Inb:function(){return b.Inb},U1$:function(){return Xn},LgE:function(){return b.LgE},fto:function(){return b.fto},l0P:function(){return b.l0P},vCx:function(){return b.vCx},_AM:function(){return b._AM},wuA:function(){return b.wuA},av9:function(){return b.av9},CtA:function(){return b.CtA},BvQ:function(){return dx},FZJ:function(){return j0},FIo:function(){return b.FIo},zHn:function(){return b.zHn},iMs:function(){return b.iMs},T_f:function(){return b.T_f},hEm:function(){return b.hEm},D9w:function(){return b.D9w},sHH:function(){return FA},CdI:function(){return b.CdI},rkc:function(){return ry},rpg:function(){return b.rpg},ce8:function(){return b.ce8},rOj:function(){return b.rOj},P6m:function(){return Zv},JA6:function(){return QE},V4E:function(){return b.V4E},o8S:function(){return b.o8S},flB:function(){return u0},DUH:function(){return oN},KI_:function(){return b.KI_},iLN:function(){return U1},jsw:function(){return Kl},srG:function(){return _2},i6Z:function(){return O1},vfv:function(){return KC},xsS:function(){return b.xsS},or:function(){return W2},EQj:function(){return Wp},ov0:function(){return JS},WdD:function(){return b.WdD},Vj0:function(){return b.Vj0},jyz:function(){return b.jyz},mTM:function(){return m0},Mn1:function(){return iu},Hlq:function(){return Wl},Fi7:function(){return uv},Tn7:function(){return b.Tn7},bnF:function(){return b.bnF},HW6:function(){return b.HW6},oa8:function(){return b.oa8},T_1:function(){return b.T_1},zHJ:function(){return yv},iDF:function(){return b.iDF},iAb:function(){return b.iAb},d4E:function(){return JT},lBg:function(){return V2},JeJ:function(){return wD},FKY:function(){return st},zlZ:function(){return AI},vkg:function(){return vy},brh:function(){return $v},kZK:function(){return wv},puG:function(){return Q2},OdW:function(){return b.OdW},_YX:function(){return b._YX},TUv:function(){return b.TUv},Hw6:function(){return b.Hw6},aLr:function(){return b.aLr},Aip:function(){return b.Aip},xo$:function(){return b.xo$},bIn:function(){return CU},$V:function(){return b.$V},lDi:function(){return b.lDi},gti:function(){return b.gti},PMe:function(){return b.PMe},iwP:function(){return PA},FvO:function(){return b.FvO},jyi:function(){return b.jyi},xeV:function(){return b.xeV},k74:function(){return b.k74},RlZ:function(){return b.RlZ},KhW:function(){return b.KhW},HgB:function(){return b.HgB},W2J:function(){return b.W2J},JWc:function(){return b.JWc},u37:function(){return b.u37},Z6B:function(){return b.Z6B},QZ1:function(){return b.QZ1},Ir4:function(){return b.Ir4},NwF:function(){return b.NwF},Wbm:function(){return b.Wbm},N4l:function(){return b.N4l},ej9:function(){return vw},QmN:function(){return b.QmN},IOt:function(){return b.IOt},NOD:function(){return yx},L5g:function(){return b.L5g},H$k:function(){return b.H$k},cuP:function(){return Vu},xEZ:function(){return b.xEZ},dpR:function(){return b.dpR},wOD:function(){return sm},KNb:function(){return jM},IiN:function(){return Px},Cne:function(){return b.Cne},XvJ:function(){return b.XvJ},XZw:function(){return b.XZw},FE5:function(){return b.FE5},lVp:function(){return _C},CJI:function(){return b.CJI},z$h:function(){return b.z$h},UlW:function(){return b.UlW},WwZ:function(){return b.WwZ},Lcc:function(){return b.Lcc},WXh:function(){return b.WXh},Vjr:function(){return CP},LuM:function(){return aR},LP5:function(){return LL},xfE:function(){return b.xfE},qlB:function(){return b.qlB},lCJ:function(){return b.lCJ},WTc:function(){return b.WTc},rAo:function(){return b.rAo},LZj:function(){return XT},xWb:function(){return b.xWb},gH0:function(){return b.gH0},rBU:function(){return b.rBU},rDY:function(){return b.rDY},ywz:function(){return b.ywz},wJv:function(){return b.wJv},JQ4:function(){return b.JQ4},k0A:function(){return b.k0A},irR:function(){return b.irR},LsT:function(){return b.LsT},q5h:function(){return C1},TKh:function(){return lD},tyg:function(){return NM},Ro5:function(){return IA},dwk:function(){return b.dwk},FM8:function(){return b.FM8},Pa4:function(){return b.Pa4},Ltg:function(){return b.Ltg},yC1:function(){return b.yC1},lHq:function(){return Ax},fO1:function(){return b.fO1},oMA:function(){return Cm},JzW:function(){return j},QEt:function(){return DE},b5g:function(){return b.b5g},Ywn:function(){return b.Ywn},GVz:function(){return b.GVz},oAp:function(){return b.oAp},kFz:function(){return b.kFz},p7A:function(){return b.p7A},dd2:function(){return b.dd2},CP7:function(){return b.CP7},fQK:function(){return b.fQK},Wd$:function(){return KT},t1_:function(){return dR},Uk6:function(){return b.Uk6},_sL:function(){return b._sL},Pnf:function(){return b.Pnf},c8b:function(){return b.c8b},_lf:function(){return b._lf},ad5:function(){return b.ad5},sZV:function(){return oD},TfA:function(){return Kr},sKX:function(){return T1},UdM:function(){return Vs},P0y:function(){return Ry},L_r:function(){return b.L_r},Bve:function(){return LE},UeO:function(){return Ov},$nx:function(){return ID},Bk6:function(){return su},y4l:function(){return y1},pQ0:function(){return I1},wXW:function(){return r3},r5x:function(){return t3},MSI:function(){return a3},EUu:function(){return TU},jtH:function(){return Wy},T0T:function(){return gC},gAb:function(){return $2},iwT:function(){return wx},je_:function(){return UL},wBP:function(){return ax},LU2:function(){return nC},wQL:function(){return IU},Zs7:function(){return d2},x7s:function(){return w3},Mnd:function(){return PU},A0_:function(){return RU},d73:function(){return c2},HCD:function(){return Ss},RG9:function(){return zs},G2P:function(){return B0},XLf:function(){return W1},CGN:function(){return vT},mvg:function(){return sS},Hiy:function(){return Dw},XMc:function(){return n3},N7M:function(){return _k},iv:function(){return s3},n55:function(){return Fl},IaC:function(){return vv},h9t:function(){return _T},yDW:function(){return AT},gJv:function(){return Jw},l$g:function(){return q3},vQi:function(){return DL},$MY:function(){return QM},wJl:function(){return FS},Z7Y:function(){return eC},X7D:function(){return tC},BnX:function(){return H1},uZ5:function(){return B_},zVI:function(){return ZB},DpF:function(){return Zy},nNb:function(){return I0},cqZ:function(){return zv},pKN:function(){return e2},d_$:function(){return JM},DdI:function(){return JD},rrX:function(){return t2},KlC:function(){return KM},KVn:function(){return Hr},oau:function(){return gP},aw9:function(){return qu},Aap:function(){return ip},Dxg:function(){return Bn},MjT:function(){return mA},F7Q:function(){return mT},IFq:function(){return vR},IJl:function(){return G1},O5A:function(){return h0},wCn:function(){return No},gGT:function(){return fT},pEc:function(){return jB},Bi6:function(){return py},fi_:function(){return S3},TT:function(){return dN},q2Z:function(){return yU},NyK:function(){return Lo},bgu:function(){return _1},kcS:function(){return Dv},rRN:function(){return RP},ivY:function(){return Wt},_s1:function(){return FU},_HO:function(){return Nr},tpL:function(){return kr},DMK:function(){return nE},LjN:function(){return kM},iFs:function(){return tv},qTg:function(){return Nt},Wtl:function(){return ws},DmK:function(){return ls},Htt:function(){return VL},Hx7:function(){return eo},imt:function(){return Hm},US6:function(){return cS},vZs:function(){return ZM},TE$:function(){return BU},lmu:function(){return eu},SvO:function(){return xp},YQY:function(){return Fy},mZN:function(){return $S},VvG:function(){return gT},omp:function(){return H3},utz:function(){return oS},TFV:function(){return iv},hrz:function(){return un},JKM:function(){return pP},jZf:function(){return mR},RjL:function(){return nR},RRI:function(){return A3},RUq:function(){return W3},_t4:function(){return Mv},YHh:function(){return l0},R8g:function(){return ir},Bbl:function(){return gy},V9r:function(){return jt},PZ2:function(){return Yt},w7A:function(){return _n},N6S:function(){return $n},Uxp:function(){return Sr},tAz:function(){return nr},R$F:function(){return Xt},N33:function(){return Yn},gw2:function(){return P1},KlU:function(){return zn},wo6:function(){return f0},H4P:function(){return Qt},swA:function(){return MA},_Z3:function(){return TA},ivc:function(){return I0},rZ1:function(){return zv},CpZ:function(){return E3},dyc:function(){return Zt},MxZ:function(){return bN},btp:function(){return EN},mXy:function(){return IP},Ej0:function(){return bv},ep4:function(){return vm},DQP:function(){return gA},VNr:function(){return ly},V7q:function(){return p0},zEk:function(){return tu},qfq:function(){return Jp},piB:function(){return er},IIc:function(){return MU},rrF:function(){return Np},naq:function(){return Eu},sXR:function(){return tE},p5I:function(){return mC},wps:function(){return eD},wuo:function(){return _R},GpE:function(){return $t},F4b:function(){return Gy},t$v:function(){return pm},tdn:function(){return vE},Y9t:function(){return CC},GEo:function(){return Kw},DH3:function(){return i3},uxM:function(){return qB},zH3:function(){return YB},MLs:function(){return Oy},xXG:function(){return Qo},YM4:function(){return ox},B3r:function(){return gR},iAx:function(){return lM},lDn:function(){return Fn},oaQ:function(){return Q1},CD7:function(){return k0},Rc0:function(){return Z1},iPG:function(){return Hv},TIc:function(){return Mw},xsC:function(){return l3},zOc:function(){return Xs},r46:function(){return p3},z2C:function(){return pn},_X$:function(){return my},_yn:function(){return to},Dyg:function(){return h_},cUc:function(){return Iw},zGw:function(){return eE},Ctq:function(){return dP},$ch:function(){return kU},k5b:function(){return aS},kZl:function(){return u2},OCg:function(){return mP},YjH:function(){return y3},Ui8:function(){return wR},YD2:function(){return k_},vi9:function(){return zL},ij3:function(){return e3},YPW:function(){return $B},Bg1:function(){return bU},kon:function(){return Cn},M3g:function(){return Xw},F2z:function(){return _v},pJF:function(){return G3},knz:function(){return b.knz},Ejo:function(){return bn},BgY:function(){return Cw},qCG:function(){return jn},HD9:function(){return so},fEB:function(){return Hl},Udc:function(){return yp},ZQg:function(){return cy},ofC:function(){return jr},yRy:function(){return Ru},_NL:function(){return OE},LCA:function(){return Ap},j1w:function(){return _0},i8J:function(){return zU},p7C:function(){return Jo},ZAS:function(){return dv},ipH:function(){return LU},$TF:function(){return GL},uZI:function(){return OU},VWG:function(){return nP},pQ7:function(){return VA},STw:function(){return Qv},jc8:function(){return Tw},BL_:function(){return r1},S6:function(){return jU},T8U:function(){return BS},TD6:function(){return I_},akS:function(){return rP},QKE:function(){return XB},dKx:function(){return En},OvX:function(){return FL},VsW:function(){return Dl},YMc:function(){return QL},aPg:function(){return Ao},LFn:function(){return d_},wey:function(){return dm},MaE:function(){return ho},s4x:function(){return Wm},FJA:function(){return _c},vIA:function(){return Cv},Spv:function(){return Ys},w8l:function(){return vA},riG:function(){return qs},Kbh:function(){return a0},t8K:function(){return ss},Q7n:function(){return ns},KGF:function(){return Kp},e5:function(){return rn},Rik:function(){return UM},GZo:function(){return M1},Bds:function(){return Uw},HTu:function(){return Sm},cTq:function(){return d0},X_Y:function(){return jS},dA8:function(){return US},bwS:function(){return hP},Lks:function(){return NU},Rvq:function(){return jL},P4F:function(){return lN},Pd0:function(){return Mp},Pjo:function(){return uP},Tum:function(){return dn},dRH:function(){return Tp},RX0:function(){return Jm},reQ:function(){return UU},cWm:function(){return o3},NC9:function(){return WB},$Re:function(){return aD},Xo9:function(){return OM},LNO:function(){return S1},iZP:function(){return Nw}});var j,tt={};__webpackgi_require__.r(tt),__webpackgi_require__.d(tt,{AsyncCompress:function(){return sn},AsyncDecompress:function(){return Vr},AsyncDeflate:function(){return It},AsyncGunzip:function(){return qn},AsyncGzip:function(){return sn},AsyncInflate:function(){return Ft},AsyncUnzipInflate:function(){return Po},AsyncUnzlib:function(){return lr},AsyncZipDeflate:function(){return bs},AsyncZlib:function(){return Pr},Compress:function(){return tn},DecodeUTF8:function(){return Wn},Decompress:function(){return _r},Deflate:function(){return St},EncodeUTF8:function(){return Dn},Gunzip:function(){return Ln},Gzip:function(){return tn},Inflate:function(){return Ut},Unzip:function(){return zE},UnzipInflate:function(){return Do},UnzipPassThrough:function(){return Us},Unzlib:function(){return Gr},Zip:function(){return Ms},ZipDeflate:function(){return js},ZipPassThrough:function(){return Cs},Zlib:function(){return vr},compress:function(){return ln},compressSync:function(){return kn},decompress:function(){return fs},decompressSync:function(){return Ks},deflate:function(){return Bt},deflateSync:function(){return Dt},gunzip:function(){return Kn},gunzipSync:function(){return Un},gzip:function(){return ln},gzipSync:function(){return kn},inflate:function(){return zt},inflateSync:function(){return Kt},strFromU8:function(){return ur},strToU8:function(){return Gn},unzip:function(){return $r},unzipSync:function(){return hI},unzlib:function(){return dr},unzlibSync:function(){return Or},zip:function(){return Eo},zipSync:function(){return lm},zlib:function(){return mr},zlibSync:function(){return Qr}}),function(c){c[c.Error=-2]="Error",c[c.Destroyed=-1]="Destroyed",c[c.None=0]="None",c[c.Running=1]="Running",c[c.Paused=2]="Paused"}(j||(j={}));class st{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,i){const s=this._eventListeners;s[e]===void 0&&(s[e]=[]),s[e].includes(i)||s[e].push(i)}hasEventListener(e,i){const s=this._eventListeners;return s[e]!==void 0&&s[e].includes(i)}removeEventListener(e,i){const s=this._eventListeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){const i=this._eventListeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}}}var b=__webpackgi_require__(988);const yt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Et{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const kt=new b.iKG(-1,1,1,-1,0,1),Gt=new b.u9r;Gt.setAttribute("position",new b.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),Gt.setAttribute("uv",new b.a$l([0,2,0,0,2,0],2));class Vt{constructor(e){this._mesh=new b.Kj0(Gt,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,kt)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class an extends Et{constructor(e,i){super(),this.textureID=i!==void 0?i:"tDiffuse",e instanceof b.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=b.rDY.clone(e.uniforms),this.material=new b.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new Vt(this.material),this.useExistingRenderTarget=!1}render(e,i,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(i),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class Pn extends Et{constructor(e,i){super(),this.scene=e,this.camera=i,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,i,s){const a=e.getContext(),h=e.state;let d,_;h.buffers.color.setMask(!1),h.buffers.depth.setMask(!1),h.buffers.color.setLocked(!0),h.buffers.depth.setLocked(!0),this.inverse?(d=0,_=1):(d=1,_=0),h.buffers.stencil.setTest(!0),h.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),h.buffers.stencil.setFunc(a.ALWAYS,d,4294967295),h.buffers.stencil.setClear(_),h.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(i),this.clear&&e.clear(),e.render(this.scene,this.camera),h.buffers.color.setLocked(!1),h.buffers.depth.setLocked(!1),h.buffers.stencil.setLocked(!1),h.buffers.stencil.setFunc(a.EQUAL,1,4294967295),h.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),h.buffers.stencil.setLocked(!0)}}class mn extends Et{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new b.iKG(-1,1,1,-1,0,1);const hn=new b.u9r;hn.setAttribute("position",new b.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),hn.setAttribute("uv",new b.a$l([0,2,0,0,2,0],2));class wn extends class{constructor(e,i){if(this.renderer=e,i===void 0){const s=e.getSize(new b.FM8);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,(i=new b.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=i.width,this._height=i.height;this.renderTarget1=i,this.renderTarget2=i.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],yt===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),an===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new an(yt),this.clock=new b.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,i){this.passes.splice(i,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const i=this.passes.indexOf(e);i!==-1&&this.passes.splice(i,1)}isLastEnabledPass(e){for(let i=e+1;i<this.passes.length;i++)if(this.passes[i].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const i=this.renderer.getRenderTarget();let s=!1;for(let a=0,h=this.passes.length;a<h;a++){const d=this.passes[a];if(d.enabled!==!1){if(d.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),d.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),d.needsSwap){if(s){const _=this.renderer.getContext(),et=this.renderer.state.buffers.stencil;et.setFunc(_.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),et.setFunc(_.EQUAL,1,4294967295)}this.swapBuffers()}Pn!==void 0&&(d instanceof Pn?s=!0:d instanceof mn&&(s=!1))}}this.renderer.setRenderTarget(i)}reset(e){if(e===void 0){const i=this.renderer.getSize(new b.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=i.width,this._height=i.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,i){this._width=e,this._height=i;const s=this._width*this._pixelRatio,a=this._height*this._pixelRatio;this.renderTarget1.setSize(s,a),this.renderTarget2.setSize(s,a);for(let h=0;h<this.passes.length;h++)this.passes[h].setSize(s,a)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,i){super(e,i)}setPixelRatio(e,i=!0){const s=this.setSize;i||(this.setSize=()=>{}),super.setPixelRatio(e),i||(this.setSize=s)}}function _n(c,e){let i;do i=Object.getOwnPropertyDescriptor(c,e);while(!i&&(c=Object.getPrototypeOf(c)));return i}function $t(c,e,i=!1,s=!1){const a=_n(c,e);return!!(a!=null&&a.set)||i&&(a==null?void 0:a.writable)!==!1&&(a==null?void 0:a.get)===void 0||s&&!a}function bn(c,e,i,s=!1,a=!1){return!(!c||!$t(c,e,s,a)||(c[e]=i,0))}function Nt(c,e){for(;c.length>0;){if(!e)return;const i=c.splice(0,1)[0];if(!(i.length<1)){if(!(i in e))return console.error("invalid access, check",i,e),e;e=e[i]}}return e}function jt(c,e){return Object.keys(c).find(i=>c[i]===e)}function Yt(c,...e){return typeof c=="function"&&(c=c(...e)),c}function Bn(c,e,i){for(const s of i){const a=c[s];a!==void 0&&bn(e,s,a,!0)}}function un(c){return c.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Cn(c,e,i){return c.replace(new RegExp(un(e),"g"),i)}const Qt=(c,...e)=>String.raw({raw:c},...e),Wt=(c,...e)=>String.raw({raw:c},...e),Zt=(c,...e)=>String.raw({raw:c},...e),En=(c,...e)=>{let i=String.raw({raw:c},...e);return i=Cn(i,"%","%25"),i=Cn(i,"> <","><"),i=Cn(i,"; }",";}"),i=Cn(i,"<","%3c"),i=Cn(i,">","%3e"),i=Cn(i,'"',"'"),i=Cn(i,"#","%23"),i=Cn(i,"{","%7b"),i=Cn(i,"}","%7d"),i=Cn(i,"|","%7c"),i=Cn(i,"^","%5e"),i=Cn(i,"`","%60"),i=Cn(i,"@","%40"),i=Cn(i,"&","&amp;"),i=Cn(i,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+i};function pn(c){if(!c)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,i)=>{let s=e[i];Object.defineProperty(e,i,{get:()=>s,set(a){var h;if(s===a)return;s=a;const d=[i,a];if(typeof c=="string")(h=this[c])===null||h===void 0||h.call(this,...d);else if(typeof c=="function"){let _=!1;if(c.name){let et=this;for(;et;){if(et[c.name]===c){c.call(this,...d),_=!0;break}et=Object.getPrototypeOf(et)}}_||(c.name&&this[c.name].name===`bound ${c.name}`?this[c.name](...d):c(...d))}}})}}function er(c,e){for(const i of e)if(!c.includes(i))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(c,e){return Object.prototype.toString.call(c).toLowerCase()==="[object regexp]"?this.replace(c,e):this.replace(new RegExp(c,"g"),e)});class Ir{constructor(e=0,i=0){Ir.prototype.isVector2=!0,this.x=e,this.y=i}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,i){return this.x=e,this.y=i,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,i){switch(e){case 0:this.x=i;break;case 1:this.y=i;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,i){return this.x=e.x+i.x,this.y=e.y+i.y,this}addScaledVector(e,i){return this.x+=e.x*i,this.y+=e.y*i,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,i){return this.x=e.x-i.x,this.y=e.y-i.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const i=this.x,s=this.y,a=e.elements;return this.x=a[0]*i+a[3]*s+a[6],this.y=a[1]*i+a[4]*s+a[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,i){return this.x=Math.max(e.x,Math.min(i.x,this.x)),this.y=Math.max(e.y,Math.min(i.y,this.y)),this}clampScalar(e,i){return this.x=Math.max(e,Math.min(i,this.x)),this.y=Math.max(e,Math.min(i,this.y)),this}clampLength(e,i){const s=this.length();return this.divideScalar(s||1).multiplyScalar(Math.max(e,Math.min(i,s)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const i=this.x-e.x,s=this.y-e.y;return i*i+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,i){return this.x+=(e.x-this.x)*i,this.y+=(e.y-this.y)*i,this}lerpVectors(e,i,s){return this.x=e.x+(i.x-e.x)*s,this.y=e.y+(i.y-e.y)*s,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,i=0){return this.x=e[i],this.y=e[i+1],this}toArray(e=[],i=0){return e[i]=this.x,e[i+1]=this.y,e}fromBufferAttribute(e,i){return this.x=e.getX(i),this.y=e.getY(i),this}rotateAround(e,i){const s=Math.cos(i),a=Math.sin(i),h=this.x-e.x,d=this.y-e.y;return this.x=h*s-d*a+e.x,this.y=h*a+d*s+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr extends b.ZzF{expandByObject(e,i=!1,s=!1){var a;if(((a=e.userData)===null||a===void 0?void 0:a.bboxVisible)===!1)return this;if(!e.visible&&s)return this;e.updateWorldMatrix(!1,!1);const h=e.geometry;if(h!==void 0)if(i&&h.attributes!=null&&h.attributes.position!==void 0){const _=h.attributes.position;for(let et=0,nt=_.count;et<nt;et++)Ar.fromBufferAttribute(_,et).applyMatrix4(e.matrixWorld),this.expandByPoint(Ar)}else h.boundingBox===null&&h.computeBoundingBox(),zr.copy(h.boundingBox),zr.applyMatrix4(e.matrixWorld),this.union(zr);const d=e.children;for(let _=0,et=d.length;_<et;_++)this.expandByObject(d[_],i,s);return this}expandByObjects(e,i=!1,s=!1){for(let a=0,h=e.length;a<h;a++)this.expandByObject(e[a],i,s);return this}getPoints(){return[new b.Pa4(this.min.x,this.min.y,this.min.z),new b.Pa4(this.min.x,this.min.y,this.max.z),new b.Pa4(this.min.x,this.max.y,this.min.z),new b.Pa4(this.min.x,this.max.y,this.max.z),new b.Pa4(this.max.x,this.min.y,this.min.z),new b.Pa4(this.max.x,this.min.y,this.max.z),new b.Pa4(this.max.x,this.max.y,this.min.z),new b.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const i=this.getPoints(),s=new b.TUj;for(const a of i){const h=a.project(e);s.min.min(h),s.max.max(h)}return s}}const zr=new Dr,Ar=new b.Pa4;function Hr(c,e){let i,s;if(Array.isArray(c))for(const h of c){const d=Hr(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}const a=c;if(a.geometry!==void 0){const h=a.geometry.vertices;if(h===void 0&&a.geometry.attributes!==void 0&&"position"in a.geometry.attributes){const d=new b.Pa4,_=a.geometry.attributes.position;for(let et=0;et<_.count*_.itemSize;et+=_.itemSize){d.set(_.array[et],_.array[et+1],_.array[3]);const nt=d.applyMatrix4(c.matrixWorld).project(e),it=new Ir(nt.x,nt.y);i===void 0||s===void 0?(i=it.clone(),s=it.clone()):(i.min(it),s.max(it))}}else for(const d of h){const _=d.clone().applyMatrix4(c.matrixWorld).project(e),et=new Ir(_.x,_.y);i===void 0||s===void 0?(i=et.clone(),s=et.clone()):(i.min(et),s.max(et))}}if(c.children!==void 0)for(const h of c.children){const d=Hr(h,e);i===void 0||s===void 0?(i=d.min.clone(),s=d.max.clone()):(i.min(d.min),s.max(d.max))}return new b.TUj(i,s)}const Xn=3005;function ir(c){switch(c){case b.rnI:return["Linear","( value )"];case b.knz:return["sRGB","( value )"];case Xn:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",c),["Linear","( value )"]}}function zn(c,e){let i;return c&&c.isTexture?i=c.encoding:c&&c.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=c.texture.encoding):i=b.rnI,e&&c&&c.isTexture&&c.format===b.wk1&&c.type===b.ywz&&c.encoding===b.knz&&(i=b.rnI),i}function nr(c,e){const i=ir(e);return"vec4 "+c+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function $n(c,e,i){return nr(c+"TexelToLinear",zn(e,i))+`
`}function Sr(c,e){return nr(c+"TexelToLinear",e)+`
`}function Yn(c,e){const i=ir(e);return"vec4 "+c+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Xt(c,e,i){return Yn(c,zn(e,i))}function rn({uniforms:c,propKey:e,thisTarget:i=!1}={}){const s=!!c,a=!!e,h=i;return(d,_)=>{const et=nt=>{const it=h?nt:s?c:nt.uniforms||nt._uniforms;let lt=a?e:_;h&&(lt="_"+lt);let dt=it[lt];return dt||(dt={value:null},it[lt]=dt),dt};Object.defineProperty(d,_,{get(){return et(this).value},set(nt){et(this).value=nt,bn(this,"uniformsNeedUpdate",!0,!0)}})}}function Fn(c,e,i=!1,s){const a=!!e,h=!!c;return(d,_)=>{const et=nt=>({t:a?e:nt.defines||nt._defines,p:h?c:_});Object.defineProperty(d,_,{get(){const{t:nt,p:it}=et(i?this:this.material);return nt[it]},set(nt){const{t:it,p:lt}=et(i?this:this.material);if(bn(it,lt,nt,!0),typeof s=="function"){const dt=[lt,nt];if(s.name){const pt=this[s.name];pt===s?s.call(this,...dt):pt.name===`bound ${s.name}`?pt(...dt):s(...dt)}else s(...dt)}else bn(i?this:this.material,"needsUpdate",!0,!0)}})}}function Nr(c){const e=new b.IEO(new Uint8Array([Math.floor(255*c.r),Math.floor(255*c.g),Math.floor(255*c.b),255]),1,1,b.wk1,b.ywz);return e.needsUpdate=!0,e.encoding=b.rnI,e}function kr(c){const e=new b.IEO(new Uint8Array([Math.floor(255*c.x),Math.floor(255*c.y),Math.floor(255*c.z),Math.floor(255*c.w)]),1,1,b.wk1,b.ywz);return e.needsUpdate=!0,e}function jr(c,e,i){const s=c.userData,{backgroundRender:a,transparentRender:h,shadowMapRender:d,mainRenderPass:_,opaqueRender:et,transmissionRender:nt,sceneRender:it,screenSpaceRendering:lt}=s;e.backgroundRender!==void 0&&(s.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(s.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(s.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(s.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(s.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(s.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(s.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(s.screenSpaceRendering=e.screenSpaceRendering),i(),s.backgroundRender=a,s.transparentRender=h,s.shadowMapRender=d,s.mainRenderPass=_,s.opaqueRender=et,s.sceneRender=it,s.transmissionRender=nt,s.screenSpaceRendering=lt}function Ss(c){const e=new Dr().expandByObject(c,!0,!0).getCenter(new b.Pa4);c.position.sub(e),c.updateMatrix(),c.userData.autoCentered=!0}function zs(c,e){const i=.5*new Dr().expandByObject(c,!0,!0).getSize(new b.Pa4).length();e===void 0&&(e=c.userData.autoScaleRadius||1);const s=e/i;return isFinite(s)&&(c.userData.pseudoCentered?c.children.forEach(a=>{a.scale.multiplyScalar(s)}):c.scale.multiplyScalar(s)),c.traverse(a=>{var h,d;a.isLight&&(!((d=(h=a.shadow)===null||h===void 0?void 0:h.camera)===null||d===void 0)&&d.right)&&(a.shadow.camera.right*=s,a.shadow.camera.left*=s,a.shadow.camera.top*=s,a.shadow.camera.bottom*=s),a.isCamera&&a.right&&(a.right*=s,a.left*=s,a.top*=s,a.bottom*=s)}),c.userData.autoScaled=!0,c.userData.autoScaleRadius=e,c.dispatchEvent({type:"objectUpdate"}),c}function Ao(c,e=-1){return function(i,s=1e-4){const a=s>0;s=Math.max(s,Number.EPSILON);const h={},d=i.getIndex(),_=i.getAttribute("position"),et=d?d.count:_.count;let nt=0;const it=Object.keys(i.attributes),lt={},dt={},pt=[],gt=["getX","getY","getZ","getW"];for(let xt=0,_t=it.length;xt<_t;xt++){const Pt=it[xt];lt[Pt]=[];const Rt=i.morphAttributes[Pt];Rt&&(dt[Pt]=new Array(Rt.length).fill().map(()=>[]))}const vt=Math.log10(1/s),Ct=Math.pow(10,vt);for(let xt=0;xt<et;xt++){const _t=d?d.getX(xt):xt;let Pt="";for(let Rt=0,Lt=it.length;Rt<Lt&&a;Rt++){const Ot=it[Rt],qt=i.getAttribute(Ot),en=qt.itemSize;for(let cn=0;cn<en;cn++)Pt+=~~(qt[gt[cn]](_t)*Ct)+","}if(a&&Pt in h)pt.push(h[Pt]);else{for(let Rt=0,Lt=it.length;Rt<Lt;Rt++){const Ot=it[Rt],qt=i.getAttribute(Ot),en=i.morphAttributes[Ot],cn=qt.itemSize,An=lt[Ot],fn=dt[Ot];for(let Tn=0;Tn<cn;Tn++){const gn=gt[Tn];if(An.push(qt[gn](_t)),en)for(let xn=0,Nn=en.length;xn<Nn;xn++)fn[xn].push(en[xn][gn](_t))}}a&&(h[Pt]=nt),pt.push(nt),nt++}}const wt=i.clone();for(let xt=0,_t=it.length;xt<_t;xt++){const Pt=it[xt],Rt=i.getAttribute(Pt),Lt=new Rt.array.constructor(lt[Pt]),Ot=new b.TlE(Lt,Rt.itemSize,Rt.normalized);if(wt.setAttribute(Pt,Ot),Pt in dt)for(let qt=0;qt<dt[Pt].length;qt++){const en=i.morphAttributes[Pt][qt],cn=new en.array.constructor(dt[Pt][qt]),An=new b.TlE(cn,en.itemSize,en.normalized);wt.morphAttributes[Pt][qt]=An}}return wt.setIndex(pt),wt}(c,e)}class Zs extends st{constructor({animationLoop:e,canvas:i,alpha:s=!0,targetOptions:a}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new b.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new b.CP7({canvas:i,antialias:!0,alpha:s,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new b.FM8(i.clientWidth,i.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=b.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=b.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=b._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(a,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new wn(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,i,s;const a=this._passes,h=[],d={};for(const _ of a){if(_.enabled===!1)continue;const et={after:(e=_.after)!==null&&e!==void 0?e:[],before:(i=_.before)!==null&&i!==void 0?i:[],dependencies:new Set((s=_.required)!==null&&s!==void 0?s:[])};d[_.passId]=et}for(const[_,et]of Object.entries(d)){const nt=new Set([...et.after,...et.before]);et.dependencies.forEach(it=>nt.has(it)&&nt.delete(it)),nt.forEach(it=>{const lt=d[it];if(lt){if(lt.dependencies.has(_))throw console.error("cyclic",_,it),"Cyclic dependency";et.dependencies.add(it)}})}for(;;){let _=!1;const et=[...Object.entries(d)];for(const[nt,it]of et)if(!h.includes(nt)&&er(h,it.dependencies.values())){const lt=Math.max(-1,...it.after.map(pt=>h.indexOf(pt))),dt=Math.min(h.length,...it.before.map(pt=>{const gt=h.indexOf(pt);return gt<0?h.length:gt}));if(lt>=dt)throw console.error(it,a,h,lt,dt),"Not possible";h.splice(it.after.length>0?lt+1:dt,0,nt),_=!0,delete d[nt]}if(Object.keys(d).length<1)break;if(!_)throw console.log(et,d,h),"Not possible 2"}return this.pipeline=h,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,i){const s=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=s,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:s,time:e,renderer:this,xrFrame:i}))}get clock(){return this._composer.clock}registerPass(e,i=!0){var s;if(i)for(const a of[...this._passes])e.passId===a.passId&&this.unregisterPass(a);this._passes.push(e),(s=e.onRegister)===null||s===void 0||s.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var i;const s=this._passes.indexOf(e);s>=0&&((i=e.onUnregister)===null||i===void 0||i.call(e,this),this._passes.splice(s,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,i,s=!1){!s&&(e?Math.abs(e-this._renderSize.width):0)+(i?Math.abs(i-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),i&&(this._renderSize.height=i),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(a=>{const h=a,d=h.sizeMultiplier;if(d){const _=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*d);h.setSize(_.width,_.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,i,{viewport:s,material:a,shader:h,pass:d,clear:_=!0}={}){const et=this._composer.copyPass,{renderToScreen:nt,material:it,uniforms:lt,clear:dt}=et;a&&(et.material=a);const pt=this._renderer.getViewport(new b.Ltg),gt=this._renderer.autoClear,vt=this._renderer.getRenderTarget();s&&this._renderer.setViewport(new b.Ltg().fromArray(s)),this._renderer.autoClear=!1,et.uniforms=et.material.uniforms,et.renderToScreen=!1,et.clear=_,jr(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{et.render(this._renderer,i??null,{texture:e},0,!1)}),et.renderToScreen=nt,et.clear=dt,et.material=it,et.uniforms=lt,this._renderer.autoClear=gt,s&&this._renderer.setViewport(pt),this._renderer.setRenderTarget(vt)}clearColor({r:e,g:i,b:s,a,target:h,depth:d=!0,stencil:_=!0}){var et;const nt=this._renderer.getClearColor(new b.Ilk),it=this._renderer.getClearAlpha();this._renderer.setClearAlpha(a??it),this._renderer.setClearColor(new b.Ilk(e??nt.r,i??nt.g,s??nt.b));const lt=this._renderer.getRenderTarget(),dt=this._renderer.getActiveCubeFace(),pt=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((et=h)!==null&&et!==void 0?et:null),this._renderer.clear(!0,d,_),this._renderer.setRenderTarget(lt,dt,pt),this._renderer.setClearColor(nt),this._renderer.setClearAlpha(it)}renderModel(e,i){this._renderer.render(e.modelObject,i.cameraObject)}renderScene(e){const i=e.activeCamera;i&&this.renderModel(e,i)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const i of this._passes)i.passObject.enabled&&((e=i.update)===null||e===void 0||e.call(i));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const i of this._pipeline){const s=this._passes.find(a=>a.passId===i);s?e.push(s.passObject):console.warn("Unable to find pass: ",i)}[...this._composer.passes].forEach(i=>this._composer.removePass(i)),e.forEach(i=>this._composer.addPass(i)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const i=this._trackedTargets.indexOf(e);i>=0&&this._trackedTargets.splice(i,1)}createTarget({sizeMultiplier:e,samples:i=0,encoding:s=b.rnI,type:a=b.ywz,format:h=b.wk1,depthBuffer:d=!0,depthTexture:_=!1,size:et,textureCount:nt=1,...it}={},lt=!0){this.isWebGL2||(i=0),e!==void 0&&et!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),et=et||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const dt=_?new b.$YQ(et.width,et.height,b.ywz):void 0,pt=this.createTargetCustom(nt>1?{width:et.width,height:et.height,count:nt}:et,{samples:i,encoding:s,type:a,format:h,depthBuffer:d,depthTexture:dt},nt>1?b.kFz:b.dd2);return this._processNewTarget(pt,e,lt),this._setTargetOptions(pt,it),pt}_processNewTarget(e,i,s){return i!==void 0&&(e.sizeMultiplier=i),s&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:i,count:s},a={},h){var d;const _=this._processNewTarget;let et=[e,i];if(s&&s>1&&et.push(s),(h==null?void 0:h.prototype)===b.oAp.prototype){if(e!==i)throw"Width and height of cube render target must be equal";et=[e]}a={format:b.wk1,minFilter:b.wem,magFilter:b.wem,generateMipmaps:!1,type:b.ywz,encoding:b.rnI,...a};const nt=[...et,a];return new class extends((d=h)!==null&&d!==void 0?d:b.dd2){constructor(...it){super(...it),Array.isArray(this.texture)?this.texture.forEach(lt=>{lt.encoding=a.encoding,lt.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(it=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const lt=super.clone();return lt.texture.isRenderTargetTexture=!0,_(lt,this.sizeMultiplier||1,it)}}(...nt)}getTempTarget(e={}){var i;const s=Lo(e);let a;return!((i=this._tempTargets[s])===null||i===void 0)&&i.length&&(a=this._tempTargets[s].pop()),a?this._setTargetOptions(a,e):(a=this.createTarget(e),this._processNewTempTarget(a,s)),a}_processNewTempTarget(e,i){return e.isTemporary=!0,e.targetKey=i,this._tempTargets[i]===void 0&&(this._tempTargets[i]=[]),e}releaseTempTarget(e){const i=e.targetKey;if(!i||!e.isTemporary)throw"Not a temp target";this._tempTargets[i].length>this.maxTempPerKey?e.dispose():this._tempTargets[i].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,i){var s,a,h;e.texture.minFilter=(s=i.minFilter)!==null&&s!==void 0?s:b.wem,e.texture.magFilter=(a=i.magFilter)!==null&&a!==void 0?a:b.wem,e.texture.generateMipmaps=(h=i.generateMipmaps)!==null&&h!==void 0&&h,e.texture.generateMipmaps&&e.texture.minFilter===b.wem&&(e.texture.minFilter=b.FDw),e.texture.generateMipmaps||e.texture.minFilter!==b.FDw||(e.texture.minFilter=b.wem)}}function Lo(c={}){var e,i;return[c.sizeMultiplier,c.samples,c.encoding,c.type,c.format,c.depthBuffer,c.depthTexture,(e=c.size)===null||e===void 0?void 0:e.width,(i=c.size)===null||i===void 0?void 0:i.height].join(";")}const $s=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function qo(){const c=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,s=4294967295*Math.random()|0;return($s[255&c]+$s[c>>8&255]+$s[c>>16&255]+$s[c>>24&255]+"-"+$s[255&e]+$s[e>>8&255]+"-"+$s[e>>16&15|64]+$s[e>>24&255]+"-"+$s[63&i|128]+$s[i>>8&255]+"-"+$s[i>>16&255]+$s[i>>24&255]+$s[255&s]+$s[s>>8&255]+$s[s>>16&255]+$s[s>>24&255]).toLowerCase()}function yo(c,e,i){return Math.max(e,Math.min(i,c))}function Hu(c,e,i){return(1-i)*c+i*e}const vu=0,ba=1,Ro=3,Gl=4,To=1006,Wu="srgb",Pu="srgb-linear";function Oo(c){return c<.04045?.0773993808*c:Math.pow(.9478672986*c+.0521327014,2.4)}function Yp(c){return c<.0031308?12.92*c:1.055*Math.pow(c,.41666)-.055}const Yo={[Wu]:{[Pu]:Oo},[Pu]:{[Wu]:Yp}},_u={legacyMode:!0,get workingColorSpace(){return Pu},set workingColorSpace(c){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(c,e,i){if(this.legacyMode||e===i||!e||!i)return c;if(Yo[e]&&Yo[e][i]!==void 0){const s=Yo[e][i];return c.r=s(c.r),c.g=s(c.g),c.b=s(c.b),c}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(c,e){return this.convert(c,this.workingColorSpace,e)},toWorkingColorSpace:function(c,e){return this.convert(c,e,this.workingColorSpace)}},g1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xo={r:0,g:0,b:0},Xp={h:0,s:0,l:0},Ko={h:0,s:0,l:0};function Gm(c,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?c+6*(e-c)*i:i<.5?e:i<2/3?c+6*(e-c)*(2/3-i):c}function fA(c,e){return e.r=c.r,e.g=c.g,e.b=c.b,e}class vo{constructor(e,i,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,i===void 0&&s===void 0?this.set(e):this.setRGB(e,i,s)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,i="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,_u.toWorkingColorSpace(this,i),this}setRGB(e,i,s,a="srgb-linear"){return this.r=e,this.g=i,this.b=s,_u.toWorkingColorSpace(this,a),this}setHSL(e,i,s,a="srgb-linear"){if(e=function(h,d){return(h%d+d)%d}(e,1),i=yo(i,0,1),s=yo(s,0,1),i===0)this.r=this.g=this.b=s;else{const h=s<=.5?s*(1+i):s+i-s*i,d=2*s-h;this.r=Gm(d,h,e+1/3),this.g=Gm(d,h,e),this.b=Gm(d,h,e-1/3)}return _u.toWorkingColorSpace(this,a),this}setStyle(e,i="srgb"){function s(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let a;if(a=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let h;const d=a[1],_=a[2];switch(d){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_))return this.r=Math.min(255,parseInt(h[1],10))/255,this.g=Math.min(255,parseInt(h[2],10))/255,this.b=Math.min(255,parseInt(h[3],10))/255,_u.toWorkingColorSpace(this,i),s(h[4]),this;if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_))return this.r=Math.min(100,parseInt(h[1],10))/100,this.g=Math.min(100,parseInt(h[2],10))/100,this.b=Math.min(100,parseInt(h[3],10))/100,_u.toWorkingColorSpace(this,i),s(h[4]),this;break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(_)){const et=parseFloat(h[1])/360,nt=parseFloat(h[2])/100,it=parseFloat(h[3])/100;return s(h[4]),this.setHSL(et,nt,it,i)}}}else if(a=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=a[1],d=h.length;if(d===3)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,_u.toWorkingColorSpace(this,i),this;if(d===6)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,_u.toWorkingColorSpace(this,i),this}return e&&e.length>0?this.setColorName(e,i):this}setColorName(e,i="srgb"){const s=g1[e.toLowerCase()];return s!==void 0?this.setHex(s,i):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Oo(e.r),this.g=Oo(e.g),this.b=Oo(e.b),this}copyLinearToSRGB(e){return this.r=Yp(e.r),this.g=Yp(e.g),this.b=Yp(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return _u.fromWorkingColorSpace(fA(this,Xo),e),yo(255*Xo.r,0,255)<<16^yo(255*Xo.g,0,255)<<8^yo(255*Xo.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,i="srgb-linear"){_u.fromWorkingColorSpace(fA(this,Xo),i);const s=Xo.r,a=Xo.g,h=Xo.b,d=Math.max(s,a,h),_=Math.min(s,a,h);let et,nt;const it=(_+d)/2;if(_===d)et=0,nt=0;else{const lt=d-_;switch(nt=it<=.5?lt/(d+_):lt/(2-d-_),d){case s:et=(a-h)/lt+(a<h?6:0);break;case a:et=(h-s)/lt+2;break;case h:et=(s-a)/lt+4}et/=6}return e.h=et,e.s=nt,e.l=it,e}getRGB(e,i="srgb-linear"){return _u.fromWorkingColorSpace(fA(this,Xo),i),e.r=Xo.r,e.g=Xo.g,e.b=Xo.b,e}getStyle(e="srgb"){return _u.fromWorkingColorSpace(fA(this,Xo),e),e!==Wu?`color(${e} ${Xo.r} ${Xo.g} ${Xo.b})`:`rgb(${255*Xo.r|0},${255*Xo.g|0},${255*Xo.b|0})`}offsetHSL(e,i,s){return this.getHSL(Xp),Xp.h+=e,Xp.s+=i,Xp.l+=s,this.setHSL(Xp.h,Xp.s,Xp.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,i){return this.r=e.r+i.r,this.g=e.g+i.g,this.b=e.b+i.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,i){return this.r+=(e.r-this.r)*i,this.g+=(e.g-this.g)*i,this.b+=(e.b-this.b)*i,this}lerpColors(e,i,s){return this.r=e.r+(i.r-e.r)*s,this.g=e.g+(i.g-e.g)*s,this.b=e.b+(i.b-e.b)*s,this}lerpHSL(e,i){this.getHSL(Xp),e.getHSL(Ko);const s=Hu(Xp.h,Ko.h,i),a=Hu(Xp.s,Ko.s,i),h=Hu(Xp.l,Ko.l,i);return this.setHSL(s,a,h),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,i=0){return this.r=e[i],this.g=e[i+1],this.b=e[i+2],this}toArray(e=[],i=0){return e[i]=this.r,e[i+1]=this.g,e[i+2]=this.b,e}fromBufferAttribute(e,i){return this.r=e.getX(i),this.g=e.getY(i),this.b=e.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function Qo(c,e){const i=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!c[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!i&&c.map,bounds:[-100,100],stepSize:.001,property:[c[e],"repeat"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"offset"],onChange:c==null?void 0:c.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!i&&c.map,bounds:[-2,2],property:[c[e],"center"],onChange:c==null?void 0:c.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!i&&c.map,bounds:[-Math.PI,Math.PI],property:[c[e],"rotation"],onChange:c==null?void 0:c.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[c[e],"encoding"],children:[["Linear",b.rnI],["sRGB",b.knz]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{const s=c[e];s&&(s.needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var s,a;return(a=(s=c[e])===null||s===void 0?void 0:s.flipY)!==null&&a!==void 0&&a},setValue:s=>{var a;const h=c[e];if(h&&h.flipY!==s)if(h.image&&ImageBitmap&&h.image instanceof ImageBitmap){const d=h,_=h.source.data;createImageBitmap(_,{imageOrientation:"flipY"}).then(et=>{var nt;_.close&&_.close(),d.flipY=s,d.source.data=et,d.source.needsUpdate=!0,d.needsUpdate=!0,(nt=c==null?void 0:c.setDirty)===null||nt===void 0||nt.call(c)})}else h.flipY=s,h.needsUpdate=!0,(a=c==null?void 0:c.setDirty)===null||a===void 0||a.call(c)}}),()=>({type:"dropdown",label:"Wrap S",property:[c[e],"wrapS"],children:[["ClampToEdge",b.uWy],["MirroredRepeat",b.OoA],["Repeat",b.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[c[e],"wrapT"],children:[["ClampToEdge",b.uWy],["MirroredRepeat",b.OoA],["Repeat",b.rpg]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[c[e],"anisotropy"],onChange:[()=>{c[e]&&(c[e].needsUpdate=!0),c.needsUpdate=!0},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[c[e],"minFilter"],children:[["Linear",To],["Nearest",b.TyD],["NearestMipmapNearest",b.YLQ],["NearestMipmapLinear",b.vZf],["LinearMipmapNearest",b.qyh],["LinearMipmapLinear",b.D1R]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[c[e],"magFilter"],children:[["Linear",To],["Nearest",b.TyD]].map(s=>({label:s[0],value:s[1]})),onChange:[()=>{c[e]&&(c[e].needsUpdate=!0)},c==null?void 0:c.setDirty]})]}}vo.NAMES=g1;const vm=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function qu(c,e){if(e)for(const i of Object.keys(e))vm.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const ly=["appliedMaterials","uuid"];function mA(c,e){if(e)for(const i of Object.keys(e))ly.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}const c_=new Map;function jn(c){return(e,i)=>{const s=e.constructor;if(s===Object)throw new Error("All properties in an object are serialized by default");c_.has(s)||c_.set(s,[]),c_.get(s).push([c||i,i])}}const Hl={obj:(c,e)=>Object.fromEntries(Object.entries(c).map(([i,s])=>[i,so(s,!1,e)])),vec4:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isVector4:!0}),vec3:c=>({x:c.x,y:c.y,z:c.z,isVector3:!0}),vec2:c=>({x:c.x,y:c.y,isVector2:!0}),color:c=>({r:c.r,g:c.g,b:c.b,isColor:!0}),quat:c=>({x:c.x,y:c.y,z:c.z,w:c.w,isQuaternion:!0}),texture:(c,e)=>{if(!(c!=null&&c.isTexture))throw new Error("Expected a texture");if(c.isRenderTargetTexture)return;if(e!=null&&e.textures[c.uuid])return{uuid:c.uuid,resource:"textures"};const i=c.source.data;c.userData.rootPath&&(c.source.data=null);const s=c.userData;c.userData={};let a=c.toJSON(e);return c.userData=s,a.userData=so(mA({},s),!1,e),c.userData.rootPath&&(delete e.images[c.source.uuid],c.source.data=i),e!=null&&e.textures&&(e.textures[a.uuid]||(e.textures[a.uuid]=a),a={uuid:a.uuid,resource:"textures"}),a},material:(c,e)=>{var i;if(!(c!=null&&c.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[c.uuid])return{uuid:c.uuid,resource:"materials"};c.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const s=e??{textures:{},images:{}},a={},h={};for(const[_,et]of Object.entries(c))if(!((i=et)===null||i===void 0)&&i.isTexture&&!_.startsWith("__")){const nt=Hl.texture(et,s);a[_]=nt,h[_]=et,c[_]=nt?{isTexture:!0,toJSON:()=>nt}:null}let d=c.toJSON(e);for(const[_,et]of Object.entries(h))c[_]=et,delete h[_];if(e){for(const[_,et]of Object.entries(a))et&&(d[_]=et);e!=null&&e.materials&&(e.materials[d.uuid]||(e.materials[d.uuid]=d),d={uuid:d.uuid,resource:"materials"})}else{for(const[_,et]of Object.entries(a))d[_]=et.uuid;d.textures=Object.values(s.textures),d.images=Object.values(s.images)}return d}},_m=c=>(e,i)=>{var s,a;return(a=(s=i==null?void 0:i.copy)===null||s===void 0?void 0:s.call(i,e))!==null&&a!==void 0?a:new c().copy(e)},Hm={obj:(c,e,i)=>Object.assign(e,Object.fromEntries(Object.entries(c).map(([s,a])=>[s,eo(a,e==null?void 0:e[s],!1,i)]))),vec4:_m(b.Ltg),vec3:_m(b.Pa4),vec2:_m(Ir),color:_m(vo),quat:_m(b._fP)};function so(c,e,i){var s,a;if(typeof c=="function")return;if(Array.isArray(c))return c.map(_=>so(_,!1,i));if(typeof c!="object"){if(typeof c=="number"){if(c===1/0)return"Infinity";if(c===-1/0)return"-Infinity";if(isNaN(c))return"NaN"}return c}if(!c)return c;let h=(s=c.constructor)!==null&&s!==void 0?s:Object;if(h===Object)return Hl.obj(c,i);if(c.isVector2)return Hl.vec2(c);if(c.isVector3)return Hl.vec3(c);if(c.isVector4)return Hl.vec4(c);if(c.isColor)return Hl.color(c);if(c.isQuaternion)return Hl.quat(c);if(c.isTexture)return Hl.texture(c,i);if(c.isMaterial)return Hl.material(c,i);if(!e&&typeof c.toJSON=="function")return c.toJSON(i);const d={};for(;h&&h!==Object;)(a=c_.get(h))===null||a===void 0||a.forEach(([_,et])=>{const nt=c[et];d[_]=so(nt,!1,i)}),h=Object.getPrototypeOf(h);return c.serializableClassId&&(d.serializableClassId=c.serializableClassId),d}function eo(c,e,i,s){var a,h,d;let _=e;if(c===void 0)return _;if(typeof e=="number"){if(c==="Infinity")return 1/0;if(c==="-Infinity")return-1/0;if(c==="NaN")return NaN;if(typeof c=="number"||!c)return c}if(Array.isArray(c)){const it=c.length;Array.isArray(_)||(_=[]);for(let lt=0;lt<it;lt++){const dt=c[lt],pt=_.length>lt?eo(dt,_[lt],!1,s):eo(dt,void 0,!1,s);_.length<=lt?_.push(pt):_[lt]=pt}return _}let et=!1;if(c&&c.resource&&typeof c.resource=="string"&&(c=(a=s[c.resource])===null||a===void 0?void 0:a[c.uuid],et=!0),!_&&c&&!et)if(c.serializableClassId){const it=Sw.get(c.serializableClassId);it&&(_=new it)}else typeof c!="object"||c.constructor&&c.constructor!==Object||(_={});if(typeof _=="function")return console.error("cannot deserialize over function",_,c),_;if(c&&typeof c=="object"&&!et){if(c.isVector2)return Hm.vec2(c,_);if(c.isVector3)return Hm.vec3(c,_);if(c.isVector4)return Hm.vec4(c,_);if(c.isColor)return Hm.color(c,_);if(c.isQuaternion)return Hm.quat(c,_)}if(c==null||_==null||typeof _!="object"||_.isTexture)return et&&(c?c.__useCount=c.__useCount?c.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),c;let nt=(h=_.constructor)!==null&&h!==void 0?h:Object;if(nt===Object)return Hm.obj(c,_,s);if(!i&&typeof _.fromJSON=="function")return _.isMaterial&&(Object.entries(c).forEach(([it,lt])=>{var dt;if(!lt||!lt.resource||typeof lt.resource!="string")return;const pt=(dt=s[lt.resource])===null||dt===void 0?void 0:dt[lt.uuid];c[it]=pt||null}),c.userData&&(c.userData=eo(c.userData,void 0,!1,s))),_.fromJSON(c,s),_;for(;nt&&nt!==Object;)(d=c_.get(nt))===null||d===void 0||d.forEach(([it,lt])=>{const dt=_[lt],pt=eo(c[it],dt,!1,s);pt!==dt&&bn(_,lt,pt,!0)}),nt=Object.getPrototypeOf(nt);return _}const Sw=new Map;function Cw(c){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=c}},Sw.set(c,e),e)}function Yu(c,e){if(c.uiConfig)return c.uiConfig;const i={type:"folder",label:c.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[c,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{c.dispatchEvent({type:"select",ui:!0,value:c,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!c.parent,value:()=>{const a=c.parent;a&&a.dispatchEvent({type:"select",ui:!0,value:a})}},{type:"input",label:"Name",property:[c,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!c.isMesh,property:[c,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!c.isMesh,property:[c,"receiveShadow"]},{type:"vec3",label:"Position",property:[c,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[c,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[c,"scale"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",c.userData.autoScaleRadius||"2",!0],value:a=>{if(!a)return;const h=parseFloat(a);Math.abs(h)>0&&zs(c,h)}},c.userData.license!==void 0?{type:"input",label:"License/Credits",property:[c.userData,"license"],limitedUi:!0}:{}]},s=c;if(s!=null&&s.isMesh&&e!==!1){const a=[()=>{var h;return(h=s.geometry)===null||h===void 0?void 0:h.uiConfig},()=>{var h;return Array.isArray(s.material)?s.material.length<1?void 0:{label:"Materials",type:"folder",children:s.material.map(d=>d==null?void 0:d.uiConfig).filter(d=>d)}:(h=s.material)===null||h===void 0?void 0:h.uiConfig}];i.children.push(...a)}if(c!=null&&c.isCamera){const a=[{type:"button",label:"Set View",value:()=>{c.dispatchEvent({type:"setView",ui:!0,camera:c})}},{type:"button",label:"Activate main",hidden:()=>{var h;return(h=c.userData.iCamera)===null||h===void 0?void 0:h.isActiveCamera},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:c})}},{type:"button",label:"Deactivate main",hidden:()=>{var h;return!(!((h=c.userData.iCamera)===null||h===void 0)&&h.isActiveCamera)},value:()=>{c.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];i.children.push(...a)}return c.uiConfig=i,i}function Ap(c,e,i){var s;if(!c)return void console.warn("setupIModel: object is undefined");if(c.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",c),delete c.__disposed),c.userData||(c.userData={}),c.userData.__iModelSetup&&c.modelObject)return c;c.userData.__iModelSetup=!0;let a=[];a.push(()=>{[...c.children].forEach(gt=>{var vt;(vt=gt==null?void 0:gt.dispose)===null||vt===void 0||vt.call(gt)}),c.children=[],c.parent&&c.removeFromParent()}),c.isLight&&!c.assetType?(c.assetType="light",c.lightObject=c):c.isCamera?(c.assetType="camera",c.cameraObject=c):c.assetType||(c.assetType="model"),c.modelObject||(c.modelObject=c),c.setDirty||(c.setDirty=(gt={})=>{c.dispatchEvent({...gt,type:"objectUpdate",object:c})},c.userData.setDirty&&console.warn("userData.setDirty already defined",c.userData.setDirty,c),c.userData.setDirty=gt=>{var vt;console.warn("userData.setDirty is deprecated, use setDirty directly"),(vt=c.setDirty)===null||vt===void 0||vt.call(c,gt)});const h=gt=>{var vt,Ct,wt;const xt=(Ct=(vt=c.parent)===null||vt===void 0?void 0:vt.userData.parentRoot)!==null&&Ct!==void 0?Ct:c.parent;xt!==c.userData.parentRoot&&c.traverse(_t=>{_t.userData.parentRoot=xt}),(wt=c.setDirty)===null||wt===void 0||wt.call(c,{change:"addedToParent"})},d=()=>{var gt;(gt=c.setDirty)===null||gt===void 0||gt.call(c,{change:"removedFromParent"}),c.userData.parentRoot!==void 0&&c.traverse(vt=>{vt.userData.parentRoot=void 0})};c.addEventListener("added",h),c.addEventListener("removed",d),a.push(()=>{c.removeEventListener("added",h),c.removeEventListener("removed",d)});const _=c.dispose;c.dispose=()=>{c.dispatchEvent({type:"dispose"}),_==null||_.call(c)},c.userData.dispose&&console.warn("userData.dispose already defined"),c.userData.dispose=()=>{var gt;console.warn("userData.dispose is deprecated, use dispose directly"),(gt=c.dispose)===null||gt===void 0||gt.call(c)};const et=c;!et.isMesh&&!et.isLine||et.userData.__meshSetup||(et.userData.__meshSetup=!0,et.setMaterial||(et.setMaterial=gt=>cy(et,gt)),et.setGeometry||(et.setGeometry=(gt,vt=!1)=>yp(et,gt,vt),et.setGeometry(et.geometry,!0)),c.userData.setMaterial&&console.warn("userData.setMaterial already defined"),c.userData.setMaterial=gt=>{var vt;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(vt=c.setMaterial)===null||vt===void 0||vt.call(c,gt)},c.userData.setGeometry&&console.warn("userData.setGeometry already defined"),c.userData.setGeometry=(gt,...vt)=>{var Ct;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(Ct=c.setGeometry)===null||Ct===void 0||Ct.call(c,gt,...vt)},c.userData.__keepShadowDef||(c.castShadow=!0,c.receiveShadow=!0,c.userData.__keepShadowDef=!0),a.push(()=>{var gt,vt;const Ct=((gt=et.setMaterial)===null||gt===void 0?void 0:gt.call(et,void 0))||[],wt=(vt=et.setGeometry)===null||vt===void 0?void 0:vt.call(et,void 0);for(const xt of Ct)xt&&xt.userData.__appliedMeshes.size===0&&xt.userData.disposeOnIdle!==!1&&xt.dispose();wt&&wt.userData.__appliedMeshes.size===0&&wt.userData.disposeOnIdle!==!1&&wt.dispose()})),c.uiConfig||c.assetType!=="model"&&c.assetType!=="camera"||(Yu(c),a.push(()=>{c.uiConfig=void 0}));const nt=()=>{var gt,vt;return(vt=(gt=c.uiConfig)===null||gt===void 0?void 0:gt.uiRefresh)===null||vt===void 0?void 0:vt.call(gt,"postFrame",!0,1)};c.addEventListener("objectUpdate",nt),a.push(()=>c.removeEventListener("objectUpdate",nt)),c.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(c.userData.__autoParentDispatchEvents=c.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],c.isCamera&&c.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(c.userData.parentRoot=e),a.push(()=>{delete c.userData.parentRoot});const it=c.dispatchEvent;c.dispatchEvent=gt=>{var vt;!((vt=c.userData.__autoParentDispatchEvents)===null||vt===void 0)&&vt.includes(gt.type)&&(gt.parentDispatch=!0),gt.parentDispatch&&(Ct=>{var wt;const xt=(wt=c.userData.parentRoot)!==null&&wt!==void 0?wt:c.parent;xt!=null&&xt.modelObject&&xt.dispatchEvent(Ct)})(gt),it.call(c,gt)},a.push(()=>{c.dispatchEvent=it});const lt=c.clone;c.clone=(...gt)=>{const vt=c.userData;c.userData={};let Ct=lt.call(c,...gt);c.userData=vt,ip(Ct.userData,vt);const wt=c.userData.parentRoot;return wt&&wt.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),Ct=Ap(Ct,wt,i),Ct.userData.cloneParent=c.uuid,Ct},a.push(()=>{c.clone=lt});const dt=c.copy;c.copy=(gt,...vt)=>{const Ct=gt.userData;gt.userData={};const wt=dt.call(c,gt,...vt);return gt.userData=Ct,ip(c.userData,gt),wt},a.push(()=>{c.copy=dt});const pt=c.add;return c.add=(...gt)=>(gt.forEach(vt=>Ap(vt,c.userData.parentRoot||c,i)),pt.call(c,...gt)),a.push(()=>{c.add=pt}),c=(s=i==null?void 0:i(c))!==null&&s!==void 0?s:c,a.push(()=>{bn(c,"modelObject",void 0,!0),c.userData={}}),c.addEventListener("dispose",()=>{c.__disposed?console.warn("Object already disposed",c):(c.__disposed=!0,a.forEach(gt=>gt()),a=[])}),[...c.children].forEach(gt=>Ap(gt,c,i)),c}function cy(c,e){var i,s,a,h,d;const _=(Array.isArray(e)?e:[e]).map(it=>it==null?void 0:it.materialObject).filter(it=>it);if(c.material==_||_.length===1&&c.material===_[0])return[];c.userData.__materialUpdater||(c.userData.__materialUpdater=()=>{c.dispatchEvent({type:"materialUpdate"})});const et=Array.isArray(c.material)?[...c.material]:[c.material];for(const it of et)it&&(it.removeEventListener("materialUpdate",c.userData.__materialUpdater),(s=(i=it.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0||s.delete(c));const nt=[];for(const it of _)it.userData.__appliedMeshes||(it.userData.__appliedMeshes=new Set),nt.push(it),it&&(it.addEventListener("materialUpdate",c.userData.__materialUpdater),it.userData.__appliedMeshes.add(c));return c.material=nt.length!==1?nt:(a=nt[0])!==null&&a!==void 0?a:void 0,c.traverseAncestors(it=>{it.isRootScene&&it.refreshEnvMapIntensity(c)}),c.dispatchEvent({type:"materialChanged",material:e}),(d=(h=c.uiConfig)===null||h===void 0?void 0:h.uiRefresh)===null||d===void 0||d.call(h,"postFrame",!0),et}function yp(c,e,i=!1){var s,a,h,d,_,et,nt;c.userData.__objectUpdater||(c.userData.__objectUpdater=dt=>{c.dispatchEvent({...dt,type:"objectUpdate"})});let it=c.geometry;const lt=it;return(it!==e||i)&&(it&&(it.removeEventListener("geometryUpdate",c.userData.__objectUpdater),(a=(s=it.userData)===null||s===void 0?void 0:s.__appliedMeshes)===null||a===void 0||a.delete(c)),it=e,it&&!it.userData.__appliedMeshes&&(it.userData.__appliedMeshes=new Set),c.geometry=(h=it)!==null&&h!==void 0?h:void 0,it&&(it.addEventListener("geometryUpdate",c.userData.__objectUpdater),(_=(d=it.userData)===null||d===void 0?void 0:d.__appliedMeshes)===null||_===void 0||_.add(c))),e&&!e.uiConfig&&(e.uiConfig=function(dt){return{label:"Geometry",type:"folder",children:[{type:"input",property:[dt,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{dt.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||dt.setAttribute("uv2",dt.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var pt,gt,vt;return(vt=(gt=(pt=dt.userData)===null||pt===void 0?void 0:pt.__appliedMeshes)===null||gt===void 0?void 0:gt.size)!==null&&vt!==void 0?vt:0},set value(pt){},disabled:!0}]}}(c.geometry)),c.dispatchEvent({type:"geometryChanged",geometry:e}),(nt=(et=c.uiConfig)===null||et===void 0?void 0:et.uiRefresh)===null||nt===void 0||nt.call(et,"postFrame",!0),lt===it?void 0:lt||void 0}const bv=["appliedMeshes"],gA=["parentRoot","iCamera","iModel"];function ip(c,e){if(e)for(const i of Object.keys(e))gA.includes(i)||i.startsWith("__")||typeof c[i]!="function"&&typeof e[i]!="function"&&(c[i]=e[i]);return c}var uy,v1=new Uint8Array(16);function Ev(){if(!uy&&!(uy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return uy(v1)}for(var rp=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,Sv=function(c){return typeof c=="string"&&rp.test(c)},wo=[],wp=0;wp<256;++wp)wo.push((wp+256).toString(16).substr(1));var Au=function(c,e,i){var s=(c=c||{}).random||(c.rng||Ev)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,e){i=i||0;for(var a=0;a<16;++a)e[i+a]=s[a];return e}return function(h){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,_=(wo[h[d+0]]+wo[h[d+1]]+wo[h[d+2]]+wo[h[d+3]]+"-"+wo[h[d+4]]+wo[h[d+5]]+"-"+wo[h[d+6]]+wo[h[d+7]]+"-"+wo[h[d+8]]+wo[h[d+9]]+"-"+wo[h[d+10]]+wo[h[d+11]]+wo[h[d+12]]+wo[h[d+13]]+wo[h[d+14]]+wo[h[d+15]]).toLowerCase();if(!Sv(_))throw TypeError("Stringified UUID is invalid");return _}(s)};const u_=new Map;function _c(c,e){return(i,s)=>{const a=i.constructor;if(a===Object)throw new Error("All properties in an object are serialized by default");u_.has(a)||u_.set(a,[]);const h=u_.get(a);if(!(h.findIndex(d=>d.propKey===s)<0))throw new Error(`Property ${s} already has a uiConfig decorator`);h.push({params:e||{},propKey:s,uiType:c})}}function ns(c,e){return _c("checkbox",{label:c,params:e})}function a0(c,e){return _c("monitor",{label:c,params:e})}function ss(c,e,i,s){return _c("slider",{label:c,bounds:e,stepSize:i,params:s})}function Kp(c,e,i,s){return _c("vec",{label:c,bounds:e,stepSize:i,params:s})}function Cv(c,e,i){return _c("dropdown",{label:c,children:e,params:i})}function ho(c,e){return _c("button",{label:c,params:e})}function qs(c,e){return _c("input",{label:c,params:e})}function Wm(c,e){return _c("color",{label:c,params:e})}function vA(c,e){return _c("image",{label:c,params:e})}function Mv(c){let e=c==null?void 0:c.constructor;if(!c||!e)return[];const i=[],s=[];for(;e&&e!==Object;)s.push(e),e=Object.getPrototypeOf(e);return s.reverse().forEach(a=>{var h;(h=u_.get(a))===null||h===void 0||h.forEach(({params:d,propKey:_,uiType:et})=>{var nt;let it;if(et||(it=(nt=c[_])===null||nt===void 0?void 0:nt.uiConfig),it||(it={property:[c,_],type:et||"input"}),d){const lt=typeof d.params=="function"?d.params(c):d.params||{};delete d.params,Object.assign(it,{...d,...lt})}i.push(it)})}),i}function l0(c,e,i={}){return{type:"folder",label:c,children:Mv(e),uuid:Au(),...i}}function Ys(c,e){return i=>class extends i{constructor(){super(...arguments),this.uiConfig=l0(c,this,e||{})}}}const hy={type:"change"},c0={type:"start"},Tv={type:"end"};class Iv extends b.pBf{constructor(e,i){super(),this.object=e,this.domElement=i,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new b.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:b.RsA.ROTATE,MIDDLE:b.RsA.DOLLY,RIGHT:b.RsA.PAN},this.touches={ONE:b.QmN.ROTATE,TWO:b.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return _.phi},this.getAzimuthalAngle=function(){return _.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(or){or.addEventListener("keydown",Bs),this._domElementKeyEvents=or},this.saveState=function(){s.target0.copy(s.target),s.position0.copy(s.object.position),s.zoom0=s.object.zoom},this.reset=function(){s.target.copy(s.target0),s.object.position.copy(s.position0),s.object.zoom=s.zoom0,s.object.updateProjectionMatrix(),s.dispatchEvent(hy),s.update(),h=a.NONE},this.update=function(){const or=new b.Pa4,Rr=new b._fP().setFromUnitVectors(e.up,new b.Pa4(0,1,0)),Br=Rr.clone().invert(),Ls=new b.Pa4,So=new b._fP,nn=2*Math.PI;return function(){const On=s.object.position;or.copy(On).sub(s.target),or.applyQuaternion(Rr),_.setFromVector3(or),s.autoRotate&&h===a.NONE&&qt(2*Math.PI/60/60*s.autoRotateSpeed),s.enableDamping?(_.theta+=et.theta*s.dampingFactor,_.phi+=et.phi*s.dampingFactor):(_.theta+=et.theta,_.phi+=et.phi);let on=s.minAzimuthAngle,Qn=s.maxAzimuthAngle;isFinite(on)&&isFinite(Qn)&&(on<-Math.PI?on+=nn:on>Math.PI&&(on-=nn),Qn<-Math.PI?Qn+=nn:Qn>Math.PI&&(Qn-=nn),_.theta=on<=Qn?Math.max(on,Math.min(Qn,_.theta)):_.theta>(on+Qn)/2?Math.max(on,_.theta):Math.min(Qn,_.theta)),_.phi=Math.max(s.minPolarAngle,Math.min(s.maxPolarAngle,_.phi)),_.makeSafe(),Math.abs(et.radius)>0&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*(1+et.radius*(s.enableDamping?s.dampingFactor:1)))),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(et.radius=0)),_.radius*=1+et.radius*(s.enableDamping?s.dampingFactor:1)),Math.abs(nt-1)>1e-5&&(s.dollyZoom&&(s.object.zoom=Math.max(Math.max(s.minZoom,.1),Math.min(Math.min(s.maxZoom,20),s.object.zoom*nt)),s.object.updateProjectionMatrix(),(s.object.zoom>=Math.min(s.maxZoom,20)||s.object.zoom<=Math.max(s.minZoom,.1))&&(nt=1)),_.radius*=nt);let Jn=0;s.autoPushTarget&&_.radius<s.minDistance&&(Jn=s.minDistance-_.radius),_.radius=Math.max(s.minDistance,Math.min(s.maxDistance,_.radius)),s.enableDamping===!0?s.target.addScaledVector(it,s.dampingFactor):s.target.add(it),or.setFromSpherical(_),or.applyQuaternion(Br),On.copy(s.target).add(or),s.target.add(or.normalize().multiplyScalar(-Jn)),s.object.lookAt(s.target);let Vn=!1;return s.enableDamping===!0&&Math.abs(et.theta)+Math.abs(et.phi)+Math.abs(et.radius)+it.length()>.001?(et.theta*=1-s.dampingFactor,et.phi*=1-s.dampingFactor,et.radius*=1-s.dampingFactor,it.multiplyScalar(1-s.dampingFactor),Vn=!0):(et.set(0,0,0),it.set(0,0,0)),nt=1,!!(lt||Vn||Ls.distanceToSquared(s.object.position)>d||8*(1-So.dot(s.object.quaternion))>d)&&(s.dispatchEvent(hy),Ls.copy(s.object.position),So.copy(s.object.quaternion),lt=!1,!0)}}(),this.stopDamping=function(){et.set(0,0,0),it.set(0,0,0)},this.dispose=function(){s.domElement.removeEventListener("contextmenu",Ws),s.domElement.removeEventListener("pointerdown",Mr),s.domElement.removeEventListener("pointercancel",os),s.domElement.removeEventListener("wheel",pr),s.domElement.removeEventListener("pointermove",Tr),s.domElement.removeEventListener("pointerup",Lr),s._domElementKeyEvents!==null&&s._domElementKeyEvents.removeEventListener("keydown",Bs)};const s=this,a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=a.NONE;const d=1e-6,_=new b.$V,et=new b.$V(0,0,0);let nt=1;const it=new b.Pa4;let lt=!1;const dt=new b.FM8,pt=new b.FM8,gt=new b.FM8,vt=new b.FM8,Ct=new b.FM8,wt=new b.FM8,xt=new b.FM8,_t=new b.FM8,Pt=new b.FM8,Rt=[],Lt={};function Ot(){return s.enableDamping?1:Math.pow(.95,s.zoomSpeed)}function qt(or){et.theta-=or}function en(or){et.phi-=or}this.rotateUp=en,this.rotateLeft=qt;const cn=function(){const or=new b.Pa4;return function(Rr,Br){or.setFromMatrixColumn(Br,0),or.multiplyScalar(-Rr),it.add(or)}}(),An=function(){const or=new b.Pa4;return function(Rr,Br){s.screenSpacePanning===!0?or.setFromMatrixColumn(Br,1):(or.setFromMatrixColumn(Br,0),or.crossVectors(s.object.up,or)),or.multiplyScalar(Rr),it.add(or)}}(),fn=function(){const or=new b.Pa4;return function(Rr,Br){const Ls=s.domElement;if(s.object.isPerspectiveCamera){const So=s.object.position;or.copy(So).sub(s.target);let nn=or.length();nn*=Math.tan(s.object.fov/2*Math.PI/180),cn(2*Rr*nn/Ls.clientHeight,s.object.matrix),An(2*Br*nn/Ls.clientHeight,s.object.matrix)}else s.object.isOrthographicCamera?(cn(Rr*(s.object.right-s.object.left)/s.object.zoom/Ls.clientWidth,s.object.matrix),An(Br*(s.object.top-s.object.bottom)/s.object.zoom/Ls.clientHeight,s.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),s.enablePan=!1)}}();function Tn(or,Rr=0){s.object.isPerspectiveCamera?(nt/=or,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius-Rr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom*or)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function gn(or,Rr=0){s.object.isPerspectiveCamera?(nt*=or,et.radius=Math.max(-s.maxZoomSpeed,Math.min(s.maxZoomSpeed,et.radius+Rr))):s.object.isOrthographicCamera?(s.object.zoom=Math.max(s.minZoom,Math.min(s.maxZoom,s.object.zoom/or)),s.object.updateProjectionMatrix(),lt=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),s.enableZoom=!1)}function xn(or){dt.set(or.clientX,or.clientY)}function Nn(or){vt.set(or.clientX,or.clientY)}function Mn(){if(Rt.length===1)dt.set(Rt[0].pageX,Rt[0].pageY);else{const or=.5*(Rt[0].pageX+Rt[1].pageX),Rr=.5*(Rt[0].pageY+Rt[1].pageY);dt.set(or,Rr)}}function Hn(){if(Rt.length===1)vt.set(Rt[0].pageX,Rt[0].pageY);else{const or=.5*(Rt[0].pageX+Rt[1].pageX),Rr=.5*(Rt[0].pageY+Rt[1].pageY);vt.set(or,Rr)}}function rr(){const or=Rt[0].pageX-Rt[1].pageX,Rr=Rt[0].pageY-Rt[1].pageY,Br=Math.sqrt(or*or+Rr*Rr);xt.set(0,Br)}function cr(or){if(Rt.length==1)pt.set(or.pageX,or.pageY);else{const Br=Mo(or),Ls=.5*(or.pageX+Br.x),So=.5*(or.pageY+Br.y);pt.set(Ls,So)}gt.subVectors(pt,dt).multiplyScalar(s.rotateSpeed);const Rr=s.domElement;qt(2*Math.PI*gt.x/Rr.clientHeight),en(2*Math.PI*gt.y/Rr.clientHeight),dt.copy(pt)}function _i(or){if(Rt.length===1)Ct.set(or.pageX,or.pageY);else{const Rr=Mo(or),Br=.5*(or.pageX+Rr.x),Ls=.5*(or.pageY+Rr.y);Ct.set(Br,Ls)}wt.subVectors(Ct,vt).multiplyScalar(s.panSpeed),fn(wt.x,wt.y),vt.copy(Ct)}function xr(or){const Rr=Mo(or),Br=or.pageX-Rr.x,Ls=or.pageY-Rr.y,So=Math.sqrt(Br*Br+Ls*Ls);_t.set(0,So),Pt.set(0,Math.pow(_t.y/xt.y,s.zoomSpeed)),Tn(Pt.y),xt.copy(_t)}function Mr(or){s.enabled!==!1&&(Rt.length===0&&(s.domElement.setPointerCapture(or.pointerId),s.domElement.addEventListener("pointermove",Tr),s.domElement.addEventListener("pointerup",Lr)),function(Rr){Rt.push(Rr)}(or),or.pointerType==="touch"?function(Rr){switch(uo(Rr),Rt.length){case 1:switch(s.touches.ONE){case b.QmN.ROTATE:if(s.enableRotate===!1)return;Mn(),h=a.TOUCH_ROTATE;break;case b.QmN.PAN:if(s.enablePan===!1)return;Hn(),h=a.TOUCH_PAN;break;default:h=a.NONE}break;case 2:switch(s.touches.TWO){case b.QmN.DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;s.enableZoom&&rr(),s.enablePan&&Hn(),h=a.TOUCH_DOLLY_PAN;break;case b.QmN.DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;s.enableZoom&&rr(),s.enableRotate&&Mn(),h=a.TOUCH_DOLLY_ROTATE;break;default:h=a.NONE}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(c0)}(or):function(Rr){let Br;switch(Rr.button){case 0:Br=s.mouseButtons.LEFT;break;case 1:Br=s.mouseButtons.MIDDLE;break;case 2:Br=s.mouseButtons.RIGHT;break;default:Br=-1}switch(Br){case b.RsA.DOLLY:if(s.enableZoom===!1)return;(function(Ls){xt.set(Ls.clientX,Ls.clientY)})(Rr),h=a.DOLLY;break;case b.RsA.ROTATE:if(Rr.ctrlKey||Rr.metaKey||Rr.shiftKey){if(s.enablePan===!1)return;Nn(Rr),h=a.PAN}else{if(s.enableRotate===!1)return;xn(Rr),h=a.ROTATE}break;case b.RsA.PAN:if(Rr.ctrlKey||Rr.metaKey||Rr.shiftKey){if(s.enableRotate===!1)return;xn(Rr),h=a.ROTATE}else{if(s.enablePan===!1)return;Nn(Rr),h=a.PAN}break;default:h=a.NONE}h!==a.NONE&&s.dispatchEvent(c0)}(or))}function Tr(or){s.enabled!==!1&&(or.pointerType==="touch"?function(Rr){switch(uo(Rr),h){case a.TOUCH_ROTATE:if(s.enableRotate===!1)return;cr(Rr),s.update();break;case a.TOUCH_PAN:if(s.enablePan===!1)return;_i(Rr),s.update();break;case a.TOUCH_DOLLY_PAN:if(s.enableZoom===!1&&s.enablePan===!1)return;(function(Br){s.enableZoom&&xr(Br),s.enablePan&&_i(Br)})(Rr),s.update();break;case a.TOUCH_DOLLY_ROTATE:if(s.enableZoom===!1&&s.enableRotate===!1)return;(function(Br){s.enableZoom&&xr(Br),s.enableRotate&&cr(Br)})(Rr),s.update();break;default:h=a.NONE}}(or):function(Rr){switch(h){case a.ROTATE:if(s.enableRotate===!1)return;(function(Br){pt.set(Br.clientX,Br.clientY),gt.subVectors(pt,dt).multiplyScalar(s.rotateSpeed);const Ls=s.domElement;qt(2*Math.PI*gt.x/Ls.clientHeight),en(2*Math.PI*gt.y/Ls.clientHeight),dt.copy(pt),s.update()})(Rr);break;case a.DOLLY:if(s.enableZoom===!1)return;(function(Br){_t.set(Br.clientX,Br.clientY),Pt.subVectors(_t,xt),Pt.y>0?Tn(Ot()):Pt.y<0&&gn(Ot()),xt.copy(_t),s.update()})(Rr);break;case a.PAN:if(s.enablePan===!1)return;(function(Br){Ct.set(Br.clientX,Br.clientY),wt.subVectors(Ct,vt).multiplyScalar(s.panSpeed),fn(wt.x,wt.y),vt.copy(Ct),s.update()})(Rr)}}(or))}function Lr(or){ks(or),Rt.length===0&&(s.domElement.releasePointerCapture(or.pointerId),s.domElement.removeEventListener("pointermove",Tr),s.domElement.removeEventListener("pointerup",Lr)),s.dispatchEvent(Tv),h=a.NONE}function os(or){ks(or)}function pr(or){s.enabled!==!1&&s.enableZoom!==!1&&h===a.NONE&&(or.preventDefault(),s.dispatchEvent(c0),function(Rr){let Br=0;switch(Rr.deltaMode){case 2:Br+=1*Rr.deltaY;break;case 1:Br+=.4*Rr.deltaY;break;default:Br+=.01*Rr.deltaY}Rr.deltaY<0?gn(1,Br*s.zoomSpeed):Rr.deltaY>0&&Tn(1,-Br*s.zoomSpeed),s.update()}(or),s.dispatchEvent(Tv))}function Bs(or){s.enabled!==!1&&s.enablePan!==!1&&function(Rr){let Br=!1;switch(Rr.code){case s.keys.UP:fn(0,s.keyPanSpeed),Br=!0;break;case s.keys.BOTTOM:fn(0,-s.keyPanSpeed),Br=!0;break;case s.keys.LEFT:fn(s.keyPanSpeed,0),Br=!0;break;case s.keys.RIGHT:fn(-s.keyPanSpeed,0),Br=!0}Br&&(Rr.preventDefault(),s.update())}(or)}function Ws(or){s.enabled!==!1&&or.preventDefault()}function ks(or){delete Lt[or.pointerId];for(let Rr=0;Rr<Rt.length;Rr++)if(Rt[Rr].pointerId==or.pointerId)return void Rt.splice(Rr,1)}function uo(or){let Rr=Lt[or.pointerId];Rr===void 0&&(Rr=new b.FM8,Lt[or.pointerId]=Rr),Rr.set(or.pageX,or.pageY)}function Mo(or){const Rr=or.pointerId===Rt[0].pointerId?Rt[1]:Rt[0];return Lt[Rr.pointerId]}this.zoomIn=function(or){Tn(1,or*s.zoomSpeed)},this.zoomOut=function(or){gn(1,or*s.zoomSpeed)},s.domElement.addEventListener("contextmenu",Ws),s.domElement.addEventListener("pointerdown",Mr),s.domElement.addEventListener("pointercancel",os),s.domElement.addEventListener("wheel",pr,{passive:!1}),this.update()}}var xo=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let po=class extends Iv{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(c){super.zoomIn(c)}zoomOut(c){super.zoomOut(c)}dispatchEvent(c){super.dispatchEvent(c)}};xo([jn()],po.prototype,"type",void 0),xo([ns()],po.prototype,"enabled",void 0),xo([ns(),jn()],po.prototype,"dollyZoom",void 0),xo([ns(),jn()],po.prototype,"enableDamping",void 0),xo([qs(),jn()],po.prototype,"dampingFactor",void 0),xo([ns(),jn()],po.prototype,"autoRotate",void 0),xo([qs(),jn()],po.prototype,"autoRotateSpeed",void 0),xo([ns(),jn()],po.prototype,"enableZoom",void 0),xo([qs(),jn()],po.prototype,"zoomSpeed",void 0),xo([qs(),jn()],po.prototype,"maxZoomSpeed",void 0),xo([ns(),jn()],po.prototype,"enableRotate",void 0),xo([qs(),jn()],po.prototype,"rotateSpeed",void 0),xo([ns(),jn()],po.prototype,"enablePan",void 0),xo([qs(),jn()],po.prototype,"panSpeed",void 0),xo([qs(),jn()],po.prototype,"autoPushTarget",void 0),xo([qs(),jn()],po.prototype,"minDistance",void 0),xo([qs(),jn()],po.prototype,"maxDistance",void 0),xo([qs(),jn()],po.prototype,"minZoom",void 0),xo([qs(),jn()],po.prototype,"maxZoom",void 0),xo([qs(),jn()],po.prototype,"minPolarAngle",void 0),xo([qs(),jn()],po.prototype,"maxPolarAngle",void 0),xo([qs(),jn()],po.prototype,"minAzimuthAngle",void 0),xo([qs(),jn()],po.prototype,"maxAzimuthAngle",void 0),xo([jn()],po.prototype,"screenSpacePanning",void 0),xo([jn()],po.prototype,"keyPanSpeed",void 0),po=xo([Ys("Orbit Controls")],po);var qm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Xu extends st{constructor(e,i,s){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=d=>{this.setDirty(d)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new b.Pa4(0,0,10),this._target=new b.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(d,_)=>{const et=new po(d,_.ownerDocument?_:_.documentElement);return et.screenSpacePanning=!0,et}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit","firstPerson","pointerLock",...this._controlsCtors.keys()].map(d=>({label:d===""?"none":d,value:d})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var d;return(d=this._controls)===null||d===void 0?void 0:d.uiConfig},()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomIn?{type:"button",label:"Zoom in",value:()=>{var _;(_=this._controls)===null||_===void 0||_.zoomIn(1)}}:{}},()=>{var d;return!((d=this._controls)===null||d===void 0)&&d.zoomOut?{type:"button",label:"Zoom out",value:()=>{var _;(_=this._controls)===null||_===void 0||_.zoomOut(1)}}:{}}]},this.assetType="model",this.uuid=qo(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=s??document.body;const a=i??this._options;this._camera=this._setCameraObject(e??(a.type==="OrthographicCamera"?new b.iKG(-1,1,1,-1):new b.cPb)),this._camera.modelObject.userData.iCamera=this;const h=e;e&&(h.isPerspectiveCamera?(a.fov=h.fov,a.focus=h.focus,a.aspect=h.aspect<=0||h.userData.autoAspect?"auto":h.aspect,a.zoom=h.zoom):h.isOrthographicCamera&&(a.left=h.left,a.right=h.right,a.top=h.top,a.bottom=h.bottom,a.zoom=h.zoom),a.near=h.near,a.far=h.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(a)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const i=this._target.sub(e).length()>1e-5;this._target.copy(e),i&&this.targetUpdated()}get position(){return this._position}set position(e){const i=this._position.sub(e).length()>1e-5;this._position.copy(e),i&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,i=!0){var s,a;const h={...e};!((s=h.position)===null||s===void 0)&&s.isVector3&&(h.position=[h.position.x,h.position.y,h.position.z]),!((a=h.target)===null||a===void 0)&&a.isVector3&&(h.target=[h.target.x,h.target.y,h.target.z]),Object.keys(h).forEach(d=>d!=="frustumSize"&&h[d]===void 0&&delete h[d]),Object.assign(this._options,h),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),i&&this.setDirty()}_refreshCameraOptions(e=!0){let i=this._camera.modelObject;if(this._options.type!==i.type){const a=this._options.type==="PerspectiveCamera"?new b.cPb:new b.iKG;a.name=this._camera.name,a.near=this._camera.modelObject.near,a.far=this._camera.modelObject.far,a.zoom=this._camera.modelObject.zoom,a.scale.copy(this._camera.modelObject.scale);const h=this._isActiveCamera;h&&this.deactivateMain(),this._camera=this._setCameraObject(a),i=this._camera.modelObject,h&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let s=this._options.aspect;if(s==="auto"&&(s=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(i.fov=this._options.fov,i.focus=this._options.focus,i.aspect=s),this._options.type==="OrthographicCamera"){const a=this._options.frustumSize;a!==void 0?(i.top=a/2,i.bottom=-a/2,i.left=s*a/2,i.right=-s*a/2):(i.top=this._options.top,i.bottom=this._options.bottom,i.left=this._options.left,i.right=this._options.right)}i.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=Ap(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new b._fP))}setControlsCtor(e,i,s=!1){s||!this._controlsCtors.has(e)?this._controlsCtors.set(e,i):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,i,s;const a=this._options.controlsMode;this._controls=(i=(e=this._controlsCtors.get(a))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&i!==void 0?i:void 0,this._controls||console.error("Unable to create controls with mode "+a+". Are you missing a plugin?"),(s=this._controls)===null||s===void 0||s.addEventListener("change",this.setDirty),this._controlsMode=this._controls?a:""}_disposeCameraControls(){var e,i;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(i=this._controls)===null||i===void 0||i.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var i,s;if(this._options.controlsEnabled){const a=this._options.controlsMode;this._controls?this._controlsMode===a&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=a}if(this._controls){const a=this.interactionsEnabled;this._controls.enabled=a,a&&this._camera.modelObject.up.copy(b.Tme.DefaultUp)}e&&this.setDirty(),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i,"postFrame",!1,1)})}activateMain(e=!0){var i,s;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new b.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(s=(i=this._camera).setDirty)===null||s===void 0||s.call(i,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var i,s;const a=this.target;(s=(i=this._controls)===null||i===void 0?void 0:i.target)===null||s===void 0||s.set(a.x,a.y,a.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(a),e&&this.setDirty())}positionUpdated(e=!0){const i=this.position;this._camera.modelObject.position.set(i.x,i.y,i.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,i=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(i).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var i;return!((i=e.uniforms.cameraPositionWorld)===null||i===void 0)&&i.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},so(this,!0,e))}fromJSON(e,i){return eo(e,this,!0,i),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}qm([jn("camControls")],Xu.prototype,"_controls",void 0),qm([jn()],Xu.prototype,"userData",void 0),qm([pn(Xu.prototype._nearFarChanged)],Xu.prototype,"near",void 0),qm([pn(Xu.prototype._nearFarChanged)],Xu.prototype,"far",void 0),qm([jn("camOptions")],Xu.prototype,"_options",void 0),qm([jn("position")],Xu.prototype,"_position",void 0),qm([jn("target")],Xu.prototype,"_target",void 0);var dy=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class u0 extends b.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new Dr,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new Xu(new b.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=Ap(new b.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new b.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(i=>{(Array.isArray(i.material)?i.material:[i.material]).forEach(s=>{s&&s.envMapIntensity!==void 0&&!s.userData.separateEnvMapIntensity&&(s.envMapIntensity=this.envMapIntensity,s.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const i=this.activeCamera;if(e||(e=this.defaultCamera),i!==e){if(i&&(i.deactivateMain(),i.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let s=this._cameras.indexOf(e);s<0&&(this._cameras.push(e),s=this._cameras.length-1),this._activeCamera=s}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:i,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,i={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,i)}addWidget(e,i={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,i={}){return this._addObject3D(e==null?void 0:e.modelObject,i)}addSceneObject(e,i){if(!e)return e;const s=e.assetType;let a=!1;switch(s){case"model":a=e.modelObject.isCamera,a&&(i={...i,autoScale:!1}),this._addModel(e,i);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,i);break;default:console.warn("Unknown asset imported",e,s)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:i=!0,autoScaleRadius:s=2,addToRoot:a=!1}={}){const h=e;h?(i&&!h.userData.autoScaled&&zs(h,h.userData.autoScaleRadius||s),h.traverse(d=>{d.isMesh&&!d.userData.__keepShadowDef&&(d.castShadow=!0,d.receiveShadow=!0,d.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(h),a?this.modelObject.add(h):this.modelRoot.add(h),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var i,s;((i=e.dispose)!==null&&i!==void 0?i:(s=e.modelObject)===null||s===void 0?void 0:s.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(i=>Ap(i))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===b.xfE&&(e.mapping=b.dSO,e.needsUpdate=!0);const i=e.textureObject||e;this.environment=i,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var i;let s;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)s=((i=e)===null||i===void 0?void 0:i.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);s=new b.Ilk(e)}this.background=s,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var i,s,a;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(a=(s=(i=this.boxHelper)===null||i===void 0?void 0:i.box)===null||s===void 0?void 0:s.copy)===null||a===void 0||a.call(s,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new b.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,i){const s=[];return(i??this.modelObject).traverse(a=>{a.name===e&&s.push(a)}),s}addLight(e,i={}){this.addSceneObject(e,i)}_addLight(e,{addToRoot:i=!1}={}){var s;const a=e.lightObject;a&&((s=a.children)===null||s===void 0||s.length,i?this.add(a):this.modelRoot.add(a))}getBounds(e=!1,i=!0){return new Dr().expandByObject(this.modelObject,e,i)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const i=this.getBounds(!1),s=e.cameraObject.getWorldPosition(new b.Pa4).sub(i.getCenter(new b.Pa4)),a=1.5*i.getSize(new b.Pa4).length()/2,h=s.length(),d=Math.max(this.minNearDistance,h-a),_=Math.max(d+1,h+a);e.near=d,e.far=_}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return so(this,!0,e)}fromJSON(e,i){const s=e.environment;return s!==void 0&&(this.setEnvironment(eo(s,this.getEnvironment(),!1,i)),delete e.environment),eo(e,this,!0,i),e.environment=s,this}addEventListener(e,i){super.addEventListener(e,i)}removeEventListener(e,i){super.removeEventListener(e,i)}}function h0(){const c=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return c.style.display="block",c}function h_(c,e){const i=e||"/";return c.join(i)}function eu(c,e){const i=window.URL.createObjectURL(c),s=document.createElement("a");s.style.display="none",s.href=i,s.download=e,document.body.appendChild(s),s.click(),setTimeout(()=>{document.body.removeChild(s),window.URL.revokeObjectURL(i)},1e3)}async function Fl(c){return new Promise((e,i)=>{const s=new FileReader;s.onload=a=>e(s.result),s.onerror=a=>i(s.error),s.onabort=a=>i(new Error("Read aborted")),s.readAsDataURL(c)})}function xp(c,e){return eu(c,e??c.name)}async function d0(c=!1,e=!1,i){const s=document.createElement("input");s.type="file",s.multiple=c,s.accept=i||"*",s.webkitdirectory=e,s.style.display="none",document.body.appendChild(s),s.click();const a=await new Promise(h=>{s.onchange=d=>{h(Array.from(s.files||[]))}});return document.body.removeChild(s),a}function No({innerHTML:c="",id:e,classList:i,addToBody:s=!0,elementTag:a="div"}){const h=document.createElement(a);return e&&(h.id=e),h.innerHTML=c,i&&h.classList.add(...i),s&&document.body.appendChild(h),h}async function py(c){return new Promise((e,i)=>{const s=new Image;s.onload=()=>e(s),s.onerror=i,s.crossOrigin="anonymous",s.decoding="sync",s.src=c})}function Dv(c){const e=document.createElement("style");return e.type="text/css",e.innerText=c,document.head.appendChild(e),e}async function _1(c){return new Promise((e,i)=>{const s=document.createElement("script");s.setAttribute("src",c),s.addEventListener("load",e),s.addEventListener("error",i),document.body.appendChild(s)})}function p0(c,e=8192,i=!1){var s;if(!c.width||!c.height)return"";const a=document.createElement("canvas");a.width=Math.min(e,c.width),a.height=Math.floor(1+a.width*c.height/c.width);const h=c instanceof ImageBitmap,d=h&&i&&Math.abs(a.width-c.width)<.5?a.getContext("bitmaprenderer"):void 0;d?d.transferFromImageBitmap(c):(s=a.getContext("2d"))===null||s===void 0||s.drawImage(c,0,0,a.width,a.height);const _=a.toDataURL("image/png");return a.remove(),h&&i&&c.close(),_}async function Jp(c){return new Promise((e,i)=>{const s=new Image;s.addEventListener("load",()=>{const a=document.createElement("canvas");a.width=s.width,a.height=s.height;const h=a.getContext("2d");if(!h)return void i(new Error("Could not get 2d context"));h.drawImage(s,0,0,a.width,a.height);const d=h.getImageData(0,0,a.width,a.height);e(d),a.remove(),s.remove()},!1),s.addEventListener("error",a=>{s.remove(),i(a)},!1),s.src=c})}function Xs(){return(typeof performance>"u"?Date:performance).now()}function Mw(){let c=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(c=!0),c;var e}function f0(c,e=null){var i;return(i=new URL(window.location.href).searchParams.get(c))!==null&&i!==void 0?i:e}function Ru(c,e,i=!1){const s=new URLSearchParams(location.search);e==null?s.has(c)&&s.delete(c):s.set(c,e),i?window.location.search=s.toString():window.history.replaceState({},"","?"+s.toString())}function d_(c){return c.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function tu(c,{backgroundColor:e="",displayPixelRatio:i=1,width:s=512,height:a=512}){const h=document.createElement("canvas"),d=h.getContext("2d"),_=i,et=s,nt=a;return h.width=et*_,h.height=nt*_,h.style.width=`${et}`,h.style.height=`${nt}`,(e==null?void 0:e.length)>0&&(d.fillStyle=e,d.fillRect(0,0,h.width,h.height)),d.drawImage(c,0,0,h.width,h.height),h}dy([jn()],u0.prototype,"defaultCamera",void 0),dy([pn(u0.prototype.refreshEnvMapIntensity),jn()],u0.prototype,"envMapIntensity",void 0),dy([jn()],u0.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(c,e){const i=new Uint8Array(this);e==null&&(e=i.length);const s=new ArrayBuffer(e-c),a=new Uint8Array(s);for(let h=0;h<a.length;h++)a[h]=i[h+c];return s});class nu{static ApplyMaterialExtensions(e,i,s,a){for(const h of s)this.ApplyMaterialExtension(e,i,h,a)}static ApplyMaterialExtension(e,i,s,a){var h,d;let _=(h=Yt(s.parsFragmentSnippet,a,e))!==null&&h!==void 0?h:"";_.length&&(i.fragmentShader=i.fragmentShader.replace(this.FragVoidMain,`
${_}
${this.FragVoidMain}`)),_=(d=Yt(s.parsVertexSnippet,a,e))!==null&&d!==void 0?d:"",_.length&&(i.vertexShader=i.vertexShader.replace(this.VertVoidMain,`
${_}
${this.VertVoidMain}`)),s.extraUniforms&&(i.uniforms=Object.assign(i.uniforms,s.extraUniforms)),s.shaderExtender&&s.shaderExtender(i,e,a),e.lastShader=i}static CacheKeyForExtensions(e,i){let s="";for(const a of i)s+=this.CacheKeyForExtension(e,a);return s}static CacheKeyForExtension(e,i){let s="";return i.customCacheKey&&(s+=i.customCacheKey),i.computeCacheKey&&(s+=i.computeCacheKey(e)),s}static RegisterExtensions(e,i){const s=[];if(i)for(const a of i)a.isCompatible&&a.isCompatible(e)&&(s.push(a),a.uuid||(a.uuid=Au()),a.setDirty||(a.setDirty=()=>{a.updateVersion||(a.updateVersion=0),a.updateVersion++}));return e.materialExtensions=s,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",a=>function(h,{object:d,renderer:_}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(nt=>{var it,lt;(it=nt.onObjectRender)===null||it===void 0||it.call(nt,d,h,_),h.lastShader&&((lt=Yt(nt.updaters))===null||lt===void 0||lt.forEach(dt=>dt==null?void 0:dt.updateShaderProperties(h.lastShader))),nt.updateVersion!==h.materialObject.userData["_"+nt.uuid+"_version"]&&(h.materialObject.userData["_"+nt.uuid+"_version"]=nt.updateVersion,h.materialObject.needsUpdate=!0)})}(e,a))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",a=>function(h,{object:d,renderer:_}){var et;(et=h.materialExtensions)===null||et===void 0||et.forEach(nt=>{var it;(it=nt.onAfterRender)===null||it===void 0||it.call(nt,d,h,_)})}(e,a))),s}}nu.FragVoidMain="void main() {",nu.VertVoidMain="void main() {";class m0 extends b.jyz{constructor(e){var i;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=nu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...nu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,i){nu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:i}),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+nu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}onAfterRender(e,i,s,a,h){super.onAfterRender(e,i,s,a,h),this.dispatchEvent({type:"afterRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class iu extends m0{constructor(e,i){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(i)}setTextureIds(e){this.textures.map(i=>i.id).join(";")!==e.join(";")&&(this.textures=e.map(i=>({id:i,encoding:b.rnI})),this.setDirty())}_setUniformTexSize(e,i){var s,a,h,d;if(!i||!e)return;const _=(a=(s=i.image)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:512,et=(d=(h=i.image)===null||h===void 0?void 0:h.height)!==null&&d!==void 0?d:512,nt=e.value;nt.isVector2||console.warn("uniform is not a Vector2"),nt&&Math.abs(nt.x-_)+Math.abs(nt.y-et)>.1&&(nt.x=_,nt.y=et,this.uniformsNeedUpdate=!0)}onBeforeRender(e,i,s,a,h){var d,_;this._setUniformTexSize(this.uniforms.screenSize,(d=e.getRenderTarget())===null||d===void 0?void 0:d.texture);for(const et of this.textures){const nt=et.id,it=(_=this.uniforms[nt])===null||_===void 0?void 0:_.value;it&&(this._setUniformTexSize(this.uniforms[nt+"Size"],it),it.encoding!==et.encoding&&(et.encoding=it.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,i,s,a,h)}onBeforeCompile(e,i){e.fragmentShader=this.textures.map(s=>{var a,h;return`uniform sampler2D ${s.id}; 
`+Sr((a=s.id)!==null&&a!==void 0?a:"input",(h=s.encoding)!==null&&h!==void 0?h:b.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function to(c,...e){const i=c.fragmentShader;return new iu({defines:Object.assign({},c.defines),uniforms:c.uniforms,vertexShader:c.vertexShader,fragmentShader:i},e)}class Wl extends an{constructor(e,...i){super(e.isMaterial?e:to(e,...i),i.length<1?Wl.DEFAULT_TEX_ID:i[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,i,s,a;(i=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||i===void 0||i.call(e),(a=(s=this.fsQuad)===null||s===void 0?void 0:s.dispose)===null||a===void 0||a.call(s),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(i=>i==null?void 0:i.updateShaderProperties(this.material)))}render(e,i,s,a,h){this.enabled&&super.render(e,i,s,a,h)}}Wl.DEFAULT_TEX_ID="tDiffuse",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ns("Enabled"),jn()],Wl.prototype,"enabled",void 0);class _o extends Et{constructor(e,i,s,a,h){super(),this.scene=e,this.camera=i,this.overrideMaterial=s,this.clearColor=a,this.clearAlpha=h!==void 0?h:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new b.Ilk}render(e,i,s,a,h,d){const _=e.autoClear;let et,nt;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(nt=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),et=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:s),d){const it=e.getContext();it.framebufferRenderbuffer(it.FRAMEBUFFER,it.DEPTH_ATTACHMENT,it.RENDERBUFFER,d)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),d){const it=e.getContext();it.framebufferRenderbuffer(it.FRAMEBUFFER,it.DEPTH_ATTACHMENT,it.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,et),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=nt),e.autoClear=_}}class fy extends Wl{constructor(e,i="c = a + b;",s="",a){super({vertexShader:yt.vertexShader,fragmentShader:Qt`
                varying vec2 vUv;
                
                ${s}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${i}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:a},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class bp extends b.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new b.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new b.Ltg(1,1,1,1)}},glslVersion:e?b.LSk:b.v9Y})}onBeforeRender(e,i,s,a,h){var d,_,et;let nt=h.material;Array.isArray(nt)&&(nt=nt[0]),this.uniforms.alphaMap.value=(d=nt==null?void 0:nt.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!nt||!nt.alphaTest||nt.alphaTest<1e-7?.001:nt.alphaTest,this.uniforms.flags.value.x=(nt==null?void 0:nt.userData.postTonemap)===!1?0:1,this.uniforms.flags.value.y=nt!=null&&nt.userData._ssBevel?(nt==null?void 0:nt.userData._ssBevel.radius)/255:0,this.uniforms.flags.value.z=(nt!=null&&nt.userData.matId?nt==null?void 0:nt.userData.matId:0)/255,this.uniforms.flags.value.w=nt!=null&&nt.userData.enableLUT?nt==null?void 0:nt.userData.enableLUT:0,this.uniformsNeedUpdate=!0;let it=this.uniforms.alphaMap.value?1:void 0;it!==this.defines.USE_ALPHAMAP&&(it===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=it,this.needsUpdate=!0),it=nt.userData.ALPHA_I_RGBA_PACKING?1:void 0,it!==this.defines.ALPHA_I_RGBA_PACKING&&(it===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=it,this.needsUpdate=!0),it=(_=nt.userData.forcedLinearDepth)!==null&&_!==void 0?_:void 0,it!==this.defines.FORCED_LINEAR_DEPTH&&(it===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=it,this.needsUpdate=!0),this.side=(et=nt.side)!==null&&et!==void 0?et:b.ehD}}var Pv=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const g0={name:"",fog:!0,blending:b.bdR,side:b.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:b.k74,blendDst:b.LgZ,blendEquation:b.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:b.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:b.cum,stencilRef:0,stencilFuncMask:255,stencilFail:b.x5V,stencilZFail:b.x5V,stencilZPass:b.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Jo(c,e,i,{replaceAll:s=!1,prepend:a=!1,append:h=!1}={}){if(!c.includes(e))return console.error(`${e} not found in shader`),c;let d=i;return a?d=i+e:h&&(d=e+i),s?c.replaceAll(e,d):c.replace(e,d)}const Tw={...g0,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:b.IOt,normalScale:new b.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new vo(0),specularColorMap:null},Iw={...Tw,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new b.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new vo(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new vo(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new vo(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class yu extends b.EJi{constructor(e){var i;super(e),this.typeSlug=yu.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.fog=!1,this.userData.enableLUT=!0,this.materialExtensions=nu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...nu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Qo(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Qo(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Qo(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Qo(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",b.IOt],["ObjectSpace",b.PA7]].map(e=>({label:e[0],value:e[1]}))},Qo(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Qo(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Qo(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Qo(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Qo(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Qo(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Qo(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Qo(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Qo(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Qo(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",b.BVF],["Always",b.Se2],["Less",b.Zr5],["LessEqual",b.vCF],["Equal",b.eD],["GreaterEqual",b.ksN],["Greater",b.w$m],["NotEqual",b.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",vu],["Normal",ba],["Additive",b.WMw],["Subtractive",Ro],["Multiply",Gl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Qo(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Qo(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Qo(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",b.Wl3],["Back",b._Li],["Double",b.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:e=>{this.userData.enableLUT=e||void 0,this.setDirty()}},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{eu(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Jo(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Jo(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);nu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+nu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h});const d=this.userData.inverseAlphaMap?1:0;d!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=d,this.needsUpdate=!0)}copyProps(e,i=!1){if(!i&&!["MeshStandardMaterial",yu.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Bn(e,s,Array.from(Object.keys(Iw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&qu(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},qu(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(_=>[_.uuid,_]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(_=>[_.uuid,_]))||[])};h.userData=so(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=yu.TYPE;for(const _ of Object.keys(h))h[_]===void 0&&delete h[_];return h}fromJSON(e,i,s=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new b.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new b.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,s)}clone(){return super.clone()}}yu.TypeSlug="pmat",yu.TYPE="MeshStandardMaterial2";const Dw={...g0,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:b.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class Ep extends b.vBJ{constructor(e){var i;super(e),this.typeSlug=Ep.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=s=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(s)},this.materialExtensions=nu.RegisterExtensions(this,(i=e==null?void 0:e.customMaterialExtensions)!==null&&i!==void 0?i:[])}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...nu.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Qo(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",vu],["Normal",ba],["Additive",b.WMw],["Subtractive",Ro],["Multiply",Gl]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Qo(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Qo(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Qo(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",b.Wl3],["Back",b._Li],["Double",b.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,i,s;return(s=(i=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||i===void 0?void 0:i.size)!==null&&s!==void 0?s:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{eu(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var i;return(i=e.getUiConfig)===null||i===void 0?void 0:i.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,i){const s=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],a=[["#include <uv_vertex>","mainStart"]];for(const h of a)e.vertexShader=Jo(e.vertexShader,h[0],"#glMarker "+h[1]+`
`+h[0]);for(const h of s)e.fragmentShader=Jo(e.fragmentShader,h[0],"#glMarker "+h[1]+`
`+h[0]);nu.ApplyMaterialExtensions(this,e,this.materialExtensions,i),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()+nu.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,i,s,a,h){super.onBeforeRender(e,i,s,a,h),this.dispatchEvent({type:"beforeRender",renderer:e,scene:i,camera:s,geometry:a,object:h})}copyProps(e,i=!1){if(!i&&!["MeshBasicMaterial",Ep.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const s={};Bn(e,s,Array.from(Object.keys(Dw)));const a=s.userData;delete s.userData;for(const h of Object.keys(s))s[h]===void 0&&delete s[h];return this.setValues(s),a&&qu(this.userData,a),this.setDirty(),this}toJSON(e){var i,s;const a=this.userData;this.userData={};const h=super.toJSON(e);this.userData=a,h.userData={},qu(h.userData,a),h.userData.uuid=this.userData.uuid;const d=e||{textures:Object.fromEntries(((i=h.textures)===null||i===void 0?void 0:i.map(_=>[_.uuid,_]))||[]),images:Object.fromEntries(((s=h.images)===null||s===void 0?void 0:s.map(_=>[_.uuid,_]))||[])};h.userData=so(h.userData,!1,d),e||(Object.keys(d.textures).length>0&&(h.textures=Object.values(d.textures)),Object.keys(d.images).length>0&&(h.images=Object.values(d.images))),h.type=Ep.TYPE;for(const _ of Object.keys(h))h[_]===void 0&&delete h[_];return h}fromJSON(e,i,s=!1){return this.copyProps(e,s)}clone(){return super.clone()}}Ep.TypeSlug="bmat",Ep.TYPE="MeshBasicMaterial2";const Rv={materialType:yu.TYPE,name:"standard",color:"#ffffff"},p_={materialType:Ep.TYPE,name:"basic",color:"#ffffff"},A1={[yu.TYPE]:Rv.name,MeshStandardMaterial:Rv.name,MeshPhysicalMaterial:Rv.name,[Ep.TYPE]:p_.name,MeshBasicMaterial:p_.name};class Am extends st{constructor(){super(),this._templates=[Rv,p_],this._materials=[],this._disposeMaterial=e=>{const i=e.target;if(!i||i.assetType!=="material")return;this._refreshTextureRefs();const s=this._getMapsForMaterial(i),a=[];s.forEach(h=>{const d=h.userData.__appliedMaterials;d==null||d.delete(i),d&&h.userData.disposeOnIdle!==!1&&d.size===0&&a.push(h)}),a.forEach(h=>{h.dispose()}),this.unregisterMaterial(i)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,i){let s=this.findMaterial(e);return s||(s=this.generateFromTemplate(e,i)),s}generateFromTemplate(e,i){const s=this.findTemplate(e);if(s)return this._generateFromTemplate(s,i??{})}generateFromTemplateType(e,i){const s=this._templates.find(a=>a.materialType===e);if(s)return this._generateFromTemplate(s,i??{})}findTemplate(e){return this._templates.find(i=>i.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(i=>{let s=i.userData.__appliedMaterials;s||(i.userData.__appliedMaterials=s=new Set),s.add(e)})})}_getMapsForMaterial(e){var i;const s=new Set;for(const a of Object.values(e))a&&a.isTexture&&s.add(a);for(const a of Object.values((i=e.userData)!==null&&i!==void 0?i:{}))a&&a.isTexture&&s.add(a);return s}registerMaterial(e){if(this._materials.includes(e))return;const i=this.findMaterial(e.uuid);i?console.warn("Material UUID already exists",e,i):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const i=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(i),i}unregisterMaterial(e){this._materials=this._materials.filter(i=>i.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=Au());const i=this._templates.find(s=>s.templateUUID===e.templateUUID);i?console.warn("MaterialTemplate already exists",e,i):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(i=>i.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(i=>i.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(i=>i.name===e)}getMaterialsOfType(e){return e?this._materials.filter(i=>i.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,i){return bn(e,"modelObject",this._processModel(e,i)),e}_processMaterial(e,i){var s,a,h;if(!e)return;if(!((s=e.materialObject)===null||s===void 0)&&s.isMaterial)return e;let d=e.mmMaterial;if(!d){const _=((a=e.userData)===null||a===void 0?void 0:a.uuid)||e.uuid;if(d=this.findMaterial(_),d)d.copyProps(e);else{const et=i.useSourceMaterial===!1||!e.isMaterial,nt=(h=i.materialTemplate)!==null&&h!==void 0?h:et?"standard":A1[e.type]||"standard";d=this.generateFromTemplate(nt,et?{}:e)}e.mmMaterial=d}return d}processMaterial(e,i){return i.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...i,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const i=this._materialExtensions.indexOf(e);i>=0&&this._materialExtensions.splice(i,1)}exportMaterial(e,i,s=!0,a=!1){const h=so(e,!1),d=JSON.stringify(h,null,s?0:2),_=(i||e.name||"physical_material")+"."+e.typeSlug,et=new File([d],_,{type:"application/json"});return a&&xp(et),et}}class v0 extends Am{_generateFromTemplate(e,i){var s,a,h,d,_,et;let nt;const it={...e};it.customMaterialExtensions=[...(s=it.customMaterialExtensions)!==null&&s!==void 0?s:[],...this._materialExtensions];let lt={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":i&&Bn(i,it,Array.from(Object.keys(Iw))),(i==null?void 0:i.type)==="MeshBasicMaterial"&&(it.roughness=.9,it.metalness=0,!((a=it.userData)===null||a===void 0)&&a.uuid&&delete it.userData.uuid),lt=(h=it.userData)===null||h===void 0?void 0:h.uuid,lt&&delete it.userData.uuid,nt=new yu({customMaterialExtensions:it.customMaterialExtensions}).fromJSON(it,void 0,!0),lt&&(nt.uuid=lt),nt.userData.uuid=nt.uuid,nt.setDirty(),i!=null&&i.isMaterial&&i.userData!==void 0&&(i.userData.iMaterial=nt);break;case"MeshBasicMaterial2":case"basic":case"unlit":i&&Bn(i,it,Array.from(Object.keys(Dw))),lt=(d=it.userData)===null||d===void 0?void 0:d.uuid,lt&&delete it.userData.uuid,nt=new Ep({customMaterialExtensions:it.customMaterialExtensions}).fromJSON(it,void 0,!0),lt&&(nt.uuid=lt),nt.userData.uuid=nt.uuid,nt.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:lt=null,i&&i.userData&&(lt=i.userData,delete i.userData),nt=((_=e.generator)===null||_===void 0?void 0:_.call(e,it,i))||void 0,i&&lt&&(i.userData=lt),lt&&nt&&(qu(nt.userData,lt),lt!=null&&lt.uuid&&(nt.uuid=lt.uuid),lt=null),nt&&(nt.userData.uuid=nt.uuid)}if(nt){i.runtimeMaterial&&(nt.userData.__runtimeMaterial=!0);const dt=nt;if(nt.clone=()=>{dt.userData.cloneId||(dt.userData.cloneId="0",dt.userData.cloneCount=0),dt.userData.cloneCount+=1;const pt=this.generateFromTemplate(e.name);return pt&&(pt.copyProps(dt),pt.userData.cloneId=pt.userData.cloneId+"_"+dt.userData.cloneCount,pt.userData.cloneCount=0,pt.name=pt.name+"_"+pt.userData.cloneId),pt==null?void 0:pt.materialObject},i){let pt=this.findMaterial(i==null?void 0:i.uuid);pt&&this.unregisterMaterial(pt),pt=this.findMaterial((et=i==null?void 0:i.materialObject)===null||et===void 0?void 0:et.uuid),pt&&this.unregisterMaterial(pt)}return this.registerMaterialObject(dt)}}_processModel(e,i){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let s=e.material;if(!s&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),s=this._defaultMaterial,e.material=s),s){let a=!0;Array.isArray(s)||(s=[s],a=!1);const h=[];for(const d of s){const _=this._processMaterial(d,i);h.push(_==null?void 0:_.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(a?h:h[0]))}if(i.recursive!==!1)for(let a=0;a<e.modelObject.children.length;a++)e.modelObject.children[a]=this._processModel(e.modelObject.children[a],i);return e}}class Zo{constructor(e,i,s,a){this.cls=e,this.ext=i,this.root=s,this.onCtor=a}ctor(e){const i=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(i,e):i}}function my(c){var e;if(!c||c===""||c.match(/__MACOSX\/.*\._/))return"";const i=(e=(c=c.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",s=i.lastIndexOf(".");return i===""||s<1?"":i.slice(s+1)}function gy(c){return c.substring(c.lastIndexOf("/")+1)}class Ym{constructor(e,{pseudoCenter:i=!1,autoCenter:s=!1,autoScale:a=!1,autoScaleRadius:h=2,license:d=""}={}){if(this.assetType="model",this._modelObject=Ap(new b.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!i||e.userData.pseudoCentered||e.userData.isCentered)!s||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?i||s||(e.userData.isCentered=!0):Ss(e),this._modelObject=e;else{s&&console.error("cannot use pseudoCenter and autoCenter at the same time");const _=new Dr().expandByObject(e,!0,!0).getCenter(new b.Pa4);this._modelObject.position.copy(_).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,e.userData.iModel=this}a&&!this._modelObject.userData.autoScaled?zs(this._modelObject,e.userData.autoScaleRadius||h):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=d}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,i){this._modelObject.addEventListener(e,i)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,i){return this._modelObject.hasEventListener(e,i)}removeEventListener(e,i){this._modelObject.removeEventListener(e,i)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var i,s,a,h;(s=(i=this._modelObject)===null||i===void 0?void 0:i.setDirty)===null||s===void 0||s.call(i,e),(h=(a=this._uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}setMaterial(e){var i,s;return this._modelObject.isMesh?((s=(i=this._modelObject).setMaterial)===null||s===void 0?void 0:s.call(i,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,i=!1){var s,a;if(this._modelObject.isMesh)return(a=(s=this._modelObject).setGeometry)===null||a===void 0?void 0:a.call(s,e,i);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Yu(this._modelObject,!1)),this._uiConfig}clone(){return new Ym(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function _0(c,e){return[c.modelObject,...c.modelObject.children].forEach(i=>{Ap(i,i!==c.modelObject?c:void 0,e)}),c}class f_{constructor(){this._processors=new Map}add(e,i){var s;this._processors.has(e)||this._processors.set(e,[]),(s=this._processors.get(e))===null||s===void 0||s.push(i)}remove(e,i){const s=this._processors.get(e),a=(s==null?void 0:s.indexOf(i))||(s==null?void 0:s.findIndex(h=>h.process&&h.process===i.process||h.processAsync&&h.processAsync===i.processAsync));!s||!a||a<0||s.splice(a,1)}get(e){var i;return(i=this._processors.get(e))!==null&&i!==void 0?i:[]}async process(e,i,s){var a,h,d,_;const et=this.get(e),nt=i.assetType;for(const it of et)it.forAssetType===nt&&(i=(h=(a=it.process)===null||a===void 0?void 0:a.call(it,i,s))!==null&&h!==void 0?h:i,i=(_=await((d=it.processAsync)===null||d===void 0?void 0:d.call(it,i,s)))!==null&&_!==void 0?_:i);return i}dispose(){this._processors.clear()}}class vy extends b.hH6{load(e,i,s,a){return super.load(e,h=>{try{if(typeof h!="string")throw new Error("Invalid JSON");i==null||i(JSON.parse(h))}catch(d){a==null||a(d)}},s,a)}}class DS extends b.yxD{constructor(e){super(e),this.type=b.cLu}parse(e){const i=function(et,nt){switch(et){case 1:console.error("THREE.RGBELoader Read Error: "+(nt||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(nt||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(nt||""));break;default:console.error("THREE.RGBELoader: Error: "+(nt||""))}return-1},s=function(et,nt,it){nt=nt||1024;let lt=et.pos,dt=-1,pt=0,gt="",vt=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));for(;0>(dt=vt.indexOf(`
`))&&pt<nt&&lt<et.byteLength;)gt+=vt,pt+=vt.length,lt+=128,vt+=String.fromCharCode.apply(null,new Uint16Array(et.subarray(lt,lt+128)));return-1<dt&&(it!==!1&&(et.pos+=pt+dt+1),gt+vt.slice(0,dt))},a=function(et,nt,it,lt){const dt=et[nt+3],pt=Math.pow(2,dt-128)/255;it[lt+0]=et[nt+0]*pt,it[lt+1]=et[nt+1]*pt,it[lt+2]=et[nt+2]*pt,it[lt+3]=1},h=function(et,nt,it,lt){const dt=et[nt+3],pt=Math.pow(2,dt-128)/255;it[lt+0]=b.A5E.toHalfFloat(Math.min(et[nt+0]*pt,65504)),it[lt+1]=b.A5E.toHalfFloat(Math.min(et[nt+1]*pt,65504)),it[lt+2]=b.A5E.toHalfFloat(Math.min(et[nt+2]*pt,65504)),it[lt+3]=b.A5E.toHalfFloat(1)},d=new Uint8Array(e);d.pos=0;const _=function(et){const nt=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,it=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,lt=/^\s*FORMAT=(\S+)\s*$/,dt=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,pt={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let gt,vt;if(et.pos>=et.byteLength||!(gt=s(et)))return i(1,"no header found");if(!(vt=gt.match(/^#\?(\S+)/)))return i(3,"bad initial token");for(pt.valid|=1,pt.programtype=vt[1],pt.string+=gt+`
`;gt=s(et),gt!==!1;)if(pt.string+=gt+`
`,gt.charAt(0)!=="#"){if((vt=gt.match(nt))&&(pt.gamma=parseFloat(vt[1])),(vt=gt.match(it))&&(pt.exposure=parseFloat(vt[1])),(vt=gt.match(lt))&&(pt.valid|=2,pt.format=vt[1]),(vt=gt.match(dt))&&(pt.valid|=4,pt.height=parseInt(vt[1],10),pt.width=parseInt(vt[2],10)),2&pt.valid&&4&pt.valid)break}else pt.comments+=gt+`
`;return 2&pt.valid?4&pt.valid?pt:i(3,"missing image size specifier"):i(3,"missing format specifier")}(d);if(_!==-1){const et=_.width,nt=_.height,it=function(lt,dt,pt){const gt=dt;if(gt<8||gt>32767||lt[0]!==2||lt[1]!==2||128&lt[2])return new Uint8Array(lt);if(gt!==(lt[2]<<8|lt[3]))return i(3,"wrong scanline width");const vt=new Uint8Array(4*dt*pt);if(!vt.length)return i(4,"unable to allocate buffer space");let Ct=0,wt=0;const xt=4*gt,_t=new Uint8Array(4),Pt=new Uint8Array(xt);let Rt=pt;for(;Rt>0&&wt<lt.byteLength;){if(wt+4>lt.byteLength)return i(1);if(_t[0]=lt[wt++],_t[1]=lt[wt++],_t[2]=lt[wt++],_t[3]=lt[wt++],_t[0]!=2||_t[1]!=2||(_t[2]<<8|_t[3])!=gt)return i(3,"bad rgbe scanline format");let Lt,Ot=0;for(;Ot<xt&&wt<lt.byteLength;){Lt=lt[wt++];const en=Lt>128;if(en&&(Lt-=128),Lt===0||Ot+Lt>xt)return i(3,"bad scanline data");if(en){const cn=lt[wt++];for(let An=0;An<Lt;An++)Pt[Ot++]=cn}else Pt.set(lt.subarray(wt,wt+Lt),Ot),Ot+=Lt,wt+=Lt}const qt=gt;for(let en=0;en<qt;en++){let cn=0;vt[Ct]=Pt[en+cn],cn+=gt,vt[Ct+1]=Pt[en+cn],cn+=gt,vt[Ct+2]=Pt[en+cn],cn+=gt,vt[Ct+3]=Pt[en+cn],Ct+=4}Rt--}return vt}(d.subarray(d.pos),et,nt);if(it!==-1){let lt,dt,pt;switch(this.type){case b.VzW:pt=it.length/4;const gt=new Float32Array(4*pt);for(let Ct=0;Ct<pt;Ct++)a(it,4*Ct,gt,4*Ct);lt=gt,dt=b.VzW;break;case b.cLu:pt=it.length/4;const vt=new Uint16Array(4*pt);for(let Ct=0;Ct<pt;Ct++)h(it,4*Ct,vt,4*Ct);lt=vt,dt=b.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:et,height:nt,data:lt,header:_.string,gamma:_.gamma,exposure:_.exposure,type:dt}}}return null}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){switch(h.type){case b.VzW:case b.cLu:h.encoding=b.rnI,h.minFilter=b.wem,h.magFilter=b.wem,h.generateMipmaps=!1,h.flipY=!0}i&&i(h,d)},s,a)}}function y1(c){Gs.Importers.push(new Zo(class extends DS{constructor(e){super(e),this.setDataType(P1(c))}},["hdr"],!1))}class Xm extends b.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new _A(i)}),this.register(function(i){return new Bu(i)}),this.register(function(i){return new Km(i)}),this.register(function(i){return new ys(i)}),this.register(function(i){return new ym(i)}),this.register(function(i){return new AA(i)}),this.register(function(i){return new yA(i)}),this.register(function(i){return new A0(i)}),this.register(function(i){return new Bv(i)}),this.register(function(i){return new wu(i)}),this.register(function(i){return new Cl(i)}),this.register(function(i){return new Io(i)})}load(e,i,s,a){const h=this;let d;d=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:b.Zp0.extractUrlBase(e),this.manager.itemStart(e);const _=function(nt){a?a(nt):console.error(nt),h.manager.itemError(e),h.manager.itemEnd(e)},et=new b.hH6(this.manager);et.setPath(this.path),et.setResponseType("arraybuffer"),et.setRequestHeader(this.requestHeader),et.setWithCredentials(this.withCredentials),et.load(e,function(nt){try{h.parse(nt,d,function(it){i(it),h.manager.itemEnd(e)},_)}catch(it){_(it)}},s,_)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a){let h;const d={},_={};if(typeof e=="string")h=e;else if(b.Zp0.decodeText(new Uint8Array(e,0,4))===Ay){try{d[Ts.KHR_BINARY_GLTF]=new Cr(e)}catch(it){return void(a&&a(it))}h=d[Ts.KHR_BINARY_GLTF].content}else h=b.Zp0.decodeText(new Uint8Array(e));const et=JSON.parse(h);if(et.asset===void 0||et.asset.version[0]<2)return void(a&&a(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const nt=new zl(et,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});nt.fileLoader.setRequestHeader(this.requestHeader);for(let it=0;it<this.pluginCallbacks.length;it++){const lt=this.pluginCallbacks[it](nt);_[lt.name]=lt,d[lt.name]=!0}if(et.extensionsUsed)for(let it=0;it<et.extensionsUsed.length;++it){const lt=et.extensionsUsed[it],dt=et.extensionsRequired||[];switch(lt){case Ts.KHR_MATERIALS_UNLIT:d[lt]=new Pw;break;case Ts.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:d[lt]=new y0;break;case Ts.KHR_DRACO_MESH_COMPRESSION:d[lt]=new ru(et,this.dracoLoader);break;case Ts.KHR_TEXTURE_TRANSFORM:d[lt]=new w1;break;case Ts.KHR_MESH_QUANTIZATION:d[lt]=new w0;break;default:dt.indexOf(lt)>=0&&_[lt]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+lt+'".')}}nt.setExtensions(d),nt.setPlugins(_),nt.parse(s,a)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,i,a,h)})}}function _y(){let c={};return{get:function(e){return c[e]},add:function(e,i){c[e]=i},remove:function(e){delete c[e]},removeAll:function(){c={}}}}const Ts={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Cl{constructor(e){this.parser=e,this.name=Ts.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let s=0,a=i.length;s<a;s++){const h=i[s];h.extensions&&h.extensions[this.name]&&h.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,h.extensions[this.name].light)}}_loadLight(e){const i=this.parser,s="light:"+e;let a=i.cache.get(s);if(a)return a;const h=i.json,d=((h.extensions&&h.extensions[this.name]||{}).lights||[])[e];let _;const et=new b.Ilk(16777215);d.color!==void 0&&et.fromArray(d.color);const nt=d.range!==void 0?d.range:0;switch(d.type){case"directional":_=new b.Ox3(et),_.target.position.set(0,0,-1),_.add(_.target);break;case"point":_=new b.cek(et),_.distance=nt;break;case"spot":_=new b.PMe(et),_.distance=nt,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,_.angle=d.spot.outerConeAngle,_.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,_.target.position.set(0,0,-1),_.add(_.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return _.position.set(0,0,0),_.decay=2,d.intensity!==void 0&&(_.intensity=d.intensity),_.name=i.createUniqueName(d.name||"light_"+e),a=Promise.resolve(_),i.cache.add(s,a),a}createNodeAttachment(e){const i=this,s=this.parser,a=s.json.nodes[e],h=(a.extensions&&a.extensions[this.name]||{}).light;return h===void 0?null:this._loadLight(h).then(function(d){return s._getNodeRef(i.cache,h,d)})}}class Pw{constructor(){this.name=Ts.KHR_MATERIALS_UNLIT}getMaterialType(){return b.vBJ}extendParams(e,i,s){const a=[];e.color=new b.Ilk(1,1,1),e.opacity=1;const h=i.pbrMetallicRoughness;if(h){if(Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;e.color.fromArray(d),e.opacity=d[3]}h.baseColorTexture!==void 0&&a.push(s.assignTexture(e,"map",h.baseColorTexture,b.knz))}return Promise.all(a)}}class A0{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name].emissiveStrength;return a!==void 0&&(i.emissiveIntensity=a),Promise.resolve()}}class _A{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];if(d.clearcoatFactor!==void 0&&(i.clearcoat=d.clearcoatFactor),d.clearcoatTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatMap",d.clearcoatTexture)),d.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=d.clearcoatRoughnessFactor),d.clearcoatRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"clearcoatRoughnessMap",d.clearcoatRoughnessTexture)),d.clearcoatNormalTexture!==void 0&&(h.push(s.assignTexture(i,"clearcoatNormalMap",d.clearcoatNormalTexture)),d.clearcoatNormalTexture.scale!==void 0)){const _=d.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new b.FM8(_,_)}return Promise.all(h)}}class wu{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.iridescenceFactor!==void 0&&(i.iridescence=d.iridescenceFactor),d.iridescenceTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceMap",d.iridescenceTexture)),d.iridescenceIor!==void 0&&(i.iridescenceIOR=d.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),d.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=d.iridescenceThicknessMinimum),d.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=d.iridescenceThicknessMaximum),d.iridescenceThicknessTexture!==void 0&&h.push(s.assignTexture(i,"iridescenceThicknessMap",d.iridescenceThicknessTexture)),Promise.all(h)}}class ys{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[];i.sheenColor=new b.Ilk(0,0,0),i.sheenRoughness=0,i.sheen=1;const d=a.extensions[this.name];return d.sheenColorFactor!==void 0&&i.sheenColor.fromArray(d.sheenColorFactor),d.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=d.sheenRoughnessFactor),d.sheenColorTexture!==void 0&&h.push(s.assignTexture(i,"sheenColorMap",d.sheenColorTexture,b.knz)),d.sheenRoughnessTexture!==void 0&&h.push(s.assignTexture(i,"sheenRoughnessMap",d.sheenRoughnessTexture)),a.extras&&a.extras.sheenFactor!==void 0&&(i.sheen=a.extras.sheenFactor,delete a.extras.sheenFactor),Promise.all(h)}}class ym{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.transmissionFactor!==void 0&&(i.transmission=d.transmissionFactor),d.transmissionTexture!==void 0&&h.push(s.assignTexture(i,"transmissionMap",d.transmissionTexture)),Promise.all(h)}}class AA{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.thickness=d.thicknessFactor!==void 0?d.thicknessFactor:0,d.thicknessTexture!==void 0&&h.push(s.assignTexture(i,"thicknessMap",d.thicknessTexture)),i.attenuationDistance=d.attenuationDistance||0;const _=d.attenuationColor||[1,1,1];return i.attenuationColor=new b.Ilk(_[0],_[1],_[2]),Promise.all(h)}}class yA{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Bv{constructor(e){this.parser=e,this.name=Ts.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return i.extensions&&i.extensions[this.name]?b.EJi:null}extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];i.specularIntensity=d.specularFactor!==void 0?d.specularFactor:1,d.specularTexture!==void 0&&h.push(s.assignTexture(i,"specularIntensityMap",d.specularTexture));const _=d.specularColorFactor||[1,1,1];return i.specularColor=new b.Ilk(_[0],_[1],_[2]),d.specularColorTexture!==void 0&&h.push(s.assignTexture(i,"specularColorMap",d.specularColorTexture,b.knz)),Promise.all(h)}}class Bu{constructor(e){this.parser=e,this.name=Ts.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,s=i.json,a=s.textures[e];if(!a.extensions||!a.extensions[this.name])return null;const h=a.extensions[this.name],d=i.options.ktx2Loader;if(!d){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,h.source,d)}}class Km{constructor(e){this.parser=e,this.name=Ts.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,s=this.parser,a=s.json,h=a.textures[e];if(!h.extensions||!h.extensions[i])return null;const d=h.extensions[i],_=a.images[d.source];let et=s.textureLoader;if(_.uri){const nt=s.options.manager.getHandler(_.uri);nt!==null&&(et=nt)}return this.detectSupport().then(function(nt){if(nt)return s.loadTextureImage(e,d.source,et);if(a.extensionsRequired&&a.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class Io{constructor(e){this.name=Ts.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,s=i.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const a=s.extensions[this.name],h=this.parser.getDependency("buffer",a.buffer),d=this.parser.options.meshoptDecoder;if(!d||!d.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return h.then(function(_){const et=a.byteOffset||0,nt=a.byteLength||0,it=a.count,lt=a.byteStride,dt=new Uint8Array(_,et,nt);return d.decodeGltfBufferAsync?d.decodeGltfBufferAsync(it,lt,dt,a.mode,a.filter).then(function(pt){return pt.buffer}):d.ready.then(function(){const pt=new ArrayBuffer(it*lt);return d.decodeGltfBuffer(new Uint8Array(pt),it,lt,dt,a.mode,a.filter),pt})})}return null}}const Ay="glTF";class Cr{constructor(e){this.name=Ts.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,12);if(this.header={magic:b.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Ay)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-12,a=new DataView(e,12);let h=0;for(;h<s;){const d=a.getUint32(h,!0);h+=4;const _=a.getUint32(h,!0);if(h+=4,_===1313821514){const et=new Uint8Array(e,12+h,d);this.content=b.Zp0.decodeText(et)}else if(_===5130562){const et=12+h;this.body=e.slice(et,et+d)}h+=d}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ru{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ts.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const s=this.json,a=this.dracoLoader,h=e.extensions[this.name].bufferView,d=e.extensions[this.name].attributes,_={},et={},nt={};for(const it in d){const lt=g_[it]||it.toLowerCase();_[lt]=d[it]}for(const it in e.attributes){const lt=g_[it]||it.toLowerCase();if(d[it]!==void 0){const dt=s.accessors[e.attributes[it]],pt=xu[dt.componentType];nt[lt]=pt.name,et[lt]=dt.normalized===!0}}return i.getDependency("bufferView",h).then(function(it){return new Promise(function(lt){a.decodeDracoFile(it,function(dt){for(const pt in dt.attributes){const gt=dt.attributes[pt],vt=et[pt];vt!==void 0&&(gt.normalized=vt)}lt(dt)},_,nt)})})}}class w1{constructor(){this.name=Ts.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return i.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class Rw extends b.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const i=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),a=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),h=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),_={specular:{value:new b.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=_,this.onBeforeCompile=function(et){for(const nt in _)et.uniforms[nt]=_[nt];et.fragmentShader=et.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",a).replace("#include <metalnessmap_fragment>",h).replace("#include <lights_physical_fragment>",d)},Object.defineProperties(this,{specular:{get:function(){return _.specular.value},set:function(et){_.specular.value=et}},specularMap:{get:function(){return _.specularMap.value},set:function(et){_.specularMap.value=et,et?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return _.glossiness.value},set:function(et){_.glossiness.value=et}},glossinessMap:{get:function(){return _.glossinessMap.value},set:function(et){_.glossinessMap.value=et,et?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class y0{constructor(){this.name=Ts.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Rw}extendParams(e,i,s){const a=i.extensions[this.name];e.color=new b.Ilk(1,1,1),e.opacity=1;const h=[];if(Array.isArray(a.diffuseFactor)){const d=a.diffuseFactor;e.color.fromArray(d),e.opacity=d[3]}if(a.diffuseTexture!==void 0&&h.push(s.assignTexture(e,"map",a.diffuseTexture,b.knz)),e.emissive=new b.Ilk(0,0,0),e.glossiness=a.glossinessFactor!==void 0?a.glossinessFactor:1,e.specular=new b.Ilk(1,1,1),Array.isArray(a.specularFactor)&&e.specular.fromArray(a.specularFactor),a.specularGlossinessTexture!==void 0){const d=a.specularGlossinessTexture;h.push(s.assignTexture(e,"glossinessMap",d)),h.push(s.assignTexture(e,"specularMap",d,b.knz))}return Promise.all(h)}createMaterial(e){const i=new Rw(e);return i.fog=!0,i.color=e.color,i.map=e.map===void 0?null:e.map,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=e.aoMap===void 0?null:e.aoMap,i.aoMapIntensity=1,i.emissive=e.emissive,i.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,i.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,i.bumpMap=e.bumpMap===void 0?null:e.bumpMap,i.bumpScale=1,i.normalMap=e.normalMap===void 0?null:e.normalMap,i.normalMapType=b.IOt,e.normalScale&&(i.normalScale=e.normalScale),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=e.specularMap===void 0?null:e.specularMap,i.specular=e.specular,i.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,i.glossiness=e.glossiness,i.alphaMap=null,i.envMap=e.envMap===void 0?null:e.envMap,i.envMapIntensity=1,i}}class w0{constructor(){this.name=Ts.KHR_MESH_QUANTIZATION}}class Zp extends b._C8{constructor(e,i,s,a){super(e,i,s,a)}copySampleValue_(e){const i=this.resultBuffer,s=this.sampleValues,a=this.valueSize,h=e*a*3+a;for(let d=0;d!==a;d++)i[d]=s[h+d];return i}interpolate_(e,i,s,a){const h=this.resultBuffer,d=this.sampleValues,_=this.valueSize,et=2*_,nt=3*_,it=a-i,lt=(s-i)/it,dt=lt*lt,pt=dt*lt,gt=e*nt,vt=gt-nt,Ct=-2*pt+3*dt,wt=pt-dt,xt=1-Ct,_t=wt-dt+lt;for(let Pt=0;Pt!==_;Pt++){const Rt=d[vt+Pt+_],Lt=d[vt+Pt+et]*it,Ot=d[gt+Pt+_],qt=d[gt+Pt]*it;h[Pt]=xt*Rt+_t*Lt+Ct*Ot+wt*qt}return h}}const wA=new b._fP;class m_ extends Zp{interpolate_(e,i,s,a){const h=super.interpolate_(e,i,s,a);return wA.fromArray(h).normalize().toArray(h),h}}const xu={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yy={9728:b.TyD,9729:b.wem,9984:b.YLQ,9985:b.qyh,9986:b.aH4,9987:b.D1R},$o={33071:b.uWy,33648:b.OoA,10497:b.rpg},Sp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},g_={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},sp={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},wy={CUBICSPLINE:void 0,LINEAR:b.NMF,STEP:b.Syv};function ts(c,e,i){for(const s in i.extensions)c[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=i.extensions[s])}function Cp(c,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(c.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function xA(c,e){if(c.updateMorphTargets(),e.weights!==void 0)for(let i=0,s=e.weights.length;i<s;i++)c.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(c.morphTargetInfluences.length===i.length){c.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++)c.morphTargetDictionary[i[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function x0(c){const e=c.extensions&&c.extensions[Ts.KHR_DRACO_MESH_COMPRESSION];let i;return i=e?"draco:"+e.bufferView+":"+e.indices+":"+v_(e.attributes):c.indices+":"+v_(c.attributes)+":"+c.mode,i}function v_(c){let e="";const i=Object.keys(c).sort();for(let s=0,a=i.length;s<a;s++)e+=i[s]+":"+c[i[s]]+";";return e}function Bw(c){switch(c){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class zl{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new _y,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,a=navigator.userAgent.indexOf("Firefox")>-1,h=a?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||a&&h<98?this.textureLoader=new b.dpR(this.options.manager):this.textureLoader=new b.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new b.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const s=this,a=this.json,h=this.extensions;this.cache.removeAll(),this._invokeAll(function(d){return d._markDefs&&d._markDefs()}),Promise.all(this._invokeAll(function(d){return d.beforeRoot&&d.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(d){const _={scene:d[0][a.scene||0],scenes:d[0],animations:d[1],cameras:d[2],asset:a.asset,parser:s,userData:{}};ts(h,_,a),Cp(_,a),Promise.all(s._invokeAll(function(et){return et.afterRoot&&et.afterRoot(_)})).then(function(){e(_)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],s=this.json.meshes||[];for(let a=0,h=i.length;a<h;a++){const d=i[a].joints;for(let _=0,et=d.length;_<et;_++)e[d[_]].isBone=!0}for(let a=0,h=e.length;a<h;a++){const d=e[a];d.mesh!==void 0&&(this._addNodeRef(this.meshCache,d.mesh),d.skin!==void 0&&(s[d.mesh].isSkinnedMesh=!0)),d.camera!==void 0&&this._addNodeRef(this.cameraCache,d.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,s){if(e.refs[i]<=1)return s;const a=s.clone(),h=(d,_)=>{const et=this.associations.get(d);et!=null&&this.associations.set(_,et);for(const[nt,it]of d.children.entries())h(it,_.children[nt])};return h(s,a),a.name+="_instance_"+e.uses[i]++,a}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let s=0;s<i.length;s++){const a=e(i[s]);if(a)return a}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const s=[];for(let a=0;a<i.length;a++){const h=e(i[a]);h&&s.push(h)}return s}getDependency(e,i){const s=e+":"+i;let a=this.cache.get(s);if(!a){switch(e){case"scene":a=this.loadScene(i);break;case"node":a=this.loadNode(i);break;case"mesh":a=this._invokeOne(function(h){return h.loadMesh&&h.loadMesh(i)});break;case"accessor":a=this.loadAccessor(i);break;case"bufferView":a=this._invokeOne(function(h){return h.loadBufferView&&h.loadBufferView(i)});break;case"buffer":a=this.loadBuffer(i);break;case"material":a=this._invokeOne(function(h){return h.loadMaterial&&h.loadMaterial(i)});break;case"texture":a=this._invokeOne(function(h){return h.loadTexture&&h.loadTexture(i)});break;case"skin":a=this.loadSkin(i);break;case"animation":a=this._invokeOne(function(h){return h.loadAnimation&&h.loadAnimation(i)});break;case"camera":a=this.loadCamera(i);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,a)}return a}getDependencies(e){let i=this.cache.get(e);if(!i){const s=this,a=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(a.map(function(h,d){return s.getDependency(e,d)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],s=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Ts.KHR_BINARY_GLTF].body);const a=this.options;return new Promise(function(h,d){s.load(b.Zp0.resolveURL(i.uri,a.path),h,void 0,function(){d(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(s){const a=i.byteLength||0,h=i.byteOffset||0;return s.slice(h,h+a)})}loadAccessor(e){const i=this,s=this.json,a=this.json.accessors[e];if(a.bufferView===void 0&&a.sparse===void 0)return Promise.resolve(null);const h=[];return a.bufferView!==void 0?h.push(this.getDependency("bufferView",a.bufferView)):h.push(null),a.sparse!==void 0&&(h.push(this.getDependency("bufferView",a.sparse.indices.bufferView)),h.push(this.getDependency("bufferView",a.sparse.values.bufferView))),Promise.all(h).then(function(d){const _=d[0],et=Sp[a.type],nt=xu[a.componentType],it=nt.BYTES_PER_ELEMENT,lt=it*et,dt=a.byteOffset||0,pt=a.bufferView!==void 0?s.bufferViews[a.bufferView].byteStride:void 0,gt=a.normalized===!0;let vt,Ct;if(pt&&pt!==lt){const wt=Math.floor(dt/pt),xt="InterleavedBuffer:"+a.bufferView+":"+a.componentType+":"+wt+":"+a.count;let _t=i.cache.get(xt);_t||(vt=new nt(_,wt*pt,a.count*pt/it),_t=new b.vpT(vt,pt/it),i.cache.add(xt,_t)),Ct=new b.kB5(_t,et,dt%pt/it,gt)}else vt=_===null?new nt(a.count*et):new nt(_,dt,a.count*et),Ct=new b.TlE(vt,et,gt);if(a.sparse!==void 0){const wt=Sp.SCALAR,xt=xu[a.sparse.indices.componentType],_t=a.sparse.indices.byteOffset||0,Pt=a.sparse.values.byteOffset||0,Rt=new xt(d[1],_t,a.sparse.count*wt),Lt=new nt(d[2],Pt,a.sparse.count*et);_!==null&&(Ct=new b.TlE(Ct.array.slice(),Ct.itemSize,Ct.normalized));for(let Ot=0,qt=Rt.length;Ot<qt;Ot++){const en=Rt[Ot];if(Ct.setX(en,Lt[Ot*et]),et>=2&&Ct.setY(en,Lt[Ot*et+1]),et>=3&&Ct.setZ(en,Lt[Ot*et+2]),et>=4&&Ct.setW(en,Lt[Ot*et+3]),et>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return Ct})}loadTexture(e){const i=this.json,s=this.options,a=i.textures[e].source,h=i.images[a];let d=this.textureLoader;if(h.uri){const _=s.manager.getHandler(h.uri);_!==null&&(d=_)}return this.loadTextureImage(e,a,d)}loadTextureImage(e,i,s){const a=this,h=this.json,d=h.textures[e],_=h.images[i],et=(_.uri||_.bufferView)+":"+d.sampler;if(this.textureCache[et])return this.textureCache[et];const nt=this.loadImageSource(i,s).then(function(it){d.name&&(it.name=d.name);const lt=(h.samplers||{})[d.sampler]||{};return it.magFilter=yy[lt.magFilter]||b.wem,it.minFilter=yy[lt.minFilter]||b.D1R,it.wrapS=$o[lt.wrapS]||b.rpg,it.wrapT=$o[lt.wrapT]||b.rpg,lt.extras&&lt.extras.uuid!==void 0&&(it.uuid=lt.extras.uuid),a.associations.set(it,{textures:e}),it}).catch(function(){return null});return this.textureCache[et]=nt,nt}loadImageSource(e,i){const s=this,a=this.json,h=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(lt=>lt.clone());const d=a.images[e],_=self.URL||self.webkitURL;let et=d.uri||"",nt=!1;if(d.bufferView!==void 0)et=s.getDependency("bufferView",d.bufferView).then(function(lt){nt=!0;const dt=new Blob([lt],{type:d.mimeType});return et=_.createObjectURL(dt),et});else if(d.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const it=Promise.resolve(et).then(function(lt){return new Promise(function(dt,pt){let gt=dt;i.isImageBitmapLoader===!0&&(gt=function(vt){const Ct=new b.xEZ(vt);Ct.needsUpdate=!0,dt(Ct)}),i.load(b.Zp0.resolveURL(lt,h.path),gt,void 0,function(vt){i.isImageBitmapLoader===!0?(i=new b.dpR(s.options.manager),gt=dt,i.setCrossOrigin(s.options.crossOrigin),i.setRequestHeader(s.options.requestHeader),i.load(b.Zp0.resolveURL(lt,h.path),gt,void 0,pt)):pt(vt)})})}).then(function(lt){var dt;if(nt===!0&&_.revokeObjectURL(et),lt.userData.mimeType=d.mimeType||((dt=d.uri).search(/\.jpe?g($|\?)/i)>0||dt.search(/^data\:image\/jpeg/)===0?"image/jpeg":dt.search(/\.webp($|\?)/i)>0||dt.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),lt.flipY=!1,d.extras){if(d.extras.flipY!==void 0){if(i.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const pt=lt,gt=d.extras.flipY&&!pt.flipY;createImageBitmap(pt.source.data,{imageOrientation:gt?"flipY":"none"}).then(function(vt){pt.source.data.close&&pt.source.data.close(),pt.source.data=vt,pt.source.needsUpdate=!0,pt.needsUpdate=!0})}lt.flipY=d.extras.flipY,lt.needsUpdate=!0,delete d.extras.flipY}d.extras.uuid!==void 0&&(lt.source.uuid=d.extras.uuid),d.extras.t_uuid!==void 0&&(lt.uuid=d.extras.t_uuid)}return d.uri&&typeof d.uri=="string"&&(lt.userData.rootPath=d.uri),lt}).catch(function(lt){throw console.error("THREE.GLTFLoader: Couldn't load texture",et),lt});return this.sourceCache[e]=it,it}assignTexture(e,i,s,a){const h=this;return this.getDependency("texture",s.index).then(function(d){if(s.texCoord===void 0||s.texCoord==0||i==="aoMap"&&s.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+i+" not yet supported."),h.extensions[Ts.KHR_TEXTURE_TRANSFORM]){const _=s.extensions!==void 0?s.extensions[Ts.KHR_TEXTURE_TRANSFORM]:void 0;if(_){const et=h.associations.get(d);d=h.extensions[Ts.KHR_TEXTURE_TRANSFORM].extendTexture(d,_),h.associations.set(d,et)}}return a!==void 0&&(d.encoding=a),e[i]=d,d})}assignFinalMaterial(e){const i=e.geometry;let s=e.material;const a=i.attributes.tangent===void 0,h=i.attributes.color!==void 0,d=i.attributes.normal===void 0;if(e.isPoints){const _="PointsMaterial:"+s.uuid;let et=this.cache.get(_);et||(et=new b.UY4,b.F5T.prototype.copy.call(et,s),et.color.copy(s.color),et.map=s.map,et.sizeAttenuation=!1,this.cache.add(_,et)),s=et}else if(e.isLine){const _="LineBasicMaterial:"+s.uuid;let et=this.cache.get(_);et||(et=new b.nls,b.F5T.prototype.copy.call(et,s),et.color.copy(s.color),this.cache.add(_,et)),s=et}if(a||h||d){let _="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(_+="specular-glossiness:"),a&&(_+="derivative-tangents:"),h&&(_+="vertex-colors:"),d&&(_+="flat-shading:");let et=this.cache.get(_);et||(et=s.clone(),h&&(et.vertexColors=!0),d&&(et.flatShading=!0),a&&(et.normalScale&&(et.normalScale.y*=-1),et.clearcoatNormalScale&&(et.clearcoatNormalScale.y*=-1)),this.cache.add(_,et),this.associations.set(et,this.associations.get(s))),s=et}s.aoMap&&i.attributes.uv2===void 0&&i.attributes.uv!==void 0&&i.setAttribute("uv2",i.attributes.uv),e.material=s}getMaterialType(){return b.Wid}loadMaterial(e){const i=this,s=this.json,a=this.extensions,h=s.materials[e];let d;const _={},et=h.extensions||{},nt=[];if(et[Ts.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const lt=a[Ts.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];d=lt.getMaterialType(),nt.push(lt.extendParams(_,h,i))}else if(et[Ts.KHR_MATERIALS_UNLIT]){const lt=a[Ts.KHR_MATERIALS_UNLIT];d=lt.getMaterialType(),nt.push(lt.extendParams(_,h,i))}else{const lt=h.pbrMetallicRoughness||{};if(_.color=new b.Ilk(1,1,1),_.opacity=1,Array.isArray(lt.baseColorFactor)){const dt=lt.baseColorFactor;_.color.fromArray(dt),_.opacity=dt[3]}lt.baseColorTexture!==void 0&&nt.push(i.assignTexture(_,"map",lt.baseColorTexture,b.knz)),_.metalness=lt.metallicFactor!==void 0?lt.metallicFactor:1,_.roughness=lt.roughnessFactor!==void 0?lt.roughnessFactor:1,lt.metallicRoughnessTexture!==void 0&&(nt.push(i.assignTexture(_,"metalnessMap",lt.metallicRoughnessTexture)),nt.push(i.assignTexture(_,"roughnessMap",lt.metallicRoughnessTexture))),d=this._invokeOne(function(dt){return dt.getMaterialType&&dt.getMaterialType(e)}),nt.push(Promise.all(this._invokeAll(function(dt){return dt.extendMaterialParams&&dt.extendMaterialParams(e,_)})))}h.doubleSided===!0&&(_.side=b.ehD);const it=h.alphaMode||"OPAQUE";if(it==="BLEND"?(_.transparent=!0,_.depthWrite=!1):(_.transparent=!1,it==="MASK"&&(_.alphaTest=h.alphaCutoff!==void 0?h.alphaCutoff:.5)),h.normalTexture!==void 0&&d!==b.vBJ&&(nt.push(i.assignTexture(_,"normalMap",h.normalTexture)),_.normalScale=new b.FM8(1,1),h.normalTexture.scale!==void 0)){const lt=h.normalTexture.scale;_.normalScale.set(lt,lt)}return h.occlusionTexture!==void 0&&d!==b.vBJ&&(nt.push(i.assignTexture(_,"aoMap",h.occlusionTexture)),h.occlusionTexture.strength!==void 0&&(_.aoMapIntensity=h.occlusionTexture.strength)),h.emissiveFactor!==void 0&&d!==b.vBJ&&(_.emissive=new b.Ilk().fromArray(h.emissiveFactor)),h.emissiveTexture!==void 0&&d!==b.vBJ&&nt.push(i.assignTexture(_,"emissiveMap",h.emissiveTexture,b.knz)),Promise.all(nt).then(function(){let lt;return lt=d===Rw?a[Ts.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(_):new d(_),h.name&&(lt.name=h.name),Cp(lt,h),i.associations.set(lt,{materials:e}),h.extensions&&ts(a,lt,h),lt})}createUniqueName(e){const i=b.iUV.sanitizeNodeName(e||"");let s=i;for(let a=1;this.nodeNamesUsed[s];++a)s=i+"_"+a;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const i=this,s=this.extensions,a=this.primitiveCache;function h(_){return s[Ts.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(_,i).then(function(et){return Ku(et,_,i)})}const d=[];for(let _=0,et=e.length;_<et;_++){const nt=e[_],it=x0(nt),lt=a[it];if(lt)d.push(lt.promise);else{let dt;dt=nt.extensions&&nt.extensions[Ts.KHR_DRACO_MESH_COMPRESSION]?h(nt):Ku(new b.u9r,nt,i),a[it]={primitive:nt,promise:dt},d.push(dt)}}return Promise.all(d)}loadMesh(e){const i=this,s=this.json,a=this.extensions,h=s.meshes[e],d=h.primitives,_=[];for(let nt=0,it=d.length;nt<it;nt++){const lt=d[nt].material===void 0?((et=this.cache).DefaultMaterial===void 0&&(et.DefaultMaterial=new b.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:b.Wl3})),et.DefaultMaterial):this.getDependency("material",d[nt].material);_.push(lt)}var et;return _.push(i.loadGeometries(d)),Promise.all(_).then(function(nt){const it=nt.slice(0,nt.length-1),lt=nt[nt.length-1],dt=[];for(let gt=0,vt=lt.length;gt<vt;gt++){const Ct=lt[gt],wt=d[gt];let xt;const _t=it[gt];if(wt.mode===4||wt.mode===5||wt.mode===6||wt.mode===void 0)xt=h.isSkinnedMesh===!0?new b.TUv(Ct,_t):new b.Kj0(Ct,_t),xt.isSkinnedMesh!==!0||xt.geometry.attributes.skinWeight.normalized||xt.normalizeSkinWeights(),wt.mode===5?xt.geometry=__(xt.geometry,b.UlW):wt.mode===6&&(xt.geometry=__(xt.geometry,b.z$h));else if(wt.mode===1)xt=new b.ejS(Ct,_t);else if(wt.mode===3)xt=new b.x12(Ct,_t);else if(wt.mode===2)xt=new b.blk(Ct,_t);else{if(wt.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+wt.mode);xt=new b.woe(Ct,_t)}Object.keys(xt.geometry.morphAttributes).length>0&&xA(xt,h),xt.name=i.createUniqueName(h.name||"mesh_"+e),Cp(xt,h),wt.extensions&&ts(a,xt,wt),i.assignFinalMaterial(xt),dt.push(xt)}h.extensions&&dt.forEach(gt=>ts(a,gt,h));for(let gt=0,vt=dt.length;gt<vt;gt++)i.associations.set(dt[gt],{meshes:e,primitives:gt});if(dt.length===1)return dt[0];const pt=new b.ZAu;i.associations.set(pt,{meshes:e});for(let gt=0,vt=dt.length;gt<vt;gt++)pt.add(dt[gt]);return pt})}loadCamera(e){let i;const s=this.json.cameras[e],a=s[s.type];if(a)return s.type==="perspective"?i=new b.cPb(b.M8C.radToDeg(a.yfov),a.aspectRatio||1,a.znear||1,a.zfar||2e6):s.type==="orthographic"&&(i=new b.iKG(-a.xmag,a.xmag,a.ymag,-a.ymag,a.znear,a.zfar)),s.name&&(i.name=this.createUniqueName(s.name)),Cp(i,s),Promise.resolve(i);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const i=this.json.skins[e],s={joints:i.joints};return i.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",i.inverseBindMatrices).then(function(a){return s.inverseBindMatrices=a,s})}loadAnimation(e){const i=this.json.animations[e],s=[],a=[],h=[],d=[],_=[];for(let et=0,nt=i.channels.length;et<nt;et++){const it=i.channels[et],lt=i.samplers[it.sampler],dt=it.target,pt=dt.node,gt=i.parameters!==void 0?i.parameters[lt.input]:lt.input,vt=i.parameters!==void 0?i.parameters[lt.output]:lt.output;s.push(this.getDependency("node",pt)),a.push(this.getDependency("accessor",gt)),h.push(this.getDependency("accessor",vt)),d.push(lt),_.push(dt)}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(h),Promise.all(d),Promise.all(_)]).then(function(et){const nt=et[0],it=et[1],lt=et[2],dt=et[3],pt=et[4],gt=[];for(let Ct=0,wt=nt.length;Ct<wt;Ct++){const xt=nt[Ct],_t=it[Ct],Pt=lt[Ct],Rt=dt[Ct],Lt=pt[Ct];if(xt===void 0)continue;let Ot;switch(xt.updateMatrix(),sp[Lt.path]){case sp.weights:Ot=b.dUE;break;case sp.rotation:Ot=b.iLg;break;default:Ot=b.yC1}const qt=xt.name?xt.name:xt.uuid,en=Rt.interpolation!==void 0?wy[Rt.interpolation]:b.NMF,cn=[];sp[Lt.path]===sp.weights?xt.traverse(function(fn){fn.morphTargetInfluences&&cn.push(fn.name?fn.name:fn.uuid)}):cn.push(qt);let An=Pt.array;if(Pt.normalized){const fn=Bw(An.constructor),Tn=new Float32Array(An.length);for(let gn=0,xn=An.length;gn<xn;gn++)Tn[gn]=An[gn]*fn;An=Tn}for(let fn=0,Tn=cn.length;fn<Tn;fn++){const gn=new Ot(cn[fn]+"."+sp[Lt.path],_t.array,An,en);Rt.interpolation==="CUBICSPLINE"&&(gn.createInterpolant=function(xn){return new(this instanceof b.iLg?m_:Zp)(this.times,this.values,this.getValueSize()/3,xn)},gn.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),gt.push(gn)}}const vt=i.name?i.name:"animation_"+e;return new b.m7l(vt,void 0,gt)})}createNodeMesh(e){const i=this.json,s=this,a=i.nodes[e];return a.mesh===void 0?null:s.getDependency("mesh",a.mesh).then(function(h){const d=s._getNodeRef(s.meshCache,a.mesh,h);return a.weights!==void 0&&d.traverse(function(_){if(_.isMesh)for(let et=0,nt=a.weights.length;et<nt;et++)_.morphTargetInfluences[et]=a.weights[et]}),d})}loadNode(e){const i=this.json,s=this.extensions,a=this,h=i.nodes[e],d=h.name?a.createUniqueName(h.name):"";return function(){const _=[],et=a._invokeOne(function(nt){return nt.createNodeMesh&&nt.createNodeMesh(e)});return et&&_.push(et),h.camera!==void 0&&_.push(a.getDependency("camera",h.camera).then(function(nt){return a._getNodeRef(a.cameraCache,h.camera,nt)})),a._invokeAll(function(nt){return nt.createNodeAttachment&&nt.createNodeAttachment(e)}).forEach(function(nt){_.push(nt)}),Promise.all(_)}().then(function(_){let et;if(et=h.isBone===!0?new b.N$j:_.length>1?new b.ZAu:_.length===1?_[0]:new b.Tme,et!==_[0])for(let nt=0,it=_.length;nt<it;nt++)et.add(_[nt]);if(h.name&&(et.userData.name=h.name,et.name=d),Cp(et,h),h.extensions&&ts(s,et,h),h.matrix!==void 0){const nt=new b.yGw;nt.fromArray(h.matrix),et.applyMatrix4(nt)}else h.translation!==void 0&&et.position.fromArray(h.translation),h.rotation!==void 0&&et.quaternion.fromArray(h.rotation),h.scale!==void 0&&et.scale.fromArray(h.scale);return a.associations.has(et)||a.associations.set(et,{}),a.associations.get(et).nodes=e,et})}loadScene(e){const i=this.json,s=this.extensions,a=this.json.scenes[e],h=this,d=new b.ZAu;a.name&&(d.name=h.createUniqueName(a.name)),Cp(d,a),a.extensions&&ts(s,d,a);const _=a.nodes||[],et=[];for(let nt=0,it=_.length;nt<it;nt++)et.push(fo(_[nt],d,i,h));return Promise.all(et).then(function(){return h.associations=(nt=>{const it=new Map;for(const[lt,dt]of h.associations)(lt instanceof b.F5T||lt instanceof b.xEZ)&&it.set(lt,dt);return nt.traverse(lt=>{const dt=h.associations.get(lt);dt!=null&&it.set(lt,dt)}),it})(d),d})}}function fo(c,e,i,s){const a=i.nodes[c];return s.getDependency("node",c).then(function(h){if(a.skin===void 0)return h;let d;return s.getDependency("skin",a.skin).then(function(_){d=_;const et=[];for(let nt=0,it=d.joints.length;nt<it;nt++)et.push(s.getDependency("node",d.joints[nt]));return Promise.all(et)}).then(function(_){return h.traverse(function(et){if(!et.isMesh)return;const nt=[],it=[];for(let lt=0,dt=_.length;lt<dt;lt++){const pt=_[lt];if(pt){nt.push(pt);const gt=new b.yGw;d.inverseBindMatrices!==void 0&&gt.fromArray(d.inverseBindMatrices.array,16*lt),it.push(gt)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',d.joints[lt])}et.bind(new b.OdW(nt,it),et.matrixWorld)}),h})}).then(function(h){e.add(h);const d=[];if(a.children){const _=a.children;for(let et=0,nt=_.length;et<nt;et++){const it=_[et];d.push(fo(it,h,i,s))}}return Promise.all(d)})}function Ku(c,e,i){const s=e.attributes,a=[];function h(d,_){return i.getDependency("accessor",d).then(function(et){c.setAttribute(_,et)})}for(const d in s){const _=g_[d]||d.toLowerCase();_ in c.attributes||a.push(h(s[d],_))}if(e.indices!==void 0&&!c.index){const d=i.getDependency("accessor",e.indices).then(function(_){c.setIndex(_)});a.push(d)}return Cp(c,e),function(d,_,et){const nt=_.attributes,it=new b.ZzF;if(nt.POSITION===void 0)return;{const pt=et.json.accessors[nt.POSITION],gt=pt.min,vt=pt.max;if(gt===void 0||vt===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(it.set(new b.Pa4(gt[0],gt[1],gt[2]),new b.Pa4(vt[0],vt[1],vt[2])),pt.normalized){const Ct=Bw(xu[pt.componentType]);it.min.multiplyScalar(Ct),it.max.multiplyScalar(Ct)}}const lt=_.targets;if(lt!==void 0){const pt=new b.Pa4,gt=new b.Pa4;for(let vt=0,Ct=lt.length;vt<Ct;vt++){const wt=lt[vt];if(wt.POSITION!==void 0){const xt=et.json.accessors[wt.POSITION],_t=xt.min,Pt=xt.max;if(_t!==void 0&&Pt!==void 0){if(gt.setX(Math.max(Math.abs(_t[0]),Math.abs(Pt[0]))),gt.setY(Math.max(Math.abs(_t[1]),Math.abs(Pt[1]))),gt.setZ(Math.max(Math.abs(_t[2]),Math.abs(Pt[2]))),xt.normalized){const Rt=Bw(xu[xt.componentType]);gt.multiplyScalar(Rt)}pt.max(gt)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}it.expandByVector(pt)}d.boundingBox=it;const dt=new b.aLr;it.getCenter(dt.center),dt.radius=it.min.distanceTo(it.max)/2,d.boundingSphere=dt}(c,e,i),Promise.all(a).then(function(){return e.targets!==void 0?function(d,_,et){let nt=!1,it=!1,lt=!1;for(let vt=0,Ct=_.length;vt<Ct;vt++){const wt=_[vt];if(wt.POSITION!==void 0&&(nt=!0),wt.NORMAL!==void 0&&(it=!0),wt.COLOR_0!==void 0&&(lt=!0),nt&&it&&lt)break}if(!nt&&!it&&!lt)return Promise.resolve(d);const dt=[],pt=[],gt=[];for(let vt=0,Ct=_.length;vt<Ct;vt++){const wt=_[vt];if(nt){const xt=wt.POSITION!==void 0?et.getDependency("accessor",wt.POSITION):d.attributes.position;dt.push(xt)}if(it){const xt=wt.NORMAL!==void 0?et.getDependency("accessor",wt.NORMAL):d.attributes.normal;pt.push(xt)}if(lt){const xt=wt.COLOR_0!==void 0?et.getDependency("accessor",wt.COLOR_0):d.attributes.color;gt.push(xt)}}return Promise.all([Promise.all(dt),Promise.all(pt),Promise.all(gt)]).then(function(vt){const Ct=vt[0],wt=vt[1],xt=vt[2];return nt&&(d.morphAttributes.position=Ct),it&&(d.morphAttributes.normal=wt),lt&&(d.morphAttributes.color=xt),d.morphTargetsRelative=!0,d})}(c,e.targets,i):c})}function __(c,e){let i=c.getIndex();if(i===null){const d=[],_=c.getAttribute("position");if(_===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),c;for(let et=0;et<_.count;et++)d.push(et);c.setIndex(d),i=c.getIndex()}const s=i.count-2,a=[];if(e===b.z$h)for(let d=1;d<=s;d++)a.push(i.getX(0)),a.push(i.getX(d)),a.push(i.getX(d+1));else for(let d=0;d<s;d++)d%2==0?(a.push(i.getX(d)),a.push(i.getX(d+1)),a.push(i.getX(d+2))):(a.push(i.getX(d+2)),a.push(i.getX(d+1)),a.push(i.getX(d)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const h=c.clone();return h.setIndex(a),h}class x1 extends Xm{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,i){const s=await super.loadAsync(e,i),a=s?s.scene||s.scenes&&s.scenes.length>0&&s.scenes[0]:void 0;return a&&s.animations.length>0&&(a.animations=s.animations),a.traverse(h=>{h.userData.gltfUUID&&(h.uuid=h.userData.gltfUUID,delete h.userData.gltfUUID)}),a}register(e){return super.register(e)}}class b0 extends b.hH6{constructor(e){super(e),this.type=b.cLu}async loadAsync(e,i){const s=await this.parseAsync(e,i,!1),a=new b.IEO(s.data,s.width,s.height,b.wk1,this.type);return a.needsUpdate=!0,a.flipY=!0,a.encoding=b.rnI,a.minFilter=b.wem,a.magFilter=b.wem,a.source.data.complete=!0,a}async parseAsync(e,i,s=!1){if(!e.startsWith("data:")){this.responseType="blob";const _=await super.loadAsync(e,i);e=(e=await Fl(_)).replace("application/octet-stream","image/png")}const a=await Jp(e);let h=Uint8Array;return this.type===b.cLu?h=Uint16Array:this.type===b.VzW&&(h=Uint32Array),{data:function(_,et=3,nt=Uint16Array,it=!1){let lt;const dt=_.byteLength>>2,pt=new nt(dt*et);for(let gt=0;gt<dt;gt++)lt=Math.pow(2,_[4*gt+3]-136),it?(pt[gt*et]=Math.min(_[4*gt]*lt,65504),pt[gt*et+1]=Math.min(_[4*gt+1]*lt,65504),pt[gt*et+2]=Math.min(_[4*gt+2]*lt,65504)):(pt[gt*et]=b.A5E.toHalfFloat(Math.min(_[4*gt]*lt,65504)),pt[gt*et+1]=b.A5E.toHalfFloat(Math.min(_[4*gt+1]*lt,65504)),pt[gt*et+2]=b.A5E.toHalfFloat(Math.min(_[4*gt+2]*lt,65504))),et===4&&(pt[gt*et+3]=b.A5E.toHalfFloat(1));return pt}(a.data,4,h,s),width:a.width,height:a.height}}setDataType(e){return this.type=e,this}}class xy extends b.Gql{constructor(e){super(e),this._imageLoader=new b.S3k(e)}parseTextures2(e,i,s){var a;for(const h of e){const d=(a=h==null?void 0:h.userData)===null||a===void 0?void 0:a.rootPath;if(d&&(!h.image||!i[h.image])){const _=new b.Hw6(this._imageLoader.load(d,s));if(!_)continue;h.image&&(_.uuid=h.image),i[_.uuid]=_,h.image=_.uuid}h.userData=eo(h.userData,void 0,!1,{images:i})}return super.parseTextures(e,i)}parseMaterials2(e,i,s){const a={};return e.forEach(h=>{if(!h)return;const d={...h},_=Object.keys(d);for(const nt of _)if(nt==="map"||nt.endsWith("Map")){const it=d[nt];typeof it=="string"&&(i[it]?d[nt]=i[it]:(console.warn(`Texture ${it} not found`),delete d[nt]))}d.userData&&(d.userData=eo(d.userData,void 0,!1,{textures:i}));const et=s.generateFromTemplateType(d.type,d);et&&(a[h.uuid]=et)}),a}}const Mp="WEBGI_viewer";function su(c){Gs.Importers.push(new Zo(x1,["gltf","glb","data:model/gltf"],!0,(e,i)=>{if(!e)return e;const s=e,a=new xy(i.loadingManager);return s.register(Zm(a,c)),s.register(E0()),s.register(S0(a)),s.register(h=>new Lv(h)),s.register(h=>new Ju(h)),s.register(h=>new A_(h)),s.register(h=>new Ey(h)),s.register(h=>{var d,_,et,nt,it,lt,dt,pt,gt;const vt=Au()+".drc",Ct=Au()+".ktx2",wt=(et=(_=(d=h.json)===null||d===void 0?void 0:d.extensionsRequired)===null||_===void 0?void 0:_.includes)===null||et===void 0?void 0:et.call(_,"KHR_draco_mesh_compression");if(wt){const _t=i.registerFile(vt);_t&&s.setDRACOLoader(_t)}!((lt=(it=(nt=h.json)===null||nt===void 0?void 0:nt.extensionsUsed)===null||it===void 0?void 0:it.includes)===null||lt===void 0)&&lt.call(it,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(s.setMeshoptDecoder(window.MeshoptDecoder),h.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const xt=(gt=(pt=(dt=h.json)===null||dt===void 0?void 0:dt.extensionsUsed)===null||pt===void 0?void 0:pt.includes)===null||gt===void 0?void 0:gt.call(pt,"KHR_texture_basisu");if(xt){const _t=i.registerFile(Ct);_t&&(s.setKTX2Loader(_t),h.options.ktx2Loader=_t)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async _t=>{wt&&i.unregisterFile(vt),xt&&i.unregisterFile(Ct);const Pt=await by(h,c,a);_t.scene.__importedViewerConfig=Pt}}}),s}))}const dn="WEBGI_light_extras",Jm="WEBGI_object3d_extras",Tp="WEBGI_material_extras",E0=c=>e=>({name:"__"+Jm,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isObject3D)return;const _=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[Jm];if(!_)return void(a.isLight&&!a.isAmbientLight&&(a.castShadow=!0));const et=_.castShadow!==void 0||_.receiveShadow!==void 0;_.castShadow!==void 0&&(a.castShadow=_.castShadow),_.receiveShadow!==void 0&&(a.receiveShadow=_.receiveShadow),_.visible!==void 0&&(a.visible=_.visible),_.frustumCulled!==void 0&&(a.frustumCulled=_.frustumCulled),_.renderOrder!==void 0&&(a.renderOrder=_.renderOrder),_.layers!==void 0&&(a.layers.mask=_.layers),et&&(a.userData.__keepShadowDef=!0),delete a.userData.gltfExtensions[Jm]})})}}),Zm=(c,e)=>i=>({name:"__"+Tp,afterRoot:async s=>{var a,h,d;const _=s.scenes||(s.scene?[s.scene]:[]);for(const et of _){const nt=(h=(a=et.userData)===null||a===void 0?void 0:a.gltfExtensions)===null||h===void 0?void 0:h[Tp],it=nt&&await((d=e.getPlugin(Yr))===null||d===void 0?void 0:d.importConfigResources(nt.resources||{}))||{};et.traverse(lt=>{var dt,pt;const gt=lt==null?void 0:lt.material;if(!(gt!=null&&gt.isMaterial))return;const vt=(pt=(dt=gt.userData)===null||dt===void 0?void 0:dt.gltfExtensions)===null||pt===void 0?void 0:pt[Tp];vt&&(vt.emissiveIntensity!==void 0&&(gt.emissiveIntensity=vt.emissiveIntensity),vt.fog!==void 0&&(gt.fog=vt.fog),vt.flatShading!==void 0&&(gt.flatShading=vt.flatShading),vt.blending!==void 0&&(gt.blending=vt.blending),vt.side!==void 0&&(gt.side=vt.side),vt.shadowSide!==void 0&&(gt.shadowSide=vt.shadowSide),vt.depthFunc!==void 0&&(gt.depthFunc=vt.depthFunc),vt.depthTest!==void 0&&(gt.depthTest=vt.depthTest),vt.depthWrite!==void 0&&(gt.depthWrite=vt.depthWrite),vt.colorWrite!==void 0&&(gt.colorWrite=vt.colorWrite),vt.wireframe!==void 0&&(gt.wireframe=vt.wireframe),vt.wireframeLinewidth!==void 0&&(gt.wireframeLinewidth=vt.wireframeLinewidth),vt.wireframeLinecap!==void 0&&(gt.wireframeLinecap=vt.wireframeLinecap),vt.wireframeLinejoin!==void 0&&(gt.wireframeLinejoin=vt.wireframeLinejoin),vt.rotation!==void 0&&(gt.rotation=vt.rotation),vt.polygonOffset!==void 0&&(gt.polygonOffset=vt.polygonOffset),vt.polygonOffsetFactor!==void 0&&(gt.polygonOffsetFactor=vt.polygonOffsetFactor),vt.polygonOffsetUnits!==void 0&&(gt.polygonOffsetUnits=vt.polygonOffsetUnits),vt.dithering!==void 0&&(gt.dithering=vt.dithering),vt.alphaToCoverage!==void 0&&(gt.alphaToCoverage=vt.alphaToCoverage),vt.premultipliedAlpha!==void 0&&(gt.premultipliedAlpha=vt.premultipliedAlpha),vt.toneMapped!==void 0&&(gt.toneMapped=vt.toneMapped),vt.reflectivity!==void 0&&(gt.reflectivity=vt.reflectivity),Object.entries(vt).forEach(([Ct,wt])=>{Ct.startsWith("_")||wt&&wt.resource&&typeof wt.resource=="string"&&(gt[Ct]=eo(wt,gt[Ct],!1,it))}),delete gt.userData.gltfExtensions[Tp])}),nt&&delete et.userData.gltfExtensions[Tp]}}}),S0=c=>e=>({name:"__"+dn,afterRoot:async i=>{(i.scenes||(i.scene?[i.scene]:[])).forEach(s=>{s.traverse(a=>{var h,d;if(!a.isLight)return;const _=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[dn];_&&(!a.shadow&&_.shadow&&console.error("Light has no shadow, cannot import",a,_),_.shadow&&a.shadow&&(_.shadow.bias!==void 0&&(a.shadow.bias=_.shadow.bias),_.shadow.normalBias!==void 0&&(a.shadow.normalBias=_.shadow.normalBias),_.shadow.radius!==void 0&&(a.shadow.radius=_.shadow.radius),_.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(_.shadow.mapSize),_.shadow.camera!==void 0&&(a.shadow.camera=c.parseObject(_.shadow.camera))),delete a.userData.gltfExtensions[dn])})})}});async function by(c,e,i,s){var a;if(!s){const et=c.json.scenes||[];if(et.length!==1){for(const nt of et)await by(c,e,nt);return}s=et[0]}const h=(a=s.extensions)===null||a===void 0?void 0:a[Mp];if(!h)return;const d=[];Object.values(h.resources).forEach(et=>{Object.values(et).forEach(nt=>{nt.url&&(nt.url.type==="Uint16Array"&&nt.url.data&&d.push(nt.url),nt.url.type==="Uint8Array"&&nt.url.data&&d.push(nt.url))})});for(const et of d){const nt=et.data.image,it=c.json.images[nt],lt=await c.getDependency("bufferView",it.bufferView);if(it.mimeType.startsWith("image/")&&et.type==="Uint16Array"&&et.encoding==="rgbe"){const dt=new Blob([lt],{type:it.mimeType}),pt="data:image/png;base64,"+btoa(await dt.text());et.data=(await new b0().parseAsync(pt,void 0,!0)).data,delete et.encoding}else et.data=lt}const _={textures:{}};if(h.resources.textures&&c.json.textures)for(const[et,nt]of Object.entries(h.resources.textures)){if(nt.uuid||!et)continue;delete h.resources.textures[et];const it=c.json.textures.findIndex(lt=>{var dt,pt,gt,vt,Ct,wt,xt;return((dt=lt.extras)===null||dt===void 0?void 0:dt.uuid)===et||((vt=(gt=(pt=c.json.samplers)===null||pt===void 0?void 0:pt[lt.sampler])===null||gt===void 0?void 0:gt.extras)===null||vt===void 0?void 0:vt.uuid)===et||((xt=(wt=(Ct=c.json.images)===null||Ct===void 0?void 0:Ct[lt.source])===null||wt===void 0?void 0:wt.extras)===null||xt===void 0?void 0:xt.t_uuid)===et});it>=0&&(_.textures[et]=await c.getDependency("texture",it))}if(h.resources.materials&&c.json.materials)for(const[et,nt]of Object.entries(h.resources.materials)){if(nt.uuid||!et)continue;delete h.resources.materials[et];const it=c.json.materials.findIndex(lt=>{var dt;return((dt=lt.extras)===null||dt===void 0?void 0:dt.uuid)===et});it>=0&&(_.materials[et]=await c.getDependency("material",it))}return h.resources=await e.getPlugin(Yr).importConfigResources(h.resources||{},i,_),h}const $p="WEBGI_materials_bumpmap",kv="WEBGI_materials_displacementmap",$m="WEBGI_materials_alphamap",_f="WEBGI_materials_lightmap";class Lv{constructor(e){this.parser=e,this.name=$p}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.bumpScale!==void 0&&(i.bumpScale=d.bumpScale),d.bumpTexture!==void 0&&h.push(s.assignTexture(i,"bumpMap",d.bumpTexture)),Promise.all(h)}}class Ju{constructor(e){this.parser=e,this.name=kv}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.displacementScale!==void 0&&(i.displacementScale=d.displacementScale),d.displacementBias!==void 0&&(i.displacementBias=d.displacementBias),d.displacementTexture!==void 0&&h.push(s.assignTexture(i,"displacementMap",d.displacementTexture)),Promise.all(h)}}class A_{constructor(e){this.parser=e,this.name=_f}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.lightMapIntensity!==void 0&&(i.lightMapIntensity=d.lightMapIntensity),d.lightMapTexture!==void 0&&h.push(s.assignTexture(i,"lightMap",d.lightMapTexture)),Promise.all(h)}}class Ey{constructor(e){this.parser=e,this.name=$m}async extendMaterialParams(e,i){const s=this.parser,a=s.json.materials[e];if(!a.extensions||!a.extensions[this.name])return Promise.resolve();const h=[],d=a.extensions[this.name];return d.alphaTexture!==void 0&&h.push(s.assignTexture(i,"alphaMap",d.alphaTexture)),Promise.all(h)}}var C0=__webpackgi_require__(23);function Ov(){Gs.Importers.push(new Zo(C0.Q,["drc"],!0))}var Sy={},no=Uint8Array,Uo=Uint16Array,Ip=Uint32Array,op=new no([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dp=new no([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Nl=new no([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cy=function(c,e){for(var i=new Uo(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new Ip(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},y_=Cy(op,2),wm=y_[0],w_=y_[1];wm[28]=258,w_[258]=28;for(var bA=Cy(Dp,0),My=bA[0],Nv=bA[1],Is=new Uo(32768),bo=0;bo<32768;++bo){var Yl=(43690&bo)>>>1|(21845&bo)<<1;Yl=(61680&(Yl=(52428&Yl)>>>2|(13107&Yl)<<2))>>>4|(3855&Yl)<<4,Is[bo]=((65280&Yl)>>>8|(255&Yl)<<8)>>>1}var Pp=function(c,e,i){for(var s=c.length,a=0,h=new Uo(e);a<s;++a)++h[c[a]-1];var d,_=new Uo(e);for(a=0;a<e;++a)_[a]=_[a-1]+h[a-1]<<1;if(i){d=new Uo(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var nt=a<<4|c[a],it=e-c[a],lt=_[c[a]-1]++<<it,dt=lt|(1<<it)-1;lt<=dt;++lt)d[Is[lt]>>>et]=nt}else for(d=new Uo(s),a=0;a<s;++a)c[a]&&(d[a]=Is[_[c[a]-1]++]>>>15-c[a]);return d},_g=new no(288);for(bo=0;bo<144;++bo)_g[bo]=8;for(bo=144;bo<256;++bo)_g[bo]=9;for(bo=256;bo<280;++bo)_g[bo]=7;for(bo=280;bo<288;++bo)_g[bo]=8;var Xl=new no(32);for(bo=0;bo<32;++bo)Xl[bo]=5;var x_=Pp(_g,9,0),Zu=Pp(_g,9,1),kw=Pp(Xl,5,0),EA=Pp(Xl,5,1),em=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},ku=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},ev=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},M0=function(c){return(c/8|0)+(7&c&&1)},ou=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Uo?Uo:c instanceof Ip?Ip:no)(i-e);return s.set(c.subarray(e,i)),s},ap=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new no(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new no(3*s));var d=function(os){var pr=e.length;if(os>pr){var Bs=new no(Math.max(2*pr,os));Bs.set(e),e=Bs}},_=i.f||0,et=i.p||0,nt=i.b||0,it=i.l,lt=i.d,dt=i.m,pt=i.n,gt=8*s;do{if(!it){i.f=_=ku(c,et,1);var vt=ku(c,et+1,3);if(et+=3,!vt){var Ct=c[(An=M0(et)+4)-4]|c[An-3]<<8,wt=An+Ct;if(wt>s){if(h)throw"unexpected EOF";break}a&&d(nt+Ct),e.set(c.subarray(An,wt),nt),i.b=nt+=Ct,i.p=et=8*wt;continue}if(vt==1)it=Zu,lt=EA,dt=9,pt=5;else{if(vt!=2)throw"invalid block type";var xt=ku(c,et,31)+257,_t=ku(c,et+10,15)+4,Pt=xt+ku(c,et+5,31)+1;et+=14;for(var Rt=new no(Pt),Lt=new no(19),Ot=0;Ot<_t;++Ot)Lt[Nl[Ot]]=ku(c,et+3*Ot,7);et+=3*_t;var qt=em(Lt),en=(1<<qt)-1,cn=Pp(Lt,qt,1);for(Ot=0;Ot<Pt;){var An,fn=cn[ku(c,et,en)];if(et+=15&fn,(An=fn>>>4)<16)Rt[Ot++]=An;else{var Tn=0,gn=0;for(An==16?(gn=3+ku(c,et,3),et+=2,Tn=Rt[Ot-1]):An==17?(gn=3+ku(c,et,7),et+=3):An==18&&(gn=11+ku(c,et,127),et+=7);gn--;)Rt[Ot++]=Tn}}var xn=Rt.subarray(0,xt),Nn=Rt.subarray(xt);dt=em(xn),pt=em(Nn),it=Pp(xn,dt,1),lt=Pp(Nn,pt,1)}if(et>gt){if(h)throw"unexpected EOF";break}}a&&d(nt+131072);for(var Mn=(1<<dt)-1,Hn=(1<<pt)-1,rr=et;;rr=et){var cr=(Tn=it[ev(c,et)&Mn])>>>4;if((et+=15&Tn)>gt){if(h)throw"unexpected EOF";break}if(!Tn)throw"invalid length/literal";if(cr<256)e[nt++]=cr;else{if(cr==256){rr=et,it=null;break}var _i=cr-254;if(cr>264){var xr=op[Ot=cr-257];_i=ku(c,et,(1<<xr)-1)+wm[Ot],et+=xr}var Mr=lt[ev(c,et)&Hn],Tr=Mr>>>4;if(!Mr)throw"invalid distance";if(et+=15&Mr,Nn=My[Tr],Tr>3&&(xr=Dp[Tr],Nn+=ev(c,et)&(1<<xr)-1,et+=xr),et>gt){if(h)throw"unexpected EOF";break}a&&d(nt+131072);for(var Lr=nt+_i;nt<Lr;nt+=4)e[nt]=e[nt-Nn],e[nt+1]=e[nt+1-Nn],e[nt+2]=e[nt+2-Nn],e[nt+3]=e[nt+3-Nn];nt=Lr}}i.l=it,i.p=rr,i.b=nt,it&&(_=1,i.m=dt,i.d=lt,i.n=pt)}while(!_);return nt==e.length?e:ou(e,0,nt)},bu=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},xm=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},Ty=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[Fs,0];if(a==1){var d=new no(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Rt,Lt){return Rt.f-Lt.f}),i.push({s:-1,f:25001});var _=i[0],et=i[1],nt=0,it=1,lt=2;for(i[0]={s:-1,f:_.f+et.f,l:_,r:et};it!=a-1;)_=i[i[nt].f<i[lt].f?nt++:lt++],et=i[nt!=it&&i[nt].f<i[lt].f?nt++:lt++],i[it++]={s:-1,f:_.f+et.f,l:_,r:et};var dt=h[0].s;for(s=1;s<a;++s)h[s].s>dt&&(dt=h[s].s);var pt=new Uo(dt+1),gt=Uv(i[it-1],pt,0);if(gt>e){s=0;var vt=0,Ct=gt-e,wt=1<<Ct;for(h.sort(function(Rt,Lt){return pt[Lt.s]-pt[Rt.s]||Rt.f-Lt.f});s<a;++s){var xt=h[s].s;if(!(pt[xt]>e))break;vt+=wt-(1<<gt-pt[xt]),pt[xt]=e}for(vt>>>=Ct;vt>0;){var _t=h[s].s;pt[_t]<e?vt-=1<<e-pt[_t]++-1:++s}for(;s>=0&&vt;--s){var Pt=h[s].s;pt[Pt]==e&&(--pt[Pt],++vt)}gt=e}return[new no(pt),gt]},Uv=function(c,e,i){return c.s==-1?Math.max(Uv(c.l,e,i+1),Uv(c.r,e,i+1)):e[c.s]=i},SA=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Uo(++e),s=0,a=c[0],h=1,d=function(et){i[s++]=et},_=1;_<=e;++_)if(c[_]==a&&_!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[_]}return[i.subarray(0,s),e]},T0=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Fv=function(c,e,i){var s=i.length,a=M0(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},Iy=function(c,e,i,s,a,h,d,_,et,nt,it){bu(e,it++,i),++a[256];for(var lt=Ty(a,15),dt=lt[0],pt=lt[1],gt=Ty(h,15),vt=gt[0],Ct=gt[1],wt=SA(dt),xt=wt[0],_t=wt[1],Pt=SA(vt),Rt=Pt[0],Lt=Pt[1],Ot=new Uo(19),qt=0;qt<xt.length;++qt)Ot[31&xt[qt]]++;for(qt=0;qt<Rt.length;++qt)Ot[31&Rt[qt]]++;for(var en=Ty(Ot,7),cn=en[0],An=en[1],fn=19;fn>4&&!cn[Nl[fn-1]];--fn);var Tn,gn,xn,Nn,Mn=nt+5<<3,Hn=T0(a,_g)+T0(h,Xl)+d,rr=T0(a,dt)+T0(h,vt)+d+14+3*fn+T0(Ot,cn)+(2*Ot[16]+3*Ot[17]+7*Ot[18]);if(Mn<=Hn&&Mn<=rr)return Fv(e,it,c.subarray(et,et+nt));if(bu(e,it,1+(rr<Hn)),it+=2,rr<Hn){Tn=Pp(dt,pt,0),gn=dt,xn=Pp(vt,Ct,0),Nn=vt;var cr=Pp(cn,An,0);for(bu(e,it,_t-257),bu(e,it+5,Lt-1),bu(e,it+10,fn-4),it+=14,qt=0;qt<fn;++qt)bu(e,it+3*qt,cn[Nl[qt]]);it+=3*fn;for(var _i=[xt,Rt],xr=0;xr<2;++xr){var Mr=_i[xr];for(qt=0;qt<Mr.length;++qt){var Tr=31&Mr[qt];bu(e,it,cr[Tr]),it+=cn[Tr],Tr>15&&(bu(e,it,Mr[qt]>>>5&127),it+=Mr[qt]>>>12)}}}else Tn=x_,gn=_g,xn=kw,Nn=Xl;for(qt=0;qt<_;++qt)if(s[qt]>255){Tr=s[qt]>>>18&31,xm(e,it,Tn[Tr+257]),it+=gn[Tr+257],Tr>7&&(bu(e,it,s[qt]>>>23&31),it+=op[Tr]);var Lr=31&s[qt];xm(e,it,xn[Lr]),it+=Nn[Lr],Lr>3&&(xm(e,it,s[qt]>>>5&8191),it+=Dp[Lr])}else xm(e,it,Tn[s[qt]]),it+=gn[s[qt]];return xm(e,it,Tn[256]),it+gn[256]},Lw=new Ip([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Fs=new no(0),Rp=function(c,e,i,s,a,h){var d=c.length,_=new no(s+d+5*(1+Math.ceil(d/7e3))+a),et=_.subarray(s,_.length-a),nt=0;if(!e||d<8)for(var it=0;it<=d;it+=65535){var lt=it+65535;lt<d?nt=Fv(et,nt,c.subarray(it,lt)):(et[it]=h,nt=Fv(et,nt,c.subarray(it,d)))}else{for(var dt=Lw[e-1],pt=dt>>>13,gt=8191&dt,vt=(1<<i)-1,Ct=new Uo(32768),wt=new Uo(vt+1),xt=Math.ceil(i/3),_t=2*xt,Pt=function(Mo){return(c[Mo]^c[Mo+1]<<xt^c[Mo+2]<<_t)&vt},Rt=new Ip(25e3),Lt=new Uo(288),Ot=new Uo(32),qt=0,en=0,cn=(it=0,0),An=0,fn=0;it<d;++it){var Tn=Pt(it),gn=32767&it,xn=wt[Tn];if(Ct[gn]=xn,wt[Tn]=gn,An<=it){var Nn=d-it;if((qt>7e3||cn>24576)&&Nn>423){nt=Iy(c,et,0,Rt,Lt,Ot,en,cn,fn,it-fn,nt),cn=qt=en=0,fn=it;for(var Mn=0;Mn<286;++Mn)Lt[Mn]=0;for(Mn=0;Mn<30;++Mn)Ot[Mn]=0}var Hn=2,rr=0,cr=gt,_i=gn-xn&32767;if(Nn>2&&Tn==Pt(it-_i))for(var xr=Math.min(pt,Nn)-1,Mr=Math.min(32767,it),Tr=Math.min(258,Nn);_i<=Mr&&--cr&&gn!=xn;){if(c[it+Hn]==c[it+Hn-_i]){for(var Lr=0;Lr<Tr&&c[it+Lr]==c[it+Lr-_i];++Lr);if(Lr>Hn){if(Hn=Lr,rr=_i,Lr>xr)break;var os=Math.min(_i,Lr-2),pr=0;for(Mn=0;Mn<os;++Mn){var Bs=it-_i+Mn+32768&32767,Ws=Bs-Ct[Bs]+32768&32767;Ws>pr&&(pr=Ws,xn=Bs)}}}_i+=(gn=xn)-(xn=Ct[gn])+32768&32767}if(rr){Rt[cn++]=268435456|w_[Hn]<<18|Nv[rr];var ks=31&w_[Hn],uo=31&Nv[rr];en+=op[ks]+Dp[uo],++Lt[257+ks],++Ot[uo],An=it+Hn,++qt}else Rt[cn++]=c[it],++Lt[c[it]]}}nt=Iy(c,et,h,Rt,Lt,Ot,en,cn,fn,it-fn,nt),!h&&7&nt&&(nt=Fv(et,nt+1,Fs))}return ou(_,0,s+M0(nt)+a)},bm=function(){for(var c=new Int32Array(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&-306674912)^i>>>1;c[e]=i}return c}(),Lu=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=bm[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},tm=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var _=Math.min(d+2655,h);d<_;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},Bp=function(c,e,i,s,a){return Rp(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},kp=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},Dy=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var _=s[d],et=h[d];if(typeof _=="function"){e+=";"+et+"=";var nt=_.toString();if(_.prototype)if(nt.indexOf("[native code]")!=-1){var it=nt.indexOf(" ",8)+1;e+=nt.slice(it,nt.indexOf("(",it))}else for(var lt in e+=nt,_.prototype)e+=";"+et+".prototype."+lt+"="+_.prototype[lt].toString();else e+=nt}else i[et]=_}return[e,i]},b_=[],Py=function(c,e,i,s){var a;if(!b_[i]){for(var h="",d={},_=c.length-1,et=0;et<_;++et)h=(a=Dy(c[et],h,d))[0],d=a[1];b_[i]=Dy(c[_],h,d)}var nt=kp({},b_[i][1]);return function(it,lt,dt,pt,gt){var vt=new Worker(Sy[lt]||(Sy[lt]=URL.createObjectURL(new Blob([it],{type:"text/javascript"}))));return vt.onerror=function(Ct){return gt(Ct.error,null)},vt.onmessage=function(Ct){return gt(null,Ct.data)},vt.postMessage(dt,pt),vt}(b_[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,nt,function(it){var lt=[];for(var dt in it)(it[dt]instanceof no||it[dt]instanceof Uo||it[dt]instanceof Ip)&&lt.push((it[dt]=new it[dt].constructor(it[dt])).buffer);return lt}(nt),s)},jv=function(){return[no,Uo,Ip,op,Dp,Nl,wm,My,Zu,EA,Is,Pp,em,ku,ev,M0,ou,ap,Eu,Lp,Co]},au=function(){return[no,Uo,Ip,op,Dp,Nl,w_,Nv,x_,_g,kw,Xl,Is,Lw,Fs,Pp,bu,xm,Ty,Uv,SA,T0,Fv,Iy,M0,ou,Rp,Bp,ls,Lp]},b1=function(){return[ot,Ht,At,Lu,bm]},lu=function(){return[ht,Tt]},Em=function(){return[vn,At,tm]},yl=function(){return[Rn]},Lp=function(c){return postMessage(c,[c.buffer])},Co=function(c){return c&&c.size&&new no(c.size)},E_=function(c,e,i,s,a,h){var d=Py(i,s,a,function(_,et){d.terminate(),h(_,et)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},Op=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},S_=function(c,e,i,s,a){var h,d=Py(c,s,a,function(_,et){_?(d.terminate(),e.ondata.call(e,_)):(et[1]&&d.terminate(),e.ondata.call(e,_,et[0],et[1]))});d.postMessage(i),e.push=function(_,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([_,h=et],[_.buffer])},e.terminate=function(){d.terminate()}},Ou=function(c,e){return c[e]|c[e+1]<<8},na=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},Ow=function(c,e){return na(c,e)+4294967296*na(c,e+4)},At=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},ot=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&At(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},ht=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},Tt=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},Ht=function(c){return 10+(c.filename&&c.filename.length+1||0)},vn=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},Rn=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function ar(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var Er=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(Bp(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),ps=function(){return function(c,e){S_([au,function(){return[Op,Er]}],this,ar.call(this,c,e),function(i){var s=new Er(i.data);onmessage=Op(s)},6)}}();function ws(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[au],function(s){return Lp(ls(s.data[0],s.data[1]))},0,i)}function ls(c,e){return Bp(c,e||{},0,0)}var Fo=function(){function c(e){this.s={},this.p=new no(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new no(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=ap(this.p,this.o,this.s);this.ondata(ou(s,i,this.s.b),this.d),this.o=ou(s,this.s.b-32768),this.s.b=this.o.length,this.p=ou(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Ml=function(){return function(c){this.ondata=c,S_([jv,function(){return[Op,Fo]}],this,0,function(){var e=new Fo;onmessage=Op(e)},7)}}();function Np(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[jv],function(s){return Lp(Eu(s.data[0],Co(s.data[1])))},1,i)}function Eu(c,e){return ap(c,e)}var lp=function(){function c(e,i){this.c=Lu(),this.l=0,this.v=1,Er.call(this,e,i)}return c.prototype.push=function(e,i){Er.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=Bp(e,this.o,this.v&&Ht(this.o),i&&8,!i);this.v&&(ot(s,this.o),this.v=0),i&&(At(s,s.length-8,this.c.d()),At(s,s.length-4,this.l)),this.ondata(s,i)},c}(),nm=function(){return function(c,e){S_([au,b1,function(){return[Op,Er,lp]}],this,ar.call(this,c,e),function(i){var s=new lp(i.data);onmessage=Op(s)},8)}}();function I0(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[au,b1,function(){return[zv]}],function(s){return Lp(zv(s.data[0],s.data[1]))},2,i)}function zv(c,e){e||(e={});var i=Lu(),s=c.length;i.p(c);var a=Bp(c,e,Ht(e),8),h=a.length;return ot(a,e),At(a,h-8,i.d()),At(a,h-4,s),a}var C_=function(){function c(e){this.v=1,Fo.call(this,e)}return c.prototype.push=function(e,i){if(Fo.prototype.e.call(this,e),this.v){var s=this.p.length>3?ht(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Fo.prototype.c.call(this,i)},c}(),CA=function(){return function(c){this.ondata=c,S_([jv,lu,function(){return[Op,Fo,C_]}],this,0,function(){var e=new C_;onmessage=Op(e)},9)}}();function MA(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[jv,lu,function(){return[TA]}],function(s){return Lp(TA(s.data[0]))},3,i)}function TA(c,e){return ap(c.subarray(ht(c),-8),e||new no(Tt(c)))}var Ry=function(){function c(e,i){this.c=tm(),this.v=1,Er.call(this,e,i)}return c.prototype.push=function(e,i){Er.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=Bp(e,this.o,this.v&&2,i&&4,!i);this.v&&(vn(s,this.o),this.v=0),i&&At(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),E1=function(){return function(c,e){S_([au,Em,function(){return[Op,Er,Ry]}],this,ar.call(this,c,e),function(i){var s=new Ry(i.data);onmessage=Op(s)},10)}}();function S1(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[au,Em,function(){return[Nw]}],function(s){return Lp(Nw(s.data[0],s.data[1]))},4,i)}function Nw(c,e){e||(e={});var i=tm();i.p(c);var s=Bp(c,e,2,4);return vn(s,e),At(s,s.length-4,i.d()),s}var IA=function(){function c(e){this.v=1,Fo.call(this,e)}return c.prototype.push=function(e,i){if(Fo.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Fo.prototype.c.call(this,i)},c}(),cu=function(){return function(c){this.ondata=c,S_([jv,yl,function(){return[Op,Fo,IA]}],this,0,function(){var e=new IA;onmessage=Op(e)},11)}}();function Uw(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return E_(c,e,[jv,yl,function(){return[Sm]}],function(s){return Lp(Sm(s.data[0],Co(s.data[1])))},5,i)}function Sm(c,e){return ap((Rn(c),c.subarray(2,-4)),e)}var M_=function(){function c(e){this.G=C_,this.I=Fo,this.Z=IA,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new no(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),$u=function(){function c(e){this.G=CA,this.I=Ml,this.Z=cu,this.ondata=e}return c.prototype.push=function(e,i){M_.prototype.push.call(this,e,i)},c}();function kM(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?MA(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?Np(c,e,i):Uw(c,e,i)}function tv(c,e){return c[0]==31&&c[1]==139&&c[2]==8?TA(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?Eu(c,e):Sm(c,e)}var By=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof no?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],kp(s,h[1])]:By(h,d+"/",i,s)}},Su=typeof TextEncoder<"u"&&new TextEncoder,T_=typeof TextDecoder<"u"&&new TextDecoder,PS=0;try{T_.decode(Fs,{stream:!0}),PS=1}catch{}var ky=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,ou(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},LM=function(){function c(e){this.ondata=e,PS?this.t=new TextDecoder:this.p=Fs}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new no(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=ky(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),RS=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(I_(e),this.d=i||!1)},c}();function I_(c,e){if(e){for(var i=new no(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Su)return Su.encode(c);var a=c.length,h=new no(c.length+(c.length>>1)),d=0,_=function(it){h[d++]=it};for(s=0;s<a;++s){if(d+5>h.length){var et=new no(d+8+(a-s<<1));et.set(h),h=et}var nt=c.charCodeAt(s);nt<128||e?_(nt):nt<2048?(_(192|nt>>6),_(128|63&nt)):nt>55295&&nt<57344?(_(240|(nt=65536+(1047552&nt)|1023&c.charCodeAt(++s))>>18),_(128|nt>>12&63),_(128|nt>>6&63),_(128|63&nt)):(_(224|nt>>12),_(128|nt>>6&63),_(128|63&nt))}return ou(h,0,d)}function BS(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(T_)return T_.decode(c);var a=ky(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var D0=function(c){return c==1?3:c<6?2:c==9?1:0},DA=function(c,e){return e+30+Ou(c,e+26)+Ou(c,e+28)},Fw=function(c,e,i){var s=Ou(c,e+28),a=BS(c.subarray(e+46,e+46+s),!(2048&Ou(c,e+8))),h=e+46+s,d=na(c,e+20),_=i&&d==4294967295?jw(c,h):[d,na(c,e+24),na(c,e+42)],et=_[0],nt=_[1],it=_[2];return[Ou(c,e+10),et,nt,a,h+Ou(c,e+30)+Ou(c,e+32),it]},jw=function(c,e){for(;Ou(c,e)!=1;e+=4+Ou(c,e+2));return[Ow(c,e+12),Ow(c,e+4),Ow(c,e+20)]},P0=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Ly=function(c,e,i,s,a,h,d,_){var et=s.length,nt=i.extra,it=_&&_.length,lt=P0(nt);At(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var dt=new Date(i.mtime==null?Date.now():i.mtime),pt=dt.getFullYear()-1980;if(pt<0||pt>119)throw"date not in range 1980-2099";if(At(c,e,pt<<25|dt.getMonth()+1<<21|dt.getDate()<<16|dt.getHours()<<11|dt.getMinutes()<<5|dt.getSeconds()>>>1),e+=4,h!=null&&(At(c,e,i.crc),At(c,e+4,h),At(c,e+8,i.size)),At(c,e+12,et),At(c,e+14,lt),e+=16,d!=null&&(At(c,e,it),At(c,e+6,i.attrs),At(c,e+10,d),e+=14),c.set(s,e),e+=et,lt)for(var gt in nt){var vt=nt[gt],Ct=vt.length;At(c,e,+gt),At(c,e+2,Ct),c.set(vt,e+4),e+=4+Ct}return it&&(c.set(_,e),e+=it),e},D_=function(c,e,i,s,a){At(c,e,101010256),At(c,e+8,i),At(c,e+10,i),At(c,e+12,s),At(c,e+16,a)},Vs=function(){function c(e){this.filename=e,this.c=Lu(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),Kr=function(){function c(e,i){var s=this;i||(i={}),Vs.call(this,e),this.d=new Er(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=D0(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Vs.prototype.push.call(this,e,i)},c}(),Up=function(){function c(e,i){var s=this;i||(i={}),Vs.call(this,e),this.d=new ps(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=D0(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Vs.prototype.push.call(this,e,i)},c}(),oD=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=I_(e.filename),a=s.length,h=e.comment,d=h&&I_(h),_=a!=e.filename.length||d&&h.length!=d.length,et=a+P0(e.extra)+30;if(a>65535)throw"filename too long";var nt=new no(et);Ly(nt,0,e,s,_);var it=[nt],lt=function(){for(var Ct=0,wt=it;Ct<wt.length;Ct++){var xt=wt[Ct];i.ondata(null,xt,!1)}it=[]},dt=this.d;this.d=0;var pt=this.u.length,gt=kp(e,{f:s,u:_,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),dt){var Ct=i.u[pt+1];Ct?Ct.r():i.d=1}dt=1}}),vt=0;e.ondata=function(Ct,wt,xt){if(Ct)i.ondata(Ct,wt,xt),i.terminate();else if(vt+=wt.length,it.push(wt),xt){var _t=new no(16);At(_t,0,134695760),At(_t,4,e.crc),At(_t,8,vt),At(_t,12,e.size),it.push(_t),gt.c=vt,gt.b=et+vt+16,gt.crc=e.crc,gt.size=e.size,dt&&gt.r(),dt=1}else dt&&lt()},this.u.push(gt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(nt=h[a]).f.length+P0(nt.extra)+(nt.o?nt.o.length:0);for(var d=new no(s+22),_=0,et=this.u;_<et.length;_++){var nt=et[_];Ly(d,e,nt,nt.f,nt.u,nt.c,i,nt.o),e+=46+nt.f.length+P0(nt.extra)+(nt.o?nt.o.length:0),i+=nt.b}D_(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function aD(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};By(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,_=0,et=h,nt=new Array(h),it=[],lt=function(){for(var vt=0;vt<it.length;++vt)it[vt]()},dt=function(){var vt=new no(_+22),Ct=d,wt=_-d;_=0;for(var xt=0;xt<et;++xt){var _t=nt[xt];try{var Pt=_t.c.length;Ly(vt,_,_t,_t.f,_t.u,Pt);var Rt=30+_t.f.length+P0(_t.extra),Lt=_+Rt;vt.set(_t.c,Lt),Ly(vt,d,_t,_t.f,_t.u,Pt,_,_t.m),d+=16+Rt+(_t.m?_t.m.length:0),_=Lt+Pt}catch(Ot){return i(Ot,null)}}D_(vt,d,nt.length,wt,Ct),i(null,vt)};h||dt();for(var pt=function(vt){var Ct=a[vt],wt=s[Ct],xt=wt[0],_t=wt[1],Pt=Lu(),Rt=xt.length;Pt.p(xt);var Lt=I_(Ct),Ot=Lt.length,qt=_t.comment,en=qt&&I_(qt),cn=en&&en.length,An=P0(_t.extra),fn=_t.level==0?0:8,Tn=function(gn,xn){if(gn)lt(),i(gn,null);else{var Nn=xn.length;nt[vt]=kp(_t,{size:Rt,crc:Pt.d(),c:xn,f:Lt,m:en,u:Ot!=Ct.length||en&&qt.length!=cn,compression:fn}),d+=30+Ot+An+Nn,_+=76+2*(Ot+An)+(cn||0)+Nn,--h||dt()}};if(Ot>65535&&Tn("filename too long",null),fn)if(Rt<16e4)try{Tn(null,ls(xt,_t))}catch(gn){Tn(gn,null)}else it.push(ws(xt,_t,Tn));else Tn(null,xt)},gt=0;gt<et;++gt)pt(gt);return lt}function OM(c,e){e||(e={});var i={},s=[];By(c,"",i,e);var a=0,h=0;for(var d in i){var _=i[d],et=_[0],nt=_[1],it=nt.level==0?0:8,lt=(Ot=I_(d)).length,dt=nt.comment,pt=dt&&I_(dt),gt=pt&&pt.length,vt=P0(nt.extra);if(lt>65535)throw"filename too long";var Ct=it?ls(et,nt):et,wt=Ct.length,xt=Lu();xt.p(et),s.push(kp(nt,{size:et.length,crc:xt.d(),c:Ct,f:Ot,m:pt,u:lt!=d.length||pt&&dt.length!=gt,o:a,compression:it})),a+=30+lt+vt+wt,h+=76+2*(lt+vt)+(gt||0)+wt}for(var _t=new no(h+22),Pt=a,Rt=h-a,Lt=0;Lt<s.length;++Lt){var Ot=s[Lt];Ly(_t,Ot.o,Ot,Ot.f,Ot.u,Ot.c.length);var qt=30+Ot.f.length+P0(Ot.extra);_t.set(Ot.c,Ot.o+qt),Ly(_t,a,Ot,Ot.f,Ot.u,Ot.c.length,Ot.o,Ot.m),a+=16+qt+(Ot.m?Ot.m.length:0)}return D_(_t,a,s.length,Rt,Pt),_t}var NM=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),lD=function(){function c(){var e=this;this.i=new Fo(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),cD=function(){function c(e,i){var s=this;i<32e4?this.i=new Fo(function(a,h){s.ondata(null,a,h)}):(this.i=new Ml(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=ou(e,0)),this.i.push(e,i)},c.compression=8,c}(),C1=function(){function c(e){this.onfile=e,this.k=[],this.o={0:NM},this.p=Fs}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,_=0,et=void 0,nt=void 0;this.p.length?e.length?((nt=new no(this.p.length+e.length)).set(this.p),nt.set(e,this.p.length)):nt=this.p:nt=e;for(var it=nt.length,lt=this.c,dt=lt&&this.d,pt=function(){var Ct,wt=na(nt,_);if(wt==67324752){d=1,et=_,gt.d=null,gt.c=0;var xt=Ou(nt,_+6),_t=Ou(nt,_+8),Pt=2048&xt,Rt=8&xt,Lt=Ou(nt,_+26),Ot=Ou(nt,_+28);if(it>_+30+Lt+Ot){var qt=[];gt.k.unshift(qt),d=2;var en,cn=na(nt,_+18),An=na(nt,_+22),fn=BS(nt.subarray(_+30,_+=30+Lt),!Pt);cn==4294967295?(Ct=Rt?[-2]:jw(nt,_),cn=Ct[0],An=Ct[1]):Rt&&(cn=-1),_+=Ot,gt.c=cn;var Tn={name:fn,compression:_t,start:function(){if(!Tn.ondata)throw"no callback";if(cn){var gn=s.o[_t];if(!gn)throw"unknown compression type "+_t;(en=cn<0?new gn(fn):new gn(fn,cn,An)).ondata=function(Hn,rr,cr){Tn.ondata(Hn,rr,cr)};for(var xn=0,Nn=qt;xn<Nn.length;xn++){var Mn=Nn[xn];en.push(Mn,!1)}s.k[0]==qt&&s.c?s.d=en:en.push(Fs,!0)}else Tn.ondata(null,Fs,!0)},terminate:function(){en&&en.terminate&&en.terminate()}};cn>=0&&(Tn.size=cn,Tn.originalSize=An),gt.onfile(Tn)}return"break"}if(lt){if(wt==134695760)return et=_+=12+(lt==-2&&8),d=3,gt.c=0,"break";if(wt==33639248)return et=_-=4,d=3,gt.c=0,"break"}},gt=this;_<it-4&&pt()!=="break";++_);if(this.p=Fs,lt<0){var vt=d?nt.subarray(0,et-12-(lt==-2&&8)-(na(nt,et-16)==134695760&&4)):nt.subarray(0,_);dt?dt.push(vt,!!d):this.k[+(d==2)].push(vt)}if(2&d)return this.push(nt.subarray(_),i);this.p=nt.subarray(_)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function UM(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var dt=0;dt<i.length;++dt)i[dt]()},a={},h=c.length-22;na(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=Ou(c,h+8);d||e(null,{});var _=d,et=na(c,h+16),nt=et==4294967295;if(nt){if(h=na(c,h-12),na(c,h)!=101075792)return void e("invalid zip file",null);_=d=na(c,h+32),et=na(c,h+48)}for(var it=function(dt){var pt=Fw(c,et,nt),gt=pt[0],vt=pt[1],Ct=pt[2],wt=pt[3],xt=pt[4],_t=pt[5],Pt=DA(c,_t);et=xt;var Rt=function(Ot,qt){Ot?(s(),e(Ot,null)):(a[wt]=qt,--d||e(null,a))};if(gt)if(gt==8){var Lt=c.subarray(Pt,Pt+vt);if(vt<32e4)try{Rt(null,Eu(Lt,new no(Ct)))}catch(Ot){Rt(Ot,null)}else i.push(Np(Lt,{size:Ct},Rt))}else Rt("unknown compression type "+gt,null);else Rt(null,ou(c,Pt,Pt+vt))},lt=0;lt<_;++lt)it();return s}function M1(c){for(var e={},i=c.length-22;na(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=Ou(c,i+8);if(!s)return{};var a=na(c,i+16),h=a==4294967295;if(h){if(i=na(c,i-12),na(c,i)!=101075792)throw"invalid zip file";s=na(c,i+32),a=na(c,i+48)}for(var d=0;d<s;++d){var _=Fw(c,a,h),et=_[0],nt=_[1],it=_[2],lt=_[3],dt=_[4],pt=_[5],gt=DA(c,pt);if(a=dt,et){if(et!=8)throw"unknown compression type "+et;e[lt]=Eu(c.subarray(gt,gt+nt),new no(it))}else e[lt]=ou(c,gt,gt+nt)}return e}class T1 extends b.hH6{load(e,i,s,a){return this.setResponseType("arraybuffer"),super.load(e,h=>{const d=M1(new Uint8Array(h)),_=new Map(Object.entries(d).map(([et,nt])=>[et,new File([nt],et)]));i==null||i(_)},s,a)}}function I1(){Gs.Importers.push(new Zo(T1,["zip"],!0))}class Vv extends b.Ox3{constructor(e,i){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new b.Ilk(e),this.intensity=i||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),ip(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=so(ip({},i),!1),this.userData={},this.children=s,a.type="DirectionalLight2",a.target=this.target.position.toArray(),Object.assign(a,so(this,!0,e))}fromJSON(e,i){if(e.type!=="DirectionalLight2")return null;const s=e.target,a=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,eo(e,this,!0,i),s&&(e.target=s),a&&(a.color!==void 0&&this.color.set(a.color),a.intensity!==void 0&&(this.intensity=a.intensity),e.object=a),this}}class PA extends b.PMe{constructor(e,i,s,a,h,d){super(e,i,s,a,h,d),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=this.target,a=e.userData;return e.userData={},super.copy(e,i),ip(this.userData,a),s.position.copy(this.target.position),s.updateMatrixWorld(),this.target=s,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i,children:s}=this;this.userData={},this.children=[];const a=super.toJSON(e);return a.userData=so(ip({},i),!1),this.userData={},this.children=s,a.type="SpotLight2",a.target=this.target.position.toArray(),Object.assign(a,so(this,!0,e))}fromJSON(e,i){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),eo(e,this,!0,i),this):this)}}class kS extends b.cek{constructor(e,i,s,a){super(e,i,s,a),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),ip(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,i;(e=this.shadow.map)===null||e===void 0||e.dispose(),(i=this.shadow.mapPass)===null||i===void 0||i.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=so(ip({},i),!1),this.userData={},s.type="PointLight2",Object.assign(s,so(this,!0,e))}fromJSON(e,i){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),eo(e,this,!0,i),this):this}}class D1 extends b.Mig{constructor(e,i){super(e,i),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,i){const s=e.userData;return e.userData={},super.copy(e,i),ip(this.userData,s),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:i}=this;this.userData={};const s=super.toJSON(e);return s.userData=so(ip({},i),!1),this.userData={},s.type="AmbientLight2",Object.assign(s,so(this,!0,e))}fromJSON(e,i){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),eo(e,this,!0,i),this):this}}class FM extends b.aNw{load(e,i,s,a){const h=new b.hH6(this.manager);h.setPath(this.path),h.setResponseType("text"),h.load(e,d=>{try{i(this.parse(d))}catch(_){a?a(_):console.error(_),this.manager.itemError(e)}},s,a)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let i=null,s=null;const a=new b.Pa4(0,0,0),h=new b.Pa4(1,1,1),d=e.split(/[\n\r]+/g);let _=null,et=0;for(let lt=0,dt=d.length;lt<dt;lt++){const pt=d[lt].trim(),gt=pt.split(/\s/g);switch(gt[0]){case"TITLE":i=pt.substring(7,pt.length-1);break;case"LUT_3D_SIZE":const vt=gt[1];s=parseFloat(vt),_=new Uint8Array(s*s*s*4);break;case"DOMAIN_MIN":a.x=parseFloat(gt[1]),a.y=parseFloat(gt[2]),a.z=parseFloat(gt[3]);break;case"DOMAIN_MAX":h.x=parseFloat(gt[1]),h.y=parseFloat(gt[2]),h.z=parseFloat(gt[3]);break;default:const Ct=parseFloat(gt[0]),wt=parseFloat(gt[1]),xt=parseFloat(gt[2]);if(Ct>1||Ct<0||wt>1||wt<0||xt>1||xt<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");_[et+0]=255*Ct,_[et+1]=255*wt,_[et+2]=255*xt,_[et+3]=255,et+=4}}const nt=new b.IEO;nt.image.data=_,nt.image.width=s,nt.image.height=s*s,nt.type=b.ywz,nt.magFilter=b.wem,nt.minFilter=b.wem,nt.wrapS=b.uWy,nt.wrapT=b.uWy,nt.generateMipmaps=!1,nt.needsUpdate=!0;const it=new b.JUT;return it.image.data=_,it.image.width=s,it.image.height=s,it.image.depth=s,it.type=b.ywz,it.magFilter=b.wem,it.minFilter=b.wem,it.wrapS=b.uWy,it.wrapT=b.uWy,it.wrapR=b.uWy,it.generateMipmaps=!1,it.needsUpdate=!0,{title:i,size:s,domainMin:a,domainMax:h,texture:nt,texture3D:it}}}class Gs extends st{constructor(e,i=!1){super(),this._processors=new f_,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],i||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new b.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),I1(),y1(e.renderer.rendererObject),su(e),Ov()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,i,s){this.dispatchEvent({type:"onProgress",url:e,loaded:i,total:s})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,i,s){this.dispatchEvent({type:"onStart",url:e,loaded:i,total:s})}_urlModifier(e){var i;let s=decodeURI(e);const a=(i=this._rootContext)===null||i===void 0?void 0:i.rootUrl;s.includes("://")||!a||s.startsWith(a)||(s=a+s),s=s.replace("./",""),s=s.replace(/^(\/\/)/,"/"),s=s.replace(/\?.*$/,"");const h=this._fileDatabase.get(s);return h?h.ext?(h.objectUrl||(h.objectUrl=URL.createObjectURL(h)+"#"+s),h.objectUrl):(console.error("Unable to determine file extension",h),e):e}_createLoader(e){const i=this._getImporter(e),s=i==null?void 0:i.ctor(this);return s&&(i==null||i.ext.forEach(a=>{const h=new RegExp(a.startsWith("data:")?"^"+a+"\\/":"\\."+a+"$","i");this._loadingManager.addHandler(h,s)})),s&&(this._loaderCache.push({loader:s,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:s})),s}async importFiles(e,i={}){const s=new Map;let{allowedExtensions:a}=i;if(a&&a.length<1&&(a=void 0),e.size===0)return s;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const h=[],d=[];if(e.forEach((_,et)=>{var nt;this.registerFile(et,_);const it=_.ext;it&&((nt=a==null?void 0:a.includes(it.toLowerCase()))===null||nt===void 0||nt)&&(this._isRootFileExtension(it)?h.push(et):d.push(et))}),h.length>0)for(const _ of h){let et=await this._importFile(_,void 0,i);et&&(et=await this.processImported(et,i)),s.set(_,et)}else for(const _ of d){let et=await this._importFile(_,void 0,i);et&&(et=await this.processImported(et,i)),s.set(_,et)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((_,et)=>{this.unregisterFile(et)}),s}registerFile(e,i){var s,a,h;e=e.replace(/\?.*$/,"");const d=(s=i==null?void 0:i.ext)!==null&&s!==void 0?s:(h=my((a=i==null?void 0:i.name)!==null&&a!==void 0?a:e))===null||h===void 0?void 0:h.toLowerCase();i&&(i.ext||(i.ext=d),this._fileDatabase.set(e,i));let _=this._getLoader(e);if(_||(_=this._createLoader(i??{name:e,ext:d})),_){for(const et of this._loaderCache)if(et.loader===_){et.files.push(e);break}}return _}unregisterFile(e){e=e.replace(/\?.*$/,"");const i=this._fileDatabase.get(e);i!=null&&i.objectUrl&&(URL.revokeObjectURL(i.objectUrl),i.objectUrl=void 0),i&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return Gs.Importers.find(i=>i.root&&i.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,i,s={},a){var h,d;if(!((h=i)===null||h===void 0)&&h.__imported)return i.__imported;let _;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,i),s.rootPath=e;const et=this.resolveURL(e),nt=e.replace(/\?.*$/,""),it=(d=s.fileHandler)!==null&&d!==void 0?d:await this._loadingManager.getHandler(nt)||(i?await this._loadingManager.getHandler(i.name||i.ext||""):void 0);if(!it)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:et,rootUrl:b.Zp0.extractUrlBase(e),baseUrl:b.Zp0.extractUrlBase(et)},_=await it.loadAsync(e+(s.queryString?(e.includes("?")?"&":"?")+s.queryString:""),lt=>{a&&a(lt),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:lt.loaded/lt.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),i?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),i&&this.unregisterFile(e)}catch(et){return console.error("AssetImporter: Unable to import file",e,i),console.error(et),console.error(et==null?void 0:et.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:et}),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),i&&(i.__imported=_),_}_getImporter(e,i=!1){return Gs.Importers.find(s=>{if(i&&!s.root)return!1;const a=s.ext.find(h=>{var d,_,et;return e.ext&&h===e.ext.toLowerCase()||((_=(d=e.name)===null||d===void 0?void 0:d.toLowerCase())===null||_===void 0?void 0:_.endsWith("."+h.toLowerCase()))||(h==null?void 0:h.startsWith("data:"))&&((et=e.name)===null||et===void 0?void 0:et.startsWith(h))});return!!a&&(e.ext=a,!0)})}_getLoader(e){var i;return(i=this._loadingManager.getHandler(e))!==null&&i!==void 0?i:void 0}async importAsset(e,i={},s){var a;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const _=this._cachedAssets.find(et=>et.path===e.path);_&&Object.assign(e,_)}const d=this._cachedAssets.findIndex(_=>_.path===e.path);d>=0&&this._cachedAssets.splice(d,1),this._cachedAssets.push(e)}let h;if(e!=null&&e.preImported&&(h=await e.preImported),!i.forceImport&&h){const d=await this.processImported(h,i);let _=!1;for(const et of d)if(et.__disposed){_=!0;break}if(!_||i.reimportDisposed===!1)return d}return e.preImported=this._importFile(i.pathOverride||e.path,typeof((a=e.file)===null||a===void 0?void 0:a.arrayBuffer)=="function"?e.file:void 0,i,s),h=await e.preImported,h&&(h=await this.processImported(h,i)),h}async importSingle(e,i={}){var s;return(s=await this.importAsset(e,i))===null||s===void 0?void 0:s[0]}async importSinglePath(e,i){var s;return(s=await this.importPath(e,i))===null||s===void 0?void 0:s[0]}async importPath(e,i={}){const s={...i};delete s.pathOverride,delete s.forceImport,delete s.reimportDisposed;const a=JSON.stringify(s);let h;return h=this._cachedAssets.find(d=>d.path===e&&d._options===a)||{path:e},h._options=a,await this.importAsset(h,i)}async processImportedSingle(e,i={}){return(await this.processImported(e,i))[0]}async processImported(e,i={}){var s,a,h,d,_,et,nt,it;let lt=e;if(!lt)return[];if(i.processImported===!1)return[lt];if(Array.isArray(lt)){const dt=[];for(const pt of lt)dt.push(...await this.processImported(pt,i));return dt}if(!((s=lt.userData)===null||s===void 0)&&s.rootSceneModelRoot){if(i._rootSceneImported=!0,lt.__processedChildren&&!i.forceImporterReprocess)return lt.__processedChildren;if(!(lt.children.length<1))return lt.animations&&(lt.children[0].animations||(lt.children[0].animations=[]),lt.children[0].animations.push(...lt.animations)),lt.__importedViewerConfig&&(lt.children[0].__importedViewerConfig=lt.__importedViewerConfig),lt.__processedChildren=await this.processImported([...lt.children],i),lt.__processedChildren;if(((a=lt.animations)===null||a===void 0?void 0:a.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",lt.animations),!lt.__importedViewerConfig)return[];lt=lt.__importedViewerConfig}if(!((h=lt.userData)===null||h===void 0)&&h.iModel&&(lt=lt.userData.iModel),!((d=lt.userData)===null||d===void 0)&&d.iMaterial&&(lt=lt.userData.iMaterial),lt.assetImporterProcessed&&!i.forceImporterReprocess)return[lt];if(!lt.assetType){if(lt.isBufferGeometry&&(lt=new b.Kj0(lt,new b.Wid)),lt.isObject3D){if(lt.isLight)lt=LS(lt);else{const dt=[];lt.traverse(pt=>{pt!==lt&&pt.isLight&&dt.push(pt)});for(const pt of dt)LS(pt);lt=new Ym(lt,i)}!i.rootPath||lt.modelObject.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.modelObject.userData.rootPath=i.rootPath)}lt.isTexture&&(lt.assetType="texture",i._testDataTextureComplete&&(lt.isDataTexture&&(!((_=lt.image)===null||_===void 0)&&_.data)&&(lt.image.complete=!0),!((et=lt.image)===null||et===void 0)&&et.complete&&(lt.needsUpdate=!0)),i.generateMipmaps!==void 0&&(lt.generateMipmaps=i.generateMipmaps),lt.generateMipmaps||lt.isRenderTargetTexture||(lt.minFilter=lt.minFilter===b.D1R?b.wem:lt.minFilter,lt.magFilter=lt.magFilter===b.D1R?b.wem:lt.magFilter),!i.rootPath||lt.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.userData.rootPath=i.rootPath)),lt.isMaterial&&(lt.assetType="material",!i.rootPath||lt.userData.rootPath||i.rootPath.startsWith("blob:")||i.rootPath.startsWith("/")||(lt.userData.rootPath=i.rootPath))}if(lt.assetType!=null)return lt=await this._processors.process(lt.assetType,lt,{}),lt.assetImporterProcessed=!0,[lt];if(lt instanceof Map)return[...(await this.importFiles(lt,i)).values()].flat();if(lt.type){const dt=this._viewer.getPluginByType(lt.type);if(dt){let pt=lt._importedResources||{};return lt.resources&&(pt=await((nt=this._viewer.getManager())===null||nt===void 0?void 0:nt.importConfigResources(lt.resources)),delete lt.resources,lt._importedResources=pt),typeof dt.fromJSON=="function"&&(await Promise.resolve(dt.fromJSON(lt,pt)),lt.assetImporterProcessed=!1),[]}}else if(lt.plugins)return lt.resources=await((it=this._viewer.getManager())===null||it===void 0?void 0:it.importConfigResources(lt.resources)),await this._viewer.getManager().importViewerConfig(lt),lt.assetImporterProcessed=!1,[];return console.warn("unknown asset type: ",lt),[lt]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function P1(c){if(!c)return b.ywz;const e=c.extensions.has("EXT_color_buffer_half_float")||c.capabilities.isWebGL2&&c.extensions.has("EXT_color_buffer_float"),i=c.capabilities.isWebGL2||c.extensions.has("OES_texture_float")||c.extensions.has("WEBGL_color_buffer_float");return e?b.cLu:i?b.VzW:b.ywz}function LS(c){var e,i,s;if(!c.isLight||c.assetType==="light")return c;if(c.uiConfig)return console.warn("ui config already exists, not supported",c),c;let a;if(c.children.length,c.isDirectionalLight&&(a=new Vv),c.isAmbientLight&&(a=new D1),c.isSpotLight&&(a=new PA),c.isPointLight&&(a=new kS),a){(i=(e=a.lightObject).copy)===null||i===void 0||i.call(e,c);const h=c.parent;!((s=h)===null||s===void 0)&&s.isObject3D&&(h.remove(c),c.dispose(),c.userData.iModel=a,h.add(a.lightObject),a.uuid=c.uuid),Ap(a.lightObject,h)}else console.warn("unknown light type: ",c);return a}Gs.Importers=[new Zo(vy,["json"],!1),new Zo(b.hH6,["txt"],!1),new Zo(b0,["rgbe.png","hdr.png","hdrpng"],!1),new Zo(b.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Zo(FM,["CUBE"],!1)];class jM extends b.u7G{constructor(e){super(e)}async loadAsync(e,i){var s;const a=new b.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials);const h=await a.loadAsync(e,i);try{const d=JSON.parse(h);if(d.images&&this.importer){const _={};let et=d.images;Array.isArray(et)||(et=Object.values(et));for(const nt of d.images){if(!nt.url||!nt.uuid)continue;const it=(s=await this.importer.importPath(nt.url,{processImported:!1}))===null||s===void 0?void 0:s[0],lt=it==null?void 0:it.source;if(!it||!lt)continue;const dt=new b.Hw6(lt.data);dt.uuid=nt.uuid,_[dt.uuid]=dt,it.dispose()}return this.parse(d,_)}return this.parse(d)}catch(d){throw console.error(d),this.manager.itemError(e),d}}parse(e,i){var s,a;let h;const d={p:new Promise(it=>{h=it})};if(e.images||e.textures){const it=new xy(this.manager);let lt={};const dt=Ct=>{h(),d.p=void 0,Object.values(lt).forEach(wt=>{var xt;wt.isTexture&&(!((xt=wt.image)===null||xt===void 0)&&xt.complete)&&(wt.needsUpdate=!0)})};let pt=e.images||[];Array.isArray(pt)||(pt=Object.values(pt));const gt=i||it.parseImages(pt,dt);let vt=e.textures;Array.isArray(vt)||(vt=Object.values(vt)),lt=it.parseTextures2(vt,gt,dt),this.setTextures(lt)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const _={...e};if(Object.entries(_).forEach(([it,lt])=>{lt&&typeof lt=="string"&&this.textures[lt]&&(_[it]=this.textures[lt])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?_.vertexColors=e.vertexColors>0:_.vertexColors=e.vertexColors),e.normalScale!==void 0){let it=e.normalScale;Array.isArray(it)===!1&&(it=[it,it]),_.normalScale=new b.FM8().fromArray(it)}let et=e.type;et!=="MeshPhysicalMaterial"&&et!=="MeshStandardMaterial"||(et=yu.TYPE),_.userData=eo(_.userData,void 0,!1,this);const nt=(a=(s=this.materials)===null||s===void 0?void 0:s.generateFromTemplateType(et,_))!==null&&a!==void 0?a:super.parse(e);return this.setTextures({}),nt.userData.imageLoadAwaiter=d,nt}}class Yr extends st{constructor(e,i,{simpleCache:s=!1,storage:a}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(s||a)&&(s&&(b.CtF.enabled=!0),a&&window.Cache&&typeof window.Cache=="function"&&a instanceof window.Cache)){const h={...b.CtF};b.CtF.get=(d,_,et)=>_?d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")?Promise.resolve(void 0):a.match(d).then(nt=>{if(nt)switch(_){case"arraybuffer":return nt.arrayBuffer();case"blob":return nt.blob();case"document":return nt.text().then(it=>new DOMParser().parseFromString(it,et??"text/html"));case"json":return nt.json();default:if(et===void 0)return nt.text();{const it=/charset="?([^;"\s]*)"?/i.exec(et),lt=it&&it[1]?it[1].toLowerCase():void 0,dt=new TextDecoder(lt);return nt.arrayBuffer().then(pt=>dt.decode(pt))}}}):h.get(d),b.CtF.add=(d,_,et)=>{et||h.add(d,_),d.startsWith("data:")||d.startsWith("blob")||d.startsWith("chrome-extension")||a.put(d,new Response(_,{status:200}))},b.CtF.remove=(d,_)=>{_||h.remove(d),a.delete(d)}}this._importer=e,this._materials=i}async addAsset(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importAsset(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}async addFromPath(e,i={}){if(!this._importer||!this._viewer)return[];const s=await this._importer.importPath(e,i);return s?(this.addProcessedAssets(s,i),s):(console.warn("Unable to import",e,s),[])}addProcessedAssets(e,i){return e.map(s=>{var a;return(a=this._viewer)===null||a===void 0?void 0:a.scene.addSceneObject(s,i)})}async addAssetSingle(e,i={}){var s;return e?(s=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,i))===null||s===void 0?void 0:s[0]:void 0}async addImported(e,i={}){var s;return(s=this._importer)===null||s===void 0?void 0:s.processImported(e,i).then(a=>(this.addProcessedAssets(a,i),a))}async addImportedSingle(e,i={}){return this.addImported(e,i).then(s=>s==null?void 0:s[0])}_sceneUpdated(e){var i;if(e.type==="addSceneObject"){const s=e.object;s.assetType==="material"&&((i=this._materials)===null||i===void 0||i.processMaterial(s,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new v0,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new Gs(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(s,a)=>(_0(s,h=>{var d;return(d=this._materials)===null||d===void 0?void 0:d.processModel(h,{recursive:!1})}),s)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(s,a)=>{var h;return!((h=this.materials)===null||h===void 0)&&h.findMaterial(s.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),s.uuid=qo(),s.userData.uuid&&(s.userData.uuid=s.uuid)),this._materials.processMaterial(s,a)}})),Gs.Importers.push(new Zo(jM,[yu.TypeSlug],!1,s=>(s&&(s.materials=this._materials),s&&(s.importer=this._importer),s)));const i=this.importViewerConfig.bind(this);Gs.Importers.push(new Zo(class extends vy{async loadAsync(s,a){return i(await super.loadAsync(s,a))}},[Yr.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var i,s;e===this._viewer&&((i=this._importer)===null||i===void 0||i.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(s=this._materials)===null||s===void 0||s.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter}get materials(){return this._materials}exportViewerConfig(e){if(!this._viewer)return{};const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},...e},s=this._viewer.toJSON(i);return s.resources=i,s}exportPluginPresets(e){var i;const s={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};return{plugins:(i=this._viewer)===null||i===void 0?void 0:i.serializePlugins(s,e),resources:s}}exportPluginPreset(e){if(!e.toJSON)return;const i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},s=e.toJSON(i);return s.resources=i,s}async importPluginPreset(e,i){var s;const a=e.type;if(!(i=i||((s=this._viewer)===null||s===void 0?void 0:s.getPluginByType(a))))return void console.warn(`No plugin found for type ${a} to import preset`);if(!i.fromJSON)return void console.warn(`Plugin ${a} does not support importing presets`);const h=e.resources||{};return e.resources&&delete e.resources,await i.fromJSON(e,h),h&&(e.resources=h),i}async importViewerConfig(e,i){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const s=await this.importConfigResources(e.resources||{},i);this.applyViewerConfig(e,s)}applyViewerConfig(e,i){var s;if(this._viewer&&this._importer)if((i=i||e.resources).__isLoadedResources){this._viewer.fromJSON(e,i);for(const a of Object.values(i.materials))a.__useCount?delete a.__useCount:(s=this._materials)===null||s===void 0||s.unregisterMaterial(a);for(const a of Object.values(i.textures))a.__useCount&&delete a.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,i,s){var a,h,d;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const _={};i=i??new xy(this._importer.loadingManager),_.animations=e.animations?i.parseAnimations(e.animations):{},s&&s.animations&&(_.animations={..._.animations,...s.animations}),_.shapes=e.shapes?i.parseShapes(e.shapes):{},s&&s.shapes&&(_.shapes={..._.shapes,...s.shapes}),_.geometries=e.geometries?i.parseGeometries(e.geometries,_.shapes):{},s&&s.geometries&&(_.geometries={..._.geometries,...s.geometries}),_.images=e.images?await i.parseImagesAsync(Object.values(e.images)):{},s&&s.images&&(_.images={..._.images,...s.images});for(const nt of Object.values(e.textures)){const it=(a=nt==null?void 0:nt.userData)===null||a===void 0?void 0:a.rootPath;if(it&&(!nt.image||!_.images[nt.image])){const lt=(h=await this._importer.importPath(it,{processImported:!1}))===null||h===void 0?void 0:h[0],dt=lt==null?void 0:lt.source;if(!lt||!dt)continue;const pt=new b.Hw6(dt.data);nt.image&&(pt.uuid=nt.image),_.images[pt.uuid]=pt,nt.image=pt.uuid,lt.dispose()}}_.textures=e.textures?i.parseTextures2(Object.values(e.textures),_.images,()=>{Object.values(_.textures).forEach(nt=>{var it;nt.isTexture&&(!((it=nt.image)===null||it===void 0)&&it.complete)&&(nt.needsUpdate=!0)})}):{};for(const nt of Object.entries(_.textures))nt[1]=(d=await this._importer.processImported(nt[1],{}))===null||d===void 0?void 0:d[0],nt[1]?_.textures[nt[0]]=nt[1]:delete _.textures[nt[0]];s&&s.textures&&(_.textures={..._.textures,...s.textures});const et=e.materials?Object.values(e.materials):[];for(const nt of et)Object.entries(nt).forEach(([it,lt])=>{lt&&lt.resource&&lt.uuid&&lt.resource==="textures"&&(nt[it]=lt.uuid)});return _.materials=i.parseMaterials2(et,_.textures,this._materials),s&&s.materials&&(_.materials={..._.materials,...s.materials}),e.object&&(_.object=i.parseObject(e.object,_.geometries,_.materials,_.textures,_.animations),e.skeletons&&(_.skeletons=i.parseSkeletons(e.skeletons,_.object),i.bindSkeletons(_.object,_.skeletons))),_.__isLoadedResources=!0,_}}Yr.PluginType="AssetManager",Yr.ViewerTypeSlug="vjson";class Ns extends st{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const i=so(this,!0,e);return i.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:i}),i}fromJSON(e,i){return e.type!==this.constructor.PluginType?null:(eo(e,this,!0,i),this.dispatchEvent({type:"deserialize",data:e}),this)}}function Oy(c,e,i){return{...e,get dirty(){return e.dirty||!1},set dirty(s){bn(e,"dirty",s,!0)},update(){var s,a,h;this.passObject.enabled&&((a=(s=this.passObject).updateShaderProperties)===null||a===void 0||a.call(s,Yt(i)),(h=e.update)===null||h===void 0||h.call(this))},onRegister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(Yr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.registerMaterialExtension(this.passObject.materialExtension)),(d=e.onRegister)===null||d===void 0||d.call(this,s)},onUnregister(s){var a,h,d;this.passObject.materialExtension&&((h=(a=c.getPlugin(Yr))===null||a===void 0?void 0:a.materials)===null||h===void 0||h.unregisterMaterialExtension(this.passObject.materialExtension)),(d=e.onUnregister)===null||d===void 0||d.call(this,s)},dispose(){var s,a,h;(a=(s=this.passObject).dispose)===null||a===void 0||a.call(s),(h=e.dispose)===null||h===void 0||h.call(this)}}}class nv extends Ns{constructor(){super(),this._enabledTemp=!0}_update(e){var i;return((i=this._pass)===null||i===void 0?void 0:i.enabled)&&this.enabled||!1}get enabled(){var e,i;return((i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||this._enabledTemp}set enabled(e){var i;!((i=this._pass)===null||i===void 0)&&i.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const i={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(s){s&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Oy(e,i),i.passObject.onDirty!==void 0&&i.passObject.onDirty.push(()=>i.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var i,s;this._pass&&e.renderer.unregisterPass(this._pass),(s=(i=this._pass)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=this.pass;return h&&(a.pass=so((s=(i=h)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:h,!1,e)),a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.pass){const h=this.pass;h&&eo(e.pass,(a=(s=h)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:h,!1,i)}return this}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([jn()],nv.prototype,"enabled",null);const OS=new Set,NS=new Set;class zM extends _o{constructor(e,i,s,a){super(void 0,void 0,i,new vo(1,1,1),1),this.target=e}render(e,i,s,a,h){const d=e.getRenderTarget(),_=e.getActiveCubeFace(),et=e.getActiveMipmapLevel();this.scene.traverse(({material:nt})=>{nt&&((nt.transparent&&nt.userData.renderToDepth||!nt.transparent&&nt.transmission===0&&nt.userData.renderToDepth===!1)&&(OS.add(nt),nt.transparent=!nt.transparent),Math.abs(nt.transmission||0)>0&&nt.userData.renderToDepth&&(NS.add([nt,nt.transmission]),nt.transmission=0))}),jr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,i,this.target,a,h)),OS.forEach(nt=>nt.transparent=!nt.transparent),OS.clear(),NS.forEach(([nt,it])=>nt.transmission=it),NS.clear(),e.setRenderTarget(d,_,et)}}class Bo extends nv{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var i,s;const a=((i=this._viewer)===null||i===void 0?void 0:i.renderer.isWebGL2)&&this.renderFlagsBuffer,h=e.renderer.createTarget({depthBuffer:!0,type:b.ywz,textureCount:a?2:1});Array.isArray(h.texture)?(h.texture[0].name="gbufferDepthNormal",h.texture[1].name="gbufferFlags",this._gbufferTextures=h.texture):(h.texture.name="gbufferDepthNormal",this._gbufferTextures.push(h.texture)),this._gbufferTarget=h;const d=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("debug");return d&&(d.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&d.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),new zM(h,new bp(a))}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Pv}updateShaderProperties(e){var i,s;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(i=this.getDepthNormal())!==null&&i!==void 0?i:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(s=this.getFlagsTexture())!==null&&s!==void 0?s:void 0;const a=e.uniforms.tGBufferFlags.value?1:0;a!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=a,e.needsUpdate=!0)}return this}}Bo.PluginType="GBuffer";class VM extends _o{constructor(e,i=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=i,this.clear=!0,this.clearColor=new vo(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new fy({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:b.rnI,type:b.cLu,format:b.wk1,minFilter:b.wem,magFilter:b.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,i,s,a,h){var d;let _=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,i,s,a,h),this.needsSwap=_,void(e.userData.mainRenderPass=void 0);const et=e.userData;et||console.error("threejs is not patched?");const nt=this._viewer.useGBufferDepth;let it;if(nt){const dt=(d=this._viewer.getPlugin(Bo))===null||d===void 0?void 0:d.getTarget();if(dt){const pt=e.properties.get(dt);it=pt.__webglDepthRenderbuffer||pt.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let lt=()=>{super.render(e,void 0,s,a,h,it)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(_=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const dt=e.autoClearDepth;e.autoClearDepth=!nt,jr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},lt),e.autoClearDepth=dt}if(!nt){const dt=e.properties.get(s);it=dt.__webglDepthRenderbuffer||dt.__webglDepthbuffer}lt=()=>{super.render(e,void 0,this.transparentTarget,a,h,it)};{const dt=this.clear,pt=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,jr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},lt),this.clear=dt,e.autoClearDepth=pt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),_=!0);{const dt=this.clear;this.clear=!1,et.transmissionRenderTarget=_?i:s,et.blurTransmissionTarget=this.blurTransmissionTarget,jr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=dt}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,i,s,a,h),_=!0)}}else{{const dt=this.clear,pt=e.autoClearDepth;e.autoClearDepth=!nt,this.clear=!0,jr(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},lt),this.clear=dt,e.autoClearDepth=pt}{this._viewer.renderer.blit(s.texture,i,{clear:!0});const dt=this.clear;this.clear=!1,et.transmissionRenderTarget=i,et.blurTransmissionTarget=this.blurTransmissionTarget,jr(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},lt),et.blurTransmissionTarget=void 0,et.transmissionRenderTarget=void 0,this.clear=dt}_=!1}this._releaseTransparentTarget(),this.needsSwap=_,e.userData.mainRenderPass=void 0}}function US(c,e){return c.multiplyScalar(c.w*e),c.w=1,c}function FS(c,e){return US(c,e),new vo(c.x,c.y,c.z)}function jS(c,e){const i=Math.max(c.x,Math.max(c.y,c.z));let s=Math.max(Math.min(i/e,1),0);return s=Math.ceil(255*s)/255,c.divideScalar(s*e),c.w=s,c}function QM(c,e){return jS(new b.Ltg(c.r,c.g,c.b,1),e)}var R1=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};function zS(c){return Object.getPrototypeOf(c).constructor.PluginType}b.Vj0.background.fragmentShader=b.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),b.Vj0.background.fragmentShader=b.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Cm extends st{constructor({isAntialiased:e=!1,useRgbm:i=!0,useGBufferDepth:s=!1,screenShader:a="",...h}){var d;super(),this.console=console,this._state=j.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(dt=>this.resize()):void 0,this._lastSize=new b.FM8,this._onContextRestore=dt=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=dt=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===iv&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=dt=>{var pt;if(!dt||!dt.object)return;const gt=dt.object.__importedViewerConfig||((pt=dt.object.modelObject)===null||pt===void 0?void 0:pt.__importedViewerConfig);if(!gt)return;const vt=this.getManager();vt?vt.applyViewerConfig(gt,gt.resources):this.fromJSON(gt,gt.resources)},this.alert=async dt=>alert(dt),this.confirm=async dt=>confirm(dt),this.prompt=async(dt,pt,gt=!0)=>prompt(dt,pt),this._useRgbm=i,this._useGBufferDepth=s,this._screenShader=a,this._canvas=h.canvas||h0();let _=h.container;if(_&&!h.canvas&&_.appendChild(this._canvas),_||(_=(d=this._canvas.parentElement)!==null&&d!==void 0?d:void 0),!_)throw new Error("No container.");this._container=_,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){try{const dt=window.location.href;if(dt.startsWith("http://localhost:8062")||dt.startsWith("https://localhost:8062"))return!0;await fetch("https://europe-west1-pixotronics-320918.cloudfunctions.net/viewer-hit-test"+"/?u="+encodeURIComponent(dt),{mode:"no-cors",method:"POST",credentials:"omit",cache:"no-store",keepalive:!1,referrer:"about:client",referrerPolicy:"unsafe-url"})}catch{return!1}}(),async function(){var dt;const pt=window.location.href,gt="https://dev-sandbox.pixotronics.com/webgi/";if(!pt.startsWith(gt)||f0("noUpdate")!==null)return!0;const vt=(dt=pt.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||dt===void 0?void 0:dt[1],Ct=(await(await fetch(gt+"version.txt")).text()).split(`
`)[0];if(vt&&vt!==Ct){if(confirm(`New version ${Ct} is available, do you want to open?`)){const wt=window.location.href.replace(vt,Ct);return window.location.href=wt,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const et=new Xu(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var dt,pt;const gt=it.scene.activeCamera;if(gt&&gt.interactionsEnabled){if(((dt=this.getPluginByType("Progressive"))===null||dt===void 0?void 0:dt.postFrameConvergedRecordingDelta())===0)return;(pt=gt.controls)===null||pt===void 0||pt.update()}}),this.scene=new u0(et),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Zs({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:i?Xn:b.rnI,type:i?b.ywz:b.cLu,depthBuffer:!s}}),this._isAntialiased=e&&this._renderer.isWebGL2;let nt=!0;this._renderer.rendererObject.userData||(nt=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!nt;const it=this;this.renderFilter={passId:"render",passObject:new VM(this,nt),update(){const dt=this.passObject;dt.scene=it.scene.modelObject,dt.camera=it.scene.activeCamera.cameraObject}};const lt={passId:"screen",after:["render"],required:["render"],passObject:Ny(a)};[this.renderFilter,lt].forEach(dt=>this._renderer.registerPass(dt)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",dt=>this.setDirty(this.scene,dt)),this.scene.addEventListener("sceneUpdate",dt=>{this.setDirty(this.scene,dt),dt.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",dt=>this.setDirty(this.scene,dt)),this._renderer.addEventListener("update",dt=>this.setDirty(this._renderer,dt)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Cm.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,i){this._needsReset=!0,e=e??this,this.dispatchEvent({...i??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:i,xrFrame:s}){var a,h;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let d=0;d<this.maxFramePerLoop;d++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const nt=[this._canvas.clientWidth,this._canvas.clientHeight];if(s){const it=(h=(a=this._renderer.rendererObject.xr.getCamera())===null||a===void 0?void 0:a.cameras[0])===null||h===void 0?void 0:h.viewport;it?(it.x===0&&it.y===0||this.console.warn("x and y must be 0?"),nt[0]=it.width,nt[1]=it.height,this.console.log("resize for xr",nt)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...nt),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:i,xrFrame:s});const _=Object.values(this.plugins).filter(nt=>nt.dirty);_.length>0&&this.setDirty(_),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const et=this._renderer.dirty;if(et){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(nt){this.console.error(nt),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!et)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...i){var s;let a;a=e.prototype?new e(...i):e;const h=zS(a);return h?((s=a.dependencies)===null||s===void 0||s.forEach(d=>{this.getPlugin(d)||(this.console.log("Adding plugin dependency",d.name,"for",h),this.addPlugin(d))}),this.plugins[h]&&this.console.error(`Plugin of type ${h} already exists`,this.plugins[h],a),this.plugins[h]=a,await a.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:a}),this.setDirty(a),a):(this.console.error("PluginType is not defined for",a),a)}async removePlugin(e,i=!0){const s=zS(e);this.plugins[s]&&(await e.onRemove(this),delete this.plugins[s],i&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var i;const s=(i=e.userData.iCamera)!==null&&i!==void 0?i:new Xu(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return s.autoLookAtTarget=!1,s}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,i,s,a;const h=(a=(s=(i=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||i===void 0?void 0:i.background.getPlaneMesh())===null||s===void 0?void 0:s.material.uniforms)!==null&&a!==void 0?a:b.Vj0.background.uniforms;h.intensity||(h.intensity={value:1}),h.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const i=new vo().set(e).convertSRGBToLinear();return this.setBackground(i)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===iv)return this._sceneEnvironmentChanged();const i=e.isVector4?kr(e):Nr(e.isColor?e:new vo(e));return i.assetType="texture",this.scene.setBackground(i)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var i,s,a;if(e)return this._rawBackground;let h=(i=this._rawBackground)!==null&&i!==void 0?i:this.scene.getBackground();return h?(!((s=h)===null||s===void 0)&&s.isVector4&&(h=FS(h,7).getHexString()),!((a=h)===null||a===void 0)&&a.isColor?h.getHexString():this._rawBackground===iv?this.scene.getEnvironment():h):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:i=new b.Pa4(1,1,1),targetOffset:s=new b.Pa4(0,0,0),...a}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const h=e?new Dr().expandByObject(e,!0,!0):this.scene.getBounds(!0),d=h.getCenter(new b.Pa4),_=.5*h.getSize(new b.Pa4).length();d.add(s.clone().multiplyScalar(_)),this.scene.activeCamera.position=new b.Pa4(d.x+i.x*_,d.y+i.y*_,d.z+i.z*_),this.scene.activeCamera.target=d,this.setDirty()}}async createObject3D(e){var i;return(i=this.getManager())===null||i===void 0?void 0:i.addImportedSingle(e||new b.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,i){var s,a,h,d,_;if(!((s=i)===null||s===void 0)&&s.isMaterial){const et=(h=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i.uuid);if(et)return et}return(_=(d=this.getManager())===null||d===void 0?void 0:d.materials)===null||_===void 0?void 0:_.generateFromTemplate(e,i)}serializePlugins(e,i){return Object.entries(this.plugins).map(s=>{var a,h;if(!i||i.includes(s[1].constructor.PluginType))return s[1].serializeWithViewer!==!1?(h=(a=s[1]).toJSON)===null||h===void 0?void 0:h.call(a,e):void 0}).filter(s=>!!s)}deserializePlugins(e,i){return e.forEach(s=>{var a;if(!s.type)return void this.console.warn("Invalid plugin to import ",s);const h=this.getPluginByType(s.type);h&&((a=h.fromJSON)===null||a===void 0||a.call(h,s,i))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,i){return Object.assign({version:Cm.VERSION,plugins:this.serializePlugins(e,i)},so(this,!0,e))}fromJSON(e,i){return eo(e,this,!0,i),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,i),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Cm.VERSION="0.5.5",R1([jn()],Cm.prototype,"scene",void 0),R1([jn("background")],Cm.prototype,"_rawBackground",void 0),R1([jn(),pn(Cm.prototype._backgroundIntensityChanged)],Cm.prototype,"backgroundIntensity",void 0);const iv="envMapBackground";function Ny(c){var e,i,s;return!((e=c)===null||e===void 0)&&e.isShaderPass2?c:new Wl({...yt,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(c)?c[0]:((i=c)===null||i===void 0?void 0:i.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(c)?c[1]:typeof c=="string"?c:((s=c)===null||s===void 0?void 0:s.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var Cu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Tl=class extends Ns{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=c=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const i=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);i&&(i.style.width=this._lastSize[0],i.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(c){var e;if(this.isFullScreen())return;const i=c||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return i?(this._lastFsElement=i,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[i.style.width,i.style.height],i.style.width="100%",i.style.height="100%",i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen?i.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(c){return this.isFullScreen()?this.exit():this.enter(c)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};Tl.PluginType="FullScreenPlugin",Cu([ho("Enter FullScreen")],Tl.prototype,"enter",null),Cu([ho("Exit FullScreen")],Tl.prototype,"exit",null),Cu([ho("Toggle FullScreen")],Tl.prototype,"toggle",null),Tl=Cu([Ys("Full Screen")],Tl);class zw{constructor(e,i,s){this._el=e,this._inputEl=i,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),i==null||i.addEventListener("change",this._onSelect),s&&Object.entries(s).forEach(([a,h])=>h&&this.on(a,h))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,i){return this._listeners[e].push(i),this}_emit(e,i){return this._listeners[e].forEach(s=>s(i)),this}destroy(){const e=this._el,i=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),i==null||i.removeEventListener("change",this._onSelect)}_onDrop(e){var i,s;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const a=Array.from(((i=e.dataTransfer)===null||i===void 0?void 0:i.files)||[]),h=Array.from(((s=e.dataTransfer)===null||s===void 0?void 0:s.items)||[]);if(a.length!==0||h.length!==0)if(h.length>0){const d=h.map(_=>_.webkitGetAsEntry());this._loadNextEntry(new Map,d)}else this._emit("drop",{files:new Map(a.map(d=>(d.filePath=d.name,[d.filePath,d])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var i;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const s=[].slice.call((i=this._inputEl.files)!==null&&i!==void 0?i:new FileList),a=new Map;s.forEach(h=>{h.filePath=h.webkitRelativePath||h.name,a.set(h.filePath,h)}),this._emit("drop",{files:a})}_loadNextEntry(e,i){const s=i.pop();if(s)if(s.isFile)s.file(a=>{a.filePath=s.fullPath,e.set(s.fullPath,a),this._loadNextEntry(e,i)},()=>console.error("Could not load file: %s",s.fullPath));else if(s.isDirectory){const a=s.createReader(),h=d=>{d.length?(i=i.concat(d),a.readEntries(h)):this._loadNextEntry(e,i)};a.readEntries(h)}else console.warn("Unknown asset type: "+s.fullPath),this._loadNextEntry(e,i);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Vw extends st{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!0,autoCenter:!1,autoImport:!0,autoAdd:!0,centerOffset:new b.Pa4(.5,.5,3)},this.dependencies=[Yr],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"pseudoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new zw(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var i,s,a,h,d,_;if(!e)return;const et=this._viewer;if(!et)return;if(this._allowedExtensions!==void 0)for(const lt of e.keys())this._allowedExtensions.includes((s=(i=lt.split(".").pop())===null||i===void 0?void 0:i.toLowerCase())!==null&&s!==void 0?s:"")||e.delete(lt);if(e.size<1)return;const nt=et.getPlugin(Yr),it={type:"drop",files:e};if(this.importerParams.autoImport){const lt={allowedExtensions:this.allowedExtensions,...this.importerParams};if(it.imported=await((a=nt.importer)===null||a===void 0?void 0:a.importFiles(e,lt)),this.importerParams.autoAdd){const dt=(_=[...(d=(h=it.imported)===null||h===void 0?void 0:h.values())!==null&&d!==void 0?d:[]].flat(2).filter(pt=>!!pt))!==null&&_!==void 0?_:[];if(it.assets=nt.addProcessedAssets(dt,{...this.importerParams}),!lt._rootSceneImported)for(const pt of it.assets)pt.modelObject&&pt.modelObject.dispatchEvent({type:"select",value:pt.modelObject})}}this.dispatchEvent(it)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var i;(i=this._dropzone)===null||i===void 0||i.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(i=>"."+i).join(", "):"")}}Vw.PluginType="Dropzone";class VS extends Wl{constructor(e){super({vertexShader:yt.vertexShader,fragmentShader:Qt`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new b.Ltg(1,1,1,1)},weight2:{value:new b.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Qw extends Ns{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const i=this.createPasses(e);this._passes=Object.fromEntries(i.map(s=>(s.passId||(console.warn("no id found for pass",s),s.passId=Au()),e.renderer.registerPass(s,!0),[s.passId,s])))}async onRemove(e){var i;if(this._passes){for(const s of[...Object.values(this._passes)]){const a=s;e.renderer.unregisterPass(a),(i=a==null?void 0:a.dispose)===null||i===void 0||i.call(a)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var i,s;const a=super.toJSON(e);if(!a.type)return a;const h=Object.entries(this.passes);a.passes={};for(const[d,_]of h)a.passes[d]=so((s=(i=_)===null||i===void 0?void 0:i.passObject)!==null&&s!==void 0?s:_,!1,e);return a}fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;if(e.passes){const h=Object.entries(this.passes);for(const[d,_]of h)eo(e.passes[d],(a=(s=_)===null||s===void 0?void 0:s.passObject)!==null&&a!==void 0?a:_,!1,i)}return this}}var GM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const QS=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class Nu extends Qw{constructor(e=2*QS.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=i=>{const s=i.object;(s.modelObject||s.lightObject)&&(s.modelObject||s.lightObject).traverse(a=>{var h;!((h=a==null?void 0:a.shadow)===null||h===void 0)&&h.camera&&a.shadow.mapSize&&this.trackedJitterCameras.add([a.shadow.camera,a.shadow.mapSize])})},this._jitterCamera=i=>{var s;const a=i.target;if(this.jitter&&a.renderer.frameCount>2){const h=(_,et)=>{const nt={...QS[a.renderer.frameCount%QS.length]};_.setViewOffset(et.width,et.height,nt.x,nt.y,et.width,et.height)},d=a.scene.activeCamera.cameraObject;h(d,{width:a.canvas.clientWidth*a.renderer.displayCanvasScaling,height:a.canvas.clientHeight*a.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(_=>h(..._)),this._hasSetOffset=!0,(s=this._viewer)===null||s===void 0||s.renderer.resetShadows()}},this._resetCameraJitter=i=>{const s=i.target;this._hasSetOffset&&(s.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=l0("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const i=this;return[Oy(e,{passId:"progressive",get dirty(){var a;return i.jitter&&(((a=i._viewer)===null||a===void 0?void 0:a.renderer.frameCount)||0)<i.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends VS{render(a,h,d,_,et){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((d==null?void 0:d.texture)&&e.renderer.blit(d.texture,i.lastFrame,{}));this.needsSwap=!0,super.render(a,h,d,_,et),e.renderer.blit(h.texture,i.lastFrame,{})}},update(){if(!i.lastFrame)return void console.error("lastFrame render target undefined");let a=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(a,a,a,a),a=1-a,this.passObject.weights2.set(a,a,a,a),this.passObject.blendTexture=i.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var i;return(((i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var i,s;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(s=(i=this.lastFrame)===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const i=this._viewer.getPluginByType(e);return i&&i.isRecording()&&i.convergeMode?this.isConverged(!0)?1/i.videoFrameRate:0:-1}}Nu.PluginType="Progressive",GM([jn(),qs("Frame count")],Nu.prototype,"maxFrameCount",void 0),GM([jn(),ns("Jitter")],Nu.prototype,"jitter",void 0);var rv="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Gw=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,B1=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,sv=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,GS=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,k1=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,HM=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,L1=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,ov=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let im=class extends Wl{constructor(c,e,i,s=!0){super({vertexShader:rv,fragmentShader:`

varying vec2 vUv;

${B1}
${Gw}
${sv}
${GS}
${i}

${k1}

${HM}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new b.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new b.yGw},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:s?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{if(!a.defines.SSR_ENABLED)return;const _="#glMarker beforeModulation";a.fragmentShader=a.fragmentShader.replace(_,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${_}`)},onObjectRender:(a,h,d)=>{var _,et,nt,it;let lt=this.enabled&&d.userData.screenSpaceRendering!==!1&&!(!((_=h.materialObject.userData)===null||_===void 0)&&_.ssreflDisabled)?1:0;h.materialObject.defines.SSR_ENABLED!==lt&&(h.materialObject.defines.SSR_ENABLED=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_STEP_COUNT,h.materialObject.defines.SSR_STEP_COUNT!==lt&&(h.materialObject.defines.SSR_STEP_COUNT=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_LOW_QUALITY_FRAMES,h.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==lt&&(h.materialObject.defines.SSR_LOW_QUALITY_FRAMES=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.PERSPECTIVE_CAMERA,h.materialObject.defines.PERSPECTIVE_CAMERA!==lt&&(h.materialObject.defines.PERSPECTIVE_CAMERA=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_INLINE,h.materialObject.defines.SSR_INLINE!==lt&&(h.materialObject.defines.SSR_INLINE=lt,h.materialObject.needsUpdate=!0),lt=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,h.materialObject.defines.SSR_MASK_FRONT_RAYS!==lt&&(h.materialObject.defines.SSR_MASK_FRONT_RAYS=lt,h.materialObject.needsUpdate=!0),lt=!((et=h.materialObject.userData)===null||et===void 0)&&et.ssreflNonPhysical?"1":"0",h.materialObject.defines.SSR_NON_PHYSICAL!==lt&&(h.materialObject.defines.SSR_NON_PHYSICAL=lt,h.materialObject.needsUpdate=!0),lt=(it=(nt=this._target)===null||nt===void 0?void 0:nt.texture)!==null&&it!==void 0?it:null,this.materialExtension.extraUniforms.tSSRMap.value!==lt&&(this.materialExtension.extraUniforms.tSSRMap.value=lt,h.materialObject.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+$n("tSSRMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)+$n("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,a.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${B1}
    
    #define THREE_PACKING_INCLUDED
    ${Gw}
    
    ${sv}
    ${GS}
    ${Pv}
    
    ${k1}
    
    ${HM}
// #endif // SSR_INLINE
#endif
`:"")+`

${L1}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssreflDisabled)&&a.isMeshStandardMaterial2}},this.intensity=1,this.boost=new b.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=c,this._target=e,this.needsSwap=!1,this._inline=s}render(c,e,i,s,a){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(c,this._target,i,s,a),this.needsSwap=!1}}};ov([ss("Intensity",[0,4]),jn(),rn()],im.prototype,"intensity",void 0),ov([Kp("Boost"),jn(),rn()],im.prototype,"boost",void 0),ov([ss("Object Radius",[.01,2]),jn(),rn()],im.prototype,"objectRadius",void 0),ov([ns("Auto radius"),jn(),rn()],im.prototype,"autoRadius",void 0),ov([ss("Power",[0,3]),jn(),rn()],im.prototype,"power",void 0),ov([ss("Tolerance",[.1,5]),jn(),rn()],im.prototype,"tolerance",void 0),ov([ss("Step count",[1,32],1),jn(),Fn("SSR_STEP_COUNT")],im.prototype,"stepCount",void 0),ov([ss("Low Quality Frames",[0,4],1),jn(),Fn("SSR_LOW_QUALITY_FRAMES")],im.prototype,"lowQualityFrames",void 0),ov([ns("Ignore front rays"),jn(),Fn("SSR_MASK_FRONT_RAYS")],im.prototype,"maskFrontRays",void 0),ov([ss("Mask front rays factor",[-1,1],.01,c=>({hidden:()=>!c.maskFrontRays})),jn(),rn()],im.prototype,"maskFrontFactor",void 0),im=ov([Ys("Screen Space Reflections")],im);class O1 extends Qw{constructor(){super(),this.dependencies=[Yr,Bo,Nu],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,i;return((i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssr)===null||i===void 0)&&i.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var i,s;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}createPasses(e){var i,s;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Oy(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new im(e.renderer,this._ssrTarget,(s=(i=e.getPlugin(Bo))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",this.inlineSSR)},()=>[e.getPlugin(Bo),e.getPlugin(Nu),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}}O1.PluginType="SSReflection";var WM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class N1 extends Wl{constructor(e,i,s="rgba"){super({vertexShader:yt.vertexShader,fragmentShader:i+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new b.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new b.FM8}},defines:{B_SRC_ACCESSOR:s}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,i,s,a,h){var d,_,et,nt;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((d=this.uniforms.tDiffuse.value)===null||d===void 0?void 0:d.image.width)||0,((_=this.uniforms.tDiffuse.value)===null||_===void 0?void 0:_.image.height)||0),super.render(e,i,this._target,a,h),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=i.texture,this.uniforms.tDiffuseSize.value.set(((et=this.uniforms.tDiffuse.value)===null||et===void 0?void 0:et.image.width)||0,((nt=this.uniforms.tDiffuse.value)===null||nt===void 0?void 0:nt.image.height)||0),super.render(e,this._target,i,a,h))}}WM([jn(),rn()],N1.prototype,"smoothEnabled",void 0),WM([jn(),rn()],N1.prototype,"edgeSharpness",void 0);var qM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class HS extends Wl{constructor(e,i,s){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new b.FM8(512,512)},saoData:{value:new b.Ltg},frameCount:{value:0},cameraNearFar:{value:new b.FM8(.1,1e3)},projection:{value:new b.yGw},saoBiasEpsilon:{value:new b.Pa4(1,1,1)}},vertexShader:rv,fragmentShader:`

${sv}

${s}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(a,h,d)=>{a.defines.SSAO_ENABLED&&(a.fragmentShader=a.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(a,h,d)=>{var _,et;this.materialExtension.extraUniforms.tSSAOMap.value=(_=this._target)===null||_===void 0?void 0:_.texture;const nt=h.materialObject,it=!nt.transparent&&nt.transmission<.001;let lt=this.enabled&&it&&d.userData.screenSpaceRendering!==!1&&!(!((et=h.materialObject.userData)===null||et===void 0)&&et.ssaoDisabled)?1:0;nt.defines.SSAO_ENABLED!==lt&&(nt.defines.SSAO_ENABLED=lt,nt.needsUpdate=!0),lt=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==lt&&(this.materialExtension.extraUniforms.tSSAOMap.value=lt,nt.needsUpdate=!0)},parsFragmentSnippet:a=>{var h;return Qt`
             uniform sampler2D tSSAOMap;
             ${$n("tSSAOMap",(h=this._target)===null||h===void 0?void 0:h.texture,a.capabilities.isWebGL2)}
            ${L1}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:a=>{var h,d;return this.enabled?"1":"0"+((d=(h=this._target)===null||h===void 0?void 0:h.texture)===null||d===void 0?void 0:d.encoding)},isCompatible:a=>{var h;return!(!((h=a.materialObject.userData)===null||h===void 0)&&h.ssaoDisabled)&&a.isMeshStandardMaterial2}},this._renderer=e,this._target=i,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new N1(this._target,s,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,i,s,a,h){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,i,{}),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this._smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const i=this.material.uniforms.saoBiasEpsilon.value;i.x=this.parameters.bias,i.y=.001,i.z=this.parameters.falloff}}qM([jn()],HS.prototype,"bilateralPass",void 0),qM([jn()],HS.prototype,"parameters",void 0);class U1 extends Qw{constructor(){super(),this.dependencies=[Yr,Bo],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var i,s;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Oy(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new HS(e.renderer,this._aoTarget,(s=(i=e.getPlugin(Bo))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Bo)])}},()=>[e.getPlugin(Bo),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,i;return((i=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssao)===null||i===void 0)&&i.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const i=this,s=i.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[s,"enabled"],onChange:i.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[s.parameters,"intensity"],onChange:i.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[s.parameters,"occlusionWorldRadius"],onChange:i.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[s.parameters,"bias"],onChange:i.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[s.parameters,"falloff"],onChange:i.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=s.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>s.material.needsUpdate=!0,i.setDirty]},{type:"checkbox",property:[s.bilateralPass,"smoothEnabled"],onChange:i.setDirty},{type:"vec4",property:[s.bilateralPass,"edgeSharpness"],onChange:i.setDirty}]}}}U1.PluginType="SSAO";class YM{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new b.xsS,this._mesh=new b.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new XM}dispose(){this._mesh.material.dispose()}captureNormalMap(e,i,s=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const a=i==null?void 0:i.split(";").find(et=>this._normalsCache[et]);if(a){const et=this._normalsCache[a];return i==null||i.split(";").forEach(nt=>nt!==a&&(this._normalsCache[nt]=et)),et.width!==s&&console.warn("last cacheKey normalMapRes mismatch, check model",s),e.userData._normalsCaptureMap=et,!1}const h=this._renderer.createTargetCustom({width:s,height:s},{minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1,type:b.cLu},b.oAp);if(!h)throw"Unable to create render target";i==null||i.split(";").forEach(et=>this._normalsCache[et]=h),h.addEventListener("dispose",()=>delete this._normalsCache[i]);const d=new b._am(1e-4,100,h);this._scene.add(d);const _=e.userData._normalsCaptureOffsets;return _.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(_.center),_.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(_.offsetMatrixInv),_.radius!==void 0&&(this._mesh.material.uniforms.radius.value=_.radius),this._mesh.geometry=e,d.update(this._renderer.rendererObject,this._scene),this._scene.remove(d),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=h,!0}}class XM extends b.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:b.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new b.yGw().identity()},offsetCenter:{value:new b.Pa4}}})}}var uD=__webpackgi_require__(654);function KM(c){const e=new b.Pa4(0,0,0),i=new b.Pa4(0,0,0),s=new b.Pa4(0,0,0),a=new b.Pa4(0,0,0),h=c.getAttribute("position"),d=c.index;if(d)for(let dt=Math.max(0,c.drawRange.start),pt=Math.min(d.count,c.drawRange.start+c.drawRange.count)-1;dt<pt/3;dt+=3){const gt=d.getX(dt),vt=d.getX(dt+1),Ct=d.getX(dt+2);i.set(h.getX(gt),h.getY(gt),h.getZ(gt)),s.set(h.getX(vt),h.getY(vt),h.getZ(vt)),a.set(h.getX(Ct),h.getY(Ct),h.getZ(Ct)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a)}else for(let dt=0;dt<h.count;dt+=3)i.set(h.getX(dt),h.getY(dt),h.getZ(dt)),s.set(h.getX(dt+1),h.getY(dt+1),h.getZ(dt+1)),a.set(h.getX(dt+2),h.getY(dt+2),h.getZ(dt+2)),s.sub(i),a.sub(i),a.cross(s),a.normalize(),e.add(a);e.normalize();let _=!1,et=0;for(;!_;){const dt=et/3,pt=d?d.getX(dt):dt,gt=d?d.getX(dt+1):dt+1;i.set(h.getX(pt),h.getY(pt),h.getZ(pt)),s.set(h.getX(gt),h.getY(gt),h.getZ(gt)),i.sub(s),i.normalize();const vt=e.dot(i);Math.abs(vt-1)>.001&&i.length()>.5&&(_=!0),et+=3}s.crossVectors(i,e),s.normalize(),i.crossVectors(e,s),i.normalize();const nt=new b.yGw;nt.elements[0]=i.x,nt.elements[1]=i.y,nt.elements[2]=i.z,nt.elements[3]=0,nt.elements[4]=e.x,nt.elements[5]=e.y,nt.elements[6]=e.z,nt.elements[7]=0,nt.elements[8]=s.x,nt.elements[9]=s.y,nt.elements[10]=s.z,nt.elements[11]=0,nt.elements[12]=0,nt.elements[13]=0,nt.elements[14]=0,nt.elements[15]=1,c.computeBoundingSphere();const it=c.boundingSphere.radius,lt=new b.yGw().makeScale(it,it,it);return nt.multiply(lt),nt}function JM(c){const e=c.getAttribute("position");if(e.count>0)return KM(c);const i=new b.Pa4(0,0,0),s=new b.Pa4(0,0,0),a=new b.Pa4(0,0,0),h=c.index,d=[];if(h)for(let lt=Math.max(0,c.drawRange.start),dt=Math.min(h.count,c.drawRange.start+c.drawRange.count)-1;lt<dt/3;lt+=3){const pt=h.getX(lt),gt=h.getX(lt+1),vt=h.getX(lt+2);i.set(e.getX(pt),e.getY(pt),e.getZ(pt)),s.set(e.getX(gt),e.getY(gt),e.getZ(gt)),a.set(e.getX(vt),e.getY(vt),e.getZ(vt)),d.push(i.toArray(),s.toArray(),a.toArray())}else for(let lt=0;lt<e.count;lt++)i.set(e.getX(lt),e.getY(lt),e.getZ(lt)),d.push(i.toArray());const _=(0,uD.getEigenVectors)(d),et=new b.yGw;et.elements[0]=_[0].vector[0],et.elements[1]=_[0].vector[1],et.elements[2]=_[0].vector[2],et.elements[3]=0,et.elements[4]=_[1].vector[0],et.elements[5]=_[1].vector[1],et.elements[6]=_[1].vector[2],et.elements[7]=0,et.elements[8]=_[2].vector[0],et.elements[9]=_[2].vector[1],et.elements[10]=_[2].vector[2],et.elements[11]=0,et.elements[12]=0,et.elements[13]=0,et.elements[14]=0,et.elements[15]=1,console.log(et.determinant()),c.computeBoundingSphere();const nt=c.boundingSphere.radius,it=new b.yGw().makeScale(nt,nt,nt);return et.multiply(it),et}const ZM={...g0,color:new vo(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new b.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var Fp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class jo extends b.jyz{constructor(e){super({side:b.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new b.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new b.Pa4(1,1,1)}}}),this.typeSlug=jo.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new vo(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new b.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new b.yGw().identity()},radius:{value:1},centerOffset:{value:new b.Pa4(0,0,0)},offsetMatrix:{value:new b.yGw().identity()},offsetMatrixInv:{value:new b.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=i=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(i)},this.userData.separateEnvMapIntensity=!0,this.userData.enableLUT=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,i,s,a,h){var d,_;super.onBeforeRender(e,i,s,a,h),this.uniforms.envMapRotation.value=((d=this.envMap)===null||d===void 0?void 0:d.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(h.matrixWorld).invert();const et=a.userData._normalsCaptureOffsets;et&&(this.extraUniformsToUpload.centerOffset.value.copy(et.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(et.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(et.offsetMatrixInv),this.extraUniformsToUpload.radius.value=et.radius);const nt=(_=a.userData._normalsCaptureMap)===null||_===void 0?void 0:_.texture;this.normalsCaptureMap!==nt&&(this.normalsCaptureMap=nt)}setDirty(e){var i,s;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(s=(i=this._uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0,1)}set envMap(e){var i;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((i=this.__envMap)===null||i===void 0)&&i.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const i={};return i.name=this.name,i.uuid=this.uuid,i.color=this.color.getHex(),i.envMapIntensity=this.envMapIntensity,i.dispersion=this.dispersion,i.squashFactor=this.squashFactor,i.geometryFactor=this.geometryFactor,i.gammaFactor=this.gammaFactor,i.absorptionFactor=this.absorptionFactor,i.reflectivity=this.reflectivity,i.refractiveIndex=this.refractiveIndex,i.rayBounces=this.rayBounces,i.diamondOrientedEnvMap=this.diamondOrientedEnvMap,i.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},i.transmission=this.transmission,i.isDiamondMaterialParameters=!0,i.type=jo.TYPE,i.userData={},qu(i.userData,this.userData),i.userData.uuid=this.userData.uuid,i}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...Mv(this),{type:"input",label:"Mesh count",get value(){var i,s,a;return(a=(s=(i=e.userData)===null||i===void 0?void 0:i.__appliedMeshes)===null||s===void 0?void 0:s.size)!==null&&a!==void 0?a:0},set value(i){},disabled:!0},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:i=>{this.userData.enableLUT=i||void 0,this.setDirty()}},{type:"input",label:"uuid",get value(){return e.uuid},set value(i){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(i){e.userData.renderToDepth=i||void 0}},{type:"button",label:"Download .dmat",value:()=>{eu(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==jo.TYPE)return console.warn("Material type is not supported",e),this;const i={};Bn(e,i,Array.from(Object.keys(ZM)));const s=i.userData;return delete i.userData,this.setValues(i),qu(this.userData,s),this.setDirty(),this}fromJSON(e,i){return this.copyProps(e)}}jo.TypeSlug="dmat",jo.TYPE="DiamondMaterial",Fp([Wm("Color",{limitedUi:!0}),rn()],jo.prototype,"color",void 0),Fp([ss("Env Intensity",[0,5],.01,{limitedUi:!0}),rn()],jo.prototype,"envMapIntensity",void 0),Fp([ss("Dispersion",[0,.1],1e-4,{limitedUi:!0}),rn({propKey:"rIndexDelta"})],jo.prototype,"dispersion",void 0),Fp([ss("Absorption",[0,15],.01,{limitedUi:!0}),rn()],jo.prototype,"absorptionFactor",void 0),Fp([ss("Refractive Index",[0,4],.01,{limitedUi:!0}),rn()],jo.prototype,"refractiveIndex",void 0),Fp([rn()],jo.prototype,"squashFactor",void 0),Fp([rn()],jo.prototype,"geometryFactor",void 0),Fp([rn()],jo.prototype,"gammaFactor",void 0),Fp([Kp("RGB Boost",void 0,void 0,{limitedUi:!0}),rn()],jo.prototype,"boostFactors",void 0),Fp([ss("Transmission",[0,1],.01,{limitedUi:!0}),rn()],jo.prototype,"transmission",void 0),Fp([ss("Reflectivity",[0,2],.01,{limitedUi:!0}),rn()],jo.prototype,"reflectivity",void 0),Fp([Fn("RAY_BOUNCES",void 0,!0),ss("Ray Bounces",[1,16],1)],jo.prototype,"rayBounces",void 0),Fp([Fn("DIA_ORIENT_ENVMAP",void 0,!0),ss("Diamond Oriented Lighting",[0,1],1)],jo.prototype,"diamondOrientedEnvMap",void 0),Fp([rn({propKey:"tCubeMapNormals"})],jo.prototype,"normalsCaptureMap",void 0);class $M extends st{constructor(e,i,s,a){super(),this._scene=e,this._camera=s??this._scene.activeCamera,this.domElement=i,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=a??(h=>h.userData.userSelectable!==!1&&h.userData.bboxVisible!==!1&&h.material!=null&&h.material.type!=="ShadowMaterial"),this.raycaster=new b.iMs,this.mouse=new b.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",h=>this.onPointerMove(h)),this.domElement.addEventListener("pointerleave",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointerout",h=>this.onPointerLeave(h)),this.domElement.addEventListener("pointercancel",h=>this.onPointerCancel(h)),this.domElement.addEventListener("pointerenter",h=>this.onPointerEnter(h)),this.domElement.addEventListener("pointerdown",h=>this.onPointerDown(h)),this.domElement.addEventListener("pointerup",h=>this.onPointerUp(h))}get scene(){return this._scene}set scene(e){var i;(i=this._scene)===null||i===void 0||i.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=Xs(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const i=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-i.x)/i.width*2-1,this.mouse.y=-(e.clientY-i.y)/i.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const i=this.checkIntersection();i&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:i}),this.selectedObject=(i==null?void 0:i.selectedObject)||null}addPasses(){}checkIntersection(){var e;const i=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!i)return null;this.raycaster.setFromCamera(this.mouse,i);const s=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0),a=this.selectedObject;if(a){const h=s.length-1-[...s].reverse().findIndex(d=>{let _=d.object;for(;_;){if(d.object===a)return!0;_=_.parent}return!1});h>=0&&s.splice(0,h+1)}if(s.length>0){for(const h of s){let d=h.object;for(;!(d==null||d.visible&&this.selectionCondition(d));)d=d.parent;if(d)return{selectedObject:d,intersect:h,intersects:s,mouse:this.mouse.toArray()}}return null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const RA=new b.iMs,jp=new b.Pa4,P_=new b.Pa4,xl=new b._fP,eT={X:new b.Pa4(1,0,0),Y:new b.Pa4(0,1,0),Z:new b.Pa4(0,0,1)},WS={type:"change"},tT={type:"mouseDown"},nT={type:"mouseUp",mode:null},iT={type:"objectChange"};class hD extends b.Tme{constructor(e,i){super(),i===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),i=document),this.isTransformControls=!0,this.visible=!1,this.domElement=i,this.domElement.style.touchAction="none";const s=new lT;this._gizmo=s,this.add(s);const a=new pD;this._plane=a,this.add(a);const h=this;function d(wt,xt){let _t=xt;Object.defineProperty(h,wt,{get:function(){return _t!==void 0?_t:xt},set:function(Pt){_t!==Pt&&(_t=Pt,a[wt]=Pt,s[wt]=Pt,h.dispatchEvent({type:wt+"-changed",value:Pt}),h.dispatchEvent(WS))}}),h[wt]=xt,a[wt]=xt,s[wt]=xt}d("camera",e),d("object",void 0),d("enabled",!0),d("axis",null),d("mode","translate"),d("translationSnap",null),d("rotationSnap",null),d("scaleSnap",null),d("space","world"),d("size",1),d("dragging",!1),d("showX",!0),d("showY",!0),d("showZ",!0);const _=new b.Pa4,et=new b.Pa4,nt=new b._fP,it=new b._fP,lt=new b.Pa4,dt=new b._fP,pt=new b.Pa4,gt=new b.Pa4,vt=new b.Pa4,Ct=new b.Pa4;d("worldPosition",_),d("worldPositionStart",et),d("worldQuaternion",nt),d("worldQuaternionStart",it),d("cameraPosition",lt),d("cameraQuaternion",dt),d("pointStart",pt),d("pointEnd",gt),d("rotationAxis",vt),d("rotationAngle",0),d("eye",Ct),this._offset=new b.Pa4,this._startNorm=new b.Pa4,this._endNorm=new b.Pa4,this._cameraScale=new b.Pa4,this._parentPosition=new b.Pa4,this._parentQuaternion=new b._fP,this._parentQuaternionInv=new b._fP,this._parentScale=new b.Pa4,this._worldScaleStart=new b.Pa4,this._worldQuaternionInv=new b._fP,this._worldScale=new b.Pa4,this._positionStart=new b.Pa4,this._quaternionStart=new b._fP,this._scaleStart=new b.Pa4,this._getPointer=qS.bind(this),this._onPointerDown=dD.bind(this),this._onPointerHover=rT.bind(this),this._onPointerMove=F1.bind(this),this._onPointerUp=sT.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;RA.setFromCamera(e,this.camera);const i=YS(this._gizmo.picker[this.mode],RA);this.axis=i?i.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){RA.setFromCamera(e,this.camera);const i=YS(this._plane,RA,!0);i&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(i.point).sub(this.worldPositionStart)),this.dragging=!0,tT.mode=this.mode,this.dispatchEvent(tT)}}pointerMove(e){const i=this.axis,s=this.mode,a=this.object;let h=this.space;if(s==="scale"?h="local":i!=="E"&&i!=="XYZE"&&i!=="XYZ"||(h="world"),a===void 0||i===null||this.dragging===!1||e.button!==-1)return;RA.setFromCamera(e,this.camera);const d=YS(this._plane,RA,!0);if(d){if(this.pointEnd.copy(d.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),h==="local"&&i!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),i.indexOf("X")===-1&&(this._offset.x=0),i.indexOf("Y")===-1&&(this._offset.y=0),i.indexOf("Z")===-1&&(this._offset.z=0),h==="local"&&i!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),a.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(h==="local"&&(a.position.applyQuaternion(xl.copy(this._quaternionStart).invert()),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.position.applyQuaternion(this._quaternionStart)),h==="world"&&(a.parent&&a.position.add(jp.setFromMatrixPosition(a.parent.matrixWorld)),i.search("X")!==-1&&(a.position.x=Math.round(a.position.x/this.translationSnap)*this.translationSnap),i.search("Y")!==-1&&(a.position.y=Math.round(a.position.y/this.translationSnap)*this.translationSnap),i.search("Z")!==-1&&(a.position.z=Math.round(a.position.z/this.translationSnap)*this.translationSnap),a.parent&&a.position.sub(jp.setFromMatrixPosition(a.parent.matrixWorld))));else if(s==="scale"){if(i.search("XYZ")!==-1){let _=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(_*=-1),P_.set(_,_,_)}else jp.copy(this.pointStart),P_.copy(this.pointEnd),jp.applyQuaternion(this._worldQuaternionInv),P_.applyQuaternion(this._worldQuaternionInv),P_.divide(jp),i.search("X")===-1&&(P_.x=1),i.search("Y")===-1&&(P_.y=1),i.search("Z")===-1&&(P_.z=1);a.scale.copy(this._scaleStart).multiply(P_),this.scaleSnap&&(i.search("X")!==-1&&(a.scale.x=Math.round(a.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Y")!==-1&&(a.scale.y=Math.round(a.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),i.search("Z")!==-1&&(a.scale.z=Math.round(a.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const _=20/this.worldPosition.distanceTo(jp.setFromMatrixPosition(this.camera.matrixWorld));i==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):i==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(jp.copy(this.rotationAxis).cross(this.eye))*_):i!=="X"&&i!=="Y"&&i!=="Z"||(this.rotationAxis.copy(eT[i]),jp.copy(eT[i]),h==="local"&&jp.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(jp.cross(this.eye).normalize())*_),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),h==="local"&&i!=="E"&&i!=="XYZE"?(a.quaternion.copy(this._quaternionStart),a.quaternion.multiply(xl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),a.quaternion.copy(xl.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),a.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(WS),this.dispatchEvent(iT)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(nT.mode=this.mode,this.dispatchEvent(nT)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(WS),this.dispatchEvent(iT),this.pointStart.copy(this.pointEnd))}getRaycaster(){return RA}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function qS(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const e=this.domElement.getBoundingClientRect();return{x:(c.clientX-e.left)/e.width*2-1,y:-(c.clientY-e.top)/e.height*2+1,button:c.button}}}function rT(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c))}}function dD(c){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function F1(c){this.enabled&&this.pointerMove(this._getPointer(c))}function sT(c){this.enabled&&(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function YS(c,e,i){const s=e.intersectObject(c,!0);for(let a=0;a<s.length;a++)if(s[a].object.visible||i)return s[a];return!1}const Hw=new b.USm,zo=new b.Pa4(0,1,0),oT=new b.Pa4(0,0,0),aT=new b.yGw,j1=new b._fP,R_=new b._fP,av=new b.Pa4,XS=new b.yGw,Ww=new b.Pa4(1,0,0),R0=new b.Pa4(0,1,0),qw=new b.Pa4(0,0,1),z1=new b.Pa4,Uy=new b.Pa4,Yw=new b.Pa4;class lT extends b.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new b.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),i=new b.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=e.clone();s.opacity=.15;const a=i.clone();a.opacity=.5;const h=e.clone();h.color.setHex(16711680);const d=e.clone();d.color.setHex(65280);const _=e.clone();_.color.setHex(255);const et=e.clone();et.color.setHex(16711680),et.opacity=.5;const nt=e.clone();nt.color.setHex(65280),nt.opacity=.5;const it=e.clone();it.color.setHex(255),it.opacity=.5;const lt=e.clone();lt.opacity=.25;const dt=e.clone();dt.color.setHex(16776960),dt.opacity=.25,e.clone().color.setHex(16776960);const pt=e.clone();pt.color.setHex(7895160);const gt=new b.fHI(0,.04,.1,12);gt.translate(0,.05,0);const vt=new b.DvJ(.08,.08,.08);vt.translate(0,.04,0);const Ct=new b.u9r;Ct.setAttribute("position",new b.a$l([0,0,0,1,0,0],3));const wt=new b.fHI(.0075,.0075,.5,3);function xt(Tn,gn){const xn=new b.XvJ(Tn,.0075,3,64,gn*Math.PI*2);return xn.rotateY(Math.PI/2),xn.rotateX(Math.PI/2),xn}wt.translate(0,.25,0);const _t={X:[[new b.Kj0(gt,h),[.5,0,0],[0,0,-Math.PI/2]],[new b.Kj0(gt,h),[-.5,0,0],[0,0,Math.PI/2]],[new b.Kj0(wt,h),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new b.Kj0(gt,d),[0,.5,0]],[new b.Kj0(gt,d),[0,-.5,0],[Math.PI,0,0]],[new b.Kj0(wt,d)]],Z:[[new b.Kj0(gt,_),[0,0,.5],[Math.PI/2,0,0]],[new b.Kj0(gt,_),[0,0,-.5],[-Math.PI/2,0,0]],[new b.Kj0(wt,_),null,[Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.pQR(.1,0),lt.clone()),[0,0,0]]],XY:[[new b.Kj0(new b.DvJ(.15,.15,.01),it.clone()),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),et.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),nt.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Pt={X:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,.3,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.pQR(.2,0),s)]],XY:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},Rt={START:[[new b.Kj0(new b.pQR(.01,2),a),null,null,null,"helper"]],END:[[new b.Kj0(new b.pQR(.01,2),a),null,null,null,"helper"]],DELTA:[[new b.x12(function(){const Tn=new b.u9r;return Tn.setAttribute("position",new b.a$l([0,0,0,1,1,1],3)),Tn}(),a),null,null,null,"helper"]],X:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new b.x12(Ct,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new b.x12(Ct,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},Lt={XYZE:[[new b.Kj0(xt(.5,1),pt),null,[0,Math.PI/2,0]]],X:[[new b.Kj0(xt(.5,.5),h)]],Y:[[new b.Kj0(xt(.5,.5),d),null,[0,0,-Math.PI/2]]],Z:[[new b.Kj0(xt(.5,.5),_),null,[0,Math.PI/2,0]]],E:[[new b.Kj0(xt(.75,1),dt),null,[0,Math.PI/2,0]]]},Ot={AXIS:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},qt={XYZE:[[new b.Kj0(new b.xo$(.25,10,8),s)]],X:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new b.Kj0(new b.XvJ(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new b.Kj0(new b.XvJ(.75,.1,2,24),s)]]},en={X:[[new b.Kj0(vt,h),[.5,0,0],[0,0,-Math.PI/2]],[new b.Kj0(wt,h),[0,0,0],[0,0,-Math.PI/2]],[new b.Kj0(vt,h),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(vt,d),[0,.5,0]],[new b.Kj0(wt,d)],[new b.Kj0(vt,d),[0,-.5,0],[0,0,Math.PI]]],Z:[[new b.Kj0(vt,_),[0,0,.5],[Math.PI/2,0,0]],[new b.Kj0(wt,_),[0,0,0],[Math.PI/2,0,0]],[new b.Kj0(vt,_),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new b.Kj0(new b.DvJ(.15,.15,.01),it),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),et),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.15,.15,.01),nt),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.DvJ(.1,.1,.1),lt.clone())]]},cn={X:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,.3,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new b.Kj0(new b.fHI(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new b.Kj0(new b.DvJ(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new b.Kj0(new b.DvJ(.2,.2,.2),s),[0,0,0]]]},An={X:[[new b.x12(Ct,a.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new b.x12(Ct,a.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new b.x12(Ct,a.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function fn(Tn){const gn=new b.Tme;for(const xn in Tn)for(let Nn=Tn[xn].length;Nn--;){const Mn=Tn[xn][Nn][0].clone(),Hn=Tn[xn][Nn][1],rr=Tn[xn][Nn][2],cr=Tn[xn][Nn][3],_i=Tn[xn][Nn][4];Mn.name=xn,Mn.tag=_i,Hn&&Mn.position.set(Hn[0],Hn[1],Hn[2]),rr&&Mn.rotation.set(rr[0],rr[1],rr[2]),cr&&Mn.scale.set(cr[0],cr[1],cr[2]),Mn.updateMatrix();const xr=Mn.geometry.clone();xr.applyMatrix4(Mn.matrix),Mn.geometry=xr,Mn.renderOrder=1/0,Mn.position.set(0,0,0),Mn.rotation.set(0,0,0),Mn.scale.set(1,1,1),gn.add(Mn)}return gn}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=fn(_t)),this.add(this.gizmo.rotate=fn(Lt)),this.add(this.gizmo.scale=fn(en)),this.add(this.picker.translate=fn(Pt)),this.add(this.picker.rotate=fn(qt)),this.add(this.picker.scale=fn(cn)),this.add(this.helper.translate=fn(Rt)),this.add(this.helper.rotate=fn(Ot)),this.add(this.helper.scale=fn(An)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const i=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:R_;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let a=0;a<s.length;a++){const h=s[a];let d;h.visible=!0,h.rotation.set(0,0,0),h.position.copy(this.worldPosition),d=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),h.scale.set(1,1,1).multiplyScalar(d*this.size/4),h.tag!=="helper"?(h.quaternion.copy(i),this.mode==="translate"||this.mode==="scale"?(h.name==="X"&&Math.abs(zo.copy(Ww).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Y"&&Math.abs(zo.copy(R0).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="Z"&&Math.abs(zo.copy(qw).applyQuaternion(i).dot(this.eye))>.99&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XY"&&Math.abs(zo.copy(qw).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="YZ"&&Math.abs(zo.copy(Ww).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1),h.name==="XZ"&&Math.abs(zo.copy(R0).applyQuaternion(i).dot(this.eye))<.2&&(h.scale.set(1e-10,1e-10,1e-10),h.visible=!1)):this.mode==="rotate"&&(j1.copy(i),zo.copy(this.eye).applyQuaternion(xl.copy(i).invert()),h.name.search("E")!==-1&&h.quaternion.setFromRotationMatrix(aT.lookAt(this.eye,oT,R0)),h.name==="X"&&(xl.setFromAxisAngle(Ww,Math.atan2(-zo.y,zo.z)),xl.multiplyQuaternions(j1,xl),h.quaternion.copy(xl)),h.name==="Y"&&(xl.setFromAxisAngle(R0,Math.atan2(zo.x,zo.z)),xl.multiplyQuaternions(j1,xl),h.quaternion.copy(xl)),h.name==="Z"&&(xl.setFromAxisAngle(qw,Math.atan2(zo.y,zo.x)),xl.multiplyQuaternions(j1,xl),h.quaternion.copy(xl))),h.visible=h.visible&&(h.name.indexOf("X")===-1||this.showX),h.visible=h.visible&&(h.name.indexOf("Y")===-1||this.showY),h.visible=h.visible&&(h.name.indexOf("Z")===-1||this.showZ),h.visible=h.visible&&(h.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),h.material._color=h.material._color||h.material.color.clone(),h.material._opacity=h.material._opacity||h.material.opacity,h.material.color.copy(h.material._color),h.material.opacity=h.material._opacity,this.enabled&&this.axis&&(h.name===this.axis||this.axis.split("").some(function(_){return h.name===_}))&&(h.material.color.setHex(16776960),h.material.opacity=1)):(h.visible=!1,h.name==="AXIS"?(h.position.copy(this.worldPositionStart),h.visible=!!this.axis,this.axis==="X"&&(xl.setFromEuler(Hw.set(0,0,0)),h.quaternion.copy(i).multiply(xl),Math.abs(zo.copy(Ww).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Y"&&(xl.setFromEuler(Hw.set(0,0,Math.PI/2)),h.quaternion.copy(i).multiply(xl),Math.abs(zo.copy(R0).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="Z"&&(xl.setFromEuler(Hw.set(0,Math.PI/2,0)),h.quaternion.copy(i).multiply(xl),Math.abs(zo.copy(qw).applyQuaternion(i).dot(this.eye))>.9&&(h.visible=!1)),this.axis==="XYZE"&&(xl.setFromEuler(Hw.set(0,Math.PI/2,0)),zo.copy(this.rotationAxis),h.quaternion.setFromRotationMatrix(aT.lookAt(oT,zo,R0)),h.quaternion.multiply(xl),h.visible=this.dragging),this.axis==="E"&&(h.visible=!1)):h.name==="START"?(h.position.copy(this.worldPositionStart),h.visible=this.dragging):h.name==="END"?(h.position.copy(this.worldPosition),h.visible=this.dragging):h.name==="DELTA"?(h.position.copy(this.worldPositionStart),h.quaternion.copy(this.worldQuaternionStart),jp.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),jp.applyQuaternion(this.worldQuaternionStart.clone().invert()),h.scale.copy(jp),h.visible=this.dragging):(h.quaternion.copy(i),this.dragging?h.position.copy(this.worldPositionStart):h.position.copy(this.worldPosition),this.axis&&(h.visible=this.axis.search(h.name)!==-1)))}super.updateMatrixWorld(e)}}class pD extends b.Kj0{constructor(){super(new b._12(1e5,1e5,2,2),new b.vBJ({visible:!1,wireframe:!0,side:b.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let i=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(i="local"),z1.copy(Ww).applyQuaternion(i==="local"?this.worldQuaternion:R_),Uy.copy(R0).applyQuaternion(i==="local"?this.worldQuaternion:R_),Yw.copy(qw).applyQuaternion(i==="local"?this.worldQuaternion:R_),zo.copy(Uy),this.mode){case"translate":case"scale":switch(this.axis){case"X":zo.copy(this.eye).cross(z1),av.copy(z1).cross(zo);break;case"Y":zo.copy(this.eye).cross(Uy),av.copy(Uy).cross(zo);break;case"Z":zo.copy(this.eye).cross(Yw),av.copy(Yw).cross(zo);break;case"XY":av.copy(Yw);break;case"YZ":av.copy(z1);break;case"XZ":zo.copy(Yw),av.copy(Uy);break;case"XYZ":case"E":av.set(0,0,0)}break;default:av.set(0,0,0)}av.length()===0?this.quaternion.copy(this.cameraQuaternion):(XS.lookAt(jp.set(0,0,0),av,zo),this.quaternion.setFromRotationMatrix(XS)),super.updateMatrixWorld(e)}}const cT=new b.ZzF,V1=new b.Pa4;class uT extends b.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new b.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new b.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const i=this.attributes.instanceStart,s=this.attributes.instanceEnd;return i!==void 0&&(i.applyMatrix4(e),s.applyMatrix4(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new b.$TI(i,6,1);return this.setAttribute("instanceStart",new b.kB5(s,3,0)),this.setAttribute("instanceEnd",new b.kB5(s,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let i;e instanceof Float32Array?i=e:Array.isArray(e)&&(i=new Float32Array(e));const s=new b.$TI(i,6,1);return this.setAttribute("instanceColorStart",new b.kB5(s,3,0)),this.setAttribute("instanceColorEnd",new b.kB5(s,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new b.Uk6(e.geometry)),this}fromLineSegments(e){const i=e.geometry;return this.setPositions(i.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new b.ZzF);const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;e!==void 0&&i!==void 0&&(this.boundingBox.setFromBufferAttribute(e),cT.setFromBufferAttribute(i),this.boundingBox.union(cT))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new b.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,i=this.attributes.instanceEnd;if(e!==void 0&&i!==void 0){const s=this.boundingSphere.center;this.boundingBox.getCenter(s);let a=0;for(let h=0,d=e.count;h<d;h++)V1.fromBufferAttribute(e,h),a=Math.max(a,s.distanceToSquared(V1)),V1.fromBufferAttribute(i,h),a=Math.max(a,s.distanceToSquared(V1));this.boundingSphere.radius=Math.sqrt(a),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class fD extends uT{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new b.Uk6(e))}}b.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new b.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},b.Vj0.line={uniforms:b.rDY.merge([b.rBU.common,b.rBU.fog,b.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class hT extends b.jyz{constructor(e){super({type:"LineMaterial",uniforms:b.rDY.clone(b.Vj0.line.uniforms),vertexShader:b.Vj0.line.vertexShader,fragmentShader:b.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(i){this.uniforms.diffuse.value=i}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(i){i===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(i){this.uniforms.linewidth.value=i}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(i){Boolean(i)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),i===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(i){this.uniforms.dashScale.value=i}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(i){this.uniforms.dashSize.value=i}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(i){this.uniforms.dashOffset.value=i}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(i){this.uniforms.gapSize.value=i}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(i){this.uniforms.opacity.value=i}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(i){this.uniforms.resolution.value.copy(i)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(i){Boolean(i)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),i===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const dT=new b.Pa4,KS=new b.Pa4;class pT extends b.Kj0{constructor(e=new uT,i=new hT({color:16777215*Math.random()})){super(e,i),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,i=e.attributes.instanceStart,s=e.attributes.instanceEnd,a=new Float32Array(2*i.count);for(let d=0,_=0,et=i.count;d<et;d++,_+=2)dT.fromBufferAttribute(i,d),KS.fromBufferAttribute(s,d),a[_]=_===0?0:a[_-1],a[_+1]=a[_]+dT.distanceTo(KS);const h=new b.$TI(a,2,1);return e.setAttribute("instanceDistanceStart",new b.kB5(h,1,0)),e.setAttribute("instanceDistanceEnd",new b.kB5(h,1,1)),this}}class JS extends b.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const i=new Dr().expandByObject(e,!1);i.getCenter(this.position);const s=i.getBoundingSphere(new b.aLr).radius;this.scale.setScalar(s*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const i=new fD(e);this._geometry=i;const s=new hT({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new b.FM8(1024,1024),dashed:!1,toneMapped:!1}),a=new pT(i,s);a.computeLineDistances(),a.scale.set(1,1,1),a.visible=!0,this.add(a)}setVisible(e){var i;e!==this.visible&&(this.visible=e,(i=this.setDirty)===null||i===void 0||i.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class ZS extends JS{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new b.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new Dr().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var Xw=function(c){return function(e){return 1-c(1-e)}},Q1=function(c){return function(e){return e<=.5?c(2*e)/2:(2-c(2*(1-e)))/2}},fT=function(c){return function(e){return Math.pow(e,c)}},G1=function(c){return function(e){return e*e*((c+1)*e-c)}},mT=function(c){var e=G1(c);return function(i){return(i*=2)<1?.5*e(i):.5*(2-Math.pow(2,-10*(i-1)))}},Kw=function(c){return c},Fy=fT(2),gT=Xw(Fy),$S=Q1(Fy),eC=function(c){return 1-Math.sin(Math.acos(c))},H1=Xw(eC),tC=Q1(H1),B0=G1(1.525),vT=Xw(B0),W1=Q1(B0),nC=mT(1.525),Jw=function(c){if(c===1||c===0)return c;var e=c*c;return c<.36363636363636365?7.5625*e:c<.7272727272727273?9.075*e-9.9*c+3.4:c<.9?12.066481994459833*e-19.63545706371191*c+8.898060941828255:10.8*c*c-20.52*c+10.72},_T=Xw(Jw),AT=function(c){return c<.5?.5*(1-Jw(1-2*c)):.5*Jw(2*c-1)+.5},Il=function(){return Il=Object.assign||function(c){for(var e,i=1,s=arguments.length;i<s;i++)for(var a in e=arguments[i])Object.prototype.hasOwnProperty.call(e,a)&&(c[a]=e[a]);return c},Il.apply(this,arguments)};function iC(c,e){var i={};for(var s in c)Object.prototype.hasOwnProperty.call(c,s)&&e.indexOf(s)<0&&(i[s]=c[s]);if(c!=null&&typeof Object.getOwnPropertySymbols=="function"){var a=0;for(s=Object.getOwnPropertySymbols(c);a<s.length;a++)e.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(c,s[a])&&(i[s[a]]=c[s[a]])}return i}var B_=function(c,e,i){return Math.min(Math.max(i,c),e)};function jy(c,e){return c*Math.sqrt(1-e*e)}var yT=["duration","bounce"],q1=["stiffness","damping","mass"];function _h(c,e){return e.some(function(i){return c[i]!==void 0})}function Qv(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.restSpeed,d=h===void 0?2:h,_=c.restDelta,et=iC(c,["from","to","restSpeed","restDelta"]),nt={done:!1,value:i},it=function(Pt){var Rt=Il({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},Pt);if(!_h(Pt,q1)&&_h(Pt,yT)){var Lt=function(Ot){var qt,en,cn=Ot.duration,An=cn===void 0?800:cn,fn=Ot.bounce,Tn=fn===void 0?.25:fn,gn=Ot.velocity,xn=gn===void 0?0:gn,Nn=Ot.mass,Mn=Nn===void 0?1:Nn,Hn=1-Tn;Hn=B_(.05,1,Hn),An=B_(.01,10,An/1e3),Hn<1?(qt=function(_i){var xr=_i*Hn,Mr=xr*An;return .001-(xr-xn)/jy(_i,Hn)*Math.exp(-Mr)},en=function(_i){var xr=_i*Hn*An,Mr=xr*xn+xn,Tr=Math.pow(Hn,2)*Math.pow(_i,2)*An,Lr=Math.exp(-xr),os=jy(Math.pow(_i,2),Hn);return(.001-qt(_i)>0?-1:1)*((Mr-Tr)*Lr)/os}):(qt=function(_i){return Math.exp(-_i*An)*((_i-xn)*An+1)-.001},en=function(_i){return Math.exp(-_i*An)*(An*An*(xn-_i))});var rr=function(_i,xr,Mr){for(var Tr=Mr,Lr=1;Lr<12;Lr++)Tr-=_i(Tr)/xr(Tr);return Tr}(qt,en,5/An);if(An*=1e3,isNaN(rr))return{stiffness:100,damping:10,duration:An};var cr=Math.pow(rr,2)*Mn;return{stiffness:cr,damping:2*Hn*Math.sqrt(Mn*cr),duration:An}}(Pt);(Rt=Il(Il(Il({},Rt),Lt),{velocity:0,mass:1})).isResolvedFromDuration=!0}return Rt}(et),lt=it.stiffness,dt=it.damping,pt=it.mass,gt=it.velocity,vt=it.duration,Ct=it.isResolvedFromDuration,wt=Y1,xt=Y1;function _t(){var Pt=gt?-gt/1e3:0,Rt=a-i,Lt=dt/(2*Math.sqrt(lt*pt)),Ot=Math.sqrt(lt/pt)/1e3;if(_!=null||(_=Math.abs(a-i)<=1?.01:.4),Lt<1){var qt=jy(Ot,Lt);wt=function(cn){var An=Math.exp(-Lt*Ot*cn);return a-An*((Pt+Lt*Ot*Rt)/qt*Math.sin(qt*cn)+Rt*Math.cos(qt*cn))},xt=function(cn){var An=Math.exp(-Lt*Ot*cn);return Lt*Ot*An*(Math.sin(qt*cn)*(Pt+Lt*Ot*Rt)/qt+Rt*Math.cos(qt*cn))-An*(Math.cos(qt*cn)*(Pt+Lt*Ot*Rt)-qt*Rt*Math.sin(qt*cn))}}else if(Lt===1)wt=function(cn){return a-Math.exp(-Ot*cn)*(Rt+(Pt+Ot*Rt)*cn)};else{var en=Ot*Math.sqrt(Lt*Lt-1);wt=function(cn){var An=Math.exp(-Lt*Ot*cn),fn=Math.min(en*cn,300);return a-An*((Pt+Lt*Ot*Rt)*Math.sinh(fn)+en*Rt*Math.cosh(fn))/en}}}return _t(),{next:function(Pt){var Rt=wt(Pt);if(Ct)nt.done=Pt>=vt;else{var Lt=1e3*xt(Pt),Ot=Math.abs(Lt)<=d,qt=Math.abs(a-Rt)<=_;nt.done=Ot&&qt}return nt.value=nt.done?a:Rt,nt},flipTarget:function(){var Pt;gt=-gt,i=(Pt=[a,i])[0],a=Pt[1],_t()}}}Qv.needsInterpolation=function(c,e){return typeof c=="string"||typeof e=="string"};var Y1=function(c){return 0},k_=function(c,e,i){var s=e-c;return s===0?1:(i-c)/s},k0=function(c,e,i){return-i*c+i*e+c},BA=function(c,e){return function(i){return Math.max(Math.min(i,e),c)}},Gv=function(c){return c%1?Number(c.toFixed(5)):c},L0=/(-)?([\d]*\.?[\d])+/g,kA=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,wT=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function L_(c){return typeof c=="string"}var O_={test:function(c){return typeof c=="number"},parse:parseFloat,transform:function(c){return c}},Zw=Il(Il({},O_),{transform:BA(0,1)}),X1=(Il(Il({},O_),{default:1}),function(c,e){return function(i){return Boolean(L_(i)&&wT.test(i)&&i.startsWith(c)||e&&Object.prototype.hasOwnProperty.call(i,e))}}),K1=function(c,e,i){return function(s){var a;if(!L_(s))return s;var h=s.match(L0),d=h[0],_=h[1],et=h[2],nt=h[3];return(a={})[c]=parseFloat(d),a[e]=parseFloat(_),a[i]=parseFloat(et),a.alpha=nt!==void 0?parseFloat(nt):1,a}},xT=BA(0,255),J1=Il(Il({},O_),{transform:function(c){return Math.round(xT(c))}}),O0={test:X1("rgb","red"),parse:K1("red","green","blue"),transform:function(c){var e=c.red,i=c.green,s=c.blue,a=c.alpha,h=a===void 0?1:a;return"rgba("+J1.transform(e)+", "+J1.transform(i)+", "+J1.transform(s)+", "+Gv(Zw.transform(h))+")"}},zy={test:X1("#"),parse:function(c){var e="",i="",s="",a="";return c.length>5?(e=c.substr(1,2),i=c.substr(3,2),s=c.substr(5,2),a=c.substr(7,2)):(e=c.substr(1,1),i=c.substr(2,1),s=c.substr(3,1),a=c.substr(4,1),e+=e,i+=i,s+=s,a+=a),{red:parseInt(e,16),green:parseInt(i,16),blue:parseInt(s,16),alpha:a?parseInt(a,16)/255:1}},transform:O0.transform},bT=function(c){return{test:function(e){return L_(e)&&e.endsWith(c)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+c}}},Vy=bT("%"),LA=(Il(Il({},Vy),{parse:function(c){return Vy.parse(c)/100},transform:function(c){return Vy.transform(100*c)}}),{test:X1("hsl","hue"),parse:K1("hue","saturation","lightness"),transform:function(c){var e=c.hue,i=c.saturation,s=c.lightness,a=c.alpha,h=a===void 0?1:a;return"hsla("+Math.round(e)+", "+Vy.transform(Gv(i))+", "+Vy.transform(Gv(s))+", "+Gv(Zw.transform(h))+")"}}),ET=function(c,e,i){var s=c*c,a=e*e;return Math.sqrt(Math.max(0,i*(a-s)+s))},ST=[zy,O0,LA],CT=function(c){return ST.find(function(e){return e.test(c)})},Z1=function(c,e){var i=CT(c),s=CT(e);i.transform,s.transform;var a=i.parse(c),h=s.parse(e),d=Il({},a),_=i===LA?k0:ET;return function(et){for(var nt in d)nt!=="alpha"&&(d[nt]=_(a[nt],h[nt],et));return d.alpha=k0(a.alpha,h.alpha,et),i.transform(d)}},rC=function(c){return O0.test(c)||zy.test(c)||LA.test(c)},sC=function(c){return O0.test(c)?O0.parse(c):LA.test(c)?LA.parse(c):zy.parse(c)},Qy=function(c){return L_(c)?c:c.hasOwnProperty("red")?O0.transform(c):LA.transform(c)},oC="${c}",MT="${n}";function $w(c){var e=[],i=0,s=c.match(kA);s&&(i=s.length,c=c.replace(kA,oC),e.push.apply(e,s.map(sC)));var a=c.match(L0);return a&&(c=c.replace(L0,MT),e.push.apply(e,a.map(O_.parse))),{values:e,numColors:i,tokenised:c}}function OA(c){return $w(c).values}function aC(c){var e=$w(c),i=e.values,s=e.numColors,a=e.tokenised,h=i.length;return function(d){for(var _=a,et=0;et<h;et++)_=_.replace(et<s?oC:MT,et<s?Qy(d[et]):Gv(d[et]));return _}}var TT=function(c){return typeof c=="number"?0:c},ex={test:function(c){var e,i,s,a;return isNaN(c)&&L_(c)&&((i=(e=c.match(L0))===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)+((a=(s=c.match(kA))===null||s===void 0?void 0:s.length)!==null&&a!==void 0?a:0)>0},parse:OA,createTransformer:aC,getAnimatableNone:function(c){var e=OA(c);return aC(c)(e.map(TT))}},tx={x:0,y:0,z:0},$1=function(c){return typeof c=="number"},cp=function(c,e){return function(i){return e(c(i))}},eE=function(){for(var c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];return c.reduce(cp)};function lC(c,e){return $1(c)?function(i){return k0(c,e,i)}:rC(c)?Z1(c,e):Hv(c,e)}var cC=function(c,e){var i=function(h,d){for(var _=0,et=d.length,nt=h.length;_<et;_++,nt++)h[nt]=d[_];return h}([],c),s=i.length,a=c.map(function(h,d){return lC(h,e[d])});return function(h){for(var d=0;d<s;d++)i[d]=a[d](h);return i}},uC=function(c,e){var i=Il(Il({},c),e),s={};for(var a in i)c[a]!==void 0&&e[a]!==void 0&&(s[a]=lC(c[a],e[a]));return function(h){for(var d in s)i[d]=s[d](h);return i}};function nx(c){for(var e=ex.parse(c),i=e.length,s=0,a=0,h=0,d=0;d<i;d++)s||typeof e[d]=="number"?s++:e[d].hue!==void 0?h++:a++;return{parsed:e,numNumbers:s,numRGB:a,numHSL:h}}var Hv=function(c,e){var i=ex.createTransformer(e),s=nx(c),a=nx(e);return eE(cC(s.parsed,a.parsed),i)},IT=function(c,e){return function(i){return k0(c,e,i)}};function tE(c,e,i){var s=i===void 0?{}:i,a=s.clamp,h=a===void 0||a,d=s.ease,_=s.mixer,et=c.length;e.length,!d||!Array.isArray(d)||d.length,c[0]>c[et-1]&&(c=[].concat(c),e=[].concat(e),c.reverse(),e.reverse());var nt=function(lt,dt,pt){for(var gt=[],vt=pt||(typeof(Pt=lt[0])=="number"?IT:typeof Pt=="string"?rC(Pt)?Z1:Hv:Array.isArray(Pt)?cC:typeof Pt=="object"?uC:void 0),Ct=lt.length-1,wt=0;wt<Ct;wt++){var xt=vt(lt[wt],lt[wt+1]);if(dt){var _t=Array.isArray(dt)?dt[wt]:dt;xt=eE(_t,xt)}gt.push(xt)}var Pt;return gt}(e,d,_),it=et===2?function(lt,dt){var pt=lt[0],gt=lt[1],vt=dt[0];return function(Ct){return vt(k_(pt,gt,Ct))}}(c,nt):function(lt,dt){var pt=lt.length,gt=pt-1;return function(vt){var Ct=0,wt=!1;if(vt<=lt[0]?wt=!0:vt>=lt[gt]&&(Ct=gt-1,wt=!0),!wt){for(var xt=1;xt<pt&&!(lt[xt]>vt||xt===gt);xt++);Ct=xt-1}var _t=k_(lt[Ct],lt[Ct+1],vt);return dt[Ct](_t)}}(c,nt);return h?function(lt){return it(B_(c[0],c[et-1],lt))}:it}function Wv(c,e){return c.map(function(){return e||$S}).splice(0,c.length-1)}function Gy(c){var e=c.from,i=e===void 0?0:e,s=c.to,a=s===void 0?1:s,h=c.ease,d=c.offset,_=c.duration,et=_===void 0?300:_,nt={done:!1,value:i},it=Array.isArray(a)?a:[i,a],lt=function(gt,vt){return gt.map(function(Ct){return Ct*vt})}(d&&d.length===it.length?d:function(gt){var vt=gt.length;return gt.map(function(Ct,wt){return wt!==0?wt/(vt-1):0})}(it),et);function dt(){return tE(lt,it,{ease:Array.isArray(h)?h:Wv(it,h)})}var pt=dt();return{next:function(gt){return nt.value=pt(gt),nt.done=gt>=et,nt},flipTarget:function(){it.reverse(),pt=dt()}}}function nE(c){var e=c.velocity,i=e===void 0?0:e,s=c.from,a=s===void 0?0:s,h=c.power,d=h===void 0?.8:h,_=c.timeConstant,et=_===void 0?350:_,nt=c.restDelta,it=nt===void 0?.5:nt,lt=c.modifyTarget,dt={done:!1,value:a},pt=d*i,gt=a+pt,vt=lt===void 0?gt:lt(gt);return vt!==gt&&(pt=vt-a),{next:function(Ct){var wt=-pt*Math.exp(-Ct/et);return dt.done=!(wt>it||wt<-it),dt.value=dt.done?vt:vt+wt,dt},flipTarget:function(){}}}var hC={keyframes:Gy,spring:Qv,decay:nE},iE=1/60*1e3,rE=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},ix=typeof window<"u"?function(c){return window.requestAnimationFrame(c)}:function(c){return setTimeout(function(){return c(rE())},iE)},sE=!0,Hy=!1,dC=!1,rx={delta:0,timestamp:0},sx=["read","update","preRender","render","postRender"],pC=sx.reduce(function(c,e){return c[e]=function(i){var s=[],a=[],h=0,d=!1,_=new WeakSet,et={schedule:function(nt,it,lt){it===void 0&&(it=!1),lt===void 0&&(lt=!1);var dt=lt&&d,pt=dt?s:a;return it&&_.add(nt),pt.indexOf(nt)===-1&&(pt.push(nt),dt&&d&&(h=s.length)),nt},cancel:function(nt){var it=a.indexOf(nt);it!==-1&&a.splice(it,1),_.delete(nt)},process:function(nt){var it;if(d=!0,s=(it=[a,s])[0],(a=it[1]).length=0,h=s.length)for(var lt=0;lt<h;lt++){var dt=s[lt];dt(nt),_.has(dt)&&(et.schedule(dt),i())}d=!1}};return et}(function(){return Hy=!0}),c},{}),lv=sx.reduce(function(c,e){var i=pC[e];return c[e]=function(s,a,h){return a===void 0&&(a=!1),h===void 0&&(h=!1),Hy||lE(),i.schedule(s,a,h)},c},{}),oE=sx.reduce(function(c,e){return c[e]=pC[e].cancel,c},{}),DT=function(c){return pC[c].process(rx)},aE=function(c){Hy=!1,rx.delta=sE?iE:Math.max(Math.min(c-rx.timestamp,40),1),rx.timestamp=c,dC=!0,sx.forEach(DT),dC=!1,Hy&&(sE=!1,ix(aE))},lE=function(){Hy=!0,sE=!0,dC||ix(aE)},cE=function(){return rx},fC=lv;function uE(c,e,i){return i===void 0&&(i=0),c-e-i}var PT=function(c){var e=function(i){var s=i.delta;return c(s)};return{start:function(){return fC.update(e,!0)},stop:function(){return oE.update(e)}}};function Wy(c){var e,i,s,a,h,d=c.from,_=c.autoplay,et=_===void 0||_,nt=c.driver,it=nt===void 0?PT:nt,lt=c.elapsed,dt=lt===void 0?0:lt,pt=c.repeat,gt=pt===void 0?0:pt,vt=c.repeatType,Ct=vt===void 0?"loop":vt,wt=c.repeatDelay,xt=wt===void 0?0:wt,_t=c.onPlay,Pt=c.onStop,Rt=c.onComplete,Lt=c.onRepeat,Ot=c.onUpdate,qt=iC(c,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),en=qt.to,cn=0,An=qt.duration,fn=!1,Tn=!0,gn=function(Nn){if(Array.isArray(Nn.to))return Gy;if(hC[Nn.type])return hC[Nn.type];var Mn=new Set(Object.keys(Nn));return Mn.has("ease")||Mn.has("duration")&&!Mn.has("dampingRatio")?Gy:Mn.has("dampingRatio")||Mn.has("stiffness")||Mn.has("mass")||Mn.has("damping")||Mn.has("restSpeed")||Mn.has("restDelta")?Qv:Gy}(qt);!((i=(e=gn).needsInterpolation)===null||i===void 0)&&i.call(e,d,en)&&(h=tE([0,100],[d,en],{clamp:!1}),d=0,en=100);var xn=gn(Il(Il({},qt),{from:d,to:en}));return et&&(_t==null||_t(),(s=it(function(Nn){if(Tn||(Nn=-Nn),dt+=Nn,!fn){var Mn=xn.next(Math.max(0,dt));a=Mn.value,h&&(a=h(a)),fn=Tn?Mn.done:dt<=0}Ot==null||Ot(a),fn&&(cn===0&&(An!=null||(An=dt)),cn<gt?function(Hn,rr,cr,_i){return _i?Hn>=rr+cr:Hn<=-cr}(dt,An,xt,Tn)&&(cn++,Ct==="reverse"?dt=function(Hn,rr,cr,_i){return cr===void 0&&(cr=0),_i===void 0&&(_i=!0),_i?uE(rr+-Hn,rr,cr):rr-(Hn-rr)+cr}(dt,An,xt,Tn=cn%2==0):(dt=uE(dt,An,xt),Ct==="mirror"&&xn.flipTarget()),fn=!1,Lt&&Lt()):(s.stop(),Rt&&Rt()))})).start()),{stop:function(){Pt==null||Pt(),s.stop()}}}const NA={linear:Kw,easeIn:Fy,easeOut:gT,easeInOut:$S,circIn:eC,circOut:H1,circInOut:tC,backIn:B0,backOut:vT,backInOut:W1,anticipate:nC,bounceOut:Jw,bounceIn:_T,bounceInOut:AT,easeInOutSine:function(c){return-(Math.cos(Math.PI*c)-1)/2}};async function Dl(c){return new Promise(e=>setTimeout(e,Math.max(0,c)))}function ox(c,e,i){const s=c[e],a=()=>{typeof(c==null?void 0:c.setDirty)=="function"&&c.setDirty(),i==null||i()};return s.isVector3||s.isVector2||s.isVector4?h=>{s.copy(h),a()}:h=>{c[e]=h,a()}}function mC(c){return typeof c!="boolean"}async function ax(c,e,i){e in c||console.error("invalid key",e,c);const s=ox(c,e),a=c[e],h=d=>{var _;s(d),(_=i.onUpdate)===null||_===void 0||_.call(i,d)};if(mC(a))return typeof i.to=="function"&&(i={...i,to:i.to(a,c)}),gC({...i,from:a,onUpdate:h});{const{duration:d}=i;return Dl(d??0).then(()=>h(i.to))}}async function gC(c){return new Promise((e,i)=>{Wy({onComplete:()=>{var s;(s=c.onComplete)===null||s===void 0||s.call(c),e()},onStop:()=>{var s;(s=c.onStop)===null||s===void 0||s.call(c),e()},...c})})}class N0 extends nv{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[Nu],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(!s)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==s)return void(this.pointerEnabled=!0);const a=s.getBoundingClientRect(),h=(e.clientX-a.left)/a.width,d=(e.clientY-a.top)/a.height;this.pointerEnabled=h<0||h>1||d<0||d>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:b.wem,magFilter:b.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await Dl(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const i=this,s=e.getPlugin(Nu),a=new class extends VS{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=l0("Frame Fade",this)}render(h,d,_,et,nt){this.needsSwap=!1;const it=i._target;if(!it||!i.pointerEnabled||!this.enabled||!i.dirty||i._fadeTimeState<.001)return;i._toSaveFrame&&s.lastFrame&&(e.renderer.blit(s.lastFrame.texture,it),this._lastTime=0,i._toSaveFrame=!1),this.blendTexture=it==null?void 0:it.texture;const lt=i._fadeTimeState/i._fadeTime;this.weights2.setScalar(lt),this.weights2.w=1,this.weights1.setScalar(1-lt),this.weights1.w=1,super.render(h,d,_,et,nt),this.needsSwap=!0;const dt=Xs();this._lastTime<10&&(this._lastTime=dt-10);const pt=dt-this._lastTime;this._lastTime=dt,i._fadeTimeState-=pt}};return a.enabled=!0,a}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const i=this._disabledBy.indexOf(e);i>=0&&this._disabledBy.splice(i,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}N0.PluginType="FrameFade";var hE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d},vC=b.M8C.degToRad;class mo extends Ns{constructor(e=ZS,i=!1,s=!0,a=!1){super(),this.enabled=!0,this.autoFocus=!1,this._onObjectHit=h=>{this._viewer&&(this.enabled?this.dispatchEvent(h):h.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const h=this.getSelectedObject();this.autoFocus&&h&&this.setSelectedObject(h,!0)}}],e&&(this._widget=new e),this._controls=i,this._pickUi=s,this.autoFocus=a}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,i=!1){if(!this.enabled||!this._picker)return;const s=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=s,(s||i)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new $M(e.scene,e.canvas,void 0,i=>{var s,a;if(!i.material)return!1;let h=i,d=!1;for(;h;){if(!h.visible||(((s=h.userData.iModel)!==null&&s!==void 0?s:h).assetType==="model"&&(d=!0),((a=h.userData.iModel)!==null&&a!==void 0?a:h).assetType==="widget")||h.userData.userSelectable===!1||h.userData.bboxVisible===!1)return!1;h=h.parent}return d}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new _C(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",i=>{var s,a,h,d;this.dispatchEvent(i);const _=((s=this._picker)===null||s===void 0?void 0:s.selectedObject)||void 0;if(this._pickUi){const it=(a=_)===null||a===void 0?void 0:a.uiConfig,lt=this.uiConfig;lt.children=[...this._uiConfigChildren],it&&lt.children.push(it),(h=lt.uiRefresh)===null||h===void 0||h.call(lt)}const et=this._widget;et&&(_?et.attach(_):et.detach());const nt=this._transformControls;nt&&(!((d=this._viewer)===null||d===void 0)&&d.scene.activeCamera.controls)&&(_&&nt.enabled?nt.attach(_):nt.detach()),e.setDirty(),this.autoFocus&&this.focusObject(_)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",i=>{i.value?this.setSelectedObject(i.value,this.autoFocus||i.focusCamera):console.warn("e.value must be set for picking")}),e.scene.addEventListener("addSceneObject",async i=>{var s,a,h;const d=i.object,_=this.getSelectedObject();if(_&&(d==null?void 0:d.assetType)==="material"&&typeof(_==null?void 0:_.setMaterial)=="function"&&(!((s=_==null?void 0:_.modelObject)===null||s===void 0)&&s.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const et=_.material;if(Array.isArray(et))console.warn("Dropping on material array not yet fully supported."),_.setMaterial(d);else{let nt=Array.from((a=et==null?void 0:et.userData.__appliedMeshes)!==null&&a!==void 0?a:[]);(nt.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):nt.length<1)&&(nt=[_]);for(const it of nt)it&&((h=it.setMaterial)===null||h===void 0||h.call(it,d))}}}),e.scene.addEventListener("sceneUpdate",i=>{if(!i.hierarchyChanged)return;const s=this.getSelectedObject();let a=!1;s==null||s.traverseAncestors(h=>{h===e.scene.modelObject&&(a=!0)}),a||this.setSelectedObject(void 0)})}async focusObject(e){var i,s,a,h;const d=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews");await(d==null?void 0:d.animateToObject(e,4,1e3,"easeOut",{min:((h=(a=(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera.getControls())===null||a===void 0?void 0:a.minDistance)!==null&&h!==void 0?h:.5)+.5,max:5}))}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}mo.PluginType="Picking",hE([jn(),ns()],mo.prototype,"enabled",void 0),hE([jn()],mo.prototype,"autoFocus",void 0);class _C extends hD{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var i;(i=this==null?void 0:this.object)===null||i===void 0||i.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",i=>{const s=e==null?void 0:e.getPlugin(N0);s&&(s.enabled=!i.value),this._scene.activeCamera.interactionsEnabled=!i.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(vC(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var qy=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class $a extends Ns{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,i)=>{const s=[];return e.modelObject.traverse(a=>{var h,d,_,et;const nt=(d=(h=a.userData)===null||h===void 0?void 0:h.gltfExtensions)===null||d===void 0?void 0:d[$a.DIAMOND_GLTF_EXTENSION];nt&&a.geometry&&(this.prepareDiamondMesh(a,nt),delete a.userData.gltfExtensions[$a.DIAMOND_GLTF_EXTENSION]),a.material&&!s.includes(a.material)&&(!((et=(_=a.material.userData)===null||_===void 0?void 0:_.gltfExtensions)===null||et===void 0)&&et[$a.DIAMOND_GLTF_EXTENSION])&&(a.material.materialObject||console.warn("material not processed",a.material),s.push(a.material))}),s.forEach(a=>{const h=a.userData.gltfExtensions[$a.DIAMOND_GLTF_EXTENSION];h&&this._convertToDiamondMaterial(a,h)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==yu.TypeSlug},value:async()=>{var e,i,s,a,h,d;const _=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();if(!(_!=null&&_.material))return;const et=await((s=this._viewer)===null||s===void 0?void 0:s.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let nt=parseInt(await((a=this._viewer)===null||a===void 0?void 0:a.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(nt)||(nt=512),nt<64&&(nt=64),((h=_.material.userData)===null||h===void 0?void 0:h.__appliedMeshes.size)>1&&await((d=this._viewer)===null||d===void 0?void 0:d.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(_.material,{cacheKey:et||void 0,normalMapRes:nt},{}):this.makeDiamondMesh(_,{cacheKey:et||void 0,normalMapRes:nt},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,i,s;const a=(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject())===null||s===void 0?void 0:s.material;return!!Array.isArray(a)||(a==null?void 0:a.typeSlug)!==jo.TypeSlug},value:async()=>{var e,i,s,a,h,d,_,et;const nt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject(),it=nt==null?void 0:nt.material;if(!it)return;const lt=it.userData._baseMaterial;let dt=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(lt);if(dt&&!dt.isDiamondMaterial||(dt=(d=this._viewer)===null||d===void 0?void 0:d.createPhysicalMaterial({color:it.color})),dt){const pt=it.userData.__appliedMeshes.size>1&&await((_=this._viewer)===null||_===void 0?void 0:_.confirm("Convert all with this material?"))?Array.from(it.userData.__appliedMeshes):[nt];for(const gt of pt)(et=gt==null?void 0:gt.setMaterial)===null||et===void 0||et.call(gt,dt)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,i;return(i=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&i!==void 0?i:0}set envMapRotation(e){var i;const s=this.envMap;s&&(s.rotation=e,(i=this._viewer)===null||i===void 0||i.scene.setDirty())}refreshEnvMaps(){var e,i,s;if(!this._viewer)return;const a=this.getEnvMap(),h=((i=(e=this._viewer.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.getMaterialsOfType(jo.TypeSlug))||[];for(const d of h)d&&d.envMap!==a&&(d.envMap=a,d.needsUpdate=!0);(s=this._viewer)===null||s===void 0||s.scene.setDirty()}refreshUi(){var e,i,s;(e=this._viewer)===null||e===void 0||e.setDirty(),(s=(i=this.uiConfig)===null||i===void 0?void 0:i.uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async onAdded(e){var i,s,a,h,d,_;this._normalCapture=new YM(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const et=e.getPlugin(Yr);(i=et==null?void 0:et.importer)===null||i===void 0||i.processors.add("model",this._modelProcessor),(s=e.getPlugin(mo))===null||s===void 0||s.addEventListener("selectedObjectChanged",this.refreshUi);const nt=this.getEnvMap,it=new Zo(class extends vy{async loadAsync(lt,dt){var pt;const gt=await super.loadAsync(lt,dt);return gt.type===jo.TYPE||gt.isDiamondMaterialParameters?(gt.envMap=nt(),(pt=et==null?void 0:et.materials)===null||pt===void 0?void 0:pt.generateFromTemplate("diamond",gt)):(console.error("Invalid material type for Diamond Material.",gt),null)}},[jo.TypeSlug],!1);return Gs.Importers.push(it),(d=(h=(a=et==null?void 0:et.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(lx),(_=et==null?void 0:et.materials)===null||_===void 0||_.registerMaterialTemplate({name:"diamond",materialType:jo.TYPE,isDiamondMaterialParameters:!0,generator:(lt,dt)=>{const pt=new jo(lt);return pt.envMap=nt(),dt&&dt!=={}&&pt.copyProps(dt),pt}}),super.onAdded(e)}async onRemove(e){var i,s,a,h;return(i=this._normalCapture)===null||i===void 0||i.dispose(),this._normalCapture=void 0,this.offsetCache={},(a=(s=e.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.processors.remove("model",this._modelProcessor),(h=e.getPlugin(mo))===null||h===void 0||h.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:i,normalMapRes:s}){var a,h,d;e.userData._diamondCacheKey=i??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=s??e.userData._diamondNormalMapRes,i=i&&i.length>0?i.includes(";"+e.geometry.uuid)?i:i+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const _=(h=(a=this._normalCapture)===null||a===void 0?void 0:a.captureNormalMap(e.geometry,i,s))!==null&&h!==void 0?h:[void 0,!1],et=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("debug");et&&_&&(et.counters.normalsCapture||(et.counters.normalsCapture=0),et.counters.normalsCapture++,console.log("DEBUG: new normal map captured",et.counters.normalsCapture,i),et.addTexture("normal"+et.counters.normalsCapture,()=>{var nt;return(nt=e.geometry.userData._normalsCaptureMap)===null||nt===void 0?void 0:nt.texture},[40,110*et.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,i,s){var a,h;Array.from((a=e==null?void 0:e.userData.__appliedMeshes)!==null&&a!==void 0?a:[]).forEach(d=>{d!=null&&d.isMesh&&d.geometry&&this.prepareDiamondMesh(d,i)}),this._convertToDiamondMaterial(e,s),(h=this._viewer)===null||h===void 0||h.setDirty()}makeDiamondMesh(e,i,s){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,i);const a=Array.isArray(e.material)?e.material[0]:e.material,h=this._convertToDiamondMaterial(a,s,!1);e.setMaterial(h)}_convertToDiamondMaterial(e,i={isDiamond:!0},s=!0){var a,h,d,_,et,nt,it;let lt={...i??{}};lt.isDiamond||lt.isDiamondMaterialParameters?Array.isArray(lt.boostFactors)&&(lt.boostFactors=new b.Pa4().fromArray(lt.boostFactors)):lt={isDiamondMaterialParameters:!0},lt.color=(d=(a=lt.color)!==null&&a!==void 0?a:(h=e==null?void 0:e.materialObject)===null||h===void 0?void 0:h.color)!==null&&d!==void 0?d:new vo(1,1,1);const dt=(nt=(et=(_=this._viewer)===null||_===void 0?void 0:_.getManager())===null||et===void 0?void 0:et.materials)===null||nt===void 0?void 0:nt.generateFromTemplate("diamond",lt);if(dt&&e&&!e.isDiamondMaterial&&(dt.userData._baseMaterial=e.uuid),s){const pt=gt=>{var vt;return(vt=gt.setMaterial)!==null&&vt!==void 0?vt:Ct=>{gt.material=Ct.materialObject}};Array.from((it=e==null?void 0:e.userData.__appliedMeshes)!==null&&it!==void 0?it:[]).forEach(gt=>{pt(gt)(dt),this.prepareDiamondMesh(gt,i)})}return dt}_computeOffsets(e,i,s=!1){const a=i.split(";").find(nt=>this.offsetCache[nt]);if(a&&!s){const nt=this.offsetCache[a];return i.split(";").forEach(it=>it!==a&&(this.offsetCache[it]=nt)),e.userData._normalsCaptureOffsets=nt,nt}e.computeBoundingBox();const h=e.boundingBox.getCenter(new b.Pa4),d=JM(e),_=d.clone().invert(),et={center:h,offsetMatrix:d,offsetMatrixInv:_,radius:1,centerOffset:new b.Pa4().copy(h).applyMatrix4(_)};return i.split(";").forEach(nt=>this.offsetCache[nt]=et),e.userData._normalsCaptureOffsets=et,et}}$a.PluginType="Diamond",$a.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",qy([pn($a.prototype.refreshEnvMaps),jn()],$a.prototype,"envMap",void 0),qy([pn($a.prototype.refreshEnvMaps),jn()],$a.prototype,"forceSceneEnvMap",void 0);const lx=c=>({writeMaterial:(e,i)=>{e.isDiamondMaterial&&(i.extensions=i.extensions||{},i.extensions[$a.DIAMOND_GLTF_EXTENSION]=e.toJSON(),c.extensionsUsed[$a.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,i)=>{var s,a;if(!(e!=null&&e.material.isDiamondMaterial))return;i.extensions=i.extensions||{};const h={};(a=(s=e.userData)===null||s===void 0?void 0:s.gltfExtensions)===null||a===void 0||delete a[$a.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(h.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(h.cacheKey=e.userData._diamondCacheKey),i.extensions[$a.DIAMOND_GLTF_EXTENSION]=h,c.extensionsUsed[$a.DIAMOND_GLTF_EXTENSION]=!0}});var rm,uu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Go=rm=class extends Ns{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[Yr],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=c=>{const e=c.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(i=>{const s=i.animations;if(s.length<1)return;const a=Math.max(...s.map(_=>_.duration));s.forEach(_=>_.duration=a);const h=new b.Xcj(this._viewer.scene.modelRoot.modelObject),d=s.map(_=>h.clipAction(_).setLoop(this.loopAnimations?b.YKA:b.jAl,this.loopRepetitions));this.animations.push({mixer:h,clips:s,actions:d,duration:a}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:c}){this.enabled&&Math.abs(c)>.001&&(this._scrollAnimationState=-1*Math.sign(c))}_postFrame(){var c,e;if(!this._viewer)return;const i=this._viewer,s=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!s)return this._lastFrameTime=0,void(this._fadeDisabled&&((c=this._viewer.getPluginByType("FrameFade"))===null||c===void 0||c.enable(rm.PluginType),this._fadeDisabled=!1));const a=Xs()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/30);let h=a-this._lastFrameTime;if(h*=this.animationSpeed,this._lastFrameTime=a,s&&(h*=this._scrollAnimationState),Math.abs(h)<1e-4)return;const d=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0&&(this.animations.map(_=>_.mixer.update(h)),this._animationTime+=h,this._animationTime>this._animationDuration&&(this._animationTime-=this._animationDuration),this._animationTime<0&&(this._animationTime+=this._animationDuration),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,i.scene.activeCamera.cameraObject.userData.__animatingCamera&&i.scene.activeCamera.setDirty(),i.renderer.resetShadows(),i.setDirty(),!this._fadeDisabled)){const _=this._viewer.getPluginByType("FrameFade");_&&(_.disable(rm.PluginType),this._fadeDisabled=!0)}}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new U0(e,this))}async onAdded(c){var e,i,s,a,h,d;(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.scene.addEventListener("addSceneObject",this._objectAdded),(d=(h=(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||h===void 0?void 0:h.extensions)===null||d===void 0||d.push(cx),c.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let _=-1;return Object.defineProperty(c.scene.modelRoot,"currentTimelineMarker",{get:()=>_,set:et=>c.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[_=et]})}),c.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:et})=>{var nt;if(!this._viewer)return;if(!et)return this._viewer.scene.activeCamera=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.defaultCamera,void this._viewer.setDirty();const it=et.camera;it&&(it.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(it))}),super.onAdded(c)}async onRemove(c){var e,i;return c.scene.removeEventListener("addSceneObject",this._objectAdded),(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),c.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(c)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:c})=>c))}onStateChange(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.children)===null||e===void 0||e.map(i=>i&&Yt(i)).flat(2).forEach(i=>{var s;return(s=i==null?void 0:i.uiRefresh)===null||s===void 0?void 0:s.call(i)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(c,e=!1){return this.playClips([c],e)}async playClips(c,e=!1){const i=[];return this.animations.forEach(({actions:s})=>{s.forEach(a=>{c.includes(a.getClip().name)&&i.push(a)})}),this.playAnimation(e,i)}async playAnimation(c=!1,e){var i,s,a;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1),bn((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"))===null||s===void 0?void 0:s.transformControls,"enabled",!1);let h=0;e||(e=[],this.animations.forEach(({mixer:et,actions:nt,clips:it})=>{e.push(...nt)}));const d=Au();this._lastAnimId=d,this._animationState!=="paused"&&this.resetAnimation();for(const et of e)this.timeScale>0&&(et.timeScale=this.timeScale),et.setLoop(this.loopAnimations?b.YKA:b.jAl,this.loopRepetitions),et.play(),h=Math.max(h,et.getClip().duration/et.timeScale);if(this._animationState="playing",(a=this._viewer)===null||a===void 0||a.setDirty(),h*=this.loopAnimations?this.loopRepetitions:1,h/=this.animationSpeed,!isFinite(h))return;const _=1e3*h-this._animationTime/this.animationSpeed+.01;_>0&&await Dl(_),d===this._lastAnimId&&this.stopAnimation(c)}pauseAnimation(){var c,e,i;this._animationState="paused",bn((e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.transformControls,"enabled",!0),(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId=""}stopAnimation(c=!1){var e,i,s;this._animationState="stopped",bn((e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"),"enabled",!0),c?this.resetAnimation():(i=this._viewer)===null||i===void 0||i.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))===null||s===void 0||s.enable(rm.PluginType),this._fadeDisabled=!1)}resetAnimation(){var c;this._animationState==="stopped"?(this.animations.forEach(({mixer:e,actions:i,clips:s})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(c=this._viewer)===null||c===void 0||c.setDirty()):this.stopAnimation(!0)}};Go.PluginType="GLTFAnimation",Go.AnimationMarkersExtension="WEBGI_animation_markers",uu([a0()],Go.prototype,"animationState",null),uu([a0()],Go.prototype,"animationTime",null),uu([a0()],Go.prototype,"animationDuration",null),uu([pn(rm.prototype.onPropertyChange),ns("Loop",{limitedUi:!0})],Go.prototype,"loopAnimations",void 0),uu([pn(rm.prototype.onPropertyChange)],Go.prototype,"loopRepetitions",void 0),uu([pn(rm.prototype.onPropertyChange)],Go.prototype,"timeScale",void 0),uu([ns(),jn()],Go.prototype,"animateOnScroll",void 0),uu([ss("Speed",[.1,4],.1,{limitedUi:!0}),jn()],Go.prototype,"animationSpeed",void 0),uu([pn(rm.prototype.onStateChange)],Go.prototype,"_animationState",void 0),uu([ho("Play/Pause",c=>({label:()=>c.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Go.prototype,"playPauseAnimation",null),uu([ho("Stop",{limitedUi:!0})],Go.prototype,"stopAnimation",null),uu([ho("Reset",{limitedUi:!0})],Go.prototype,"resetAnimation",null),Go=rm=uu([Ys("GLTF Animations")],Go);class U0{constructor(e,i){this.parser=e,this.name=Go.AnimationMarkersExtension,this.plugin=i}async afterRoot(e){var i;let s=[];for(const dt of this.parser.json.scenes){if(!dt.extensions)continue;const pt=dt.extensions[this.name];for(const gt of(pt==null?void 0:pt.markers)||[]){const vt=gt.camera!==void 0?await this.parser.getDependency("camera",gt.camera):void 0;gt.time===void 0&&(gt.time=gt.frame/30,console.error("Update timeline markers plugin for correct times.")),s.push({name:gt.name,frame:gt.frame,time:gt.time,camera:vt})}}if(s.length<1)return;s=s.sort((dt,pt)=>dt.frame-pt.frame);const a=(i=e.scene)!==null&&i!==void 0?i:e.scenes[0];if(!a)return;a.userData.__markers=s;const h=this.plugin.timelineMarkers,d=s.map(dt=>dt.time);let _=h.length;const et=s.map(dt=>_++),nt=Math.max(...d)+.01;h.push(...s);const it=new b.dUE(".currentTimelineMarker",d,et,2300),lt=new b.m7l("animationTimelineMarker",nt,[it]);lt.__gltfExport=!1,e.animations.push(lt)}}const cx=c=>({afterParse(e){const i=c.json.scenes[c.json.scene||0];i.extensions=i.extensions||{};const s={markers:[]},a=[];if((Array.isArray(e)?e:[e]).forEach(h=>h.traverse(d=>{d.userData.__markers&&a.push(...d.userData.__markers)})),a.sort((h,d)=>h.frame-d.frame),!(a.length<1)){for(const h of a){const d=h.camera;if(d){const _=c.nodeMap.get(d);if(_===void 0){console.warn("Camera not found in gltf export",d,c.nodeMap);continue}const et=c.json.nodes[_].camera;h.camera=et,s.markers.push(h)}}i.extensions[Go.AnimationMarkersExtension]=s,c.extensionsUsed[Go.AnimationMarkersExtension]=!0}}});class cv extends st{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,i,s,a,h,d="postRender",_=!1){var et;this._generators.has(d)||this._generators.set(d,[]),(et=this._generators.get(d))===null||et===void 0||et.push({key:e,fn:i,rect:s?[...s]:void 0,frag:h||a||_?new b.jyz({vertexShader:yt.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:h??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${_?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${_?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${a??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,i="postRender"){var s,a;this._generators.set(i,(a=(s=this._generators.get(i))===null||s===void 0?void 0:s.filter(h=>h.key!==e))!==null&&a!==void 0?a:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var i;const s=this._viewer,a=s==null?void 0:s.renderer;a&&s&&((i=this._generators.get(e))===null||i===void 0||i.forEach(({key:h,fn:d,rect:_,frag:et})=>{const nt=d(s);if(nt){if(nt.image&&_){const it=nt.image.width/nt.image.height;_[2]<1&&_[3]<1&&(_[2]=200),_[2]<1&&(_[2]=_[3]*it),_[3]<1&&(_[3]=_[2]/it)}a.blit(nt,void 0,{viewport:_,clear:!1,material:et})}}))}}cv.PluginType="debug";var Yy=function(c,e){return Yy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,s){i.__proto__=s}||function(i,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(i[a]=s[a])},Yy(c,e)};function ux(c,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=c}Yy(c,e),c.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}var Xy,dE=function(){function c(){}return c._xfnv1a=function(e){for(var i=2166136261,s=0;s<e.length;s++)i=Math.imul(i^e.charCodeAt(s),16777619);return function(){return i+=i<<13,i^=i>>>7,i+=i<<3,i^=i>>>17,(i+=i<<5)>>>0}},c}(),UA=function(c){function e(i){var s=c.call(this)||this;return s.a=e._xfnv1a(i)(),s}return ux(e,c),e.prototype.next=function(){var i=this.a+=1831565813;return i=Math.imul(i^i>>>15,1|i),(((i^=i+Math.imul(i^i>>>7,61|i))^i>>>14)>>>0)/4294967296},e}(dE),RT=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return ux(e,c),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var i=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,i=i+this.d|0,this.c=this.c+i|0,(i>>>0)/4294967296},e}(dE),N_=function(c){function e(i){var s=c.call(this)||this,a=e._xfnv1a(i);return s.a=a(),s.b=a(),s.c=a(),s.d=a(),s}return ux(e,c),e.prototype.next=function(){var i=this.b<<9,s=5*this.a;return s=s<<7|9*(s>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=i,this.d=this.d<<11|this.d>>>21,(s>>>0)/4294967296},e}(dE);(function(c){c.sfc32="sfc32",c.mulberry32="mulberry32",c.xoshiro128ss="xoshiro128ss"})(Xy||(Xy={}));var hx=function(){function c(e,i){i===void 0&&(i=Xy.sfc32),this.str=e,this.prng=i,this.generator=this._initializeGenerator()}return c.prototype.next=function(){return this.generator.next()},c.prototype._initializeGenerator=function(){if(function(i){return i===null}(e=this.str)||function(i){return i===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new RT(this.str);case"mulberry32":return new UA(this.str);case"xoshiro128ss":return new N_(this.str);default:return this.wrap()}},c.prototype.wrap=function(){return{next:function(){return Math.random()}}},c}(),BT=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class dx extends Vv{constructor(e,i,s,a){super(e,i),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new b.Pa4(10,10,10),normalDirection:new b.Pa4(.01,.98,.01).normalize(),direction:new b.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=s??{},this.randomParams=a??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(i=>e[i]===void 0&&delete e[i]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,i=null,s=null){const a=new hx(e.toString()),h=new b.FM8(a.next()*Math.PI*2,Math.asin(2*a.next()-1));let d=new b.Pa4(Math.cos(h.x)*Math.cos(h.y),Math.sin(h.y),Math.sin(h.x)*Math.cos(h.y));const _=new b.FM8;for(let et=0;et<5;et++){_.set(a.next(),a.next()),d=kT(_,this._randomParams.normalDirection,.4),a.next()<Math.sqrt(i??this._randomParams.focus)&&(_.set(a.next(),a.next()),d=kT(_,this._randomParams.direction,Math.pow((s??this._randomParams.spread)/2,2)));const nt=d.dot(this._randomParams.normalDirection);if(nt>0&&nt<.4)break}d.normalize(),d.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(d.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new b.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,i){return super.fromJSON(e,i)?(this.updateShadowParams(),this):null}}function kT(c,e,i){e=e.clone().normalize();const s=new b.Pa4(0,-e.z,e.y).normalize(),a=new b.Pa4().crossVectors(e,s).normalize(),h=c;h.x=2*h.x*Math.PI,h.y=1-h.y*i;const d=Math.sqrt(1-h.y*h.y);return s.multiplyScalar(Math.cos(h.x)*d).add(a.multiplyScalar(Math.sin(h.x)*d)).add(e.multiplyScalar(h.y))}BT([jn("shadowParams")],dx.prototype,"_shadowParams",void 0),BT([jn("randomParams")],dx.prototype,"_randomParams",void 0);class AC extends b.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,i){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",Qt`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,i)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,i){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([rn({propKey:"tLastThis"})],AC.prototype,"lastFrameTexture",void 0);var px=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class uv{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(s,a,h)=>{this.groundMapMode==="aoMap"?s.fragmentShader=Jo(s.fragmentShader,"#include <aomap_fragment>",Jo(b.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?s.fragmentShader=Jo(s.fragmentShader,"#include <map_fragment>",Jo(b.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(s.fragmentShader=Jo(s.fragmentShader,"#include <alphamap_fragment>",Jo(b.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&h.capabilities.isWebGL2&&(s.fragmentShader=Jo(s.fragmentShader,"#include <output_fragment>",Qt`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(s,a)=>{a.materialObject.userData.gMapMode!==this.groundMapMode&&(a.materialObject.userData.gMapMode=this.groundMapMode,a.materialObject.needsUpdate=!0)},isCompatible:s=>s.isMeshStandardMaterial2},this._viewer=e;const i=new dx(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new b.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new b.Pa4(10,10,10),normalDirection:new b.Pa4(0,1,0)});i.shadow.camera.updateProjectionMatrix(),i.layers.disableAll(),i.layers.set(this._lightLayer),this._light=i,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new AC({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:b.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,i,s;(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e),(s=this._viewer)===null||s===void 0||s.setDirty()}fromJSON(e,i){return eo(e,this,!0,i),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const i=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:b.ywz,depthBuffer:!1,size:new b.FM8(i,i),sizeMultiplier:void 0,encoding:b.rnI,format:b.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const s=this._viewer.renderer.rendererObject,a=s.shadowMap,h=a.type,d=a.needsUpdate,_=a.autoUpdate;a.type=b._MY,a.needsUpdate=!0,a.autoUpdate=!1;const et=this._viewer.scene,nt=new b.S9g;nt.disableAll(),et.modelObject.traverse(gt=>{gt.isLight&&gt!==this._light.lightObject&&(gt.userData.__gp_layers=gt.layers,gt.layers=nt)});const it=et.activeCamera.cameraObject;if(it.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";it.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),jr(s,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(et)),it.layers.disable(this._lightLayer);const lt=it.layers.mask;it.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const dt=this._viewer.renderer.getTempTarget({type:b.ywz,depthBuffer:!1,size:new b.FM8(i,i),encoding:b.rnI,format:b.wk1}),pt=dt.texture.encoding;dt.texture.encoding=b.rnI,this._viewer.renderer.blit(this._target.texture,dt,{clear:!0});{const gt=et.modelObject.environment,vt=et.modelObject.background,Ct=e.material,wt=e.frustumCulled,xt=s.getRenderTarget(),_t=s.getActiveCubeFace(),Pt=s.getActiveMipmapLevel();et.modelObject.background=null,et.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,s.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=dt.texture,this._shadowMat.needsUpdate=!0,jr(s,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(et)),s.setRenderTarget(xt,_t,Pt),e.frustumCulled=wt,e.material=Ct,et.modelObject.environment=gt,et.modelObject.background=vt}return dt.texture.encoding=pt,this._viewer.renderer.releaseTempTarget(dt),e.layers.disable(this._lightLayer),it.layers.mask=lt,et.modelObject.traverse(gt=>{gt.isLight&&gt!==this._light.lightObject&&(gt.layers=gt.userData.__gp_layers,delete gt.userData.__gp_layers)}),a.type=h,a.needsUpdate=d,a.autoUpdate=_,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var i,s,a;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((i=this._target)===null||i===void 0?void 0:i.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((s=this._target)===null||s===void 0?void 0:s.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((a=this._target)===null||a===void 0?void 0:a.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}px([jn("randomizedLight")],uv.prototype,"_light",void 0),px([pn(uv.prototype.reset),jn()],uv.prototype,"maxFrameNumber",void 0),px([pn(uv.prototype._groundMapModeChanged),jn()],uv.prototype,"groundMapMode",void 0),px([jn(),pn(uv.prototype._alphaVignetteChanged)],uv.prototype,"alphaVignette",void 0),px([jn(),pn(uv.prototype._alphaVignetteChanged)],uv.prototype,"alphaVignetteAxis",void 0);var LT="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",pE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class FA extends b.Kj0{constructor(e,i,s=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new b.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(Ct,wt,xt)=>{if(this.enabled){Ct.vertexShader=Ct.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const _t="#glMarker beforeModulation";Ct.fragmentShader=Ct.fragmentShader.replace(_t,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+_t),Ct.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?LT+`
`+sv+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:Ct=>this.enabled+" "+Ct.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(Ct,{materialObject:wt})=>{wt.userData.__lastTransparent!==wt.transparent&&(wt.needsUpdate=!0,wt.userData.__lastTransparent=wt.transparent)},isCompatible:Ct=>Ct.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=i;const a=new b.JOQ,h=new b.Pa4,d=new b.Pa4,_=new b.Pa4,et=new b.yGw,nt=new b.Pa4(0,0,-1),it=new b.Ltg,lt=new b.Pa4,dt=new b.Pa4,pt=new b.Ltg,gt=new b.yGw,vt=new b.cPb;b.M8C.isPowerOfTwo(i.texture.image.width)&&b.M8C.isPowerOfTwo(i.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(Ct,wt,xt)=>{if(!this.enabled||!Ct.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const _t=xt.view?Object.assign({},xt.view):null;if(_t&&xt.clearViewOffset&&xt.clearViewOffset(),d.setFromMatrixPosition(this.matrixWorld),_.setFromMatrixPosition(xt.matrixWorld),et.extractRotation(this.matrixWorld),h.set(0,0,1),h.applyMatrix4(et),lt.subVectors(d,_),lt.dot(h)>0)return;lt.reflect(h).negate(),lt.add(d),et.extractRotation(xt.matrixWorld),nt.set(0,0,-1),nt.applyMatrix4(et),nt.add(_),dt.subVectors(d,nt),dt.reflect(h).negate(),dt.add(d),vt.position.copy(lt),vt.up.set(0,1,0),vt.up.applyMatrix4(et),vt.up.reflect(h),vt.lookAt(dt),vt.far=2,vt.near=0,vt.updateMatrixWorld(),vt.projectionMatrix.copy(xt.projectionMatrix),gt.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),gt.multiply(vt.projectionMatrix),gt.multiply(vt.matrixWorldInverse),gt.multiply(this.matrixWorld),a.setFromNormalAndCoplanarPoint(h,d),a.applyMatrix4(vt.matrixWorldInverse),it.set(a.normal.x,a.normal.y,a.normal.z,a.constant);const Pt=vt.projectionMatrix;pt.x=(Math.sign(it.x)+Pt.elements[8])/Pt.elements[0],pt.y=(Math.sign(it.y)+Pt.elements[9])/Pt.elements[5],pt.z=-1,pt.w=(1+Pt.elements[10])/Pt.elements[14],it.multiplyScalar(2/it.dot(pt)),Pt.elements[2]=it.x,Pt.elements[6]=it.y,Pt.elements[10]=it.z+1-s,Pt.elements[14]=it.w,this.visible=!1;const Rt=Ct.getRenderTarget(),Lt=Ct.xr.enabled,Ot=Ct.shadowMap.autoUpdate;Ct.xr.enabled=!1,Ct.shadowMap.autoUpdate=!1,Ct.setRenderTarget(this._renderTarget),Ct.state.buffers.depth.setMask(!0),Ct.autoClear===!1&&Ct.clear();const qt=wt.background;this.transparentReflectionBackground&&(wt.background=null);const en=!this.transparentReflectionBackground;qt&&en&&(qt.userData.flipX=!qt.userData.flipX),jr(Ct,{shadowMapRender:!1,backgroundRender:en,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>Ct.render(wt,vt)),qt&&en&&(qt.userData.flipX=!qt.userData.flipX||void 0),this.transparentReflectionBackground&&(wt.background=qt),Ct.xr.enabled=Lt,Ct.shadowMap.autoUpdate=Ot,Ct.setRenderTarget(Rt),_t!=null&&_t.enabled&&xt.setViewOffset&&xt.setViewOffset(_t.fullWidth,_t.fullHeight,_t.offsetX,_t.offsetY,_t.width,_t.height);const cn=xt.viewport;cn!==void 0&&Ct.state.viewport(cn),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=gt,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new b.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=gt}_updateExtension(){var e,i;this.transparentReflectionBackground=this.reflectorModePhysical,(i=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||i===void 0||i.call(e)}getRenderTarget(){return this._renderTarget}}pE([pn(FA.prototype._updateExtension)],FA.prototype,"enabled",void 0),pE([pn(FA.prototype._updateExtension)],FA.prototype,"reflectorModePhysical",void 0),FA.prototype.isReflector=!0;var Mm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class _d extends Ns{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[Yr],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new b._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new b.Kj0(this._geometry)}async onAdded(e){var i,s;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(Yr);const a=this._createMesh();a.userData.physicsMass=0,this._iMesh=await((i=this._manager)===null||i===void 0?void 0:i.addImportedSingle(a,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(s=this._iMesh)===null||s===void 0?void 0:s.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var i,s;return this._geometry.dispose(),(s=(i=this._iMesh)===null||i===void 0?void 0:i.dispose)===null||s===void 0||s.call(i),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,i;this._material&&((i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;i&&(i.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=i.maxPolarAngle),i.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(i.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,i,s;if(!this._mesh||!this._viewer)return;let a=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,a=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const h=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const d=h.getCenter(new b.Pa4).sub(new b.Pa4(0,h.getSize(new b.Pa4).y/2+this.yOffset,0));a=a||d.clone().sub(this._mesh.position).length()>1e-4,a&&this._mesh.position.copy(d)}a=a||Math.abs(this._mesh.scale.x-this.size)>1e-4,a&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new b.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(s=(i=this._mesh).setDirty)===null||s===void 0||s.call(i)),this._transformNeedRefresh=!1}else a&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,i,s,a,h,d,_,et;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const nt=(i=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||i===void 0?void 0:i.findOrCreate((a=(s=this._material)===null||s===void 0?void 0:s.uuid)!==null&&a!==void 0?a:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let it=!1;return(nt==null?void 0:nt.uuid)!==((h=this._material)===null||h===void 0?void 0:h.uuid)&&(this._removeMaterial(),nt&&(this._material=nt),!((d=this._material)===null||d===void 0)&&d.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((et=(_=this._mesh)===null||_===void 0?void 0:_.setMaterial)!==null&&et!==void 0?et:lt=>{this._mesh&&(this._mesh.material=lt.materialObject)})(this._material)),it=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),it}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,i){return super.fromJSON(e,i)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}Mm([jn("material")],_d.prototype,"_material",void 0),Mm([pn(_d.prototype.refreshTransform),jn()],_d.prototype,"visible",void 0),Mm([pn(_d.prototype._onSceneUpdate),jn()],_d.prototype,"size",void 0),Mm([pn(_d.prototype._onSceneUpdate),jn()],_d.prototype,"yOffset",void 0),Mm([pn(_d.prototype._refreshOptions2),jn()],_d.prototype,"renderToDepth",void 0),Mm([pn(_d.prototype._refreshOptions2),jn()],_d.prototype,"tonemapGround",void 0),Mm([pn(_d.prototype._refreshCameraLimits),jn()],_d.prototype,"limitCameraAboveGround",void 0);var ga=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class zp extends _d{constructor(e={},i=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=i,i&&this.dependencies.push(cv),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new FA(this._geometry,this._viewer.renderer.createTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:b.D1R,magFilter:b.wem})),i=e.onBeforeRender;return e.onBeforeRender=(...s)=>{var a,h,d,_,et;let nt=(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSReflection"))===null||h===void 0?void 0:h.passes.ssr.passObject;nt&&!nt.enabled&&(nt=void 0),nt&&(nt.enabled=!1);let it=(et=(_=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSBevelPlugin"))===null||_===void 0?void 0:_.pass)===null||et===void 0?void 0:et.passObject;it&&!it.enabled&&(it=void 0),it&&(it.enabled=!1),i(...s),nt&&(nt.enabled=!0),it&&(it.enabled=!0)},e}async onAdded(e){var i,s;await super.onAdded(e),this._showDebug&&((i=e.getPlugin(cv))===null||i===void 0||i.addTexture("bake_ground_1",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.light.shadow.map)===null||h===void 0?void 0:h.texture},[100,100,200,200]),(s=e.getPlugin(cv))===null||s===void 0||s.addTexture("bake_ground_2",()=>{var a,h;return(h=(a=this._shadowBaker)===null||a===void 0?void 0:a.target)===null||h===void 0?void 0:h.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,i,s,a;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((i=(e=this._material).unregisterMaterialExtensions)===null||i===void 0||i.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const h=this._mesh.materialExtension;h||console.warn("unable to find the extension to unregister"),(a=(s=this._material).unregisterMaterialExtensions)===null||a===void 0||a.call(s,[h]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var i;super._onSceneUpdate(e),e.geometryChanged!==!1&&((i=this._shadowBaker)===null||i===void 0||i.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new uv(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,i,s,a;if(!this._viewer)return!1;const h=super._refreshMaterial();if(!this._material)return h;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const d=this._mesh.materialExtension;d.updaters=[this._viewer.scene,this._viewer.renderer],(i=(e=this._material).registerMaterialExtensions)===null||i===void 0||i.call(e,[d]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((a=(s=this._material).registerMaterialExtensions)===null||a===void 0||a.call(s,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),h}_extraUiConfig(){var e,i,s,a,h,d,_,et,nt,it,lt,dt,pt,gt,vt,Ct,wt,xt,_t,Pt,Rt,Lt,Ot,qt,en,cn,An,fn,Tn,gn;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var xn,Nn;return(Nn=(xn=this._uiConfig)===null||xn===void 0?void 0:xn.uiRefresh)===null||Nn===void 0?void 0:Nn.call(xn,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var xn;return!(!((xn=this._shadowBaker)===null||xn===void 0)&&xn.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(xn=>({label:xn,value:xn})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(i=this._shadowBaker)===null||i===void 0?void 0:i.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(a=(s=this._shadowBaker)===null||s===void 0?void 0:s.light)===null||a===void 0?void 0:a.shadowParams,"enabled"],onChange:[(d=(h=this._shadowBaker)===null||h===void 0?void 0:h.light)===null||d===void 0?void 0:d.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(et=(_=this._shadowBaker)===null||_===void 0?void 0:_.light)===null||et===void 0?void 0:et.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(it=(nt=this._shadowBaker)===null||nt===void 0?void 0:nt.light)===null||it===void 0?void 0:it.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(dt=(lt=this._shadowBaker)===null||lt===void 0?void 0:lt.light)===null||dt===void 0?void 0:dt.randomParams,"distanceScale"],onChange:[(gt=(pt=this._shadowBaker)===null||pt===void 0?void 0:pt.light)===null||gt===void 0?void 0:gt.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(Ct=(vt=this._shadowBaker)===null||vt===void 0?void 0:vt.light)===null||Ct===void 0?void 0:Ct.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(xt=(wt=this._shadowBaker)===null||wt===void 0?void 0:wt.light)===null||xt===void 0?void 0:xt.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(Pt=(_t=this._shadowBaker)===null||_t===void 0?void 0:_t.light)===null||Pt===void 0?void 0:Pt.shadowParams,"radius"],onChange:[(Lt=(Rt=this._shadowBaker)===null||Rt===void 0?void 0:Rt.light)===null||Lt===void 0?void 0:Lt.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(qt=(Ot=this._shadowBaker)===null||Ot===void 0?void 0:Ot.light)===null||qt===void 0?void 0:qt.shadowParams,"frustumSize"],onChange:[(cn=(en=this._shadowBaker)===null||en===void 0?void 0:en.light)===null||cn===void 0?void 0:cn.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(fn=(An=this._shadowBaker)===null||An===void 0?void 0:An.light)===null||fn===void 0?void 0:fn.shadowParams,"bias"],onChange:[(gn=(Tn=this._shadowBaker)===null||Tn===void 0?void 0:Tn.light)===null||gn===void 0?void 0:gn.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}zp.PluginType="Ground",ga([pn(zp.prototype.refreshOptions),jn()],zp.prototype,"bakedShadows",void 0),ga([pn(zp.prototype.refreshOptions),jn()],zp.prototype,"groundReflection",void 0),ga([pn(zp.prototype.refreshOptions),jn()],zp.prototype,"physicalReflections",void 0),ga([jn("shadowBaker")],zp.prototype,"_shadowBaker",void 0);var U_,Tm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Vp=U_=class extends Wl{constructor(){super({vertexShader:yt.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new b.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Pv+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new b.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(c,e,i,s,a){const h=c.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const d=i;let _=.5,et=d.width*_,nt=d.height*_;const it=[];let lt=h.getTempTarget({sizeMultiplier:.5,type:b.cLu});it.push(lt);let dt=d;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(c,lt,dt,s,a),dt=lt;let pt=1;for(;pt<this.bloomIterations&&(et/=2,nt/=2,_/=2,!(nt<2||et<2));pt++){lt=h.getTempTarget({sizeMultiplier:_,type:b.cLu}),it.push(lt),this.material.defines.PASS_STEP=1;let vt=this._weights[pt];vt=this._weights[pt-1]!==0?this._weights[pt]/this._weights[pt-1]:this._weights[pt],this.material.uniforms.weight.value=vt,this.material.needsUpdate=!0,super.render(c,lt,dt,s,a),dt=lt}this.clear=!1;const gt=c.autoClear;for(c.autoClear=!1,pt-=2;pt>=0;pt--)lt=it[pt],it[pt]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=b.WMw,this.material.needsUpdate=!0,c.autoClear=!1,super.render(c,lt,dt,s,a),this.material.blending=b.jFi,h.releaseTempTarget(dt),dt=lt;this.clear=!0,c.autoClear=gt,c.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(c,e,dt,s,a)):(this.uniforms.tSource.value=d.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(c,e,dt,s,a),this.uniforms.tSource.value=null),h.releaseTempTarget(dt)}_updateWeights(){if(!this._weights)return;const c=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let i=0;i<this.bloomIterations;i++){let s=i*e+.1,a=1.2-s;s=Math.pow(s,this.power),a=Math.pow(a,this.power),this._weights[i]=a*(1-c)+s*c}this.setDirty()}};Tm([rn()],Vp.prototype,"prefilter",void 0),Tm([ss("Threshold",[0,2]),pn(U_.prototype._thresholdsUpdated),jn()],Vp.prototype,"threshold",void 0),Tm([ss("Soft Threshold",[0,1]),pn(U_.prototype._thresholdsUpdated),jn()],Vp.prototype,"softThreshold",void 0),Tm([ss("Intensity",[0,3]),jn(),rn()],Vp.prototype,"intensity",void 0),Tm([ss("Iterations",[0,7],1),pn(U_.prototype._updateWeights),jn()],Vp.prototype,"bloomIterations",void 0),Tm([ss("Radius",[0,1],.01),pn(U_.prototype._updateWeights),jn()],Vp.prototype,"radius",void 0),Tm([ss("Power",[.2,10],.01),pn(U_.prototype._updateWeights),jn()],Vp.prototype,"power",void 0),Tm([ns("Debug")],Vp.prototype,"bloomDebug",void 0),Vp=U_=Tm([Ys("Bloom")],Vp);class F_ extends nv{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new Vp}_update(e){var i,s;return(i=e.getPlugin(Bo))===null||i===void 0||i.updateShaderProperties((s=this.pass)===null||s===void 0?void 0:s.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}F_.PluginType="Bloom";var fE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Qp=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const a=(s=e.materialObject.userData)===null||s===void 0?void 0:s._anisotropyDirectionMap,h=Qt`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${sv}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(a?$n("anisotropyDirectionMap",a,i.capabilities.isWebGL2):"");c.fragmentShader=c.fragmentShader.replace("#include <bsdfs>",h),c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_begin>",b.WdD.lights_fragment_begin),c.fragmentShader=c.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const d=b.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");c.fragmentShader=c.fragmentShader.replace("#include <lights_physical_pars_fragment>",d);const _=Qt`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+b.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");c.fragmentShader=c.fragmentShader.replace("#include <lights_fragment_maps>",_),c.vertexUvs=!0,c.vertexTangents=!0},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._isAnisotropic))return;const a=c;if(!a.isMesh||!a.geometry)return;if(!a.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=s._anisotropyFactor,this._uniforms.anisotropyNoise.value=s._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((i=s._anisotropyDirectionMap)===null||i===void 0)&&i.isTexture?s._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=s._anisotropyDirection;let h=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==h&&(e.materialObject.defines.ANISOTROPY_ENABLED=h,e.materialObject.needsUpdate=!0),h=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==h&&(e.materialObject.defines.ANISOTROPY_DEBUG=h,e.materialObject.needsUpdate=!0),h=s._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(h="CONSTANT"),h=h==="DIRECTION"?2:h==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==h&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=h,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._anisotropyDirectionMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>{var c;return[(c=this._viewer)===null||c===void 0?void 0:c.renderer]},getUiConfig:c=>{const e=this._viewer,i=this.makeAnisotropic,s={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._isAnisotropic||!1},set value(a){var h;a!==c.materialObject.userData._isAnisotropic&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._isAnisotropic=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!c.materialObject.userData._isAnisotropic,property:[c.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(a=>({label:a})),onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}}]};return s}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this.makeSelectedAnisotropic=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(mo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.makeAnisotropic(s)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(c){var e;const i=(e=c.materialObject)===null||e===void 0?void 0:e.userData;if(!i)return!1;if(i._isAnisotropic===void 0){const s=i.__appliedMeshes;let a=!0;if(s)for(const{geometry:h}of s)!h||h.index&&h.attributes.position&&h.attributes.normal&&h.attributes.uv||(a=!1),a&&!h.attributes.tangent&&h.computeTangents();if(!a)return!1}return i._isAnisotropic=!0,i._anisotropyFactor===void 0&&(i._anisotropyFactor=1),i._anisotropyNoise===void 0&&(i._anisotropyNoise=0),i._anisotropyDirectionMode===void 0&&(i._anisotropyDirectionMode="DIRECTION"),c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new fx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Yr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(yC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};Qp.PluginType="AnisotropyPlugin",Qp.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",fE([ns("Enabled",c=>({onChange:c.setDirty})),jn()],Qp.prototype,"enabled",void 0),fE([ho("Make Anisotropy",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(mo))}}))],Qp.prototype,"makeSelectedAnisotropic",void 0),Qp=fE([Ys("Anisotropy Materials")],Qp);class fx{constructor(e){this.parser=e,this.name=Qp.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,i){var s,a,h;const d=this.parser,_=d.json.materials[e];if(!_.extensions||!_.extensions[this.name])return Promise.resolve();const et=[],nt=_.extensions[this.name];i.userData||(i.userData={}),i.userData._isAnisotropic=!0,i.userData._anisotropyFactor=(s=nt.anisotropyFactor)!==null&&s!==void 0?s:0,i.userData._anisotropyNoise=(h=(a=nt.anisotropyNoiseFactor)!==null&&a!==void 0?a:nt.anisotropyNoise)!==null&&h!==void 0?h:0;let{anisotropyDirectionMode:it,anisotropyDirection:lt}=nt;return it||(it=nt.anisotropyTextureMode),lt||(lt=nt.anisotropyRotation),i.userData._anisotropyDirectionMode=it&&typeof(lt==null?void 0:lt.index)=="number"?it:"CONSTANT",it==="ROTATION"||it==="DIRECTION"?et.push(d.assignTexture(i.userData,"_anisotropyDirectionMap",lt).then(dt=>{dt.encoding=b.knz})):i.userData._anisotropyDirection=lt??0,Promise.all(et)}afterRoot(e){return e.scene.traverse(i=>{var s,a;if(!(!((a=(s=i.material)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a._isAnisotropic))return;const h=i.geometry;h.attributes.tangent||(h.computeTangents(),h.attributes.tangent.needsUpdate=!0)}),null}}const yC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.anisotropyFactor=e.userData._anisotropyFactor||1,s.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,s.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&s.anisotropyDirectionMode!=="CONSTANT"){const a={index:c.processTexture(e.userData._anisotropyDirectionMap)};c.applyTextureTransform(a,e.userData._anisotropyDirectionMap),s.anisotropyDirection=a}else s.anisotropyDirectionMode="CONSTANT",s.anisotropyDirection=e.userData._anisotropyDirection||0;i.extensions[Qp.ANISOTROPY_GLTF_EXTENSION]=s,c.extensionsUsed[Qp.ANISOTROPY_GLTF_EXTENSION]=!0}});var hv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let sm=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new b.Ltg},thinNoiseLayerFactors:{value:new b.Ltg},thinColorNoiseParams:{value:new b.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm)?sv+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._thinFilmLayer;if(!(s!=null&&s.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(s.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(s.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(s.colorNoiseParams),this._uniforms.thinFilmFactor.value=s.filmFactor;const a=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==a&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||i===void 0)&&i.hasThinFilm?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0?void 0:s.hasThinFilm)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._thinFilmLayer)===null||a===void 0?void 0:a.hasThinFilm)&&(s?mE(c.materialObject)||e.alert("Cannot add thin film."):(c.materialObject.userData._thinFilmLayer.hasThinFilm=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._thinFilmLayer)===null||s===void 0)&&s.hasThinFilm)},property:[c.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(c){return mE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new mx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Yr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(mD)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function mE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const i=e._thinFilmLayer;return i.hasThinFilm=!0,i.baseLayerFactors===void 0&&(i.baseLayerFactors=[.3,.6,1,.9]),i.noiseLayerFactors===void 0&&(i.noiseLayerFactors=[.7,.5,.9,.7]),i.colorNoiseParams===void 0&&(i.colorNoiseParams=[.5,.5,.5,.7]),i.filmFactor===void 0&&(i.filmFactor=.3),c.isMaterial&&(c.needsUpdate=!0),!0}sm.PluginType="ThinFilmLayerPlugin",sm.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",hv([ns("Enabled",c=>({onChange:c.setDirty})),jn()],sm.prototype,"enabled",void 0),sm=hv([Ys("ThinFilmLayer Materials")],sm);class mx{constructor(e){this.parser=e,this.name=sm.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),mE(i),i.userData._thinFilmLayer=eo(a,i.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const mD=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;i.extensions=i.extensions||{};const s=so(e.userData._thinFilmLayer,!1);i.extensions[sm.THIN_FILM_LAYER_GLTF_EXTENSION]=s,c.extensionsUsed[sm.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var Ky=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Uu=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this._defines={},this._uniforms={noiseBumpParams:{value:new b.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||i===void 0)&&i.hasBump)?sv+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(c,e,i)=>{var s;if(!this.enabled||!(!((s=e.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump))return;const a="#glMarker beforeAccumulation";c.fragmentShader=c.fragmentShader.replace(a,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+a),c.vertexUvs=!0,c.extensionDerivatives=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._noiseBumpMat;if(!(s!=null&&s.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(s.bumpNoiseParams),this._uniforms.noiseBumpScale.value=s.bumpScale,this._uniforms.noiseBumpFlakeScale.value=s.flakeScale,this._uniforms.noiseFlakeClamp.value=s.flakeClamp,this._uniforms.noiseFlakeRadius.value=s.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=s.flakeRoughnessMod;const a=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==a&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||i===void 0)&&i.hasBump?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0?void 0:s.hasBump)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._noiseBumpMat)===null||a===void 0?void 0:a.hasBump)&&(s?jA(c.materialObject)||e.alert("Cannot add noise bump."):(c.materialObject.userData._noiseBumpMat.hasBump=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var s;return!(!((s=c.materialObject.userData._noiseBumpMat)===null||s===void 0)&&s.hasBump)},property:[c.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(c){return jA(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new gx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Yr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(Jy)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function jA(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const i=e._noiseBumpMat;return i.hasBump=!0,i.bumpNoiseParams===void 0&&(i.bumpNoiseParams=[.5,.5]),i.bumpScale===void 0&&(i.bumpScale=.05),i.flakeScale===void 0&&(i.flakeScale=.05),i.flakeClamp===void 0&&(i.flakeClamp=1),i.flakeRadius===void 0&&(i.flakeRadius=.3),i.flakeRoughnessMod===void 0&&(i.flakeRoughnessMod=1),c.isMaterial&&(c.needsUpdate=!0),!0}Uu.PluginType="NoiseBumpMaterialPlugin",Uu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",Ky([ns("Enabled",c=>({onChange:c.setDirty})),jn()],Uu.prototype,"enabled",void 0),Uu=Ky([Ys("NoiseBumpMaterial Materials")],Uu);class gx{constructor(e){this.parser=e,this.name=Uu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),jA(i),i.userData._noiseBumpMat=eo(a,i.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const Jy=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;i.extensions=i.extensions||{};const s=so(e.userData._noiseBumpMat,!1);i.extensions[Uu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=s,c.extensionsUsed[Uu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var zA,j_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Mu=zA=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new b.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(c,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(c,e,i)=>{var s;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((s=e.materialObject.userData)===null||s===void 0)&&s._customBumpMap)&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),c.vertexShader=Jo(c.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),c.vertexShader=Jo(c.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),c.vertexUvs=!0)},onObjectRender:(c,e)=>{var i;const s=e.materialObject.userData;if(!(s!=null&&s._hasCustomBump))return;const a=c;if(!a.isMesh||!a.geometry)return;const h=!((i=s._customBumpMap)===null||i===void 0)&&i.isTexture?s._customBumpMap:null;this._uniforms.customBumpMap.value=h,this._uniforms.customBumpScale.value=h?s._customBumpScale:0,h&&(h.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(h.matrix));let d=this.enabled&&h?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=d,e.materialObject.needsUpdate=!0),d=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==d&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=d,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i,s;return(this.enabled?"1":"0")+(!((e=c.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((s=(i=c.materialObject.userData)===null||i===void 0?void 0:i._customBumpMap)===null||s===void 0?void 0:s.uuid)},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i=this.enableCustomBump,s={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return c.materialObject.userData._hasCustomBump||!1},set value(a){var h;a!==c.materialObject.userData._hasCustomBump&&(a?i(c)||e.alert("One or more geometries cannot be made anisotropic."):(c.materialObject.userData._hasCustomBump=!1,c.materialObject.needsUpdate=!0),(h=s.uiRefresh)===null||h===void 0||h.call(s,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!c.materialObject.userData._hasCustomBump,property:[c.materialObject.userData,"_customBumpMap"],onChange:()=>{c.materialObject.needsUpdate=!0,this.setDirty()}},Qo(c.materialObject.userData,"_customBumpMap")]};return s}},this.setDirty=()=>{var c,e,i;(e=(c=this.materialExtension).setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()},this.enableCustomBumpSelected=()=>{var c,e,i;const s=(i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(mo))===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material;return(s==null?void 0:s.assetType)==="material"&&this.enableCustomBump(s)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(c,e,i){var s,a;const h=(s=c.materialObject)===null||s===void 0?void 0:s.userData;if(!h)return!1;if(h._hasCustomBump===void 0){const d=h.__appliedMeshes;let _=!0;if(d)for(const{geometry:et}of d)!et||et.attributes.position&&et.attributes.normal&&et.attributes.uv||(_=!1);if(!_)return!1}return h._hasCustomBump=!0,h._customBumpScale=(a=i??h._customBumpScale)!==null&&a!==void 0?a:.001,h._customBumpMap=e??h._customBumpMap,c.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new vx(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Yr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(OT)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};Mu.PluginType="CustomBumpMapPlugin",Mu.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",j_([ns("Enabled",c=>({onChange:c.setDirty})),jn()],Mu.prototype,"enabled",void 0),j_([ns("Bicubic",c=>({onChange:c.setDirty})),Fn("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,zA.prototype.setDirty),jn()],Mu.prototype,"bicubicFiltering",void 0),j_([ho("Enable CustomBumpMap",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPlugin(mo))}}))],Mu.prototype,"enableCustomBumpSelected",void 0),Mu=zA=j_([Ys("CustomBumpMap Materials")],Mu);class vx{constructor(e){this.parser=e,this.name=Mu.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,i){var s;const a=this.parser,h=a.json.materials[e];if(!h.extensions||!h.extensions[this.name])return Promise.resolve();const d=[],_=h.extensions[this.name];i.userData||(i.userData={}),i.userData._hasCustomBump=!0,i.userData._customBumpScale=(s=_.customBumpScale)!==null&&s!==void 0?s:0;const et=_.customBumpMap;return et&&d.push(a.assignTexture(i.userData,"_customBumpMap",et).then(nt=>{nt.encoding=b.knz})),Promise.all(d)}}const OT=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;i.extensions=i.extensions||{};const s={};if(s.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const a={index:c.processTexture(e.userData._customBumpMap)};c.applyTextureTransform(a,e.userData._customBumpMap),s.customBumpMap=a}i.extensions[Mu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=s,c.extensionsUsed[Mu.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var wC=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Im=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this._defines={},this._uniforms={ccTintColor:{value:new vo},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(c,e)=>{var i;return this.enabled&&(!((i=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||i===void 0)&&i.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(c,e,i)=>{var s;if(!(this.enabled&&(!((s=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)&&e.materialObject.clearcoat>0))return;const a="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",h="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";c.fragmentShader.includes(h)&&c.fragmentShader.includes(a)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),c.fragmentShader=c.fragmentShader.replace(h,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),c.fragmentShader=c.fragmentShader.replace(a,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+a),c.vertexUvs=!0},onObjectRender:(c,e)=>{var i;const s=(i=e.materialObject.userData)===null||i===void 0?void 0:i._clearcoatTint;if(!(s!=null&&s.enableTint))return;this._uniforms.ccTintColor.value.set(s.tintColor),this._uniforms.ccThickness.value=s.thickness,this._uniforms.ccIor.value=s.ior;const a=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==a&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:c=>{var e,i;return(this.enabled?"1":"0")+(!((i=(e=c.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||i===void 0)&&i.enableTint?"1":"0")+(c.materialObject.clearcoat>0?"1":"0")},isCompatible:c=>c.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:c=>{const e=this._viewer,i={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var s;return((s=c.materialObject.userData._clearcoatTint)===null||s===void 0?void 0:s.enableTint)||!1},set value(s){var a,h;s!==((a=c.materialObject.userData._clearcoatTint)===null||a===void 0?void 0:a.enableTint)&&(s?gE(c.materialObject)||e.alert("Cannot add clearcoat tint."):(c.materialObject.userData._clearcoatTint.enableTint=!1,c.materialObject.needsUpdate=!0),(h=i.uiRefresh)===null||h===void 0||h.call(i,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var s;return!(!((s=c.materialObject.userData._clearcoatTint)===null||s===void 0)&&s.enableTint)},property:[c.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return i}},this.setDirty=()=>{var c;(c=this._viewer)===null||c===void 0||c.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(c){return gE(c.materialObject)}_loaderCreate({loader:c}){c.isGLTFLoader2&&c.register(e=>new NT(e))}async onAdded(c){var e,i,s,a,h;await super.onAdded(c);const d=c.getPlugin(Yr);(e=d==null?void 0:d.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(i=d==null?void 0:d.importer)===null||i===void 0||i.addEventListener("loaderCreate",this._loaderCreate),(h=(a=(s=d==null?void 0:d.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(xC)}async onRemove(c){var e,i,s,a;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),(a=(s=c.getPlugin(Yr))===null||s===void 0?void 0:s.importer)===null||a===void 0||a.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(c)}};function gE(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const i=e._clearcoatTint;return i.enableTint=!0,i.tintColor===void 0&&(i.tintColor=16777215),i.thickness===void 0&&(i.thickness=.1),i.ior===void 0&&(i.ior=1.5),c.isMaterial&&(c.needsUpdate=!0),!0}Im.PluginType="ClearcoatTintPlugin",Im.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",wC([ns("Enabled",c=>({onChange:c.setDirty})),jn()],Im.prototype,"enabled",void 0),Im=wC([Ys("ClearcoatTint Materials")],Im);class NT{constructor(e){this.parser=e,this.name=Im.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),gE(i),i.userData._clearcoatTint=eo(a,i.userData._clearcoatTint,!1,{}),Promise.resolve()}}const xC=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;i.extensions=i.extensions||{};const s=so(e.userData._clearcoatTint,!1);i.extensions[Im.CLEARCOAT_TINT_GLTF_EXTENSION]=s,c.extensionsUsed[Im.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var bC=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let _x=class extends _o{constructor(c,e,i){super(c,e,i??new UT,new vo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){if(!this.enabled)return;const h=this.overrideMaterial;h.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(c,e,i,s,a),h.uniforms.lastProjectionViewMatrix.value.copy(h.uniforms.currentProjectionViewMatrix.value)}};bC([ns("Enabled")],_x.prototype,"enabled",void 0),_x=bC([Ys("Velocity Buffer (TAA)")],_x);class UT extends b.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new b.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new b.yGw},lastProjectionViewMatrix:{value:new b.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new b.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,i,s,a,h){var d,_;const et=this._previousWorldMatrices[h.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(et??h.matrixWorld),et?et.copy(h.matrixWorld):this._previousWorldMatrices[h.uuid]=h.matrixWorld.clone();let nt=h.material;Array.isArray(nt)&&(nt=nt[0]),this.uniforms.alphaMap.value=(d=nt==null?void 0:nt.alphaMap)!==null&&d!==void 0?d:null,this.uniforms.alphaTest.value=!nt||!nt.alphaTest||nt.alphaTest<1e-7?.001:nt.alphaTest;let it=this.uniforms.alphaMap.value?1:void 0;it!==this.defines.USE_ALPHAMAP&&(it===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=it,this.needsUpdate=!0),it=nt.userData.ALPHA_I_RGBA_PACKING?1:void 0,it!==this.defines.ALPHA_I_RGBA_PACKING&&(it===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=it,this.needsUpdate=!0),this.side=(_=nt.side)!==null&&_!==void 0?_:b.ehD}}class Ax extends nv{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const i=e.renderer.createTarget({depthBuffer:!0,type:b.ywz});i.texture.name="velocityBuffer",this._velocityBuffers.push(i),e.getPluginByType("debug");const s=new Set,a=new Set;return new class extends _x{render(h,d,_,et,nt){if(e.renderer.frameCount>0)return;const it=h.getRenderTarget(),lt=h.getActiveCubeFace(),dt=h.getActiveMipmapLevel();this.scene.traverse(({material:pt})=>{pt&&((pt.transparent&&pt.userData.renderToDepth||!pt.transparent&&pt.transmission===0&&pt.userData.renderToDepth===!1)&&(s.add(pt),pt.transparent=!pt.transparent),Math.abs(pt.transmission||0)>0&&pt.userData.renderToDepth&&(a.add([pt,pt.transmission]),pt.transmission=0))}),jr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,et,nt)),s.forEach(pt=>pt.transparent=!pt.transparent),s.clear(),a.forEach(([pt,gt])=>pt.transmission=gt),a.clear(),h.setRenderTarget(it,lt,dt)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(i.overrideMaterial),i.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(i=>{var s;return e.renderer.disposeTarget((s=i==null?void 0:i.dispose)===null||s===void 0?void 0:s.call(i))}),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(s=(i=this.getVelocityBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Ax.PluginType="VelocityBuffer";class EC extends Wl{constructor(e,i){super({vertexShader:yt.vertexShader,fragmentShader:i+`
`+Gw+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new b.FM8},cameraNearFar:{value:new b.FM8},lastProjectionViewMatrix:{value:new b.yGw},currentProjectionViewMatrix:{value:new b.yGw},projection:{value:new b.yGw},inverseViewMatrix:{value:new b.yGw},jitterSample:{value:new b.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new b.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,i,s,a,h){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const d=this.uniforms.tVelocity.value?1:0;d!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=d,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,i,s,a,h),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,i){super.setSize(e,i),this.onSizeUpdate()}}(function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)})([jn(),rn()],EC.prototype,"feedBack",void 0);class yx extends nv{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[Bo]}passCtor(e){if(!e.getPlugin(Nu))throw"Add ProgressivePlugin before TAA";const i=new EC(e.getPlugin(Nu).lastFrame,e.getPlugin(Bo).getUnpackSnippet());return e.renderer.addEventListener("resize",i.onSizeUpdate),i}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const i=e.renderer.frameCount,s=this._pass.passObject;if(s.taaEnabled=i<1,!s.taaEnabled)return!1;const a=e.scene.activeCamera;return s.updateShaderProperties([e.getPlugin(Bo),a,e.getPluginByType("VelocityBuffer")]),s.target=e.getPlugin(Nu).lastFrame,s.updateCameraProperties(a==null?void 0:a.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}yx.PluginType="TAA";class SC{static async GetDataUrl(e,{mimeType:i="image/png",rect:s={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:a=1,scale:h=1}){var d,_,et;const nt=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");nt.width=s.width*h*a,nt.height=s.height*h*a,s.assumeClientRect&&(s.x*=e.width/(a*e.clientWidth),s.y*=e.height/(a*e.clientHeight),s.width*=e.width/(a*e.clientWidth),s.height*=e.height/(a*e.clientHeight));const it=nt.getContext("2d");if(!it)return console.error("snapshot: cannot create context"),"";const lt=e.style.background||((d=e.parentElement)===null||d===void 0?void 0:d.style.background)||"";if(lt.includes("url")){const pt=(_=/url\("(.*)"\)/gi.exec(lt))===null||_===void 0?void 0:_[1];if(pt){const gt=new Image;gt.src=pt,await new Promise((vt,Ct)=>{gt.onload=()=>vt(),gt.onerror=()=>Ct(),gt.complete&&vt()}),it.drawImage(gt,gt.width*s.x*a/e.width,gt.height*s.y*a/e.height,gt.width*s.width*a/e.width,gt.height*s.height*a/e.height,0,0,nt.width,nt.height)}}else it.fillStyle=e.style.background||((et=e.parentElement)===null||et===void 0?void 0:et.style.backgroundColor)||"#00000000",it.fillRect(0,0,nt.width,nt.height);it==null||it.drawImage(e,s.x*a,s.y*a,s.width*a,s.height*a,0,0,nt.width,nt.height);const dt=it.canvas.toDataURL(i);return nt.remove(),dt}static async GetImage(e,i={}){const s=await this.GetDataUrl(e,i);return new Promise((a,h)=>{const d=new Image;d.onload=()=>{a(d)},d.src=s})}static async GetBlob(e,i={}){return await(await fetch(await this.GetDataUrl(e,i))).blob()}static async GetFile(e,i="image.png",s={}){var a;return s.getDataUrl?await this.GetDataUrl(e,s):new File([await this.GetBlob(e,s)],i,{type:(a=s.mimeType)!==null&&a!==void 0?a:"image/png",lastModified:Xs()})}}var om=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Gp=class extends Ns{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(c,e={}){return e.getDataUrl=!1,await this._getFile(c,e)}async getDataUrl(c={}){var e;return c.getDataUrl=!0,(e=await this._getFile("",c))!==null&&e!==void 0?e:""}async _getFile(c,e={}){var i,s,a;const h=(i=this._viewer)===null||i===void 0?void 0:i.canvas;if(h){const d=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==d&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const _=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Nu);if(e.waitForProgressive&&_&&e.timeout===void 0)for(;!_.isConverged(!0);)await Dl(64);else await Dl((a=e.timeout)!==null&&a!==void 0?a:200);e.displayPixelRatio=1;const et=await SC.GetFile(h,c,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=d,et}}async downloadSnapshot(c="snapshot.png",e={}){const i=await this.getFile(c,e);i&&xp(i)}};Gp.PluginType="CanvasSnipper",om([ho("Download .png",{limitedUi:!0})],Gp.prototype,"downloadSnapshot",null),Gp=om([Ys("Image Export")],Gp);var El=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let FT=1,up=class{constructor(c,e,i,s,a){this.position=new b.Pa4,this.target=new b.Pa4,this.quaternion=new b._fP,this.up=new b.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=l0(this.name,this),c&&(this.position=c),e&&(this.target=e),i&&(this.up=i),s&&(this.quaternion=s),a&&(this.snap=a),this.name="Camera View"+FT++}_nameChanged(){var c,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c))}};El([jn(),Kp()],up.prototype,"position",void 0),El([jn(),Kp()],up.prototype,"target",void 0),El([jn(),Kp()],up.prototype,"quaternion",void 0),El([jn(),Kp()],up.prototype,"up",void 0),El([jn(),qs()],up.prototype,"name",void 0),El([vA()],up.prototype,"snap",void 0),El([ho()],up.prototype,"focusView",void 0),El([ho()],up.prototype,"deleteView",void 0),up=El([Cw("CameraView")],up);class Pl extends Ns{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(i=>i.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=-1),i+=1,e?i%=this._cameraViews.length:i=Math.min(i,this._cameraViews.length-1),this.focusView(this._cameraViews[i])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let i=this._cameraViews.findIndex(s=>s===this._currentView);i<0&&(i=0),i-=1,i=e?(i+this._cameraViews.length)%this._cameraViews.length:Math.max(i,0),this.focusView(this._cameraViews[i])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Mv(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var i;if(this.enabled&&!this._animating&&this.seekOnScroll){const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera;if(!s)return;const a=new b.$V,h=s.position,d=s.target,_=new b._fP().setFromUnitVectors(s.cameraObject.up,new b.Pa4(0,1,0)),et=_.clone().invert(),nt=h.clone().sub(d);nt.applyQuaternion(_),a.setFromVector3(nt),a.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,a.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,a.makeSafe(),nt.setFromSpherical(a),nt.applyQuaternion(et),h.copy(d).add(nt),s.positionUpdated(!1),s.targetUpdated()}}async onAdded(e){await super.onAdded(e);let i=!1;e.addEventListener("preFrame",s=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,i=!0):i&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,i=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,i;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(Pl.PluginType),this._fadeDisabled=!1));const s=Xs()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=s-1/60);let a=s-this._lastFrameTime;this._lastFrameTime=s,a*=this.animateOnScroll?this._scrollAnimationState:1;const h=(i=this._viewer.getPluginByType("Progressive"))===null||i===void 0?void 0:i.postFrameConvergedRecordingDelta();if(h&&h>0&&(a=h),h!==0&&(a*=1e3,!(a<=0||(this._updaters.forEach(d=>{let _=a;d.time+_<0&&(_=-d.time),d.time+=_,Math.abs(_)>.001&&d.u(_)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const d=this._viewer.getPluginByType("FrameFade");d&&(d.disable(Pl.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await Dl(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await Dl(2))}async recordAllViews(e){var i;if(!this.enabled)return;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CanvasRecorder");return s&&s.enabled&&(await this.resetToFirstView(),s.startRecording())?new Promise((a,h)=>{const d=()=>{s.removeEventListener("start",_),s.removeEventListener("stop",d),s.removeEventListener("error",et)},_=async()=>{d(),e==null||e(),await this.animateAllViews();const nt=await s.stopRecording();nt&&eu(nt,"recording.mp4"),a()},et=async()=>{d(),h()};s.addEventListener("start",_),s.addEventListener("stop",d),s.addEventListener("error",et)}):void 0}async addCurrentView(){var e,i,s,a,h;if(!this.enabled)return;const d=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!d)return;const _=this.getCurrentCameraView(d);_.snap=await((s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Gp))===null||s===void 0?void 0:s.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(_),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}getCurrentCameraView(e){var i;if(e||(e=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera),!e)return new up;const s=new b.Pa4,a=e.cameraObject.matrixWorld;s.x=a.elements[4],s.y=a.elements[5],s.z=a.elements[6];const h=new up(e.position.clone(),e.target.clone(),s.normalize(),e.cameraObject.quaternion.clone(),"");return h.focusView=async()=>this.focusView(h),h.deleteView=()=>this.deleteView(h),h}async focusView(e){return this.animateToView(e)}deleteView(e){var i,s;const a=this._cameraViews.indexOf(e);a>=0&&this._cameraViews.splice(a,1),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var i;return(i=e==null?void 0:e.stop)===null||i===void 0?void 0:i.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await Dl(100)}async animateToView(e,i,s){var a;const h=(a=this._viewer)===null||a===void 0?void 0:a.scene.activeCamera;if(!h)return;if(this._animating&&(this._popAnimations.forEach(it=>{var lt;return(lt=it==null?void 0:it.stop)===null||lt===void 0?void 0:lt.call(it)}),await Dl(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),i===void 0&&(i=this.animDuration);const d=typeof s=="function"?s:NA[s||this.animEase],_=this._driver,et=[];this._popAnimations=[];const nt=this._popAnimations;if(this.interpolateMode==="spherical")et.push(async function(it,lt,dt,pt,gt,vt){const Ct=it.target.clone(),wt=new b.Pa4,xt=new b.Pa4,_t=VA(it.cameraObject,Ct),Pt=VA(lt,lt.target),Rt=new b.$V;return wx({from:0,to:1,duration:dt,ease:pt,driver:gt,onUpdate:Lt=>{Rt.phi=vE(_t.phi,Pt.phi,Lt),Rt.theta=vE(_t.theta,Pt.theta,Lt),Rt.radius=Hu(_t.radius,Pt.radius,Lt),wt.copy(Ct).lerp(lt.target,Lt),xt.setFromSpherical(Rt),xt.add(wt),it.position=xt,it.target=wt,it.positionUpdated(!1),it.targetUpdated()},onComplete:()=>{it.position=lt.position,it.target=lt.target,it.positionUpdated(!1),it.targetUpdated()}},vt)}(h,e,i,d,_,nt));else if(this.interpolateMode==="linear"){et.push(wx({from:h.position.clone(),to:e.position.clone(),duration:i,ease:d,driver:_,onUpdate:dt=>h.position=dt,onComplete:()=>h.position=e.position},nt)),et.push(wx({from:h.target.clone(),to:e.target.clone(),duration:i,ease:d,driver:_,onUpdate:dt=>{h.target=dt,h.targetUpdated()},onComplete:()=>{h.target=e.target,h.targetUpdated()}},nt));const it=h.cameraObject.quaternion.clone(),lt=new b._fP;et.push(wx({from:0,to:1,duration:i,ease:d,driver:_,onUpdate:dt=>{lt.copy(it).slerp(e.quaternion,dt),h.cameraObject.quaternion.copy(lt),h.cameraObject.updateProjectionMatrix()},onComplete:()=>{h.cameraObject.quaternion.copy(e.quaternion),h.cameraObject.updateProjectionMatrix()}},nt))}await Promise.all(et),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await Dl(10)}fromJSON(e,i){var s,a;return this._cameraViews.forEach(h=>this.deleteView(h)),super.fromJSON(e,i)?(this._cameraViews.forEach(h=>h.focusView=async()=>this.focusView(h)),this._cameraViews.forEach(h=>h.deleteView=()=>this.deleteView(h)),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s),this):null}async animateToObject(e,i=4,s,a,h={min:.5,max:5}){if(!this._viewer)return;const d=new Dr().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),_=d.getCenter(new b.Pa4),et=d.getSize(new b.Pa4).length()/2;await this.animateToTarget(Math.min(h.max,Math.max(h.min,et*i)),_,s,a)}async animateToTarget(e,i,s,a){const h=this.getCurrentCameraView();h.target.copy(i);const d=new b.Pa4().subVectors(h.target,h.position).normalize();h.position.copy(d.multiplyScalar(-e).add(h.target)),await this.animateToView(h,s,a)}}async function wx(c,e){const i=c.onComplete,s=c.onStop;return c={...c},new Promise((a,h)=>{c.onComplete=()=>{i==null||i(),a()},c.onStop=()=>{s==null||s(),a()};const d=Wy(c);e.push(d)})}function VA(c,e){const i=c.position.clone();i.sub(e);const s=new b.$V().setFromVector3(i);return s.makeSafe(),s}function vE(c,e,i){const s=e-c;return s>=Math.PI?c+(s-2*Math.PI)*i:s<=-Math.PI?c+(s+2*Math.PI)*i:c+s*i}function CC(c,e,i){const s=(1-i)*Math.cos(c)+i*Math.cos(e),a=(1-i)*Math.sin(c)+i*Math.sin(e);return Math.atan2(a,s)}Pl.PluginType="CameraViews",El([jn("cameraViews")],Pl.prototype,"_cameraViews",void 0),El([pn(Pl.prototype._animationLoop),jn(),ns("Loop All Views",{limitedUi:!0})],Pl.prototype,"viewLooping",void 0),El([jn(),qs("View Pause Time")],Pl.prototype,"viewPauseTime",void 0),El([jn(),Cv("Ease",Object.keys(NA).map(c=>({label:c})))],Pl.prototype,"animEase",void 0),El([jn(),ss("Duration",[10,1e4],10,{limitedUi:!0})],Pl.prototype,"animDuration",void 0),El([jn(),ss("RotationOffset",[.2,.75],.01)],Pl.prototype,"rotationOffset",void 0),El([jn(),Cv("Interpolation",["spherical","linear"].map(c=>({label:c})))],Pl.prototype,"interpolateMode",void 0),El([ns(),jn()],Pl.prototype,"seekOnScroll",void 0),El([ho("Animate All Views",{limitedUi:!0})],Pl.prototype,"animateAllViews",null),El([ho("Record All Views")],Pl.prototype,"recordAllViews",null),El([ho("Add Current View")],Pl.prototype,"addCurrentView",null),El([ho("Focus Next")],Pl.prototype,"focusNext",void 0),El([ho("Focus Previous")],Pl.prototype,"focusPrevious",void 0);const MC=new b.Pa4;function dv(c,e,i){let s=c.dot(e);s=Math.min(Math.max(s,-1),1);const a=Math.acos(s)*i;return MC.copy(c).multiplyScalar(s).sub(e).negate().normalize(),c.multiplyScalar(Math.cos(a)).add(MC.multiplyScalar(Math.sin(a)))}var F0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class j0 extends Ns{constructor(e=!0){super(),this.enabled=!0,this.light=new dx("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var i,s,a;if(!this.enabled)return void(this.light.layers.mask=0);const h=(s=(i=this._viewer)===null||i===void 0?void 0:i.renderer.frameCount)!==null&&s!==void 0?s:0;(h<1||h>5)&&this.light.randomizePosition(h<5?0:h),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(a=this._cameraHelper)===null||a===void 0||a.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new b.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var i,s;e?(i=this._viewer)===null||i===void 0||i.scene.setDirty():(s=this._viewer)===null||s===void 0||s.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}j0.PluginType="RandomizedDirectionalLight",F0([jn()],j0.prototype,"enabled",void 0),F0([jn("rdLight")],j0.prototype,"light",void 0),F0([jn()],j0.prototype,"lightLayers",void 0);var z0,xx=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Hp=z0=class extends Ns{constructor(c=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=c}_paramsChanged(){var c,e,i,s,a,h,d,_,et,nt,it;const lt=(c=this._viewer)===null||c===void 0?void 0:c.getBackground(!0);if(this.enabled&&lt&&lt!==iv)if(lt.isDataTexture)lt.mapping=b.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const gt=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");gt?(gt.envmapBg=!0,(s=(i=gt.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)):(a=this._viewer)===null||a===void 0||a.setBackground(iv)}else this.enabled=!1;const dt=(et=(_=(d=(h=this._viewer)===null||h===void 0?void 0:h.renderer)===null||d===void 0?void 0:d.rendererObject)===null||_===void 0?void 0:_.background.getBoxMesh2())===null||et===void 0?void 0:et.material,pt=(nt=dt==null?void 0:dt.uniforms)!==null&&nt!==void 0?nt:b.Vj0.cube.uniforms;pt.tripodHeight||(pt.tripodHeight={value:1}),pt.worldRadius||(pt.worldRadius={value:1}),pt.tripodHeight.value=this.tripodHeight,pt.worldRadius.value=this.worldRadius,dt&&(!this.enabled&&dt.defines.HDRi_GROUND_PROJ?delete dt.defines.HDRi_GROUND_PROJ:this.enabled&&(dt.defines.HDRi_GROUND_PROJ="1"),dt.needsUpdate=!0),(it=this._viewer)===null||it===void 0||it.setDirty()}async onAdded(c){var e,i,s;await super.onAdded(c),!((s=(i=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||i===void 0?void 0:i.rendererObject)===null||s===void 0)&&s.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),b.Vj0.cube.fragmentShader=b.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),b.Vj0.cube.fragmentShader=b.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),c.scene.addEventListener("environmentChanged",this._paramsChanged)}};Hp.PluginType="HDRiGroundPlugin",xx([jn(),pn(z0.prototype._paramsChanged),ns("Enabled")],Hp.prototype,"enabled",void 0),xx([jn(),pn(z0.prototype._paramsChanged),ss("World Radius",[1,1e3])],Hp.prototype,"worldRadius",void 0),xx([jn(),pn(z0.prototype._paramsChanged),ss("Tripod height",[0,50])],Hp.prototype,"tripodHeight",void 0),Hp=z0=xx([Ys("HDRi Ground")],Hp);var Dm=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const Zy={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new b.FM8},cameraNearFar:{value:new b.FM8}},vertexShader:rv,fragmentShader:Pv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},bx=(to({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8}},vertexShader:rv,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),to({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:rv,fragmentShader:sv+`
`+LT+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class z_ extends Wl{constructor(){super(Zy,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=bx,this.nearFarBlurScale=new b.FM8(.25,.25),this.focalDepthRange=new b.FM8(.5,1.5),this.crossCenter=new b.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new vo(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=to({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:rv,fragmentShader:Pv+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=to({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new b.FM8},direction:{value:new b.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:rv,fragmentShader:Pv+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,i,s,a,h){if(!this.enabled)return;const d=e.baseRenderer,_={minFilter:b.TyD,magFilter:b.TyD,type:b.cLu,encoding:b.rnI,sizeMultiplier:.5,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1},et=d.getTempTarget(_),nt=d.getTempTarget(_);if(this.computeCocMaterial.uniforms.colorTexture.value=s.texture,d.blit(void 0,et,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=et.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,nt,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=nt.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,et,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,d.blit(void 0,nt,{material:this.dofBlurMaterial});else{const it=d.getTempTarget(_);this.dofBlurMaterial.uniforms.cocTexture.value=et.texture,this.dofBlurMaterial.uniforms.colorTexture.value=et.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),d.blit(void 0,it,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=it.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),d.blit(void 0,nt,{material:this.dofBlurMaterial}),d.releaseTempTarget(it)}this.material.uniforms.blurTexture.value=nt.texture,this.material.uniforms.cocTexture.value=et.texture,super.render(e,i,s,a,h),d.releaseTempTarget(et),d.releaseTempTarget(nt)}}Dm([jn(),rn()],z_.prototype,"nearFarBlurScale",void 0),Dm([jn(),rn()],z_.prototype,"focalDepthRange",void 0),Dm([rn()],z_.prototype,"crossCenter",void 0),Dm([rn()],z_.prototype,"crossRadius",void 0),Dm([rn()],z_.prototype,"crossAlpha",void 0),Dm([rn()],z_.prototype,"crossColor",void 0);var V0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Q0 extends nv{constructor(e=!0,i=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[Bo],this.enableEdit=!1,this._focalPointHit=new b.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new b.Pa4,this.enabled=e,this.enableEdit=i,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new z_}setFocalPoint(e,i=!0,s=!1){var a,h;this._focalPointHit.copy(e),i&&((h=(a=this._viewer)===null||a===void 0?void 0:a.getPlugin(N0))===null||h===void 0||h.startTransition(this._frameFadeTime)),s&&(this._focalPointHitTime=Xs()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&i!==void 0?i:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&i!==void 0?i:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,i;return(i=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&i!==void 0?i:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var i,s;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(N0))===null||s===void 0||s.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var i;await super.onAdded(e),(i=e.getPluginByType("Picking"))===null||i===void 0||i.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var i;return(i=e.getPluginByType("Picking"))===null||i===void 0||i.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var i,s;if(!super._update(e))return!1;const a=(i=this.pass)===null||i===void 0?void 0:i.passObject;if(!a)return!1;const h=e.getPlugin(Bo);h==null||h.updateShaderProperties(a.material),a.dofBlurMaterial.uniforms.frameCount&&((s=e.renderer)===null||s===void 0||s.updateShaderProperties(a.dofBlurMaterial));const d=e.scene.activeCamera;if(!d)return!1;d.cameraObject.updateMatrixWorld(!0),d.updateShaderProperties(a.material),this._tempVec.subVectors(this._focalPointHit,d.cameraObject.position),a.focalDepthRange.x=this._tempVec.length(),a.focalDepthRange.x*=d.cameraObject.getWorldDirection(new b.Pa4).dot(this._tempVec.normalize());let _=(Xs()-this._focalPointHitTime)/this.crossFadeTime;if(_=1-Math.min(1,Math.max(0,_)),Math.abs(_-a.crossAlpha)>.01&&(a.crossAlpha=_,this.setDirty()),_>0){const et=this._tempVec.copy(this._focalPointHit).project(d.cameraObject).addScalar(1).divideScalar(2);a.crossCenter.set(et.x,et.y),a.computeCocMaterial.uniformsNeedUpdate=!0,a.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,i,s,a,h;if(this._uiConfig)return this._uiConfig;const d=(i=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig;return d?((a=(s=d.children)===null||s===void 0?void 0:s.map(_=>Yt(_)))===null||a===void 0||a.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),(h=d.children)===null||h===void 0||h.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=d,d):{}}}Q0.PluginType="DepthOfField",V0([jn()],Q0.prototype,"enableEdit",void 0),V0([jn("focalPoint")],Q0.prototype,"_focalPointHit",void 0),V0([jn()],Q0.prototype,"crossFadeTime",void 0);var QA,hu=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Kl=QA=class extends Ns{constructor(c=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[Bo,Yr],this.materialExtension={shaderExtender:(e,i,s)=>{if(!e.defines.SSCS_ENABLED)return;const a=Qt`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,h=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${B1}
    
    #define THREE_PACKING_INCLUDED
    ${Gw}
    
    ${Pv}
    ${sv}
    
    ${k1}

#endif
            
            `+b.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${a}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",h),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",b.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,i,s)=>{var a;const h=i.materialObject;let d=this.enabled&&s.userData.screenSpaceRendering!==!1&&!(!((a=h.userData)===null||a===void 0)&&a.sscsDisabled)?1:0;h.defines.SSCS_ENABLED!==d&&(h.defines.SSCS_ENABLED=d,h.needsUpdate=!0),d=this._defines.SSCS_STEP_COUNT,h.defines.SSCS_STEP_COUNT!==d&&(h.defines.SSCS_STEP_COUNT=d,h.needsUpdate=!0),d=+this._defines.SSCS_DEBUG,h.defines.SSCS_DEBUG!==d&&(h.defines.SSCS_DEBUG=d,h.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...QA._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,i,s,a,h;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Bo),(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Nu),(s=this._viewer)===null||s===void 0?void 0:s.scene.activeCamera,(a=this._viewer)===null||a===void 0?void 0:a.renderer,(h=this._viewer)===null||h===void 0?void 0:h.scene]}},this.enabled=c,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(c){var e,i;await super.onAdded(c),(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this.materialExtension)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this.materialExtension),super.onRemove(c)}};Kl.PluginType="SSContactShadows",Kl._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new b.yGw},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},hu([ns("Enabled"),jn()],Kl.prototype,"enabled",void 0),hu([rn({uniforms:QA._uniforms,propKey:"sscsRadius"}),ss("Radius",[1e-4,.1],1e-4),jn()],Kl.prototype,"radius",void 0),hu([rn({uniforms:QA._uniforms,propKey:"sscsIntensity"}),ss("Intensity",[1e-4,1],1e-4),jn()],Kl.prototype,"intensity",void 0),hu([rn({uniforms:QA._uniforms,propKey:"sscsTolerance"}),ss("Tolerance",[.1,5]),jn()],Kl.prototype,"tolerance",void 0),hu([Fn("SSCS_DEBUG",void 0,!0),ns("Debug only SSCS"),jn()],Kl.prototype,"onlySSCSDebug",void 0),hu([Fn("SSCS_STEP_COUNT",void 0,!0),ss("Step count",[1,8],1),jn()],Kl.prototype,"stepCount",void 0),Kl=QA=hu([Ys("Screen Space Contact Shadows")],Kl);class gD{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const i=this.workerCreator();i.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=i}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,i){const s=this.workersResolve[e];if(s&&s(i),this.queue.length){const{resolve:a,msg:h,transfer:d}=this.queue.shift();this.workersResolve[e]=a,this.workers[e].postMessage(h,d)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,i){return new Promise(s=>{const a=this._getIdleWorker();a!==-1?(this._initWorker(a),this.workerStatus|=1<<a,this.workersResolve[a]=s,this.workers[a].postMessage(e,i)):this.queue.push({resolve:s,msg:e,transfer:i})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class G0{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Ex{constructor(e,i,s,a){this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const hp=[171,75,84,88,32,50,48,187,13,10,26,10];function $y(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}let TC,H0,IC;const qv={env:{emscripten_notify_memory_growth:function(c){IC=new Uint8Array(H0.exports.memory.buffer)}}};class jT{init(){return TC||(TC=typeof fetch<"u"?fetch("data:application/wasm;base64,"+DC).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,qv)).then(this._init):WebAssembly.instantiate(Buffer.from(DC,"base64"),qv).then(this._init),TC)}_init(e){H0=e.instance,qv.env.emscripten_notify_memory_growth(0)}decode(e,i=0){if(!H0)throw new Error("ZSTDDecoder: Await .init() before decoding.");const s=e.byteLength,a=H0.exports.malloc(s);IC.set(e,a),i=i||Number(H0.exports.ZSTD_findDecompressedSize(a,s));const h=H0.exports.malloc(i),d=H0.exports.ZSTD_decompress(h,i,a,s),_=IC.slice(h,h+d);return H0.exports.free(a),H0.exports.free(h),_}}const DC="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",_E=new WeakMap;let AE,Sx=0;class Yv extends b.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new gD,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new b.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const i=e.loadAsync("basis_transcoder.js"),s=new b.hH6(this.manager);s.setPath(this.transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const a=s.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([i,a]).then(([h,d])=>{const _=Yv.BasisWorker.toString(),et=["/* constants */","let _EngineFormat = "+JSON.stringify(Yv.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Yv.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Yv.BasisFormat),"/* basis_transcoder.js */",h,"/* worker */",_.substring(_.indexOf("{")+1,_.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et])),this.transcoderBinary=d,this.workerPool.setWorkerCreator(()=>{const nt=new Worker(this.workerSourceURL),it=this.transcoderBinary.slice(0);return nt.postMessage({type:"init",config:this.workerConfig,transcoderBinary:it},[it]),nt})}),Sx>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Sx++}return this.transcoderPending}load(e,i,s,a){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const h=new b.hH6(this.manager);h.setResponseType("arraybuffer"),h.setWithCredentials(this.withCredentials),h.load(e,d=>{if(_E.has(d))return _E.get(d).promise.then(i).catch(a);this.createTexture(d).then(_=>i?i(_):null).catch(a)},s,a)}_createTextureFrom(e){const{mipmaps:i,width:s,height:a,format:h,type:d,error:_,dfdTransferFn:et,dfdFlags:nt}=e;if(d==="error")return Promise.reject(_);const it=new b.EB7(i,s,a,h,b.ywz);return it.minFilter=i.length===1?b.wem:b.D1R,it.magFilter=b.wem,it.generateMipmaps=!1,it.needsUpdate=!0,it.encoding=et===2?b.knz:b.rnI,it.premultiplyAlpha=!!(1&nt),it}createTexture(e,i={}){const s=function(d){const _=new Uint8Array(d.buffer,d.byteOffset,hp.length);if(_[0]!==hp[0]||_[1]!==hp[1]||_[2]!==hp[2]||_[3]!==hp[3]||_[4]!==hp[4]||_[5]!==hp[5]||_[6]!==hp[6]||_[7]!==hp[7]||_[8]!==hp[8]||_[9]!==hp[9]||_[10]!==hp[10]||_[11]!==hp[11])throw new Error("Missing KTX 2.0 identifier.");const et=new G0,nt=17*Uint32Array.BYTES_PER_ELEMENT,it=new Ex(d,hp.length,nt,!0);et.vkFormat=it._nextUint32(),et.typeSize=it._nextUint32(),et.pixelWidth=it._nextUint32(),et.pixelHeight=it._nextUint32(),et.pixelDepth=it._nextUint32(),et.layerCount=it._nextUint32(),et.faceCount=it._nextUint32();const lt=it._nextUint32();et.supercompressionScheme=it._nextUint32();const dt=it._nextUint32(),pt=it._nextUint32(),gt=it._nextUint32(),vt=it._nextUint32(),Ct=it._nextUint64(),wt=it._nextUint64(),xt=new Ex(d,hp.length+nt,3*lt*8,!0);for(let Mr=0;Mr<lt;Mr++)et.levels.push({levelData:new Uint8Array(d.buffer,d.byteOffset+xt._nextUint64(),xt._nextUint64()),uncompressedByteLength:xt._nextUint64()});const _t=new Ex(d,dt,pt,!0),Pt={vendorId:_t._skip(4)._nextUint16(),descriptorType:_t._nextUint16(),versionNumber:_t._nextUint16(),descriptorBlockSize:_t._nextUint16(),colorModel:_t._nextUint8(),colorPrimaries:_t._nextUint8(),transferFunction:_t._nextUint8(),flags:_t._nextUint8(),texelBlockDimension:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],bytesPlane:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],samples:[]},Rt=(Pt.descriptorBlockSize/4-6)/4;for(let Mr=0;Mr<Rt;Mr++){const Tr={bitOffset:_t._nextUint16(),bitLength:_t._nextUint8(),channelType:_t._nextUint8(),samplePosition:[_t._nextUint8(),_t._nextUint8(),_t._nextUint8(),_t._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Tr.channelType?(Tr.sampleLower=_t._nextInt32(),Tr.sampleUpper=_t._nextInt32()):(Tr.sampleLower=_t._nextUint32(),Tr.sampleUpper=_t._nextUint32()),Pt.samples[Mr]=Tr}et.dataFormatDescriptor.length=0,et.dataFormatDescriptor.push(Pt);const Lt=new Ex(d,gt,vt,!0);for(;Lt._offset<vt;){const Mr=Lt._nextUint32(),Tr=Lt._scan(Mr),Lr=$y(Tr),os=Lt._scan(Mr-Tr.byteLength);et.keyValue[Lr]=Lr.match(/^ktx/i)?$y(os):os,Lt._offset%4&&Lt._skip(4-Lt._offset%4)}if(wt<=0)return et;const Ot=new Ex(d,Ct,wt,!0),qt=Ot._nextUint16(),en=Ot._nextUint16(),cn=Ot._nextUint32(),An=Ot._nextUint32(),fn=Ot._nextUint32(),Tn=Ot._nextUint32(),gn=[];for(let Mr=0;Mr<lt;Mr++)gn.push({imageFlags:Ot._nextUint32(),rgbSliceByteOffset:Ot._nextUint32(),rgbSliceByteLength:Ot._nextUint32(),alphaSliceByteOffset:Ot._nextUint32(),alphaSliceByteLength:Ot._nextUint32()});const xn=Ct+Ot._offset,Nn=xn+cn,Mn=Nn+An,Hn=Mn+fn,rr=new Uint8Array(d.buffer,d.byteOffset+xn,cn),cr=new Uint8Array(d.buffer,d.byteOffset+Nn,An),_i=new Uint8Array(d.buffer,d.byteOffset+Mn,fn),xr=new Uint8Array(d.buffer,d.byteOffset+Hn,Tn);return et.globalData={endpointCount:qt,selectorCount:en,imageDescs:gn,endpointsData:rr,selectorsData:cr,tablesData:_i,extendedData:xr},et}(new Uint8Array(e));if(s.vkFormat!==0)return async function(d){const{vkFormat:_,pixelWidth:et,pixelHeight:nt,pixelDepth:it}=d;if(PC[_]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const lt=d.levels[0];let dt,pt;if(d.supercompressionScheme===0)dt=lt.levelData;else{if(d.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");AE||(AE=new Promise(async vt=>{const Ct=new jT;await Ct.init(),vt(Ct)})),dt=(await AE).decode(lt.levelData,lt.uncompressedByteLength)}pt=yE[_]===b.VzW?new Float32Array(dt.buffer,dt.byteOffset,dt.byteLength/Float32Array.BYTES_PER_ELEMENT):yE[_]===b.cLu?new Uint16Array(dt.buffer,dt.byteOffset,dt.byteLength/Uint16Array.BYTES_PER_ELEMENT):dt;const gt=it===0?new b.IEO(pt,et,nt):new b.JUT(pt,et,nt,it);return gt.type=yE[_],gt.format=PC[_],gt.encoding=Cx[_]||b.rnI,gt.needsUpdate=!0,Promise.resolve(gt)}(s);const a=i,h=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:a},[e])).then(d=>this._createTextureFrom(d.data));return _E.set(e,{promise:h}),h}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Sx--,this}}Yv.BasisFormat={ETC1S:0,UASTC_4x4:1},Yv.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Yv.EngineFormat={RGBAFormat:b.wk1,RGBA_ASTC_4x4_Format:b.ptH,RGBA_BPTC_Format:b.bsb,RGBA_ETC2_EAC_Format:b.ekQ,RGBA_PVRTC_4BPPV1_Format:b.eaV,RGBA_S3TC_DXT5_Format:b.ILR,RGB_ETC1_Format:b.fto,RGB_ETC2_Format:b.l0P,RGB_PVRTC_4BPPV1_Format:b._AM,RGB_S3TC_DXT1_Format:b.wuA},Yv.BasisWorker=function(){let c,e,i;const s=_EngineFormat,a=_TranscoderFormat,h=_BasisFormat;self.addEventListener("message",function(it){const lt=it.data;switch(lt.type){case"init":c=lt.config,dt=lt.transcoderBinary,e=new Promise(pt=>{i={wasmBinary:dt,onRuntimeInitialized:pt},BASIS(i)}).then(()=>{i.initializeBasis(),i.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:pt,height:gt,hasAlpha:vt,mipmaps:Ct,format:wt,dfdTransferFn:xt,dfdFlags:_t}=function(Rt){const Lt=new i.KTX2File(new Uint8Array(Rt));function Ot(){Lt.close(),Lt.delete()}if(!Lt.isValid())throw Ot(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const qt=Lt.isUASTC()?h.UASTC_4x4:h.ETC1S,en=Lt.getWidth(),cn=Lt.getHeight(),An=Lt.getLevels(),fn=Lt.getHasAlpha(),Tn=Lt.getDFDTransferFunc(),gn=Lt.getDFDFlags(),{transcoderFormat:xn,engineFormat:Nn}=function(Hn,rr,cr,_i){let xr,Mr;const Tr=Hn===h.ETC1S?_:et;for(let Lr=0;Lr<Tr.length;Lr++){const os=Tr[Lr];if(c[os.if]&&os.basisFormat.includes(Hn)&&!(_i&&os.transcoderFormat.length<2)&&(!os.needsPowerOfTwo||nt(rr)&&nt(cr)))return xr=os.transcoderFormat[_i?1:0],Mr=os.engineFormat[_i?1:0],{transcoderFormat:xr,engineFormat:Mr}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),xr=a.RGBA32,Mr=s.RGBAFormat,{transcoderFormat:xr,engineFormat:Mr}}(qt,en,cn,fn);if(!en||!cn||!An)throw Ot(),new Error("THREE.KTX2Loader:	Invalid texture");if(!Lt.startTranscoding())throw Ot(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Mn=[];for(let Hn=0;Hn<An;Hn++){const rr=Lt.getImageLevelInfo(Hn,0,0),cr=rr.origWidth,_i=rr.origHeight,xr=new Uint8Array(Lt.getImageTranscodedSizeInBytes(Hn,0,0,xn));if(!Lt.transcodeImage(xr,Hn,0,0,xn,0,-1,-1))throw Ot(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Mn.push({data:xr,width:cr,height:_i})}return Ot(),{width:en,height:cn,hasAlpha:fn,mipmaps:Mn,format:Nn,dfdTransferFn:Tn,dfdFlags:gn}}(lt.buffer),Pt=[];for(let Rt=0;Rt<Ct.length;++Rt)Pt.push(Ct[Rt].data.buffer);self.postMessage({type:"transcode",id:lt.id,width:pt,height:gt,hasAlpha:vt,mipmaps:Ct,format:wt,dfdTransferFn:xt,dfdFlags:_t},Pt)}catch(pt){console.error(pt),self.postMessage({type:"error",id:lt.id,error:pt.message})}})}var dt});const d=[{if:"astcSupported",basisFormat:[h.UASTC_4x4],transcoderFormat:[a.ASTC_4x4,a.ASTC_4x4],engineFormat:[s.RGBA_ASTC_4x4_Format,s.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC7_M5,a.BC7_M5],engineFormat:[s.RGBA_BPTC_Format,s.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.BC1,a.BC3],engineFormat:[s.RGB_S3TC_DXT1_Format,s.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1,a.ETC2],engineFormat:[s.RGB_ETC2_Format,s.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.ETC1],engineFormat:[s.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[h.ETC1S,h.UASTC_4x4],transcoderFormat:[a.PVRTC1_4_RGB,a.PVRTC1_4_RGBA],engineFormat:[s.RGB_PVRTC_4BPPV1_Format,s.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],_=d.sort(function(it,lt){return it.priorityETC1S-lt.priorityETC1S}),et=d.sort(function(it,lt){return it.priorityUASTC-lt.priorityUASTC});function nt(it){return it<=2||(it&it-1)==0&&it!==0}};const PC={109:b.wk1,97:b.wk1,37:b.wk1,43:b.wk1,103:b.av9,83:b.av9,16:b.av9,22:b.av9,100:b.hEm,76:b.hEm,15:b.hEm,9:b.hEm},yE={109:b.VzW,97:b.cLu,37:b.ywz,43:b.ywz,103:b.VzW,83:b.cLu,16:b.ywz,22:b.ywz,100:b.VzW,76:b.cLu,15:b.ywz,9:b.ywz},Cx={43:b.knz,22:b.knz,15:b.knz},Mx="KHR_texture_basisu";class RC extends st{constructor(){super(...arguments),this.dependencies=[Yr]}async onAdded(e){var i,s,a,h;this._importer||(this._importer=new Zo(class extends Yv{constructor(d){super(d),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(d,_){const et=d.map(it=>new Uint8Array(it.slice(0))),nt=await super.createTexture(d,_);return nt.source._sourceImgBuffer=et,nt.userData.mimeType="image/ktx2",nt}},["ktx2"],!1)),Gs.Importers.push(this._importer),(h=(a=(s=(i=e.getManager())===null||i===void 0?void 0:i.exporter)===null||s===void 0?void 0:s.getExporter("gltf","glb"))===null||a===void 0?void 0:a.extensions)===null||h===void 0||h.push(zT)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1),this._importer=void 0}}RC.PluginType="KTX2LoadPlugin";const zT=c=>({writeTexture:(e,i)=>{if(e.userData.mimeType!=="image/ktx2")return;if(i.source!==void 0)return void console.warn("ktx2 export: source already set");const s=e.source._sourceImgBuffer;if(!s||!s.length)return void console.warn("ktx2 export: no source buffer for ktx2");i.extensions=i.extensions||{};const a={},h=new Blob(Array.isArray(s)?s:[s],{type:"image/ktx2"});a.source=c.processImageBlob(h,e),i.extensions[Mx]=a,c.extensionsUsed[Mx]=!0}});class wE{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,i,s){var a,h;if(!i)return void(this.selected=void 0);let d=this.presets.find(_=>_.path===i.path);return d||(this.presets.push(i),d=i),this.selected=d,(h=(a=e.getManager())===null||a===void 0?void 0:a.importer)===null||h===void 0?void 0:h.importAsset(d,s)}}class VT extends wE{constructor(){super(...arguments),this.name="Background"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&(a.encoding=b.knz,await e.setBackground(a)),a}}class QT extends wE{constructor(){super(...arguments),this.name="Environment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return a&&await e.scene.setEnvironment(a),a}}class GT extends wE{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,i){const s=await super.apply(e,i),a=s==null?void 0:s[0];return bn(e.getPluginByType("Diamond"),"envMap",a),a}}class Tx extends wE{async apply(e,i){var s,a;const h=await super.apply(e,i,{processImported:!1});return h?(a=(s=e.getManager())===null||s===void 0?void 0:s.importer)===null||a===void 0?void 0:a.processImported(h):void 0}}class xE extends Tx{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,i){const s=await super.apply(e,i);return s&&await e.alert("Material Library successfully imported."),s}}class W0 extends Ns{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(i=>({label:i.path.split("/").pop(),value:i.path}))],getValue:()=>{var i;return((i=e.selected)===null||i===void 0?void 0:i.path)||""},setValue:i=>{e.apply(this._viewer,e.presets.find(s=>s.path===i))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();xp(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();xp(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var i,s;await super.onAdded(e),this.presetGroups.push(new VT),this.presetGroups.push(new QT),this.presetGroups.push(new GT),this.presetGroups.push(new Tx("Ground")),this.presetGroups.push(new Tx("CameraViews")),this.presetGroups.push(new Tx("MaterialConfiguration")),this.presetGroups.push(new xE),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(i=>{var s;return[i.name,((s=i.selected)===null||s===void 0?void 0:s.path)||void 0]}).filter(([,i])=>i));return e.type=W0.PluginType,e}async fromJSON(e,i){var s,a;if(!super.fromJSON(e,i))return null;const h={...e};delete h.type;const d=[];for(const[_,et]of Object.entries(h)){const nt=this.presetGroups.find(dt=>dt.name===_),it=nt==null?void 0:nt.presets;if(!nt||!it)continue;const lt=typeof et=="string"?{path:et}:et;d.push(nt.apply(this._viewer,lt))}return await Promise.all(d),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0),this}loadPresetGroups(e){var i;for(const[s,a]of Object.entries(e)){const h=(i=this.presetGroups.find(d=>d.name===s))===null||i===void 0?void 0:i.presets;h==null||h.push(...a)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(i=>i.path)]).filter(([,e])=>e.length>0))}}W0.PluginType="PresetLibraryPlugin";var Xv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Wp=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const c=await d0(!0,!1,"model/gltf");await this.loadScenes(c)}async loadScenes(c){var e,i;const s=await Promise.all(c.map(async a=>await a.arrayBuffer()));for(let a=0;a<c.length;a++){const h=c[a];this.scenes.push({[h.name]:new Uint8Array(s[a])}),this.assets[h.name]={path:h.name,file:h}}(i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e)}async play(){var c;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const i=this._viewer.getPluginByType("FrameFade"),s=this._viewer.getPluginByType("GLTFAnimation"),a=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const h of this.scenes){if(!this._isPlaying)break;const d=Object.keys(h);s==null||s.stopAnimation(!1),await(a==null?void 0:a.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const et of d){let nt=this.assets[et];nt||(nt={path:et,file:new File([h[et]],et)},this.assets[et]=nt),await((c=this._viewer.getManager())===null||c===void 0?void 0:c.addAssetSingle(nt,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),i&&(i.enabled=!0,await i.startTransition(1e3));const _=[Dl(this.minSceneTime)];s&&_.push(s.playAnimation()),a&&_.push(a.animateAllViews()),await Promise.all(_)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const c={};for(const i of this.scenes)for(const s of Object.keys(i)){const a=c[s]?s+"_":s;c[a]=i[a]}const e=OM(c);eu(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(c){await super.onAdded(c);const e=this;Gs.Importers.push(new Zo(class extends T1{load(i,s,a,h){super.load(i,d=>{e.loadScenes([...d.values()]),s==null||s(null),Dl(100).then(e.play)},a,h)}},["glbloop"],!0))}};Wp.PluginType="SceneLoopPlugin",Xv([a0("Loaded scenes")],Wp.prototype,"loadedScenes",null),Xv([ho("Load Scenes")],Wp.prototype,"promptLoadScenes",null),Xv([a0("Playing")],Wp.prototype,"_isPlaying",void 0),Xv([qs("Min Scene Time")],Wp.prototype,"minSceneTime",void 0),Xv([ho("Play")],Wp.prototype,"play",null),Xv([ho("Stop")],Wp.prototype,"stop",null),Xv([ho("Download Scenes")],Wp.prototype,"downloadScenes",null),Wp=Xv([Ys("Scene Loop")],Wp);var HT=__webpackgi_require__(701),BC=__webpackgi_require__.n(HT),vD=__webpackgi_require__(236),bE=__webpackgi_require__.n(vD),WT=__webpackgi_require__(850),kC=__webpackgi_require__.n(WT),EE=__webpackgi_require__(182),Ix=__webpackgi_require__.n(EE),_D=__webpackgi_require__(213),LC=__webpackgi_require__.n(_D),SE=__webpackgi_require__(798),ew={};SE.Z&&SE.Z.locals&&(ew.locals=SE.Z.locals);var CE,q0=0,GA={};GA.styleTagTransform=LC(),GA.setAttributes=kC(),GA.insert=function(c,e){(e.target||document.head).appendChild(c)},GA.domAPI=bE(),GA.insertStyleElement=Ix(),ew.use=function(c){return GA.options=c||{},q0++||(CE=BC()(SE.Z,GA)),ew},ew.unuse=function(){q0>0&&!--q0&&(CE(),CE=null)};var ME,qT=ew,V_=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let Y0=ME=class extends Ns{constructor(){super(),this.enabled=!0,this.dependencies=[Yr],this._popupDiv=No({id:"assetManagerPopup",addToBody:!1,innerHTML:""});const c=No({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});c.addEventListener("click",()=>{this._popupDiv.style.display="none"}),this._popupContent=No({id:"assetManagerPopupContent",addToBody:!1,innerHTML:""}),this.enabled||(this._popupDiv.style.display="none"),this._popupDiv.appendChild(c),this._popupDiv.appendChild(this._popupContent)}_onEnabledChange(){this.enabled||(this._popupDiv.style.display="none")}_updatePopupDiv(c){if(!this._popupContent)return;if(!this.enabled)return void(this._popupDiv.style.display="none");let e="";c.forEach((i,s)=>{e+=`<span class="processState">${i.state}</span>: ${s.split("/").pop()} ${i.progress?" - "+i.progress:""}<br>`}),this._popupContent.innerHTML=e,c.size===0?this._popupDiv.style.display="none":this._popupDiv.style.display="block"}async onAdded(c){var e,i,s,a;await super.onAdded(c),qT.use({target:c.container}),c.container.appendChild(this._popupDiv);const h=new Map;(i=(e=c.getManager())===null||e===void 0?void 0:e.importer)===null||i===void 0||i.addEventListener("importFile",d=>{d.state!=="done"?h.set(d.path,{state:d.state,progress:d.progress?(100*d.progress).toFixed(0)+"%":void 0}):h.delete(d.path),this._updatePopupDiv(h)}),(a=(s=c.getManager())===null||s===void 0?void 0:s.exporter)===null||a===void 0||a.addEventListener("exportFile",d=>{d.state!=="done"?h.set(d.obj.name,{state:d.state,progress:d.progress?(100*d.progress).toFixed(0)+"%":void 0}):h.delete(d.obj.name),this._updatePopupDiv(h)})}};Y0.PluginType="AssetManagerBasicPopupPlugin",V_([ns("Enabled"),pn(ME.prototype._onEnabledChange),jn()],Y0.prototype,"enabled",void 0),Y0=ME=V_([Ys("Asset manager popup")],Y0);class AD extends Wl{constructor(e){super({vertexShader:yt.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new m0}render(e,i,s,a,h){super.render(e,i,s,a,h),this.needsSwap=!0}}class ep extends nv{constructor(e=!0,i=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[Bo],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=i}get renderToScreen(){return this._renderToScreen}async onAdded(e){var i,s;return!((s=(i=this._viewer)===null||i===void 0?void 0:i.screenShader)===null||s===void 0)&&s.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&bn(e.renderer.passes.find(a=>a.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var i,s,a,h;const d=e.screenShader,_=["",""];this._renderToScreen&&!d.isShaderPass2&&(_[0]=Array.isArray(d)?d[0]:((i=d)===null||i===void 0?void 0:i.pars)||"",_[1]=Array.isArray(d)?d[1]:typeof d=="string"?d:((s=d)===null||s===void 0?void 0:s.main)||"");const et=new AD(_);return bn((h=(a=et.uiConfig)===null||a===void 0?void 0:a.children)===null||h===void 0?void 0:h.find(nt=>{var it;return((it=nt)===null||it===void 0?void 0:it.label)==="Enabled"}),"hidden",!0,!0),et}_update(e){var i;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((i=this._viewer)===null||i===void 0?void 0:i.getPlugin(Bo)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,i,s;return(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}ep.PluginType="CombinedPostPlugin";var YT=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class X0 extends Ns{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[ep]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var i;await super.onAdded(e),this._extension=this.generateExtension(e),(i=e.getPlugin(ep))===null||i===void 0||i.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}YT([jn("extension")],X0.prototype,"_extension",void 0),YT([jn()],X0.prototype,"enabled",void 0);class Q_{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,i,s){this.enabled&&(e.fragmentShader=Jo(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class TE extends X0{generateExtension(e){return new Q_}}TE.PluginType="GammaCorrection";var Dx,pv=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const XT=b.dZ3;let G_=Dx=class{constructor(c,e=!0,i=!0){this.depthTonemap=e,this.toneMapping=b.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(s,a)=>this.enabled?Qt`
            ${this.depthTonemap?Pv:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getGBufferFlags(vUv).x>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=c.getPlugin(ep),this._setDirty=this._setDirty.bind(this),this._renderToScreen=i,this.depthTonemap=e}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){if(!this.enabled)return;const{toneMapping:s,toneMappingExposure:a,outputEncoding:h}=i;this._rendererState.toneMapping=s,this._rendererState.toneMappingExposure=a,this._rendererState.outputEncoding=h;let d=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==d&&(e.materialObject.defines.TONEMAP_BACKGROUND=d,e.materialObject.needsUpdate=!0),d=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==d&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=d,e.materialObject.needsUpdate=!0),i.toneMapping=this.toneMapping,i.toneMappingExposure=this.exposure,i.outputEncoding=b.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(c,e,i){i.toneMapping=this._rendererState.toneMapping,i.toneMappingExposure=this._rendererState.toneMappingExposure,i.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};G_.PluginType="Tonemap",pv([Cv("Mode",[["Linear",b.EoG],["Reinhard",b.CdI],["Cineon",b.YGz],["ACESFilmic",b.LY2],["Uncharted2",XT]].map(c=>({label:c[0],value:c[1]})),{limitedUi:!0}),pn(Dx.prototype._setDirty),jn()],G_.prototype,"toneMapping",void 0),pv([ns("Tonemap Background",{limitedUi:!0}),jn()],G_.prototype,"tonemapBackground",void 0),pv([pn(Dx.prototype._setDirty),ns("Clip Background"),jn()],G_.prototype,"clipBackground",void 0),pv([pn(Dx.prototype._setDirty),ss("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),jn()],G_.prototype,"exposure",void 0),G_=Dx=pv([Ys("Tonemapping")],G_);class Px extends X0{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e}fromJSON(e,i){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,i)}generateExtension(e){return new G_(e,this.depthTonemap)}get exposure(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&i!==void 0?i:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&i!==void 0?i:b.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}}Px.PluginType="Tonemap",b.WdD.tonemapping_pars_fragment=b.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Rx,tw=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let nw=Rx=class{constructor(c){this.enabled=!1,this.intensity=1,this.lutMap=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
vec4 colorLookUp(in vec4 color){vec4 outColor;float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);float lutFac=step(0.0001,getGBufferFlags(vUv).a);
#if USE_3DTEXTURE == 1
outColor=vec4(texture(lut3d,uvw).rgb,color.a);
#else
outColor=vec4(lutLookup(lut,lutSize,uvw),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=c.getPlugin(ep),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                gl_FragColor = colorLookUp(gl_FragColor);
            #endif
            #glMarker
        `))}onObjectRender(c,e,i){if(this.enabled)if(this.lutMap){const s=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==s&&(e.materialObject.defines.USE_3DTEXTURE=s,e.materialObject.needsUpdate=!0);let a=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,a=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,a=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=a,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}};tw([jn(),pn(Rx.prototype._setDirty),ns("Enable")],nw.prototype,"enabled",void 0),tw([jn(),pn(Rx.prototype._setDirty),ss("Intensity")],nw.prototype,"intensity",void 0),tw([pn(Rx.prototype._setDirty),vA("LUT"),jn()],nw.prototype,"lutMap",void 0),nw=Rx=tw([Ys("LUT")],nw);class IE extends X0{generateExtension(e){return new nw(e)}}IE.PluginType="LUT";var Bx,ao=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let HA=Bx=class{constructor(c){this.enabled=!1,this.power=.5,this.bgcolor=new b.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new b.Ilk}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=c.getPlugin(ep),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};HA.PluginType="Vignette",ao([pn(Bx.prototype._setDirty),ns("Enable"),jn()],HA.prototype,"enabled",void 0),ao([pn(Bx.prototype._setDirty),ss("Power",[.1,4],.01,{limitedUi:!0}),jn()],HA.prototype,"power",void 0),ao([pn(Bx.prototype._setDirty),Wm("Color"),jn()],HA.prototype,"bgcolor",void 0),HA=Bx=ao([Ys("Vignette")],HA);class DE extends X0{constructor(){super()}generateExtension(e){return new HA(e)}get power(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&i!==void 0?i:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&i!==void 0?i:new b.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}DE.PluginType="Vignette";var PE,OC=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let H_=PE=class{constructor(c){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(ep),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};H_.PluginType="ChromaticAberration",OC([pn(PE.prototype._setDirty),ns("Enable"),jn()],H_.prototype,"enabled",void 0),OC([pn(PE.prototype._setDirty),ss("Intensity",[0,.1],.001,{limitedUi:!0}),jn()],H_.prototype,"aberrationIntensity",void 0),H_=PE=OC([Ys("ChromaticAberration")],H_);class RE extends X0{constructor(){super()}generateExtension(e){return new H_(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}RE.PluginType="ChromaticAberration";var kx,BE=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let iw=kx=class{constructor(c){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,i)=>this.enabled?Qt`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=c.getPlugin(ep),this._setDirty=this._setDirty.bind(this)}shaderExtender(c,e,i){this.enabled&&(c.fragmentShader=Jo(c.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(c,e,i){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(c){return this.enabled?"1":"0"}isCompatible(c){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};BE([pn(kx.prototype._setDirty),ns("Enable"),jn()],iw.prototype,"enabled",void 0),BE([pn(kx.prototype._setDirty),ns("Multiply"),jn()],iw.prototype,"grainMultiply",void 0),BE([pn(kx.prototype._setDirty),ss("Intensity",[0,20],.01,{limitedUi:!0}),jn()],iw.prototype,"grainIntensity",void 0),iw=kx=BE([Ys("FilmicGrain")],iw);class kE extends X0{constructor(){super()}generateExtension(e){return new iw(e)}get intensity(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&i!==void 0?i:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,i;return(i=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&i!==void 0&&i}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}async function LE(c,{ground:e=!0,bloom:i=!0,depthTonemap:s=!0,enableDrop:a=!1}={}){await c.addPlugin(Bo),await c.addPlugin(Tl),a&&await c.addPlugin(Vw),await c.addPlugin(new Nu(32)),await c.addPlugin(new ep),await c.addPlugin(new RE),await c.addPlugin(new Px(s||!c.useRgbm)),await c.addPlugin(new IE),await c.addPlugin(new DE),await c.addPlugin(new kE),await c.addPlugin(new TE),await c.addPlugin(O1),await c.addPlugin(U1),await c.addPlugin($a),await c.addPlugin(N0),await c.addPlugin(Go),e&&await c.addPlugin(zp),i&&await c.addPlugin(F_),await c.addPlugin(Qp),await c.addPlugin(sm),await c.addPlugin(Uu),await c.addPlugin(Mu),await c.addPlugin(Im),await c.addPlugin(Ax,!1),await c.addPlugin(yx),await c.addPlugin(Pl),await c.addPlugin(j0,!1),await c.addPlugin(Hp,!1),await c.addPlugin(Q0,!1),await c.addPlugin(Kl,!1),await c.addPlugin(RC),await c.addPlugin(W0),await c.addPlugin(Wp)}async function OE(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,enableDrop:d=!1}={}){var _;const et=new Cm(c);e&&await et.addPlugin(cv);const nt=await et.addPlugin(Yr,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return h&&await et.addPlugin(Y0),await LE(et,{ground:i,bloom:s,depthTonemap:a,enableDrop:d}),et.renderer.refreshPipeline(),(_=nt.importer)===null||_===void 0||_.processors.add("model",{forAssetType:"model",process:(it,lt)=>it}),et}kE.PluginType="FilmicGrain";let yD=0;class KT extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=yD++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=h0(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=Wt`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await OE({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,i,s){console.log("WebGiViewerElement attributes changed.",e,i,s),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const i=[e],s=[],a=[];for(const h of i)!this._models[h]&&h&&(this._models[h]=this.viewer.getManager().importer.importPath(h,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[h,d]of Object.entries(this._models))i.includes(h)?s.push(d):a.push(d);await Promise.all([Promise.all(s).then(async h=>Promise.all(h.map(async d=>this.viewer.getManager().importer.processImported(d)))).then(h=>{for(const d of h)for(const _ of d)_&&_.assetType==="model"&&this.viewer.scene.addSceneObject(_)}),Promise.all(a).then(h=>{for(const d of h)for(const _ of d)_&&_.assetType==="model"&&_.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const i=this.viewer.scene.getEnvironment(),s=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;s&&s.assetType!=="texture"||await this.viewer.scene.setEnvironment(s),i==null||i.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,i){return this.hasAttribute(e)?this.getAttribute(e):i}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",KT);class JT{constructor(e){var i,s,a;this._basePath=(i=e==null?void 0:e.basePath)!==null&&i!==void 0?i:"",this._assets=(a=(s=e==null?void 0:e.assets)===null||s===void 0?void 0:s.map(h=>this._resolveAsset(h)))!==null&&a!==void 0?a:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const i=this._assets.find(e);return i??void 0}_resolveAsset(e){return{...e,path:h_([this._basePath,e.path])}}}class wD extends st{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const i=this._assets.indexOf(e);i>=0&&this._assets.splice(i,1)}async findAssetRegex(e){for(const i of this._assets){const s=i.find(a=>{var h,d;return a&&(e.test(a.path)||e.test((d=(h=a.file)===null||h===void 0?void 0:h.name)!==null&&d!==void 0?d:""))});if(s)return s}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,i=!1){return this.findAssetRegex(new RegExp(e,i?"i":""))}}var NC={},rw=function(c){return URL.createObjectURL(new Blob([c],{type:"text/javascript"}))},ZT=function(c){return new Worker(c)};try{URL.revokeObjectURL(rw(""))}catch{rw=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ZT=function(e){return new Worker(e,{type:"module"})}}var oo=Uint8Array,Tu=Uint16Array,tp=Uint32Array,K0=new oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),W_=new oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lx=new oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UC=function(c,e){for(var i=new Tu(31),s=0;s<31;++s)i[s]=e+=1<<c[s-1];var a=new tp(i[30]);for(s=1;s<30;++s)for(var h=i[s];h<i[s+1];++h)a[h]=h-i[s]<<5|s;return[i,a]},$T=UC(K0,2),FC=$T[0],Ox=$T[1];FC[28]=258,Ox[258]=28;for(var jC=UC(W_,0),eI=jC[0],zC=jC[1],Nx=new Tu(32768),xa=0;xa<32768;++xa){var Kv=(43690&xa)>>>1|(21845&xa)<<1;Kv=(61680&(Kv=(52428&Kv)>>>2|(13107&Kv)<<2))>>>4|(3855&Kv)<<4,Nx[xa]=((65280&Kv)>>>8|(255&Kv)<<8)>>>1}var am=function(c,e,i){for(var s=c.length,a=0,h=new Tu(e);a<s;++a)++h[c[a]-1];var d,_=new Tu(e);for(a=0;a<e;++a)_[a]=_[a-1]+h[a-1]<<1;if(i){d=new Tu(1<<e);var et=15-e;for(a=0;a<s;++a)if(c[a])for(var nt=a<<4|c[a],it=e-c[a],lt=_[c[a]-1]++<<it,dt=lt|(1<<it)-1;lt<=dt;++lt)d[Nx[lt]>>>et]=nt}else for(d=new Tu(s),a=0;a<s;++a)c[a]&&(d[a]=Nx[_[c[a]-1]++]>>>15-c[a]);return d},J0=new oo(288);for(xa=0;xa<144;++xa)J0[xa]=8;for(xa=144;xa<256;++xa)J0[xa]=9;for(xa=256;xa<280;++xa)J0[xa]=7;for(xa=280;xa<288;++xa)J0[xa]=8;var Z0=new oo(32);for(xa=0;xa<32;++xa)Z0[xa]=5;var Rl=am(J0,9,0),tI=am(J0,9,1),Ul=am(Z0,5,0),Ux=am(Z0,5,1),NE=function(c){for(var e=c[0],i=1;i<c.length;++i)c[i]>e&&(e=c[i]);return e},Pm=function(c,e,i){var s=e/8|0;return(c[s]|c[s+1]<<8)>>(7&e)&i},UE=function(c,e){var i=e/8|0;return(c[i]|c[i+1]<<8|c[i+2]<<16)>>(7&e)},sw=function(c){return(c/8|0)+(7&c&&1)},dp=function(c,e,i){(e==null||e<0)&&(e=0),(i==null||i>c.length)&&(i=c.length);var s=new(c instanceof Tu?Tu:c instanceof tp?tp:oo)(i-e);return s.set(c.subarray(e,i)),s},WA=function(c,e,i){var s=c.length;if(!s||i&&!i.l&&s<5)return e||new oo(0);var a=!e||i,h=!i||i.i;i||(i={}),e||(e=new oo(3*s));var d=function(os){var pr=e.length;if(os>pr){var Bs=new oo(Math.max(2*pr,os));Bs.set(e),e=Bs}},_=i.f||0,et=i.p||0,nt=i.b||0,it=i.l,lt=i.d,dt=i.m,pt=i.n,gt=8*s;do{if(!it){i.f=_=Pm(c,et,1);var vt=Pm(c,et+1,3);if(et+=3,!vt){var Ct=c[(An=sw(et)+4)-4]|c[An-3]<<8,wt=An+Ct;if(wt>s){if(h)throw"unexpected EOF";break}a&&d(nt+Ct),e.set(c.subarray(An,wt),nt),i.b=nt+=Ct,i.p=et=8*wt;continue}if(vt==1)it=tI,lt=Ux,dt=9,pt=5;else{if(vt!=2)throw"invalid block type";var xt=Pm(c,et,31)+257,_t=Pm(c,et+10,15)+4,Pt=xt+Pm(c,et+5,31)+1;et+=14;for(var Rt=new oo(Pt),Lt=new oo(19),Ot=0;Ot<_t;++Ot)Lt[Lx[Ot]]=Pm(c,et+3*Ot,7);et+=3*_t;var qt=NE(Lt),en=(1<<qt)-1,cn=am(Lt,qt,1);for(Ot=0;Ot<Pt;){var An,fn=cn[Pm(c,et,en)];if(et+=15&fn,(An=fn>>>4)<16)Rt[Ot++]=An;else{var Tn=0,gn=0;for(An==16?(gn=3+Pm(c,et,3),et+=2,Tn=Rt[Ot-1]):An==17?(gn=3+Pm(c,et,7),et+=3):An==18&&(gn=11+Pm(c,et,127),et+=7);gn--;)Rt[Ot++]=Tn}}var xn=Rt.subarray(0,xt),Nn=Rt.subarray(xt);dt=NE(xn),pt=NE(Nn),it=am(xn,dt,1),lt=am(Nn,pt,1)}if(et>gt){if(h)throw"unexpected EOF";break}}a&&d(nt+131072);for(var Mn=(1<<dt)-1,Hn=(1<<pt)-1,rr=et;;rr=et){var cr=(Tn=it[UE(c,et)&Mn])>>>4;if((et+=15&Tn)>gt){if(h)throw"unexpected EOF";break}if(!Tn)throw"invalid length/literal";if(cr<256)e[nt++]=cr;else{if(cr==256){rr=et,it=null;break}var _i=cr-254;if(cr>264){var xr=K0[Ot=cr-257];_i=Pm(c,et,(1<<xr)-1)+FC[Ot],et+=xr}var Mr=lt[UE(c,et)&Hn],Tr=Mr>>>4;if(!Mr)throw"invalid distance";if(et+=15&Mr,Nn=eI[Tr],Tr>3&&(xr=W_[Tr],Nn+=UE(c,et)&(1<<xr)-1,et+=xr),et>gt){if(h)throw"unexpected EOF";break}a&&d(nt+131072);for(var Lr=nt+_i;nt<Lr;nt+=4)e[nt]=e[nt-Nn],e[nt+1]=e[nt+1-Nn],e[nt+2]=e[nt+2-Nn],e[nt+3]=e[nt+3-Nn];nt=Lr}}i.l=it,i.p=rr,i.b=nt,it&&(_=1,i.m=dt,i.d=lt,i.n=pt)}while(!_);return nt==e.length?e:dp(e,0,nt)},Jv=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8},ow=function(c,e,i){i<<=7&e;var s=e/8|0;c[s]|=i,c[s+1]|=i>>>8,c[s+2]|=i>>>16},FE=function(c,e){for(var i=[],s=0;s<c.length;++s)c[s]&&i.push({s,f:c[s]});var a=i.length,h=i.slice();if(!a)return[$0,0];if(a==1){var d=new oo(i[0].s+1);return d[i[0].s]=1,[d,1]}i.sort(function(Rt,Lt){return Rt.f-Lt.f}),i.push({s:-1,f:25001});var _=i[0],et=i[1],nt=0,it=1,lt=2;for(i[0]={s:-1,f:_.f+et.f,l:_,r:et};it!=a-1;)_=i[i[nt].f<i[lt].f?nt++:lt++],et=i[nt!=it&&i[nt].f<i[lt].f?nt++:lt++],i[it++]={s:-1,f:_.f+et.f,l:_,r:et};var dt=h[0].s;for(s=1;s<a;++s)h[s].s>dt&&(dt=h[s].s);var pt=new Tu(dt+1),gt=Rm(i[it-1],pt,0);if(gt>e){s=0;var vt=0,Ct=gt-e,wt=1<<Ct;for(h.sort(function(Rt,Lt){return pt[Lt.s]-pt[Rt.s]||Rt.f-Lt.f});s<a;++s){var xt=h[s].s;if(!(pt[xt]>e))break;vt+=wt-(1<<gt-pt[xt]),pt[xt]=e}for(vt>>>=Ct;vt>0;){var _t=h[s].s;pt[_t]<e?vt-=1<<e-pt[_t]++-1:++s}for(;s>=0&&vt;--s){var Pt=h[s].s;pt[Pt]==e&&(--pt[Pt],++vt)}gt=e}return[new oo(pt),gt]},Rm=function(c,e,i){return c.s==-1?Math.max(Rm(c.l,e,i+1),Rm(c.r,e,i+1)):e[c.s]=i},VC=function(c){for(var e=c.length;e&&!c[--e];);for(var i=new Tu(++e),s=0,a=c[0],h=1,d=function(et){i[s++]=et},_=1;_<=e;++_)if(c[_]==a&&_!=e)++h;else{if(!a&&h>2){for(;h>138;h-=138)d(32754);h>2&&(d(h>10?h-11<<5|28690:h-3<<5|12305),h=0)}else if(h>3){for(d(a),--h;h>6;h-=6)d(8304);h>2&&(d(h-3<<5|8208),h=0)}for(;h--;)d(a);h=1,a=c[_]}return[i.subarray(0,s),e]},aw=function(c,e){for(var i=0,s=0;s<e.length;++s)i+=c[s]*e[s];return i},Fx=function(c,e,i){var s=i.length,a=sw(e+2);c[a]=255&s,c[a+1]=s>>>8,c[a+2]=255^c[a],c[a+3]=255^c[a+1];for(var h=0;h<s;++h)c[a+h+4]=i[h];return 8*(a+4+s)},QC=function(c,e,i,s,a,h,d,_,et,nt,it){Jv(e,it++,i),++a[256];for(var lt=FE(a,15),dt=lt[0],pt=lt[1],gt=FE(h,15),vt=gt[0],Ct=gt[1],wt=VC(dt),xt=wt[0],_t=wt[1],Pt=VC(vt),Rt=Pt[0],Lt=Pt[1],Ot=new Tu(19),qt=0;qt<xt.length;++qt)Ot[31&xt[qt]]++;for(qt=0;qt<Rt.length;++qt)Ot[31&Rt[qt]]++;for(var en=FE(Ot,7),cn=en[0],An=en[1],fn=19;fn>4&&!cn[Lx[fn-1]];--fn);var Tn,gn,xn,Nn,Mn=nt+5<<3,Hn=aw(a,J0)+aw(h,Z0)+d,rr=aw(a,dt)+aw(h,vt)+d+14+3*fn+aw(Ot,cn)+(2*Ot[16]+3*Ot[17]+7*Ot[18]);if(Mn<=Hn&&Mn<=rr)return Fx(e,it,c.subarray(et,et+nt));if(Jv(e,it,1+(rr<Hn)),it+=2,rr<Hn){Tn=am(dt,pt,0),gn=dt,xn=am(vt,Ct,0),Nn=vt;var cr=am(cn,An,0);for(Jv(e,it,_t-257),Jv(e,it+5,Lt-1),Jv(e,it+10,fn-4),it+=14,qt=0;qt<fn;++qt)Jv(e,it+3*qt,cn[Lx[qt]]);it+=3*fn;for(var _i=[xt,Rt],xr=0;xr<2;++xr){var Mr=_i[xr];for(qt=0;qt<Mr.length;++qt){var Tr=31&Mr[qt];Jv(e,it,cr[Tr]),it+=cn[Tr],Tr>15&&(Jv(e,it,Mr[qt]>>>5&127),it+=Mr[qt]>>>12)}}}else Tn=Rl,gn=J0,xn=Ul,Nn=Z0;for(qt=0;qt<_;++qt)if(s[qt]>255){Tr=s[qt]>>>18&31,ow(e,it,Tn[Tr+257]),it+=gn[Tr+257],Tr>7&&(Jv(e,it,s[qt]>>>23&31),it+=K0[Tr]);var Lr=31&s[qt];ow(e,it,xn[Lr]),it+=Nn[Lr],Lr>3&&(ow(e,it,s[qt]>>>5&8191),it+=W_[Lr])}else ow(e,it,Tn[s[qt]]),it+=gn[s[qt]];return ow(e,it,Tn[256]),it+gn[256]},nI=new tp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$0=new oo(0),iI=function(c,e,i,s,a,h){var d=c.length,_=new oo(s+d+5*(1+Math.ceil(d/7e3))+a),et=_.subarray(s,_.length-a),nt=0;if(!e||d<8)for(var it=0;it<=d;it+=65535){var lt=it+65535;lt<d?nt=Fx(et,nt,c.subarray(it,lt)):(et[it]=h,nt=Fx(et,nt,c.subarray(it,d)))}else{for(var dt=nI[e-1],pt=dt>>>13,gt=8191&dt,vt=(1<<i)-1,Ct=new Tu(32768),wt=new Tu(vt+1),xt=Math.ceil(i/3),_t=2*xt,Pt=function(Mo){return(c[Mo]^c[Mo+1]<<xt^c[Mo+2]<<_t)&vt},Rt=new tp(25e3),Lt=new Tu(288),Ot=new Tu(32),qt=0,en=0,cn=(it=0,0),An=0,fn=0;it<d;++it){var Tn=Pt(it),gn=32767&it,xn=wt[Tn];if(Ct[gn]=xn,wt[Tn]=gn,An<=it){var Nn=d-it;if((qt>7e3||cn>24576)&&Nn>423){nt=QC(c,et,0,Rt,Lt,Ot,en,cn,fn,it-fn,nt),cn=qt=en=0,fn=it;for(var Mn=0;Mn<286;++Mn)Lt[Mn]=0;for(Mn=0;Mn<30;++Mn)Ot[Mn]=0}var Hn=2,rr=0,cr=gt,_i=gn-xn&32767;if(Nn>2&&Tn==Pt(it-_i))for(var xr=Math.min(pt,Nn)-1,Mr=Math.min(32767,it),Tr=Math.min(258,Nn);_i<=Mr&&--cr&&gn!=xn;){if(c[it+Hn]==c[it+Hn-_i]){for(var Lr=0;Lr<Tr&&c[it+Lr]==c[it+Lr-_i];++Lr);if(Lr>Hn){if(Hn=Lr,rr=_i,Lr>xr)break;var os=Math.min(_i,Lr-2),pr=0;for(Mn=0;Mn<os;++Mn){var Bs=it-_i+Mn+32768&32767,Ws=Bs-Ct[Bs]+32768&32767;Ws>pr&&(pr=Ws,xn=Bs)}}}_i+=(gn=xn)-(xn=Ct[gn])+32768&32767}if(rr){Rt[cn++]=268435456|Ox[Hn]<<18|zC[rr];var ks=31&Ox[Hn],uo=31&zC[rr];en+=K0[ks]+W_[uo],++Lt[257+ks],++Ot[uo],An=it+Hn,++qt}else Rt[cn++]=c[it],++Lt[c[it]]}}nt=QC(c,et,h,Rt,Lt,Ot,en,cn,fn,it-fn,nt),!h&&7&nt&&(nt=Fx(et,nt+1,$0))}return dp(_,0,s+sw(nt)+a)},rI=function(){for(var c=new tp(256),e=0;e<256;++e){for(var i=e,s=9;--s;)i=(1&i&&3988292384)^i>>>1;c[e]=i}return c}(),lw=function(){var c=-1;return{p:function(e){for(var i=c,s=0;s<e.length;++s)i=rI[255&i^e[s]]^i>>>8;c=i},d:function(){return~c}}},GC=function(){var c=1,e=0;return{p:function(i){for(var s=c,a=e,h=i.length,d=0;d!=h;){for(var _=Math.min(d+2655,h);d<_;++d)a+=s+=i[d];s=(65535&s)+15*(s>>16),a=(65535&a)+15*(a>>16)}c=s,e=a},d:function(){return(255&(c%=65521))<<24|c>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},qA=function(c,e,i,s,a){return iI(c,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(c.length)))):12+e.mem,i,s,!a)},jx=function(c,e){var i={};for(var s in c)i[s]=c[s];for(var s in e)i[s]=e[s];return i},sI=function(c,e,i){for(var s=c(),a=c.toString(),h=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/ /g,"").split(","),d=0;d<s.length;++d){var _=s[d],et=h[d];if(typeof _=="function"){e+=";"+et+"=";var nt=_.toString();if(_.prototype)if(nt.indexOf("[native code]")!=-1){var it=nt.indexOf(" ",8)+1;e+=nt.slice(it,nt.indexOf("(",it))}else for(var lt in e+=nt,_.prototype)e+=";"+et+".prototype."+lt+"="+_.prototype[lt].toString();else e+=nt}else i[et]=_}return[e,i]},jE=[],oI=function(c,e,i,s){var a;if(!jE[i]){for(var h="",d={},_=c.length-1,et=0;et<_;++et)h=(a=sI(c[et],h,d))[0],d=a[1];jE[i]=sI(c[_],h,d)}var nt=jx({},jE[i][1]);return function(it,lt,dt,pt,gt){var vt=ZT(NC[lt]||(NC[lt]=rw(it)));return vt.onerror=function(Ct){return gt(Ct.error,null)},vt.onmessage=function(Ct){return gt(null,Ct.data)},vt.postMessage(dt,pt),vt}(jE[i][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",i,nt,function(it){var lt=[];for(var dt in it)(it[dt]instanceof oo||it[dt]instanceof Tu||it[dt]instanceof tp)&&lt.push((it[dt]=new it[dt].constructor(it[dt])).buffer);return lt}(nt),s)},cw=function(){return[oo,Tu,tp,K0,W_,Lx,FC,eI,tI,Ux,Nx,am,NE,Pm,UE,sw,dp,WA,Kt,q_,HC]},uw=function(){return[oo,Tu,tp,K0,W_,Lx,Ox,zC,Rl,J0,Ul,Z0,Nx,nI,$0,am,Jv,ow,FE,Rm,VC,aw,Fx,QC,sw,dp,iI,qA,Dt,q_]},aI=function(){return[rt,ft,_e,lw,rI]},lI=function(){return[at,ct]},cI=function(){return[mt,_e,GC]},uI=function(){return[bt]},q_=function(c){return postMessage(c,[c.buffer])},HC=function(c){return c&&c.size&&new oo(c.size)},hw=function(c,e,i,s,a,h){var d=oI(i,s,a,function(_,et){d.terminate(),h(_,et)});return d.postMessage([c,e],e.consume?[c.buffer]:[]),function(){d.terminate()}},Bm=function(c){return c.ondata=function(e,i){return postMessage([e,i],[e.buffer])},function(e){return c.push(e.data[0],e.data[1])}},ut=function(c,e,i,s,a){var h,d=oI(c,s,a,function(_,et){_?(d.terminate(),e.ondata.call(e,_)):(et[1]&&d.terminate(),e.ondata.call(e,_,et[0],et[1]))});d.postMessage(i),e.push=function(_,et){if(h)throw"stream finished";if(!e.ondata)throw"no stream handler";d.postMessage([_,h=et],[_.buffer])},e.terminate=function(){d.terminate()}},o=function(c,e){return c[e]|c[e+1]<<8},g=function(c,e){return(c[e]|c[e+1]<<8|c[e+2]<<16|c[e+3]<<24)>>>0},$=function(c,e){return g(c,e)+4294967296*g(c,e+4)},_e=function(c,e,i){for(;i;++e)c[e]=i,i>>>=8},rt=function(c,e){var i=e.filename;if(c[0]=31,c[1]=139,c[2]=8,c[8]=e.level<2?4:e.level==9?2:0,c[9]=3,e.mtime!=0&&_e(c,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),i){c[3]=8;for(var s=0;s<=i.length;++s)c[s+10]=i.charCodeAt(s)}},at=function(c){if(c[0]!=31||c[1]!=139||c[2]!=8)throw"invalid gzip data";var e=c[3],i=10;4&e&&(i+=c[10]|2+(c[11]<<8));for(var s=(e>>3&1)+(e>>4&1);s>0;s-=!c[i++]);return i+(2&e)},ct=function(c){var e=c.length;return(c[e-4]|c[e-3]<<8|c[e-2]<<16|c[e-1]<<24)>>>0},ft=function(c){return 10+(c.filename&&c.filename.length+1||0)},mt=function(c,e){var i=e.level,s=i==0?0:i<6?1:i==9?3:2;c[0]=120,c[1]=s<<6|(s?32-2*s:1)},bt=function(c){if((15&c[0])!=8||c[0]>>>4>7||(c[0]<<8|c[1])%31)throw"invalid zlib data";if(32&c[1])throw"invalid zlib data: preset dictionaries not supported"};function Mt(c,e){return e||typeof c!="function"||(e=c,c={}),this.ondata=e,c}var St=function(){function c(e,i){i||typeof e!="function"||(i=e,e={}),this.ondata=i,this.o=e||{}}return c.prototype.p=function(e,i){this.ondata(qA(e,this.o,0,0,!i),i)},c.prototype.push=function(e,i){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=i,this.p(e,i||!1)},c}(),It=function(){return function(c,e){ut([uw,function(){return[Bm,St]}],this,Mt.call(this,c,e),function(i){var s=new St(i.data);onmessage=Bm(s)},6)}}();function Bt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[uw],function(s){return q_(Dt(s.data[0],s.data[1]))},0,i)}function Dt(c,e){return qA(c,e||{},0,0)}var Ut=function(){function c(e){this.s={},this.p=new oo(0),this.ondata=e}return c.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var i=this.p.length,s=new oo(i+e.length);s.set(this.p),s.set(e,i),this.p=s},c.prototype.c=function(e){this.d=this.s.i=e||!1;var i=this.s.b,s=WA(this.p,this.o,this.s);this.ondata(dp(s,i,this.s.b),this.d),this.o=dp(s,this.s.b-32768),this.s.b=this.o.length,this.p=dp(this.p,this.s.p/8|0),this.s.p&=7},c.prototype.push=function(e,i){this.e(e),this.c(i)},c}(),Ft=function(){return function(c){this.ondata=c,ut([cw,function(){return[Bm,Ut]}],this,0,function(){var e=new Ut;onmessage=Bm(e)},7)}}();function zt(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[cw],function(s){return q_(Kt(s.data[0],HC(s.data[1])))},1,i)}function Kt(c,e){return WA(c,e)}var tn=function(){function c(e,i){this.c=lw(),this.l=0,this.v=1,St.call(this,e,i)}return c.prototype.push=function(e,i){St.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e),this.l+=e.length;var s=qA(e,this.o,this.v&&ft(this.o),i&&8,!i);this.v&&(rt(s,this.o),this.v=0),i&&(_e(s,s.length-8,this.c.d()),_e(s,s.length-4,this.l)),this.ondata(s,i)},c}(),sn=function(){return function(c,e){ut([uw,aI,function(){return[Bm,St,tn]}],this,Mt.call(this,c,e),function(i){var s=new tn(i.data);onmessage=Bm(s)},8)}}();function ln(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[uw,aI,function(){return[kn]}],function(s){return q_(kn(s.data[0],s.data[1]))},2,i)}function kn(c,e){e||(e={});var i=lw(),s=c.length;i.p(c);var a=qA(c,e,ft(e),8),h=a.length;return rt(a,e),_e(a,h-8,i.d()),_e(a,h-4,s),a}var Ln=function(){function c(e){this.v=1,Ut.call(this,e)}return c.prototype.push=function(e,i){if(Ut.prototype.e.call(this,e),this.v){var s=this.p.length>3?at(this.p):4;if(s>=this.p.length&&!i)return;this.p=this.p.subarray(s),this.v=0}if(i){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Ut.prototype.c.call(this,i)},c}(),qn=function(){return function(c){this.ondata=c,ut([cw,lI,function(){return[Bm,Ut,Ln]}],this,0,function(){var e=new Ln;onmessage=Bm(e)},9)}}();function Kn(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[cw,lI,function(){return[Un]}],function(s){return q_(Un(s.data[0]))},3,i)}function Un(c,e){return WA(c.subarray(at(c),-8),e||new oo(ct(c)))}var vr=function(){function c(e,i){this.c=GC(),this.v=1,St.call(this,e,i)}return c.prototype.push=function(e,i){St.prototype.push.call(this,e,i)},c.prototype.p=function(e,i){this.c.p(e);var s=qA(e,this.o,this.v&&2,i&&4,!i);this.v&&(mt(s,this.o),this.v=0),i&&_e(s,s.length-4,this.c.d()),this.ondata(s,i)},c}(),Pr=function(){return function(c,e){ut([uw,cI,function(){return[Bm,St,vr]}],this,Mt.call(this,c,e),function(i){var s=new vr(i.data);onmessage=Bm(s)},10)}}();function mr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[uw,cI,function(){return[Qr]}],function(s){return q_(Qr(s.data[0],s.data[1]))},4,i)}function Qr(c,e){e||(e={});var i=GC();i.p(c);var s=qA(c,e,2,4);return mt(s,e),_e(s,s.length-4,i.d()),s}var Gr=function(){function c(e){this.v=1,Ut.call(this,e)}return c.prototype.push=function(e,i){if(Ut.prototype.e.call(this,e),this.v){if(this.p.length<2&&!i)return;this.p=this.p.subarray(2),this.v=0}if(i){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Ut.prototype.c.call(this,i)},c}(),lr=function(){return function(c){this.ondata=c,ut([cw,uI,function(){return[Bm,Ut,Gr]}],this,0,function(){var e=new Gr;onmessage=Bm(e)},11)}}();function dr(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return hw(c,e,[cw,uI,function(){return[Or]}],function(s){return q_(Or(s.data[0],HC(s.data[1])))},5,i)}function Or(c,e){return WA((bt(c),c.subarray(2,-4)),e)}var _r=function(){function c(e){this.G=Ln,this.I=Ut,this.Z=Gr,this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,i);else{if(this.p&&this.p.length){var s=new oo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var a=this,h=function(){a.ondata.apply(a,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(h):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(h):new this.Z(h),this.s.push(this.p,i),this.p=null}}},c}(),Vr=function(){function c(e){this.G=qn,this.I=Ft,this.Z=lr,this.ondata=e}return c.prototype.push=function(e,i){_r.prototype.push.call(this,e,i)},c}();function fs(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";return c[0]==31&&c[1]==139&&c[2]==8?Kn(c,e,i):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?zt(c,e,i):dr(c,e,i)}function Ks(c,e){return c[0]==31&&c[1]==139&&c[2]==8?Un(c,e):(15&c[0])!=8||c[0]>>4>7||(c[0]<<8|c[1])%31?Kt(c,e):Or(c,e)}var gs=function(c,e,i,s){for(var a in c){var h=c[a],d=e+a;h instanceof oo?i[d]=[h,s]:Array.isArray(h)?i[d]=[h[0],jx(s,h[1])]:gs(h,d+"/",i,s)}},Qs=typeof TextEncoder<"u"&&new TextEncoder,In=typeof TextDecoder<"u"&&new TextDecoder,yn=0;try{In.decode($0,{stream:!0}),yn=1}catch{}var tr=function(c){for(var e="",i=0;;){var s=c[i++],a=(s>127)+(s>223)+(s>239);if(i+a>c.length)return[e,dp(c,i-1)];a?a==3?(s=((15&s)<<18|(63&c[i++])<<12|(63&c[i++])<<6|63&c[i++])-65536,e+=String.fromCharCode(55296|s>>10,56320|1023&s)):e+=1&a?String.fromCharCode((31&s)<<6|63&c[i++]):String.fromCharCode((15&s)<<12|(63&c[i++])<<6|63&c[i++]):e+=String.fromCharCode(s)}},Wn=function(){function c(e){this.ondata=e,yn?this.t=new TextDecoder:this.p=$0}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(i=!!i,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),i),i){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var s=new oo(this.p.length+e.length);s.set(this.p),s.set(e,this.p.length);var a=tr(s),h=a[0],d=a[1];if(i){if(d.length)throw"invalid utf-8 data";this.p=null}else this.p=d;this.ondata(h,i)}},c}(),Dn=function(){function c(e){this.ondata=e}return c.prototype.push=function(e,i){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Gn(e),this.d=i||!1)},c}();function Gn(c,e){if(e){for(var i=new oo(c.length),s=0;s<c.length;++s)i[s]=c.charCodeAt(s);return i}if(Qs)return Qs.encode(c);var a=c.length,h=new oo(c.length+(c.length>>1)),d=0,_=function(it){h[d++]=it};for(s=0;s<a;++s){if(d+5>h.length){var et=new oo(d+8+(a-s<<1));et.set(h),h=et}var nt=c.charCodeAt(s);nt<128||e?_(nt):nt<2048?(_(192|nt>>6),_(128|63&nt)):nt>55295&&nt<57344?(_(240|(nt=65536+(1047552&nt)|1023&c.charCodeAt(++s))>>18),_(128|nt>>12&63),_(128|nt>>6&63),_(128|63&nt)):(_(224|nt>>12),_(128|nt>>6&63),_(128|63&nt))}return dp(h,0,d)}function ur(c,e){if(e){for(var i="",s=0;s<c.length;s+=16384)i+=String.fromCharCode.apply(null,c.subarray(s,s+16384));return i}if(In)return In.decode(c);var a=tr(c),h=a[0];if(a[1].length)throw"invalid utf-8 data";return h}var Jt=function(c){return c==1?3:c<6?2:c==9?1:0},hr=function(c,e){return e+30+o(c,e+26)+o(c,e+28)},Zn=function(c,e,i){var s=o(c,e+28),a=ur(c.subarray(e+46,e+46+s),!(2048&o(c,e+8))),h=e+46+s,d=g(c,e+20),_=i&&d==4294967295?gr(c,h):[d,g(c,e+24),g(c,e+42)],et=_[0],nt=_[1],it=_[2];return[o(c,e+10),et,nt,a,h+o(c,e+30)+o(c,e+32),it]},gr=function(c,e){for(;o(c,e)!=1;e+=4+o(c,e+2));return[$(c,e+12),$(c,e+4),$(c,e+20)]},wr=function(c){var e=0;if(c)for(var i in c){var s=c[i].length;if(s>65535)throw"extra field too long";e+=s+4}return e},Xr=function(c,e,i,s,a,h,d,_){var et=s.length,nt=i.extra,it=_&&_.length,lt=wr(nt);_e(c,e,d!=null?33639248:67324752),e+=4,d!=null&&(c[e++]=20,c[e++]=i.os),c[e]=20,e+=2,c[e++]=i.flag<<1|(h==null&&8),c[e++]=a&&8,c[e++]=255&i.compression,c[e++]=i.compression>>8;var dt=new Date(i.mtime==null?Date.now():i.mtime),pt=dt.getFullYear()-1980;if(pt<0||pt>119)throw"date not in range 1980-2099";if(_e(c,e,pt<<25|dt.getMonth()+1<<21|dt.getDate()<<16|dt.getHours()<<11|dt.getMinutes()<<5|dt.getSeconds()>>>1),e+=4,h!=null&&(_e(c,e,i.crc),_e(c,e+4,h),_e(c,e+8,i.size)),_e(c,e+12,et),_e(c,e+14,lt),e+=16,d!=null&&(_e(c,e,it),_e(c,e+6,i.attrs),_e(c,e+10,d),e+=14),c.set(s,e),e+=et,lt)for(var gt in nt){var vt=nt[gt],Ct=vt.length;_e(c,e,+gt),_e(c,e+2,Ct),c.set(vt,e+4),e+=4+Ct}return it&&(c.set(_,e),e+=it),e},vs=function(c,e,i,s,a){_e(c,e,101010256),_e(c,e+8,i),_e(c,e+10,i),_e(c,e+12,s),_e(c,e+16,a)},Cs=function(){function c(e){this.filename=e,this.c=lw(),this.size=0,this.compression=0}return c.prototype.process=function(e,i){this.ondata(null,e,i)},c.prototype.push=function(e,i){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,i&&(this.crc=this.c.d()),this.process(e,i||!1)},c}(),js=function(){function c(e,i){var s=this;i||(i={}),Cs.call(this,e),this.d=new St(i,function(a,h){s.ondata(null,a,h)}),this.compression=8,this.flag=Jt(i.level)}return c.prototype.process=function(e,i){try{this.d.push(e,i)}catch(s){this.ondata(s,null,i)}},c.prototype.push=function(e,i){Cs.prototype.push.call(this,e,i)},c}(),bs=function(){function c(e,i){var s=this;i||(i={}),Cs.call(this,e),this.d=new It(i,function(a,h,d){s.ondata(a,h,d)}),this.compression=8,this.flag=Jt(i.level),this.terminate=this.d.terminate}return c.prototype.process=function(e,i){this.d.push(e,i)},c.prototype.push=function(e,i){Cs.prototype.push.call(this,e,i)},c}(),Ms=function(){function c(e){this.ondata=e,this.u=[],this.d=1}return c.prototype.add=function(e){var i=this;if(2&this.d)throw"stream finished";var s=Gn(e.filename),a=s.length,h=e.comment,d=h&&Gn(h),_=a!=e.filename.length||d&&h.length!=d.length,et=a+wr(e.extra)+30;if(a>65535)throw"filename too long";var nt=new oo(et);Xr(nt,0,e,s,_);var it=[nt],lt=function(){for(var Ct=0,wt=it;Ct<wt.length;Ct++){var xt=wt[Ct];i.ondata(null,xt,!1)}it=[]},dt=this.d;this.d=0;var pt=this.u.length,gt=jx(e,{f:s,u:_,o:d,t:function(){e.terminate&&e.terminate()},r:function(){if(lt(),dt){var Ct=i.u[pt+1];Ct?Ct.r():i.d=1}dt=1}}),vt=0;e.ondata=function(Ct,wt,xt){if(Ct)i.ondata(Ct,wt,xt),i.terminate();else if(vt+=wt.length,it.push(wt),xt){var _t=new oo(16);_e(_t,0,134695760),_e(_t,4,e.crc),_e(_t,8,vt),_e(_t,12,e.size),it.push(_t),gt.c=vt,gt.b=et+vt+16,gt.crc=e.crc,gt.size=e.size,dt&&gt.r(),dt=1}else dt&&lt()},this.u.push(gt)},c.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},c.prototype.e=function(){for(var e=0,i=0,s=0,a=0,h=this.u;a<h.length;a++)s+=46+(nt=h[a]).f.length+wr(nt.extra)+(nt.o?nt.o.length:0);for(var d=new oo(s+22),_=0,et=this.u;_<et.length;_++){var nt=et[_];Xr(d,e,nt,nt.f,nt.u,nt.c,i,nt.o),e+=46+nt.f.length+wr(nt.extra)+(nt.o?nt.o.length:0),i+=nt.b}vs(d,e,this.u.length,s,i),this.ondata(null,d,!0),this.d=2},c.prototype.terminate=function(){for(var e=0,i=this.u;e<i.length;e++)i[e].t();this.d=2},c}();function Eo(c,e,i){if(i||(i=e,e={}),typeof i!="function")throw"no callback";var s={};gs(c,"",s,e);var a=Object.keys(s),h=a.length,d=0,_=0,et=h,nt=new Array(h),it=[],lt=function(){for(var vt=0;vt<it.length;++vt)it[vt]()},dt=function(){var vt=new oo(_+22),Ct=d,wt=_-d;_=0;for(var xt=0;xt<et;++xt){var _t=nt[xt];try{var Pt=_t.c.length;Xr(vt,_,_t,_t.f,_t.u,Pt);var Rt=30+_t.f.length+wr(_t.extra),Lt=_+Rt;vt.set(_t.c,Lt),Xr(vt,d,_t,_t.f,_t.u,Pt,_,_t.m),d+=16+Rt+(_t.m?_t.m.length:0),_=Lt+Pt}catch(Ot){return i(Ot,null)}}vs(vt,d,nt.length,wt,Ct),i(null,vt)};h||dt();for(var pt=function(vt){var Ct=a[vt],wt=s[Ct],xt=wt[0],_t=wt[1],Pt=lw(),Rt=xt.length;Pt.p(xt);var Lt=Gn(Ct),Ot=Lt.length,qt=_t.comment,en=qt&&Gn(qt),cn=en&&en.length,An=wr(_t.extra),fn=_t.level==0?0:8,Tn=function(gn,xn){if(gn)lt(),i(gn,null);else{var Nn=xn.length;nt[vt]=jx(_t,{size:Rt,crc:Pt.d(),c:xn,f:Lt,m:en,u:Ot!=Ct.length||en&&qt.length!=cn,compression:fn}),d+=30+Ot+An+Nn,_+=76+2*(Ot+An)+(cn||0)+Nn,--h||dt()}};if(Ot>65535&&Tn("filename too long",null),fn)if(Rt<16e4)try{Tn(null,Dt(xt,_t))}catch(gn){Tn(gn,null)}else it.push(Bt(xt,_t,Tn));else Tn(null,xt)},gt=0;gt<et;++gt)pt(gt);return lt}function lm(c,e){e||(e={});var i={},s=[];gs(c,"",i,e);var a=0,h=0;for(var d in i){var _=i[d],et=_[0],nt=_[1],it=nt.level==0?0:8,lt=(Ot=Gn(d)).length,dt=nt.comment,pt=dt&&Gn(dt),gt=pt&&pt.length,vt=wr(nt.extra);if(lt>65535)throw"filename too long";var Ct=it?Dt(et,nt):et,wt=Ct.length,xt=lw();xt.p(et),s.push(jx(nt,{size:et.length,crc:xt.d(),c:Ct,f:Ot,m:pt,u:lt!=d.length||pt&&dt.length!=gt,o:a,compression:it})),a+=30+lt+vt+wt,h+=76+2*(lt+vt)+(gt||0)+wt}for(var _t=new oo(h+22),Pt=a,Rt=h-a,Lt=0;Lt<s.length;++Lt){var Ot=s[Lt];Xr(_t,Ot.o,Ot,Ot.f,Ot.u,Ot.c.length);var qt=30+Ot.f.length+wr(Ot.extra);_t.set(Ot.c,Ot.o+qt),Xr(_t,a,Ot,Ot.f,Ot.u,Ot.c.length,Ot.o,Ot.m),a+=16+qt+(Ot.m?Ot.m.length:0)}return vs(_t,a,s.length,Rt,Pt),_t}var Us=function(){function c(){}return c.prototype.push=function(e,i){this.ondata(null,e,i)},c.compression=0,c}(),Do=function(){function c(){var e=this;this.i=new Ut(function(i,s){e.ondata(null,i,s)})}return c.prototype.push=function(e,i){try{this.i.push(e,i)}catch(s){this.ondata(s,e,i)}},c.compression=8,c}(),Po=function(){function c(e,i){var s=this;i<32e4?this.i=new Ut(function(a,h){s.ondata(null,a,h)}):(this.i=new Ft(function(a,h,d){s.ondata(a,h,d)}),this.terminate=this.i.terminate)}return c.prototype.push=function(e,i){this.i.terminate&&(e=dp(e,0)),this.i.push(e,i)},c.compression=8,c}(),zE=function(){function c(e){this.onfile=e,this.k=[],this.o={0:Us},this.p=$0}return c.prototype.push=function(e,i){var s=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var a=Math.min(this.c,e.length),h=e.subarray(0,a);if(this.c-=a,this.d?this.d.push(h,!this.c):this.k[0].push(h),(e=e.subarray(a)).length)return this.push(e,i)}else{var d=0,_=0,et=void 0,nt=void 0;this.p.length?e.length?((nt=new oo(this.p.length+e.length)).set(this.p),nt.set(e,this.p.length)):nt=this.p:nt=e;for(var it=nt.length,lt=this.c,dt=lt&&this.d,pt=function(){var Ct,wt=g(nt,_);if(wt==67324752){d=1,et=_,gt.d=null,gt.c=0;var xt=o(nt,_+6),_t=o(nt,_+8),Pt=2048&xt,Rt=8&xt,Lt=o(nt,_+26),Ot=o(nt,_+28);if(it>_+30+Lt+Ot){var qt=[];gt.k.unshift(qt),d=2;var en,cn=g(nt,_+18),An=g(nt,_+22),fn=ur(nt.subarray(_+30,_+=30+Lt),!Pt);cn==4294967295?(Ct=Rt?[-2]:gr(nt,_),cn=Ct[0],An=Ct[1]):Rt&&(cn=-1),_+=Ot,gt.c=cn;var Tn={name:fn,compression:_t,start:function(){if(!Tn.ondata)throw"no callback";if(cn){var gn=s.o[_t];if(!gn)throw"unknown compression type "+_t;(en=cn<0?new gn(fn):new gn(fn,cn,An)).ondata=function(Hn,rr,cr){Tn.ondata(Hn,rr,cr)};for(var xn=0,Nn=qt;xn<Nn.length;xn++){var Mn=Nn[xn];en.push(Mn,!1)}s.k[0]==qt&&s.c?s.d=en:en.push($0,!0)}else Tn.ondata(null,$0,!0)},terminate:function(){en&&en.terminate&&en.terminate()}};cn>=0&&(Tn.size=cn,Tn.originalSize=An),gt.onfile(Tn)}return"break"}if(lt){if(wt==134695760)return et=_+=12+(lt==-2&&8),d=3,gt.c=0,"break";if(wt==33639248)return et=_-=4,d=3,gt.c=0,"break"}},gt=this;_<it-4&&pt()!=="break";++_);if(this.p=$0,lt<0){var vt=d?nt.subarray(0,et-12-(lt==-2&&8)-(g(nt,et-16)==134695760&&4)):nt.subarray(0,_);dt?dt.push(vt,!!d):this.k[+(d==2)].push(vt)}if(2&d)return this.push(nt.subarray(_),i);this.p=nt.subarray(_)}if(i){if(this.c)throw"invalid zip file";this.p=null}},c.prototype.register=function(e){this.o[e.compression]=e},c}();function $r(c,e){if(typeof e!="function")throw"no callback";for(var i=[],s=function(){for(var dt=0;dt<i.length;++dt)i[dt]()},a={},h=c.length-22;g(c,h)!=101010256;--h)if(!h||c.length-h>65558)return void e("invalid zip file",null);var d=o(c,h+8);d||e(null,{});var _=d,et=g(c,h+16),nt=et==4294967295;if(nt){if(h=g(c,h-12),g(c,h)!=101075792)return void e("invalid zip file",null);_=d=g(c,h+32),et=g(c,h+48)}for(var it=function(dt){var pt=Zn(c,et,nt),gt=pt[0],vt=pt[1],Ct=pt[2],wt=pt[3],xt=pt[4],_t=pt[5],Pt=hr(c,_t);et=xt;var Rt=function(Ot,qt){Ot?(s(),e(Ot,null)):(a[wt]=qt,--d||e(null,a))};if(gt)if(gt==8){var Lt=c.subarray(Pt,Pt+vt);if(vt<32e4)try{Rt(null,Kt(Lt,new oo(Ct)))}catch(Ot){Rt(Ot,null)}else i.push(zt(Lt,{size:Ct},Rt))}else Rt("unknown compression type "+gt,null);else Rt(null,dp(c,Pt,Pt+vt))},lt=0;lt<_;++lt)it();return s}function hI(c){for(var e={},i=c.length-22;g(c,i)!=101010256;--i)if(!i||c.length-i>65558)throw"invalid zip file";var s=o(c,i+8);if(!s)return{};var a=g(c,i+16),h=a==4294967295;if(h){if(i=g(c,i-12),g(c,i)!=101075792)throw"invalid zip file";s=g(c,i+32),a=g(c,i+48)}for(var d=0;d<s;++d){var _=Zn(c,a,h),et=_[0],nt=_[1],it=_[2],lt=_[3],dt=_[4],pt=_[5],gt=hr(c,pt);if(a=dt,et){if(et!=8)throw"unknown compression type "+et;e[lt]=Kt(c.subarray(gt,gt+nt),new oo(it))}else e[lt]=dp(c,gt,gt+nt)}return e}class dI extends b.yxD{constructor(e){super(e),this.type=b.cLu}parse(e){const h=Math.pow(2.7182818,2.2),d={l:0,c:0,lc:0};function _(nn,On,on,Qn,Jn){for(;on<nn;)On=On<<8|xr(Qn,Jn),on+=8;on-=nn,d.l=On>>on&(1<<nn)-1,d.c=On,d.lc=on}const et=new Array(59);function nt(nn){return 63&nn}function it(nn){return nn>>6}const lt={c:0,lc:0};function dt(nn,On,on,Qn){nn=nn<<8|xr(on,Qn),On+=8,lt.c=nn,lt.lc=On}const pt={c:0,lc:0};function gt(nn,On,on,Qn,Jn,Vn,sr,Fr,Jr){if(nn==On){Qn<8&&(dt(on,Qn,Jn,Vn),on=lt.c,Qn=lt.lc);let rs=on>>(Qn-=8);if(rs=new Uint8Array([rs])[0],Fr.value+rs>Jr)return!1;const is=sr[Fr.value-1];for(;rs-- >0;)sr[Fr.value++]=is}else{if(!(Fr.value<Jr))return!1;sr[Fr.value++]=nn}pt.c=on,pt.lc=Qn}function vt(nn){return 65535&nn}function Ct(nn){const On=vt(nn);return On>32767?On-65536:On}const wt={a:0,b:0};function xt(nn,On){const on=Ct(nn),Qn=Ct(On),Jn=on+(1&Qn)+(Qn>>1),Vn=Jn,sr=Jn-Qn;wt.a=Vn,wt.b=sr}function _t(nn,On){const on=vt(nn),Qn=vt(On),Jn=on-(Qn>>1)&65535,Vn=Qn+Jn-32768&65535;wt.a=Vn,wt.b=Jn}function Pt(nn,On,on,Qn,Jn,Vn,sr){const Fr=sr<16384,Jr=on>Jn?Jn:on;let rs,is,as=1;for(;as<=Jr;)as<<=1;for(as>>=1,rs=as,as>>=1;as>=1;){is=0;const es=is+Vn*(Jn-rs),Zr=Vn*as,ms=Vn*rs,Wr=Qn*as,_s=Qn*rs;let xs,Ps,Al,Vo;for(;is<=es;is+=ms){let As=is;const Os=is+Qn*(on-rs);for(;As<=Os;As+=_s){const ro=As+Wr,Gu=As+Zr,Qm=Gu+Wr;Fr?(xt(nn[As+On],nn[Gu+On]),xs=wt.a,Al=wt.b,xt(nn[ro+On],nn[Qm+On]),Ps=wt.a,Vo=wt.b,xt(xs,Ps),nn[As+On]=wt.a,nn[ro+On]=wt.b,xt(Al,Vo),nn[Gu+On]=wt.a,nn[Qm+On]=wt.b):(_t(nn[As+On],nn[Gu+On]),xs=wt.a,Al=wt.b,_t(nn[ro+On],nn[Qm+On]),Ps=wt.a,Vo=wt.b,_t(xs,Ps),nn[As+On]=wt.a,nn[ro+On]=wt.b,_t(Al,Vo),nn[Gu+On]=wt.a,nn[Qm+On]=wt.b)}if(on&as){const ro=As+Zr;Fr?xt(nn[As+On],nn[ro+On]):_t(nn[As+On],nn[ro+On]),xs=wt.a,nn[ro+On]=wt.b,nn[As+On]=xs}}if(Jn&as){let As=is;const Os=is+Qn*(on-rs);for(;As<=Os;As+=_s){const ro=As+Wr;Fr?xt(nn[As+On],nn[ro+On]):_t(nn[As+On],nn[ro+On]),xs=wt.a,nn[ro+On]=wt.b,nn[As+On]=xs}}rs=as,as>>=1}return is}function Rt(nn,On,on,Qn,Jn,Vn){const sr=on.value,Fr=_i(On,on),Jr=_i(On,on);on.value+=4;const rs=_i(On,on);if(on.value+=4,Fr<0||Fr>=65537||Jr<0||Jr>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const is=new Array(65537),as=new Array(16384);if(function(es){for(let Zr=0;Zr<16384;Zr++)es[Zr]={},es[Zr].len=0,es[Zr].lit=0,es[Zr].p=null}(as),function(es,Zr,ms,Wr,_s,xs){const Ps=Zr;let Al=0,Vo=0;for(;Wr<=_s;Wr++){if(Ps.value-Zr.value>ms)return!1;_(6,Al,Vo,es,Ps);const As=d.l;if(Al=d.c,Vo=d.lc,xs[Wr]=As,As==63){if(Ps.value-Zr.value>ms)throw new Error("Something wrong with hufUnpackEncTable");_(8,Al,Vo,es,Ps);let Os=d.l+6;if(Al=d.c,Vo=d.lc,Wr+Os>_s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Os--;)xs[Wr++]=0;Wr--}else if(As>=59){let Os=As-59+2;if(Wr+Os>_s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Os--;)xs[Wr++]=0;Wr--}}(function(As){for(let ro=0;ro<=58;++ro)et[ro]=0;for(let ro=0;ro<65537;++ro)et[As[ro]]+=1;let Os=0;for(let ro=58;ro>0;--ro){const Gu=Os+et[ro]>>1;et[ro]=Os,Os=Gu}for(let ro=0;ro<65537;++ro){const Gu=As[ro];Gu>0&&(As[ro]=Gu|et[Gu]++<<6)}})(xs)}(nn,on,Qn-(on.value-sr),Fr,Jr,is),rs>8*(Qn-(on.value-sr)))throw new Error("Something wrong with hufUncompress");(function(es,Zr,ms,Wr){for(;Zr<=ms;Zr++){const _s=it(es[Zr]),xs=nt(es[Zr]);if(_s>>xs)throw new Error("Invalid table entry");if(xs>14){const Ps=Wr[_s>>xs-14];if(Ps.len)throw new Error("Invalid table entry");if(Ps.lit++,Ps.p){const Al=Ps.p;Ps.p=new Array(Ps.lit);for(let Vo=0;Vo<Ps.lit-1;++Vo)Ps.p[Vo]=Al[Vo]}else Ps.p=new Array(1);Ps.p[Ps.lit-1]=Zr}else if(xs){let Ps=0;for(let Al=1<<14-xs;Al>0;Al--){const Vo=Wr[(_s<<14-xs)+Ps];if(Vo.len||Vo.p)throw new Error("Invalid table entry");Vo.len=xs,Vo.lit=Zr,Ps++}}}})(is,Fr,Jr,as),function(es,Zr,ms,Wr,_s,xs,Ps,Al,Vo){let As=0,Os=0;const ro=Ps,Gu=Math.trunc(Wr.value+(_s+7)/8);for(;Wr.value<Gu;)for(dt(As,Os,ms,Wr),As=lt.c,Os=lt.lc;Os>=14;){const np=Zr[As>>Os-14&16383];if(np.len)Os-=np.len,gt(np.lit,xs,As,Os,ms,Wr,Al,Vo,ro),As=pt.c,Os=pt.lc;else{if(!np.p)throw new Error("hufDecode issues");let oy;for(oy=0;oy<np.lit;oy++){const m1=nt(es[np.p[oy]]);for(;Os<m1&&Wr.value<Gu;)dt(As,Os,ms,Wr),As=lt.c,Os=lt.lc;if(Os>=m1&&it(es[np.p[oy]])==(As>>Os-m1&(1<<m1)-1)){Os-=m1,gt(np.p[oy],xs,As,Os,ms,Wr,Al,Vo,ro),As=pt.c,Os=pt.lc;break}}if(oy==np.lit)throw new Error("hufDecode issues")}}const Qm=8-_s&7;for(As>>=Qm,Os-=Qm;Os>0;){const np=Zr[As<<14-Os&16383];if(!np.len)throw new Error("hufDecode issues");Os-=np.len,gt(np.lit,xs,As,Os,ms,Wr,Al,Vo,ro),As=pt.c,Os=pt.lc}}(is,as,nn,on,rs,Jr,Vn,Jn,{value:0})}function Lt(nn){for(let On=1;On<nn.length;On++){const on=nn[On-1]+nn[On]-128;nn[On]=on}}function Ot(nn,On){let on=0,Qn=Math.floor((nn.length+1)/2),Jn=0;const Vn=nn.length-1;for(;!(Jn>Vn||(On[Jn++]=nn[on++],Jn>Vn));)On[Jn++]=nn[Qn++]}function qt(nn){let On=nn.byteLength;const on=new Array;let Qn=0;const Jn=new DataView(nn);for(;On>0;){const Vn=Jn.getInt8(Qn++);if(Vn<0){const sr=-Vn;On-=sr+1;for(let Fr=0;Fr<sr;Fr++)on.push(Jn.getUint8(Qn++))}else{const sr=Vn;On-=2;const Fr=Jn.getUint8(Qn++);for(let Jr=0;Jr<sr+1;Jr++)on.push(Fr)}}return on}function en(nn,On,on){let Qn,Jn=1;for(;Jn<64;)Qn=On[nn.value],Qn==65280?Jn=64:Qn>>8==255?Jn+=255&Qn:(on[Jn]=Qn,Jn++),nn.value++}function cn(nn){const On=.5*Math.cos(.7853975),on=.5*Math.cos(3.14159/16),Qn=.5*Math.cos(3.14159/8),Jn=.5*Math.cos(3*3.14159/16),Vn=.5*Math.cos(.981746875),sr=.5*Math.cos(3*3.14159/8),Fr=.5*Math.cos(1.374445625),Jr=new Array(4),rs=new Array(4),is=new Array(4),as=new Array(4);for(let es=0;es<8;++es){const Zr=8*es;Jr[0]=Qn*nn[Zr+2],Jr[1]=sr*nn[Zr+2],Jr[2]=Qn*nn[Zr+6],Jr[3]=sr*nn[Zr+6],rs[0]=on*nn[Zr+1]+Jn*nn[Zr+3]+Vn*nn[Zr+5]+Fr*nn[Zr+7],rs[1]=Jn*nn[Zr+1]-Fr*nn[Zr+3]-on*nn[Zr+5]-Vn*nn[Zr+7],rs[2]=Vn*nn[Zr+1]-on*nn[Zr+3]+Fr*nn[Zr+5]+Jn*nn[Zr+7],rs[3]=Fr*nn[Zr+1]-Vn*nn[Zr+3]+Jn*nn[Zr+5]-on*nn[Zr+7],is[0]=On*(nn[Zr+0]+nn[Zr+4]),is[3]=On*(nn[Zr+0]-nn[Zr+4]),is[1]=Jr[0]+Jr[3],is[2]=Jr[1]-Jr[2],as[0]=is[0]+is[1],as[1]=is[3]+is[2],as[2]=is[3]-is[2],as[3]=is[0]-is[1],nn[Zr+0]=as[0]+rs[0],nn[Zr+1]=as[1]+rs[1],nn[Zr+2]=as[2]+rs[2],nn[Zr+3]=as[3]+rs[3],nn[Zr+4]=as[3]-rs[3],nn[Zr+5]=as[2]-rs[2],nn[Zr+6]=as[1]-rs[1],nn[Zr+7]=as[0]-rs[0]}for(let es=0;es<8;++es)Jr[0]=Qn*nn[16+es],Jr[1]=sr*nn[16+es],Jr[2]=Qn*nn[48+es],Jr[3]=sr*nn[48+es],rs[0]=on*nn[8+es]+Jn*nn[24+es]+Vn*nn[40+es]+Fr*nn[56+es],rs[1]=Jn*nn[8+es]-Fr*nn[24+es]-on*nn[40+es]-Vn*nn[56+es],rs[2]=Vn*nn[8+es]-on*nn[24+es]+Fr*nn[40+es]+Jn*nn[56+es],rs[3]=Fr*nn[8+es]-Vn*nn[24+es]+Jn*nn[40+es]-on*nn[56+es],is[0]=On*(nn[es]+nn[32+es]),is[3]=On*(nn[es]-nn[32+es]),is[1]=Jr[0]+Jr[3],is[2]=Jr[1]-Jr[2],as[0]=is[0]+is[1],as[1]=is[3]+is[2],as[2]=is[3]-is[2],as[3]=is[0]-is[1],nn[0+es]=as[0]+rs[0],nn[8+es]=as[1]+rs[1],nn[16+es]=as[2]+rs[2],nn[24+es]=as[3]+rs[3],nn[32+es]=as[3]-rs[3],nn[40+es]=as[2]-rs[2],nn[48+es]=as[1]-rs[1],nn[56+es]=as[0]-rs[0]}function An(nn){for(let On=0;On<64;++On){const on=nn[0][On],Qn=nn[1][On],Jn=nn[2][On];nn[0][On]=on+1.5747*Jn,nn[1][On]=on-.1873*Qn-.4682*Jn,nn[2][On]=on+1.8556*Qn}}function fn(nn,On,on){for(let Jn=0;Jn<64;++Jn)On[on+Jn]=b.A5E.toHalfFloat((Qn=nn[Jn])<=1?Math.sign(Qn)*Math.pow(Math.abs(Qn),2.2):Math.sign(Qn)*Math.pow(h,Math.abs(Qn)-1));var Qn}function Tn(nn){return new DataView(nn.array.buffer,nn.offset.value,nn.size)}function gn(nn){const On=nn.viewer.buffer.slice(nn.offset.value,nn.offset.value+nn.size),on=new Uint8Array(qt(On)),Qn=new Uint8Array(on.length);return Lt(on),Ot(on,Qn),new DataView(Qn.buffer)}function xn(nn){const On=nn.array.slice(nn.offset.value,nn.offset.value+nn.size);tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const on=Or(On),Qn=new Uint8Array(on.length);return Lt(on),Ot(on,Qn),new DataView(Qn.buffer)}function Nn(nn){const On=nn.viewer,on={value:nn.offset.value},Qn=new Uint16Array(nn.width*nn.scanlineBlockSize*(nn.channels*nn.type)),Jn=new Uint8Array(8192);let Vn=0;const sr=new Array(nn.channels);for(let ms=0;ms<nn.channels;ms++)sr[ms]={},sr[ms].start=Vn,sr[ms].end=sr[ms].start,sr[ms].nx=nn.width,sr[ms].ny=nn.lines,sr[ms].size=nn.type,Vn+=sr[ms].nx*sr[ms].ny*sr[ms].size;const Fr=Bs(On,on),Jr=Bs(On,on);if(Jr>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Fr<=Jr)for(let ms=0;ms<Jr-Fr+1;ms++)Jn[ms+Fr]=Mr(On,on);const rs=new Uint16Array(65536),is=function(ms,Wr){let _s=0;for(let Ps=0;Ps<65536;++Ps)(Ps==0||ms[Ps>>3]&1<<(7&Ps))&&(Wr[_s++]=Ps);const xs=_s-1;for(;_s<65536;)Wr[_s++]=0;return xs}(Jn,rs),as=_i(On,on);Rt(nn.array,On,on,as,Qn,Vn);for(let ms=0;ms<nn.channels;++ms){const Wr=sr[ms];for(let _s=0;_s<sr[ms].size;++_s)Pt(Qn,Wr.start+_s,Wr.nx,Wr.size,Wr.ny,Wr.nx*Wr.size,is)}(function(ms,Wr,_s){for(let xs=0;xs<_s;++xs)Wr[xs]=ms[Wr[xs]]})(rs,Qn,Vn);let es=0;const Zr=new Uint8Array(Qn.buffer.byteLength);for(let ms=0;ms<nn.lines;ms++)for(let Wr=0;Wr<nn.channels;Wr++){const _s=sr[Wr],xs=_s.nx*_s.size,Ps=new Uint8Array(Qn.buffer,2*_s.end,2*xs);Zr.set(Ps,es),es+=2*xs,_s.end+=xs}return new DataView(Zr.buffer)}function Mn(nn){const On=nn.array.slice(nn.offset.value,nn.offset.value+nn.size);tt===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const on=Or(On),Qn=nn.lines*nn.channels*nn.width,Jn=nn.type==1?new Uint16Array(Qn):new Uint32Array(Qn);let Vn=0,sr=0;const Fr=new Array(4);for(let Jr=0;Jr<nn.lines;Jr++)for(let rs=0;rs<nn.channels;rs++){let is=0;switch(nn.type){case 1:Fr[0]=Vn,Fr[1]=Fr[0]+nn.width,Vn=Fr[1]+nn.width;for(let as=0;as<nn.width;++as)is+=on[Fr[0]++]<<8|on[Fr[1]++],Jn[sr]=is,sr++;break;case 2:Fr[0]=Vn,Fr[1]=Fr[0]+nn.width,Fr[2]=Fr[1]+nn.width,Vn=Fr[2]+nn.width;for(let as=0;as<nn.width;++as)is+=on[Fr[0]++]<<24|on[Fr[1]++]<<16|on[Fr[2]++]<<8,Jn[sr]=is,sr++}}return new DataView(Jn.buffer)}function Hn(nn){const On=nn.viewer,on={value:nn.offset.value},Qn=new Uint8Array(nn.width*nn.lines*(nn.channels*nn.type*2)),Jn={version:Tr(On,on),unknownUncompressedSize:Tr(On,on),unknownCompressedSize:Tr(On,on),acCompressedSize:Tr(On,on),dcCompressedSize:Tr(On,on),rleCompressedSize:Tr(On,on),rleUncompressedSize:Tr(On,on),rleRawSize:Tr(On,on),totalAcUncompressedCount:Tr(On,on),totalDcUncompressedCount:Tr(On,on),acCompression:Tr(On,on)};if(Jn.version<2)throw new Error("EXRLoader.parse: "+Rr.compression+" version "+Jn.version+" is unsupported");const Vn=new Array;let sr=Bs(On,on)-2;for(;sr>0;){const Wr=rr(On.buffer,on),_s=Mr(On,on),xs=_s>>2&3,Ps=new Int8Array([(_s>>4)-1])[0],Al=Mr(On,on);Vn.push({name:Wr,index:Ps,type:Al,compression:xs}),sr-=Wr.length+3}const Fr=Rr.channels,Jr=new Array(nn.channels);for(let Wr=0;Wr<nn.channels;++Wr){const _s=Jr[Wr]={},xs=Fr[Wr];_s.name=xs.name,_s.compression=0,_s.decoded=!1,_s.type=xs.pixelType,_s.pLinear=xs.pLinear,_s.width=nn.width,_s.height=nn.lines}const rs={idx:new Array(3)};for(let Wr=0;Wr<nn.channels;++Wr){const _s=Jr[Wr];for(let xs=0;xs<Vn.length;++xs){const Ps=Vn[xs];_s.name==Ps.name&&(_s.compression=Ps.compression,Ps.index>=0&&(rs.idx[Ps.index]=Wr),_s.offset=Wr)}}let is,as,es;if(Jn.acCompressedSize>0)switch(Jn.acCompression){case 0:is=new Uint16Array(Jn.totalAcUncompressedCount),Rt(nn.array,On,on,Jn.acCompressedSize,is,Jn.totalAcUncompressedCount);break;case 1:const Wr=Or(nn.array.slice(on.value,on.value+Jn.totalAcUncompressedCount));is=new Uint16Array(Wr.buffer),on.value+=Jn.totalAcUncompressedCount}if(Jn.dcCompressedSize>0){const Wr={array:nn.array,offset:on,size:Jn.dcCompressedSize};as=new Uint16Array(xn(Wr).buffer),on.value+=Jn.dcCompressedSize}Jn.rleRawSize>0&&(es=qt(Or(nn.array.slice(on.value,on.value+Jn.rleCompressedSize)).buffer),on.value+=Jn.rleCompressedSize);let Zr=0;const ms=new Array(Jr.length);for(let Wr=0;Wr<ms.length;++Wr)ms[Wr]=new Array;for(let Wr=0;Wr<nn.lines;++Wr)for(let _s=0;_s<Jr.length;++_s)ms[_s].push(Zr),Zr+=Jr[_s].width*nn.type*2;(function(Wr,_s,xs,Ps,Al,Vo){let As=new DataView(Vo.buffer);const Os=xs[Wr.idx[0]].width,ro=xs[Wr.idx[0]].height,Gu=Math.floor(Os/8),Qm=Math.ceil(Os/8),np=Math.ceil(ro/8),oy=Os-8*(Qm-1),m1=ro-8*(np-1),VU={value:0},AR=new Array(3),PM=new Array(3),RM=new Array(3),l_=new Array(3),rD=new Array(3);for(let Ol=0;Ol<3;++Ol)rD[Ol]=_s[Wr.idx[Ol]],AR[Ol]=Ol<1?0:AR[Ol-1]+Qm*np,PM[Ol]=new Float32Array(64),RM[Ol]=new Uint16Array(64),l_[Ol]=new Uint16Array(64*Qm);for(let Ol=0;Ol<np;++Ol){let TS=8;Ol==np-1&&(TS=m1);let IS=8;for(let Wo=0;Wo<Qm;++Wo){Wo==Qm-1&&(IS=oy);for(let Sl=0;Sl<3;++Sl)RM[Sl].fill(0),RM[Sl][0]=Al[AR[Sl]++],en(VU,Ps,RM[Sl]),hs=RM[Sl],(ds=PM[Sl])[0]=pr(hs[0]),ds[1]=pr(hs[1]),ds[2]=pr(hs[5]),ds[3]=pr(hs[6]),ds[4]=pr(hs[14]),ds[5]=pr(hs[15]),ds[6]=pr(hs[27]),ds[7]=pr(hs[28]),ds[8]=pr(hs[2]),ds[9]=pr(hs[4]),ds[10]=pr(hs[7]),ds[11]=pr(hs[13]),ds[12]=pr(hs[16]),ds[13]=pr(hs[26]),ds[14]=pr(hs[29]),ds[15]=pr(hs[42]),ds[16]=pr(hs[3]),ds[17]=pr(hs[8]),ds[18]=pr(hs[12]),ds[19]=pr(hs[17]),ds[20]=pr(hs[25]),ds[21]=pr(hs[30]),ds[22]=pr(hs[41]),ds[23]=pr(hs[43]),ds[24]=pr(hs[9]),ds[25]=pr(hs[11]),ds[26]=pr(hs[18]),ds[27]=pr(hs[24]),ds[28]=pr(hs[31]),ds[29]=pr(hs[40]),ds[30]=pr(hs[44]),ds[31]=pr(hs[53]),ds[32]=pr(hs[10]),ds[33]=pr(hs[19]),ds[34]=pr(hs[23]),ds[35]=pr(hs[32]),ds[36]=pr(hs[39]),ds[37]=pr(hs[45]),ds[38]=pr(hs[52]),ds[39]=pr(hs[54]),ds[40]=pr(hs[20]),ds[41]=pr(hs[22]),ds[42]=pr(hs[33]),ds[43]=pr(hs[38]),ds[44]=pr(hs[46]),ds[45]=pr(hs[51]),ds[46]=pr(hs[55]),ds[47]=pr(hs[60]),ds[48]=pr(hs[21]),ds[49]=pr(hs[34]),ds[50]=pr(hs[37]),ds[51]=pr(hs[47]),ds[52]=pr(hs[50]),ds[53]=pr(hs[56]),ds[54]=pr(hs[59]),ds[55]=pr(hs[61]),ds[56]=pr(hs[35]),ds[57]=pr(hs[36]),ds[58]=pr(hs[48]),ds[59]=pr(hs[49]),ds[60]=pr(hs[57]),ds[61]=pr(hs[58]),ds[62]=pr(hs[62]),ds[63]=pr(hs[63]),cn(PM[Sl]);An(PM);for(let Sl=0;Sl<3;++Sl)fn(PM[Sl],l_[Sl],64*Wo)}let xv=0;for(let Wo=0;Wo<3;++Wo){const Sl=xs[Wr.idx[Wo]].type;for(let ay=8*Ol;ay<8*Ol+TS;++ay){xv=rD[Wo][ay];for(let BM=0;BM<Gu;++BM){const pA=64*BM+8*(7&ay);As.setUint16(xv+0*Sl,l_[Wo][pA+0],!0),As.setUint16(xv+2*Sl,l_[Wo][pA+1],!0),As.setUint16(xv+4*Sl,l_[Wo][pA+2],!0),As.setUint16(xv+6*Sl,l_[Wo][pA+3],!0),As.setUint16(xv+8*Sl,l_[Wo][pA+4],!0),As.setUint16(xv+10*Sl,l_[Wo][pA+5],!0),As.setUint16(xv+12*Sl,l_[Wo][pA+6],!0),As.setUint16(xv+14*Sl,l_[Wo][pA+7],!0),xv+=16*Sl}}if(Gu!=Qm)for(let ay=8*Ol;ay<8*Ol+TS;++ay){const BM=rD[Wo][ay]+8*Gu*2*Sl,pA=64*Gu+8*(7&ay);for(let sD=0;sD<IS;++sD)As.setUint16(BM+2*sD*Sl,l_[Wo][pA+sD],!0)}}}var hs,ds;const XL=new Uint16Array(Os);As=new DataView(Vo.buffer);for(let Ol=0;Ol<3;++Ol){xs[Wr.idx[Ol]].decoded=!0;const TS=xs[Wr.idx[Ol]].type;if(xs[Ol].type==2)for(let IS=0;IS<ro;++IS){const xv=rD[Ol][IS];for(let Wo=0;Wo<Os;++Wo)XL[Wo]=As.getUint16(xv+2*Wo*TS,!0);for(let Wo=0;Wo<Os;++Wo)As.setFloat32(xv+2*Wo*TS,pr(XL[Wo]),!0)}}})(rs,ms,Jr,is,as,Qn);for(let Wr=0;Wr<Jr.length;++Wr){const _s=Jr[Wr];if(!_s.decoded){if(_s.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let xs=0,Ps=0;for(let Al=0;Al<nn.lines;++Al){let Vo=ms[Wr][xs];for(let As=0;As<_s.width;++As){for(let Os=0;Os<2*_s.type;++Os)Qn[Vo++]=es[Ps+Os*_s.width*_s.height];Ps++}xs++}}}}return new DataView(Qn.buffer)}function rr(nn,On){const on=new Uint8Array(nn);let Qn=0;for(;on[On.value+Qn]!=0;)Qn+=1;const Jn=new TextDecoder().decode(on.slice(On.value,On.value+Qn));return On.value=On.value+Qn+1,Jn}function cr(nn,On){const on=nn.getInt32(On.value,!0);return On.value=On.value+4,on}function _i(nn,On){const on=nn.getUint32(On.value,!0);return On.value=On.value+4,on}function xr(nn,On){const on=nn[On.value];return On.value=On.value+1,on}function Mr(nn,On){const on=nn.getUint8(On.value);return On.value=On.value+1,on}const Tr=function(nn,On){const on=Number(nn.getBigInt64(On.value,!0));return On.value+=8,on};function Lr(nn,On){const on=nn.getFloat32(On.value,!0);return On.value+=4,on}function os(nn,On){return b.A5E.toHalfFloat(Lr(nn,On))}function pr(nn){const On=(31744&nn)>>10,on=1023&nn;return(nn>>15?-1:1)*(On?On===31?on?NaN:1/0:Math.pow(2,On-15)*(1+on/1024):on/1024*6103515625e-14)}function Bs(nn,On){const on=nn.getUint16(On.value,!0);return On.value+=2,on}function Ws(nn,On){return pr(Bs(nn,On))}function ks(nn,On,on,Qn,Jn){return Qn==="string"||Qn==="stringvector"||Qn==="iccProfile"?function(Vn,sr,Fr){const Jr=new TextDecoder().decode(new Uint8Array(Vn).slice(sr.value,sr.value+Fr));return sr.value=sr.value+Fr,Jr}(On,on,Jn):Qn==="chlist"?function(Vn,sr,Fr,Jr){const rs=Fr.value,is=[];for(;Fr.value<rs+Jr-1;){const as=rr(sr,Fr),es=cr(Vn,Fr),Zr=Mr(Vn,Fr);Fr.value+=3;const ms=cr(Vn,Fr),Wr=cr(Vn,Fr);is.push({name:as,pixelType:es,pLinear:Zr,xSampling:ms,ySampling:Wr})}return Fr.value+=1,is}(nn,On,on,Jn):Qn==="chromaticities"?function(Vn,sr){return{redX:Lr(Vn,sr),redY:Lr(Vn,sr),greenX:Lr(Vn,sr),greenY:Lr(Vn,sr),blueX:Lr(Vn,sr),blueY:Lr(Vn,sr),whiteX:Lr(Vn,sr),whiteY:Lr(Vn,sr)}}(nn,on):Qn==="compression"?function(Vn,sr){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Mr(Vn,sr)]}(nn,on):Qn==="box2i"?function(Vn,sr){return{xMin:_i(Vn,sr),yMin:_i(Vn,sr),xMax:_i(Vn,sr),yMax:_i(Vn,sr)}}(nn,on):Qn==="lineOrder"?function(Vn,sr){return["INCREASING_Y"][Mr(Vn,sr)]}(nn,on):Qn==="float"?Lr(nn,on):Qn==="v2f"?function(Vn,sr){return[Lr(Vn,sr),Lr(Vn,sr)]}(nn,on):Qn==="v3f"?function(Vn,sr){return[Lr(Vn,sr),Lr(Vn,sr),Lr(Vn,sr)]}(nn,on):Qn==="int"?cr(nn,on):Qn==="rational"?function(Vn,sr){return[cr(Vn,sr),_i(Vn,sr)]}(nn,on):Qn==="timecode"?function(Vn,sr){return[_i(Vn,sr),_i(Vn,sr)]}(nn,on):Qn==="preview"?(on.value+=Jn,"skipped"):void(on.value+=Jn)}const uo=new DataView(e),Mo=new Uint8Array(e),or={value:0},Rr=function(nn,On,on){const Qn={};if(nn.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");Qn.version=nn.getUint8(4);const Jn=nn.getUint8(5);Qn.spec={singleTile:!!(2&Jn),longName:!!(4&Jn),deepFormat:!!(8&Jn),multiPart:!!(16&Jn)},on.value=8;let Vn=!0;for(;Vn;){const sr=rr(On,on);if(sr==0)Vn=!1;else{const Fr=rr(On,on),Jr=ks(nn,On,on,Fr,_i(nn,on));Jr===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${Fr}'.`):Qn[sr]=Jr}}if(-5&Jn)throw console.error("EXRHeader:",Qn),new Error("THREE.EXRLoader: provided file is currently unsupported.");return Qn}(uo,e,or),Br=function(nn,On,on,Qn,Jn){const Vn={size:0,viewer:On,array:on,offset:Qn,width:nn.dataWindow.xMax-nn.dataWindow.xMin+1,height:nn.dataWindow.yMax-nn.dataWindow.yMin+1,channels:nn.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:nn.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(nn.compression){case"NO_COMPRESSION":Vn.lines=1,Vn.uncompress=Tn;break;case"RLE_COMPRESSION":Vn.lines=1,Vn.uncompress=gn;break;case"ZIPS_COMPRESSION":Vn.lines=1,Vn.uncompress=xn;break;case"ZIP_COMPRESSION":Vn.lines=16,Vn.uncompress=xn;break;case"PIZ_COMPRESSION":Vn.lines=32,Vn.uncompress=Nn;break;case"PXR24_COMPRESSION":Vn.lines=16,Vn.uncompress=Mn;break;case"DWAA_COMPRESSION":Vn.lines=32,Vn.uncompress=Hn;break;case"DWAB_COMPRESSION":Vn.lines=256,Vn.uncompress=Hn;break;default:throw new Error("EXRLoader.parse: "+nn.compression+" is unsupported")}if(Vn.scanlineBlockSize=Vn.lines,Vn.type==1)switch(Jn){case b.VzW:Vn.getter=Ws,Vn.inputSize=2;break;case b.cLu:Vn.getter=Bs,Vn.inputSize=2}else{if(Vn.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+Vn.type+" for "+nn.compression+".");switch(Jn){case b.VzW:Vn.getter=Lr,Vn.inputSize=4;break;case b.cLu:Vn.getter=os,Vn.inputSize=4}}Vn.blockCount=(nn.dataWindow.yMax+1)/Vn.scanlineBlockSize;for(let Fr=0;Fr<Vn.blockCount;Fr++)Tr(On,Qn);Vn.outputChannels=Vn.channels==3?4:Vn.channels;const sr=Vn.width*Vn.height*Vn.outputChannels;switch(Jn){case b.VzW:Vn.byteArray=new Float32Array(sr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(1,0,sr);break;case b.cLu:Vn.byteArray=new Uint16Array(sr),Vn.channels<Vn.outputChannels&&Vn.byteArray.fill(15360,0,sr);break;default:console.error("THREE.EXRLoader: unsupported type: ",Jn)}return Vn.bytesPerLine=Vn.width*Vn.inputSize*Vn.channels,Vn.outputChannels==4?(Vn.format=b.wk1,Vn.encoding=b.rnI):(Vn.format=b.hEm,Vn.encoding=b.rnI),Vn}(Rr,uo,Mo,or,this.type),Ls={value:0},So={R:0,G:1,B:2,A:3,Y:0};for(let nn=0;nn<Br.height/Br.scanlineBlockSize;nn++){const On=_i(uo,or);Br.size=_i(uo,or),Br.lines=On+Br.scanlineBlockSize>Br.height?Br.height-On:Br.scanlineBlockSize;const on=Br.size<Br.lines*Br.bytesPerLine?Br.uncompress(Br):Tn(Br);or.value+=Br.size;for(let Qn=0;Qn<Br.scanlineBlockSize;Qn++){const Jn=Qn+nn*Br.scanlineBlockSize;if(Jn>=Br.height)break;for(let Vn=0;Vn<Br.channels;Vn++){const sr=So[Rr.channels[Vn].name];for(let Fr=0;Fr<Br.width;Fr++){Ls.value=(Qn*(Br.channels*Br.width)+Vn*Br.width+Fr)*Br.inputSize;const Jr=(Br.height-1-Jn)*(Br.width*Br.outputChannels)+Fr*Br.outputChannels+sr;Br.byteArray[Jr]=Br.getter(on,Ls)}}}}return{header:Rr,width:Br.width,height:Br.height,data:Br.byteArray,format:Br.format,encoding:Br.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,i,s,a){return super.load(e,function(h,d){h.encoding=d.encoding,h.minFilter=b.wem,h.magFilter=b.wem,h.generateMipmaps=!1,h.flipY=!1,i&&i(h,d)},s,a)}}class pp extends st{constructor(){super(...arguments),this.dependencies=[Yr]}async onAdded(e){this._importer||(this._importer=new Zo(class extends dI{constructor(i){super(i),this.setDataType(P1(e.renderer.rendererObject))}},["exr"],!1)),Gs.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1),this._importer=void 0}}function WC(c,e,i){const s=i.length-c-1;if(e>=i[s])return s-1;if(e<=i[c])return c;let a=c,h=s,d=Math.floor((a+h)/2);for(;e<i[d]||e>=i[d+1];)e<i[d]?h=d:a=d,d=Math.floor((a+h)/2);return d}function pI(c,e){let i=1;for(let a=2;a<=c;++a)i*=a;let s=1;for(let a=2;a<=e;++a)s*=a;for(let a=2;a<=c-e;++a)s*=a;return i/s}pp.PluginType="EXRLoadPlugin";class qC extends b.Hyl{constructor(e,i,s,a,h){super(),this.degree=e,this.knots=i,this.controlPoints=[],this.startKnot=a||0,this.endKnot=h||this.knots.length-1;for(let d=0;d<s.length;++d){const _=s[d];this.controlPoints[d]=new b.Ltg(_.x,_.y,_.z,_.w)}}getPoint(e,i=new b.Pa4){const s=i,a=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),h=function(d,_,et,nt){const it=WC(d,nt,_),lt=function(pt,gt,vt,Ct){const wt=[],xt=[],_t=[];wt[0]=1;for(let Pt=1;Pt<=vt;++Pt){xt[Pt]=gt-Ct[pt+1-Pt],_t[Pt]=Ct[pt+Pt]-gt;let Rt=0;for(let Lt=0;Lt<Pt;++Lt){const Ot=_t[Lt+1],qt=xt[Pt-Lt],en=wt[Lt]/(Ot+qt);wt[Lt]=Rt+Ot*en,Rt=qt*en}wt[Pt]=Rt}return wt}(it,nt,d,_),dt=new b.Ltg(0,0,0,0);for(let pt=0;pt<=d;++pt){const gt=et[it-d+pt],vt=lt[pt],Ct=gt.w*vt;dt.x+=gt.x*Ct,dt.y+=gt.y*Ct,dt.z+=gt.z*Ct,dt.w+=gt.w*vt}return dt}(this.degree,this.knots,this.controlPoints,a);return h.w!==1&&h.divideScalar(h.w),s.set(h.x,h.y,h.z)}getTangent(e,i=new b.Pa4){const s=i,a=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),h=function(d,_,et,nt,it){const lt=function(dt,pt,gt,vt,Ct){const wt=Ct<dt?Ct:dt,xt=[],_t=WC(dt,vt,pt),Pt=function(Lt,Ot,qt,en,cn){const An=[];for(let Mn=0;Mn<=qt;++Mn)An[Mn]=0;const fn=[];for(let Mn=0;Mn<=en;++Mn)fn[Mn]=An.slice(0);const Tn=[];for(let Mn=0;Mn<=qt;++Mn)Tn[Mn]=An.slice(0);Tn[0][0]=1;const gn=An.slice(0),xn=An.slice(0);for(let Mn=1;Mn<=qt;++Mn){gn[Mn]=Ot-cn[Lt+1-Mn],xn[Mn]=cn[Lt+Mn]-Ot;let Hn=0;for(let rr=0;rr<Mn;++rr){const cr=xn[rr+1],_i=gn[Mn-rr];Tn[Mn][rr]=cr+_i;const xr=Tn[rr][Mn-1]/Tn[Mn][rr];Tn[rr][Mn]=Hn+cr*xr,Hn=_i*xr}Tn[Mn][Mn]=Hn}for(let Mn=0;Mn<=qt;++Mn)fn[0][Mn]=Tn[Mn][qt];for(let Mn=0;Mn<=qt;++Mn){let Hn=0,rr=1;const cr=[];for(let _i=0;_i<=qt;++_i)cr[_i]=An.slice(0);cr[0][0]=1;for(let _i=1;_i<=en;++_i){let xr=0;const Mr=Mn-_i,Tr=qt-_i;Mn>=_i&&(cr[rr][0]=cr[Hn][0]/Tn[Tr+1][Mr],xr=cr[rr][0]*Tn[Mr][Tr]);const Lr=Mn-1<=Tr?_i-1:qt-Mn;for(let pr=Mr>=-1?1:-Mr;pr<=Lr;++pr)cr[rr][pr]=(cr[Hn][pr]-cr[Hn][pr-1])/Tn[Tr+1][Mr+pr],xr+=cr[rr][pr]*Tn[Mr+pr][Tr];Mn<=Tr&&(cr[rr][_i]=-cr[Hn][_i-1]/Tn[Tr+1][Mn],xr+=cr[rr][_i]*Tn[Mn][Tr]),fn[_i][Mn]=xr;const os=Hn;Hn=rr,rr=os}}let Nn=qt;for(let Mn=1;Mn<=en;++Mn){for(let Hn=0;Hn<=qt;++Hn)fn[Mn][Hn]*=Nn;Nn*=qt-Mn}return fn}(_t,vt,dt,wt,pt),Rt=[];for(let Lt=0;Lt<gt.length;++Lt){const Ot=gt[Lt].clone(),qt=Ot.w;Ot.x*=qt,Ot.y*=qt,Ot.z*=qt,Rt[Lt]=Ot}for(let Lt=0;Lt<=wt;++Lt){const Ot=Rt[_t-dt].clone().multiplyScalar(Pt[Lt][0]);for(let qt=1;qt<=dt;++qt)Ot.add(Rt[_t-dt+qt].clone().multiplyScalar(Pt[Lt][qt]));xt[Lt]=Ot}for(let Lt=wt+1;Lt<=Ct+1;++Lt)xt[Lt]=new b.Ltg(0,0,0);return xt}(d,_,et,nt,it);return function(dt){const pt=dt.length,gt=[],vt=[];for(let wt=0;wt<pt;++wt){const xt=dt[wt];gt[wt]=new b.Pa4(xt.x,xt.y,xt.z),vt[wt]=xt.w}const Ct=[];for(let wt=0;wt<pt;++wt){const xt=gt[wt].clone();for(let _t=1;_t<=wt;++_t)xt.sub(Ct[wt-_t].clone().multiplyScalar(pI(wt,_t)*vt[_t]));Ct[wt]=xt.divideScalar(vt[0])}return Ct}(lt)}(this.degree,this.knots,this.controlPoints,a,1);return s.copy(h[1]).normalize(),s}}let io,Bl,fp;class fI extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=h.path===""?b.Zp0.extractUrlBase(e):h.path,_=new b.hH6(this.manager);_.setPath(h.path),_.setResponseType("arraybuffer"),_.setRequestHeader(h.requestHeader),_.setWithCredentials(h.withCredentials),_.load(e,function(et){try{i(h.parse(et,d))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}parse(e,i){if(function(a){const h="Kaydara FBX Binary  \0";return a.byteLength>=h.length&&h===_l(a,0,h.length)}(e))io=new xD().parse(e);else{const a=_l(e);if(!function(h){const d=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let _=0;function et(nt){const it=h[nt-1];return h=h.slice(_+nt),_++,it}for(let nt=0;nt<d.length;++nt)if(et(1)===d[nt])return!1;return!0}(a))throw new Error("THREE.FBXLoader: Unknown format.");if(Sn(a)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Sn(a));io=new VE().parse(a)}const s=new b.dpR(this.manager).setPath(this.resourcePath||i).setCrossOrigin(this.crossOrigin);return new YA(s,this.manager).parse(io)}}class YA{constructor(e,i){this.textureLoader=e,this.manager=i}parse(){Bl=this.parseConnections();const e=this.parseImages(),i=this.parseTextures(e),s=this.parseMaterials(i),a=this.parseDeformers(),h=new mI().parse(a);return this.parseScene(a,h,s),fp}parseConnections(){const e=new Map;return"Connections"in io&&io.Connections.connections.forEach(function(i){const s=i[0],a=i[1],h=i[2];e.has(s)||e.set(s,{parents:[],children:[]});const d={ID:a,relationship:h};e.get(s).parents.push(d),e.has(a)||e.set(a,{parents:[],children:[]});const _={ID:s,relationship:h};e.get(a).children.push(_)}),e}parseImages(){const e={},i={};if("Video"in io.Objects){const s=io.Objects.Video;for(const a in s){const h=s[a];if(e[parseInt(a)]=h.RelativeFilename||h.Filename,"Content"in h){const d=h.Content instanceof ArrayBuffer&&h.Content.byteLength>0,_=typeof h.Content=="string"&&h.Content!=="";if(d||_){const et=this.parseImage(s[a]);i[h.RelativeFilename||h.Filename]=et}}}}for(const s in e){const a=e[s];i[a]!==void 0?e[s]=i[a]:e[s]=e[s].split("\\").pop()}return e}parseImage(e){const i=e.Content,s=e.RelativeFilename||e.Filename,a=s.slice(s.lastIndexOf(".")+1).toLowerCase();let h;switch(a){case"bmp":h="image/bmp";break;case"jpg":case"jpeg":h="image/jpeg";break;case"png":h="image/png";break;case"tif":h="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",s),h="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if(typeof i=="string")return"data:"+h+";base64,"+i;{const d=new Uint8Array(i);return window.URL.createObjectURL(new Blob([d],{type:h}))}}parseTextures(e){const i=new Map;if("Texture"in io.Objects){const s=io.Objects.Texture;for(const a in s){const h=this.parseTexture(s[a],e);i.set(parseInt(a),h)}}return i}parseTexture(e,i){const s=this.loadTexture(e,i);s.ID=e.id,s.name=e.attrName;const a=e.WrapModeU,h=e.WrapModeV,d=a!==void 0?a.value:0,_=h!==void 0?h.value:0;if(s.wrapS=d===0?b.rpg:b.uWy,s.wrapT=_===0?b.rpg:b.uWy,"Scaling"in e){const et=e.Scaling.value;s.repeat.x=et[0],s.repeat.y=et[1]}if("Translation"in e){const et=e.Translation.value;s.offset.x=et[0],s.offset.y=et[1]}return s}loadTexture(e,i){let s;const a=this.textureLoader.path,h=Bl.get(e.id).children;let d;h!==void 0&&h.length>0&&i[h[0].ID]!==void 0&&(s=i[h[0].ID],s.indexOf("blob:")!==0&&s.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const _=e.FileName.slice(-3).toLowerCase();if(_==="tga"){const et=this.manager.getHandler(".tga");et===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),d=new b.xEZ):(et.setPath(this.textureLoader.path),d=et.load(s))}else _==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),d=new b.xEZ):d=this.textureLoader.load(s);return this.textureLoader.setPath(a),d}parseMaterials(e){const i=new Map;if("Material"in io.Objects){const s=io.Objects.Material;for(const a in s){const h=this.parseMaterial(s[a],e);h!==null&&i.set(parseInt(a),h)}}return i}parseMaterial(e,i){const s=e.id,a=e.attrName;let h=e.ShadingModel;if(typeof h=="object"&&(h=h.value),!Bl.has(s))return null;const d=this.parseParameters(e,i,s);let _;switch(h.toLowerCase()){case"phong":_=new b.xoR;break;case"lambert":_=new b.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',h),_=new b.xoR}return _.setValues(d),_.name=a,_}parseParameters(e,i,s){const a={};e.BumpFactor&&(a.bumpScale=e.BumpFactor.value),e.Diffuse?a.color=new b.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(a.color=new b.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(a.displacementScale=e.DisplacementFactor.value),e.Emissive?a.emissive=new b.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(a.emissive=new b.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(a.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(a.opacity=parseFloat(e.Opacity.value)),a.opacity<1&&(a.transparent=!0),e.ReflectionFactor&&(a.reflectivity=e.ReflectionFactor.value),e.Shininess&&(a.shininess=e.Shininess.value),e.Specular?a.specular=new b.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(a.specular=new b.Ilk().fromArray(e.SpecularColor.value));const h=this;return Bl.get(s).children.forEach(function(d){const _=d.relationship;switch(_){case"Bump":a.bumpMap=h.getTexture(i,d.ID);break;case"Maya|TEX_ao_map":a.aoMap=h.getTexture(i,d.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":a.map=h.getTexture(i,d.ID),a.map!==void 0&&(a.map.encoding=b.knz);break;case"DisplacementColor":a.displacementMap=h.getTexture(i,d.ID);break;case"EmissiveColor":a.emissiveMap=h.getTexture(i,d.ID),a.emissiveMap!==void 0&&(a.emissiveMap.encoding=b.knz);break;case"NormalMap":case"Maya|TEX_normal_map":a.normalMap=h.getTexture(i,d.ID);break;case"ReflectionColor":a.envMap=h.getTexture(i,d.ID),a.envMap!==void 0&&(a.envMap.mapping=b.dSO,a.envMap.encoding=b.knz);break;case"SpecularColor":a.specularMap=h.getTexture(i,d.ID),a.specularMap!==void 0&&(a.specularMap.encoding=b.knz);break;case"TransparentColor":case"TransparencyFactor":a.alphaMap=h.getTexture(i,d.ID),a.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",_)}}),a}getTexture(e,i){return"LayeredTexture"in io.Objects&&i in io.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),i=Bl.get(i).children[0].ID),e.get(i)}parseDeformers(){const e={},i={};if("Deformer"in io.Objects){const s=io.Objects.Deformer;for(const a in s){const h=s[a],d=Bl.get(parseInt(a));if(h.attrType==="Skin"){const _=this.parseSkeleton(d,s);_.ID=a,d.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),_.geometryID=d.parents[0].ID,e[a]=_}else if(h.attrType==="BlendShape"){const _={id:a};_.rawTargets=this.parseMorphTargets(d,s),_.id=a,d.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),i[a]=_}}}return{skeletons:e,morphTargets:i}}parseSkeleton(e,i){const s=[];return e.children.forEach(function(a){const h=i[a.ID];if(h.attrType!=="Cluster")return;const d={ID:a.ID,indices:[],weights:[],transformLink:new b.yGw().fromArray(h.TransformLink.a)};"Indexes"in h&&(d.indices=h.Indexes.a,d.weights=h.Weights.a),s.push(d)}),{rawBones:s,bones:[]}}parseMorphTargets(e,i){const s=[];for(let a=0;a<e.children.length;a++){const h=e.children[a],d=i[h.ID],_={name:d.attrName,initialWeight:d.DeformPercent,id:d.id,fullWeights:d.FullWeights.a};if(d.attrType!=="BlendShapeChannel")return;_.geoID=Bl.get(parseInt(h.ID)).children.filter(function(et){return et.relationship===void 0})[0].ID,s.push(_)}return s}parseScene(e,i,s){fp=new b.ZAu;const a=this.parseModels(e.skeletons,i,s),h=io.Objects.Model,d=this;a.forEach(function(et){const nt=h[et.ID];d.setLookAtProperties(et,nt),Bl.get(et.ID).parents.forEach(function(it){const lt=a.get(it.ID);lt!==void 0&&lt.add(et)}),et.parent===null&&fp.add(et)}),this.bindSkeleton(e.skeletons,i,a),this.createAmbientLight(),fp.traverse(function(et){if(et.userData.transformData){et.parent&&(et.userData.transformData.parentMatrix=et.parent.matrix,et.userData.transformData.parentMatrixWorld=et.parent.matrixWorld);const nt=lo(et.userData.transformData);et.applyMatrix4(nt),et.updateWorldMatrix()}});const _=new gI().parse();fp.children.length===1&&fp.children[0].isGroup&&(fp.children[0].animations=_,fp=fp.children[0]),fp.animations=_}parseModels(e,i,s){const a=new Map,h=io.Objects.Model;for(const d in h){const _=parseInt(d),et=h[d],nt=Bl.get(_);let it=this.buildSkeleton(nt,e,_,et.attrName);if(!it){switch(et.attrType){case"Camera":it=this.createCamera(nt);break;case"Light":it=this.createLight(nt);break;case"Mesh":it=this.createMesh(nt,i,s);break;case"NurbsCurve":it=this.createCurve(nt,i);break;case"LimbNode":case"Root":it=new b.N$j;break;default:it=new b.ZAu}it.name=et.attrName?b.iUV.sanitizeNodeName(et.attrName):"",it.ID=_}this.getTransformData(it,et),a.set(_,it)}return a}buildSkeleton(e,i,s,a){let h=null;return e.parents.forEach(function(d){for(const _ in i){const et=i[_];et.rawBones.forEach(function(nt,it){if(nt.ID===d.ID){const lt=h;h=new b.N$j,h.matrixWorld.copy(nt.transformLink),h.name=a?b.iUV.sanitizeNodeName(a):"",h.ID=s,et.bones[it]=h,lt!==null&&h.add(lt)}})}}),h}createCamera(e){let i,s;if(e.children.forEach(function(a){const h=io.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new b.Tme;else{let a=0;s.CameraProjectionType!==void 0&&s.CameraProjectionType.value===1&&(a=1);let h=1;s.NearPlane!==void 0&&(h=s.NearPlane.value/1e3);let d=1e3;s.FarPlane!==void 0&&(d=s.FarPlane.value/1e3);let _=window.innerWidth,et=window.innerHeight;s.AspectWidth!==void 0&&s.AspectHeight!==void 0&&(_=s.AspectWidth.value,et=s.AspectHeight.value);const nt=_/et;let it=45;s.FieldOfView!==void 0&&(it=s.FieldOfView.value);const lt=s.FocalLength?s.FocalLength.value:null;switch(a){case 0:i=new b.cPb(it,nt,h,d),lt!==null&&i.setFocalLength(lt);break;case 1:i=new b.iKG(-_/2,_/2,et/2,-et/2,h,d);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),i=new b.Tme}}return i}createLight(e){let i,s;if(e.children.forEach(function(a){const h=io.Objects.NodeAttribute[a.ID];h!==void 0&&(s=h)}),s===void 0)i=new b.Tme;else{s.LightType===void 0||s.LightType.value;let a=16777215;s.Color!==void 0&&(a=new b.Ilk().fromArray(s.Color.value));let h=s.Intensity===void 0?1:s.Intensity.value/100;s.CastLightOnObject!==void 0&&s.CastLightOnObject.value===0&&(h=0);let d=0;s.FarAttenuationEnd!==void 0&&(d=s.EnableFarAttenuation!==void 0&&s.EnableFarAttenuation.value===0?0:s.FarAttenuationEnd.value);const _=1;switch(e){case 0:i=new b.cek(a,h,d,_);break;case 1:i=new b.Ox3(a,h);break;case 2:let et=Math.PI/3;s.InnerAngle!==void 0&&(et=b.M8C.degToRad(s.InnerAngle.value));let nt=0;s.OuterAngle!==void 0&&(nt=b.M8C.degToRad(s.OuterAngle.value),nt=Math.max(nt,1)),i=new b.PMe(a,h,d,et,nt,_);break;default:console.warn("THREE.FBXLoader: Unknown light type "+s.LightType.value+", defaulting to a PointLight."),i=new b.cek(a,h)}s.CastShadows!==void 0&&s.CastShadows.value===1&&(i.castShadow=!0)}return i}createMesh(e,i,s){let a,h=null,d=null;const _=[];return e.children.forEach(function(et){i.has(et.ID)&&(h=i.get(et.ID)),s.has(et.ID)&&_.push(s.get(et.ID))}),_.length>1?d=_:_.length>0?d=_[0]:(d=new b.xoR({color:13421772}),_.push(d)),"color"in h.attributes&&_.forEach(function(et){et.vertexColors=!0}),h.FBX_Deformer?(a=new b.TUv(h,d),a.normalizeSkinWeights()):a=new b.Kj0(h,d),a}createCurve(e,i){const s=e.children.reduce(function(h,d){return i.has(d.ID)&&(h=i.get(d.ID)),h},null),a=new b.nls({color:3342591,linewidth:1});return new b.x12(s,a)}getTransformData(e,i){const s={};"InheritType"in i&&(s.inheritType=parseInt(i.InheritType.value)),s.eulerOrder="RotationOrder"in i?Es(i.RotationOrder.value):"ZYX","Lcl_Translation"in i&&(s.translation=i.Lcl_Translation.value),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"Lcl_Rotation"in i&&(s.rotation=i.Lcl_Rotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),"Lcl_Scaling"in i&&(s.scale=i.Lcl_Scaling.value),"ScalingOffset"in i&&(s.scalingOffset=i.ScalingOffset.value),"ScalingPivot"in i&&(s.scalingPivot=i.ScalingPivot.value),"RotationOffset"in i&&(s.rotationOffset=i.RotationOffset.value),"RotationPivot"in i&&(s.rotationPivot=i.RotationPivot.value),e.userData.transformData=s}setLookAtProperties(e,i){"LookAtProperty"in i&&Bl.get(e.ID).children.forEach(function(s){if(s.relationship==="LookAtProperty"){const a=io.Objects.Model[s.ID];if("Lcl_Translation"in a){const h=a.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(h),fp.add(e.target)):e.lookAt(new b.Pa4().fromArray(h))}}})}bindSkeleton(e,i,s){const a=this.parsePoseNodes();for(const h in e){const d=e[h];Bl.get(parseInt(d.ID)).parents.forEach(function(_){if(i.has(_.ID)){const et=_.ID;Bl.get(et).parents.forEach(function(nt){s.has(nt.ID)&&s.get(nt.ID).bind(new b.OdW(d.bones),a[nt.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in io.Objects){const i=io.Objects.Pose;for(const s in i)if(i[s].attrType==="BindPose"&&i[s].NbPoseNodes>0){const a=i[s].PoseNode;Array.isArray(a)?a.forEach(function(h){e[h.Node]=new b.yGw().fromArray(h.Matrix.a)}):e[a.Node]=new b.yGw().fromArray(a.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in io&&"AmbientColor"in io.GlobalSettings){const e=io.GlobalSettings.AmbientColor.value,i=e[0],s=e[1],a=e[2];if(i!==0||s!==0||a!==0){const h=new b.Ilk(i,s,a);fp.add(new b.Mig(h,1))}}}}class mI{parse(e){const i=new Map;if("Geometry"in io.Objects){const s=io.Objects.Geometry;for(const a in s){const h=Bl.get(parseInt(a)),d=this.parseGeometry(h,s[a],e);i.set(parseInt(a),d)}}return i}parseGeometry(e,i,s){switch(i.attrType){case"Mesh":return this.parseMeshGeometry(e,i,s);case"NurbsCurve":return this.parseNurbsGeometry(i)}}parseMeshGeometry(e,i,s){const a=s.skeletons,h=[],d=e.parents.map(function(lt){return io.Objects.Model[lt.ID]});if(d.length===0)return;const _=e.children.reduce(function(lt,dt){return a[dt.ID]!==void 0&&(lt=a[dt.ID]),lt},null);e.children.forEach(function(lt){s.morphTargets[lt.ID]!==void 0&&h.push(s.morphTargets[lt.ID])});const et=d[0],nt={};"RotationOrder"in et&&(nt.eulerOrder=Es(et.RotationOrder.value)),"InheritType"in et&&(nt.inheritType=parseInt(et.InheritType.value)),"GeometricTranslation"in et&&(nt.translation=et.GeometricTranslation.value),"GeometricRotation"in et&&(nt.rotation=et.GeometricRotation.value),"GeometricScaling"in et&&(nt.scale=et.GeometricScaling.value);const it=lo(nt);return this.genGeometry(i,_,h,it)}genGeometry(e,i,s,a){const h=new b.u9r;e.attrName&&(h.name=e.attrName);const d=this.parseGeoNode(e,i),_=this.genBuffers(d),et=new b.a$l(_.vertex,3);if(et.applyMatrix4(a),h.setAttribute("position",et),_.colors.length>0&&h.setAttribute("color",new b.a$l(_.colors,3)),i&&(h.setAttribute("skinIndex",new b.qlB(_.weightsIndices,4)),h.setAttribute("skinWeight",new b.a$l(_.vertexWeights,4)),h.FBX_Deformer=i),_.normal.length>0){const nt=new b.Vkp().getNormalMatrix(a),it=new b.a$l(_.normal,3);it.applyNormalMatrix(nt),h.setAttribute("normal",it)}if(_.uvs.forEach(function(nt,it){let lt="uv"+(it+1).toString();it===0&&(lt="uv"),h.setAttribute(lt,new b.a$l(_.uvs[it],2))}),d.material&&d.material.mappingType!=="AllSame"){let nt=_.materialIndex[0],it=0;if(_.materialIndex.forEach(function(lt,dt){lt!==nt&&(h.addGroup(it,dt-it,nt),nt=lt,it=dt)}),h.groups.length>0){const lt=h.groups[h.groups.length-1],dt=lt.start+lt.count;dt!==_.materialIndex.length&&h.addGroup(dt,_.materialIndex.length-dt,nt)}h.groups.length===0&&h.addGroup(0,_.materialIndex.length,_.materialIndex[0])}return this.addMorphTargets(h,e,s,a),h}parseGeoNode(e,i){const s={};if(s.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],s.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(s.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(s.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(s.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){s.uv=[];let a=0;for(;e.LayerElementUV[a];)e.LayerElementUV[a].UV&&s.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return s.weightTable={},i!==null&&(s.skeleton=i,i.rawBones.forEach(function(a,h){a.indices.forEach(function(d,_){s.weightTable[d]===void 0&&(s.weightTable[d]=[]),s.weightTable[d].push({id:h,weight:a.weights[_]})})})),s}genBuffers(e){const i={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let s=0,a=0,h=!1,d=[],_=[],et=[],nt=[],it=[],lt=[];const dt=this;return e.vertexIndices.forEach(function(pt,gt){let vt,Ct=!1;pt<0&&(pt^=-1,Ct=!0);let wt=[],xt=[];if(d.push(3*pt,3*pt+1,3*pt+2),e.color){const _t=yr(gt,s,pt,e.color);et.push(_t[0],_t[1],_t[2])}if(e.skeleton){if(e.weightTable[pt]!==void 0&&e.weightTable[pt].forEach(function(_t){xt.push(_t.weight),wt.push(_t.id)}),xt.length>4){h||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),h=!0);const _t=[0,0,0,0],Pt=[0,0,0,0];xt.forEach(function(Rt,Lt){let Ot=Rt,qt=wt[Lt];Pt.forEach(function(en,cn,An){if(Ot>en){An[cn]=Ot,Ot=en;const fn=_t[cn];_t[cn]=qt,qt=fn}})}),wt=_t,xt=Pt}for(;xt.length<4;)xt.push(0),wt.push(0);for(let _t=0;_t<4;++_t)it.push(xt[_t]),lt.push(wt[_t])}if(e.normal){const _t=yr(gt,s,pt,e.normal);_.push(_t[0],_t[1],_t[2])}e.material&&e.material.mappingType!=="AllSame"&&(vt=yr(gt,s,pt,e.material)[0],vt<0&&(console.warn("THREE.FBXLoader: Invalid material index:",vt),vt=0)),e.uv&&e.uv.forEach(function(_t,Pt){const Rt=yr(gt,s,pt,_t);nt[Pt]===void 0&&(nt[Pt]=[]),nt[Pt].push(Rt[0]),nt[Pt].push(Rt[1])}),a++,Ct&&(dt.genFace(i,e,d,vt,_,et,nt,it,lt,a),s++,a=0,d=[],_=[],et=[],nt=[],it=[],lt=[])}),i}genFace(e,i,s,a,h,d,_,et,nt,it){for(let lt=2;lt<it;lt++)e.vertex.push(i.vertexPositions[s[0]]),e.vertex.push(i.vertexPositions[s[1]]),e.vertex.push(i.vertexPositions[s[2]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+1]]),e.vertex.push(i.vertexPositions[s[3*(lt-1)+2]]),e.vertex.push(i.vertexPositions[s[3*lt]]),e.vertex.push(i.vertexPositions[s[3*lt+1]]),e.vertex.push(i.vertexPositions[s[3*lt+2]]),i.skeleton&&(e.vertexWeights.push(et[0]),e.vertexWeights.push(et[1]),e.vertexWeights.push(et[2]),e.vertexWeights.push(et[3]),e.vertexWeights.push(et[4*(lt-1)]),e.vertexWeights.push(et[4*(lt-1)+1]),e.vertexWeights.push(et[4*(lt-1)+2]),e.vertexWeights.push(et[4*(lt-1)+3]),e.vertexWeights.push(et[4*lt]),e.vertexWeights.push(et[4*lt+1]),e.vertexWeights.push(et[4*lt+2]),e.vertexWeights.push(et[4*lt+3]),e.weightsIndices.push(nt[0]),e.weightsIndices.push(nt[1]),e.weightsIndices.push(nt[2]),e.weightsIndices.push(nt[3]),e.weightsIndices.push(nt[4*(lt-1)]),e.weightsIndices.push(nt[4*(lt-1)+1]),e.weightsIndices.push(nt[4*(lt-1)+2]),e.weightsIndices.push(nt[4*(lt-1)+3]),e.weightsIndices.push(nt[4*lt]),e.weightsIndices.push(nt[4*lt+1]),e.weightsIndices.push(nt[4*lt+2]),e.weightsIndices.push(nt[4*lt+3])),i.color&&(e.colors.push(d[0]),e.colors.push(d[1]),e.colors.push(d[2]),e.colors.push(d[3*(lt-1)]),e.colors.push(d[3*(lt-1)+1]),e.colors.push(d[3*(lt-1)+2]),e.colors.push(d[3*lt]),e.colors.push(d[3*lt+1]),e.colors.push(d[3*lt+2])),i.material&&i.material.mappingType!=="AllSame"&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),i.normal&&(e.normal.push(h[0]),e.normal.push(h[1]),e.normal.push(h[2]),e.normal.push(h[3*(lt-1)]),e.normal.push(h[3*(lt-1)+1]),e.normal.push(h[3*(lt-1)+2]),e.normal.push(h[3*lt]),e.normal.push(h[3*lt+1]),e.normal.push(h[3*lt+2])),i.uv&&i.uv.forEach(function(dt,pt){e.uvs[pt]===void 0&&(e.uvs[pt]=[]),e.uvs[pt].push(_[pt][0]),e.uvs[pt].push(_[pt][1]),e.uvs[pt].push(_[pt][2*(lt-1)]),e.uvs[pt].push(_[pt][2*(lt-1)+1]),e.uvs[pt].push(_[pt][2*lt]),e.uvs[pt].push(_[pt][2*lt+1])})}addMorphTargets(e,i,s,a){if(s.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const h=this;s.forEach(function(d){d.rawTargets.forEach(function(_){const et=io.Objects.Geometry[_.geoID];et!==void 0&&h.genMorphGeometry(e,i,et,a,_.name)})})}genMorphGeometry(e,i,s,a,h){const d=i.PolygonVertexIndex!==void 0?i.PolygonVertexIndex.a:[],_=s.Vertices!==void 0?s.Vertices.a:[],et=s.Indexes!==void 0?s.Indexes.a:[],nt=3*e.attributes.position.count,it=new Float32Array(nt);for(let gt=0;gt<et.length;gt++){const vt=3*et[gt];it[vt]=_[3*gt],it[vt+1]=_[3*gt+1],it[vt+2]=_[3*gt+2]}const lt={vertexIndices:d,vertexPositions:it},dt=this.genBuffers(lt),pt=new b.a$l(dt.vertex,3);pt.name=h||s.attrName,pt.applyMatrix4(a),e.morphAttributes.position.push(pt)}parseNormals(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Normals.a;let h=[];return s==="IndexToDirect"&&("NormalIndex"in e?h=e.NormalIndex.a:"NormalsIndex"in e&&(h=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:h,mappingType:i,referenceType:s}}parseUVs(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.UV.a;let h=[];return s==="IndexToDirect"&&(h=e.UVIndex.a),{dataSize:2,buffer:a,indices:h,mappingType:i,referenceType:s}}parseVertexColors(e){const i=e.MappingInformationType,s=e.ReferenceInformationType,a=e.Colors.a;let h=[];return s==="IndexToDirect"&&(h=e.ColorIndex.a),{dataSize:4,buffer:a,indices:h,mappingType:i,referenceType:s}}parseMaterialIndices(e){const i=e.MappingInformationType,s=e.ReferenceInformationType;if(i==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:s};const a=e.Materials.a,h=[];for(let d=0;d<a.length;++d)h.push(d);return{dataSize:1,buffer:a,indices:h,mappingType:i,referenceType:s}}parseNurbsGeometry(e){if(qC===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new b.u9r;const i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new b.u9r;const s=i-1,a=e.KnotVector.a,h=[],d=e.Points.a;for(let it=0,lt=d.length;it<lt;it+=4)h.push(new b.Ltg().fromArray(d,it));let _,et;if(e.Form==="Closed")h.push(h[0]);else if(e.Form==="Periodic"){_=s,et=a.length-1-_;for(let it=0;it<s;++it)h.push(h[it])}const nt=new qC(s,a,h,_,et).getPoints(12*h.length);return new b.u9r().setFromPoints(nt)}}class gI{parse(){const e=[],i=this.parseClips();if(i!==void 0)for(const s in i){const a=i[s],h=this.addClip(a);e.push(h)}return e}parseClips(){if(io.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const i=this.parseAnimationLayers(e);return this.parseAnimStacks(i)}parseAnimationCurveNodes(){const e=io.Objects.AnimationCurveNode,i=new Map;for(const s in e){const a=e[s];if(a.attrName.match(/S|R|T|DeformPercent/)!==null){const h={id:a.id,attr:a.attrName,curves:{}};i.set(h.id,h)}}return i}parseAnimationCurves(e){const i=io.Objects.AnimationCurve;for(const s in i){const a={id:i[s].id,times:i[s].KeyTime.a.map(fr),values:i[s].KeyValueFloat.a},h=Bl.get(a.id);if(h!==void 0){const d=h.parents[0].ID,_=h.parents[0].relationship;_.match(/X/)?e.get(d).curves.x=a:_.match(/Y/)?e.get(d).curves.y=a:_.match(/Z/)?e.get(d).curves.z=a:_.match(/d|DeformPercent/)&&e.has(d)&&(e.get(d).curves.morph=a)}}}parseAnimationLayers(e){const i=io.Objects.AnimationLayer,s=new Map;for(const a in i){const h=[],d=Bl.get(parseInt(a));d!==void 0&&(d.children.forEach(function(_,et){if(e.has(_.ID)){const nt=e.get(_.ID);if(nt.curves.x!==void 0||nt.curves.y!==void 0||nt.curves.z!==void 0){if(h[et]===void 0){const it=Bl.get(_.ID).parents.filter(function(lt){return lt.relationship!==void 0})[0].ID;if(it!==void 0){const lt=io.Objects.Model[it.toString()];if(lt===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",_);const dt={modelName:lt.attrName?b.iUV.sanitizeNodeName(lt.attrName):"",ID:lt.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};fp.traverse(function(pt){pt.ID===lt.id&&(dt.transform=pt.matrix,pt.userData.transformData&&(dt.eulerOrder=pt.userData.transformData.eulerOrder))}),dt.transform||(dt.transform=new b.yGw),"PreRotation"in lt&&(dt.preRotation=lt.PreRotation.value),"PostRotation"in lt&&(dt.postRotation=lt.PostRotation.value),h[et]=dt}}h[et]&&(h[et][nt.attr]=nt)}else if(nt.curves.morph!==void 0){if(h[et]===void 0){const it=Bl.get(_.ID).parents.filter(function(Ct){return Ct.relationship!==void 0})[0].ID,lt=Bl.get(it).parents[0].ID,dt=Bl.get(lt).parents[0].ID,pt=Bl.get(dt).parents[0].ID,gt=io.Objects.Model[pt],vt={modelName:gt.attrName?b.iUV.sanitizeNodeName(gt.attrName):"",morphName:io.Objects.Deformer[it].attrName};h[et]=vt}h[et][nt.attr]=nt}}}),s.set(parseInt(a),h))}return s}parseAnimStacks(e){const i=io.Objects.AnimationStack,s={};for(const a in i){const h=Bl.get(parseInt(a)).children;h.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const d=e.get(h[0].ID);s[a]={name:i[a].attrName,layer:d}}return s}addClip(e){let i=[];const s=this;return e.layer.forEach(function(a){i=i.concat(s.generateTracks(a))}),new b.m7l(e.name,-1,i)}generateTracks(e){const i=[];let s=new b.Pa4,a=new b._fP,h=new b.Pa4;if(e.transform&&e.transform.decompose(s,a,h),s=s.toArray(),a=new b.USm().setFromQuaternion(a,e.eulerOrder).toArray(),h=h.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.T.curves,s,"position");d!==void 0&&i.push(d)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const d=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);d!==void 0&&i.push(d)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const d=this.generateVectorTrack(e.modelName,e.S.curves,h,"scale");d!==void 0&&i.push(d)}if(e.DeformPercent!==void 0){const d=this.generateMorphTrack(e);d!==void 0&&i.push(d)}return i}generateVectorTrack(e,i,s,a){const h=this.getTimesForAllAxes(i),d=this.getKeyframeTrackValues(h,i,s);return new b.yC1(e+"."+a,h,d)}generateRotationTrack(e,i,s,a,h,d){i.x!==void 0&&(this.interpolateRotations(i.x),i.x.values=i.x.values.map(b.M8C.degToRad)),i.y!==void 0&&(this.interpolateRotations(i.y),i.y.values=i.y.values.map(b.M8C.degToRad)),i.z!==void 0&&(this.interpolateRotations(i.z),i.z.values=i.z.values.map(b.M8C.degToRad));const _=this.getTimesForAllAxes(i),et=this.getKeyframeTrackValues(_,i,s);a!==void 0&&((a=a.map(b.M8C.degToRad)).push(d),a=new b.USm().fromArray(a),a=new b._fP().setFromEuler(a)),h!==void 0&&((h=h.map(b.M8C.degToRad)).push(d),h=new b.USm().fromArray(h),h=new b._fP().setFromEuler(h).invert());const nt=new b._fP,it=new b.USm,lt=[];for(let dt=0;dt<et.length;dt+=3)it.set(et[dt],et[dt+1],et[dt+2],d),nt.setFromEuler(it),a!==void 0&&nt.premultiply(a),h!==void 0&&nt.multiply(h),nt.toArray(lt,dt/3*4);return new b.iLg(e+".quaternion",_,lt)}generateMorphTrack(e){const i=e.DeformPercent.curves.morph,s=i.values.map(function(h){return h/100}),a=fp.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new b.dUE(e.modelName+".morphTargetInfluences["+a+"]",i.times,s)}getTimesForAllAxes(e){let i=[];if(e.x!==void 0&&(i=i.concat(e.x.times)),e.y!==void 0&&(i=i.concat(e.y.times)),e.z!==void 0&&(i=i.concat(e.z.times)),i=i.sort(function(s,a){return s-a}),i.length>1){let s=1,a=i[0];for(let h=1;h<i.length;h++){const d=i[h];d!==a&&(i[s]=d,a=d,s++)}i=i.slice(0,s)}return i}getKeyframeTrackValues(e,i,s){const a=s,h=[];let d=-1,_=-1,et=-1;return e.forEach(function(nt){if(i.x&&(d=i.x.times.indexOf(nt)),i.y&&(_=i.y.times.indexOf(nt)),i.z&&(et=i.z.times.indexOf(nt)),d!==-1){const it=i.x.values[d];h.push(it),a[0]=it}else h.push(a[0]);if(_!==-1){const it=i.y.values[_];h.push(it),a[1]=it}else h.push(a[1]);if(et!==-1){const it=i.z.values[et];h.push(it),a[2]=it}else h.push(a[2])}),h}interpolateRotations(e){for(let i=1;i<e.values.length;i++){const s=e.values[i-1],a=e.values[i]-s,h=Math.abs(a);if(h>=180){const d=h/180,_=a/d;let et=s+_;const nt=e.times[i-1],it=(e.times[i]-nt)/d;let lt=nt+it;const dt=[],pt=[];for(;lt<e.times[i];)dt.push(lt),lt+=it,pt.push(et),et+=_;e.times=co(e.times,i,dt),e.values=co(e.values,i,pt)}}}}class VE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,i){this.currentProp=e,this.currentPropName=i}parse(e){this.currentIndent=0,this.allNodes=new YC,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const i=this,s=e.split(/[\r\n]+/);return s.forEach(function(a,h){const d=a.match(/^[\s\t]*;/),_=a.match(/^[\s\t]*$/);if(d||_)return;const et=a.match("^\\t{"+i.currentIndent+"}(\\w+):(.*){",""),nt=a.match("^\\t{"+i.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),it=a.match("^\\t{"+(i.currentIndent-1)+"}}");et?i.parseNodeBegin(a,et):nt?i.parseNodeProperty(a,nt,s[++h]):it?i.popStack():a.match(/^[^\s\t}]/)&&i.parseNodePropertyContinued(a)}),this.allNodes}parseNodeBegin(e,i){const s=i[1].trim().replace(/^"/,"").replace(/"$/,""),a=i[2].split(",").map(function(et){return et.trim().replace(/^"/,"").replace(/"$/,"")}),h={name:s},d=this.parseNodeAttr(a),_=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(s,h):s in _?(s==="PoseNode"?_.PoseNode.push(h):_[s].id!==void 0&&(_[s]={},_[s][_[s].id]=_[s]),d.id!==""&&(_[s][d.id]=h)):typeof d.id=="number"?(_[s]={},_[s][d.id]=h):s!=="Properties70"&&(_[s]=s==="PoseNode"?[h]:h),typeof d.id=="number"&&(h.id=d.id),d.name!==""&&(h.attrName=d.name),d.type!==""&&(h.attrType=d.type),this.pushStack(h)}parseNodeAttr(e){let i=e[0];e[0]!==""&&(i=parseInt(e[0]),isNaN(i)&&(i=e[0]));let s="",a="";return e.length>1&&(s=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:i,name:s,type:a}}parseNodeProperty(e,i,s){let a=i[1].replace(/^"/,"").replace(/"$/,"").trim(),h=i[2].replace(/^"/,"").replace(/"$/,"").trim();a==="Content"&&h===","&&(h=s.replace(/"/g,"").replace(/,$/,"").trim());const d=this.getCurrentNode();if(d.name!=="Properties70"){if(a==="C"){const _=h.split(",").slice(1),et=parseInt(_[0]),nt=parseInt(_[1]);let it=h.split(",").slice(3);it=it.map(function(lt){return lt.trim().replace(/^"/,"")}),a="connections",h=[et,nt],function(lt,dt){for(let pt=0,gt=lt.length,vt=dt.length;pt<vt;pt++,gt++)lt[gt]=dt[pt]}(h,it),d[a]===void 0&&(d[a]=[])}a==="Node"&&(d.id=h),a in d&&Array.isArray(d[a])?d[a].push(h):a!=="a"?d[a]=h:d.a=h,this.setCurrentProp(d,a),a==="a"&&h.slice(-1)!==","&&(d.a=Js(h))}else this.parseNodeSpecialProperty(e,a,h)}parseNodePropertyContinued(e){const i=this.getCurrentNode();i.a+=e,e.slice(-1)!==","&&(i.a=Js(i.a))}parseNodeSpecialProperty(e,i,s){const a=s.split('",').map(function(it){return it.trim().replace(/^\"/,"").replace(/\s/,"_")}),h=a[0],d=a[1],_=a[2],et=a[3];let nt=a[4];switch(d){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":nt=parseFloat(nt);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":nt=Js(nt)}this.getPrevNode()[h]={type:d,type2:_,flag:et,value:nt},this.setCurrentProp(this.getPrevNode(),h)}}class xD{parse(e){const i=new zx(e);i.skip(23);const s=i.getUint32();if(s<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+s);const a=new YC;for(;!this.endOfContent(i);){const h=this.parseNode(i,s);h!==null&&a.add(h.name,h)}return a}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,i){const s={},a=i>=7500?e.getUint64():e.getUint32(),h=i>=7500?e.getUint64():e.getUint32();i>=7500?e.getUint64():e.getUint32();const d=e.getUint8(),_=e.getString(d);if(a===0)return null;const et=[];for(let dt=0;dt<h;dt++)et.push(this.parseProperty(e));const nt=et.length>0?et[0]:"",it=et.length>1?et[1]:"",lt=et.length>2?et[2]:"";for(s.singleProperty=h===1&&e.getOffset()===a;a>e.getOffset();){const dt=this.parseNode(e,i);dt!==null&&this.parseSubNode(_,s,dt)}return s.propertyList=et,typeof nt=="number"&&(s.id=nt),it!==""&&(s.attrName=it),lt!==""&&(s.attrType=lt),_!==""&&(s.name=_),s}parseSubNode(e,i,s){if(s.singleProperty===!0){const a=s.propertyList[0];Array.isArray(a)?(i[s.name]=s,s.a=a):i[s.name]=a}else if(e==="Connections"&&s.name==="C"){const a=[];s.propertyList.forEach(function(h,d){d!==0&&a.push(h)}),i.connections===void 0&&(i.connections=[]),i.connections.push(a)}else if(s.name==="Properties70")Object.keys(s).forEach(function(a){i[a]=s[a]});else if(e==="Properties70"&&s.name==="P"){let a=s.propertyList[0],h=s.propertyList[1];const d=s.propertyList[2],_=s.propertyList[3];let et;a.indexOf("Lcl ")===0&&(a=a.replace("Lcl ","Lcl_")),h.indexOf("Lcl ")===0&&(h=h.replace("Lcl ","Lcl_")),et=h==="Color"||h==="ColorRGB"||h==="Vector"||h==="Vector3D"||h.indexOf("Lcl_")===0?[s.propertyList[4],s.propertyList[5],s.propertyList[6]]:s.propertyList[4],i[a]={type:h,type2:d,flag:_,value:et}}else i[s.name]===void 0?typeof s.id=="number"?(i[s.name]={},i[s.name][s.id]=s):i[s.name]=s:s.name==="PoseNode"?(Array.isArray(i[s.name])||(i[s.name]=[i[s.name]]),i[s.name].push(s)):i[s.name][s.id]===void 0&&(i[s.name][s.id]=s)}parseProperty(e){const i=e.getString(1);let s;switch(i){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return s=e.getUint32(),e.getArrayBuffer(s);case"S":return s=e.getUint32(),e.getString(s);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const a=e.getUint32(),h=e.getUint32(),d=e.getUint32();if(h===0)switch(i){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}tt===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const _=Or(new Uint8Array(e.getArrayBuffer(d))),et=new zx(_.buffer);switch(i){case"b":case"c":return et.getBooleanArray(a);case"d":return et.getFloat64Array(a);case"f":return et.getFloat32Array(a);case"i":return et.getInt32Array(a);case"l":return et.getInt64Array(a)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+i)}}}class zx{constructor(e,i){this.dv=new DataView(e),this.offset=0,this.littleEndian=i===void 0||i}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const i=[];for(let s=0;s<e;s++)i.push(this.getBoolean());return i}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt32());return i}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),2147483648&i?(i=4294967295&~i,e=4294967295&~e,e===4294967295&&(i=i+1&4294967295),e=e+1&4294967295,-(4294967296*i+e)):4294967296*i+e}getInt64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getInt64());return i}getUint64(){let e,i;return this.littleEndian?(e=this.getUint32(),i=this.getUint32()):(i=this.getUint32(),e=this.getUint32()),4294967296*i+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat32());return i}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const i=[];for(let s=0;s<e;s++)i.push(this.getFloat64());return i}getArrayBuffer(e){const i=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,i}getString(e){let i=[];for(let a=0;a<e;a++)i[a]=this.getUint8();const s=i.indexOf(0);return s>=0&&(i=i.slice(0,s)),b.Zp0.decodeText(new Uint8Array(i))}}class YC{add(e,i){this[e]=i}}function Sn(c){const e=c.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function fr(c){return c/46186158e3}const br=[];function yr(c,e,i,s){let a;switch(s.mappingType){case"ByPolygonVertex":a=c;break;case"ByPolygon":a=e;break;case"ByVertice":a=i;break;case"AllSame":a=s.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+s.mappingType)}s.referenceType==="IndexToDirect"&&(a=s.indices[a]);const h=a*s.dataSize,d=h+s.dataSize;return function(_,et,nt,it){for(let lt=nt,dt=0;lt<it;lt++,dt++)_[dt]=et[lt];return _}(br,s.buffer,h,d)}const Ur=new b.USm,cs=new b.Pa4;function lo(c){const e=new b.yGw,i=new b.yGw,s=new b.yGw,a=new b.yGw,h=new b.yGw,d=new b.yGw,_=new b.yGw,et=new b.yGw,nt=new b.yGw,it=new b.yGw,lt=new b.yGw,dt=new b.yGw,pt=c.inheritType?c.inheritType:0;if(c.translation&&e.setPosition(cs.fromArray(c.translation)),c.preRotation){const cn=c.preRotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),i.makeRotationFromEuler(Ur.fromArray(cn))}if(c.rotation){const cn=c.rotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),s.makeRotationFromEuler(Ur.fromArray(cn))}if(c.postRotation){const cn=c.postRotation.map(b.M8C.degToRad);cn.push(c.eulerOrder||b.USm.DefaultOrder),a.makeRotationFromEuler(Ur.fromArray(cn)),a.invert()}c.scale&&h.scale(cs.fromArray(c.scale)),c.scalingOffset&&_.setPosition(cs.fromArray(c.scalingOffset)),c.scalingPivot&&d.setPosition(cs.fromArray(c.scalingPivot)),c.rotationOffset&&et.setPosition(cs.fromArray(c.rotationOffset)),c.rotationPivot&&nt.setPosition(cs.fromArray(c.rotationPivot)),c.parentMatrixWorld&&(lt.copy(c.parentMatrix),it.copy(c.parentMatrixWorld));const gt=i.clone().multiply(s).multiply(a),vt=new b.yGw;vt.extractRotation(it);const Ct=new b.yGw;Ct.copyPosition(it);const wt=Ct.clone().invert().multiply(it),xt=vt.clone().invert().multiply(wt),_t=h,Pt=new b.yGw;if(pt===0)Pt.copy(vt).multiply(gt).multiply(xt).multiply(_t);else if(pt===1)Pt.copy(vt).multiply(xt).multiply(gt).multiply(_t);else{const cn=new b.yGw().scale(new b.Pa4().setFromMatrixScale(lt)).clone().invert(),An=xt.clone().multiply(cn);Pt.copy(vt).multiply(gt).multiply(An).multiply(_t)}const Rt=nt.clone().invert(),Lt=d.clone().invert();let Ot=e.clone().multiply(et).multiply(nt).multiply(i).multiply(s).multiply(a).multiply(Rt).multiply(_).multiply(d).multiply(h).multiply(Lt);const qt=new b.yGw().copyPosition(Ot),en=it.clone().multiply(qt);return dt.copyPosition(en),Ot=dt.clone().multiply(Pt),Ot.premultiply(it.invert()),Ot}function Es(c){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(c=c||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[c]}function Js(c){return c.split(",").map(function(e){return parseFloat(e)})}function _l(c,e,i){return e===void 0&&(e=0),i===void 0&&(i=c.byteLength),b.Zp0.decodeText(new Uint8Array(c,e,i))}function co(c,e,i){return c.slice(0,e).concat(i).concat(c.slice(e))}class Hs extends st{constructor(){super(...arguments),this.dependencies=[Yr],this._importer=new Zo(fI,["fbx"],!0)}async onAdded(e){Gs.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1)}}Hs.PluginType="FBXLoadPlugin";const Jl=new WeakMap;class Vx extends b.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,i,s,a){const h=new b.hH6(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),this.url=e,h.load(e,d=>{if(Jl.has(d))return Jl.get(d).promise.then(i).catch(a);this.decodeObjects(d,e).then(_=>{_.userData.warnings=this.warnings,i(_)}).catch(_=>a(_))},s,a)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,i){let s,a;const h=e.byteLength,d=this._getWorker(h).then(_=>(s=_,a=this.workerNextTaskID++,new Promise((et,nt)=>{s._callbacks[a]={resolve:et,reject:nt},s.postMessage({type:"decode",id:a,buffer:e},[e])}))).then(_=>this._createGeometry(_.data)).catch(_=>{throw _});return d.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),Jl.set(e,{url:i,promise:d}),d}parse(e,i,s){this.decodeObjects(e,"").then(a=>{a.userData.warnings=this.warnings,i(a)}).catch(a=>s(a))}_compareMaterials(e){const i={};i.name=e.name,i.color={},i.color.r=e.color.r,i.color.g=e.color.g,i.color.b=e.color.b,i.type=e.type;for(let s=0;s<this.materials.length;s++){const a=this.materials[s],h={};if(h.name=a.name,h.color={},h.color.r=a.color.r,h.color.g=a.color.g,h.color.b=a.color.b,h.type=a.type,JSON.stringify(i)===JSON.stringify(h))return a}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new b.Wid({color:new b.Ilk(1,1,1),metalness:.8,name:"default",side:2});const i=e.diffuseColor,s=new b.Ilk(i.r/255,i.g/255,i.b/255);i.r===0&&i.g===0&&i.b===0&&(s.r=1,s.g=1,s.b=1);const a=new b.Wid({color:s,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),h=new b.dpR;for(let d=0;d<e.textures.length;d++){const _=e.textures[d];if(_.image!==null){const et=h.load(_.image);switch(_.type){case"Diffuse":a.map=et;break;case"Bump":a.bumpMap=et;break;case"Transparency":a.alphaMap=et,a.transparent=!0;break;case"Emap":a.envMap=et}et.wrapS=_.wrapU===0?b.rpg:b.uWy,et.wrapT=_.wrapV===0?b.rpg:b.uWy,et.repeat.set(_.repeat[0],_.repeat[1])}}return a}_createGeometry(e){const i=new b.Tme,s=[],a=[],h=[];i.userData.layers=e.layers,i.userData.groups=e.groups,i.userData.settings=e.settings,i.userData.objectType="File3dm",i.userData.materials=null,i.name=this.url;let d=e.objects;const _=e.materials;for(let et=0;et<d.length;et++){const nt=d[et],it=nt.attributes;switch(nt.objectType){case"InstanceDefinition":a.push(nt);break;case"InstanceReference":h.push(nt);break;default:let lt;if(it.materialIndex>=0){const pt=_[it.materialIndex];let gt=this._createMaterial(pt);gt=this._compareMaterials(gt),lt=this._createObject(nt,gt)}else{const pt=this._createMaterial();lt=this._createObject(nt,pt)}if(lt===void 0)continue;const dt=e.layers[it.layerIndex];lt.visible=!dt||e.layers[it.layerIndex].visible,it.isInstanceDefinitionObject?s.push(lt):i.add(lt)}}for(let et=0;et<a.length;et++){const nt=a[et];d=[];for(let it=0;it<nt.attributes.objectIds.length;it++){const lt=nt.attributes.objectIds[it];for(let dt=0;dt<s.length;dt++)lt===s[dt].userData.attributes.id&&d.push(s[dt])}for(let it=0;it<h.length;it++){const lt=h[it];if(lt.geometry.parentIdefId===nt.attributes.id){const dt=new b.Tme,pt=lt.geometry.xform.array,gt=new b.yGw;gt.set(pt[0],pt[1],pt[2],pt[3],pt[4],pt[5],pt[6],pt[7],pt[8],pt[9],pt[10],pt[11],pt[12],pt[13],pt[14],pt[15]),dt.applyMatrix4(gt);for(let vt=0;vt<d.length;vt++)dt.add(d[vt].clone(!0));i.add(dt)}}}return i.userData.materials=this.materials,i}_createObject(e,i){const s=new b.s4_,a=e.attributes;let h,d,_,et;switch(e.objectType){case"Point":case"PointSet":h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")?d=new b.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(_=a.drawColor,et=new b.Ilk(_.r/255,_.g/255,_.b/255),d=new b.UY4({color:et,sizeAttenuation:!1,size:2})),d=this._compareMaterials(d);const nt=new b.woe(h,d);return nt.userData.attributes=a,nt.userData.objectType=e.objectType,a.name&&(nt.name=a.name),nt;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;h=s.parse(e.geometry),h.attributes.hasOwnProperty("color")&&(i.vertexColors=!0),i===null&&(i=this._createMaterial(),i=this._compareMaterials(i));const it=new b.Kj0(h,i);return it.castShadow=a.castsShadows,it.receiveShadow=a.receivesShadows,it.userData.attributes=a,it.userData.objectType=e.objectType,a.name&&(it.name=a.name),it;case"Curve":h=s.parse(e.geometry),_=a.drawColor,et=new b.Ilk(_.r/255,_.g/255,_.b/255),d=new b.nls({color:et}),d=this._compareMaterials(d);const lt=new b.x12(h,d);return lt.userData.attributes=a,lt.userData.objectType=e.objectType,a.name&&(lt.name=a.name),lt;case"TextDot":h=e.geometry;const dt=document.createElement("canvas").getContext("2d"),pt=`${h.fontHeight}px ${h.fontFace}`;dt.font=pt;const gt=dt.measureText(h.text).width+10,vt=h.fontHeight+10,Ct=window.devicePixelRatio;dt.canvas.width=gt*Ct,dt.canvas.height=vt*Ct,dt.canvas.style.width=gt+"px",dt.canvas.style.height=vt+"px",dt.setTransform(Ct,0,0,Ct,0,0),dt.font=pt,dt.textBaseline="middle",dt.textAlign="center",et=a.drawColor,dt.fillStyle=`rgba(${et.r},${et.g},${et.b},${et.a})`,dt.fillRect(0,0,gt,vt),dt.fillStyle="white",dt.fillText(h.text,gt/2,vt/2);const wt=new b.ROQ(dt.canvas);wt.minFilter=b.wem,wt.wrapS=b.uWy,wt.wrapT=b.uWy,d=new b.xeV({map:wt,depthTest:!1});const xt=new b.jyi(d);return xt.position.set(h.point[0],h.point[1],h.point[2]),xt.scale.set(gt/10,vt/10,1),xt.userData.attributes=a,xt.userData.objectType=e.objectType,a.name&&(xt.name=a.name),xt;case"Light":let _t;switch(h=e.geometry,h.lightStyle.name){case"LightStyle_WorldPoint":_t=new b.cek,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":_t=new b.PMe,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.target.position.set(h.direction[0],h.direction[1],h.direction[2]),_t.angle=h.spotAngleRadians,_t.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":_t=new b.T_f;const Pt=Math.abs(h.width[2]),Rt=Math.abs(h.length[0]);_t.position.set(h.location[0]-Rt/2,h.location[1],h.location[2]-Pt/2),_t.height=Rt,_t.width=Pt,_t.lookAt(new b.Pa4(h.direction[0],h.direction[1],h.direction[2]));break;case"LightStyle_WorldDirectional":_t=new b.Ox3,_t.castShadow=a.castsShadows,_t.position.set(h.location[0],h.location[1],h.location[2]),_t.target.position.set(h.direction[0],h.direction[1],h.direction[2]),_t.shadow.normalBias=.1}return _t&&(_t.intensity=h.intensity,_=h.diffuse,et=new b.Ilk(_.r/255,_.g/255,_.b/255),_t.color=et,_t.userData.attributes=a,_t.userData.objectType=e.objectType),_t}}_initLibrary(){if(!this.libraryPending){const e=new b.hH6(this.manager);e.setPath(this.libraryPath);const i=new Promise((h,d)=>{e.load("rhino3dm.js",h,void 0,d)}),s=new b.hH6(this.manager);s.setPath(this.libraryPath),s.setResponseType("arraybuffer");const a=new Promise((h,d)=>{s.load("rhino3dm.wasm",h,void 0,d)});this.libraryPending=Promise.all([i,a]).then(([h,d])=>{this.libraryConfig.wasmBinary=d;const _=km.toString(),et=["/* rhino3dm.js */",h,"/* worker */",_.substring(_.indexOf("{")+1,_.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([et]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const s=new Worker(this.workerSourceURL);s._callbacks={},s._taskCosts={},s._taskLoad=0,s.postMessage({type:"init",libraryConfig:this.libraryConfig}),s.onmessage=a=>{const h=a.data;switch(h.type){case"warning":this.warnings.push(h.data),console.warn(h.data);break;case"decode":s._callbacks[h.id].resolve(h);break;case"error":s._callbacks[h.id].reject(h);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+h.type+'"')}},this.workerPool.push(s)}else this.workerPool.sort(function(s,a){return s._taskLoad>a._taskLoad?-1:1});const i=this.workerPool[this.workerPool.length-1];return i._taskLoad+=e,i})}_releaseTask(e,i){e._taskLoad-=e._taskCosts[i],delete e._callbacks[i],delete e._taskCosts[i]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function km(){let c,e,i,s;function a(_,et){const nt=_.geometry(),it=_.attributes();let lt,dt,pt,gt,vt,Ct=nt.objectType;switch(Ct){case i.ObjectType.Curve:const wt=d(nt,100);pt={},dt={},gt={},pt.itemSize=3,pt.type="Float32Array",pt.array=[];for(let Lt=0;Lt<wt.length;Lt++)pt.array.push(wt[Lt][0]),pt.array.push(wt[Lt][1]),pt.array.push(wt[Lt][2]);dt.position=pt,gt.attributes=dt,lt={data:gt};break;case i.ObjectType.Point:const xt=nt.location;pt={};const _t={};dt={},gt={},pt.itemSize=3,pt.type="Float32Array",pt.array=[xt[0],xt[1],xt[2]];const Pt=it.drawColor(et);_t.itemSize=3,_t.type="Float32Array",_t.array=[Pt.r/255,Pt.g/255,Pt.b/255],dt.position=pt,dt.color=_t,gt.attributes=dt,lt={data:gt};break;case i.ObjectType.PointSet:case i.ObjectType.Mesh:lt=nt.toThreejsJSON();break;case i.ObjectType.Brep:const Rt=nt.faces();vt=new i.Mesh;for(let Lt=0;Lt<Rt.count;Lt++){const Ot=Rt.get(Lt),qt=Ot.getMesh(i.MeshType.Any);qt&&(vt.append(qt),qt.delete()),Ot.delete()}vt.faces().count>0&&(vt.compact(),lt=vt.toThreejsJSON(),Rt.delete()),vt.delete();break;case i.ObjectType.Extrusion:vt=nt.getMesh(i.MeshType.Any),vt&&(lt=vt.toThreejsJSON(),vt.delete());break;case i.ObjectType.TextDot:lt=h(nt);break;case i.ObjectType.Light:lt=h(nt),lt.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: No conversion exists for ${Ct.constructor.name} ${lt.lightStyle.name}`,type:"no conversion",guid:it.id}});break;case i.ObjectType.InstanceReference:lt=h(nt),lt.xform=h(nt.xform),lt.xform.array=nt.xform.toFloatArray(!0);break;case i.ObjectType.SubD:nt.subdivide(3),vt=i.Mesh.createFromSubDControlNet(nt),vt&&(lt=vt.toThreejsJSON(),vt.delete());break;default:self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Conversion not implemented for ${Ct.constructor.name}`,type:"not implemented",guid:it.id}})}if(lt)return dt=h(it),dt.geometry=h(nt),it.groupCount>0&&(dt.groupIds=it.getGroupList()),it.userStringCount>0&&(dt.userStrings=it.getUserStrings()),nt.userStringCount>0&&(dt.geometry.userStrings=nt.getUserStrings()),dt.drawColor=it.drawColor(et),Ct=Ct.constructor.name,Ct=Ct.substring(11,Ct.length),{geometry:lt,attributes:dt,objectType:Ct};self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: ${Ct.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:it.id}})}function h(_){const et={};for(const nt in _){const it=_[nt];typeof it!="function"&&(typeof it=="object"&&it!==null&&it.hasOwnProperty("constructor")?et[nt]={name:it.constructor.name,value:it.value}:et[nt]=it)}return et}function d(_,et){let nt=et,it=[];const lt=[];if(_ instanceof i.LineCurve)return[_.pointAtStart,_.pointAtEnd];if(_ instanceof i.PolylineCurve){nt=_.pointCount;for(let gt=0;gt<nt;gt++)it.push(_.point(gt));return it}if(_ instanceof i.PolyCurve){const gt=_.segmentCount;for(let vt=0;vt<gt;vt++){const Ct=_.segmentCurve(vt),wt=d(Ct,nt);it=it.concat(wt),Ct.delete()}return it}if(_ instanceof i.ArcCurve&&(nt=Math.floor(_.angleDegrees/5),nt=nt<2?2:nt),_ instanceof i.NurbsCurve&&_.degree===1){const gt=_.tryGetPolyline();for(let vt=0;vt<gt.count;vt++)it.push(gt.get(vt));return gt.delete(),it}const dt=_.domain,pt=nt-1;for(let gt=0;gt<nt;gt++){const vt=dt[0]+gt/pt*(dt[1]-dt[0]);if(vt===dt[0]||vt===dt[1]){lt.push(vt);continue}const Ct=_.tangentAt(vt),wt=_.tangentAt(lt.slice(-1)[0]),xt=Ct[0]*Ct[0]+Ct[1]*Ct[1]+Ct[2]*Ct[2],_t=wt[0]*wt[0]+wt[1]*wt[1]+wt[2]*wt[2],Pt=Math.sqrt(xt*_t);let Rt;if(Pt===0)Rt=Math.PI/2;else{const Lt=(Ct.x*wt.x+Ct.y*wt.y+Ct.z*wt.z)/Pt;Rt=Math.acos(Math.max(-1,Math.min(1,Lt)))}Rt<.1||lt.push(vt)}return it=lt.map(gt=>_.pointAt(gt)),it}onmessage=function(_){const et=_.data;switch(et.type){case"init":e=et.libraryConfig;const nt=e.wasmBinary;let it;c=new Promise(function(dt){it={wasmBinary:nt,onRuntimeInitialized:dt},rhino3dm(it)}).then(()=>{i=it});break;case"decode":s=et.id;const lt=et.buffer;c.then(()=>{try{const dt=function(pt,gt){const vt=new Uint8Array(gt),Ct=pt.File3dm.fromByteArray(vt),wt=[],xt=[],_t=[],Pt=[],Rt=[],Lt=[],Ot=[],qt=Ct.objects(),en=qt.count;for(let gn=0;gn<en;gn++){const xn=qt.get(gn),Nn=a(xn,Ct);xn.delete(),Nn&&wt.push(Nn)}for(let gn=0;gn<Ct.instanceDefinitions().count();gn++){const xn=Ct.instanceDefinitions().get(gn),Nn=h(xn);Nn.objectIds=xn.getObjectIds(),wt.push({geometry:null,attributes:Nn,objectType:"InstanceDefinition"})}const cn=[pt.TextureType.Diffuse,pt.TextureType.Bump,pt.TextureType.Transparency,pt.TextureType.Opacity,pt.TextureType.Emap],An=[pt.TextureType.PBR_BaseColor,pt.TextureType.PBR_Subsurface,pt.TextureType.PBR_SubsurfaceScattering,pt.TextureType.PBR_SubsurfaceScatteringRadius,pt.TextureType.PBR_Metallic,pt.TextureType.PBR_Specular,pt.TextureType.PBR_SpecularTint,pt.TextureType.PBR_Roughness,pt.TextureType.PBR_Anisotropic,pt.TextureType.PBR_Anisotropic_Rotation,pt.TextureType.PBR_Sheen,pt.TextureType.PBR_SheenTint,pt.TextureType.PBR_Clearcoat,pt.TextureType.PBR_ClearcoatBump,pt.TextureType.PBR_ClearcoatRoughness,pt.TextureType.PBR_OpacityIor,pt.TextureType.PBR_OpacityRoughness,pt.TextureType.PBR_Emission,pt.TextureType.PBR_AmbientOcclusion,pt.TextureType.PBR_Displacement];for(let gn=0;gn<Ct.materials().count();gn++){const xn=Ct.materials().get(gn),Nn=xn.physicallyBased();let Mn=h(xn);const Hn=[];for(let rr=0;rr<cn.length;rr++){const cr=xn.getTexture(cn[rr]);if(cr){let _i=cn[rr].constructor.name;_i=_i.substring(12,_i.length);const xr={type:_i},Mr=Ct.getEmbeddedFileAsBase64(cr.fileName);xr.wrapU=cr.wrapU,xr.wrapV=cr.wrapV,xr.wrapW=cr.wrapW;const Tr=cr.uvwTransform.toFloatArray(!0);xr.repeat=[Tr[0],Tr[5]],Mr?xr.image="data:image/png;base64,"+Mr:(self.postMessage({type:"warning",id:s,data:{message:`THREE.3DMLoader: Image for ${_i} texture not embedded in file.`,type:"missing resource"}}),xr.image=null),Hn.push(xr),cr.delete()}}if(Mn.textures=Hn,Nn.supported){for(let cr=0;cr<An.length;cr++){const _i=xn.getTexture(An[cr]);if(_i){const xr=Ct.getEmbeddedFileAsBase64(_i.fileName);let Mr=An[cr].constructor.name;Mr=Mr.substring(12,Mr.length);const Tr={type:Mr,image:"data:image/png;base64,"+xr};Hn.push(Tr),_i.delete()}}const rr=h(xn.physicallyBased());Mn=Object.assign(rr,Mn)}xt.push(Mn),xn.delete(),Nn.delete()}for(let gn=0;gn<Ct.layers().count();gn++){const xn=Ct.layers().get(gn),Nn=h(xn);_t.push(Nn),xn.delete()}for(let gn=0;gn<Ct.views().count();gn++){const xn=Ct.views().get(gn),Nn=h(xn);Pt.push(Nn),xn.delete()}for(let gn=0;gn<Ct.namedViews().count();gn++){const xn=Ct.namedViews().get(gn),Nn=h(xn);Rt.push(Nn),xn.delete()}for(let gn=0;gn<Ct.groups().count();gn++){const xn=Ct.groups().get(gn),Nn=h(xn);Lt.push(Nn),xn.delete()}const fn=h(Ct.settings()),Tn=Ct.strings().count();for(let gn=0;gn<Tn;gn++)Ot.push(Ct.strings().get(gn));return Ct.delete(),{objects:wt,materials:xt,layers:_t,views:Pt,namedViews:Rt,groups:Lt,strings:Ot,settings:fn}}(i,lt);self.postMessage({type:"decode",id:et.id,data:dt})}catch(dt){self.postMessage({type:"error",id:et.id,error:dt})}})}}}class QE extends Vx{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.11.1/")}async loadAsync(e,i){return await super.loadAsync(e,i)}}class Zv extends st{constructor(){super(...arguments),this.dependencies=[Yr],this._importer=new Zo(QE,["3dm"],!0)}async onAdded(e){Gs.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1)}}Zv.PluginType="Rhino3dmLoadPlugin";class XC extends st{constructor(){super(...arguments),this.dependencies=[Yr]}async onAdded(e){const i=document.createElement("script");i.type="module",i.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(i),this._script=i}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}XC.PluginType="GLTFMeshOptPlugin";class GE extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=new b.hH6(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(_){try{i(h.parse(_))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}parse(e){function i(h,d,_){for(let et=0,nt=h.length;et<nt;et++)if(h[et]!==d.getUint8(_+et))return!1;return!0}const s=function(h){if(typeof h=="string"){const d=new Uint8Array(h.length);for(let _=0;_<h.length;_++)d[_]=255&h.charCodeAt(_);return d.buffer||d}return h}(e);return function(h){const d=new DataView(h);if(84+50*d.getUint32(80,!0)===d.byteLength)return!0;const _=[115,111,108,105,100];for(let et=0;et<5;et++)if(i(_,d,et))return!1;return!0}(s)?function(h){const d=new DataView(h),_=d.getUint32(80,!0);let et,nt,it,lt,dt,pt,gt,vt,Ct=!1;for(let Pt=0;Pt<70;Pt++)d.getUint32(Pt,!1)==1129270351&&d.getUint8(Pt+4)==82&&d.getUint8(Pt+5)==61&&(Ct=!0,lt=new Float32Array(3*_*3),dt=d.getUint8(Pt+6)/255,pt=d.getUint8(Pt+7)/255,gt=d.getUint8(Pt+8)/255,vt=d.getUint8(Pt+9)/255);const wt=new b.u9r,xt=new Float32Array(3*_*3),_t=new Float32Array(3*_*3);for(let Pt=0;Pt<_;Pt++){const Rt=84+50*Pt,Lt=d.getFloat32(Rt,!0),Ot=d.getFloat32(Rt+4,!0),qt=d.getFloat32(Rt+8,!0);if(Ct){const en=d.getUint16(Rt+48,!0);32768&en?(et=dt,nt=pt,it=gt):(et=(31&en)/31,nt=(en>>5&31)/31,it=(en>>10&31)/31)}for(let en=1;en<=3;en++){const cn=Rt+12*en,An=3*Pt*3+3*(en-1);xt[An]=d.getFloat32(cn,!0),xt[An+1]=d.getFloat32(cn+4,!0),xt[An+2]=d.getFloat32(cn+8,!0),_t[An]=Lt,_t[An+1]=Ot,_t[An+2]=qt,Ct&&(lt[An]=et,lt[An+1]=nt,lt[An+2]=it)}}return wt.setAttribute("position",new b.TlE(xt,3)),wt.setAttribute("normal",new b.TlE(_t,3)),Ct&&(wt.setAttribute("color",new b.TlE(lt,3)),wt.hasColors=!0,wt.alpha=vt),wt}(s):function(h){const d=new b.u9r,_=/solid([\s\S]*?)endsolid/g,et=/facet([\s\S]*?)endfacet/g;let nt=0;const it=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,lt=new RegExp("vertex"+it+it+it,"g"),dt=new RegExp("normal"+it+it+it,"g"),pt=[],gt=[],vt=new b.Pa4;let Ct,wt=0,xt=0,_t=0;for(;(Ct=_.exec(h))!==null;){xt=_t;const Pt=Ct[0];for(;(Ct=et.exec(Pt))!==null;){let Ot=0,qt=0;const en=Ct[0];for(;(Ct=dt.exec(en))!==null;)vt.x=parseFloat(Ct[1]),vt.y=parseFloat(Ct[2]),vt.z=parseFloat(Ct[3]),qt++;for(;(Ct=lt.exec(en))!==null;)pt.push(parseFloat(Ct[1]),parseFloat(Ct[2]),parseFloat(Ct[3])),gt.push(vt.x,vt.y,vt.z),Ot++,_t++;qt!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+nt),Ot!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+nt),nt++}const Rt=xt,Lt=_t-xt;d.addGroup(Rt,Lt,wt),wt++}return d.setAttribute("position",new b.a$l(pt,3)),d.setAttribute("normal",new b.a$l(gt,3)),d}(typeof(a=e)!="string"?b.Zp0.decodeText(new Uint8Array(a)):a);var a}}class KC extends st{constructor(){super(...arguments),this.dependencies=[Yr]}async onAdded(e){this._importer||(this._importer=new Zo(GE,["stl"],!0)),Gs.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1),this._importer=void 0}}KC.PluginType="STLLoadPlugin";class Qx extends b.aNw{constructor(e){super(e)}load(e,i,s,a){const h=this,d=this.path===""?b.Zp0.extractUrlBase(e):this.path,_=new b.hH6(this.manager);_.setPath(this.path),_.setRequestHeader(this.requestHeader),_.setWithCredentials(this.withCredentials),_.load(e,function(et){try{i(h.parse(et,d))}catch(nt){a?a(nt):console.error(nt),h.manager.itemError(e)}},s,a)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,i){const s=e.split(`
`);let a={};const h=/\s+/,d={};for(let et=0;et<s.length;et++){let nt=s[et];if(nt=nt.trim(),nt.length===0||nt.charAt(0)==="#")continue;const it=nt.indexOf(" ");let lt=it>=0?nt.substring(0,it):nt;lt=lt.toLowerCase();let dt=it>=0?nt.substring(it+1):"";if(dt=dt.trim(),lt==="newmtl")a={name:dt},d[dt]=a;else if(lt==="ka"||lt==="kd"||lt==="ks"||lt==="ke"){const pt=dt.split(h,3);a[lt]=[parseFloat(pt[0]),parseFloat(pt[1]),parseFloat(pt[2])]}else a[lt]=dt}const _=new Fu(this.resourcePath||i,this.materialOptions);return _.setCrossOrigin(this.crossOrigin),_.setManager(this.manager),_.setMaterials(d),_}}class Fu{constructor(e="",i={}){this.baseUrl=e,this.options=i,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:b.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:b.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const i={};for(const s in e){const a=e[s],h={};i[s]=h;for(const d in a){let _=!0,et=a[d];const nt=d.toLowerCase();switch(nt){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(et=[et[0]/255,et[1]/255,et[2]/255]),this.options&&this.options.ignoreZeroRGBs&&et[0]===0&&et[1]===0&&et[2]===0&&(_=!1)}_&&(h[nt]=et)}}return i}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const i in this.materialsInfo)this.materialsArray[e]=await this.create(i),this.nameLookup[i]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const i=this,s=this.materialsInfo[e],a={name:e,side:this.side};async function h(et,nt){if(a[et])return;const it=i.getTextureParams(nt,a);return new Promise((lt,dt)=>{let pt=!1,gt=()=>!pt&&(pt=!0)&&lt();const vt=i.loadTexture((Ct=i.baseUrl,typeof(wt=it.url)!="string"||wt===""?"":/^https?:\/\//i.test(wt)?wt:Ct+wt),void 0,xt=>{a[et]=xt,gt()},void 0,gt);var Ct,wt;setTimeout(gt,50),vt.repeat.copy(it.scale),vt.offset.copy(it.offset),vt.wrapS=i.wrap,vt.wrapT=i.wrap})}const d=Array.from(Object.keys(s||{}));let _=d.includes("d")||d.includes("D");for(const et of d){const nt=s[et];let it;if(nt!=="")switch(et.toLowerCase()){case"kd":a.color=new b.Ilk().fromArray(nt);break;case"ks":a.specular=new b.Ilk().fromArray(nt);break;case"ke":a.emissive=new b.Ilk().fromArray(nt);break;case"map_kd":await h("map",nt);break;case"map_ks":await h("specularMap",nt);break;case"map_ke":await h("emissiveMap",nt);break;case"norm":await h("normalMap",nt);break;case"map_bump":case"bump":await h("bumpMap",nt);break;case"map_d":await h("alphaMap",nt),a.transparent=!0;break;case"ns":a.shininess=parseFloat(nt);break;case"d":it=parseFloat(nt),it<1&&(a.opacity=it,a.transparent=!0);break;case"tr":if(_)break;it=parseFloat(nt),this.options&&this.options.invertTrProperty&&(it=1-it),it>0&&(a.opacity=1-it,a.transparent=!0)}}return this.materials[e]=new b.xoR(a),this.materials[e]}getTextureParams(e,i){const s={scale:new b.FM8(1,1),offset:new b.FM8(0,0)},a=e.split(/\s+/);let h;return h=a.indexOf("-bm"),h>=0&&(i.bumpScale=parseFloat(a[h+1]),a.splice(h,2)),h=a.indexOf("-s"),h>=0&&(s.scale.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),h=a.indexOf("-o"),h>=0&&(s.offset.set(parseFloat(a[h+1]),parseFloat(a[h+2])),a.splice(h,4)),s.url=a.join(" ").trim(),s}loadTexture(e,i,s,a,h){const d=this.manager!==void 0?this.manager:b.tEQ;let _=d.getHandler(e);_===null&&(_=new b.dpR(d)),_.setCrossOrigin&&_.setCrossOrigin(this.crossOrigin);const et=_.load(e,s,a,h);return i!==void 0&&(et.mapping=i),et}}const Gx=/^[og]\s*(.+)?/,fv=/^mtllib /,Rs=/^usemtl /,Iu=/^usemap /,HE=new b.Pa4,JC=new b.Pa4,vI=new b.Pa4,Hx=new b.Pa4,Lm=new b.Pa4;function bD(){const c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,i){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=i!==!1);const s=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:i!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(a,h){const d=this._finalize(!1);d&&(d.inherited||d.groupCount<=0)&&this.materials.splice(d.index,1);const _={index:this.materials.length,name:a||"",mtllib:Array.isArray(h)&&h.length>0?h[h.length-1]:"",smooth:d!==void 0?d.smooth:this.smooth,groupStart:d!==void 0?d.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(et){const nt={index:typeof et=="number"?et:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return nt.clone=this.clone.bind(nt),nt}};return this.materials.push(_),_},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(a){const h=this.currentMaterial();if(h&&h.groupEnd===-1&&(h.groupEnd=this.geometry.vertices.length/3,h.groupCount=h.groupEnd-h.groupStart,h.inherited=!1),a&&this.materials.length>1)for(let d=this.materials.length-1;d>=0;d--)this.materials[d].groupCount<=0&&this.materials.splice(d,1);return a&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),h}},s&&s.name&&typeof s.clone=="function"){const a=s.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseNormalIndex:function(e,i){const s=parseInt(e,10);return 3*(s>=0?s-1:s+i/3)},parseUVIndex:function(e,i){const s=parseInt(e,10);return 2*(s>=0?s-1:s+i/2)},addVertex:function(e,i,s){const a=this.vertices,h=this.object.geometry.vertices;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addVertexPoint:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addVertexLine:function(e){const i=this.vertices;this.object.geometry.vertices.push(i[e+0],i[e+1],i[e+2])},addNormal:function(e,i,s){const a=this.normals,h=this.object.geometry.normals;h.push(a[e+0],a[e+1],a[e+2]),h.push(a[i+0],a[i+1],a[i+2]),h.push(a[s+0],a[s+1],a[s+2])},addFaceNormal:function(e,i,s){const a=this.vertices,h=this.object.geometry.normals;HE.fromArray(a,e),JC.fromArray(a,i),vI.fromArray(a,s),Lm.subVectors(vI,JC),Hx.subVectors(HE,JC),Lm.cross(Hx),Lm.normalize(),h.push(Lm.x,Lm.y,Lm.z),h.push(Lm.x,Lm.y,Lm.z),h.push(Lm.x,Lm.y,Lm.z)},addColor:function(e,i,s){const a=this.colors,h=this.object.geometry.colors;a[e]!==void 0&&h.push(a[e+0],a[e+1],a[e+2]),a[i]!==void 0&&h.push(a[i+0],a[i+1],a[i+2]),a[s]!==void 0&&h.push(a[s+0],a[s+1],a[s+2])},addUV:function(e,i,s){const a=this.uvs,h=this.object.geometry.uvs;h.push(a[e+0],a[e+1]),h.push(a[i+0],a[i+1]),h.push(a[s+0],a[s+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const i=this.uvs;this.object.geometry.uvs.push(i[e+0],i[e+1])},addFace:function(e,i,s,a,h,d,_,et,nt){const it=this.vertices.length;let lt=this.parseVertexIndex(e,it),dt=this.parseVertexIndex(i,it),pt=this.parseVertexIndex(s,it);if(this.addVertex(lt,dt,pt),this.addColor(lt,dt,pt),_!==void 0&&_!==""){const gt=this.normals.length;lt=this.parseNormalIndex(_,gt),dt=this.parseNormalIndex(et,gt),pt=this.parseNormalIndex(nt,gt),this.addNormal(lt,dt,pt)}else this.addFaceNormal(lt,dt,pt);if(a!==void 0&&a!==""){const gt=this.uvs.length;lt=this.parseUVIndex(a,gt),dt=this.parseUVIndex(h,gt),pt=this.parseUVIndex(d,gt),this.addUV(lt,dt,pt),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const i=this.vertices.length;for(let s=0,a=e.length;s<a;s++){const h=this.parseVertexIndex(e[s],i);this.addVertexPoint(h),this.addColor(h)}},addLineGeometry:function(e,i){this.object.geometry.type="Line";const s=this.vertices.length,a=this.uvs.length;for(let h=0,d=e.length;h<d;h++)this.addVertexLine(this.parseVertexIndex(e[h],s));for(let h=0,d=i.length;h<d;h++)this.addUVLine(this.parseUVIndex(i[h],a))}};return c.startObject("",!1),c}class _I extends b.aNw{constructor(e){super(e),this.materials=null}load(e,i,s,a){const h=this,d=new b.hH6(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,async function(_){try{i(await h.parse(_))}catch(et){a?a(et):console.error(et),h.manager.itemError(e)}},s,a)}setMaterials(e){return this.materials=e,this}async parse(e){const i=new bD;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const s=e.split(`
`);let a="",h="",d=0,_=[];const et=typeof"".trimLeft=="function";for(let it=0,lt=s.length;it<lt;it++)if(a=s[it],a=et?a.trimLeft():a.trim(),d=a.length,d!==0&&(h=a.charAt(0),h!=="#"))if(h==="v"){const dt=a.split(/\s+/);switch(dt[0]){case"v":i.vertices.push(parseFloat(dt[1]),parseFloat(dt[2]),parseFloat(dt[3])),dt.length>=7?i.colors.push(parseFloat(dt[4]),parseFloat(dt[5]),parseFloat(dt[6])):i.colors.push(void 0,void 0,void 0);break;case"vn":i.normals.push(parseFloat(dt[1]),parseFloat(dt[2]),parseFloat(dt[3]));break;case"vt":i.uvs.push(parseFloat(dt[1]),parseFloat(dt[2]))}}else if(h==="f"){const dt=a.substr(1).trim().split(/\s+/),pt=[];for(let vt=0,Ct=dt.length;vt<Ct;vt++){const wt=dt[vt];if(wt.length>0){const xt=wt.split("/");pt.push(xt)}}const gt=pt[0];for(let vt=1,Ct=pt.length-1;vt<Ct;vt++){const wt=pt[vt],xt=pt[vt+1];i.addFace(gt[0],wt[0],xt[0],gt[1],wt[1],xt[1],gt[2],wt[2],xt[2])}}else if(h==="l"){const dt=a.substring(1).trim().split(" ");let pt=[];const gt=[];if(a.indexOf("/")===-1)pt=dt;else for(let vt=0,Ct=dt.length;vt<Ct;vt++){const wt=dt[vt].split("/");wt[0]!==""&&pt.push(wt[0]),wt[1]!==""&&gt.push(wt[1])}i.addLineGeometry(pt,gt)}else if(h==="p"){const dt=a.substr(1).trim().split(" ");i.addPointGeometry(dt)}else if((_=Gx.exec(a))!==null){const dt=(" "+_[0].substr(1).trim()).substr(1);i.startObject(dt)}else if(Rs.test(a))i.object.startMaterial(a.substring(7).trim(),i.materialLibraries);else if(fv.test(a)){i.materialLibraries.push(a.substring(7).trim());const dt=a.substring(7).trim(),pt=this.manager.getHandler(dt);if(pt){const gt=await pt.loadAsync(dt).catch(vt=>{console.warn(vt)});gt&&this.setMaterials(gt)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(Iu.test(a))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(h==="s"){if(_=a.split(" "),_.length>1){const pt=_[1].trim().toLowerCase();i.object.smooth=pt!=="0"&&pt!=="off"}else i.object.smooth=!0;const dt=i.object.currentMaterial();dt&&(dt.smooth=i.object.smooth)}else{if(a==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}i.finalize();const nt=new b.ZAu;if(nt.materialLibraries=[].concat(i.materialLibraries),!(i.objects.length===1&&i.objects[0].geometry.vertices.length===0))for(let it=0,lt=i.objects.length;it<lt;it++){const dt=i.objects[it],pt=dt.geometry,gt=dt.materials,vt=pt.type==="Line",Ct=pt.type==="Points";let wt=!1;if(pt.vertices.length===0)continue;const xt=new b.u9r;xt.setAttribute("position",new b.a$l(pt.vertices,3)),pt.normals.length>0&&xt.setAttribute("normal",new b.a$l(pt.normals,3)),pt.colors.length>0&&(wt=!0,xt.setAttribute("color",new b.a$l(pt.colors,3))),pt.hasUVIndices===!0&&xt.setAttribute("uv",new b.a$l(pt.uvs,2));const _t=[];for(let Rt=0,Lt=gt.length;Rt<Lt;Rt++){const Ot=gt[Rt],qt=Ot.name+"_"+Ot.smooth+"_"+wt;let en=i.materials[qt];if(this.materials!==null)if(en=await this.materials.create(Ot.name),!vt||!en||en instanceof b.nls){if(Ct&&en&&!(en instanceof b.UY4)){const cn=new b.UY4({size:10,sizeAttenuation:!1});b.F5T.prototype.copy.call(cn,en),cn.color.copy(en.color),cn.map=en.map,en=cn}}else{const cn=new b.nls;b.F5T.prototype.copy.call(cn,en),cn.color.copy(en.color),en=cn}en===void 0&&(en=vt?new b.nls:Ct?new b.UY4({size:1,sizeAttenuation:!1}):new b.xoR,en.name=Ot.name,en.flatShading=!Ot.smooth,en.vertexColors=wt,i.materials[qt]=en),_t.push(en)}let Pt;if(_t.length>1){for(let Rt=0,Lt=gt.length;Rt<Lt;Rt++){const Ot=gt[Rt];xt.addGroup(Ot.groupStart,Ot.groupCount,Rt)}Pt=vt?new b.ejS(xt,_t):Ct?new b.woe(xt,_t):new b.Kj0(xt,_t)}else Pt=vt?new b.ejS(xt,_t[0]):Ct?new b.woe(xt,_t[0]):new b.Kj0(xt,_t[0]);Pt.name=dt.name,nt.add(Pt)}else if(i.vertices.length>0){const it=new b.UY4({size:1,sizeAttenuation:!1}),lt=new b.u9r;lt.setAttribute("position",new b.a$l(i.vertices,3)),i.colors.length>0&&i.colors[0]!==void 0&&(lt.setAttribute("color",new b.a$l(i.colors,3)),it.vertexColors=!0);const dt=new b.woe(lt,it);nt.add(dt)}return nt}}class ZC extends st{constructor(){super(...arguments),this.dependencies=[Yr],this._importer1=new Zo(_I,["obj"],!0),this._importer2=new Zo(Qx,["mtl"],!1)}async onAdded(e){Gs.Importers.push(this._importer1),Gs.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){Gs.Importers.splice(Gs.Importers.indexOf(this._importer1),1),Gs.Importers.splice(Gs.Importers.indexOf(this._importer2),1)}}ZC.PluginType="ObjMtlLoadPlugin";class ED extends b.DqL{constructor(e){super(e)}parse(e,i){const s=new SD(e,1);return{mipmaps:s.mipmaps(i),width:s.pixelWidth,height:s.pixelHeight,format:s.glInternalFormat,isCubemap:s.numberOfFaces===6,mipmapCount:s.numberOfMipmapLevels}}}class SD{constructor(e,i){this.arrayBuffer=e;const s=new Uint8Array(this.arrayBuffer,0,12);if(s[0]!==171||s[1]!==75||s[2]!==84||s[3]!==88||s[4]!==32||s[5]!==49||s[6]!==49||s[7]!==187||s[8]!==13||s[9]!==10||s[10]!==26||s[11]!==10)return void console.error("texture missing KTX identifier");const a=Uint32Array.BYTES_PER_ELEMENT,h=new DataView(this.arrayBuffer,12,13*a),d=h.getUint32(0,!0)===67305985;this.glType=h.getUint32(1*a,d),this.glTypeSize=h.getUint32(2*a,d),this.glFormat=h.getUint32(3*a,d),this.glInternalFormat=h.getUint32(4*a,d),this.glBaseInternalFormat=h.getUint32(5*a,d),this.pixelWidth=h.getUint32(6*a,d),this.pixelHeight=h.getUint32(7*a,d),this.pixelDepth=h.getUint32(8*a,d),this.numberOfArrayElements=h.getUint32(9*a,d),this.numberOfFaces=h.getUint32(10*a,d),this.numberOfMipmapLevels=h.getUint32(11*a,d),this.bytesOfKeyValueData=h.getUint32(12*a,d),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===i?this.loadType=0:console.warn("number of faces expected"+i+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const i=[];let s=64+this.bytesOfKeyValueData,a=this.pixelWidth,h=this.pixelHeight;const d=e?this.numberOfMipmapLevels:1;for(let _=0;_<d;_++){const et=new Int32Array(this.arrayBuffer,s,1)[0];s+=4;for(let nt=0;nt<this.numberOfFaces;nt++){const it=new Uint8Array(this.arrayBuffer,s,et);i.push({data:it,width:a,height:h}),s+=et,s+=3-(et+3)%4}a=Math.max(1,.5*a),h=Math.max(1,.5*h)}return i}}class WE extends st{constructor(){super(...arguments),this.dependencies=[Yr]}async onAdded(e){this._importer||(this._importer=new Zo(ED,["ktx"],!1)),Gs.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&Gs.Importers.splice(Gs.Importers.indexOf(this._importer),1),this._importer=void 0}}WE.PluginType="KTXLoadPlugin";class CD extends b.hH6{constructor(e){super(e),this.responseType="blob"}}class ko extends b.hH6{constructor(e){super(e),this.responseType="blob"}load(e,i,s,a){return super.load(e,h=>{try{i==null||i(Fl(h))}catch(d){a==null||a(d)}},s,a)}}class AI{async parseAsync(e,i){var s;return new Blob([JSON.stringify(e,null,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"application/json"})}}class $v{async parseAsync(e,i){return new Blob([e],{type:"text/plain"})}}class e0{constructor(){this.pluginCallbacks=[],this.register(function(e){return new gp(e)}),this.register(function(e){return new Wx(e)}),this.register(function(e){return new MD(e)}),this.register(function(e){return new JL(e)}),this.register(function(e){return new ZL(e)}),this.register(function(e){return new yI(e)}),this.register(function(e){return new $L(e)}),this.register(function(e){return new KL(e)}),this.register(function(e){return new eO(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,s,a,h){const d=h||new $C,_=[];for(let et=0,nt=this.pluginCallbacks.length;et<nt;et++)_.push(this.pluginCallbacks[et](d));d.setPlugins(_),d.write(e,i,a).catch(s)}parseAsync(e,i){const s=this;return new Promise(function(a,h){s.parse(e,a,h,i)})}}const qE=5121,XA=5123,mp={};mp[b.TyD]=9728,mp[b.YLQ]=9984,mp[b.aH4]=9986,mp[b.wem]=9729,mp[b.qyh]=9985,mp[b.D1R]=9987,mp[b.uWy]=33071,mp[b.rpg]=10497,mp[b.OoA]=33648;const ju={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function mv(c,e){return c.length===e.length&&c.every(function(i,s){return i===e[s]})}function YE(c){return 4*Math.ceil(c/4)}function Om(c,e=0){const i=YE(c.byteLength);if(i!==c.byteLength){const s=new Uint8Array(i);if(s.set(new Uint8Array(c)),e!==0)for(let a=c.byteLength;a<i;a++)s[a]=e;return s.buffer}return c}function Nm(c,e){if(c.toBlob!==void 0)return new Promise(s=>c.toBlob(s,e));let i;return e==="image/jpeg"?i=.92:e==="image/webp"&&(i=.8),c.convertToBlob({type:e,quality:i})}class $C{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,i,s){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},s),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const a=this,h=a.buffers,d=a.json;s=a.options;const _=a.extensionsUsed,et=new Blob(h,{type:"application/octet-stream"}),nt=Object.keys(_);if(nt.length>0&&(d.extensionsUsed=nt),d.buffers&&d.buffers.length>0&&(d.buffers[0].byteLength=et.size),s.binary===!0){const it=new FileReader;it.readAsArrayBuffer(et),it.onloadend=function(){const lt=Om(it.result),dt=new DataView(new ArrayBuffer(8));dt.setUint32(0,lt.byteLength,!0),dt.setUint32(4,5130562,!0);const pt=Om((gt=JSON.stringify(d),new TextEncoder().encode(gt).buffer),32);var gt;const vt=new DataView(new ArrayBuffer(8));vt.setUint32(0,pt.byteLength,!0),vt.setUint32(4,1313821514,!0);const Ct=new ArrayBuffer(12),wt=new DataView(Ct);wt.setUint32(0,1179937895,!0),wt.setUint32(4,2,!0);const xt=12+vt.byteLength+pt.byteLength+dt.byteLength+lt.byteLength;wt.setUint32(8,xt,!0);const _t=new Blob([Ct,vt,pt,dt,lt],{type:"application/octet-stream"}),Pt=new FileReader;Pt.readAsArrayBuffer(_t),Pt.onloadend=function(){i(Pt.result)}}}else if(d.buffers&&d.buffers.length>0){const it=new FileReader;it.readAsDataURL(et),it.onloadend=function(){const lt=it.result;d.buffers[0].uri=lt,i(d)}}else i(d)}serializeUserData(e,i){if(Object.keys(e.userData).length===0)return;const s=this.options,a=this.extensionsUsed;try{const h=JSON.parse(JSON.stringify(e.userData));if(s.includeCustomExtensions&&h.gltfExtensions){i.extensions===void 0&&(i.extensions={});for(const d in h.gltfExtensions)i.extensions[d]=h.gltfExtensions[d],a[d]=!0;delete h.gltfExtensions}Object.keys(h).length>0&&(i.extras=h)}catch(h){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+h.message),console.warn({...e.userData})}}getUID(e,i=!1){if(this.uids.has(e)===!1){const s=new Map;s.set(!0,this.uid++),s.set(!1,this.uid++),this.uids.set(e,s)}return this.uids.get(e).get(i)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const i=new b.Pa4;for(let s=0,a=e.count;s<a;s++)if(Math.abs(i.fromBufferAttribute(e,s).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const i=this.cache;if(i.attributesNormalized.has(e))return i.attributesNormalized.get(e);const s=e.clone(),a=new b.Pa4;for(let h=0,d=s.count;h<d;h++)a.fromBufferAttribute(s,h),a.x===0&&a.y===0&&a.z===0?a.setX(1):a.normalize(),s.setXYZ(h,a.x,a.y,a.z);return i.attributesNormalized.set(e,s),s}applyTextureTransform(e,i){let s=!1;const a={};i.offset.x===0&&i.offset.y===0||(a.offset=i.offset.toArray(),s=!0),i.rotation!==0&&(a.rotation=i.rotation,s=!0),i.repeat.x===1&&i.repeat.y===1||(a.scale=i.repeat.toArray(),s=!0),s&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=a,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,i){if(e===i)return e;function s(dt){return dt.encoding===b.knz?function(pt){return pt<.04045?.0773993808*pt:Math.pow(.9478672986*pt+.0521327014,2.4)}:function(pt){return pt}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const a=e?e.image:void 0,h=i?i.image:void 0,d=Math.max(a?a.width:0,h?h.width:0),_=Math.max(a?a.height:0,h?h.height:0),et=document.createElement("canvas");et.width=d,et.height=_;const nt=et.getContext("2d");nt.fillStyle="#00ffff",nt.fillRect(0,0,d,_);const it=nt.getImageData(0,0,d,_);if(a){nt.drawImage(a,0,0,d,_);const dt=s(e),pt=nt.getImageData(0,0,d,_).data;for(let gt=2;gt<pt.length;gt+=4)it.data[gt]=256*dt(pt[gt]/256)}if(h){nt.drawImage(h,0,0,d,_);const dt=s(i),pt=nt.getImageData(0,0,d,_).data;for(let gt=1;gt<pt.length;gt+=4)it.data[gt]=256*dt(pt[gt]/256)}nt.putImageData(it,0,0);const lt=(e||i).clone();return lt.source=new b.Hw6(et),lt.encoding=b.rnI,lt}processBuffer(e){const i=this.json,s=this.buffers;return i.buffers||(i.buffers=[{byteLength:0}]),s.push(e),0}processBufferView(e,i,s,a,h){const d=this.json;let _;d.bufferViews||(d.bufferViews=[]),_=i===qE?1:i===XA?2:4;const et=YE(a*e.itemSize*_),nt=new DataView(new ArrayBuffer(et));let it=0;for(let dt=s;dt<s+a;dt++)for(let pt=0;pt<e.itemSize;pt++){let gt;e.itemSize>4?gt=e.array[dt*e.itemSize+pt]:pt===0?gt=e.getX(dt):pt===1?gt=e.getY(dt):pt===2?gt=e.getZ(dt):pt===3&&(gt=e.getW(dt)),i===5126?nt.setFloat32(it,gt,!0):i===5125?nt.setUint32(it,gt,!0):i===XA?nt.setUint16(it,gt,!0):i===qE&&nt.setUint8(it,gt),it+=_}const lt={buffer:this.processBuffer(nt.buffer),byteOffset:this.byteOffset,byteLength:et};return h!==void 0&&(lt.target=h),h===34962&&(lt.byteStride=e.itemSize*_),this.byteOffset+=et,d.bufferViews.push(lt),{id:d.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const i=this,s=i.json;return s.bufferViews||(s.bufferViews=[]),new Promise(function(a){const h=new FileReader;h.readAsArrayBuffer(e),h.onloadend=function(){const d=Om(h.result),_={buffer:i.processBuffer(d),byteOffset:i.byteOffset,byteLength:d.byteLength};i.byteOffset+=d.byteLength,a(s.bufferViews.push(_)-1)}})}processAccessor(e,i,s,a){const h=this.options,d=this.json;let _;if(e.array.constructor===Float32Array)_=5126;else if(e.array.constructor===Uint32Array)_=5125;else if(e.array.constructor===Uint16Array)_=XA;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");_=qE}if(s===void 0&&(s=0),a===void 0&&(a=e.count),h.truncateDrawRange&&i!==void 0&&i.index===null){const dt=s+a,pt=i.drawRange.count===1/0?e.count:i.drawRange.start+i.drawRange.count;s=Math.max(s,i.drawRange.start),a=Math.min(dt,pt)-s,a<0&&(a=0)}if(a===0)return null;const et=function(dt,pt,gt){const vt={min:new Array(dt.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(dt.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let Ct=pt;Ct<pt+gt;Ct++)for(let wt=0;wt<dt.itemSize;wt++){let xt;dt.itemSize>4?xt=dt.array[Ct*dt.itemSize+wt]:wt===0?xt=dt.getX(Ct):wt===1?xt=dt.getY(Ct):wt===2?xt=dt.getZ(Ct):wt===3&&(xt=dt.getW(Ct)),vt.min[wt]=Math.min(vt.min[wt],xt),vt.max[wt]=Math.max(vt.max[wt],xt)}return vt}(e,s,a);let nt;i!==void 0&&(nt=e===i.index?34963:34962);const it=this.processBufferView(e,_,s,a,nt),lt={bufferView:it.id,byteOffset:it.byteOffset,componentType:_,count:a,max:et.max,min:et.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return d.accessors||(d.accessors=[]),d.accessors.push(lt)-1}processImage(e,i,s,a="image/png"){const h=this,d=h.cache,_=h.json,et=h.options,nt=h.pending;d.images.has(e)||d.images.set(e,{});const it=d.images.get(e),lt=a+":flipY/"+s.toString();if(it[lt]!==void 0)return it[lt];_.images||(_.images=[]);const dt={mimeType:a},pt=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");pt.width=Math.min(e.width,et.maxTextureSize),pt.height=Math.min(e.height,et.maxTextureSize);const gt=pt.getContext("2d");if(s===!0&&(gt.translate(0,pt.height),gt.scale(1,-1)),e.data!==void 0){i!==b.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>et.maxTextureSize||e.height>et.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const Ct=new Uint8ClampedArray(e.height*e.width*4);for(let wt=0;wt<Ct.length;wt+=4)Ct[wt+0]=e.data[wt+0],Ct[wt+1]=e.data[wt+1],Ct[wt+2]=e.data[wt+2],Ct[wt+3]=e.data[wt+3];gt.putImageData(new ImageData(Ct,e.width,e.height),0,0)}else gt.drawImage(e,0,0,pt.width,pt.height);et.binary===!0?nt.push(Nm(pt,a).then(Ct=>h.processBufferViewImage(Ct)).then(Ct=>{dt.bufferView=Ct})):pt.toDataURL!==void 0?dt.uri=pt.toDataURL(a):nt.push(Nm(pt,a).then(Ct=>new FileReader().readAsDataURL(Ct)).then(Ct=>{dt.uri=Ct}));const vt=_.images.push(dt)-1;return it[lt]=vt,vt}processSampler(e){const i=this.json;i.samplers||(i.samplers=[]);const s={magFilter:mp[e.magFilter],minFilter:mp[e.minFilter],wrapS:mp[e.wrapS],wrapT:mp[e.wrapT]};return i.samplers.push(s)-1}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);s.textures||(s.textures=[]);let a=e.userData.mimeType;a==="image/webp"&&(a="image/png"),a==="image/jpg"&&(a="image/jpeg");const h=["image/jpeg","image/png"];a&&!h.includes(a)&&console.error("GLTFExporter: Unsupported mime type: "+a+". Cannot export texture.",e);const d={sampler:this.processSampler(e),source:!a||h.includes(a)?this.processImage(e.image,e.format,e.flipY,a):null};e.name&&(d.name=e.name),this._invokeAll(function(et){et.writeTexture&&et.writeTexture(e,d)});const _=s.textures.push(d)-1;return i.textures.set(e,_),_}processMaterial(e){const i=this.cache,s=this.json;if(i.materials.has(e))return i.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;s.materials||(s.materials=[]);const a={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const h=e.color.toArray().concat([e.opacity]);if(mv(h,[1,1,1,1])||(a.pbrMetallicRoughness.baseColorFactor=h),e.isMeshStandardMaterial?(a.pbrMetallicRoughness.metallicFactor=e.metalness,a.pbrMetallicRoughness.roughnessFactor=e.roughness):(a.pbrMetallicRoughness.metallicFactor=.5,a.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const _=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),et={index:this.processTexture(_)};this.applyTextureTransform(et,_),a.pbrMetallicRoughness.metallicRoughnessTexture=et}if(e.map){const _={index:this.processTexture(e.map)};this.applyTextureTransform(_,e.map),a.pbrMetallicRoughness.baseColorTexture=_}if(e.emissive){const _=e.emissive.clone().multiplyScalar(e.emissiveIntensity),et=Math.max(_.r,_.g,_.b);if(et>1&&(_.multiplyScalar(1/et),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),et>0&&(a.emissiveFactor=_.toArray()),e.emissiveMap){const nt={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(nt,e.emissiveMap),a.emissiveTexture=nt}}if(e.normalMap){const _={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(_.scale=e.normalScale.x),this.applyTextureTransform(_,e.normalMap),a.normalTexture=_}if(e.aoMap){const _={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(_.strength=e.aoMapIntensity),this.applyTextureTransform(_,e.aoMap),a.occlusionTexture=_}e.transparent?a.alphaMode="BLEND":e.alphaTest>0&&(a.alphaMode="MASK",a.alphaCutoff=e.alphaTest),e.side===b.ehD&&(a.doubleSided=!0),e.name!==""&&(a.name=e.name),this.serializeUserData(e,a),this._invokeAll(function(_){_.writeMaterial&&_.writeMaterial(e,a)});const d=s.materials.push(a)-1;return i.materials.set(e,d),d}processMesh(e){const i=this.cache,s=this.json,a=[e.geometry.uuid];if(Array.isArray(e.material))for(let _t=0,Pt=e.material.length;_t<Pt;_t++)a.push(e.material[_t].uuid);else a.push(e.material.uuid);const h=a.join(":");if(i.meshes.has(h))return i.meshes.get(h);const d=e.geometry;let _;_=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const et={},nt={},it=[],lt=[],dt={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},pt=d.getAttribute("normal");pt===void 0||this.isNormalizedNormalAttribute(pt)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),d.setAttribute("normal",this.createNormalizedNormalAttribute(pt)));let gt=null;for(let _t in d.attributes){if(_t.slice(0,5)==="morph")continue;const Pt=d.attributes[_t];if(_t=dt[_t]||_t.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(_t)||(_t="_"+_t),i.attributes.has(this.getUID(Pt))){nt[_t]=i.attributes.get(this.getUID(Pt));continue}gt=null;const Rt=Pt.array;_t!=="JOINTS_0"||Rt instanceof Uint16Array||Rt instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),gt=new b.TlE(new Uint16Array(Rt),Pt.itemSize,Pt.normalized));const Lt=this.processAccessor(gt||Pt,d);Lt!==null&&(nt[_t]=Lt,i.attributes.set(this.getUID(Pt),Lt))}if(pt!==void 0&&d.setAttribute("normal",pt),Object.keys(nt).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const _t=[],Pt=[],Rt={};if(e.morphTargetDictionary!==void 0)for(const Lt in e.morphTargetDictionary)Rt[e.morphTargetDictionary[Lt]]=Lt;for(let Lt=0;Lt<e.morphTargetInfluences.length;++Lt){const Ot={};let qt=!1;for(const en in d.morphAttributes){if(en!=="position"&&en!=="normal"){qt||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),qt=!0);continue}const cn=d.morphAttributes[en][Lt],An=en.toUpperCase(),fn=d.attributes[en];if(i.attributes.has(this.getUID(cn,!0))){Ot[An]=i.attributes.get(this.getUID(cn,!0));continue}const Tn=cn.clone();if(!d.morphTargetsRelative)for(let gn=0,xn=cn.count;gn<xn;gn++)Tn.setXYZ(gn,cn.getX(gn)-fn.getX(gn),cn.getY(gn)-fn.getY(gn),cn.getZ(gn)-fn.getZ(gn));Ot[An]=this.processAccessor(Tn,d),i.attributes.set(this.getUID(fn,!0),Ot[An])}lt.push(Ot),_t.push(e.morphTargetInfluences[Lt]),e.morphTargetDictionary!==void 0&&Pt.push(Rt[Lt])}et.weights=_t,Pt.length>0&&(et.extras={},et.extras.targetNames=Pt)}const vt=Array.isArray(e.material);if(vt&&d.groups.length===0)return null;const Ct=vt?e.material:[e.material],wt=vt?d.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let _t=0,Pt=wt.length;_t<Pt;_t++){const Rt={mode:_,attributes:nt};if(this.serializeUserData(d,Rt),lt.length>0&&(Rt.targets=lt),d.index!==null){let Ot=this.getUID(d.index);wt[_t].start===void 0&&wt[_t].count===void 0||(Ot+=":"+wt[_t].start+":"+wt[_t].count),i.attributes.has(Ot)?Rt.indices=i.attributes.get(Ot):(Rt.indices=this.processAccessor(d.index,d,wt[_t].start,wt[_t].count),i.attributes.set(Ot,Rt.indices)),Rt.indices===null&&delete Rt.indices}const Lt=this.processMaterial(Ct[wt[_t].materialIndex]);Lt!==null&&(Rt.material=Lt),it.push(Rt)}et.primitives=it,s.meshes||(s.meshes=[]),this._invokeAll(function(_t){_t.writeMesh&&_t.writeMesh(e,et)});const xt=s.meshes.push(et)-1;return i.meshes.set(h,xt),xt}processCamera(e){const i=this.json;i.cameras||(i.cameras=[]);const s=e.isOrthographicCamera,a={type:s?"orthographic":"perspective"};return s?a.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:a.perspective={aspectRatio:e.aspect,yfov:b.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(a.name=e.type),i.cameras.push(a)-1}processAnimation(e,i){const s=this.json,a=this.nodeMap;s.animations||(s.animations=[]);const h=(e=e0.Utils.mergeMorphTargetTracks(e.clone(),i)).tracks,d=[],_=[];for(let et=0;et<h.length;++et){const nt=h[et],it=b.iUV.parseTrackName(nt.name);let lt=b.iUV.findNode(i,it.nodeName);const dt=ju[it.propertyName];if(it.objectName==="bones"&&(lt=lt.isSkinnedMesh===!0?lt.skeleton.getBoneByName(it.objectIndex):void 0),!lt||!dt)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',nt.name),null;const pt=1;let gt,vt=nt.values.length/nt.times.length;dt===ju.morphTargetInfluences&&(vt/=lt.morphTargetInfluences.length),nt.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(gt="CUBICSPLINE",vt/=3):gt=nt.getInterpolation()===b.Syv?"STEP":"LINEAR",_.push({input:this.processAccessor(new b.TlE(nt.times,pt)),output:this.processAccessor(new b.TlE(nt.values,vt)),interpolation:gt}),d.push({sampler:_.length-1,target:{node:a.get(lt),path:dt}})}return s.animations.push({name:e.name||"clip_"+s.animations.length,samplers:_,channels:d}),s.animations.length-1}processSkin(e){const i=this.json,s=this.nodeMap,a=i.nodes[s.get(e)],h=e.skeleton;if(h===void 0)return null;const d=e.skeleton.bones[0];if(d===void 0)return null;const _=[],et=new Float32Array(16*h.bones.length),nt=new b.yGw;for(let it=0;it<h.bones.length;++it)_.push(s.get(h.bones[it])),nt.copy(h.boneInverses[it]),nt.multiply(e.bindMatrix).toArray(et,16*it);return i.skins===void 0&&(i.skins=[]),i.skins.push({inverseBindMatrices:this.processAccessor(new b.TlE(et,16)),joints:_,skeleton:s.get(d)}),a.skin=i.skins.length-1}processNode(e){const i=this.json,s=this.options,a=this.nodeMap;i.nodes||(i.nodes=[]);const h={};if(s.trs){const _=e.quaternion.toArray(),et=e.position.toArray(),nt=e.scale.toArray();mv(_,[0,0,0,1])||(h.rotation=_),mv(et,[0,0,0])||(h.translation=et),mv(nt,[1,1,1])||(h.scale=nt)}else e.matrixAutoUpdate&&e.updateMatrix(),mv(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(h.matrix=e.matrix.elements);if(e.name!==""&&(h.name=String(e.name)),this.serializeUserData(e,h),e.isMesh||e.isLine||e.isPoints){const _=this.processMesh(e);_!==null&&(h.mesh=_)}else e.isCamera&&(h.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const _=[];for(let et=0,nt=e.children.length;et<nt;et++){const it=e.children[et];if(it.visible||s.onlyVisible===!1){const lt=this.processNode(it);lt!==null&&_.push(lt)}}_.length>0&&(h.children=_)}this._invokeAll(function(_){_.writeNode&&_.writeNode(e,h)});const d=i.nodes.push(h)-1;return a.set(e,d),d}processScene(e){const i=this.json,s=this.options;i.scenes||(i.scenes=[],i.scene=0);const a={};e.name!==""&&(a.name=e.name),i.scenes.push(a);const h=[];for(let d=0,_=e.children.length;d<_;d++){const et=e.children[d];if(et.visible||s.onlyVisible===!1){const nt=this.processNode(et);nt!==null&&h.push(nt)}}h.length>0&&(a.nodes=h),this.serializeUserData(e,a)}processObjects(e){const i=new b.xsS;i.name="AuxScene";for(let s=0;s<e.length;s++)i.children.push(e[s]);this.processScene(i)}processInput(e){const i=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(a){a.beforeParse&&a.beforeParse(e)});const s=[];for(let a=0;a<e.length;a++)e[a]instanceof b.xsS?this.processScene(e[a]):s.push(e[a]);s.length>0&&this.processObjects(s);for(let a=0;a<this.skins.length;++a)this.processSkin(this.skins[a]);for(let a=0;a<i.animations.length;++a)this.processAnimation(i.animations[a],e[0]);this._invokeAll(function(a){a.afterParse&&a.afterParse(e)})}_invokeAll(e){for(let i=0,s=this.plugins.length;i<s;i++)e(this.plugins[i])}}class gp{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,i){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const s=this.writer,a=s.json,h=s.extensionsUsed,d={};e.name&&(d.name=e.name),d.color=e.color.toArray(),d.intensity=e.intensity,e.isDirectionalLight?d.type="directional":e.isPointLight?(d.type="point",e.distance>0&&(d.range=e.distance)):e.isSpotLight&&(d.type="spot",e.distance>0&&(d.range=e.distance),d.spot={},d.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,d.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),h[this.name]||(a.extensions=a.extensions||{},a.extensions[this.name]={lights:[]},h[this.name]=!0);const _=a.extensions[this.name].lights;_.push(d),i.extensions=i.extensions||{},i.extensions[this.name]={light:_.length-1}}}class Wx{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,i){if(!e.isMeshBasicMaterial)return;const s=this.writer.extensionsUsed;i.extensions=i.extensions||{},i.extensions[this.name]={},s[this.name]=!0,i.pbrMetallicRoughness.metallicFactor=0,i.pbrMetallicRoughness.roughnessFactor=.9}}class MD{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,i){if(!e.isGLTFSpecularGlossinessMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};i.pbrMetallicRoughness.baseColorFactor&&(h.diffuseFactor=i.pbrMetallicRoughness.baseColorFactor);const d=[1,1,1];if(e.specular.toArray(d,0),h.specularFactor=d,h.glossinessFactor=e.glossiness,i.pbrMetallicRoughness.baseColorTexture&&(h.diffuseTexture=i.pbrMetallicRoughness.baseColorTexture),e.specularMap){const _={index:s.processTexture(e.specularMap)};s.applyTextureTransform(_,e.specularMap),h.specularGlossinessTexture=_}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class yI{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.clearcoatFactor=e.clearcoat,e.clearcoatMap){const d={index:s.processTexture(e.clearcoatMap)};s.applyTextureTransform(d,e.clearcoatMap),h.clearcoatTexture=d}if(h.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const d={index:s.processTexture(e.clearcoatRoughnessMap)};s.applyTextureTransform(d,e.clearcoatRoughnessMap),h.clearcoatRoughnessTexture=d}if(e.clearcoatNormalMap){const d={index:s.processTexture(e.clearcoatNormalMap)};s.applyTextureTransform(d,e.clearcoatNormalMap),h.clearcoatNormalTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class KL{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.iridescenceFactor=e.iridescence,e.iridescenceMap){const d={index:s.processTexture(e.iridescenceMap)};s.applyTextureTransform(d,e.iridescenceMap),h.iridescenceTexture=d}if(h.iridescenceIor=e.iridescenceIOR,h.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const d={index:s.processTexture(e.iridescenceThicknessMap)};s.applyTextureTransform(d,e.iridescenceThicknessMap),h.iridescenceThicknessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class JL{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.transmissionFactor=e.transmission,e.transmissionMap){const d={index:s.processTexture(e.transmissionMap)};s.applyTextureTransform(d,e.transmissionMap),h.transmissionTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class ZL{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.thicknessFactor=e.thickness,e.thicknessMap){const d={index:s.processTexture(e.thicknessMap)};s.applyTextureTransform(d,e.thicknessMap),h.thicknessTexture=d}h.attenuationDistance=e.attenuationDistance,h.attenuationColor=e.attenuationColor.toArray(),i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class $L{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const d={index:s.processTexture(e.sheenColorMap)};s.applyTextureTransform(d,e.sheenColorMap),h.sheenColorTexture=d}if(h.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const d={index:s.processTexture(e.sheenRoughnessMap)};s.applyTextureTransform(d,e.sheenRoughnessMap),h.sheenRoughnessTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,i.extras=i.extras||{},i.extras.sheenFactor=e.sheen,a[this.name]=!0}}class eO{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,i){if(!e.isMeshPhysicalMaterial)return;const s=this.writer.extensionsUsed,a={};a.ior=e.ior,i.extensions=i.extensions||{},i.extensions[this.name]=a,s[this.name]=!0}}e0.Utils={GLTFWriter:$C,insertKeyframe:function(c,e){const s=c.getValueSize(),a=new c.TimeBufferType(c.times.length+1),h=new c.ValueBufferType(c.values.length+s),d=c.createInterpolant(new c.ValueBufferType(s));let _;if(c.times.length===0){a[0]=e;for(let et=0;et<s;et++)h[et]=0;_=0}else if(e<c.times[0]){if(Math.abs(c.times[0]-e)<.001)return 0;a[0]=e,a.set(c.times,1),h.set(d.evaluate(e),0),h.set(c.values,s),_=0}else if(e>c.times[c.times.length-1]){if(Math.abs(c.times[c.times.length-1]-e)<.001)return c.times.length-1;a[a.length-1]=e,a.set(c.times,0),h.set(c.values,0),h.set(d.evaluate(e),c.values.length),_=a.length-1}else for(let et=0;et<c.times.length;et++){if(Math.abs(c.times[et]-e)<.001)return et;if(c.times[et]<e&&c.times[et+1]>e){a.set(c.times.slice(0,et+1),0),a[et+1]=e,a.set(c.times.slice(et+1),et+2),h.set(c.values.slice(0,(et+1)*s),0),h.set(d.evaluate(e),(et+1)*s),h.set(c.values.slice((et+1)*s),(et+2)*s),_=et+1;break}}return c.times=a,c.values=h,_},mergeMorphTargetTracks:function(c,e){const i=[],s={},a=c.tracks;for(let h=0;h<a.length;++h){let d=a[h];const _=b.iUV.parseTrackName(d.name),et=b.iUV.findNode(e,_.nodeName);if(_.propertyName!=="morphTargetInfluences"||_.propertyIndex===void 0){i.push(d);continue}if(d.createInterpolant!==d.InterpolantFactoryMethodDiscrete&&d.createInterpolant!==d.InterpolantFactoryMethodLinear){if(d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),d=d.clone(),d.setInterpolation(b.NMF)}const nt=et.morphTargetInfluences.length,it=et.morphTargetDictionary[_.propertyIndex];if(it===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+_.propertyIndex);let lt;if(s[et.uuid]===void 0){lt=d.clone();const pt=new lt.ValueBufferType(nt*lt.times.length);for(let gt=0;gt<lt.times.length;gt++)pt[gt*nt+it]=lt.values[gt];lt.name=(_.nodeName||"")+".morphTargetInfluences",lt.values=pt,s[et.uuid]=lt,i.push(lt);continue}const dt=d.createInterpolant(new d.ValueBufferType(1));lt=s[et.uuid];for(let pt=0;pt<lt.times.length;pt++)lt.values[pt*nt+it]=dt.evaluate(lt.times[pt]);for(let pt=0;pt<d.times.length;pt++){const gt=this.insertKeyframe(lt,d.times[pt]);lt.values[gt*nt+it]=d.values[pt]}}return c.tracks=i,c}};class yR extends e0.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new b.Wid}serializeUserData(e,i){const s=e.userData,a={};s.__disposed&&console.error("Serializing a disposed object",e),Object.entries(s).forEach(([h,d])=>{(!d||typeof d=="function"||d.isObject3D||d.isTexture||d.isMaterial||d.assetType!=null||h.startsWith("_")||h!=="uuid"&&(bv.includes(h)||gA.includes(h)||vm.includes(h)))&&(a[h]=d,delete s[h])}),super.serializeUserData(e,i),Object.entries(a).forEach(([h,d])=>{s[h]=d,delete a[h]})}processObjects(e){var i;e.length===1&&(!((i=e[0])===null||i===void 0)&&i.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let i=e;i&&!i.isShaderMaterial||(i=this._defaultMaterial);const s=super.processMaterial(i);if(!e||i===e)return s;const a=JSON.stringify(this.json.materials[s]),h=JSON.parse(a);this.serializeUserData(e,h),this._invokeAll(_=>{_.writeMaterial&&_.writeMaterial(e,h)});const d=this.json.materials.push(h)-1;return this.cache.materials.set(e,d),d}processImageBlob(e,i){if(!e)return-1;const s=this.cache,a=this.options,h=this.pending,d=this.json,_=i.image;s.images.has(_)||s.images.set(_,{});const et=s.images.get(_),nt=e.type+":flipY/"+i.flipY.toString();if(et[nt]!==void 0)return et[nt];d.images||(d.images=[]);const it={mimeType:e.type};a.binary===!0?h.push(new Promise(dt=>{this.processBufferViewImage(e).then(pt=>{it.bufferView=pt,dt()})})):h.push(Fl(e).then(dt=>{it.uri=dt}));const lt=d.images.push(it)-1;return et[nt]=lt,lt}processSampler(e){return super.processSampler(e)}processTexture(e){const i=this.cache,s=this.json;if(i.textures.has(e))return i.textures.get(e);const a=e.source.data,h=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const d=super.processTexture(e),_=s.textures[d];if(!_)return console.error("No texture def",d,e),d;const et=s.images?s.images[_.source]:null;if(et&&(et.extras||(et.extras={}),e.source&&(et.extras.uuid=e.source.uuid),et.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=a,e.userData.mimeType=h,!_)return console.error("textureDef is null",d,e),d;_.source>=0?console.warn("textureDef.source is already set",d,e):_.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,h)}return _.source<0&&console.error("textureDef.source cannot be saved",_,e),d}processImage(e,i,s,a="image/png"){return e?super.processImage(e,i,s,a):-1}processImageUri(e,i,s,a="image/png"){const h=this.cache,d=this.json;h.images.has(e)||h.images.set(e,{});const _=h.images.get(e),et=a+":flipY/"+s.toString();if(_[et]!==void 0)return _[et];d.images||(d.images=[]);const nt={mimeType:a,uri:i,extras:{flipY:s}},it=d.images.push(nt)-1;return _[et]=it,it}}class TD extends e0{register(e){return super.register(e)}async parseAsync(e,i){var s;if(!e)throw new Error("No object to export");const a=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((h,d)=>this.parse(e,h,d,i));if(a&&typeof a=="object"&&!a.byteLength)return new Blob([JSON.stringify(a,(h,d)=>h.startsWith("__")?void 0:d,(s=i.jsonSpaces)!==null&&s!==void 0?s:2)],{type:"model/gltf+json"});if(a)return new Blob([a],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,i,s,a={}){var h;const d={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!a.embedUrlImages&&a.externalImagesInExtras||!1,embedUrlImages:(h=a.embedUrlImages)!==null&&h!==void 0&&h,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return a.exportExt==="glb"&&(d.binary=!0),a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(et=>{et.uuid&&(et.userData.gltfUUID=et.uuid)})),(Array.isArray(e)?e:[e]).forEach(_=>_.traverse(et=>{if(et.animations)for(const nt of et.animations)nt.__gltfExport===!1||d.animations.includes(nt)||d.animations.push(...et.animations)})),super.parse(e,_=>{a.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(et=>et.traverse(nt=>{delete nt.userData.gltfUUID})),i(Object.assign(_,{__isGLTFOutput:!0}))},s,d,new yR)}}function wR(c,e){const i=c.getPlugin(Yr).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&i.resources.textures&&Object.entries(i.resources.textures).forEach(([a,h])=>{e.json.textures.find(_=>{var et,nt,it,lt,dt;return((et=_.extras)===null||et===void 0?void 0:et.uuid)===a||((it=(nt=e.json.samplers[_.sampler])===null||nt===void 0?void 0:nt.extras)===null||it===void 0?void 0:it.uuid)===a||((dt=(lt=e.json.images[_.source])===null||lt===void 0?void 0:lt.extras)===null||dt===void 0?void 0:dt.t_uuid)===a})&&(h.image&&i.resources.images&&i.resources.images[h.image]&&delete i.resources.images[h.image],i.resources.textures[a]={})}),e.json.materials&&i.resources.materials&&Object.entries(i.resources.materials).forEach(([a,h])=>{e.json.materials.find(_=>{var et;return((et=_.extras)===null||et===void 0?void 0:et.uuid)===a})&&(i.resources.materials[a]={})});const s=[];Object.values(i.resources).forEach(a=>{Object.values(a).forEach(h=>{h.url&&(h.url.type==="Uint16Array"&&h.url.data&&(h.url.data instanceof Uint16Array||(h.url.data=new Uint16Array(h.url.data)),s.push(h.url)),h.url.type==="Uint8Array"&&h.url.data&&(h.url.data instanceof Uint8Array||(h.url.data=new Uint8Array(h.url.data)),s.push(h.url)))})});for(const a of s){let h="application/octet-stream";if(a.type==="Uint16Array"){const nt=tO(a.data,4),it=new ImageData(nt,a.width,a.height),lt=b.PpQ.getDataURL(it,!0).split(",")[1];h="image/png",a.data=atob(lt),a.encoding="rgbe"}const d=new Blob([a.data],{type:h});e.json.images||(e.json.images=[]);const _={mimeType:h},et=e.json.images.push(_)-1;a.data={image:et},e.pending.push(e.processBufferViewImage(d).then(nt=>{_.bufferView=nt}))}return i}function tO(c,e=3,i){let s,a,h,d,_;const et=c.byteLength/(2*e)|0;i=i||new Uint8ClampedArray(4*et);for(let nt=0;nt<et;nt++){s=c[nt*e],a=c[nt*e+1],h=c[nt*e+2],d=Math.max(Math.max(s,a),h);const it=Math.ceil(Math.log2(d));_=Math.pow(2,it-8),i[4*nt]=s/_|0,i[4*nt+1]=a/_|0,i[4*nt+2]=h/_|0,i[4*nt+3]=it+128}return i}function ID(c,e=TD,i){var s;if(!c)return;const a=Y_.Exporters.findIndex(d=>d.ext.includes("gltf")||d.ext.includes("glb")),h=[];a>=0?(h.push(...(s=Y_.Exporters[a].extensions)!==null&&s!==void 0?s:[]),Y_.Exporters.splice(a,1)):(h.push(rO),h.push(iO),h.push(nO),h.push(d=>new sO(d)),h.push(d=>new oO(d)),h.push(d=>new aO(d)),h.push(d=>new lO(d))),Y_.Exporters.push({ctor:()=>{const d=new e;return h.forEach(_=>d.register(_)),d.register(_=>({afterParse:et=>{var nt,it;if(!(!((nt=(et=Array.isArray(et)?et[0]:et)==null?void 0:et.userData)===null||nt===void 0)&&nt.rootSceneModelRoot)||((it=et==null?void 0:et.userData)===null||it===void 0?void 0:it.__exportViewerConfig)===!1)return;const lt=_.json.scenes[_.json.scene||0];lt.extensions||(lt.extensions={}),lt.extensions[Mp]=wR(c,_),_.extensionsUsed[Mp]=!0}})),i==null||i(d),d},ext:["gltf","glb"],extensions:h})}const nO=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isLight))return;i.extensions||(i.extensions={});const s={};e.shadow&&(s.shadow=e.shadow.toJSON()),Object.keys(s).length>0&&(i.extensions[dn]=s,c.extensionsUsed[dn]=!0)}}),iO=c=>({writeNode:(e,i)=>{if(!(e!=null&&e.isObject3D))return;i.extensions||(i.extensions={});const s={};e.castShadow!==void 0&&(s.castShadow=e.castShadow),e.receiveShadow!==void 0&&(s.receiveShadow=e.receiveShadow),e.visible===!1&&(s.visible=!1),e.frustumCulled===!1&&(s.frustumCulled=!1),e.renderOrder!==0&&(s.renderOrder=e.renderOrder),e.layers.mask!==1&&(s.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),Object.keys(s).length>0&&(i.extensions[Jm]=s,c.extensionsUsed[Jm]=!0)}}),rO=c=>({writeMaterial(e,i){var s;if(!(e!=null&&e.isMaterial))return;i.extensions||(i.extensions={});const a={};if(e.emissiveIntensity!==void 0&&(!((s=e.emissive)===null||s===void 0)&&s.isColor)){const d=e.emissive.clone().multiplyScalar(e.emissiveIntensity),_=Math.max(d.r,d.g,d.b);_>1&&(a.emissiveIntensity=_)}e.fog!==void 0&&(a.fog=e.fog),e.flatShading!==void 0&&(a.flatShading=e.flatShading),e.blending!==void 0&&(a.blending=e.blending),e.side!==void 0&&e.side!==b.ehD&&(a.side=e.side),e.shadowSide!==void 0&&(a.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(a.depthFunc=e.depthFunc),e.depthTest!==void 0&&(a.depthTest=e.depthTest),e.depthWrite!==void 0&&(a.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(a.colorWrite=e.colorWrite),e.wireframe!==void 0&&(a.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(a.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(a.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(a.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(a.rotation=e.rotation),e.polygonOffset!==void 0&&(a.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(a.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(a.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(a.dithering=e.dithering),e.alphaToCoverage!==void 0&&(a.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(a.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(a.toneMapped=e.toneMapped);const h=this.materialExternalResources[e.uuid];h&&Object.entries(h).forEach(([d,_])=>{d.startsWith("_")||(a[d]=so(_,!1,this.serializedMeta))}),Object.keys(a).length>0&&(i.extensions[Tp]=a,c.extensionsUsed[Tp]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!c.options.externalImagesInExtras)return;const i=[];(Array.isArray(e)?e:[e]).forEach(s=>{s==null||s.traverse(a=>{var h;a&&(!((h=a.material)===null||h===void 0)&&h.isMaterial)&&i.push(a.material)})}),i.forEach(s=>{s&&(this.materialExternalResources[s.uuid]||(this.materialExternalResources[s.uuid]={}),this.materialExternalResources[s.uuid].__materialRef=s,Object.entries(s).forEach(([a,h])=>{a.startsWith("_")||h&&h.isTexture&&h.userData.rootPath&&(s[a]=null,this.materialExternalResources[s.uuid][a]=h)}))})},afterParse(e){const i=Object.values(this.materialExternalResources);if(i.length<1)return;i.forEach(a=>{const h=a.__materialRef;h&&(Object.entries(a).forEach(([d,_])=>{d.startsWith("_")||_&&(h[d]=_)}),delete this.materialExternalResources[h.uuid])});const s=c.json.scenes[c.json.scene||0];s.extensions||(s.extensions={}),s.extensions[Tp]={resources:this.serializedMeta},c.extensionsUsed[Tp]=!0}});class sO{constructor(e){this.writer=e,this.name=$p}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.bumpScale=e.bumpScale,e.bumpMap){const d={index:s.processTexture(e.bumpMap)};s.applyTextureTransform(d,e.bumpMap),h.bumpTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class oO{constructor(e){this.writer=e,this.name=kv}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.displacementScale=e.displacementScale,h.displacementBias=e.displacementBias,e.displacementMap){const d={index:s.processTexture(e.displacementMap)};s.applyTextureTransform(d,e.displacementMap),h.displacementTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class aO{constructor(e){this.writer=e,this.name=_f}writeMaterial(e,i){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const s=this.writer,a=s.extensionsUsed,h={};if(h.lightMapIntensity=e.lightMapIntensity,e.lightMap){const d={index:s.processTexture(e.lightMap)};s.applyTextureTransform(d,e.lightMap),h.lightMapTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class lO{constructor(e){this.writer=e,this.name=$m}writeMaterial(e,i){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const s=this.writer,a=s.extensionsUsed,h={};if(e.alphaMap){const d={index:s.processTexture(e.alphaMap)};s.applyTextureTransform(d,e.alphaMap),h.alphaTexture=d}i.extensions=i.extensions||{},i.extensions[this.name]=h,a[this.name]=!0}}class Y_ extends st{constructor(e,i={}){super(),this._processors=new f_,this._cachedParsers=[],ID(e)}get processors(){return this._processors}getExporter(...e){return Y_.Exporters.find(i=>i.ext.some(s=>e.includes(s)))}async exportObject(e,i={}){var s,a,h,d;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((a=(s=e)===null||s===void 0?void 0:s.userData)===null||a===void 0)&&a.rootSceneModelRoot&&i.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const _=await this._exportFile(e,i);return!((d=(h=e)===null||h===void 0?void 0:h.userData)===null||d===void 0)&&d.rootSceneModelRoot&&i.viewerConfig===!1&&delete e.userData.__exportViewerConfig,_}async _exportFile(e,i={}){var s,a,h;let d;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const _=await this.processBeforeExport(e,i),et=(a=(s=i.exportExt)!==null&&s!==void 0?s:_==null?void 0:_.typeExt)!==null&&a!==void 0?a:_==null?void 0:_.ext;if(!_||!et)throw new Error(`Unable to preprocess before export ${et}`);const nt=this._getParser(et);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const it=await nt.parseAsync(_.obj,{exportExt:(h=_.ext)!==null&&h!==void 0?h:et,...i});it.ext=_.ext,d=it}catch(_){return console.error("AssetExporter: Unable to Export file",e),console.error(_),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:_})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),d}_createParser(e){const i=Y_.Exporters.find(a=>a.ext.includes(e));if(!i)throw new Error(`No exporter found for extension ${e}`);const s=i==null?void 0:i.ctor(this);if(!s)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:i.ext,parser:s}),this.dispatchEvent({type:"exporterCreate",exporter:i,parser:s}),s}_getParser(e){var i,s;return(s=(i=this._cachedParsers.find(a=>a.ext.includes(e)))===null||i===void 0?void 0:i.parser)!==null&&s!==void 0?s:this._createParser(e)}async processBeforeExport(e,i={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,i)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}Y_.Exporters=[{ctor:()=>new AI,ext:["json"]},{ctor:()=>new $v,ext:["txt","text"]}];class eM extends Ns{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new Y_(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(i,s)=>{var a;return s.convertMeshToIndexed&&((a=i.modelObject)===null||a===void 0||a.traverse(h=>{var d;h.geometry&&(h.geometry.attributes.index||(d=h.setGeometry)===null||d===void 0||d.call(h,Ao(h.geometry)))})),i}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var i,s;return(i=this.exporter)===null||i===void 0?void 0:i.exportObject((s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",s=>{var a;typeof((a=s.plugin)===null||a===void 0?void 0:a.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const i=Object.entries(e.plugins).filter(([s,a])=>typeof(a==null?void 0:a.toJSON)=="function").map(([s,a])=>({label:s,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const s=await this.exportScene(this.exportOptions);s&&eu(s,this.exportOptions.name+"."+s.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:i},{type:"button",label:"Select none",value:()=>{i.forEach(s=>{var a;s.value=!1,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Select all",value:()=>{i.forEach(s=>{var a;s.value=!0,(a=s.uiRefresh)===null||a===void 0||a.call(s)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Yr).exportPluginPresets(i.filter(a=>!!a.value).map(a=>Yt(a.label)||"")),null,2)],{type:"application/json"});s&&eu(s,this.exportOptions.name+"."+Yr.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const s=new Blob([JSON.stringify(e.getPlugin(Yr).exportViewerConfig(),null,2)],{type:"application/json"});s&&eu(s,this.exportOptions.name+"."+Yr.ViewerTypeSlug)}}]}]}}}eM.PluginType="AssetExporterPlugin";class DD{constructor(){this._listeners={}}addEventListener(e,i){const s=this._listeners;return s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i),this}removeEventListener(e,i){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const i=this._listeners[e.type];if(i!==void 0){const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class X_ extends DD{constructor(e,i,s,a={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=i,this._child=s,this._attributes=a,!i.isOnGraph(s))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class cO extends DD{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(i=>i.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(i=>i.getChild())}disconnectParents(e,i){let s=this.listParentEdges(e);return i&&(s=s.filter(a=>i(a.getParent()))),s.forEach(a=>a.dispose()),this}createEdge(e,i,s,a){return this._registerEdge(new X_(e,i,s,a))}_registerEdge(e){this._edges.add(e);const i=e.getParent();this._parentEdges.has(i)||this._parentEdges.set(i,new Set),this._parentEdges.get(i).add(e);const s=e.getChild();return this._childEdges.has(s)||this._childEdges.set(s,new Set),this._childEdges.get(s).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function tM(){return tM=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c},tM.apply(this,arguments)}function PD(c){return c instanceof X_}function RD(c){return Array.isArray(c)&&c[0]instanceof X_}function BD(c){return!!(c&&typeof c=="object"&&Object.values(c)[0]instanceof X_)}const Ho=Symbol("attributes"),XE=Symbol("immutableKeys");class kD extends DD{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[Ho]=void 0,this[XE]=void 0,this.graph=e,this[XE]=new Set,this[Ho]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),i={};for(const s in e){const a=e[s];if(a instanceof kD){const h=this.graph.createEdge(s,this,a);h.addEventListener("dispose",()=>a.dispose()),this[XE].add(s),i[s]=h}else i[s]=a}return i}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,i){for(const s in this[Ho]){const a=this[Ho][s];if(PD(a)){const h=a;h.getChild()===e&&this.setRef(s,i,h.getAttributes())}else if(RD(a)){const h=a.find(d=>d.getChild()===e);if(h){const d=h.getAttributes();this.removeRef(s,e).addRef(s,i,d)}}else if(BD(a)){const h=a;for(const d in h){const _=h[d];_.getChild()===e&&this.setRefMap(s,d,i,_.getAttributes())}}}return this}get(e){return this[Ho][e]}set(e,i){return this[Ho][e]=i,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const i=this[Ho][e];return i?i.getChild():null}setRef(e,i,s){if(this[XE].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const a=this[Ho][e];if(a&&a.dispose(),!i)return this;const h=this.graph.createEdge(e,this,i,s);return h.addEventListener("dispose",()=>{delete this[Ho][e],this.dispatchEvent({type:"change",attribute:e})}),this[Ho][e]=h,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[Ho][e].map(i=>i.getChild())}addRef(e,i,s){const a=this.graph.createEdge(e,this,i,s),h=this[Ho][e];return h.push(a),a.addEventListener("dispose",()=>{const d=h.filter(_=>_!==a);h.length=0;for(const _ of d)h.push(_);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,i){return this[Ho][e].filter(s=>s.getChild()===i).forEach(s=>s.dispose()),this}listRefMapKeys(e){return Object.keys(this[Ho][e])}listRefMapValues(e){return Object.values(this[Ho][e]).map(i=>i.getChild())}getRefMap(e,i){const s=this[Ho][e];return s[i]?s[i].getChild():null}setRefMap(e,i,s,a){const h=this[Ho][e],d=h[i];if(d&&d.dispose(),!s)return this;a=Object.assign(a||{},{key:i});const _=this.graph.createEdge(e,this,s,tM({},a,{key:i}));return _.addEventListener("dispose",()=>{delete h[i],this.dispatchEvent({type:"change",attribute:e,key:i})}),h[i]=_,this.dispatchEvent({type:"change",attribute:e,key:i})}dispatchEvent(e){return super.dispatchEvent(tM({},e,{target:this})),this.graph.dispatchEvent(tM({},e,{target:this,type:`node:${e.type}`})),this}}var wI,qr,xI,e_,du,t0,LD=typeof Float32Array<"u"?Float32Array:Array;function OD(c){var e=c[0],i=c[1],s=c[2];return Math.hypot(e,i,s)}function uO(c,e,i){var s=e[0],a=e[1],h=e[2],d=i[3]*s+i[7]*a+i[11]*h+i[15];return d=d||1,c[0]=(i[0]*s+i[4]*a+i[8]*h+i[12])/d,c[1]=(i[1]*s+i[5]*a+i[9]*h+i[13])/d,c[2]=(i[2]*s+i[6]*a+i[10]*h+i[14])/d,c}function hO(c,e,i){var s=e[0],a=e[1],h=e[2],d=e[3],_=e[4],et=e[5],nt=e[6],it=e[7],lt=e[8],dt=e[9],pt=e[10],gt=e[11],vt=e[12],Ct=e[13],wt=e[14],xt=e[15],_t=i[0],Pt=i[1],Rt=i[2],Lt=i[3];return c[0]=_t*s+Pt*_+Rt*lt+Lt*vt,c[1]=_t*a+Pt*et+Rt*dt+Lt*Ct,c[2]=_t*h+Pt*nt+Rt*pt+Lt*wt,c[3]=_t*d+Pt*it+Rt*gt+Lt*xt,_t=i[4],Pt=i[5],Rt=i[6],Lt=i[7],c[4]=_t*s+Pt*_+Rt*lt+Lt*vt,c[5]=_t*a+Pt*et+Rt*dt+Lt*Ct,c[6]=_t*h+Pt*nt+Rt*pt+Lt*wt,c[7]=_t*d+Pt*it+Rt*gt+Lt*xt,_t=i[8],Pt=i[9],Rt=i[10],Lt=i[11],c[8]=_t*s+Pt*_+Rt*lt+Lt*vt,c[9]=_t*a+Pt*et+Rt*dt+Lt*Ct,c[10]=_t*h+Pt*nt+Rt*pt+Lt*wt,c[11]=_t*d+Pt*it+Rt*gt+Lt*xt,_t=i[12],Pt=i[13],Rt=i[14],Lt=i[15],c[12]=_t*s+Pt*_+Rt*lt+Lt*vt,c[13]=_t*a+Pt*et+Rt*dt+Lt*Ct,c[14]=_t*h+Pt*nt+Rt*pt+Lt*wt,c[15]=_t*d+Pt*it+Rt*gt+Lt*xt,c}function dO(c,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const s of c.listPrimitives()){const a=s.getAttribute("POSITION");if(!a)continue;let h=[0,0,0],d=[0,0,0];for(let _=0;_<a.getCount();_++)h=a.getElement(_,h),d=uO(d,h,e),ND(d,i)}return i}function ND(c,e){for(let i=0;i<3;i++)e.min[i]=Math.min(c[i],e.min[i]),e.max[i]=Math.max(c[i],e.max[i])}Math.hypot||(Math.hypot=function(){for(var c=0,e=arguments.length;e--;)c+=arguments[e]*arguments[e];return Math.sqrt(c)}),wI=new LD(3),LD!=Float32Array&&(wI[0]=0,wI[1]=0,wI[2]=0),function(c){c.ACCESSOR="Accessor",c.ANIMATION="Animation",c.ANIMATION_CHANNEL="AnimationChannel",c.ANIMATION_SAMPLER="AnimationSampler",c.BUFFER="Buffer",c.CAMERA="Camera",c.MATERIAL="Material",c.MESH="Mesh",c.PRIMITIVE="Primitive",c.PRIMITIVE_TARGET="PrimitiveTarget",c.NODE="Node",c.ROOT="Root",c.SCENE="Scene",c.SKIN="Skin",c.TEXTURE="Texture",c.TEXTURE_INFO="TextureInfo"}(qr||(qr={})),function(c){c.INTERLEAVED="interleaved",c.SEPARATE="separate"}(xI||(xI={})),function(c){c.ARRAY_BUFFER="ARRAY_BUFFER",c.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",c.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",c.OTHER="OTHER"}(e_||(e_={})),function(c){c[c.R=4096]="R",c[c.G=256]="G",c[c.B=16]="B",c[c.A=1]="A"}(du||(du={})),function(c){c.GLTF="GLTF",c.GLB="GLB"}(t0||(t0={}));class go{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const i=atob(e.split(",")[1]),s=new Uint8Array(i.length);for(let a=0;a<i.length;a++)s[a]=i.charCodeAt(a);return s}{const i=e.split(",")[1],s=e.indexOf("base64")>=0;return Buffer.from(i,s?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let i=0;for(const h of e)i+=h.byteLength;const s=new Uint8Array(i);let a=0;for(const h of e)s.set(h,a),a+=h.byteLength;return s}static pad(e,i=0){const s=this.padNumber(e.byteLength);if(s===e.byteLength)return e;const a=new Uint8Array(s);if(a.set(e),i!==0)for(let h=e.byteLength;h<s;h++)a[h]=i;return a}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,i){if(e===i)return!0;if(e.byteLength!==i.byteLength)return!1;let s=e.byteLength;for(;s--;)if(e[s]!==i[s])return!1;return!0}static toView(e,i=0,s=1/0){return new Uint8Array(e.buffer,e.byteOffset+i,Math.min(e.byteLength,s))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Um{static hexToFactor(e,i){e=Math.floor(e);const s=i;return s[0]=(e>>16&255)/255,s[1]=(e>>8&255)/255,s[2]=(255&e)/255,this.convertSRGBToLinear(i,i)}static factorToHex(e){const i=[...e],[s,a,h]=this.convertLinearToSRGB(e,i);return 255*s<<16^255*a<<8^255*h<<0}static convertSRGBToLinear(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.04045?.0773993808*s[h]:Math.pow(.9478672986*s[h]+.0521327014,2.4);return i}static convertLinearToSRGB(e,i){const s=e,a=i;for(let h=0;h<3;h++)a[h]=s[h]<.0031308?12.92*s[h]:1.055*Math.pow(s[h],.41666)-.055;return i}}class bI{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const i=new DataView(e.buffer,e.byteOffset);return go.decodeText(e.slice(12,16))===bI.PNG_FRIED_CHUNK_NAME?[i.getUint32(32,!1),i.getUint32(36,!1)]:[i.getUint32(16,!1),i.getUint32(20,!1)]}getChannels(e){return 4}}bI.PNG_FRIED_CHUNK_NAME="CgBI";class KA{static registerFormat(e,i){this.impls[e]=i}static getMimeType(e){for(const i in this.impls)if(this.impls[i].match(e))return i;return null}static getSize(e,i){return this.impls[i]?this.impls[i].getSize(e):null}static getChannels(e,i){return this.impls[i]?this.impls[i].getChannels(e):null}static getMemSize(e,i){if(!this.impls[i])return null;if(this.impls[i].getGPUByteLength)return this.impls[i].getGPUByteLength(e);let s=0;const a=this.getSize(e,i);if(!a)return null;for(;a[0]>1||a[1]>1;)s+=a[0]*a[1]*4,a[0]=Math.max(Math.floor(a[0]/2),1),a[1]=Math.max(Math.floor(a[1]/2),1);return s+=4,s}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function pO(c,e){if(e>c.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(c.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return c}KA.impls={"image/jpeg":new class{match(c){return c.length>=3&&c[0]===255&&c[1]===216&&c[2]===255}getSize(c){let e,i,s=new DataView(c.buffer,c.byteOffset+4);for(;s.byteLength;){if(e=s.getUint16(0,!1),pO(s,e),i=s.getUint8(e+1),i===192||i===193||i===194)return[s.getUint16(e+7,!1),s.getUint16(e+5,!1)];s=new DataView(c.buffer,s.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(c){return 3}},"image/png":new bI};class qx{static basename(e){const i=e.split(/[\\/]/).pop();return i.substring(0,i.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const i=e.match(/data:(image\/\w+)/)[1];return KA.mimeTypeToExtension(i)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function xR(c){return Object.prototype.toString.call(c)==="[object Object]"}function JA(c){if(xR(c)===!1)return!1;const e=c.constructor;if(e===void 0)return!0;const i=e.prototype;return xR(i)!==!1&&Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")!==!1}class gv{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=gv.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=gv.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=gv.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=gv.Verbosity.ERROR&&console.error(e)}}gv.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},gv.DEFAULT_INSTANCE=new gv(gv.Verbosity.INFO);class Zl{static identity(e){return e}static eq(e,i){if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-i[s])>1e-5)return!1;return!0}static denormalize(e,i){switch(i){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,i){switch(i){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,i,s,a){let h=OD([e[0],e[1],e[2]]);const d=OD([e[4],e[5],e[6]]),_=OD([e[8],e[9],e[10]]);(function(dt){var pt=dt[0],gt=dt[1],vt=dt[2],Ct=dt[3],wt=dt[4],xt=dt[5],_t=dt[6],Pt=dt[7],Rt=dt[8],Lt=dt[9],Ot=dt[10],qt=dt[11],en=dt[12],cn=dt[13],An=dt[14],fn=dt[15];return(pt*xt-gt*wt)*(Ot*fn-qt*An)-(pt*_t-vt*wt)*(Lt*fn-qt*cn)+(pt*Pt-Ct*wt)*(Lt*An-Ot*cn)+(gt*_t-vt*xt)*(Rt*fn-qt*en)-(gt*Pt-Ct*xt)*(Rt*An-Ot*en)+(vt*Pt-Ct*_t)*(Rt*cn-Lt*en)})(e)<0&&(h=-h),i[0]=e[12],i[1]=e[13],i[2]=e[14];const et=e.slice(),nt=1/h,it=1/d,lt=1/_;et[0]*=nt,et[1]*=nt,et[2]*=nt,et[4]*=it,et[5]*=it,et[6]*=it,et[8]*=lt,et[9]*=lt,et[10]*=lt,function(dt,pt){var gt=new LD(3);(function(Tn,gn){var xn=gn[0],Nn=gn[1],Mn=gn[2],Hn=gn[4],rr=gn[5],cr=gn[6],_i=gn[8],xr=gn[9],Mr=gn[10];Tn[0]=Math.hypot(xn,Nn,Mn),Tn[1]=Math.hypot(Hn,rr,cr),Tn[2]=Math.hypot(_i,xr,Mr)})(gt,pt);var vt=1/gt[0],Ct=1/gt[1],wt=1/gt[2],xt=pt[0]*vt,_t=pt[1]*Ct,Pt=pt[2]*wt,Rt=pt[4]*vt,Lt=pt[5]*Ct,Ot=pt[6]*wt,qt=pt[8]*vt,en=pt[9]*Ct,cn=pt[10]*wt,An=xt+Lt+cn,fn=0;An>0?(fn=2*Math.sqrt(An+1),dt[3]=.25*fn,dt[0]=(Ot-en)/fn,dt[1]=(qt-Pt)/fn,dt[2]=(_t-Rt)/fn):xt>Lt&&xt>cn?(fn=2*Math.sqrt(1+xt-Lt-cn),dt[3]=(Ot-en)/fn,dt[0]=.25*fn,dt[1]=(_t+Rt)/fn,dt[2]=(qt+Pt)/fn):Lt>cn?(fn=2*Math.sqrt(1+Lt-xt-cn),dt[3]=(qt-Pt)/fn,dt[0]=(_t+Rt)/fn,dt[1]=.25*fn,dt[2]=(Ot+en)/fn):(fn=2*Math.sqrt(1+cn-xt-Lt),dt[3]=(_t-Rt)/fn,dt[0]=(qt+Pt)/fn,dt[1]=(Ot+en)/fn,dt[2]=.25*fn)}(s,et),a[0]=h,a[1]=d,a[2]=_}static compose(e,i,s,a){const h=a,d=i[0],_=i[1],et=i[2],nt=i[3],it=d+d,lt=_+_,dt=et+et,pt=d*it,gt=d*lt,vt=d*dt,Ct=_*lt,wt=_*dt,xt=et*dt,_t=nt*it,Pt=nt*lt,Rt=nt*dt,Lt=s[0],Ot=s[1],qt=s[2];return h[0]=(1-(Ct+xt))*Lt,h[1]=(gt+Rt)*Lt,h[2]=(vt-Pt)*Lt,h[3]=0,h[4]=(gt-Rt)*Ot,h[5]=(1-(pt+xt))*Ot,h[6]=(wt+_t)*Ot,h[7]=0,h[8]=(vt+Pt)*qt,h[9]=(wt-_t)*qt,h[10]=(1-(pt+Ct))*qt,h[11]=0,h[12]=e[0],h[13]=e[1],h[14]=e[2],h[15]=1,h}}function fO(c,e){if(!!c!=!!e)return!1;const i=c.getChild(),s=e.getChild();return i===s||i.equals(s)}function mO(c,e){if(!!c!=!!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++){const s=c[i],a=e[i];if(s.getChild()!==a.getChild()&&!s.getChild().equals(a.getChild()))return!1}return!0}function gO(c,e){if(!!c!=!!e)return!1;const i=Object.keys(c),s=Object.keys(e);if(i.length!==s.length)return!1;for(const a in c){const h=c[a],d=e[a];if(!!h!=!!d)return!1;const _=h.getChild(),et=d.getChild();if(_!==et&&!_.equals(et))return!1}return!0}function bR(c,e){if(c===e)return!0;if(!!c!=!!e||!c||!e||c.length!==e.length)return!1;for(let i=0;i<c.length;i++)if(c[i]!==e[i])return!1;return!0}function ER(c,e){if(c===e)return!0;if(!!c!=!!e)return!1;if(!JA(c)||!JA(e))return c===e;const i=c,s=e;let a,h=0,d=0;for(a in i)h++;for(a in s)d++;if(h!==d)return!1;for(a in i){const _=i[a],et=s[a];if(EI(_)&&EI(et)){if(!bR(_,et))return!1}else if(JA(_)&&JA(et)){if(!ER(_,et))return!1}else if(_!==et)return!1}return!0}function EI(c){return Array.isArray(c)||ArrayBuffer.isView(c)}const SR="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",CR=new Set,vO=function(){let c="";for(let e=0;e<6;e++)c+=SR.charAt(Math.floor(Math.random()*SR.length));return c};class dw{static dirname(e){const i=e.lastIndexOf("/");return i===-1?"./":e.substring(0,i+1)}static basename(e){return qx.basename(new URL(e,"https://null.example").pathname)}static extension(e){return qx.extension(new URL(e,"https://null.example").pathname)}static resolve(e,i){if(!this.isRelativePath(i))return i;const s=e.split("/"),a=i.split("/");s.pop();for(let h=0;h<a.length;h++)a[h]!=="."&&(a[h]===".."?s.pop():s.push(a[h]));return s.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}dw.DEFAULT_INIT={},dw.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const K_=c=>c,_O=new Set;class UD extends kD{constructor(e,i=""){super(e),this[Ho].name=i,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,K_)}copy(e,i=K_){for(const s in this[Ho]){const a=this[Ho][s];if(a instanceof X_)this[XE].has(s)||a.dispose();else if(Array.isArray(a)&&a[0]instanceof X_)for(const h of a)h.dispose();else if(JA(a)&&Object.values(a)[0]instanceof X_)for(const h in a)a[h].dispose()}for(const s in e[Ho]){const a=this[Ho][s],h=e[Ho][s];if(h instanceof X_)this[XE].has(s)?a.getChild().copy(i(h.getChild()),i):this.setRef(s,i(h.getChild()),h.getAttributes());else if(Array.isArray(h)&&h[0]instanceof X_)for(const d of h)this.addRef(s,i(d.getChild()),d.getAttributes());else if(JA(h)&&Object.values(h)[0]instanceof X_)for(const d in h){const _=h[d];this.setRefMap(s,d,i(_.getChild()),_.getAttributes())}else this[Ho][s]=JA(h)?JSON.parse(JSON.stringify(h)):Array.isArray(h)||h instanceof ArrayBuffer||ArrayBuffer.isView(h)?h.slice():h}return this}equals(e,i=_O){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const s in this[Ho]){if(i.has(s))continue;const a=this[Ho][s],h=e[Ho][s];if(PD(a)||PD(h)){if(!fO(a,h))return!1}else if(RD(a)||RD(h)){if(!mO(a,h))return!1}else if(BD(a)||BD(h)){if(!gO(a,h))return!1}else if(JA(a)||JA(h)){if(!ER(a,h))return!1}else if(EI(a)||EI(h)){if(!bR(a,h))return!1}else if(a!==h)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class cm extends UD{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,i){return i&&i.t(this),this.setRefMap("extensions",e,i)}listExtensions(){return this.listRefMapValues("extensions")}}class us extends cm{constructor(...e){super(...e),this.i=Zl.identity,this.o=Zl.identity}init(){this.propertyType=qr.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:us.Type.SCALAR,componentType:us.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,i=K_){return super.copy(e,i),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case us.Type.SCALAR:return 1;case us.Type.VEC2:return 2;case us.Type.VEC3:return 3;case us.Type.VEC4:case us.Type.MAT2:return 4;case us.Type.MAT3:return 9;case us.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case us.ComponentType.BYTE:case us.ComponentType.UNSIGNED_BYTE:return 1;case us.ComponentType.SHORT:case us.ComponentType.UNSIGNED_SHORT:return 2;case us.ComponentType.UNSIGNED_INT:case us.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const i=this.getElementSize();this.getMin(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMin(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const _=i[h+d];Number.isFinite(_)&&(e[d]=Math.min(e[d],_))}return e}getMaxNormalized(e){const i=this.getElementSize();this.getMax(e);for(let s=0;s<i;s++)e[s]=this.o(e[s]);return e}getMax(e){const i=this.get("array"),s=this.getCount(),a=this.getElementSize();for(let h=0;h<a;h++)e[h]=-1/0;for(let h=0;h<s*a;h+=a)for(let d=0;d<a;d++){const _=i[h+d];Number.isFinite(_)&&(e[d]=Math.max(e[d],_))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return us.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=i=>Zl.denormalize(i,this.get("componentType")),this.i=i=>Zl.normalize(i,this.get("componentType"))):(this.o=Zl.identity,this.i=Zl.identity),this}getScalar(e){const i=this.getElementSize();return this.o(this.get("array")[e*i])}setScalar(e,i){return this.get("array")[e*this.getElementSize()]=this.i(i),this}getElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)i[h]=this.o(a[e*s+h]);return i}setElement(e,i){const s=this.getElementSize(),a=this.get("array");for(let h=0;h<s;h++)a[e*s+h]=this.i(i[h]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(i){switch(i.constructor){case Float32Array:return us.ComponentType.FLOAT;case Uint32Array:return us.ComponentType.UNSIGNED_INT;case Uint16Array:return us.ComponentType.UNSIGNED_SHORT;case Uint8Array:return us.ComponentType.UNSIGNED_BYTE;case Int16Array:return us.ComponentType.SHORT;case Int8Array:return us.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):us.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}us.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},us.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class MR extends cm{init(){this.propertyType=qr.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class FD extends cm{init(){this.propertyType=qr.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}FD.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class KE extends cm{init(){this.propertyType=qr.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:KE.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:e_.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:e_.OTHER})}}KE.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class TR extends cm{init(){this.propertyType=qr.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Yx extends cm{init(){this.propertyType=qr.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Yx.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Yx.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class pu extends UD{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}pu.EXTENSION_NAME=void 0;class Ll extends cm{init(){this.propertyType=qr.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Ll.WrapMode.REPEAT,wrapT:Ll.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}Ll.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Ll.MagFilter={NEAREST:9728,LINEAR:9729},Ll.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:SI,G:CI,B:MI,A:AO}=du;class Xx extends cm{init(){this.propertyType=qr.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Xx.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Ll(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Ll(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Ll(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Ll(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Ll(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const i=this.get("baseColorFactor").slice();return i[3]=e,this.set("baseColorFactor",i)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Um.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const i=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Um.hexToFactor(e,i))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:SI|CI|MI|AO})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Um.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const i=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Um.hexToFactor(e,i))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:SI|CI|MI})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:SI|CI|MI})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:SI})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:CI|MI})}}Xx.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class IR extends cm{init(){this.propertyType=qr.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class TI extends cm{constructor(...e){super(...e),this.u=null}init(){this.propertyType=qr.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,i=K_){if(i===K_)throw new Error("Node cannot be copied.");return super.copy(e,i)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Zl.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const i=this.get("translation").slice(),s=this.get("rotation").slice(),a=this.get("scale").slice();return Zl.decompose(e,i,s,a),this.set("translation",i).set("rotation",s).set("scale",a)}getWorldTranslation(){const e=[0,0,0];return Zl.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Zl.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Zl.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let a=this;a instanceof TI;a=a.u)e.push(a);let i;const s=e.pop().getMatrix();for(;i=e.pop();)hO(s,s,i.getMatrix());return s}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Ho].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const i of this.listChildren())i.traverse(e);return this}}class Kx extends cm{init(){this.propertyType=qr.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Kx.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:e_.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:e_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}Kx.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class yO extends UD{init(){this.propertyType=qr.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:e_.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function Fm(){return(Fm=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}class DR extends cm{init(){this.propertyType=qr.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,i=K_){if(i===K_)throw new Error("Scene cannot be copied.");return super.copy(e,i)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const i=this[Ho].children;return i[i.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const i of this.listChildren())i.traverse(e);return this}}class PR extends cm{init(){this.propertyType=qr.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:e_.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class RR extends cm{init(){this.propertyType=qr.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||KA.extensionToMimeType(qx.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",KA.extensionToMimeType(qx.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",go.assertView(e))}getSize(){const e=this.get("image");return e?KA.getSize(e,this.getMimeType()):null}}class BR extends cm{init(){this.propertyType=qr.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",i=>{this.l(i.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,i=K_){if(i===K_)throw new Error("Root cannot be copied.");this.set("asset",Fm({},e.get("asset"))),this.setName(e.getName()),this.setExtras(Fm({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?i(e.getDefaultScene()):null);for(const s of e.listRefMapKeys("extensions")){const a=e.getExtension(s);this.setExtension(s,i(a))}return this}l(e){return e instanceof DR?this.addRef("scenes",e):e instanceof TI?this.addRef("nodes",e):e instanceof Yx?this.addRef("cameras",e):e instanceof PR?this.addRef("skins",e):e instanceof IR?this.addRef("meshes",e):e instanceof Xx?this.addRef("materials",e):e instanceof RR?this.addRef("textures",e):e instanceof MR?this.addRef("animations",e):e instanceof us?this.addRef("accessors",e):e instanceof TR&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class jD{constructor(){this.m=new cO,this.T=new BR(this.m),this.v=gv.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new jD().setLogger(this.v).merge(this)}merge(e){for(const h of e.getRoot().listExtensionsUsed()){const d=this.createExtension(h.constructor);h.isRequired()&&d.setRequired(!0)}const i=new Set,s=new Map;i.add(e.T),s.set(e.T,this.T);for(const h of e.m.listEdges())for(const d of[h.getParent(),h.getChild()]){if(i.has(d))continue;let _;_=d.propertyType===qr.TEXTURE_INFO?d:new d.constructor(this.m),s.set(d,_),i.add(d)}const a=h=>{const d=s.get(h);if(!d)throw new Error("Could resolve property.");return d};for(const h of i){const d=s.get(h);if(!d)throw new Error("Could resolve property.");d.propertyType!==qr.TEXTURE_INFO&&d.copy(h,a)}return this}async transform(...e){const i=e.map(s=>s.name);for(const s of e)await s(this,{stack:i});return this}createExtension(e){const i=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===i)||new e(this)}createScene(e=""){return new DR(this.m,e)}createNode(e=""){return new TI(this.m,e)}createCamera(e=""){return new Yx(this.m,e)}createSkin(e=""){return new PR(this.m,e)}createMesh(e=""){return new IR(this.m,e)}createPrimitive(){return new Kx(this.m)}createPrimitiveTarget(e=""){return new yO(this.m,e)}createMaterial(e=""){return new Xx(this.m,e)}createTexture(e=""){return new RR(this.m,e)}createAnimation(e=""){return new MR(this.m,e)}createAnimationChannel(e=""){return new FD(this.m,e)}createAnimationSampler(e=""){return new KE(this.m,e)}createAccessor(e="",i=null){return i||(i=this.getRoot().listBuffers()[0]),new us(this.m,e).setBuffer(i)}createBuffer(e=""){return new TR(this.m,e)}}class Vl{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=s=>{const a=s,h=a.target;h instanceof pu&&h.extensionName===this.extensionName&&(a.type==="node:create"&&this.M(h),a.type==="node:dispose"&&this.I(h))};const i=e.getGraph();i.addEventListener("node:create",this.S),i.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const i of this.properties)i.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,i){return this}preread(e,i){return this}prewrite(e,i){return this}}Vl.EXTENSION_NAME=void 0;class wO{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,i){this.textureInfos.set(e,i),i.texCoord!==void 0&&e.setTexCoord(i.texCoord);const s=this.jsonDoc.json.textures[i.index];if(s.sampler===void 0)return;const a=this.jsonDoc.json.samplers[s.sampler];a.magFilter!==void 0&&e.setMagFilter(a.magFilter),a.minFilter!==void 0&&e.setMinFilter(a.minFilter),a.wrapS!==void 0&&e.setWrapS(a.wrapS),a.wrapT!==void 0&&e.setWrapT(a.wrapT)}}const zD={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},kR={logger:gv.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function II(c,e){const i=e.bufferViews[c.bufferView],s=e.jsonDoc.json.bufferViews[c.bufferView],a=zD[c.componentType],h=us.getElementSize(c.type),d=a.BYTES_PER_ELEMENT;if(s.byteStride!==void 0&&s.byteStride!==h*d)return function(et,nt){const it=nt.bufferViews[et.bufferView],lt=nt.jsonDoc.json.bufferViews[et.bufferView],dt=zD[et.componentType],pt=us.getElementSize(et.type),gt=dt.BYTES_PER_ELEMENT,vt=et.byteOffset||0,Ct=new dt(et.count*pt),wt=new DataView(it.buffer,it.byteOffset,it.byteLength),xt=lt.byteStride;for(let _t=0;_t<et.count;_t++)for(let Pt=0;Pt<pt;Pt++){const Rt=vt+_t*xt+Pt*gt;let Lt;switch(et.componentType){case us.ComponentType.FLOAT:Lt=wt.getFloat32(Rt,!0);break;case us.ComponentType.UNSIGNED_INT:Lt=wt.getUint32(Rt,!0);break;case us.ComponentType.UNSIGNED_SHORT:Lt=wt.getUint16(Rt,!0);break;case us.ComponentType.UNSIGNED_BYTE:Lt=wt.getUint8(Rt);break;case us.ComponentType.SHORT:Lt=wt.getInt16(Rt,!0);break;case us.ComponentType.BYTE:Lt=wt.getInt8(Rt);break;default:throw new Error(`Unexpected componentType "${et.componentType}".`)}Ct[_t*pt+Pt]=Lt}return Ct}(c,e);const _=i.byteOffset+(c.byteOffset||0);return new a(i.buffer.slice(_,_+c.count*h*d))}var nM;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER",c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(nM||(nM={}));class n0{constructor(e,i,s){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=i,this.options=s;const a=e.getRoot(),h=a.listBuffers().length,d=a.listTextures().length;this.bufferURIGenerator=new LR(h>1,s.basename),this.imageURIGenerator=new LR(d>1,s.basename),this.logger=e.getLogger()}createTextureInfoDef(e,i){const s={magFilter:i.getMagFilter()||void 0,minFilter:i.getMinFilter()||void 0,wrapS:i.getWrapS(),wrapT:i.getWrapT()},a=JSON.stringify(s);this.samplerDefIndexMap.has(a)||(this.samplerDefIndexMap.set(a,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(s));const h={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(a)},d=JSON.stringify(h);this.textureDefIndexMap.has(d)||(this.textureDefIndexMap.set(d,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(h));const _={index:this.textureDefIndexMap.get(d)};return i.getTexCoord()!==0&&(_.texCoord=i.getTexCoord()),this.textureInfoDefMap.set(i,_),_}createPropertyDef(e){const i={};return e.getName()&&(i.name=e.getName()),Object.keys(e.getExtras()).length>0&&(i.extras=e.getExtras()),i}createAccessorDef(e){const i=this.createPropertyDef(e);return i.type=e.getType(),i.componentType=e.getComponentType(),i.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(i.max=e.getMax([]).map(Math.fround),i.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(i.normalized=e.getNormalized()),i}createImageData(e,i,s){if(this.options.format===t0.GLB)this.imageBufferViews.push(i),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:i.byteLength});else{const a=KA.mimeTypeToExtension(s.getMimeType());e.uri=this.imageURIGenerator.createURI(s,a),this.jsonDoc.resources[e.uri]=i}}getAccessorUsage(e){const i=this.O.get(e);if(i)return i;for(const s of this.N.getGraph().listParentEdges(e)){const{usage:a}=s.getAttributes();if(a)return a;s.getParent().propertyType!==qr.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${s.getName()}".`)}return n0.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,i){const s=this.O.get(e);if(s&&s!==i)throw new Error(`Accessor with usage "${s}" cannot be reused as "${i}".`);return this.O.set(e,i),this}listAccessorUsageGroups(){const e={};for(const[i,s]of Array.from(this.O.entries()))e[s]=e[s]||[],e[s].push(i);return e}}n0.BufferViewTarget=nM,n0.BufferViewUsage=e_,n0.USAGE_TO_TARGET={[e_.ARRAY_BUFFER]:nM.ARRAY_BUFFER,[e_.ELEMENT_ARRAY_BUFFER]:nM.ELEMENT_ARRAY_BUFFER};class LR{constructor(e,i){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=i}createURI(e,i){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${i}`:`${this.basename}.${i}`}}const{BufferViewUsage:VD}=n0;var DI;(function(c){c[c.JSON=1313821514]="JSON",c[c.BIN=5130562]="BIN"})(DI||(DI={}));class xO extends class{constructor(){this.v=gv.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=xI.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const i of e)this.h.add(i),i.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===t0.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(i,s=kR){const a=Fm({},kR,s),{json:h}=i,d=new jD;this.validate(i,a);const _=new wO(i),et=h.asset,nt=d.getRoot().getAsset();et.copyright&&(nt.copyright=et.copyright),et.extras&&(nt.extras=et.extras),h.extras!==void 0&&d.getRoot().setExtras(Fm({},h.extras));const it=h.extensionsUsed||[],lt=h.extensionsRequired||[];for(const xt of a.extensions)if(it.includes(xt.EXTENSION_NAME)){const _t=d.createExtension(xt).setRequired(lt.includes(xt.EXTENSION_NAME));for(const Pt of _t.readDependencies)_t.install(Pt,a.dependencies[Pt])}const dt=h.buffers||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(qr.BUFFER)).forEach(xt=>xt.preread(_,qr.BUFFER)),_.buffers=dt.map(xt=>{const _t=d.createBuffer(xt.name);return xt.extras&&_t.setExtras(xt.extras),xt.uri&&xt.uri.indexOf("__")!==0&&_t.setURI(xt.uri),_t}),_.bufferViewBuffers=(h.bufferViews||[]).map((xt,_t)=>{if(!_.bufferViews[_t]){const Pt=i.json.buffers[xt.buffer];_.bufferViews[_t]=go.toView(Pt.uri?i.resources[Pt.uri]:i.resources["@glb.bin"],xt.byteOffset||0,xt.byteLength)}return _.buffers[xt.buffer]}),_.accessors=(h.accessors||[]).map(xt=>{const _t=d.createAccessor(xt.name,_.bufferViewBuffers[xt.bufferView]).setType(xt.type);if(xt.extras&&_t.setExtras(xt.extras),xt.normalized!==void 0&&_t.setNormalized(xt.normalized),xt.bufferView===void 0&&!xt.sparse)return _t;let Pt;return Pt=xt.sparse!==void 0?function(Rt,Lt){const Ot=zD[Rt.componentType],qt=us.getElementSize(Rt.type);let en;en=Rt.bufferView!==void 0?II(Rt,Lt):new Ot(Rt.count*qt);const cn=Rt.sparse,An=cn.count,fn=Fm({},Rt,cn.indices,{count:An,type:"SCALAR"}),Tn=Fm({},Rt,cn.values,{count:An}),gn=II(fn,Lt),xn=II(Tn,Lt);for(let Nn=0;Nn<fn.count;Nn++)for(let Mn=0;Mn<qt;Mn++)en[gn[Nn]*qt+Mn]=xn[Nn*qt+Mn];return en}(xt,_):II(xt,_),_t.setArray(Pt),_t});const pt=h.images||[],gt=h.textures||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(qr.TEXTURE)).forEach(xt=>xt.preread(_,qr.TEXTURE)),_.textures=pt.map(xt=>{const _t=d.createTexture(xt.name);if(xt.extras&&_t.setExtras(xt.extras),xt.bufferView!==void 0){const Pt=h.bufferViews[xt.bufferView],Rt=i.json.buffers[Pt.buffer],Lt=Pt.byteOffset||0,Ot=(Rt.uri?i.resources[Rt.uri]:i.resources["@glb.bin"]).slice(Lt,Lt+Pt.byteLength);_t.setImage(Ot)}else xt.uri!==void 0&&(_t.setImage(i.resources[xt.uri]),xt.uri.indexOf("__")!==0&&_t.setURI(xt.uri));if(xt.mimeType!==void 0)_t.setMimeType(xt.mimeType);else if(xt.uri){const Pt=qx.extension(xt.uri);_t.setMimeType(KA.extensionToMimeType(Pt))}return _t}),_.materials=(h.materials||[]).map(xt=>{const _t=d.createMaterial(xt.name);xt.extras&&_t.setExtras(xt.extras),xt.alphaMode!==void 0&&_t.setAlphaMode(xt.alphaMode),xt.alphaCutoff!==void 0&&_t.setAlphaCutoff(xt.alphaCutoff),xt.doubleSided!==void 0&&_t.setDoubleSided(xt.doubleSided);const Pt=xt.pbrMetallicRoughness||{};if(Pt.baseColorFactor!==void 0&&_t.setBaseColorFactor(Pt.baseColorFactor),xt.emissiveFactor!==void 0&&_t.setEmissiveFactor(xt.emissiveFactor),Pt.metallicFactor!==void 0&&_t.setMetallicFactor(Pt.metallicFactor),Pt.roughnessFactor!==void 0&&_t.setRoughnessFactor(Pt.roughnessFactor),Pt.baseColorTexture!==void 0){const Rt=Pt.baseColorTexture;_t.setBaseColorTexture(_.textures[gt[Rt.index].source]),_.setTextureInfo(_t.getBaseColorTextureInfo(),Rt)}if(xt.emissiveTexture!==void 0){const Rt=xt.emissiveTexture;_t.setEmissiveTexture(_.textures[gt[Rt.index].source]),_.setTextureInfo(_t.getEmissiveTextureInfo(),Rt)}if(xt.normalTexture!==void 0){const Rt=xt.normalTexture;_t.setNormalTexture(_.textures[gt[Rt.index].source]),_.setTextureInfo(_t.getNormalTextureInfo(),Rt),xt.normalTexture.scale!==void 0&&_t.setNormalScale(xt.normalTexture.scale)}if(xt.occlusionTexture!==void 0){const Rt=xt.occlusionTexture;_t.setOcclusionTexture(_.textures[gt[Rt.index].source]),_.setTextureInfo(_t.getOcclusionTextureInfo(),Rt),xt.occlusionTexture.strength!==void 0&&_t.setOcclusionStrength(xt.occlusionTexture.strength)}if(Pt.metallicRoughnessTexture!==void 0){const Rt=Pt.metallicRoughnessTexture;_t.setMetallicRoughnessTexture(_.textures[gt[Rt.index].source]),_.setTextureInfo(_t.getMetallicRoughnessTextureInfo(),Rt)}return _t});const vt=h.meshes||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(qr.PRIMITIVE)).forEach(xt=>xt.preread(_,qr.PRIMITIVE)),_.meshes=vt.map(xt=>{const _t=d.createMesh(xt.name);return xt.extras&&_t.setExtras(xt.extras),xt.weights!==void 0&&_t.setWeights(xt.weights),(xt.primitives||[]).forEach(Pt=>{const Rt=d.createPrimitive();Pt.extras&&Rt.setExtras(Pt.extras),Pt.material!==void 0&&Rt.setMaterial(_.materials[Pt.material]),Pt.mode!==void 0&&Rt.setMode(Pt.mode);for(const[Ot,qt]of Object.entries(Pt.attributes||{}))Rt.setAttribute(Ot,_.accessors[qt]);Pt.indices!==void 0&&Rt.setIndices(_.accessors[Pt.indices]);const Lt=xt.extras&&xt.extras.targetNames||[];(Pt.targets||[]).forEach((Ot,qt)=>{const en=Lt[qt]||qt.toString(),cn=d.createPrimitiveTarget(en);for(const[An,fn]of Object.entries(Ot))cn.setAttribute(An,_.accessors[fn]);Rt.addTarget(cn)}),_t.addPrimitive(Rt)}),_t}),_.cameras=(h.cameras||[]).map(xt=>{const _t=d.createCamera(xt.name).setType(xt.type);if(xt.extras&&_t.setExtras(xt.extras),xt.type===Yx.Type.PERSPECTIVE){const Pt=xt.perspective;_t.setYFov(Pt.yfov),_t.setZNear(Pt.znear),Pt.zfar!==void 0&&_t.setZFar(Pt.zfar),Pt.aspectRatio!==void 0&&_t.setAspectRatio(Pt.aspectRatio)}else{const Pt=xt.orthographic;_t.setZNear(Pt.znear).setZFar(Pt.zfar).setXMag(Pt.xmag).setYMag(Pt.ymag)}return _t});const Ct=h.nodes||[];d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(qr.NODE)).forEach(xt=>xt.preread(_,qr.NODE)),_.nodes=Ct.map(xt=>{const _t=d.createNode(xt.name);if(xt.extras&&_t.setExtras(xt.extras),xt.translation!==void 0&&_t.setTranslation(xt.translation),xt.rotation!==void 0&&_t.setRotation(xt.rotation),xt.scale!==void 0&&_t.setScale(xt.scale),xt.matrix!==void 0){const Pt=[0,0,0],Rt=[0,0,0,1],Lt=[1,1,1];Zl.decompose(xt.matrix,Pt,Rt,Lt),_t.setTranslation(Pt),_t.setRotation(Rt),_t.setScale(Lt)}return xt.weights!==void 0&&_t.setWeights(xt.weights),_t}),_.skins=(h.skins||[]).map(xt=>{const _t=d.createSkin(xt.name);xt.extras&&_t.setExtras(xt.extras),xt.inverseBindMatrices!==void 0&&_t.setInverseBindMatrices(_.accessors[xt.inverseBindMatrices]),xt.skeleton!==void 0&&_t.setSkeleton(_.nodes[xt.skeleton]);for(const Pt of xt.joints)_t.addJoint(_.nodes[Pt]);return _t}),Ct.map((xt,_t)=>{const Pt=_.nodes[_t];(xt.children||[]).forEach(Rt=>Pt.addChild(_.nodes[Rt])),xt.mesh!==void 0&&Pt.setMesh(_.meshes[xt.mesh]),xt.camera!==void 0&&Pt.setCamera(_.cameras[xt.camera]),xt.skin!==void 0&&Pt.setSkin(_.skins[xt.skin])}),_.animations=(h.animations||[]).map(xt=>{const _t=d.createAnimation(xt.name);xt.extras&&_t.setExtras(xt.extras);const Pt=(xt.samplers||[]).map(Rt=>{const Lt=d.createAnimationSampler().setInput(_.accessors[Rt.input]).setOutput(_.accessors[Rt.output]).setInterpolation(Rt.interpolation||KE.Interpolation.LINEAR);return Rt.extras&&Lt.setExtras(Rt.extras),_t.addSampler(Lt),Lt});return(xt.channels||[]).forEach(Rt=>{const Lt=d.createAnimationChannel().setSampler(Pt[Rt.sampler]).setTargetPath(Rt.target.path);Rt.target.node!==void 0&&Lt.setTargetNode(_.nodes[Rt.target.node]),Rt.extras&&Lt.setExtras(Rt.extras),_t.addChannel(Lt)}),_t});const wt=h.scenes||[];return d.getRoot().listExtensionsUsed().filter(xt=>xt.prereadTypes.includes(qr.SCENE)).forEach(xt=>xt.preread(_,qr.SCENE)),_.scenes=wt.map(xt=>{const _t=d.createScene(xt.name);return xt.extras&&_t.setExtras(xt.extras),(xt.nodes||[]).map(Pt=>_.nodes[Pt]).forEach(Pt=>_t.addChild(Pt)),_t}),h.scene!==void 0&&d.getRoot().setDefaultScene(_.scenes[h.scene]),d.getRoot().listExtensionsUsed().forEach(xt=>xt.read(_)),d}static validate(i,s){const a=i.json;if(a.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${a.asset.version}".`);if(a.extensionsRequired){for(const h of a.extensionsRequired)if(!s.extensions.find(d=>d.EXTENSION_NAME===h))throw new Error(`Missing required extension, "${h}".`)}if(a.extensionsUsed)for(const h of a.extensionsUsed)s.extensions.find(d=>d.EXTENSION_NAME===h)||s.logger.warn(`Missing optional extension, "${h}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const i=this._(go.assertView(e));this.L(i);const s=i.json;if(s.buffers&&s.buffers.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)}(i,a)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(s.images&&s.images.some(a=>function(h,d){return d.uri!==void 0&&!(d.uri in h.resources)&&d.bufferView===void 0}(i,a)))throw new Error("Cannot resolve external images with binaryToJSON().");return i}async readBinary(e){return this.readJSON(await this.binaryToJSON(go.assertView(e)))}async writeJSON(e,i={}){if(i.format===t0.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return class{static write(s,a){const h=s.getRoot(),d={asset:Fm({generator:"glTF-Transform v2.2.3"},h.getAsset()),extras:Fm({},h.getExtras())},_={json:d,resources:{}},et=new n0(s,_,a),nt=a.logger||gv.DEFAULT_INSTANCE,it=new Set(a.extensions.map(wt=>wt.EXTENSION_NAME)),lt=s.getRoot().listExtensionsUsed().filter(wt=>it.has(wt.extensionName)),dt=s.getRoot().listExtensionsRequired().filter(wt=>it.has(wt.extensionName));lt.length<s.getRoot().listExtensionsUsed().length&&nt.debug("Some extensions were not registered for I/O, and will not be written.");for(const wt of lt)for(const xt of wt.writeDependencies)wt.install(xt,a.dependencies[xt]);function pt(wt,xt,_t,Pt){const Rt=[];let Lt=0;for(const qt of wt){const en=et.createAccessorDef(qt);en.bufferView=d.bufferViews.length;const cn=qt.getArray(),An=go.pad(go.toView(cn));en.byteOffset=Lt,Lt+=An.byteLength,Rt.push(An),et.accessorIndexMap.set(qt,d.accessors.length),d.accessors.push(en)}const Ot={buffer:xt,byteOffset:_t,byteLength:go.concat(Rt).byteLength};return Pt&&(Ot.target=Pt),d.bufferViews.push(Ot),{buffers:Rt,byteLength:Lt}}function gt(wt,xt,_t){const Pt=wt[0].getCount();let Rt=0;for(const en of wt){const cn=et.createAccessorDef(en);cn.bufferView=d.bufferViews.length,cn.byteOffset=Rt;const An=en.getElementSize(),fn=en.getComponentSize();Rt+=go.padNumber(An*fn),et.accessorIndexMap.set(en,d.accessors.length),d.accessors.push(cn)}const Lt=Pt*Rt,Ot=new ArrayBuffer(Lt),qt=new DataView(Ot);for(let en=0;en<Pt;en++){let cn=0;for(const An of wt){const fn=An.getElementSize(),Tn=An.getComponentSize(),gn=An.getComponentType(),xn=An.getArray();for(let Nn=0;Nn<fn;Nn++){const Mn=en*Rt+cn+Nn*Tn,Hn=xn[en*fn+Nn];switch(gn){case us.ComponentType.FLOAT:qt.setFloat32(Mn,Hn,!0);break;case us.ComponentType.BYTE:qt.setInt8(Mn,Hn);break;case us.ComponentType.SHORT:qt.setInt16(Mn,Hn,!0);break;case us.ComponentType.UNSIGNED_BYTE:qt.setUint8(Mn,Hn);break;case us.ComponentType.UNSIGNED_SHORT:qt.setUint16(Mn,Hn,!0);break;case us.ComponentType.UNSIGNED_INT:qt.setUint32(Mn,Hn,!0);break;default:throw new Error("Unexpected component type: "+gn)}}cn+=go.padNumber(fn*Tn)}}return d.bufferViews.push({buffer:xt,byteOffset:_t,byteLength:Lt,byteStride:Rt,target:n0.BufferViewTarget.ARRAY_BUFFER}),{byteLength:Lt,buffers:[new Uint8Array(Ot)]}}const vt=new Map;for(const wt of s.getGraph().listEdges()){if(wt.getParent()===h)continue;const xt=wt.getChild();if(xt instanceof us){const _t=vt.get(xt)||[];_t.push(wt),vt.set(xt,_t)}}if(d.accessors=[],d.bufferViews=[],d.samplers=[],d.textures=[],d.images=h.listTextures().map((wt,xt)=>{const _t=et.createPropertyDef(wt);wt.getMimeType()&&(_t.mimeType=wt.getMimeType());const Pt=wt.getImage();return Pt&&et.createImageData(_t,Pt,wt),et.imageIndexMap.set(wt,xt),_t}),lt.filter(wt=>wt.prewriteTypes.includes(qr.ACCESSOR)).forEach(wt=>wt.prewrite(et,qr.ACCESSOR)),h.listAccessors().forEach(wt=>{const xt=et.accessorUsageGroupedByParent,_t=et.accessorParents;if(et.accessorIndexMap.has(wt))return;const Pt=vt.get(wt)||[],Rt=et.getAccessorUsage(wt);if(et.addAccessorToUsageGroup(wt,Rt),xt.has(Rt)){const Lt=Pt[0].getParent(),Ot=_t.get(Lt)||new Set;Ot.add(wt),_t.set(Lt,Ot)}}),lt.filter(wt=>wt.prewriteTypes.includes(qr.BUFFER)).forEach(wt=>wt.prewrite(et,qr.BUFFER)),(h.listAccessors().length>0||h.listTextures().length>0||et.otherBufferViews.size>0)&&h.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");d.buffers=[],h.listBuffers().forEach((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=et.accessorUsageGroupedByParent,Rt=et.accessorParents,Lt=wt.listParents().filter(fn=>fn instanceof us),Ot=new Set(Lt),qt=[],en=d.buffers.length;let cn=0;const An=et.listAccessorUsageGroups();for(const fn in An)if(Pt.has(fn))for(const Tn of Array.from(Rt.values())){const gn=Array.from(Tn).filter(xn=>Ot.has(xn)).filter(xn=>et.getAccessorUsage(xn)===fn);if(gn.length)if(fn!==VD.ARRAY_BUFFER||a.vertexLayout===xI.INTERLEAVED){const xn=fn===VD.ARRAY_BUFFER?gt(gn,en,cn):pt(gn,en,cn);cn+=xn.byteLength,qt.push(...xn.buffers)}else for(const xn of gn){const Nn=gt([xn],en,cn);cn+=Nn.byteLength,qt.push(...Nn.buffers)}}else{const Tn=An[fn].filter(xn=>Ot.has(xn));if(!Tn.length)continue;const gn=pt(Tn,en,cn,fn===VD.ELEMENT_ARRAY_BUFFER?n0.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);cn+=gn.byteLength,qt.push(...gn.buffers)}if(et.imageBufferViews.length&&xt===0){for(let fn=0;fn<et.imageBufferViews.length;fn++)if(d.bufferViews[d.images[fn].bufferView].byteOffset=cn,cn+=et.imageBufferViews[fn].byteLength,qt.push(et.imageBufferViews[fn]),cn%8){const Tn=8-cn%8;cn+=Tn,qt.push(new Uint8Array(Tn))}}if(et.otherBufferViews.has(wt))for(const fn of et.otherBufferViews.get(wt))d.bufferViews.push({buffer:en,byteOffset:cn,byteLength:fn.byteLength}),et.otherBufferViewsIndexMap.set(fn,d.bufferViews.length-1),cn+=fn.byteLength,qt.push(fn);if(cn){let fn;a.format===t0.GLB?fn="@glb.bin":(fn=et.bufferURIGenerator.createURI(wt,"bin"),_t.uri=fn),_t.byteLength=cn,_.resources[fn]=go.concat(qt)}d.buffers.push(_t),et.bufferIndexMap.set(wt,xt)}),h.listAccessors().find(wt=>!wt.getBuffer())&&nt.warn("Skipped writing one or more Accessors: no Buffer assigned."),d.materials=h.listMaterials().map((wt,xt)=>{const _t=et.createPropertyDef(wt);if(wt.getAlphaMode()!==Xx.AlphaMode.OPAQUE&&(_t.alphaMode=wt.getAlphaMode()),wt.getAlphaMode()===Xx.AlphaMode.MASK&&(_t.alphaCutoff=wt.getAlphaCutoff()),wt.getDoubleSided()&&(_t.doubleSided=!0),_t.pbrMetallicRoughness={},Zl.eq(wt.getBaseColorFactor(),[1,1,1,1])||(_t.pbrMetallicRoughness.baseColorFactor=wt.getBaseColorFactor()),Zl.eq(wt.getEmissiveFactor(),[0,0,0])||(_t.emissiveFactor=wt.getEmissiveFactor()),wt.getRoughnessFactor()!==1&&(_t.pbrMetallicRoughness.roughnessFactor=wt.getRoughnessFactor()),wt.getMetallicFactor()!==1&&(_t.pbrMetallicRoughness.metallicFactor=wt.getMetallicFactor()),wt.getBaseColorTexture()){const Pt=wt.getBaseColorTexture(),Rt=wt.getBaseColorTextureInfo();_t.pbrMetallicRoughness.baseColorTexture=et.createTextureInfoDef(Pt,Rt)}if(wt.getEmissiveTexture()){const Pt=wt.getEmissiveTexture(),Rt=wt.getEmissiveTextureInfo();_t.emissiveTexture=et.createTextureInfoDef(Pt,Rt)}if(wt.getNormalTexture()){const Pt=wt.getNormalTexture(),Rt=wt.getNormalTextureInfo(),Lt=et.createTextureInfoDef(Pt,Rt);wt.getNormalScale()!==1&&(Lt.scale=wt.getNormalScale()),_t.normalTexture=Lt}if(wt.getOcclusionTexture()){const Pt=wt.getOcclusionTexture(),Rt=wt.getOcclusionTextureInfo(),Lt=et.createTextureInfoDef(Pt,Rt);wt.getOcclusionStrength()!==1&&(Lt.strength=wt.getOcclusionStrength()),_t.occlusionTexture=Lt}if(wt.getMetallicRoughnessTexture()){const Pt=wt.getMetallicRoughnessTexture(),Rt=wt.getMetallicRoughnessTextureInfo();_t.pbrMetallicRoughness.metallicRoughnessTexture=et.createTextureInfoDef(Pt,Rt)}return et.materialIndexMap.set(wt,xt),_t}),d.meshes=h.listMeshes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);let Pt=null;return _t.primitives=wt.listPrimitives().map(Rt=>{const Lt={attributes:{}};Lt.mode=Rt.getMode();const Ot=Rt.getMaterial();Ot&&(Lt.material=et.materialIndexMap.get(Ot)),Object.keys(Rt.getExtras()).length&&(Lt.extras=Rt.getExtras());const qt=Rt.getIndices();qt&&(Lt.indices=et.accessorIndexMap.get(qt));for(const en of Rt.listSemantics())Lt.attributes[en]=et.accessorIndexMap.get(Rt.getAttribute(en));for(const en of Rt.listTargets()){const cn={};for(const An of en.listSemantics())cn[An]=et.accessorIndexMap.get(en.getAttribute(An));Lt.targets=Lt.targets||[],Lt.targets.push(cn)}return Rt.listTargets().length&&!Pt&&(Pt=Rt.listTargets().map(en=>en.getName())),Lt}),wt.getWeights().length&&(_t.weights=wt.getWeights()),Pt&&(_t.extras=_t.extras||{},_t.extras.targetNames=Pt),et.meshIndexMap.set(wt,xt),_t}),d.cameras=h.listCameras().map((wt,xt)=>{const _t=et.createPropertyDef(wt);if(_t.type=wt.getType(),_t.type===Yx.Type.PERSPECTIVE){_t.perspective={znear:wt.getZNear(),zfar:wt.getZFar(),yfov:wt.getYFov()};const Pt=wt.getAspectRatio();Pt!==null&&(_t.perspective.aspectRatio=Pt)}else _t.orthographic={znear:wt.getZNear(),zfar:wt.getZFar(),xmag:wt.getXMag(),ymag:wt.getYMag()};return et.cameraIndexMap.set(wt,xt),_t}),d.nodes=h.listNodes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);return Zl.eq(wt.getTranslation(),[0,0,0])||(_t.translation=wt.getTranslation()),Zl.eq(wt.getRotation(),[0,0,0,1])||(_t.rotation=wt.getRotation()),Zl.eq(wt.getScale(),[1,1,1])||(_t.scale=wt.getScale()),wt.getWeights().length&&(_t.weights=wt.getWeights()),et.nodeIndexMap.set(wt,xt),_t}),d.skins=h.listSkins().map((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=wt.getInverseBindMatrices();Pt&&(_t.inverseBindMatrices=et.accessorIndexMap.get(Pt));const Rt=wt.getSkeleton();return Rt&&(_t.skeleton=et.nodeIndexMap.get(Rt)),_t.joints=wt.listJoints().map(Lt=>et.nodeIndexMap.get(Lt)),et.skinIndexMap.set(wt,xt),_t}),h.listNodes().forEach((wt,xt)=>{const _t=d.nodes[xt],Pt=wt.getMesh();Pt&&(_t.mesh=et.meshIndexMap.get(Pt));const Rt=wt.getCamera();Rt&&(_t.camera=et.cameraIndexMap.get(Rt));const Lt=wt.getSkin();Lt&&(_t.skin=et.skinIndexMap.get(Lt)),wt.listChildren().length>0&&(_t.children=wt.listChildren().map(Ot=>et.nodeIndexMap.get(Ot)))}),d.animations=h.listAnimations().map((wt,xt)=>{const _t=et.createPropertyDef(wt),Pt=new Map;return _t.samplers=wt.listSamplers().map((Rt,Lt)=>{const Ot=et.createPropertyDef(Rt);return Ot.input=et.accessorIndexMap.get(Rt.getInput()),Ot.output=et.accessorIndexMap.get(Rt.getOutput()),Ot.interpolation=Rt.getInterpolation(),Pt.set(Rt,Lt),Ot}),_t.channels=wt.listChannels().map(Rt=>{const Lt=et.createPropertyDef(Rt);return Lt.sampler=Pt.get(Rt.getSampler()),Lt.target={node:et.nodeIndexMap.get(Rt.getTargetNode()),path:Rt.getTargetPath()},Lt}),et.animationIndexMap.set(wt,xt),_t}),d.scenes=h.listScenes().map((wt,xt)=>{const _t=et.createPropertyDef(wt);return _t.nodes=wt.listChildren().map(Pt=>et.nodeIndexMap.get(Pt)),et.sceneIndexMap.set(wt,xt),_t});const Ct=h.getDefaultScene();return Ct&&(d.scene=h.listScenes().indexOf(Ct)),d.extensionsUsed=lt.map(wt=>wt.extensionName),d.extensionsRequired=dt.map(wt=>wt.extensionName),lt.forEach(wt=>wt.write(et)),function(wt){const xt=[];for(const _t in wt){const Pt=wt[_t];(Array.isArray(Pt)&&Pt.length===0||Pt===null||Pt===""||Pt&&typeof Pt=="object"&&Object.keys(Pt).length===0)&&xt.push(_t)}for(const _t of xt)delete wt[_t]}(d),_}}.write(e,{format:i.format||t0.GLTF,basename:i.basename||"",logger:this.v,vertexLayout:this.F,dependencies:Fm({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:i,resources:s}=await this.writeJSON(e,{format:t0.GLB}),a=new Uint32Array([1179937895,2,12]),h=JSON.stringify(i),d=go.pad(go.encodeText(h),32),_=go.toView(new Uint32Array([d.byteLength,1313821514])),et=go.concat([_,d]);a[a.length-1]+=et.byteLength;const nt=Object.values(s)[0];if(!nt||!nt.byteLength)return go.concat([go.toView(a),et]);const it=go.pad(nt,0),lt=go.toView(new Uint32Array([it.byteLength,5130562])),dt=go.concat([lt,it]);return a[a.length-1]+=dt.byteLength,go.concat([go.toView(a),et,dt])}detectFormat(e){return(dw.isAbsoluteURL(e)?dw.extension(e):qx.extension(e))==="glb"?t0.GLB:t0.GLTF}async P(e){this.lastReadBytes=0;const i=await this.readURI(e,"text");this.lastReadBytes+=i.length;const s={json:JSON.parse(i),resources:{}};return await this.D(s,this.dirname(e)),this.L(s),s}async U(e){const i=await this.readURI(e,"view");this.lastReadBytes=i.byteLength;const s=this._(i);return await this.D(s,this.dirname(e)),this.L(s),s}async D(e,i){var s=this;const a=[...e.json.images||[],...e.json.buffers||[]].map(async function(h){const d=h.uri;if(!d||d.match(/data:/))return Promise.resolve();e.resources[d]=await s.readURI(s.resolve(i,d),"view"),s.lastReadBytes+=e.resources[d].byteLength});await Promise.all(a)}L(e){function i(s){if(s.uri){if(s.uri in e.resources)go.assertView(e.resources[s.uri]);else if(s.uri.match(/data:/)){const a=`__${function(){for(let h=0;h<999;h++){const d=vO();if(!CR.has(d))return CR.add(d),d}return""}()}.${qx.extension(s.uri)}`;e.resources[a]=go.createBufferFromDataURI(s.uri),s.uri=a}}}(e.json.images||[]).forEach(s=>{if(s.bufferView===void 0&&s.uri===void 0)throw new Error("Missing resource URI or buffer view.");i(s)}),(e.json.buffers||[]).forEach(i)}j(e){const{images:i,buffers:s}=e.json;return e={json:Fm({},e.json),resources:Fm({},e.resources)},i&&(e.json.images=i.map(a=>Fm({},a))),s&&(e.json.buffers=s.map(a=>Fm({},a))),e}_(e){const i=new Uint32Array(e.buffer,e.byteOffset,3);if(i[0]!==1179937895)throw new Error("Invalid glTF asset.");if(i[1]!==2)throw new Error(`Unsupported glTF binary version, "${i[1]}".`);const s=new Uint32Array(e.buffer,e.byteOffset+12,2);if(s[1]!==DI.JSON)throw new Error("Missing required GLB JSON chunk.");const a=s[0],h=go.decodeText(go.toView(e,20,a)),d=JSON.parse(h),_=20+a;if(e.byteLength<=_)return{json:d,resources:{}};const et=new Uint32Array(e.buffer,e.byteOffset+_,2);if(et[1]!==DI.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:d,resources:{"@glb.bin":go.toView(e,_+8,et[0])}}}}{constructor(e=dw.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,i){const s=await fetch(e,this.V);switch(i){case"view":return new Uint8Array(await s.arrayBuffer());case"text":return s.text()}}resolve(e,i){return dw.resolve(e,i)}dirname(e){return dw.dirname(e)}detectFormat(e){return dw.extension(e)==="glb"?t0.GLB:t0.GLTF}}class bO{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class iM{constructor(e,i,s,a){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+i,s),this._littleEndian=a,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,i=0){const s=this._offset;let a=0;for(;this._dataView.getUint8(this._offset)!==i&&a<e;)a++,this._offset++;return a<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+s,a)}}const um=[171,75,84,88,32,50,48,187,13,10,26,10];function OR(c){return typeof TextDecoder<"u"?new TextDecoder().decode(c):Buffer.from(c).toString("utf8")}function QD(c){const e=new Uint8Array(c.buffer,c.byteOffset,um.length);if(e[0]!==um[0]||e[1]!==um[1]||e[2]!==um[2]||e[3]!==um[3]||e[4]!==um[4]||e[5]!==um[5]||e[6]!==um[6]||e[7]!==um[7]||e[8]!==um[8]||e[9]!==um[9]||e[10]!==um[10]||e[11]!==um[11])throw new Error("Missing KTX 2.0 identifier.");const i=new bO,s=17*Uint32Array.BYTES_PER_ELEMENT,a=new iM(c,um.length,s,!0);i.vkFormat=a._nextUint32(),i.typeSize=a._nextUint32(),i.pixelWidth=a._nextUint32(),i.pixelHeight=a._nextUint32(),i.pixelDepth=a._nextUint32(),i.layerCount=a._nextUint32(),i.faceCount=a._nextUint32();const h=a._nextUint32();i.supercompressionScheme=a._nextUint32();const d=a._nextUint32(),_=a._nextUint32(),et=a._nextUint32(),nt=a._nextUint32(),it=a._nextUint64(),lt=a._nextUint64(),dt=new iM(c,um.length+s,3*h*8,!0);for(let Mn=0;Mn<h;Mn++)i.levels.push({levelData:new Uint8Array(c.buffer,c.byteOffset+dt._nextUint64(),dt._nextUint64()),uncompressedByteLength:dt._nextUint64()});const pt=new iM(c,d,_,!0),gt={vendorId:pt._skip(4)._nextUint16(),descriptorType:pt._nextUint16(),versionNumber:pt._nextUint16(),descriptorBlockSize:pt._nextUint16(),colorModel:pt._nextUint8(),colorPrimaries:pt._nextUint8(),transferFunction:pt._nextUint8(),flags:pt._nextUint8(),texelBlockDimension:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],bytesPlane:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],samples:[]},vt=(gt.descriptorBlockSize/4-6)/4;for(let Mn=0;Mn<vt;Mn++){const Hn={bitOffset:pt._nextUint16(),bitLength:pt._nextUint8(),channelType:pt._nextUint8(),samplePosition:[pt._nextUint8(),pt._nextUint8(),pt._nextUint8(),pt._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Hn.channelType?(Hn.sampleLower=pt._nextInt32(),Hn.sampleUpper=pt._nextInt32()):(Hn.sampleLower=pt._nextUint32(),Hn.sampleUpper=pt._nextUint32()),gt.samples[Mn]=Hn}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(gt);const Ct=new iM(c,et,nt,!0);for(;Ct._offset<nt;){const Mn=Ct._nextUint32(),Hn=Ct._scan(Mn),rr=OR(Hn),cr=Ct._scan(Mn-Hn.byteLength);i.keyValue[rr]=rr.match(/^ktx/i)?OR(cr):cr,Ct._offset%4&&Ct._skip(4-Ct._offset%4)}if(lt<=0)return i;const wt=new iM(c,it,lt,!0),xt=wt._nextUint16(),_t=wt._nextUint16(),Pt=wt._nextUint32(),Rt=wt._nextUint32(),Lt=wt._nextUint32(),Ot=wt._nextUint32(),qt=[];for(let Mn=0;Mn<h;Mn++)qt.push({imageFlags:wt._nextUint32(),rgbSliceByteOffset:wt._nextUint32(),rgbSliceByteLength:wt._nextUint32(),alphaSliceByteOffset:wt._nextUint32(),alphaSliceByteLength:wt._nextUint32()});const en=it+wt._offset,cn=en+Pt,An=cn+Rt,fn=An+Lt,Tn=new Uint8Array(c.buffer,c.byteOffset+en,Pt),gn=new Uint8Array(c.buffer,c.byteOffset+cn,Rt),xn=new Uint8Array(c.buffer,c.byteOffset+An,Lt),Nn=new Uint8Array(c.buffer,c.byteOffset+fn,Ot);return i.globalData={endpointCount:xt,selectorCount:_t,imageDescs:qt,endpointsData:Tn,selectorsData:gn,tablesData:xn,extendedData:Nn},i}class NR extends pu{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[qr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,i){return this.setRefMap("attributes",e,i,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}NR.EXTENSION_NAME="EXT_mesh_gpu_instancing";const Jx="EXT_mesh_gpu_instancing";function pw(){return(pw=Object.assign||function(c){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(c[s]=i[s])}return c}).apply(this,arguments)}var rM,JE,fu;(class extends Vl{constructor(...c){super(...c),this.extensionName=Jx,this.provideTypes=[qr.NODE],this.prewriteTypes=[qr.ACCESSOR]}createInstancedMesh(){return new NR(this.document.getGraph())}read(c){return(c.jsonDoc.json.nodes||[]).forEach((e,i)=>{if(!e.extensions||!e.extensions[Jx])return;const s=e.extensions[Jx],a=this.createInstancedMesh();for(const h in s.attributes)a.setAttribute(h,c.accessors[s.attributes[h]]);c.nodes[i].setExtension(Jx,a)}),this}prewrite(c){c.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const i of e.listAttributes())c.addAccessorToUsageGroup(i,"INSTANCE_ATTRIBUTE");return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listNodes().forEach(i=>{const s=i.getExtension(Jx);if(s){const a=c.nodeIndexMap.get(i),h=e.json.nodes[a],d={attributes:{}};s.listSemantics().forEach(_=>{const et=s.getAttribute(_);d.attributes[_]=c.accessorIndexMap.get(et)}),h.extensions=h.extensions||{},h.extensions[Jx]=d}}),this}}).EXTENSION_NAME=Jx,function(c){c.QUANTIZE="quantize",c.FILTER="filter"}(rM||(rM={})),function(c){c.ATTRIBUTES="ATTRIBUTES",c.TRIANGLES="TRIANGLES",c.INDICES="INDICES"}(JE||(JE={})),function(c){c.NONE="NONE",c.OCTAHEDRAL="OCTAHEDRAL",c.QUATERNION="QUATERNION",c.EXPONENTIAL="EXPONENTIAL"}(fu||(fu={}));const{BYTE:EO,SHORT:UR,FLOAT:SO}=us.ComponentType,{normalize:FR,denormalize:GD}=Zl;function CO(c,e,i,s){const{filter:a,bits:h}=s,d={array:c.getArray(),byteStride:c.getElementSize()*c.getComponentSize(),componentType:c.getComponentType(),normalized:c.getNormalized()};if(i!==JE.ATTRIBUTES)return d;if(a!==fu.NONE){let _=c.getNormalized()?function(et){const nt=et.getComponentType(),it=et.getArray(),lt=new Float32Array(it.length);for(let dt=0;dt<it.length;dt++)lt[dt]=GD(it[dt],nt);return lt}(c):new Float32Array(d.array);switch(a){case fu.EXPONENTIAL:d.byteStride=4*c.getElementSize(),d.componentType=SO,d.normalized=!1,d.array=e.encodeFilterExp(_,c.getCount(),d.byteStride,h);break;case fu.OCTAHEDRAL:d.byteStride=h>8?8:4,d.componentType=h>8?UR:EO,d.normalized=!0,_=c.getElementSize()===3?function(et){const nt=new Float32Array(4*et.length/3);for(let it=0,lt=et.length/3;it<lt;it++)nt[4*it]=et[3*it],nt[4*it+1]=et[3*it+1],nt[4*it+2]=et[3*it+2];return nt}(_):_,d.array=e.encodeFilterOct(_,c.getCount(),d.byteStride,h);break;case fu.QUATERNION:d.byteStride=8,d.componentType=UR,d.normalized=!0,d.array=e.encodeFilterQuat(_,c.getCount(),d.byteStride,h);break;default:throw new Error("Invalid filter.")}d.min=c.getMin([]),d.max=c.getMax([]),c.getNormalized()&&(d.min=d.min.map(et=>GD(et,c.getComponentType())),d.max=d.max.map(et=>GD(et,c.getComponentType()))),d.normalized&&(d.min=d.min.map(et=>FR(et,d.componentType)),d.max=d.max.map(et=>FR(et,d.componentType)))}else d.byteStride%4&&(d.array=function(_,et){const nt=go.padNumber(_.BYTES_PER_ELEMENT*et)/_.BYTES_PER_ELEMENT,it=new _.constructor(_.length/et*nt);for(let lt=0;lt*et<_.length;lt++)for(let dt=0;dt<et;dt++)it[lt*nt+dt]=_[lt*et+dt];return it}(d.array,c.getElementSize()),d.byteStride=d.array.byteLength/c.getCount());return d}function MO(c,e){return e===n0.BufferViewUsage.ELEMENT_ARRAY_BUFFER?c.listParents().some(i=>i instanceof Kx&&i.getMode()===Kx.Mode.TRIANGLES)?JE.TRIANGLES:JE.INDICES:JE.ATTRIBUTES}function TO(c,e){const i=e.getGraph().listParentEdges(c).filter(s=>!(s.getParent()instanceof BR));for(const s of i){const a=s.getName(),h=s.getAttributes().key||"";if(a==="indices")return{filter:fu.NONE};if(a==="attributes"){if(h==="POSITION")return{filter:fu.NONE};if(h==="TEXCOORD_0")return{filter:fu.NONE};if(h==="NORMAL")return{filter:fu.OCTAHEDRAL,bits:8};if(h==="TANGENT")return{filter:fu.OCTAHEDRAL,bits:8};if(h.startsWith("JOINTS_"))return{filter:fu.NONE};if(h.startsWith("WEIGHTS_"))return{filter:fu.NONE}}if(a==="output"){const d=jR(c);return d==="rotation"?{filter:fu.QUATERNION,bits:16}:d==="translation"||d==="scale"?{filter:fu.EXPONENTIAL,bits:12}:{filter:fu.NONE}}if(a==="input")return{filter:fu.NONE};if(a==="inverseBindMatrices")return{filter:fu.NONE}}return{filter:fu.NONE}}function jR(c){for(const e of c.listParents())if(e instanceof KE){for(const i of e.listParents())if(i instanceof FD)return i.getTargetPath()}return null}const hm="EXT_meshopt_compression",zR={method:rM.QUANTIZE};class VR extends Vl{constructor(...e){super(...e),this.extensionName=hm,this.prereadTypes=[qr.BUFFER,qr.PRIMITIVE],this.prewriteTypes=[qr.BUFFER,qr.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=zR,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,i){return e==="meshopt.decoder"&&(this._decoder=i),e==="meshopt.encoder"&&(this._encoder=i),this}setEncoderOptions(e){return this._encoderOptions=pw({},zR,e),this}preread(e,i){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${hm}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${hm}]: Missing WASM support.`)}return i===qr.BUFFER?this._prereadBuffers(e):i===qr.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[hm])return;const h=s.extensions[hm],d=h.byteOffset||0,_=h.byteLength||0,et=h.count,nt=h.byteStride,it=new Uint8Array(et*nt),lt=i.json.buffers[s.buffer],dt=go.toView(lt.uri?i.resources[lt.uri]:i.resources["@glb.bin"],d,_);this._decoder.decodeGltfBuffer(it,et,nt,dt,h.mode,h.filter),e.bufferViews[a]=it})}_prereadPrimitives(e){const i=e.jsonDoc;(i.json.bufferViews||[]).forEach(s=>{var a;s.extensions&&s.extensions[hm]&&(a=i.json.buffers[s.buffer]).extensions&&a.extensions.EXT_meshopt_compression&&a.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[s.buffer],e.buffers[s.extensions[hm].buffer])})}read(e){if(!this.isRequired())return this;for(const[i,s]of this._decoderFallbackBufferMap){for(const a of i.listParents())a instanceof us&&a.swap(i,s);i.dispose()}return this}prewrite(e,i){return i===qr.ACCESSOR?this._prewriteAccessors(e):i===qr.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const i=e.jsonDoc.json,s=this._encoder,a=this._encoderOptions,h=this.document.createBuffer(),d=this.document.getRoot().listBuffers().indexOf(h);this._encoderFallbackBuffer=h,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const _ of this.document.getRoot().listAccessors()){if(jR(_)==="weights")continue;const et=e.getAccessorUsage(_),nt=MO(_,et),it=a.method===rM.FILTER?TO(_,this.document):{filter:fu.NONE},lt=CO(_,s,nt,it),{array:dt,byteStride:pt}=lt,gt=_.getBuffer();if(!gt)throw new Error(`${hm}: Missing buffer for accessor.`);const vt=this.document.getRoot().listBuffers().indexOf(gt),Ct=[et,nt,it.filter,pt,vt].join(":");let wt=this._encoderBufferViews[Ct],xt=this._encoderBufferViewData[Ct],_t=this._encoderBufferViewAccessors[Ct];wt&&xt||(_t=this._encoderBufferViewAccessors[Ct]=[],xt=this._encoderBufferViewData[Ct]=[],wt=this._encoderBufferViews[Ct]={buffer:d,target:n0.USAGE_TO_TARGET[et],byteOffset:0,byteLength:0,byteStride:et===n0.BufferViewUsage.ARRAY_BUFFER?pt:void 0,extensions:{[hm]:{buffer:vt,byteOffset:0,byteLength:0,mode:nt,filter:it.filter!==fu.NONE?it.filter:void 0,byteStride:pt,count:0}}});const Pt=e.createAccessorDef(_);Pt.componentType=lt.componentType,Pt.normalized=lt.normalized,Pt.byteOffset=wt.byteLength,Pt.min&&lt.min&&(Pt.min=lt.min),Pt.max&&lt.max&&(Pt.max=lt.max),e.accessorIndexMap.set(_,i.accessors.length),i.accessors.push(Pt),_t.push(Pt),xt.push(new Uint8Array(dt.buffer,dt.byteOffset,dt.byteLength)),wt.byteLength+=dt.byteLength,wt.extensions.EXT_meshopt_compression.count+=_.getCount()}}_prewriteBuffers(e){const i=this._encoder;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],h=this._encoderBufferViewData[s],d=this.document.getRoot().listBuffers()[a.extensions[hm].buffer],_=e.otherBufferViews.get(d)||[],{count:et,byteStride:nt,mode:it}=a.extensions[hm],lt=go.concat(h),dt=i.encodeGltfBuffer(lt,et,nt,it),pt=go.pad(dt);a.extensions[hm].byteLength=dt.byteLength,h.length=0,h.push(pt),_.push(pt),e.otherBufferViews.set(d,_)}}write(e){let i=0;for(const d in this._encoderBufferViews){const _=this._encoderBufferViews[d],et=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[d][0]),nt=this._encoderBufferViewAccessors[d];for(const dt of nt)dt.bufferView=et;const it=e.jsonDoc.json.bufferViews[et],lt=it.byteOffset||0;Object.assign(it,_),it.byteOffset=i,it.extensions[hm].byteOffset=lt,i+=go.padNumber(_.byteLength)}const s=this._encoderFallbackBuffer,a=e.bufferIndexMap.get(s),h=e.jsonDoc.json.buffers[a];return h.byteLength=i,h.extensions={[hm]:{fallback:!0}},s.dispose(),this}}VR.EXTENSION_NAME=hm,VR.EncoderMethod=rM;const QR="EXT_texture_webp";class IO{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const i=go.decodeText(e.slice(0,4)),s=go.decodeText(e.slice(8,12));if(i!=="RIFF"||s!=="WEBP")return null;const a=new DataView(e.buffer,e.byteOffset);let h=12;for(;h<a.byteLength;){const d=go.decodeText(new Uint8Array([a.getUint8(h),a.getUint8(h+1),a.getUint8(h+2),a.getUint8(h+3)])),_=a.getUint32(h+4,!0);if(d==="VP8 ")return[16383&a.getInt16(h+14,!0),16383&a.getInt16(h+16,!0)];if(d==="VP8L"){const et=a.getUint8(h+9),nt=a.getUint8(h+10),it=a.getUint8(h+11);return[1+((63&nt)<<8|et),1+((15&a.getUint8(h+12))<<10|it<<2|(192&nt)>>6)]}h+=8+_+_%2}return null}getChannels(e){return 4}}(class extends Vl{constructor(...c){super(...c),this.extensionName=QR,this.prereadTypes=[qr.TEXTURE]}static register(){KA.registerFormat("image/webp",new IO)}preread(c){return(c.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(c){return this}write(c){const e=c.jsonDoc;return this.document.getRoot().listTextures().forEach(i=>{if(i.getMimeType()==="image/webp"){const s=c.imageIndexMap.get(i);(e.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions.EXT_texture_webp={source:a.source},delete a.source)})}}),this}}).EXTENSION_NAME=QR;const GR="KHR_draco_mesh_compression";let zu,HR,WR,jm;function DO(c,e){const i=new zu.DecoderBuffer;try{if(i.Init(e,e.length),c.GetEncodedGeometryType(i)!==zu.TRIANGULAR_MESH)throw new Error(`[${GR}] Unknown geometry type.`);const s=new zu.Mesh;if(!c.DecodeBufferToMesh(i,s).ok()||s.ptr===0)throw new Error(`[${GR}] Decoding failure.`);return s}finally{zu.destroy(i)}}function PO(c,e){const i=3*e.num_faces();let s,a;if(e.num_points()<=65534){const h=i*Uint16Array.BYTES_PER_ELEMENT;s=zu._malloc(h),c.GetTrianglesUInt16Array(e,h,s),a=new Uint16Array(zu.HEAPU16.buffer,s,i).slice()}else{const h=i*Uint32Array.BYTES_PER_ELEMENT;s=zu._malloc(h),c.GetTrianglesUInt32Array(e,h,s),a=new Uint32Array(zu.HEAPU32.buffer,s,i).slice()}return zu._free(s),a}function RO(c,e,i,s){const a=WR[s.componentType],h=HR[s.componentType],d=i.num_components(),_=e.num_points()*d,et=_*h.BYTES_PER_ELEMENT,nt=zu._malloc(et);c.GetAttributeDataArrayForAllPoints(e,i,a,et,nt);const it=new h(zu.HEAPF32.buffer,nt,_).slice();return zu._free(nt),it}var sM,i0;(function(c){c[c.EDGEBREAKER=1]="EDGEBREAKER",c[c.SEQUENTIAL=0]="SEQUENTIAL"})(sM||(sM={})),function(c){c.POSITION="POSITION",c.NORMAL="NORMAL",c.COLOR="COLOR",c.TEX_COORD="TEX_COORD",c.GENERIC="GENERIC"}(i0||(i0={}));const qR={[i0.POSITION]:14,[i0.NORMAL]:10,[i0.COLOR]:8,[i0.TEX_COORD]:12,[i0.GENERIC]:12},YR={decodeSpeed:5,encodeSpeed:5,method:sM.EDGEBREAKER,quantizationBits:qR,quantizationVolume:"mesh"};function BO(c,e=YR){const i=pw({},YR,e);i.quantizationBits=pw({},qR,e.quantizationBits);const s=new jm.Encoder,a=new jm.MeshBuilder,h=new jm.Mesh,d={},_=new jm.DracoInt8Array;for(const gt of c.listSemantics()){const vt=c.getAttribute(gt),Ct=kO(gt),wt=LO(a,vt.getComponentType(),h,jm[Ct],vt.getCount(),vt.getElementSize(),vt.getArray());if(wt===-1)throw new Error(`Error compressing "${gt}" attribute.`);if(d[gt]=wt,i.quantizationVolume==="mesh"||gt!=="POSITION")s.SetAttributeQuantization(jm[Ct],i.quantizationBits[Ct]);else{if(typeof i.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:xt}=i,_t=Math.max(xt.max[0]-xt.min[0],xt.max[1]-xt.min[1],xt.max[2]-xt.min[2]);s.SetAttributeExplicitQuantization(jm[Ct],i.quantizationBits[Ct],vt.getElementSize(),xt.min,_t)}}}const et=c.getIndices();if(!et)throw new Error("Primitive must have indices.");a.AddFacesToMesh(h,et.getCount()/3,et.getArray()),s.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),s.SetTrackEncodedProperties(!0),i.method===sM.SEQUENTIAL||c.listTargets().length>0?s.SetEncodingMethod(jm.MESH_SEQUENTIAL_ENCODING):s.SetEncodingMethod(jm.MESH_EDGEBREAKER_ENCODING);const nt=s.EncodeMeshToDracoBuffer(h,_);if(nt<=0)throw new Error("Error applying Draco compression.");const it=new Uint8Array(nt);for(let gt=0;gt<nt;++gt)it[gt]=_.GetValue(gt);const lt=c.getAttribute("POSITION").getCount(),dt=s.GetNumberOfEncodedPoints(),pt=3*s.GetNumberOfEncodedFaces();if(c.listTargets().length>0&&dt!==lt)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return jm.destroy(_),jm.destroy(h),jm.destroy(a),jm.destroy(s),{numVertices:dt,numIndices:pt,data:it,attributeIDs:d}}function kO(c){return c==="POSITION"?i0.POSITION:c==="NORMAL"?i0.NORMAL:c.startsWith("COLOR_")?i0.COLOR:c.startsWith("TEXCOORD_")?i0.TEX_COORD:i0.GENERIC}function LO(c,e,i,s,a,h,d){switch(e){case us.ComponentType.UNSIGNED_BYTE:return c.AddUInt8Attribute(i,s,a,h,d);case us.ComponentType.BYTE:return c.AddInt8Attribute(i,s,a,h,d);case us.ComponentType.UNSIGNED_SHORT:return c.AddUInt16Attribute(i,s,a,h,d);case us.ComponentType.SHORT:return c.AddInt16Attribute(i,s,a,h,d);case us.ComponentType.UNSIGNED_INT:return c.AddUInt32Attribute(i,s,a,h,d);case us.ComponentType.FLOAT:return c.AddFloatAttribute(i,s,a,h,d);default:throw new Error(`Unexpected component type, "${e}".`)}}const Du="KHR_draco_mesh_compression";class oM extends Vl{constructor(...e){super(...e),this.extensionName=Du,this.prereadTypes=[qr.PRIMITIVE],this.prewriteTypes=[qr.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,i){return e==="draco3d.decoder"&&(this._decoderModule=i,zu=this._decoderModule,HR={[us.ComponentType.FLOAT]:Float32Array,[us.ComponentType.UNSIGNED_INT]:Uint32Array,[us.ComponentType.UNSIGNED_SHORT]:Uint16Array,[us.ComponentType.UNSIGNED_BYTE]:Uint8Array,[us.ComponentType.SHORT]:Int16Array,[us.ComponentType.BYTE]:Int8Array},WR={[us.ComponentType.FLOAT]:zu.DT_FLOAT32,[us.ComponentType.UNSIGNED_INT]:zu.DT_UINT32,[us.ComponentType.UNSIGNED_SHORT]:zu.DT_UINT16,[us.ComponentType.UNSIGNED_BYTE]:zu.DT_UINT8,[us.ComponentType.SHORT]:zu.DT_INT16,[us.ComponentType.BYTE]:zu.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=i,jm=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Du}] Please install extension dependency, "draco3d.decoder".`);const i=this.document.getLogger(),s=e.jsonDoc,a=new Map;try{const h=s.json.meshes||[];for(const d of h)for(const _ of d.primitives){if(!_.extensions||!_.extensions[Du])continue;const et=_.extensions[Du];let[nt,it]=a.get(et.bufferView)||[];if(!it||!nt){const lt=s.json.bufferViews[et.bufferView],dt=s.json.buffers[lt.buffer],pt=go.toView(dt.uri?s.resources[dt.uri]:s.resources["@glb.bin"],lt.byteOffset||0,lt.byteLength);nt=new this._decoderModule.Decoder,it=DO(nt,pt),a.set(et.bufferView,[nt,it]),i.debug(`[${Du}] Decompressed ${pt.byteLength} bytes.`)}for(const lt in _.attributes){const dt=e.jsonDoc.json.accessors[_.attributes[lt]],pt=nt.GetAttributeByUniqueId(it,et.attributes[lt]),gt=RO(nt,it,pt,dt);e.accessors[_.attributes[lt]].setArray(gt)}_.indices!==void 0&&e.accessors[_.indices].setArray(PO(nt,it))}}finally{for(const[h,d]of Array.from(a.values()))this._decoderModule.destroy(h),this._decoderModule.destroy(d)}return this}read(e){return this}prewrite(e,i){if(!this._encoderModule)throw new Error(`[${Du}] Please install extension dependency, "draco3d.encoder".`);const s=this.document.getLogger();s.debug(`[${Du}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const a=function(_){const et=_.getLogger(),nt=new Set,it=new Set;for(const Ct of _.getRoot().listMeshes())for(const wt of Ct.listPrimitives())wt.getIndices()?wt.getMode()!==Kx.Mode.TRIANGLES?(it.add(wt),et.warn(`[${Du}] Skipping Draco compression on non-TRIANGLES primitive.`)):nt.add(wt):(it.add(wt),et.warn(`[${Du}] Skipping Draco compression on non-indexed primitive.`));const lt=_.getRoot().listAccessors(),dt=new Map;for(let Ct=0;Ct<lt.length;Ct++)dt.set(lt[Ct],Ct);const pt=new Map,gt=new Set,vt=new Map;for(const Ct of Array.from(nt)){let wt=XR(Ct,dt);if(gt.has(wt))vt.set(Ct,wt);else{if(pt.has(Ct.getIndices())){const xt=Ct.getIndices(),_t=xt.clone();dt.set(_t,_.getRoot().listAccessors().length-1),Ct.swap(xt,_t)}for(const xt of Ct.listAttributes())if(pt.has(xt)){const _t=xt.clone();dt.set(_t,_.getRoot().listAccessors().length-1),Ct.swap(xt,_t)}wt=XR(Ct,dt),gt.add(wt),vt.set(Ct,wt),pt.set(Ct.getIndices(),wt);for(const xt of Ct.listAttributes())pt.set(xt,wt)}}for(const Ct of Array.from(pt.keys())){const wt=new Set(Ct.listParents().map(xt=>xt.propertyType));if(wt.size!==2||!wt.has(qr.PRIMITIVE)||!wt.has(qr.ROOT))throw new Error(`[${Du}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const Ct of Array.from(nt)){const wt=vt.get(Ct),xt=Ct.getIndices();if(pt.get(xt)!==wt||Ct.listAttributes().some(_t=>pt.get(_t)!==wt))throw new Error(`[${Du}] Draco primitives must share all, or no, accessors.`)}for(const Ct of Array.from(it)){const wt=Ct.getIndices();if(pt.has(wt)||Ct.listAttributes().some(xt=>pt.has(xt)))throw new Error(`[${Du}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return vt}(this.document),h=new Map;let d="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?s.warn(`[${Du}]: quantizationVolume=scene requires exactly 1 scene.`):d=function(_){const et={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},nt=_.propertyType===qr.NODE?[_]:_.listChildren();for(const it of nt)it.traverse(lt=>{const dt=lt.getMesh();if(!dt)return;const pt=dO(dt,lt.getWorldMatrix());ND(pt.min,et),ND(pt.max,et)});return et}(this.document.getRoot().listScenes().pop()));for(const _ of Array.from(a.keys())){const et=a.get(_);if(!et)throw new Error("Unexpected primitive.");if(h.has(et)){h.set(et,h.get(et));continue}const nt=_.getIndices(),it=e.jsonDoc.json.accessors,lt=BO(_,pw({},this._encoderOptions,{quantizationVolume:d}));h.set(et,lt);const dt=e.createAccessorDef(nt);dt.count=lt.numIndices,e.accessorIndexMap.set(nt,it.length),it.push(dt);for(const gt of _.listSemantics()){const vt=_.getAttribute(gt),Ct=e.createAccessorDef(vt);Ct.count=lt.numVertices,e.accessorIndexMap.set(vt,it.length),it.push(Ct)}const pt=_.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(pt)||e.otherBufferViews.set(pt,[]),e.otherBufferViews.get(pt).push(lt.data)}return s.debug(`[${Du}] Compressed ${a.size} primitives.`),e.extensionData[Du]={primitiveHashMap:a,primitiveEncodingMap:h},this}write(e){const i=e.extensionData[Du];for(const s of this.document.getRoot().listMeshes()){const a=e.jsonDoc.json.meshes[e.meshIndexMap.get(s)];for(let h=0;h<s.listPrimitives().length;h++){const d=s.listPrimitives()[h],_=a.primitives[h],et=i.primitiveHashMap.get(d);if(!et)continue;const nt=i.primitiveEncodingMap.get(et);_.extensions=_.extensions||{},_.extensions[Du]={bufferView:e.otherBufferViewsIndexMap.get(nt.data),attributes:nt.attributeIDs}}}if(!i.primitiveHashMap.size){const s=e.jsonDoc.json;s.extensionsUsed=(s.extensionsUsed||[]).filter(a=>a!==Du),s.extensionsRequired=(s.extensionsRequired||[]).filter(a=>a!==Du)}return this}}function XR(c,e){const i=[],s=c.getIndices();i.push(e.get(s));for(const a of c.listAttributes())i.push(e.get(a));return i.sort().join("|")}oM.EXTENSION_NAME=Du,oM.EncoderMethod=sM;class ZE extends pu{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[qr.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:ZE.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Um.factorToHex(this.getColor())}setColorHex(e){const i=this.getColor().slice();return Um.hexToFactor(e,i),this.setColor(i)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}ZE.EXTENSION_NAME="KHR_lights_punctual",ZE.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const PI="KHR_lights_punctual";class KR extends Vl{constructor(...e){super(...e),this.extensionName=PI}createLight(e=""){return new ZE(this.document.getGraph(),e)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions.KHR_lights_punctual)return this;const s=(i.json.extensions.KHR_lights_punctual.lights||[]).map(a=>{var h,d;const _=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&_.setColor(a.color),a.intensity!==void 0&&_.setIntensity(a.intensity),a.range!==void 0&&_.setRange(a.range),((h=a.spot)==null?void 0:h.innerConeAngle)!==void 0&&_.setInnerConeAngle(a.spot.innerConeAngle),((d=a.spot)==null?void 0:d.outerConeAngle)!==void 0&&_.setOuterConeAngle(a.spot.outerConeAngle),_});return i.json.nodes.forEach((a,h)=>{a.extensions&&a.extensions.KHR_lights_punctual&&e.nodes[h].setExtension(PI,s[a.extensions.KHR_lights_punctual.light])}),this}write(e){const i=e.jsonDoc;if(this.properties.size===0)return this;const s=[],a=new Map;for(const h of this.properties){const d=h,_={type:d.getType()};Zl.eq(d.getColor(),[1,1,1])||(_.color=d.getColor()),d.getIntensity()!==1&&(_.intensity=d.getIntensity()),d.getRange()!=null&&(_.range=d.getRange()),d.getName()&&(_.name=d.getName()),d.getType()===ZE.Type.SPOT&&(_.spot={innerConeAngle:d.getInnerConeAngle(),outerConeAngle:d.getOuterConeAngle()}),s.push(_),a.set(d,s.length-1)}return this.document.getRoot().listNodes().forEach(h=>{const d=h.getExtension(PI);if(d){const _=e.nodeIndexMap.get(h),et=i.json.nodes[_];et.extensions=et.extensions||{},et.extensions.KHR_lights_punctual={light:a.get(d)}}}),i.json.extensions=i.json.extensions||{},i.json.extensions.KHR_lights_punctual={lights:s},this}}KR.EXTENSION_NAME=PI;const{R:JR,G:ZR,B:OO}=du;class $R extends pu{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Ll(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Ll(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Ll(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:JR})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ZR})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:JR|ZR|OO})}}$R.EXTENSION_NAME="KHR_materials_clearcoat";const Zx="KHR_materials_clearcoat";class eB extends Vl{constructor(...e){super(...e),this.extensionName=Zx}createClearcoat(){return new $R(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[Zx]){const d=this.createClearcoat();e.materials[h].setExtension(Zx,d);const _=a.extensions[Zx];if(_.clearcoatFactor!==void 0&&d.setClearcoatFactor(_.clearcoatFactor),_.clearcoatRoughnessFactor!==void 0&&d.setClearcoatRoughnessFactor(_.clearcoatRoughnessFactor),_.clearcoatTexture!==void 0){const et=_.clearcoatTexture;d.setClearcoatTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatTextureInfo(),et)}if(_.clearcoatRoughnessTexture!==void 0){const et=_.clearcoatRoughnessTexture;d.setClearcoatRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatRoughnessTextureInfo(),et)}if(_.clearcoatNormalTexture!==void 0){const et=_.clearcoatNormalTexture;d.setClearcoatNormalTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getClearcoatNormalTextureInfo(),et),et.scale!==void 0&&d.setClearcoatNormalScale(et.scale)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(Zx);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[Zx]={clearcoatFactor:a.getClearcoatFactor(),clearcoatRoughnessFactor:a.getClearcoatRoughnessFactor()};if(a.getClearcoatTexture()){const et=a.getClearcoatTexture(),nt=a.getClearcoatTextureInfo();_.clearcoatTexture=e.createTextureInfoDef(et,nt)}if(a.getClearcoatRoughnessTexture()){const et=a.getClearcoatRoughnessTexture(),nt=a.getClearcoatRoughnessTextureInfo();_.clearcoatRoughnessTexture=e.createTextureInfoDef(et,nt)}if(a.getClearcoatNormalTexture()){const et=a.getClearcoatNormalTexture(),nt=a.getClearcoatNormalTextureInfo();_.clearcoatNormalTexture=e.createTextureInfoDef(et,nt),a.getClearcoatNormalScale()!==1&&(_.clearcoatNormalTexture.scale=a.getClearcoatNormalScale())}}}),this}}eB.EXTENSION_NAME=Zx;class tB extends pu{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}tB.EXTENSION_NAME="KHR_materials_emissive_strength";const $x="KHR_materials_emissive_strength";class nB extends Vl{constructor(...e){super(...e),this.extensionName=$x}createEmissiveStrength(){return new tB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions[$x]){const a=this.createEmissiveStrength();e.materials[s].setExtension($x,a);const h=i.extensions[$x];h.emissiveStrength!==void 0&&a.setEmissiveStrength(h.emissiveStrength)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension($x);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions[$x]={emissiveStrength:a.getEmissiveStrength()}}}),this}}nB.EXTENSION_NAME=$x;class iB extends pu{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}iB.EXTENSION_NAME="KHR_materials_ior";const RI="KHR_materials_ior";class rB extends Vl{constructor(...e){super(...e),this.extensionName=RI}createIOR(){return new iB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{if(i.extensions&&i.extensions.KHR_materials_ior){const a=this.createIOR();e.materials[s].setExtension(RI,a);const h=i.extensions.KHR_materials_ior;h.ior!==void 0&&a.setIOR(h.ior)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(RI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{},d.extensions.KHR_materials_ior={ior:a.getIOR()}}}),this}}rB.EXTENSION_NAME=RI;const{R:NO,G:UO}=du;class sB extends pu{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Ll(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Ll(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:NO})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:UO})}}sB.EXTENSION_NAME="KHR_materials_iridescence";const _b="KHR_materials_iridescence";class oB extends Vl{constructor(...e){super(...e),this.extensionName=_b}createIridescence(){return new sB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[_b]){const d=this.createIridescence();e.materials[h].setExtension(_b,d);const _=a.extensions[_b];if(_.iridescenceFactor!==void 0&&d.setIridescenceFactor(_.iridescenceFactor),_.iridescenceIor!==void 0&&d.setIridescenceIOR(_.iridescenceIor),_.iridescenceThicknessMinimum!==void 0&&d.setIridescenceThicknessMinimum(_.iridescenceThicknessMinimum),_.iridescenceThicknessMaximum!==void 0&&d.setIridescenceThicknessMaximum(_.iridescenceThicknessMaximum),_.iridescenceTexture!==void 0){const et=_.iridescenceTexture;d.setIridescenceTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getIridescenceTextureInfo(),et)}if(_.iridescenceThicknessTexture!==void 0){const et=_.iridescenceThicknessTexture;d.setIridescenceThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getIridescenceThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(_b);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[_b]={};if(a.getIridescenceFactor()>0&&(_.iridescenceFactor=a.getIridescenceFactor()),a.getIridescenceIOR()!==1.3&&(_.iridescenceIor=a.getIridescenceIOR()),a.getIridescenceThicknessMinimum()!==100&&(_.iridescenceThicknessMinimum=a.getIridescenceThicknessMinimum()),a.getIridescenceThicknessMaximum()!==400&&(_.iridescenceThicknessMaximum=a.getIridescenceThicknessMaximum()),a.getIridescenceTexture()){const et=a.getIridescenceTexture(),nt=a.getIridescenceTextureInfo();_.iridescenceTexture=e.createTextureInfoDef(et,nt)}if(a.getIridescenceThicknessTexture()){const et=a.getIridescenceThicknessTexture(),nt=a.getIridescenceThicknessTextureInfo();_.iridescenceThicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}oB.EXTENSION_NAME=_b;const{R:aB,G:lB,B:cB,A:uB}=du;class hB extends pu{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Ll(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Ll(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Um.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const i=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Um.hexToFactor(e,i))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:aB|lB|cB|uB})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:aB|lB|cB|uB})}}hB.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const e1="KHR_materials_pbrSpecularGlossiness";class dB extends Vl{constructor(...e){super(...e),this.extensionName=e1}createPBRSpecularGlossiness(){return new hB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[e1]){const d=this.createPBRSpecularGlossiness();e.materials[h].setExtension(e1,d);const _=a.extensions[e1];if(_.diffuseFactor!==void 0&&d.setDiffuseFactor(_.diffuseFactor),_.specularFactor!==void 0&&d.setSpecularFactor(_.specularFactor),_.glossinessFactor!==void 0&&d.setGlossinessFactor(_.glossinessFactor),_.diffuseTexture!==void 0){const et=_.diffuseTexture;d.setDiffuseTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getDiffuseTextureInfo(),et)}if(_.specularGlossinessTexture!==void 0){const et=_.specularGlossinessTexture;d.setSpecularGlossinessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularGlossinessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(e1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[e1]={diffuseFactor:a.getDiffuseFactor(),specularFactor:a.getSpecularFactor(),glossinessFactor:a.getGlossinessFactor()};if(a.getDiffuseTexture()){const et=a.getDiffuseTexture(),nt=a.getDiffuseTextureInfo();_.diffuseTexture=e.createTextureInfoDef(et,nt)}if(a.getSpecularGlossinessTexture()){const et=a.getSpecularGlossinessTexture(),nt=a.getSpecularGlossinessTextureInfo();_.specularGlossinessTexture=e.createTextureInfoDef(et,nt)}}}),this}}dB.EXTENSION_NAME=e1;const{R:FO,G:jO,B:zO,A:VO}=du;class pB extends pu{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Ll(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Ll(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Um.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const i=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Um.hexToFactor(e,i))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:FO|jO|zO})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:VO})}}pB.EXTENSION_NAME="KHR_materials_sheen";const BI="KHR_materials_sheen";class fB extends Vl{constructor(...e){super(...e),this.extensionName=BI}createSheen(){return new pB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_sheen){const d=this.createSheen();e.materials[h].setExtension(BI,d);const _=a.extensions.KHR_materials_sheen;if(_.sheenColorFactor!==void 0&&d.setSheenColorFactor(_.sheenColorFactor),_.sheenRoughnessFactor!==void 0&&d.setSheenRoughnessFactor(_.sheenRoughnessFactor),_.sheenColorTexture!==void 0){const et=_.sheenColorTexture;d.setSheenColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSheenColorTextureInfo(),et)}if(_.sheenRoughnessTexture!==void 0){const et=_.sheenRoughnessTexture;d.setSheenRoughnessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSheenRoughnessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(BI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions.KHR_materials_sheen={sheenColorFactor:a.getSheenColorFactor(),sheenRoughnessFactor:a.getSheenRoughnessFactor()};if(a.getSheenColorTexture()){const et=a.getSheenColorTexture(),nt=a.getSheenColorTextureInfo();_.sheenColorTexture=e.createTextureInfoDef(et,nt)}if(a.getSheenRoughnessTexture()){const et=a.getSheenRoughnessTexture(),nt=a.getSheenRoughnessTextureInfo();_.sheenRoughnessTexture=e.createTextureInfoDef(et,nt)}}}),this}}fB.EXTENSION_NAME=BI;const{R:QO,G:GO,B:HO,A:WO}=du;class mB extends pu{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Ll(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Ll(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Um.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const i=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Um.hexToFactor(e,i))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:WO})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:QO|GO|HO})}}mB.EXTENSION_NAME="KHR_materials_specular";const t1="KHR_materials_specular";class gB extends Vl{constructor(...e){super(...e),this.extensionName=t1}createSpecular(){return new mB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[t1]){const d=this.createSpecular();e.materials[h].setExtension(t1,d);const _=a.extensions[t1];if(_.specularFactor!==void 0&&d.setSpecularFactor(_.specularFactor),_.specularColorFactor!==void 0&&d.setSpecularColorFactor(_.specularColorFactor),_.specularTexture!==void 0){const et=_.specularTexture;d.setSpecularTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularTextureInfo(),et)}if(_.specularColorTexture!==void 0){const et=_.specularColorTexture;d.setSpecularColorTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getSpecularColorTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(t1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[t1]={};if(a.getSpecularFactor()!==1&&(_.specularFactor=a.getSpecularFactor()),Zl.eq(a.getSpecularColorFactor(),[1,1,1])||(_.specularColorFactor=a.getSpecularColorFactor()),a.getSpecularTexture()){const et=a.getSpecularTexture(),nt=a.getSpecularTextureInfo();_.specularTexture=e.createTextureInfoDef(et,nt)}if(a.getSpecularColorTexture()){const et=a.getSpecularColorTexture(),nt=a.getSpecularColorTextureInfo();_.specularColorTexture=e.createTextureInfoDef(et,nt)}}}),this}}gB.EXTENSION_NAME=t1;const{R:qO}=du;class vB extends pu{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Ll(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:qO})}}vB.EXTENSION_NAME="KHR_materials_transmission";const n1="KHR_materials_transmission";class _B extends Vl{constructor(...e){super(...e),this.extensionName=n1}createTransmission(){return new vB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions[n1]){const d=this.createTransmission();e.materials[h].setExtension(n1,d);const _=a.extensions[n1];if(_.transmissionFactor!==void 0&&d.setTransmissionFactor(_.transmissionFactor),_.transmissionTexture!==void 0){const et=_.transmissionTexture;d.setTransmissionTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getTransmissionTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(n1);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions[n1]={transmissionFactor:a.getTransmissionFactor()};if(a.getTransmissionTexture()){const et=a.getTransmissionTexture(),nt=a.getTransmissionTextureInfo();_.transmissionTexture=e.createTextureInfoDef(et,nt)}}}),this}}_B.EXTENSION_NAME=n1;class AB extends pu{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[qr.MATERIAL]}}AB.EXTENSION_NAME="KHR_materials_unlit";const kI="KHR_materials_unlit";class yB extends Vl{constructor(...e){super(...e),this.extensionName=kI}createUnlit(){return new AB(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((i,s)=>{i.extensions&&i.extensions.KHR_materials_unlit&&e.materials[s].setExtension(kI,this.createUnlit())}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{if(s.getExtension(kI)){const a=e.materialIndexMap.get(s),h=i.json.materials[a];h.extensions=h.extensions||{},h.extensions.KHR_materials_unlit={}}}),this}}yB.EXTENSION_NAME=kI;class wB extends pu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}wB.EXTENSION_NAME="KHR_materials_variants";class xB extends pu{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[qr.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}xB.EXTENSION_NAME="KHR_materials_variants";class HD extends pu{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}HD.EXTENSION_NAME="KHR_materials_variants";const J_="KHR_materials_variants";class bB extends Vl{constructor(...e){super(...e),this.extensionName=J_}createMappingList(){return new xB(this.document.getGraph())}createVariant(e=""){return new HD(this.document.getGraph(),e)}createMapping(){return new wB(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof HD)}read(e){const i=e.jsonDoc;if(!i.json.extensions||!i.json.extensions[J_])return this;const s=(i.json.extensions[J_].variants||[]).map(a=>this.createVariant().setName(a.name||""));return(i.json.meshes||[]).forEach((a,h)=>{const d=e.meshes[h];(a.primitives||[]).forEach((_,et)=>{if(!_.extensions||!_.extensions[J_])return;const nt=this.createMappingList(),it=_.extensions[J_];for(const lt of it.mappings){const dt=this.createMapping();lt.material!==void 0&&dt.setMaterial(e.materials[lt.material]);for(const pt of lt.variants||[])dt.addVariant(s[pt]);nt.addMapping(dt)}d.listPrimitives()[et].setExtension(J_,nt)})}),this}write(e){const i=e.jsonDoc,s=this.listVariants();if(!s.length)return this;const a=[],h=new Map;for(const d of s)h.set(d,a.length),a.push(e.createPropertyDef(d));for(const d of this.document.getRoot().listMeshes()){const _=e.meshIndexMap.get(d);d.listPrimitives().forEach((et,nt)=>{const it=et.getExtension(J_);if(!it)return;const lt=e.jsonDoc.json.meshes[_].primitives[nt],dt=it.listMappings().map(pt=>{const gt=e.createPropertyDef(pt),vt=pt.getMaterial();return vt&&(gt.material=e.materialIndexMap.get(vt)),gt.variants=pt.listVariants().map(Ct=>h.get(Ct)),gt});lt.extensions=lt.extensions||{},lt.extensions[J_]={mappings:dt}})}return i.json.extensions=i.json.extensions||{},i.json.extensions[J_]={variants:a},this}}bB.EXTENSION_NAME=J_;const{G:YO}=du;class EB extends pu{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[qr.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Ll(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:YO})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Um.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const i=this.getAttenuationColor().slice();return this.set("attenuationColor",Um.hexToFactor(e,i))}}EB.EXTENSION_NAME="KHR_materials_volume";const LI="KHR_materials_volume";class SB extends Vl{constructor(...e){super(...e),this.extensionName=LI}createVolume(){return new EB(this.document.getGraph())}read(e){const i=e.jsonDoc,s=i.json.textures||[];return(i.json.materials||[]).forEach((a,h)=>{if(a.extensions&&a.extensions.KHR_materials_volume){const d=this.createVolume();e.materials[h].setExtension(LI,d);const _=a.extensions.KHR_materials_volume;if(_.thicknessFactor!==void 0&&d.setThicknessFactor(_.thicknessFactor),_.attenuationDistance!==void 0&&d.setAttenuationDistance(_.attenuationDistance),_.attenuationColor!==void 0&&d.setAttenuationColor(_.attenuationColor),_.thicknessTexture!==void 0){const et=_.thicknessTexture;d.setThicknessTexture(e.textures[s[et.index].source]),e.setTextureInfo(d.getThicknessTextureInfo(),et)}}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(LI);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _=d.extensions.KHR_materials_volume={};if(a.getThicknessFactor()>0&&(_.thicknessFactor=a.getThicknessFactor()),Number.isFinite(a.getAttenuationDistance())&&(_.attenuationDistance=a.getAttenuationDistance()),Zl.eq(a.getAttenuationColor(),[1,1,1])||(_.attenuationColor=a.getAttenuationColor()),a.getThicknessTexture()){const et=a.getThicknessTexture(),nt=a.getThicknessTextureInfo();_.thicknessTexture=e.createTextureInfoDef(et,nt)}}}),this}}SB.EXTENSION_NAME=LI;const CB="KHR_mesh_quantization";class MB extends Vl{constructor(...e){super(...e),this.extensionName=CB}read(e){return this}write(e){return this}}MB.EXTENSION_NAME=CB;const TB="KHR_texture_basisu";class XO{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const i=QD(e);return[i.pixelWidth,i.pixelHeight]}getChannels(e){const i=QD(e).dataFormatDescriptor[0];if(i.colorModel===163)return i.samples.length===2&&(15&i.samples[1].channelType)==15?4:3;if(i.colorModel===166)return(15&i.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${i.colorModel}".`)}getGPUByteLength(e){const i=QD(e),s=this.getChannels(e)>3;let a=0;for(let h=0;h<i.levels.length;h++){const d=i.levels[h];a+=d.uncompressedByteLength?d.uncompressedByteLength:Math.max(1,Math.floor(i.pixelWidth/Math.pow(2,h)))/4*(Math.max(1,Math.floor(i.pixelHeight/Math.pow(2,h)))/4)*(s?16:8)}return a}}class IB extends Vl{constructor(...e){super(...e),this.extensionName=TB,this.prereadTypes=[qr.TEXTURE]}static register(){KA.registerFormat("image/ktx2",new XO)}preread(e){return e.jsonDoc.json.textures.forEach(i=>{i.extensions&&i.extensions.KHR_texture_basisu&&(i.source=i.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const i=e.jsonDoc;return this.document.getRoot().listTextures().forEach(s=>{if(s.getMimeType()==="image/ktx2"){const a=e.imageIndexMap.get(s);i.json.textures.forEach(h=>{h.source===a&&(h.extensions=h.extensions||{},h.extensions.KHR_texture_basisu={source:h.source},delete h.source)})}}),this}}IB.EXTENSION_NAME=TB;class DB extends pu{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[qr.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}DB.EXTENSION_NAME="KHR_texture_transform";const OI="KHR_texture_transform";class PB extends Vl{constructor(...e){super(...e),this.extensionName=OI}createTransform(){return new DB(this.document.getGraph())}read(e){for(const[i,s]of Array.from(e.textureInfos.entries())){if(!s.extensions||!s.extensions.KHR_texture_transform)continue;const a=this.createTransform(),h=s.extensions.KHR_texture_transform;h.offset!==void 0&&a.setOffset(h.offset),h.rotation!==void 0&&a.setRotation(h.rotation),h.scale!==void 0&&a.setScale(h.scale),h.texCoord!==void 0&&a.setTexCoord(h.texCoord),i.setExtension(OI,a)}return this}write(e){const i=Array.from(e.textureInfoDefMap.entries());for(const[s,a]of i){const h=s.getExtension(OI);if(!h)continue;a.extensions=a.extensions||{};const d={},_=Zl.eq;_(h.getOffset(),[0,0])||(d.offset=h.getOffset()),h.getRotation()!==0&&(d.rotation=h.getRotation()),_(h.getScale(),[1,1])||(d.scale=h.getScale()),h.getTexCoord()!=null&&(d.texCoord=h.getTexCoord()),a.extensions.KHR_texture_transform=d}return this}}PB.EXTENSION_NAME=OI;const KO=[qr.ROOT,qr.SCENE,qr.NODE,qr.MESH,qr.MATERIAL,qr.TEXTURE,qr.ANIMATION];class RB extends pu{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=KO}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",pw({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const i=this.get("properties");return e in i?i[e]:null}setProperty(e,i){this._assertContext(e);const s=pw({},this.get("properties"));return i?s[e]=i:delete s[e],this.set("properties",s)}toJSONLD(){return pw({"@context":WD(this.get("context"))},WD(this.get("properties")))}fromJSONLD(e){const i=(e=WD(e))["@context"];return i&&this.set("context",i),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function WD(c){return JSON.parse(JSON.stringify(c))}RB.EXTENSION_NAME="KHR_xmp_json_ld";const qD="KHR_xmp_json_ld";class BB extends Vl{constructor(...e){super(...e),this.extensionName=qD}createPacket(){return new RB(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var i;const s=(i=e.jsonDoc.json.extensions)==null?void 0:i.KHR_xmp_json_ld;if(!s||!s.packets)return this;const a=e.jsonDoc.json,h=this.document.getRoot(),d=s.packets.map(nt=>this.createPacket().fromJSONLD(nt)),_=[[a.asset],a.scenes,a.nodes,a.meshes,a.materials,a.images,a.animations],et=[[h],h.listScenes(),h.listNodes(),h.listMeshes(),h.listMaterials(),h.listTextures(),h.listAnimations()];for(let nt=0;nt<_.length;nt++){const it=_[nt]||[];for(let lt=0;lt<it.length;lt++){const dt=it[lt];dt.extensions&&dt.extensions.KHR_xmp_json_ld&&et[nt][lt].setExtension(qD,d[dt.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:i}=e.jsonDoc,s=[];for(const a of this.properties){s.push(a.toJSONLD());for(const h of a.listParents()){let d;switch(h.propertyType){case qr.ROOT:d=i.asset;break;case qr.SCENE:d=i.scenes[e.sceneIndexMap.get(h)];break;case qr.NODE:d=i.nodes[e.nodeIndexMap.get(h)];break;case qr.MESH:d=i.meshes[e.meshIndexMap.get(h)];break;case qr.MATERIAL:d=i.materials[e.materialIndexMap.get(h)];break;case qr.TEXTURE:d=i.images[e.imageIndexMap.get(h)];break;case qr.ANIMATION:d=i.animations[e.animationIndexMap.get(h)];break;default:d=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${h.propertyType}"`)}d&&(d.extensions=d.extensions||{},d.extensions.KHR_xmp_json_ld={packet:s.length-1})}}return s.length>0&&(i.extensions=i.extensions||{},i.extensions.KHR_xmp_json_ld={packets:s}),this}}BB.EXTENSION_NAME=qD;const JO=[oM,KR,eB,nB,rB,oB,dB,gB,fB,_B,yB,bB,SB,MB,IB,PB,BB];let YD=class extends _o{constructor(c,e,i){super(c,e,i??new ZO,new vo(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(c,e,i,s,a){this.enabled&&super.render(c,e,i,s,a)}};YD=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("High precision Normal Buffer")],YD);class ZO extends b.RSm{constructor(){super()}onBeforeRender(e,i,s,a,h){var d,_;let et=h.material;Array.isArray(et)&&(et=et[0]),this.normalMap=(d=et==null?void 0:et.normalMap)!==null&&d!==void 0?d:null,this.needsUpdate=!0,this.side=(_=et.side)!==null&&_!==void 0?_:b.ehD}}class $E extends nv{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:b.cLu,minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const i=this._normalTarget,s=new Set,a=new Set;return new class extends YD{render(h,d,_,et,nt){const it=h.getRenderTarget(),lt=h.getActiveCubeFace(),dt=h.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:pt})=>{pt&&((pt.transparent&&pt.userData.renderToDepth||!pt.transparent&&pt.transmission===0&&pt.userData.renderToDepth===!1)&&(s.add(pt),pt.transparent=!pt.transparent),Math.abs(pt.transmission||0)>0&&pt.userData.renderToDepth&&(a.add([pt,pt.transmission]),pt.transmission=0))}),jr(h,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(h,d,i,et,nt)),s.forEach(pt=>pt.transparent=!pt.transparent),s.clear(),a.forEach(([pt,gt])=>pt.transmission=gt),a.clear(),h.setRenderTarget(it,lt,dt))}}}_update(e){if(!super._update(e))return!1;const i=this.pass.passObject;return i.scene=e.scene.modelObject,i.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var i,s;return e.renderer.disposeTarget((s=(i=this._normalTarget)===null||i===void 0?void 0:i.dispose)===null||s===void 0?void 0:s.call(i)),super.onRemove(e)}updateShaderProperties(e){var i,s;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(s=(i=this.getNormalBuffer())===null||i===void 0?void 0:i.texture)!==null&&s!==void 0?s:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}$E.PluginType="NormalBufferPlugin";function kB(c){const e=c==null?void 0:c.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const i=e._ssBevel;return i.hasSSBevel=!0,i.radius===void 0&&(i.radius=0),c.isMaterial&&(c.needsUpdate=!0),!0}let XD=class extends Wl{constructor(c,e,i,s){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new b.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new b.Pa4(1,1,1)}},vertexShader:rv,fragmentShader:`

            ${i}

            ${sv}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=mask.g*255.*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(a,h,d)=>{var _,et;this.enabled&&(!((et=(_=h.materialObject.userData)===null||_===void 0?void 0:_._ssBevel)===null||et===void 0)&&et.hasSSBevel)&&(a.fragmentShader=Jo(a.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(a,h,d)=>{var _,et;if(!this.enabled||!(!((et=(_=h.materialObject.userData)===null||_===void 0?void 0:_._ssBevel)===null||et===void 0)&&et.hasSSBevel))return;const nt=h.materialObject,it=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==it&&(this.materialExtension.extraUniforms.tSSBevelMap.value=it,nt.needsUpdate=!0)},getUiConfig:a=>{const h={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var d;return((d=a.materialObject.userData._ssBevel)===null||d===void 0?void 0:d.hasSSBevel)||!1},set value(d){var _,et;d!==((_=a.materialObject.userData._ssBevel)===null||_===void 0?void 0:_.hasSSBevel)&&(d?kB(a.materialObject)||alert("Cannot add screen space bevel."):(a.materialObject.userData._ssBevel.hasSSBevel=!1,a.materialObject.needsUpdate=!0),(et=h.uiRefresh)===null||et===void 0||et.call(h,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var d;return!(!((d=a.materialObject.userData._ssBevel)===null||d===void 0)&&d.hasSSBevel)},property:[a.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return h},parsFragmentSnippet:(a,h)=>{var d,_;return this.enabled&&(!((_=(d=h==null?void 0:h.materialObject.userData)===null||d===void 0?void 0:d._ssBevel)===null||_===void 0)&&_.hasSSBevel)?Qt`
            uniform sampler2D tSSBevelMap;
            ${L1}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:a=>{var h,d;return(this.enabled?"1":"0")+(!((d=(h=a.materialObject.userData)===null||h===void 0?void 0:h._ssBevel)===null||d===void 0)&&d.hasSSBevel?"1":"0")},isCompatible:a=>a.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=s,this._edgeMaterial=new m0({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new b.FM8(1,1)},cameraPositionWorld:{value:new b.Pa4(1,1,1)}},vertexShader:rv,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new m0({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new b.FM8(.5,.5)},direction:{value:new b.FM8(.5,.5)}},vertexShader:rv,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(c,e,i,s,a){var h,d;if(!this.enabled)return;const _=c.baseRenderer,et={minFilter:b.wem,magFilter:b.wem,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1},nt=_.getTempTarget(et);this._renderEdges(_,nt),this._blurEdges(_,nt),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(h=this._viewerApp.getPlugin(Bo))===null||h===void 0||h.updateShaderProperties(this.material),(d=this._viewerApp.getPlugin($E))===null||d===void 0||d.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=nt.texture,super.render(c,this._target,nt,s,a),_.releaseTempTarget(nt)}_initsamples(){const c=[];return c.push(new b.FM8(-8,0).multiplyScalar(.125)),c.push(new b.FM8(-6,-4).multiplyScalar(.125)),c.push(new b.FM8(-3,-2).multiplyScalar(.125)),c.push(new b.FM8(-2,-6).multiplyScalar(.125)),c.push(new b.FM8(1,-1).multiplyScalar(.125)),c.push(new b.FM8(2,-5).multiplyScalar(.125)),c.push(new b.FM8(6,-7).multiplyScalar(.125)),c.push(new b.FM8(5,-3).multiplyScalar(.125)),c.push(new b.FM8(4,1).multiplyScalar(.125)),c.push(new b.FM8(7,4).multiplyScalar(.125)),c.push(new b.FM8(3,5).multiplyScalar(.125)),c.push(new b.FM8(0,7).multiplyScalar(.125)),c.push(new b.FM8(-1,3).multiplyScalar(.125)),c.push(new b.FM8(-4,6).multiplyScalar(.125)),c.push(new b.FM8(-7,8).multiplyScalar(.125)),c.push(new b.FM8(-5,2).multiplyScalar(.125)),c}_blurEdges(c,e){var i,s;const a={minFilter:b.wem,magFilter:b.wem,isAntialiased:!1,format:b.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},h=c.getTempTarget(a),d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,_=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new b.FM8(d,_),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new b.FM8(1,0),c.blit(void 0,h,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new b.FM8(d/2,_/2),this._separableBlurMaterial.uniforms.colorTexture.value=h.texture,this._separableBlurMaterial.uniforms.direction.value=new b.FM8(0,1),c.blit(void 0,e,{material:this._separableBlurMaterial}),c.releaseTempTarget(h)}_renderEdges(c,e){var i,s,a,h;const d=((i=e.texture.image)===null||i===void 0?void 0:i.width)||1,_=((s=e.texture.image)===null||s===void 0?void 0:s.height)||1;this._edgeMaterial.uniforms.screenSize.value=new b.FM8(d,_),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(a=this._viewerApp.getPlugin(Bo))===null||a===void 0||a.updateShaderProperties(this._edgeMaterial),(h=this._viewerApp.getPlugin($E))===null||h===void 0||h.updateShaderProperties(this._edgeMaterial),c.blit(void 0,e,{material:this._edgeMaterial})}};XD=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("SSBevel")],XD);class fw extends nv{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[Yr,Bo,$E],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(i=>new $O(i))}passCtor(e){var i,s;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:b.cLu,minFilter:b.TyD,magFilter:b.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const a=e.getPluginByType("debug");return a&&a.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new XD(e.renderer,this._bevelTarget,(s=(i=e.getPlugin(Bo))===null||i===void 0?void 0:i.getUnpackSnippet())!==null&&s!==void 0?s:"",e)}async onAdded(e){var i,s,a,h,d,_,et;await super.onAdded(e);const nt=e.getPlugin(Yr);return!((i=this.pass)===null||i===void 0)&&i.passObject.materialExtension&&((s=nt==null?void 0:nt.materials)===null||s===void 0||s.registerMaterialExtension((a=this.pass)===null||a===void 0?void 0:a.passObject.materialExtension)),(h=nt==null?void 0:nt.importer)===null||h===void 0||h.addEventListener("loaderCreate",this._loaderCreate),(et=(_=(d=nt==null?void 0:nt.exporter)===null||d===void 0?void 0:d.getExporter("gltf","glb"))===null||_===void 0?void 0:_.extensions)===null||et===void 0||et.push(eN),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,i,s,a;(e=this._viewer)===null||e===void 0||e.setDirty(),(a=(i=this.pass)===null||i===void 0?void 0:(s=i.passObject.materialExtension).setDirty)===null||a===void 0||a.call(s)}_update(e){var i;let s=this.enabled;if(s&&!this._lastEnabled){const a=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?a.enabled=!0:(this.enabled=!1,a.enabled=!1,s=!1)}return this._lastEnabled=s,s}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}}fw.PluginType="SSBevelPlugin",fw.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class $O{constructor(e){this.parser=e,this.name=fw.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const a=s.extensions[this.name];return i.userData||(i.userData={}),kB(i),i.userData._ssBevel=eo(a,i.userData._ssBevel,!1,{}),Promise.resolve()}}const eN=c=>({writeMaterial:(e,i)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;i.extensions=i.extensions||{};const s=so(e.userData._ssBevel,!1);i.extensions[fw.SSBEVEL_GLTF_EXTENSION]=s,c.extensionsUsed[fw.SSBEVEL_GLTF_EXTENSION]=!0}});class LB extends TD{constructor(e){super(),this._loadedLibs=!1,e=e||{method:oM.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new xO().registerExtensions(JO).registerExtensions([OB,zI,UI,FI,jI,VI,QI,GI,HI,WI,qI,YI,XI,KI,JI]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:i=!1,...s}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,s);await this._loadLibs();const a={...s};i&&(a.externalImagesInExtras=!0);const h=await new Promise((lt,dt)=>this.parse(e,lt,dt,a)),d=await super.parseAsync(h,a);if(!i)return d;if(!h)throw new Error("GLTFDracoExporter: gltf is null");let _=h;const et=_.byteLength||1/0,nt=await(typeof _!="object"||_.byteLength?this._io.readBinary(new Uint8Array(_)):this._io.readJSON({json:_,resources:{}}));if(nt.createExtension(oM).setRequired(!0).setEncoderOptions(this._encoderOptions),a.exportExt==="glb")_=await this._io.writeBinary(nt),isFinite(et)&&console.log("DRACO Compression ratio: "+(_.byteLength/et).toFixed(5));else{const lt=await this._io.writeJSON(nt);_=lt.json,Object.values(lt.resources).filter(dt=>dt).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),_.resources=lt.resources)}_.__isGLTFOutput=!0;const it=await super.parseAsync(_,a);return it.__uncompressed=d,it}}class KD extends Ns{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Yr,eM]}async onAdded(e){await super.onAdded(e);const i=e.getManager().importer;if(!i)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(s,a){ID(s,LB,h=>{const d=Au()+".drc",_=h;_.loader=a.registerFile(d),_.loader.setDecoderConfig({type:"js"}),_.loader.preload(!0,!0)})})(e,i)}}KD.PluginType="GLTFDracoExportPlugin";class tN extends pu{constructor(){super(...arguments),this.extensionName=Mp,this.parentTypes=[qr.SCENE],this.propertyType="ViewerJSON"}init(){}}class OB extends Vl{constructor(){super(...arguments),this.extensionName=Mp,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var i;return this._viewerConfig={},(i=e.jsonDoc.json.scenes)===null||i===void 0||i.forEach((s,a)=>{if(s.extensions&&s.extensions[Mp]){const h=new tN(this.document.getGraph());e.scenes[a].setExtension(Mp,h);const d=s.extensions[Mp];this._viewerConfig=d}}),this}write(e){return this.document.getRoot().listScenes().forEach(i=>{var s;if(i.getExtension(Mp)){const a=(s=e.jsonDoc.json.scenes)===null||s===void 0?void 0:s[e.jsonDoc.json.scene||0];a&&this._viewerConfig!=={}&&(a.extensions=a.extensions||{},a.extensions[Mp]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}OB.EXTENSION_NAME=Mp;class NI extends pu{constructor(e,i,s){super(e,i),this.parentTypes=[qr.MATERIAL,qr.MESH,qr.NODE,qr.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=s}addTexture(e,i,s,a=4369){this.setRef(e,s,{channels:a}),this.textures[e]=[i,s]}copy(e,i=K_){return super.copy(e,i),this}dispose(){Object.values(this.textures).forEach(([e,i])=>{e==null||e.dispose()}),super.dispose()}init(){}}class zm extends Vl{constructor(){super(...arguments),this.textureChannels={}}read(e){const i=e.jsonDoc,s=i.json.materials||[],a=i.json.textures||[];return s.forEach((h,d)=>{var _,et;if(h.extensions&&h.extensions[this.extensionName]){const nt=new NI(this.document.getGraph(),"",this.extensionName);e.materials[d].setExtension(this.extensionName,nt);const it={...h.extensions[this.extensionName]};for(const[lt,dt]of Object.entries(it))if(typeof(dt==null?void 0:dt.index)=="number"){const pt=dt,gt=(_=a[pt.index])===null||_===void 0?void 0:_.source;if(typeof gt!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",pt);continue}const vt=e.textures[gt],Ct=new Ll(this.document.getGraph()),wt=(et=this.textureChannels[lt])!==null&&et!==void 0?et:4369;nt.addTexture(lt,Ct,vt,wt),e.setTextureInfo(Ct,pt),delete it[lt]}nt.setExtras(it)}}),(i.json.meshes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new NI(this.document.getGraph(),"",this.extensionName);e.meshes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),(i.json.nodes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new NI(this.document.getGraph(),"",this.extensionName);e.nodes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),(i.json.scenes||[]).forEach((h,d)=>{if(h.extensions&&h.extensions[this.extensionName]){const _=new NI(this.document.getGraph(),"",this.extensionName);e.scenes[d].setExtension(this.extensionName,_);const et=h.extensions[this.extensionName];_.setExtras(et)}}),this}write(e){const i=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.materialIndexMap.get(s),d=i.json.materials[h];d.extensions=d.extensions||{};const _={...a.getExtras()};for(const[et,nt]of Object.entries(a.textures)){const it=nt[0],lt=nt[1];lt&&(_[et]=e.createTextureInfoDef(lt,it))}d.extensions[this.extensionName]=_}}),this.document.getRoot().listMeshes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.meshIndexMap.get(s),d=i.json.meshes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listNodes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.nodeIndexMap.get(s),d=i.json.nodes[h];d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this.document.getRoot().listScenes().forEach(s=>{const a=s.getExtension(this.extensionName);if(a){const h=e.jsonDoc.json.scene||0,d=i.json.scenes[h];if(!d)return;d.extensions=d.extensions||{},d.extensions[this.extensionName]=a.getExtras()}}),this}}class UI extends zm{constructor(){super(...arguments),this.extensionName=UI.EXTENSION_NAME,this.textureChannels={bumpTexture:du.R}}}UI.EXTENSION_NAME=$p;class FI extends zm{constructor(){super(...arguments),this.extensionName=FI.EXTENSION_NAME,this.textureChannels={lightMapTexture:du.R|du.G|du.B}}}FI.EXTENSION_NAME=_f;class jI extends zm{constructor(){super(...arguments),this.extensionName=jI.EXTENSION_NAME,this.textureChannels={alphaTexture:du.G}}}jI.EXTENSION_NAME=$m;class zI extends zm{constructor(){super(...arguments),this.extensionName=zI.EXTENSION_NAME}}zI.EXTENSION_NAME=$a.DIAMOND_GLTF_EXTENSION;class VI extends zm{constructor(){super(...arguments),this.extensionName=VI.EXTENSION_NAME}}VI.EXTENSION_NAME=Go.AnimationMarkersExtension;class QI extends zm{constructor(){super(...arguments),this.extensionName=QI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:du.R|du.G|du.B}}}QI.EXTENSION_NAME=Qp.ANISOTROPY_GLTF_EXTENSION;class GI extends zm{constructor(){super(...arguments),this.extensionName=GI.EXTENSION_NAME,this.textureChannels={anisotropyDirection:du.R|du.G|du.B}}}GI.EXTENSION_NAME=Mu.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class HI extends zm{constructor(){super(...arguments),this.extensionName=HI.EXTENSION_NAME}}HI.EXTENSION_NAME=dn;class WI extends zm{constructor(){super(...arguments),this.extensionName=WI.EXTENSION_NAME}}WI.EXTENSION_NAME=Jm;class qI extends zm{constructor(){super(...arguments),this.extensionName=qI.EXTENSION_NAME}}qI.EXTENSION_NAME=Tp;class YI extends zm{constructor(){super(...arguments),this.extensionName=YI.EXTENSION_NAME}}YI.EXTENSION_NAME=Im.CLEARCOAT_TINT_GLTF_EXTENSION;class XI extends zm{constructor(){super(...arguments),this.extensionName=XI.EXTENSION_NAME}}XI.EXTENSION_NAME=sm.THIN_FILM_LAYER_GLTF_EXTENSION;class KI extends zm{constructor(){super(...arguments),this.extensionName=KI.EXTENSION_NAME}}KI.EXTENSION_NAME=fw.SSBEVEL_GLTF_EXTENSION;class JI extends zm{constructor(){super(...arguments),this.extensionName=JI.EXTENSION_NAME}}JI.EXTENSION_NAME=Uu.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class NB extends st{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,i)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}NB.PluginType="PMREMGenerator";const UB=new b.Pa4,nN=new b._fP,FB=new b.Pa4;class iN extends b.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(i){i.element instanceof Element&&i.element.parentNode!==null&&i.element.parentNode.removeChild(i.element)})})}copy(e,i){return super.copy(e,i),this.element=e.element.cloneNode(!0),this}}const Z_=new b.yGw,rN=new b.yGw;class sN{constructor(e={}){const i=this;let s,a,h,d;const _={camera:{fov:0,style:""},objects:new WeakMap},et=e.element!==void 0?e.element:document.createElement("div");et.style.overflow="hidden",this.domElement=et;const nt=document.createElement("div");function it(gt){return Math.abs(gt)<1e-10?0:gt}function lt(gt){const vt=gt.elements;return"matrix3d("+it(vt[0])+","+it(-vt[1])+","+it(vt[2])+","+it(vt[3])+","+it(vt[4])+","+it(-vt[5])+","+it(vt[6])+","+it(vt[7])+","+it(vt[8])+","+it(-vt[9])+","+it(vt[10])+","+it(vt[11])+","+it(vt[12])+","+it(-vt[13])+","+it(vt[14])+","+it(vt[15])+")"}function dt(gt){const vt=gt.elements;return"translate(-50%,-50%)matrix3d("+it(vt[0])+","+it(vt[1])+","+it(vt[2])+","+it(vt[3])+","+it(-vt[4])+","+it(-vt[5])+","+it(-vt[6])+","+it(-vt[7])+","+it(vt[8])+","+it(vt[9])+","+it(vt[10])+","+it(vt[11])+","+it(vt[12])+","+it(vt[13])+","+it(vt[14])+","+it(vt[15])+")"}function pt(gt,vt,Ct,wt){if(gt.isCSS3DObject){const xt=gt.visible===!0&&gt.layers.test(Ct.layers)===!0;if(gt.element.style.display=xt===!0?"":"none",xt===!0){let _t;gt.onBeforeRender(i,vt,Ct),gt.isCSS3DSprite?(Z_.copy(Ct.matrixWorldInverse),Z_.transpose(),gt.rotation2D!==0&&Z_.multiply(rN.makeRotationZ(gt.rotation2D)),gt.matrixWorld.decompose(UB,nN,FB),Z_.setPosition(UB),Z_.scale(FB),Z_.elements[3]=0,Z_.elements[7]=0,Z_.elements[11]=0,Z_.elements[15]=1,_t=dt(Z_)):_t=dt(gt.matrixWorld);const Pt=gt.element,Rt=_.objects.get(gt);if(Rt===void 0||Rt.style!==_t){Pt.style.transform=_t;const Lt={style:_t};_.objects.set(gt,Lt)}Pt.parentNode!==nt&&nt.appendChild(Pt),gt.onAfterRender(i,vt,Ct)}}for(let xt=0,_t=gt.children.length;xt<_t;xt++)pt(gt.children[xt],vt,Ct)}nt.style.transformStyle="preserve-3d",nt.style.pointerEvents="none",et.appendChild(nt),this.getSize=function(){return{width:s,height:a}},this.render=function(gt,vt){const Ct=vt.projectionMatrix.elements[5]*d;let wt,xt;_.camera.fov!==Ct&&(et.style.perspective=vt.isPerspectiveCamera?Ct+"px":"",_.camera.fov=Ct),gt.matrixWorldAutoUpdate===!0&&gt.updateMatrixWorld(),vt.parent===null&&vt.matrixWorldAutoUpdate===!0&&vt.updateMatrixWorld(),vt.isOrthographicCamera&&(wt=-(vt.right+vt.left)/2,xt=(vt.top+vt.bottom)/2);const _t=vt.isOrthographicCamera?"scale("+Ct+")translate("+it(wt)+"px,"+it(xt)+"px)"+lt(vt.matrixWorldInverse):"translateZ("+Ct+"px)"+lt(vt.matrixWorldInverse),Pt=_t+"translate("+h+"px,"+d+"px)";_.camera.style!==Pt&&(nt.style.transform=Pt,_.camera.style=Pt),pt(gt,gt,vt)},this.setSize=function(gt,vt){s=gt,a=vt,h=s/2,d=a/2,et.style.width=gt+"px",et.style.height=vt+"px",nt.style.width=gt+"px",nt.style.height=vt+"px"}}}var ZI,$I=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ZA=ZI=class extends Ns{constructor(c=!0){super(),this._scene=new b.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,i,s,a,h;const d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();if(!(d!=null&&d.geometry))return void await((s=this._viewer)===null||s===void 0?void 0:s.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const _=await((a=this._viewer)===null||a===void 0?void 0:a.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!_)return;const et=await((h=this._viewer)===null||h===void 0?void 0:h.prompt("Width: Enter the width for the object.","512",!1))||"512";et&&this.attachIFrame(d,_,parseInt(et))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=c,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const c=this._viewer;c&&this._renderer&&(c.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",c.canvas):this._renderer.domElement.appendChild(c.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new sN;const c=this._viewer.renderer.rendererObject.getSize(new b.FM8);this._renderer.setSize(c.width,c.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const i=this._viewer.renderer.rendererObject.getSize(new b.FM8);this._renderer.setSize(i.width,i.height)})}async onAdded(c){await super.onAdded(c);let e=!0,i=!0;c.addEventListener("postFrame",h=>{var d,_;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(i&&this._trackers.forEach(et=>{var nt,it;let lt=!0;const dt=et.modelObj.material.side;if(dt!==b.ehD){const pt=new b.Pa4(0,0,1).applyQuaternion(et.cssObj.quaternion),gt=(it=(nt=this._viewer)===null||nt===void 0?void 0:nt.scene.activeCamera)===null||it===void 0?void 0:it.cameraObject,vt=pt.dot(gt.getWorldDirection(new b.Pa4));lt=dt===b._Li?vt>0:vt<0}et.cssObj.element.style.visibility=lt?"visible":"hidden"}),this._trackers.filter(et=>et.dirty).forEach(et=>this._syncProperties(et)),(d=this._renderer)===null||d===void 0||d.render(this._scene,(_=c.scene.activeCamera)===null||_===void 0?void 0:_.cameraObject),e=!1))}),c.addEventListener("update",h=>{this.enabled&&(e=this._trackers.length>0)}),c.scene.addEventListener("sceneUpdate",h=>{this.enabled&&(this._trackers.forEach(d=>d.dirty=!0),e=this._trackers.length>0)}),c.scene.addEventListener("activeCameraUpdate",h=>{this.enabled&&(e=this._trackers.length>0,i=!0)});let s=!1;const a=new b.iMs;c.container.addEventListener("mousemove",h=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const d=this._viewer.canvas.getBoundingClientRect(),_=(h.clientX-d.x)/d.width*2-1,et=-(h.clientY-d.y)/d.height*2+1;a.setFromCamera({x:_,y:et},this._viewer.scene.activeCamera.cameraObject);const nt=this._trackers.map(lt=>lt.modelObj),it=a.intersectObjects(nt,!1);if(console.log(it),it.length)return this._viewer.canvas.style.pointerEvents="none",s=!0,void console.log(this._viewer.canvas.style.pointerEvents);s&&(this._viewer.canvas.style.pointerEvents="auto",s=!1)})}attachIFrame(c,e,i){const s=t2(c.modelObject),a=jB(e,i,i*s.y/s.x,()=>{var h;return(h=c.setDirty)===null||h===void 0?void 0:h.call(c)});return this.attachCSS3DObject(a,c),a}attachCSS3DObject(c,e){var i,s,a,h,d;if(this._trackers.push({cssObj:c,modelObj:e.modelObject,dirty:!0}),c.element&&(this._resizeObserver.observe(c.element),c.element.__isCSS3DObjectElement=!0,console.log(c.element,c.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const _=(i=this._viewer)===null||i===void 0?void 0:i.createMaterial("basic",{opacity:0,color:new b.Ilk("black"),blending:b.jFi,side:b.Wl3});if(!_)throw"cannot create mat";_.userData.forcedLinearDepth=0,(s=e.setMaterial)===null||s===void 0||s.call(e,_),e2(e.modelObject),JD(e.modelObject),t2(e.modelObject),this._scene.add(c),(h=(a=this.uiConfig)===null||a===void 0?void 0:a.uiRefresh)===null||h===void 0||h.call(a),(d=e.setDirty)===null||d===void 0||d.call(e)}_syncProperties(c){const e=c.modelObj,i=c.cssObj;e.updateMatrixWorld();const s=c.cssObj.element.clientWidth<1.5?0:(c.cssObj.element.clientWidth-1.5)/t2(e).x,a=e2(e);i.quaternion.setFromUnitVectors(new b.Pa4(0,0,1),a),i.position.copy(JD(e)),i.scale.set(1,1,1).multiplyScalar(1/s),i.updateMatrixWorld(),i.applyMatrix4(e.matrixWorld),c.dirty=!1}async onDispose(c){return this._resizeObserver.disconnect(),super.onDispose(c)}};function jB(c,e,i,s){const a=document.createElement("div");a.style.width=e.toString()+"px",a.style.height=i.toString()+"px",a.style.backgroundColor="transparent";const h=document.createElement("iframe",{is:"x-frame-bypass"});h.style.width="100%",h.style.height="100%",h.style.border="0px";const d=()=>{var _,et;try{h.contentWindow.name}catch(nt){(typeof nt=="string"?nt:(et=(_=nt==null?void 0:nt.toString)===null||_===void 0?void 0:_.call(nt))!==null&&et!==void 0?et:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(nt)}s(),h.removeEventListener("load",d)};return h.addEventListener("load",d),h.src=c,a.appendChild(h),new iN(a)}function e2(c){if(c.geometry.userData.geometryNormal)return c.geometry.userData.geometryNormal;const e=c.geometry.attributes.normal,i=new b.Pa4,s=new b.Pa4;for(let a=0,h=e.count;a<h;a++)i.fromBufferAttribute(e,a),s.add(i);return s.normalize(),c.geometry.userData.geometryNormal=s,s}function JD(c){if(c.geometry.userData.geometryCenter)return c.geometry.userData.geometryCenter;const e=c.geometry;if(!e)return new b.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const i=e.boundingBox.getCenter(new b.Pa4);return c.geometry.userData.geometryCenter=i,i}function t2(c,e=new b.Pa4(0,0,1)){if(c.geometry.userData.geometrySize)return c.geometry.userData.geometrySize;const i=c.geometry;if(!i)return new b.Pa4(0,0,0);const s=i.clone();s.applyMatrix4(new b.yGw().makeRotationFromQuaternion(new b._fP().setFromUnitVectors(e,e2(c)).invert())),s.computeBoundingBox();const a=s.boundingBox.getSize(new b.Pa4);return c.geometry.userData.geometrySize=a,s.dispose(),a}ZA.PluginType="CSS3DRenderer",$I([ns("Enabled"),pn(ZI.prototype._refreshEnabled),jn()],ZA.prototype,"enabled",void 0),$I([ns("Over canvas"),pn(ZI.prototype._refreshCanvasInDOM),jn()],ZA.prototype,"overCanvas",void 0),$I([ho("Attach iframe")],ZA.prototype,"attachIFrameToSelected",void 0),ZA=ZI=$I([Ys("CSS3D Renderer")],ZA);const oN=1e4,zB=50;class eS{constructor(e=zB){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,i,s,a){const h=2e-4*this.naturalFrequency;if(e==null||a===0||e===i&&this.velocity===0)return i;if(s<0)return e;const d=e-i,_=this.velocity+this.naturalFrequency*d,et=d+s*_,nt=Math.exp(-this.naturalFrequency*s),it=(_-this.naturalFrequency*et)*nt,lt=-this.naturalFrequency*(it+_*nt);return Math.abs(it)<h*Math.abs(a)&&lt*d>=0?(this.velocity=0,i):(this.velocity=it,i+et*nt)}}const ZD=new b.Pa4;class VB{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new b.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new b.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new b.Pa4,this._hitMatrix=new b.yGw,this.xDamper=new eS,this.yDamper=new eS,this.zDamper=new eS,this.yawDamper=new eS,this.scaleDamper=new eS,this.onSelectStart=e=>{const i=this.transientHitTestSource;if(i==null)return;const s=this.frame.getHitTestResultsForTransientInput(i),a=this.presentedScene,h=this.placementBox;if(s.length===1){this.inputSource=e.inputSource;const{axes:d}=this.inputSource.gamepad||{axes:[0,0]},_=h.getHit(a,d[0],d[1]);h.show=!0,_!=null?(this.isTranslating=!0,this.lastDragPosition.copy(_)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*d[0])}else if(s.length===2){h.show=!0,this.isTwoFingering=!0;const{separation:d}=this.fingerPolar(s);this.firstRatio=d/a.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,i,s,a){var h;this.transientHitTestSource=await((h=e.requestHitTestSourceForTransientInput)===null||h===void 0?void 0:h.call(e,{profile:"generic-touchscreen"})),this.presentedScene=i,this.placementBox=a,this.xr=s,this.session=e,this.placementComplete=!1,this.goalPosition.copy(i.position),this.goalYaw=i.rotation.y,this.goalScale=i.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var i;const s=(i=this.xr)===null||i===void 0?void 0:i.getReferenceSpace(),a=s?e.getPose(s):null;return a?(this._hitMatrix.fromArray(a.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const i=this.presentedScene,s=i.position,a=i.rotation.y,h=this.placementBox,d=Math.max(h.boundingSize.x,h.boundingSize.y,h.boundingSize.z)/2,_=this.goalPosition,et=i.scale.x;if(!_.equals(s)||this.goalScale!==et){let{x:nt,y:it,z:lt}=s;nt=this.xDamper.update(nt,_.x,e,d),it=this.yDamper.update(it,_.y,e,d),lt=this.zDamper.update(lt,_.z,e,d),s.set(nt,it,lt);const dt=this.scaleDamper.update(et,this.goalScale,e,1);if(i.scale.set(dt,dt,dt),!this.isTranslating){const pt=_.y-it;this.placementComplete&&!this.placeOnWall?h.offsetHeight=pt/dt:pt===0&&(this.placementComplete=!0,h.show=!1)}}h.updateOpacity(e),i.rotation.y=this.yawDamper.update(a,this.goalYaw,e,Math.PI)}processInput(e){var i;this.frame=e;const s=this.transientHitTestSource;if(!s||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const a=e.getHitTestResultsForTransientInput(s),h=this.presentedScene,d=h.scale.x;if(this.isTwoFingering)if(a.length<2)this.isTwoFingering=!1;else{const{separation:_,deltaYaw:et}=this.fingerPolar(a);if(this.placeOnWall||(this.goalYaw+=et),!h.userData.__scaleDisabled){const nt=_/this.firstRatio;this.goalScale=nt<1.3&&nt>.7692307692307692?1:nt}}else if(a.length!==2)if(this.isRotating&&(!((i=this.inputSource)===null||i===void 0)&&i.gamepad)){const _=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=_-this.lastAngle,this.lastAngle=_}else this.isTranslating&&(console.log("translating"),a.forEach(_=>{if(_.inputSource!==this.inputSource)return;let et=null;if(_.results.length>0&&(et=this.getHitPoint(_.results[0])),et==null&&(et=this.getTouchLocation()),et!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const nt=et.y-this.lastDragPosition.y;if(nt<0){this.placementBox.offsetHeight=nt/d;const it=ZD.copy(this.xr.getCamera().position),lt=-nt/(it.y-et.y);it.multiplyScalar(lt),et.multiplyScalar(1-lt).add(it)}}this.goalPosition.add(et),this.lastDragPosition.copy(et)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:_}=this.fingerPolar(a);this.firstRatio=_/d}}getTouchLocation(){var e,i;const{axes:s}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},a=this.placementBox.getExpandedHit(this.presentedScene,s[0],s[1]);return a!=null&&(ZD.copy(a).sub((i=this.xr)===null||i===void 0?void 0:i.getCamera().position),ZD.length()>10)?null:a}fingerPolar(e){var i,s,a,h,d,_;const et=(a=(s=(i=e[0].inputSource)===null||i===void 0?void 0:i.gamepad)===null||s===void 0?void 0:s.axes)!==null&&a!==void 0?a:[0,0],nt=(_=(d=(h=e[1].inputSource)===null||h===void 0?void 0:h.gamepad)===null||d===void 0?void 0:d.axes)!==null&&_!==void 0?_:[0,0],it=nt[0]-et[0],lt=nt[1]-et[1],dt=Math.atan2(lt,it);let pt=this.lastAngle-dt;return pt>Math.PI?pt-=2*Math.PI:pt<-Math.PI&&(pt+=2*Math.PI),this.lastAngle=dt,{separation:Math.sqrt(it*it+lt*lt),deltaYaw:pt}}}const n2=.2,aN=Math.PI/24,QB=new b.FM8,i2=(c,e,i)=>{let s=e>0?i>0?0:-Math.PI/2:i>0?Math.PI/2:Math.PI;for(let a=0;a<=12;++a)c.push(e+.17*Math.cos(s),i+.17*Math.sin(s),0,e+n2*Math.cos(s),i+n2*Math.sin(s),0),s+=aN};class GB extends b.Kj0{constructor(e,i,s=!1){super(((et,nt)=>{const it=new b.u9r,lt=[],dt=[],pt=et.getSize(new b.Pa4),gt=pt.x/2,vt=(nt?pt.y:pt.z)/2;i2(dt,gt,vt),i2(dt,-gt,vt),i2(dt,-gt,-vt),i2(dt,gt,-vt);const Ct=dt.length/3;for(let xt=0;xt<Ct-2;xt+=2)lt.push(xt,xt+1,xt+3,xt,xt+3,xt+2);const wt=Ct-2;return lt.push(wt,wt+1,1,wt,1,0),it.setAttribute("position",new b.a$l(dt,3)),it.setIndex(lt),it})(e,s)),this.boundingSize=new b.Pa4,this._raycaster=new b.iMs,this._camera=i,this._placeOnWall=s;const a=this.material;a.side=b.Wl3,a.color=new vo(16711935),a.opacity=0,this.userData.bboxVisible=!1;const h=e.getSize(this.boundingSize);console.log(e,s,h,this);const d=h.x/2,_=(s?h.y:h.z)/2;this.hitPlane=new b.Kj0(new b._12(2*(d+n2),2*(_+n2))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),s?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,i,s){QB.set(i,-s),this.hitPlane.visible=!0;const a=this._positionAndNormalFromPoint(QB,this.hitPlane);return this.hitPlane.visible=!1,a==null?null:a.position}getExpandedHit(e,i,s){this.hitPlane.scale.set(1e3,1e3,1e3);const a=this.getHit(e,i,s);return this.hitPlane.scale.set(1,1,1),a}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const i=this.material;this.visible=i.opacity>0}dispose(){var e;const{geometry:i,material:s}=this.hitPlane;i.dispose(),s.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,i){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const s=this._raycaster.intersectObject(i,!0);if(s.length===0)return null;const a=s[0];return a.face==null?null:a.uv==null?{position:a.point,normal:a.face.normal,uv:null}:(a.face.normal.applyNormalMatrix(new b.Vkp().getNormalMatrix(a.object.matrixWorld)),{position:a.point,normal:a.face.normal,uv:a.uv})}}class HB extends Ns{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new VB,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),i=e.cameras[0]||e,s=this._viewer.scene.activeCamera;s.cameraObject.projectionMatrix.copy(i.projectionMatrix),s.cameraObject.projectionMatrixInverse.copy(s.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,i;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const s=this._viewer.renderer,a=(i=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||i===void 0?void 0:i.cameras[0].viewport;a?s.rendererObject.setViewport(a):console.warn("no viewport for ar camera"),jr(s.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{r2.render(s.rendererObject,null,s.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:i})=>{var s,a;if(this.dirty=!!e&&((s=this._xrManager)===null||s===void 0?void 0:s.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const h=this._xrManager.getReferenceSpace(),d=e.getViewerPose(h);if(d==null&&this._frameCount,d==null||((a=this._viewer)===null||a===void 0?void 0:a.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const _=this._viewer.scene.activeCamera;this._xrManager.updateCamera(_.cameraObject),_.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(i),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new b.Pa4(1,1,1),modelPosition:new b.Pa4,modelRotation:new b._fP,cameraPosition:new b.Pa4(0,0,5),cameraTarget:new b.Pa4,cameraUp:new b.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new b.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,i=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(i.position),this._preXRState.cameraTarget.copy(i.target),this._preXRState.cameraUp.copy(i.cameraObject.up),i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=i.cameraObject.fov,this._preXRState.cameraAspect=i.cameraObject.aspect),this._preXRState.cameraZoom=i.cameraObject.zoom,this._preXRState.cameraNear=i.cameraObject.near,this._preXRState.cameraFar=i.cameraObject.far;const s=this._viewer.getPluginByType("Ground");s!=null&&s.mesh&&(this._preXRState.groundOffset.subVectors(e.position,s.mesh.modelObject.position),this._preXRState.groundScale=s.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),s.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,i=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var s,a;if(this._xrSession){const h=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((a=(s=this._xrSession).requestHitTestSource)===null||a===void 0?void 0:a.call(s,{space:h,offsetRay:i}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const i=e.renderer.rendererObject.xr;i.enabled=!0,i.cameraAutoUpdate=!1,this._xrManager=i;const s=document.getElementById("tweakpaneUiContainer"),a=s?{root:s}:void 0;document.body.appendChild(class{static createButton(h,d={}){const _=document.createElement("button");function et(){_.style.display="",_.style.cursor="auto",_.style.left="calc(50% - 75px)",_.style.width="150px",_.onmouseenter=null,_.onmouseleave=null,_.onclick=null}function nt(it){it.style.position="absolute",it.style.bottom="20px",it.style.padding="12px 6px",it.style.border="1px solid #fff",it.style.borderRadius="4px",it.style.background="rgba(0,0,0,0.1)",it.style.color="#fff",it.style.font="normal 13px sans-serif",it.style.textAlign="center",it.style.opacity="0.5",it.style.outline="none",it.style.zIndex="999"}if("xr"in navigator)return _.id="ARButton",_.style.display="none",nt(_),navigator.xr.isSessionSupported("immersive-ar").then(function(it){it?function(){if(d.domOverlay===void 0){const gt=document.createElement("div");gt.style.display="none",document.body.appendChild(gt);const vt=document.createElementNS("http://www.w3.org/2000/svg","svg");vt.setAttribute("width",38),vt.setAttribute("height",38),vt.style.position="absolute",vt.style.right="20px",vt.style.top="20px",vt.addEventListener("click",function(){lt.end()}),gt.appendChild(vt);const Ct=document.createElementNS("http://www.w3.org/2000/svg","path");Ct.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),Ct.setAttribute("stroke","#fff"),Ct.setAttribute("stroke-width",2),vt.appendChild(Ct),d.optionalFeatures===void 0&&(d.optionalFeatures=[]),d.optionalFeatures.push("dom-overlay"),d.domOverlay={root:gt}}let lt=null;async function dt(gt){gt.addEventListener("end",pt),h.xr.setReferenceSpaceType("local"),await h.xr.setSession(gt),_.textContent="STOP AR",d.domOverlay.root.style.display="",lt=gt}function pt(){lt.removeEventListener("end",pt),_.textContent="START AR",d.domOverlay.root.style.display="none",lt=null}_.style.display="",_.style.cursor="pointer",_.style.left="calc(50% - 50px)",_.style.width="100px",_.textContent="START AR",_.onmouseenter=function(){_.style.opacity="1.0"},_.onmouseleave=function(){_.style.opacity="0.5"},_.onclick=function(){lt===null?navigator.xr.requestSession("immersive-ar",d).then(dt):lt.end()}}():(et(),_.textContent="AR NOT SUPPORTED")}).catch(function(it){et(),console.warn("Exception when trying to call xr.isSessionSupported",it),_.textContent="AR NOT ALLOWED"}),_;{const it=document.createElement("a");return window.isSecureContext===!1?(it.href=document.location.href.replace(/^http:/,"https:"),it.innerHTML="WEBXR NEEDS HTTPS"):(it.href="https://immersiveweb.dev/",it.innerHTML="WEBXR NOT AVAILABLE"),it.style.left="calc(50% - 90px)",it.style.width="180px",it.style.textDecoration="none",nt(it),it}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:a})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,i=this._viewer.getPluginByType("Ground");i&&(i.groundReflection=!1,i.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),i.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const i=e.getHitTestResults(this._hitTestSource);if(!i.length)return;const s=i[0],a=this._touchInputHelper.getHitPoint(s);a&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(a):this._touchInputHelper.goalPosition.y=a.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",a))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const i=this._viewer.scene.modelRoot,s=this._viewer.scene.activeCamera,a=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),h=a.cameras[0]||a;this._removePlacementBox();const d=this._viewer.scene.getBounds(!0,!0);d.getSize(new b.Pa4).length()>.01&&(this._placementBox=new GB(d,a,this.placeOnWall),i.add(this._placementBox),this._placementBox.show=!1);const _=a.getWorldDirection(new b.Pa4);i.rotation.y=Math.atan2(-_.x,-_.z)-0,s.cameraObject.zoom=h.zoom,s.cameraObject.near=h.near,s.cameraObject.far=h.far,s.cameraObject.isPerspectiveCamera?(s.cameraObject.fov=h.fov,s.cameraObject.aspect=h.viewport.width/h.viewport.height):console.warn("Perspective camera required."),s.cameraObject.updateProjectionMatrix(),i.position.set(0,0,0);const et=i.userData.arScale||1;i.scale.set(et,et,et),i.position.copy(a.position).add(_.multiplyScalar(5)),i.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const i=this._viewer.scene.activeCamera;i.position.copy(this._preXRState.cameraPosition),i.target.copy(this._preXRState.cameraTarget),i.cameraObject.up.copy(this._preXRState.cameraUp),i.cameraObject.near=this._preXRState.cameraNear,i.cameraObject.far=this._preXRState.cameraFar,i.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(i.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(i.cameraObject.aspect=this._preXRState.cameraAspect)),i.positionUpdated(!1),i.targetUpdated(!0),i.cameraObject.updateMatrixWorld(!0),i.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}HB.PluginType="WEBXR_ARPlugin";const r2=new an({vertexShader:yt.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:yt.uniforms});async function WB(c,e){if(c.createWriter){const s=await c.createWriter();return await s.write(0,e),void await s.close()}const i=await c.createWritable();await i.write(e),await i.close()}async function lN(c,e){const i={};return e&&(i.writable=!0,i.mode="readwrite"),await c.queryPermission(i)==="granted"||await c.requestPermission(i)==="granted"}r2.renderToScreen=!1,r2.useExistingRenderTarget=!0,r2.clear=!1;class aM extends st{constructor(e,i){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=a=>{var h;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const d=new Blob(this._currentRecording,{type:this._options.mimeType});(h=this._recordingCallback)===null||h===void 0||h.call(this,d)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=a=>{var h;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((h=this._recorder)===null||h===void 0||h.pause())},this._onresume=a=>{if(!this.stepMode)return;const h=()=>{var _;this._state==="recording"&&((_=this._recorder)===null||_===void 0||_.pause())},d=Math.min(this._resumeSyncTime-Xs(),0)+1e3/this._options.frameRate;d>0?Dl(d).then(h):h()},this._onpause=a=>{},this._ondataavailable=a=>{a.data&&a.data.size>0&&this._currentRecording.push(a.data)},this._onerror=a=>{this._state="error",this._console.error(a),this.dispatchEvent({type:"error",error:a}),this._recorder=void 0},this._canvas=e;const s=i==null?void 0:i.mimeType;this._options={mimeType:s||"auto",frameRate:30},this._setOptions(i||this._options)}_setOptions(e){var i,s;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(i=aM.GetSupportedMimeTypes([],["h264"],!0))!==null&&i!==void 0?i:aM.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((s=this._options.mimeType)===null||s===void 0)&&s.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,i,s;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const a={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=a.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const h=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),d=(i=h.getVideoTracks())===null||i===void 0?void 0:i[0];this._track=d,this._recorder=new window.MediaRecorder(h,a),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(s=this._recorder)===null||s===void 0||s.start()):window.showDirectoryPicker&&window.showDirectoryPicker().then(async h=>{const d=await(h==null?void 0:h.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=d,this._state="recording",this._onstart({})}).catch(h=>{this._onerror({detail:h})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const i=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),i]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=Xs(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const i=await Promise.all(e.map(async([a,h])=>await(await fetch(h)).blob())),s=[];for(let a=0;a<e.length;a++){const h=await this._imgDirectory.getFileHandle(e[a][0],{create:!0});s.push(WB(h,i[a]))}await Promise.all(s)}static GetSupportedMimeTypes(e,i,s=!1){if(!window.MediaRecorder)return s?void 0:[];const a=["webm","ogg","mp4","x-matroska"].filter(_=>!e||e.length<1||e.includes(_)),h=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(_=>!i||i.length<1||i.includes(_)),d=[];return a.forEach(_=>{const et=`video/${_}`;h.forEach(nt=>{[`${et};codecs=${nt}`,`${et};codecs:${nt}`,`${et};codecs=${nt.toUpperCase()}`,`${et};codecs:${nt.toUpperCase()}`,`${et}`].forEach(it=>{MediaRecorder.isTypeSupported(it)&&d.push(it)})})}),s?d.length>0?d[0]:void 0:d}}var $D=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class $_ extends Ns{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,i,s;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const a=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0?void 0:s.isConverged())||!1,a&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,i,s;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Progressive"))===null||s===void 0)&&s.isConverged(!0))){const a=()=>{var h;return(h=this._recorder)===null||h===void 0?void 0:h.requestFrame()};this.convergeMode?Dl(1).then(a):a()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}}get recorder(){return this._recorder}isRecording(){var e,i;return(i=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&i!==void 0&&i}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new aM(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var i,s,a;this.dirty=e,(i=this._viewer)===null||i===void 0||i.setDirty(),(a=(s=this._uiConfig)===null||s===void 0?void 0:s.children)===null||a===void 0||a.map(h=>Yt(h)).flat(2).forEach(h=>{var d;return(d=h==null?void 0:h.uiRefresh)===null||d===void 0?void 0:d.call(h)})}async onRemove(e){var i;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),(i=this._recorder)===null||i===void 0||i.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((i,s)=>{var a;return(a=this.recorder)===null||a===void 0?void 0:a.stop(i)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(i=>({label:i[0],value:i[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var i,s;return(s=(i=e.recorder)===null||i===void 0?void 0:i.state)!==null&&s!==void 0?s:"not initialized"},set value(i){}},{type:"button",get label(){var i;return!((i=e.recorder)===null||i===void 0)&&i.isRecording()?"Stop":"Start"},value:()=>{var i;!((i=e.recorder)===null||i===void 0)&&i.isRecording()?this.stopRecording().then(s=>{if(s){console.log(s);const a=s.type.split(";")[0].split("/").pop()||"mp4";eu(s,"test."+a)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var i,s;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))},value:()=>{var i,s;(s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("CameraViews"))===null||s===void 0||s.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var i,s,a,h;return!!(!((i=e.recorder)===null||i===void 0)&&i.isRecording())||!(!((s=this._viewer)===null||s===void 0)&&s.getPluginByType("CameraViews"))||!(!((h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("GLTFAnimation"))===null||h===void 0)&&h.animations.length)},value:()=>{var i,s,a,h;const d=((s=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("GLTFAnimation"))===null||s===void 0?void 0:s.animationState)==="playing";(h=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("CameraViews"))===null||h===void 0||h.recordAllViews(()=>{var _,et;(et=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("GLTFAnimation"))===null||et===void 0||et.playAnimation()}).then(()=>{var _,et;d||(et=(_=this._viewer)===null||_===void 0?void 0:_.getPluginByType("GLTFAnimation"))===null||et===void 0||et.stopAnimation()})}}]}}}$_.PluginType="CanvasRecorder",$D([pn($_.prototype.refreshRecorderOptions),jn()],$_.prototype,"convergeMode",void 0),$D([pn($_.prototype.refreshRecorderOptions),jn()],$_.prototype,"mimeType",void 0),$D([pn($_.prototype.refreshRecorderOptions),jn()],$_.prototype,"videoFrameRate",void 0);var s2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const eP=new b.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});eP.depthTest=!1;const tP=new b.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});tP.depthTest=!1;class eA extends _d{constructor(e={},i=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new b.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=i,i&&this.dependencies.push(cv)}async onAdded(e){const i=e.renderer.createTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:b.wem,magFilter:b.wem});i.texture.name="groundContactDepthTexture";const s=new b.lRF({depthPacking:b.z81});s.onBeforeCompile=function(h){h.uniforms.opacity.value=1,h.fragmentShader=`
						${h.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const a=new zM(i,s);this._depthPass=a,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:b.ywz,format:b.wk1,encoding:b.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:b.wem,magFilter:b.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,i=1){this._viewer&&this._depthPass&&(eP.uniforms.h.value=i*this.blurAmount/256,tP.uniforms.v.value=i*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:eP,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:tP,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new b.Pa4)),this.shadowCamera.setRotationFromEuler(new b.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const i=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,i&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),i}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}eA.PluginType="ContactShadowGroundPlugin",s2([pn(eA.prototype.refreshOptions),jn()],eA.prototype,"contactShadows",void 0),s2([jn(),pn(eA.prototype._setDirty)],eA.prototype,"blurAmount",void 0),s2([jn(),pn(eA.prototype._refreshShadowCameraFrustum)],eA.prototype,"shadowScale",void 0),s2([jn(),pn(eA.prototype._refreshShadowCameraFrustum)],eA.prototype,"shadowHeight",void 0);const tS=new b.cPb(45,1,.1,1e3);function nP(c,e,i,s=7,a=new b.Pa4(0,0,1.5)){i=i??c.scene.modelObject;const h=new Dr().expandByObject(i??e,!0,!0),d=h.getCenter(new b.Pa4),_=h.getSize(new b.Pa4);tS.position.copy(d).add(a.clone().multiplyScalar(Math.max(_.x,_.y,_.z))),tS.lookAt(d),e&&e.traverseVisible(it=>{it.layers.enable(s)}),s>0?tS.layers.set(s):tS.layers.enableAll();const et=e==null?void 0:e.visible;e&&(e.visible=!0),c.renderer.rendererObject.setRenderTarget(null),c.renderer.rendererObject.render(i,tS);const nt=c.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=et,e.traverseVisible(it=>{it.layers.disable(s)}),tS.layers.enableAll()),c.setDirty(),nt}class iP{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new b.Kj0(new b.xo$(1)),cube:new b.Kj0(new b.DvJ(1,1,1)),cylinder:new b.Kj0(new b.fHI(.5,.5,1))};const i=new b.xsS;this._channel=7;const s=new b.vmT(16777215,4473924,1);s.position.set(0,10,0),s.layers.set(this._channel),i.add(s),this._lights.push(s),this._scene=i}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,i="sphere"){const s=this.shapes[i]||new b.Kj0(new b.xo$(1));s.material=e.materialObject,s.geometry.attributes.tangent||s.geometry.computeTangents(),this._scene.add(s),this._scene.environment=this.viewer.scene.getEnvironment();const a=s.material.envMapIntensity;typeof a=="number"&&(s.material.envMapIntensity=Math.max(a,2));const h=nP(this.viewer,s,this._scene,this._channel,new b.Pa4(0,0,1.5));return typeof a=="number"&&(s.material.envMapIntensity=a),this._scene.remove(s),s.material=void 0,h}}class o2 extends Ns{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e))},this.dependencies=[Yr],this.variations=[],this._selectedMaterial=()=>{var e,i;return((i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||i===void 0?void 0:i.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(Tw).filter(i=>i.endsWith("Map"))].map(i=>({label:i,value:i}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(i=>i.uiConfig?Object.assign(i.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(i.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const i=this.getSelectedVariation();i&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(i)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new iP(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,i){return this.variations=[],super.fromJSON(e,i)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(i=>i.uuid===e):void 0}getSelectedVariation(){var e,i;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((i=this._selectedMaterial())===null||i===void 0?void 0:i.name)}applyVariation(e,i){var s,a;const h=e.materials.find(d=>d.uuid===i);if(h){const d=(a=(s=this._viewer)===null||s===void 0?void 0:s.getManager())===null||a===void 0?void 0:a.materials;let _=d==null?void 0:d.findMaterialsByName(e.uuid);(!_||_.length<1)&&(_=[d==null?void 0:d.findMaterial(e.uuid)]),_.forEach(et=>{if(!et)return;const nt=et.name;et.copyProps(h),et.name=nt})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let i=this.findVariation(e.uuid);!i&&e.name.length>0&&(i=this.findVariation(e.name)),i&&this.removeVariation(i)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var i;const s=(i=e==null?void 0:e.clone)===null||i===void 0?void 0:i.call(e);if(e&&s){let a=this.findVariation(e.uuid);!a&&e.name.length>0&&(a=this.findVariation(e.name)),a||this.variations.push(a={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),a.materials.push(s),this.refreshUi()}}}o2.PluginType="MaterialConfiguratorBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([jn()],o2.prototype,"variations",void 0);const qB=(c,e=!0)=>{const i=new vo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},YB=(c,e=!0)=>{const i=new vo().set(c);return e&&i.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${i.getHexString()}'/%3E%3C/svg%3E%0A`},lM=c=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${c}%3C/text%3E%3C/svg%3E%0A`,rP=async(c,e)=>tu(await py(c),e),XB=async(c,e)=>await rP(c,e).then(i=>i.toDataURL("image/png"));class t_{static _initialize(){this._inited=!0,Dv(Wt`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,i,s,a,h,d,_){var et;this._inited||this._initialize();const nt=Mw(),it=nt?.15:.25,lt=nt?1.5:2.5,dt=No({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${i} </div>
            `});dt.style.top=h+"px",dt.style.left=a+"px",dt.style.gap=it+"rem",dt.style.width=(lt+it)*s-it+"rem",dt.dataset.tag=e;for(const pt of d){const gt=No({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${pt.image}" class="customContextGridItemImage">
            `});gt.style.width=lt+"rem",gt.style.height=lt+"rem",dt.appendChild(gt),gt.onclick=()=>{var vt;return(vt=pt.onClick)===null||vt===void 0?void 0:vt.call(pt,pt.id)},_(gt,pt)}return(et=this.Elements)===null||et===void 0||et.push(dt),dt}static RemoveAll(e){if(e){const i=this.Elements.filter(s=>s.dataset.tag===e);for(const s of i)s.remove();this.Elements=this.Elements.filter(s=>s.dataset.tag!==e)}else{for(const i of this.Elements)i.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const s of this.Elements)s.remove();let i=20;for(const s of this.Elements)s.style.top=i+"px",e.appendChild(s),i+=s.clientHeight+20}}function n_(c){if(c==null)return window;if(c.toString()!=="[object Window]"){var e=c.ownerDocument;return e&&e.defaultView||window}return c}function nS(c){return c instanceof n_(c).Element||c instanceof Element}function r0(c){return c instanceof n_(c).HTMLElement||c instanceof HTMLElement}function sP(c){return typeof ShadowRoot<"u"&&(c instanceof n_(c).ShadowRoot||c instanceof ShadowRoot)}t_.Elements=[],t_._inited=!1;var i1=Math.max,a2=Math.min,iS=Math.round;function rS(c,e){e===void 0&&(e=!1);var i=c.getBoundingClientRect(),s=1,a=1;if(r0(c)&&e){var h=c.offsetHeight,d=c.offsetWidth;d>0&&(s=iS(i.width)/d||1),h>0&&(a=iS(i.height)/h||1)}return{width:i.width/s,height:i.height/a,top:i.top/a,right:i.right/s,bottom:i.bottom/a,left:i.left/s,x:i.left/s,y:i.top/a}}function oP(c){var e=n_(c);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function tA(c){return c?(c.nodeName||"").toLowerCase():null}function mw(c){return((nS(c)?c.ownerDocument:c.document)||window.document).documentElement}function aP(c){return rS(mw(c)).left+oP(c).scrollLeft}function $A(c){return n_(c).getComputedStyle(c)}function lP(c){var e=$A(c),i=e.overflow,s=e.overflowX,a=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+a+s)}function cN(c,e,i){i===void 0&&(i=!1);var s,a,h=r0(e),d=r0(e)&&function(lt){var dt=lt.getBoundingClientRect(),pt=iS(dt.width)/lt.offsetWidth||1,gt=iS(dt.height)/lt.offsetHeight||1;return pt!==1||gt!==1}(e),_=mw(e),et=rS(c,d),nt={scrollLeft:0,scrollTop:0},it={x:0,y:0};return(h||!h&&!i)&&((tA(e)!=="body"||lP(_))&&(nt=(s=e)!==n_(s)&&r0(s)?{scrollLeft:(a=s).scrollLeft,scrollTop:a.scrollTop}:oP(s)),r0(e)?((it=rS(e,!0)).x+=e.clientLeft,it.y+=e.clientTop):_&&(it.x=aP(_))),{x:et.left+nt.scrollLeft-it.x,y:et.top+nt.scrollTop-it.y,width:et.width,height:et.height}}function cP(c){var e=rS(c),i=c.offsetWidth,s=c.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:c.offsetLeft,y:c.offsetTop,width:i,height:s}}function l2(c){return tA(c)==="html"?c:c.assignedSlot||c.parentNode||(sP(c)?c.host:null)||mw(c)}function KB(c){return["html","body","#document"].indexOf(tA(c))>=0?c.ownerDocument.body:r0(c)&&lP(c)?c:KB(l2(c))}function cM(c,e){var i;e===void 0&&(e=[]);var s=KB(c),a=s===((i=c.ownerDocument)==null?void 0:i.body),h=n_(s),d=a?[h].concat(h.visualViewport||[],lP(s)?s:[]):s,_=e.concat(d);return a?_:_.concat(cM(l2(d)))}function uN(c){return["table","td","th"].indexOf(tA(c))>=0}function JB(c){return r0(c)&&$A(c).position!=="fixed"?c.offsetParent:null}function uM(c){for(var e=n_(c),i=JB(c);i&&uN(i)&&$A(i).position==="static";)i=JB(i);return i&&(tA(i)==="html"||tA(i)==="body"&&$A(i).position==="static")?e:i||function(s){var a=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&r0(s)&&$A(s).position==="fixed")return null;var h=l2(s);for(sP(h)&&(h=h.host);r0(h)&&["html","body"].indexOf(tA(h))<0;){var d=$A(h);if(d.transform!=="none"||d.perspective!=="none"||d.contain==="paint"||["transform","perspective"].indexOf(d.willChange)!==-1||a&&d.willChange==="filter"||a&&d.filter&&d.filter!=="none")return h;h=h.parentNode}return null}(c)||e}var dm="top",vv="bottom",_v="right",pm="left",c2="auto",sS=[dm,vv,_v,pm],r1="start",oS="end",ZB="clippingParents",uP="viewport",aS="popper",$B="reference",hP=sS.reduce(function(c,e){return c.concat([e+"-"+r1,e+"-"+oS])},[]),dP=[].concat(sS,[c2]).reduce(function(c,e){return c.concat([e,e+"-"+r1,e+"-"+oS])},[]),_k="beforeRead",e3="read",t3="afterRead",n3="beforeMain",i3="main",r3="afterMain",s3="beforeWrite",o3="write",a3="afterWrite",l3=[_k,e3,t3,n3,i3,r3,s3,o3,a3];function hN(c){var e=new Map,i=new Set,s=[];function a(h){i.add(h.name),[].concat(h.requires||[],h.requiresIfExists||[]).forEach(function(d){if(!i.has(d)){var _=e.get(d);_&&a(_)}}),s.push(h)}return c.forEach(function(h){e.set(h.name,h)}),c.forEach(function(h){i.has(h.name)||a(h)}),s}var c3={placement:"bottom",modifiers:[],strategy:"absolute"};function u3(){for(var c=arguments.length,e=new Array(c),i=0;i<c;i++)e[i]=arguments[i];return!e.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function u2(c){c===void 0&&(c={});var e=c,i=e.defaultModifiers,s=i===void 0?[]:i,a=e.defaultOptions,h=a===void 0?c3:a;return function(d,_,et){et===void 0&&(et=h);var nt,it,lt={placement:"bottom",orderedModifiers:[],options:Object.assign({},c3,h),modifiersData:{},elements:{reference:d,popper:_},attributes:{},styles:{}},dt=[],pt=!1,gt={state:lt,setOptions:function(Ct){var wt=typeof Ct=="function"?Ct(lt.options):Ct;vt(),lt.options=Object.assign({},h,lt.options,wt),lt.scrollParents={reference:nS(d)?cM(d):d.contextElement?cM(d.contextElement):[],popper:cM(_)};var xt,_t,Pt=function(Rt){var Lt=hN(Rt);return l3.reduce(function(Ot,qt){return Ot.concat(Lt.filter(function(en){return en.phase===qt}))},[])}((xt=[].concat(s,lt.options.modifiers),_t=xt.reduce(function(Rt,Lt){var Ot=Rt[Lt.name];return Rt[Lt.name]=Ot?Object.assign({},Ot,Lt,{options:Object.assign({},Ot.options,Lt.options),data:Object.assign({},Ot.data,Lt.data)}):Lt,Rt},{}),Object.keys(_t).map(function(Rt){return _t[Rt]})));return lt.orderedModifiers=Pt.filter(function(Rt){return Rt.enabled}),lt.orderedModifiers.forEach(function(Rt){var Lt=Rt.name,Ot=Rt.options,qt=Ot===void 0?{}:Ot,en=Rt.effect;if(typeof en=="function"){var cn=en({state:lt,name:Lt,instance:gt,options:qt});dt.push(cn||function(){})}}),gt.update()},forceUpdate:function(){if(!pt){var Ct=lt.elements,wt=Ct.reference,xt=Ct.popper;if(u3(wt,xt)){lt.rects={reference:cN(wt,uM(xt),lt.options.strategy==="fixed"),popper:cP(xt)},lt.reset=!1,lt.placement=lt.options.placement,lt.orderedModifiers.forEach(function(en){return lt.modifiersData[en.name]=Object.assign({},en.data)});for(var _t=0;_t<lt.orderedModifiers.length;_t++)if(lt.reset!==!0){var Pt=lt.orderedModifiers[_t],Rt=Pt.fn,Lt=Pt.options,Ot=Lt===void 0?{}:Lt,qt=Pt.name;typeof Rt=="function"&&(lt=Rt({state:lt,options:Ot,name:qt,instance:gt})||lt)}else lt.reset=!1,_t=-1}}},update:(nt=function(){return new Promise(function(Ct){gt.forceUpdate(),Ct(lt)})},function(){return it||(it=new Promise(function(Ct){Promise.resolve().then(function(){it=void 0,Ct(nt())})})),it}),destroy:function(){vt(),pt=!0}};if(!u3(d,_))return gt;function vt(){dt.forEach(function(Ct){return Ct()}),dt=[]}return gt.setOptions(et).then(function(Ct){!pt&&et.onFirstUpdate&&et.onFirstUpdate(Ct)}),gt}}var dN=u2(),h2={passive:!0},pP={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(c){var e=c.state,i=c.instance,s=c.options,a=s.scroll,h=a===void 0||a,d=s.resize,_=d===void 0||d,et=n_(e.elements.popper),nt=[].concat(e.scrollParents.reference,e.scrollParents.popper);return h&&nt.forEach(function(it){it.addEventListener("scroll",i.update,h2)}),_&&et.addEventListener("resize",i.update,h2),function(){h&&nt.forEach(function(it){it.removeEventListener("scroll",i.update,h2)}),_&&et.removeEventListener("resize",i.update,h2)}},data:{}};function nA(c){return c.split("-")[0]}function lS(c){return c.split("-")[1]}function fP(c){return["top","bottom"].indexOf(c)>=0?"x":"y"}function h3(c){var e,i=c.reference,s=c.element,a=c.placement,h=a?nA(a):null,d=a?lS(a):null,_=i.x+i.width/2-s.width/2,et=i.y+i.height/2-s.height/2;switch(h){case dm:e={x:_,y:i.y-s.height};break;case vv:e={x:_,y:i.y+i.height};break;case _v:e={x:i.x+i.width,y:et};break;case pm:e={x:i.x-s.width,y:et};break;default:e={x:i.x,y:i.y}}var nt=h?fP(h):null;if(nt!=null){var it=nt==="y"?"height":"width";switch(d){case r1:e[nt]=e[nt]-(i[it]/2-s[it]/2);break;case oS:e[nt]=e[nt]+(i[it]/2-s[it]/2)}}return e}var mP={name:"popperOffsets",enabled:!0,phase:"read",fn:function(c){var e=c.state,i=c.name;e.modifiersData[i]=h3({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},pN={top:"auto",right:"auto",bottom:"auto",left:"auto"};function d3(c){var e,i=c.popper,s=c.popperRect,a=c.placement,h=c.variation,d=c.offsets,_=c.position,et=c.gpuAcceleration,nt=c.adaptive,it=c.roundOffsets,lt=c.isFixed,dt=d.x,pt=dt===void 0?0:dt,gt=d.y,vt=gt===void 0?0:gt,Ct=typeof it=="function"?it({x:pt,y:vt}):{x:pt,y:vt};pt=Ct.x,vt=Ct.y;var wt=d.hasOwnProperty("x"),xt=d.hasOwnProperty("y"),_t=pm,Pt=dm,Rt=window;if(nt){var Lt=uM(i),Ot="clientHeight",qt="clientWidth";Lt===n_(i)&&$A(Lt=mw(i)).position!=="static"&&_==="absolute"&&(Ot="scrollHeight",qt="scrollWidth"),(a===dm||(a===pm||a===_v)&&h===oS)&&(Pt=vv,vt-=(lt&&Lt===Rt&&Rt.visualViewport?Rt.visualViewport.height:Lt[Ot])-s.height,vt*=et?1:-1),a!==pm&&(a!==dm&&a!==vv||h!==oS)||(_t=_v,pt-=(lt&&Lt===Rt&&Rt.visualViewport?Rt.visualViewport.width:Lt[qt])-s.width,pt*=et?1:-1)}var en,cn=Object.assign({position:_},nt&&pN),An=it===!0?function(fn){var Tn=fn.x,gn=fn.y,xn=window.devicePixelRatio||1;return{x:iS(Tn*xn)/xn||0,y:iS(gn*xn)/xn||0}}({x:pt,y:vt}):{x:pt,y:vt};return pt=An.x,vt=An.y,et?Object.assign({},cn,((en={})[Pt]=xt?"0":"",en[_t]=wt?"0":"",en.transform=(Rt.devicePixelRatio||1)<=1?"translate("+pt+"px, "+vt+"px)":"translate3d("+pt+"px, "+vt+"px, 0)",en)):Object.assign({},cn,((e={})[Pt]=xt?vt+"px":"",e[_t]=wt?pt+"px":"",e.transform="",e))}var gP={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(c){var e=c.state,i=c.options,s=i.gpuAcceleration,a=s===void 0||s,h=i.adaptive,d=h===void 0||h,_=i.roundOffsets,et=_===void 0||_,nt={placement:nA(e.placement),variation:lS(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:a,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,d3(Object.assign({},nt,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:d,roundOffsets:et})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,d3(Object.assign({},nt,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:et})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},d2={name:"applyStyles",enabled:!0,phase:"write",fn:function(c){var e=c.state;Object.keys(e.elements).forEach(function(i){var s=e.styles[i]||{},a=e.attributes[i]||{},h=e.elements[i];r0(h)&&tA(h)&&(Object.assign(h.style,s),Object.keys(a).forEach(function(d){var _=a[d];_===!1?h.removeAttribute(d):h.setAttribute(d,_===!0?"":_)}))})},effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(s){var a=e.elements[s],h=e.attributes[s]||{},d=Object.keys(e.styles.hasOwnProperty(s)?e.styles[s]:i[s]).reduce(function(_,et){return _[et]="",_},{});r0(a)&&tA(a)&&(Object.assign(a.style,d),Object.keys(h).forEach(function(_){a.removeAttribute(_)}))})}},requires:["computeStyles"]},p3={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.offset,h=a===void 0?[0,0]:a,d=dP.reduce(function(it,lt){return it[lt]=function(dt,pt,gt){var vt=nA(dt),Ct=[pm,dm].indexOf(vt)>=0?-1:1,wt=typeof gt=="function"?gt(Object.assign({},pt,{placement:dt})):gt,xt=wt[0],_t=wt[1];return xt=xt||0,_t=(_t||0)*Ct,[pm,_v].indexOf(vt)>=0?{x:_t,y:xt}:{x:xt,y:_t}}(lt,e.rects,h),it},{}),_=d[e.placement],et=_.x,nt=_.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=et,e.modifiersData.popperOffsets.y+=nt),e.modifiersData[s]=d}},fN={left:"right",right:"left",bottom:"top",top:"bottom"};function p2(c){return c.replace(/left|right|bottom|top/g,function(e){return fN[e]})}var mN={start:"end",end:"start"};function f3(c){return c.replace(/start|end/g,function(e){return mN[e]})}function m3(c,e){var i=e.getRootNode&&e.getRootNode();if(c.contains(e))return!0;if(i&&sP(i)){var s=e;do{if(s&&c.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function vP(c){return Object.assign({},c,{left:c.x,top:c.y,right:c.x+c.width,bottom:c.y+c.height})}function g3(c,e){return e===uP?vP(function(i){var s=n_(i),a=mw(i),h=s.visualViewport,d=a.clientWidth,_=a.clientHeight,et=0,nt=0;return h&&(d=h.width,_=h.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(et=h.offsetLeft,nt=h.offsetTop)),{width:d,height:_,x:et+aP(i),y:nt}}(c)):nS(e)?function(i){var s=rS(i);return s.top=s.top+i.clientTop,s.left=s.left+i.clientLeft,s.bottom=s.top+i.clientHeight,s.right=s.left+i.clientWidth,s.width=i.clientWidth,s.height=i.clientHeight,s.x=s.left,s.y=s.top,s}(e):vP(function(i){var s,a=mw(i),h=oP(i),d=(s=i.ownerDocument)==null?void 0:s.body,_=i1(a.scrollWidth,a.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),et=i1(a.scrollHeight,a.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),nt=-h.scrollLeft+aP(i),it=-h.scrollTop;return $A(d||a).direction==="rtl"&&(nt+=i1(a.clientWidth,d?d.clientWidth:0)-_),{width:_,height:et,x:nt,y:it}}(mw(c)))}function v3(c){return Object.assign({},{top:0,right:0,bottom:0,left:0},c)}function _3(c,e){return e.reduce(function(i,s){return i[s]=c,i},{})}function cS(c,e){e===void 0&&(e={});var i=e,s=i.placement,a=s===void 0?c.placement:s,h=i.boundary,d=h===void 0?ZB:h,_=i.rootBoundary,et=_===void 0?uP:_,nt=i.elementContext,it=nt===void 0?aS:nt,lt=i.altBoundary,dt=lt!==void 0&&lt,pt=i.padding,gt=pt===void 0?0:pt,vt=v3(typeof gt!="number"?gt:_3(gt,sS)),Ct=it===aS?$B:aS,wt=c.rects.popper,xt=c.elements[dt?Ct:it],_t=function(An,fn,Tn){var gn=fn==="clippingParents"?function(Hn){var rr=cM(l2(Hn)),cr=["absolute","fixed"].indexOf($A(Hn).position)>=0&&r0(Hn)?uM(Hn):Hn;return nS(cr)?rr.filter(function(_i){return nS(_i)&&m3(_i,cr)&&tA(_i)!=="body"}):[]}(An):[].concat(fn),xn=[].concat(gn,[Tn]),Nn=xn[0],Mn=xn.reduce(function(Hn,rr){var cr=g3(An,rr);return Hn.top=i1(cr.top,Hn.top),Hn.right=a2(cr.right,Hn.right),Hn.bottom=a2(cr.bottom,Hn.bottom),Hn.left=i1(cr.left,Hn.left),Hn},g3(An,Nn));return Mn.width=Mn.right-Mn.left,Mn.height=Mn.bottom-Mn.top,Mn.x=Mn.left,Mn.y=Mn.top,Mn}(nS(xt)?xt:xt.contextElement||mw(c.elements.popper),d,et),Pt=rS(c.elements.reference),Rt=h3({reference:Pt,element:wt,strategy:"absolute",placement:a}),Lt=vP(Object.assign({},wt,Rt)),Ot=it===aS?Lt:Pt,qt={top:_t.top-Ot.top+vt.top,bottom:Ot.bottom-_t.bottom+vt.bottom,left:_t.left-Ot.left+vt.left,right:Ot.right-_t.right+vt.right},en=c.modifiersData.offset;if(it===aS&&en){var cn=en[a];Object.keys(qt).forEach(function(An){var fn=[_v,vv].indexOf(An)>=0?1:-1,Tn=[dm,vv].indexOf(An)>=0?"y":"x";qt[An]+=cn[Tn]*fn})}return qt}var A3={name:"flip",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name;if(!e.modifiersData[s]._skip){for(var a=i.mainAxis,h=a===void 0||a,d=i.altAxis,_=d===void 0||d,et=i.fallbackPlacements,nt=i.padding,it=i.boundary,lt=i.rootBoundary,dt=i.altBoundary,pt=i.flipVariations,gt=pt===void 0||pt,vt=i.allowedAutoPlacements,Ct=e.options.placement,wt=nA(Ct),xt=et||(wt!==Ct&&gt?function(_i){if(nA(_i)===c2)return[];var xr=p2(_i);return[f3(_i),xr,f3(xr)]}(Ct):[p2(Ct)]),_t=[Ct].concat(xt).reduce(function(_i,xr){return _i.concat(nA(xr)===c2?function(Mr,Tr){Tr===void 0&&(Tr={});var Lr=Tr,os=Lr.placement,pr=Lr.boundary,Bs=Lr.rootBoundary,Ws=Lr.padding,ks=Lr.flipVariations,uo=Lr.allowedAutoPlacements,Mo=uo===void 0?dP:uo,or=lS(os),Rr=or?ks?hP:hP.filter(function(So){return lS(So)===or}):sS,Br=Rr.filter(function(So){return Mo.indexOf(So)>=0});Br.length===0&&(Br=Rr);var Ls=Br.reduce(function(So,nn){return So[nn]=cS(Mr,{placement:nn,boundary:pr,rootBoundary:Bs,padding:Ws})[nA(nn)],So},{});return Object.keys(Ls).sort(function(So,nn){return Ls[So]-Ls[nn]})}(e,{placement:xr,boundary:it,rootBoundary:lt,padding:nt,flipVariations:gt,allowedAutoPlacements:vt}):xr)},[]),Pt=e.rects.reference,Rt=e.rects.popper,Lt=new Map,Ot=!0,qt=_t[0],en=0;en<_t.length;en++){var cn=_t[en],An=nA(cn),fn=lS(cn)===r1,Tn=[dm,vv].indexOf(An)>=0,gn=Tn?"width":"height",xn=cS(e,{placement:cn,boundary:it,rootBoundary:lt,altBoundary:dt,padding:nt}),Nn=Tn?fn?_v:pm:fn?vv:dm;Pt[gn]>Rt[gn]&&(Nn=p2(Nn));var Mn=p2(Nn),Hn=[];if(h&&Hn.push(xn[An]<=0),_&&Hn.push(xn[Nn]<=0,xn[Mn]<=0),Hn.every(function(_i){return _i})){qt=cn,Ot=!1;break}Lt.set(cn,Hn)}if(Ot)for(var rr=function(_i){var xr=_t.find(function(Mr){var Tr=Lt.get(Mr);if(Tr)return Tr.slice(0,_i).every(function(Lr){return Lr})});if(xr)return qt=xr,"break"},cr=gt?3:1;cr>0&&rr(cr)!=="break";cr--);e.placement!==qt&&(e.modifiersData[s]._skip=!0,e.placement=qt,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function hM(c,e,i){return i1(c,a2(e,i))}var y3={name:"preventOverflow",enabled:!0,phase:"main",fn:function(c){var e=c.state,i=c.options,s=c.name,a=i.mainAxis,h=a===void 0||a,d=i.altAxis,_=d!==void 0&&d,et=i.boundary,nt=i.rootBoundary,it=i.altBoundary,lt=i.padding,dt=i.tether,pt=dt===void 0||dt,gt=i.tetherOffset,vt=gt===void 0?0:gt,Ct=cS(e,{boundary:et,rootBoundary:nt,padding:lt,altBoundary:it}),wt=nA(e.placement),xt=lS(e.placement),_t=!xt,Pt=fP(wt),Rt=Pt==="x"?"y":"x",Lt=e.modifiersData.popperOffsets,Ot=e.rects.reference,qt=e.rects.popper,en=typeof vt=="function"?vt(Object.assign({},e.rects,{placement:e.placement})):vt,cn=typeof en=="number"?{mainAxis:en,altAxis:en}:Object.assign({mainAxis:0,altAxis:0},en),An=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,fn={x:0,y:0};if(Lt){if(h){var Tn,gn=Pt==="y"?dm:pm,xn=Pt==="y"?vv:_v,Nn=Pt==="y"?"height":"width",Mn=Lt[Pt],Hn=Mn+Ct[gn],rr=Mn-Ct[xn],cr=pt?-qt[Nn]/2:0,_i=xt===r1?Ot[Nn]:qt[Nn],xr=xt===r1?-qt[Nn]:-Ot[Nn],Mr=e.elements.arrow,Tr=pt&&Mr?cP(Mr):{width:0,height:0},Lr=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},os=Lr[gn],pr=Lr[xn],Bs=hM(0,Ot[Nn],Tr[Nn]),Ws=_t?Ot[Nn]/2-cr-Bs-os-cn.mainAxis:_i-Bs-os-cn.mainAxis,ks=_t?-Ot[Nn]/2+cr+Bs+pr+cn.mainAxis:xr+Bs+pr+cn.mainAxis,uo=e.elements.arrow&&uM(e.elements.arrow),Mo=uo?Pt==="y"?uo.clientTop||0:uo.clientLeft||0:0,or=(Tn=An==null?void 0:An[Pt])!=null?Tn:0,Rr=Mn+ks-or,Br=hM(pt?a2(Hn,Mn+Ws-or-Mo):Hn,Mn,pt?i1(rr,Rr):rr);Lt[Pt]=Br,fn[Pt]=Br-Mn}if(_){var Ls,So=Pt==="x"?dm:pm,nn=Pt==="x"?vv:_v,On=Lt[Rt],on=Rt==="y"?"height":"width",Qn=On+Ct[So],Jn=On-Ct[nn],Vn=[dm,pm].indexOf(wt)!==-1,sr=(Ls=An==null?void 0:An[Rt])!=null?Ls:0,Fr=Vn?Qn:On-Ot[on]-qt[on]-sr+cn.altAxis,Jr=Vn?On+Ot[on]+qt[on]-sr-cn.altAxis:Jn,rs=pt&&Vn?function(is,as,es){var Zr=hM(is,as,es);return Zr>es?es:Zr}(Fr,On,Jr):hM(pt?Fr:Qn,On,pt?Jr:Jn);Lt[Rt]=rs,fn[Rt]=rs-On}e.modifiersData[s]=fn}},requiresIfExists:["offset"]},w3={name:"arrow",enabled:!0,phase:"main",fn:function(c){var e,i=c.state,s=c.name,a=c.options,h=i.elements.arrow,d=i.modifiersData.popperOffsets,_=nA(i.placement),et=fP(_),nt=[pm,_v].indexOf(_)>=0?"height":"width";if(h&&d){var it=function(qt,en){return v3(typeof(qt=typeof qt=="function"?qt(Object.assign({},en.rects,{placement:en.placement})):qt)!="number"?qt:_3(qt,sS))}(a.padding,i),lt=cP(h),dt=et==="y"?dm:pm,pt=et==="y"?vv:_v,gt=i.rects.reference[nt]+i.rects.reference[et]-d[et]-i.rects.popper[nt],vt=d[et]-i.rects.reference[et],Ct=uM(h),wt=Ct?et==="y"?Ct.clientHeight||0:Ct.clientWidth||0:0,xt=gt/2-vt/2,_t=it[dt],Pt=wt-lt[nt]-it[pt],Rt=wt/2-lt[nt]/2+xt,Lt=hM(_t,Rt,Pt),Ot=et;i.modifiersData[s]=((e={})[Ot]=Lt,e.centerOffset=Lt-Rt,e)}},effect:function(c){var e=c.state,i=c.options.element,s=i===void 0?"[data-popper-arrow]":i;s!=null&&(typeof s!="string"||(s=e.elements.popper.querySelector(s)))&&m3(e.elements.popper,s)&&(e.elements.arrow=s)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function x3(c,e,i){return i===void 0&&(i={x:0,y:0}),{top:c.top-e.height-i.y,right:c.right-e.width+i.x,bottom:c.bottom-e.height+i.y,left:c.left-e.width-i.x}}function b3(c){return[dm,_v,vv,pm].some(function(e){return c[e]>=0})}var E3={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(c){var e=c.state,i=c.name,s=e.rects.reference,a=e.rects.popper,h=e.modifiersData.preventOverflow,d=cS(e,{elementContext:"reference"}),_=cS(e,{altBoundary:!0}),et=x3(d,s),nt=x3(_,a,h),it=b3(et),lt=b3(nt);e.modifiersData[i]={referenceClippingOffsets:et,popperEscapeOffsets:nt,isReferenceHidden:it,hasPopperEscaped:lt},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":it,"data-popper-escaped":lt})}},S3=u2({defaultModifiers:[pP,mP,gP,d2,p3,A3,y3,w3,E3]}),C3="tippy-content",M3="tippy-arrow",T3="tippy-svg-arrow",s1={passive:!0,capture:!0},I3=function(){return document.body};function _P(c,e,i){if(Array.isArray(c)){var s=c[e];return s??(Array.isArray(i)?i[e]:i)}return c}function AP(c,e){var i={}.toString.call(c);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function D3(c,e){return typeof c=="function"?c.apply(void 0,e):c}function P3(c,e){return e===0?c:function(s){clearTimeout(i),i=setTimeout(function(){c(s)},e)};var i}function uS(c){return[].concat(c)}function R3(c,e){c.indexOf(e)===-1&&c.push(e)}function f2(c){return[].slice.call(c)}function B3(c){return Object.keys(c).reduce(function(e,i){return c[i]!==void 0&&(e[i]=c[i]),e},{})}function dM(){return document.createElement("div")}function m2(c){return["Element","Fragment"].some(function(e){return AP(c,e)})}function yP(c,e){c.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function k3(c,e){c.forEach(function(i){i&&i.setAttribute("data-state",e)})}function wP(c,e,i){var s=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(a){c[s](a,i)})}function L3(c,e){for(var i=e;i;){var s;if(c.contains(i))return!0;i=i.getRootNode==null||(s=i.getRootNode())==null?void 0:s.host}return!1}var iA={isTouch:!1},O3=0;function gN(){iA.isTouch||(iA.isTouch=!0,window.performance&&document.addEventListener("mousemove",N3))}function N3(){var c=performance.now();c-O3<20&&(iA.isTouch=!1,document.removeEventListener("mousemove",N3)),O3=c}function vN(){var c,e=document.activeElement;if((c=e)&&c._tippy&&c._tippy.reference===c){var i=e._tippy;e.blur&&!i.state.isVisible&&e.blur()}}var _N=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),i_=Object.assign({appendTo:I3,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),AN=Object.keys(i_);function U3(c){var e=(c.plugins||[]).reduce(function(i,s){var a,h=s.name,d=s.defaultValue;return h&&(i[h]=c[h]!==void 0?c[h]:(a=i_[h])!=null?a:d),i},{});return Object.assign({},c,e)}function F3(c,e){var i=Object.assign({},e,{content:D3(e.content,[c])},e.ignoreAttributes?{}:function(s,a){return(a?Object.keys(U3(Object.assign({},i_,{plugins:a}))):AN).reduce(function(h,d){var _=(s.getAttribute("data-tippy-"+d)||"").trim();if(!_)return h;if(d==="content")h[d]=_;else try{h[d]=JSON.parse(_)}catch{h[d]=_}return h},{})}(c,e.plugins));return i.aria=Object.assign({},i_.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}function xP(c,e){c.innerHTML=e}function j3(c){var e=dM();return c===!0?e.className=M3:(e.className=T3,m2(c)?e.appendChild(c):xP(e,c)),e}function z3(c,e){m2(e.content)?(xP(c,""),c.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?xP(c,e.content):c.textContent=e.content)}function bP(c){var e=c.firstElementChild,i=f2(e.children);return{box:e,content:i.find(function(s){return s.classList.contains(C3)}),arrow:i.find(function(s){return s.classList.contains(M3)||s.classList.contains(T3)}),backdrop:i.find(function(s){return s.classList.contains("tippy-backdrop")})}}function V3(c){var e=dM(),i=dM();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var s=dM();function a(h,d){var _=bP(e),et=_.box,nt=_.content,it=_.arrow;d.theme?et.setAttribute("data-theme",d.theme):et.removeAttribute("data-theme"),typeof d.animation=="string"?et.setAttribute("data-animation",d.animation):et.removeAttribute("data-animation"),d.inertia?et.setAttribute("data-inertia",""):et.removeAttribute("data-inertia"),et.style.maxWidth=typeof d.maxWidth=="number"?d.maxWidth+"px":d.maxWidth,d.role?et.setAttribute("role",d.role):et.removeAttribute("role"),h.content===d.content&&h.allowHTML===d.allowHTML||z3(nt,c.props),d.arrow?it?h.arrow!==d.arrow&&(et.removeChild(it),et.appendChild(j3(d.arrow))):et.appendChild(j3(d.arrow)):it&&et.removeChild(it)}return s.className=C3,s.setAttribute("data-state","hidden"),z3(s,c.props),e.appendChild(i),i.appendChild(s),a(c.props,c.props),{popper:e,onUpdate:a}}V3.$$tippy=!0;var yN=1,g2=[],EP=[];function wN(c,e){var i,s,a,h,d,_,et,nt,it=F3(c,Object.assign({},i_,U3(B3(e)))),lt=!1,dt=!1,pt=!1,gt=!1,vt=[],Ct=P3(uo,it.interactiveDebounce),wt=yN++,xt=(nt=it.plugins).filter(function(on,Qn){return nt.indexOf(on)===Qn}),_t={id:wt,reference:c,popper:dM(),popperInstance:null,props:it,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:xt,clearDelayTimeouts:function(){clearTimeout(i),clearTimeout(s),cancelAnimationFrame(a)},setProps:function(on){if(!_t.state.isDestroyed){Mn("onBeforeUpdate",[_t,on]),Ws();var Qn=_t.props,Jn=F3(c,Object.assign({},Qn,B3(on),{ignoreAttributes:!0}));_t.props=Jn,Bs(),Qn.interactiveDebounce!==Jn.interactiveDebounce&&(cr(),Ct=P3(uo,Jn.interactiveDebounce)),Qn.triggerTarget&&!Jn.triggerTarget?uS(Qn.triggerTarget).forEach(function(Vn){Vn.removeAttribute("aria-expanded")}):Jn.triggerTarget&&c.removeAttribute("aria-expanded"),rr(),Nn(),Lt&&Lt(Qn,Jn),_t.popperInstance&&(Br(),So().forEach(function(Vn){requestAnimationFrame(Vn._tippy.popperInstance.forceUpdate)})),Mn("onAfterUpdate",[_t,on])}},setContent:function(on){_t.setProps({content:on})},show:function(){var on=_t.state.isVisible,Qn=_t.state.isDestroyed,Jn=!_t.state.isEnabled,Vn=iA.isTouch&&!_t.props.touch,sr=_P(_t.props.duration,0,i_.duration);if(!(on||Qn||Jn||Vn||fn().hasAttribute("disabled")||(Mn("onShow",[_t],!1),_t.props.onShow(_t)===!1))){if(_t.state.isVisible=!0,An()&&(Rt.style.visibility="visible"),Nn(),Tr(),_t.state.isMounted||(Rt.style.transition="none"),An()){var Fr=gn();yP([Fr.box,Fr.content],0)}var Jr,rs,is;_=function(){var as;if(_t.state.isVisible&&!gt){if(gt=!0,Rt.offsetHeight,Rt.style.transition=_t.props.moveTransition,An()&&_t.props.animation){var es=gn(),Zr=es.box,ms=es.content;yP([Zr,ms],sr),k3([Zr,ms],"visible")}Hn(),rr(),R3(EP,_t),(as=_t.popperInstance)==null||as.forceUpdate(),Mn("onMount",[_t]),_t.props.animation&&An()&&function(Wr,_s){os(Wr,function(){_t.state.isShown=!0,Mn("onShown",[_t])})}(sr)}},rs=_t.props.appendTo,is=fn(),(Jr=_t.props.interactive&&rs===I3||rs==="parent"?is.parentNode:D3(rs,[is])).contains(Rt)||Jr.appendChild(Rt),_t.state.isMounted=!0,Br()}},hide:function(){var on=!_t.state.isVisible,Qn=_t.state.isDestroyed,Jn=!_t.state.isEnabled,Vn=_P(_t.props.duration,1,i_.duration);if(!(on||Qn||Jn)&&(Mn("onHide",[_t],!1),_t.props.onHide(_t)!==!1)){if(_t.state.isVisible=!1,_t.state.isShown=!1,gt=!1,lt=!1,An()&&(Rt.style.visibility="hidden"),cr(),Lr(),Nn(!0),An()){var sr=gn(),Fr=sr.box,Jr=sr.content;_t.props.animation&&(yP([Fr,Jr],Vn),k3([Fr,Jr],"hidden"))}Hn(),rr(),_t.props.animation?An()&&function(rs,is){os(rs,function(){!_t.state.isVisible&&Rt.parentNode&&Rt.parentNode.contains(Rt)&&is()})}(Vn,_t.unmount):_t.unmount()}},hideWithInteractivity:function(on){Tn().addEventListener("mousemove",Ct),R3(g2,Ct),Ct(on)},enable:function(){_t.state.isEnabled=!0},disable:function(){_t.hide(),_t.state.isEnabled=!1},unmount:function(){_t.state.isVisible&&_t.hide(),_t.state.isMounted&&(Ls(),So().forEach(function(on){on._tippy.unmount()}),Rt.parentNode&&Rt.parentNode.removeChild(Rt),EP=EP.filter(function(on){return on!==_t}),_t.state.isMounted=!1,Mn("onHidden",[_t]))},destroy:function(){_t.state.isDestroyed||(_t.clearDelayTimeouts(),_t.unmount(),Ws(),delete c._tippy,_t.state.isDestroyed=!0,Mn("onDestroy",[_t]))}};if(!it.render)return _t;var Pt=it.render(_t),Rt=Pt.popper,Lt=Pt.onUpdate;Rt.setAttribute("data-tippy-root",""),Rt.id="tippy-"+_t.id,_t.popper=Rt,c._tippy=_t,Rt._tippy=_t;var Ot=xt.map(function(on){return on.fn(_t)}),qt=c.hasAttribute("aria-expanded");return Bs(),rr(),Nn(),Mn("onCreate",[_t]),it.showOnCreate&&nn(),Rt.addEventListener("mouseenter",function(){_t.props.interactive&&_t.state.isVisible&&_t.clearDelayTimeouts()}),Rt.addEventListener("mouseleave",function(){_t.props.interactive&&_t.props.trigger.indexOf("mouseenter")>=0&&Tn().addEventListener("mousemove",Ct)}),_t;function en(){var on=_t.props.touch;return Array.isArray(on)?on:[on,0]}function cn(){return en()[0]==="hold"}function An(){var on;return!((on=_t.props.render)==null||!on.$$tippy)}function fn(){return et||c}function Tn(){var on,Qn,Jn=fn().parentNode;return Jn&&(Qn=uS(Jn)[0])!=null&&(on=Qn.ownerDocument)!=null&&on.body?Qn.ownerDocument:document}function gn(){return bP(Rt)}function xn(on){return _t.state.isMounted&&!_t.state.isVisible||iA.isTouch||h&&h.type==="focus"?0:_P(_t.props.delay,on?0:1,i_.delay)}function Nn(on){on===void 0&&(on=!1),Rt.style.pointerEvents=_t.props.interactive&&!on?"":"none",Rt.style.zIndex=""+_t.props.zIndex}function Mn(on,Qn,Jn){var Vn;Jn===void 0&&(Jn=!0),Ot.forEach(function(sr){sr[on]&&sr[on].apply(sr,Qn)}),Jn&&(Vn=_t.props)[on].apply(Vn,Qn)}function Hn(){var on=_t.props.aria;if(on.content){var Qn="aria-"+on.content,Jn=Rt.id;uS(_t.props.triggerTarget||c).forEach(function(Vn){var sr=Vn.getAttribute(Qn);if(_t.state.isVisible)Vn.setAttribute(Qn,sr?sr+" "+Jn:Jn);else{var Fr=sr&&sr.replace(Jn,"").trim();Fr?Vn.setAttribute(Qn,Fr):Vn.removeAttribute(Qn)}})}}function rr(){!qt&&_t.props.aria.expanded&&uS(_t.props.triggerTarget||c).forEach(function(on){_t.props.interactive?on.setAttribute("aria-expanded",_t.state.isVisible&&on===fn()?"true":"false"):on.removeAttribute("aria-expanded")})}function cr(){Tn().removeEventListener("mousemove",Ct),g2=g2.filter(function(on){return on!==Ct})}function _i(on){if(!iA.isTouch||!pt&&on.type!=="mousedown"){var Qn=on.composedPath&&on.composedPath()[0]||on.target;if(!_t.props.interactive||!L3(Rt,Qn)){if(uS(_t.props.triggerTarget||c).some(function(Jn){return L3(Jn,Qn)})){if(iA.isTouch||_t.state.isVisible&&_t.props.trigger.indexOf("click")>=0)return}else Mn("onClickOutside",[_t,on]);_t.props.hideOnClick===!0&&(_t.clearDelayTimeouts(),_t.hide(),dt=!0,setTimeout(function(){dt=!1}),_t.state.isMounted||Lr())}}}function xr(){pt=!0}function Mr(){pt=!1}function Tr(){var on=Tn();on.addEventListener("mousedown",_i,!0),on.addEventListener("touchend",_i,s1),on.addEventListener("touchstart",Mr,s1),on.addEventListener("touchmove",xr,s1)}function Lr(){var on=Tn();on.removeEventListener("mousedown",_i,!0),on.removeEventListener("touchend",_i,s1),on.removeEventListener("touchstart",Mr,s1),on.removeEventListener("touchmove",xr,s1)}function os(on,Qn){var Jn=gn().box;function Vn(sr){sr.target===Jn&&(wP(Jn,"remove",Vn),Qn())}if(on===0)return Qn();wP(Jn,"remove",d),wP(Jn,"add",Vn),d=Vn}function pr(on,Qn,Jn){Jn===void 0&&(Jn=!1),uS(_t.props.triggerTarget||c).forEach(function(Vn){Vn.addEventListener(on,Qn,Jn),vt.push({node:Vn,eventType:on,handler:Qn,options:Jn})})}function Bs(){var on;cn()&&(pr("touchstart",ks,{passive:!0}),pr("touchend",Mo,{passive:!0})),(on=_t.props.trigger,on.split(/\s+/).filter(Boolean)).forEach(function(Qn){if(Qn!=="manual")switch(pr(Qn,ks),Qn){case"mouseenter":pr("mouseleave",Mo);break;case"focus":pr(_N?"focusout":"blur",or);break;case"focusin":pr("focusout",or)}})}function Ws(){vt.forEach(function(on){var Qn=on.node,Jn=on.eventType,Vn=on.handler,sr=on.options;Qn.removeEventListener(Jn,Vn,sr)}),vt=[]}function ks(on){var Qn,Jn=!1;if(_t.state.isEnabled&&!Rr(on)&&!dt){var Vn=((Qn=h)==null?void 0:Qn.type)==="focus";h=on,et=on.currentTarget,rr(),!_t.state.isVisible&&AP(on,"MouseEvent")&&g2.forEach(function(sr){return sr(on)}),on.type==="click"&&(_t.props.trigger.indexOf("mouseenter")<0||lt)&&_t.props.hideOnClick!==!1&&_t.state.isVisible?Jn=!0:nn(on),on.type==="click"&&(lt=!Jn),Jn&&!Vn&&On(on)}}function uo(on){var Qn=on.target,Jn=fn().contains(Qn)||Rt.contains(Qn);if(on.type!=="mousemove"||!Jn){var Vn=So().concat(Rt).map(function(sr){var Fr,Jr=(Fr=sr._tippy.popperInstance)==null?void 0:Fr.state;return Jr?{popperRect:sr.getBoundingClientRect(),popperState:Jr,props:it}:null}).filter(Boolean);(function(sr,Fr){var Jr=Fr.clientX,rs=Fr.clientY;return sr.every(function(is){var as=is.popperRect,es=is.popperState,Zr=is.props.interactiveBorder,ms=es.placement.split("-")[0],Wr=es.modifiersData.offset;if(!Wr)return!0;var _s=ms==="bottom"?Wr.top.y:0,xs=ms==="top"?Wr.bottom.y:0,Ps=ms==="right"?Wr.left.x:0,Al=ms==="left"?Wr.right.x:0,Vo=as.top-rs+_s>Zr,As=rs-as.bottom-xs>Zr,Os=as.left-Jr+Ps>Zr,ro=Jr-as.right-Al>Zr;return Vo||As||Os||ro})})(Vn,on)&&(cr(),On(on))}}function Mo(on){Rr(on)||_t.props.trigger.indexOf("click")>=0&&lt||(_t.props.interactive?_t.hideWithInteractivity(on):On(on))}function or(on){_t.props.trigger.indexOf("focusin")<0&&on.target!==fn()||_t.props.interactive&&on.relatedTarget&&Rt.contains(on.relatedTarget)||On(on)}function Rr(on){return!!iA.isTouch&&cn()!==on.type.indexOf("touch")>=0}function Br(){Ls();var on=_t.props,Qn=on.popperOptions,Jn=on.placement,Vn=on.offset,sr=on.getReferenceClientRect,Fr=on.moveTransition,Jr=An()?bP(Rt).arrow:null,rs=sr?{getBoundingClientRect:sr,contextElement:sr.contextElement||fn()}:c,is=[{name:"offset",options:{offset:Vn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Fr}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(as){var es=as.state;if(An()){var Zr=gn().box;["placement","reference-hidden","escaped"].forEach(function(ms){ms==="placement"?Zr.setAttribute("data-placement",es.placement):es.attributes.popper["data-popper-"+ms]?Zr.setAttribute("data-"+ms,""):Zr.removeAttribute("data-"+ms)}),es.attributes.popper={}}}}];An()&&Jr&&is.push({name:"arrow",options:{element:Jr,padding:3}}),is.push.apply(is,(Qn==null?void 0:Qn.modifiers)||[]),_t.popperInstance=S3(rs,Rt,Object.assign({},Qn,{placement:Jn,onFirstUpdate:_,modifiers:is}))}function Ls(){_t.popperInstance&&(_t.popperInstance.destroy(),_t.popperInstance=null)}function So(){return f2(Rt.querySelectorAll("[data-tippy-root]"))}function nn(on){_t.clearDelayTimeouts(),on&&Mn("onTrigger",[_t,on]),Tr();var Qn=xn(!0),Jn=en(),Vn=Jn[0],sr=Jn[1];iA.isTouch&&Vn==="hold"&&sr&&(Qn=sr),Qn?i=setTimeout(function(){_t.show()},Qn):_t.show()}function On(on){if(_t.clearDelayTimeouts(),Mn("onUntrigger",[_t,on]),_t.state.isVisible){if(!(_t.props.trigger.indexOf("mouseenter")>=0&&_t.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(on.type)>=0&&lt)){var Qn=xn(!1);Qn?s=setTimeout(function(){_t.state.isVisible&&_t.hide()},Qn):a=requestAnimationFrame(function(){_t.hide()})}}else Lr()}}function pM(c,e){e===void 0&&(e={});var i=i_.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",gN,s1),window.addEventListener("blur",vN);var s,a=Object.assign({},e,{plugins:i}),h=(s=c,m2(s)?[s]:function(d){return AP(d,"NodeList")}(s)?f2(s):Array.isArray(s)?s:f2(document.querySelectorAll(s))).reduce(function(d,_){var et=_&&wN(_,a);return et&&d.push(et),d},[]);return m2(c)?h[0]:h}pM.defaultProps=i_,pM.setDefaultProps=function(c){Object.keys(c).forEach(function(e){i_[e]=c[e]})},pM.currentInput=iA,Object.assign({},d2,{effect:function(c){var e=c.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow)}}),pM.setDefaultProps({render:V3});var SP=pM;class o1 extends o2{async _refreshUi(){var e;if(!await super._refreshUi())return!1;t_.RemoveAll(o1.PluginType);for(const i of this.variations)t_.Create(o1.PluginType,i.title,5,20,0,i.materials.map(s=>{let a;if(i.preview.startsWith("generate:"))a=this._previewGenerator.generate(s,i.preview.split(":")[1]);else{const h=s[i.preview]||"#ff00ff";a=h.image?p0(h.image,100):void 0,a||(a=YB(h,!0))}return{id:s.uuid,image:a,onClick:h=>this.applyVariation(i,h),tooltip:s.name||s.uuid}}),(s,a)=>SP(s,{placement:"bottom",content:a.tooltip}));return t_.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}o1.PluginType="MaterialConfiguratorPlugin";class v2 extends Ns{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,i;this.enabled&&((i=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))},this.dependencies=[Yr],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var i,s;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),this._previewGenerator=new iP(this._viewer),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var i,s;return(i=this._previewGenerator)===null||i===void 0||i.dispose(),this._previewGenerator=void 0,(s=this._picking)===null||s===void 0||s.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}v2.PluginType="MaterialLibraryBasePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ns("Enabled")],v2.prototype,"enabled",void 0);class gw extends v2{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:Au(),children:[...Mv(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(Yr).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(i=>({label:i.name||i.uuid,value:i.uuid}))||[]]],getValue:()=>{var i;return(i=this._selectedMaterial())===null||i===void 0?void 0:i.uuid},setValue:i=>{var s,a,h,d,_;const et=(h=(a=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(Yr))===null||a===void 0?void 0:a.materials)===null||h===void 0?void 0:h.findMaterial(i);if(et)if(this.replaceMaterial)(_=(d=this._selectedObject())===null||d===void 0?void 0:d.setMaterial)===null||_===void 0||_.call(d,et);else{const nt=this._selectedMaterial();if(nt){const it=nt.name,lt=nt.uuid;nt.copyProps(et),nt.name=it,nt.uuid=lt,nt.userData.uuid&&(nt.userData.uuid=lt)}}this._refreshUi()}}}]}}async _refreshUi(){var e,i,s,a;if(!await super._refreshUi())return!1;const h=[yu.TypeSlug,jo.TypeSlug],d=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(Yr))===null||i===void 0?void 0:i.materials,_=h.map(et=>[et,d==null?void 0:d.getMaterialsOfType(et)]);t_.RemoveAll(gw.PluginType);for(const[et,nt]of _)t_.Create(gw.PluginType,et,5,20,0,(s=nt)===null||s===void 0?void 0:s.filter(it=>!it.userData.__runtimeMaterial).map(it=>{let lt;const dt="generate:sphere";if(dt.startsWith("generate:"))lt=this._previewGenerator.generate(it,dt.split(":")[1]);else{const pt=it[dt]||"#ff00ff";lt=pt.image?p0(pt.image,100):void 0,lt||(lt=qB(pt,!0))}return{id:it.uuid,image:lt,onClick:pt=>{const gt=d==null?void 0:d.findMaterial(pt);if(console.log(gt==null?void 0:gt.name),gt){const vt=gt.userData.__appliedMeshes;if(vt!=null&&vt.size){const Ct=vt.keys().next().value;Ct.dispatchEvent({type:"select",value:Ct})}}},tooltip:it.name||it.uuid}}),(it,lt)=>SP(it,{placement:"bottom",content:lt.tooltip}));return t_.RebuildUi((a=this._viewer)===null||a===void 0?void 0:a.container),!0}}function Q3(c,e,i,s){c.traverse(a=>{a&&(a.userData.cloneRotI=e,a.userData.rotationCount=i,a.userData.rotationAxis=s,a.addEventListener("beforeRender",h=>function(d,_){var et;_&&(!((et=_.map)===null||et===void 0)&&et.isTexture)&&(_.extraUniformsToUpload||(_.extraUniformsToUpload={}),_.extraUniformsToUpload.uvTransform||(_.extraUniformsToUpload.uvTransform={value:new b.Vkp}),_.extraUniformsToUpload.uvTransform.value.setUvTransform(_.map.offset.x*_.map.repeat.x*d.userData.cloneRotI/(d.userData.rotationCount||1),_.map.offset.y*_.map.repeat.y*d.userData.cloneRotI/(d.userData.rotationCount||1),_.map.repeat.x,_.map.repeat.y,_.map.rotation,_.map.center.x,_.map.center.y))}(a,h.material)))})}function G3(c,e,i,s="x"){var a;if(c.userData.rotationCount>1&&!c.userData.rotationRoot)return c;const h=c.parent;if(!h)throw new Error("No parent");if(c.userData.cloneParent){const _=c.userData.cloneParent;if(!(c=h.children.find(et=>_===et.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",_,h),c}let d=h.children.filter(_=>{var et;return((et=_.userData)===null||et===void 0?void 0:et.cloneParent)===c.uuid}).sort((_,et)=>_.userData.cloneRotI-et.userData.cloneRotI);if(c.userData.rotationCount===e&&e===d.length&&i===void 0&&c.userData.rotationAxis===s)return c;if(i==null&&(i=(a=c.userData.rotationSkips)!==null&&a!==void 0?a:[]),i!==c.userData.rotationSkips&&(c.userData.rotationSkips=[...i]),Q3(c,0,e,s),c.userData.rotationRoot=!0,c.visible=!0,e<=d.length){for(let _=e-1;_<d.length;_++)h.remove(d[_]),d[_].traverse(et=>et.userData={__disposed:!0});d=d.slice(0,e)}for(let _=1;_<e;_++){const et=_<=d.length?d[_-1]:c.clone();et.rotation.copy(c.rotation),et.rotation[s]+=_/e*Math.PI*2,Q3(et,_,e,s),_>d.length&&h.add(et),et.visible=!i.includes(_)}return c.visible=!i.includes(0),c}gw.PluginType="MaterialLibraryPlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([ns("Replace Material")],gw.prototype,"replaceMaterial",void 0);var hS,fM=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let rA=hS=class extends Ns{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h,d,_,et;if(!this.enabled)return;const nt=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!nt)return void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));const it=nt.userData.rotationRoot&&(a=nt.userData.rotationCount)!==null&&a!==void 0?a:1;this.rotations=it,this.skips=(d=(h=nt.userData.rotationSkips)===null||h===void 0?void 0:h.join(","))!==null&&d!==void 0?d:"",this.axis=nt.userData.rotationAxis||"x",(et=(_=this.uiConfig).uiRefresh)===null||et===void 0||et.call(_,"postFrame",!0)}_paramsChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(d){if(this.rotations>1||d.userData.rotationCount){const _=d.userData.rotationCount,et=G3(d,this.rotations,this.skips.split(",").map(it=>parseInt(it)).filter(it=>isFinite(it)),this.axis),nt=et==null?void 0:et.userData.rotationCount;if(nt&&nt!==_){const it=[];et==null||et.traverseAncestors(lt=>{it.push(lt)});for(const lt of it)if(lt.userData.autoScaled){zs(lt),(i=this._viewer)===null||i===void 0||i.resetCamera({rootObject:lt,centerOffset:new b.Pa4(4,4,4)});break}}d.parent&&!d.userData.__disposed||(a=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||a===void 0||a.setSelectedObject(et,!0)}(h=this._viewer)===null||h===void 0||h.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};rA.PluginType="ObjectRotationPlugin",fM([jn(),ns("Enabled"),pn(hS.prototype._paramsChanged)],rA.prototype,"enabled",void 0),fM([ss("Rotation Count",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(hS.prototype._paramsChanged)],rA.prototype,"rotations",void 0),fM([Cv("Axis",["x","y","z"].map(c=>({label:c})),c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(hS.prototype._paramsChanged)],rA.prototype,"axis",void 0),fM([qs("Rotation Skips",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||i===void 0)&&i.getSelectedObject())||!c.rotations}})),pn(hS.prototype._paramsChanged)],rA.prototype,"skips",void 0),rA=hS=fM([Ys("Object Rotations")],rA);var a1,dS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let r_=a1=class extends Ns{constructor(c=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,i,s)=>{if(i.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const a of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${a}>`,b.WdD[a].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",b.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var i;return this.enabled+" "+((i=e.materialObject.bumpMap)===null||i===void 0?void 0:i.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:i},s)=>{for(const[a,h]of Object.entries(this._defines)){const d=typeof h=="number"?h:h?1:0;i.defines[a]!==d&&(i.defines[a]=d,i.needsUpdate=!0)}}},this.dependencies=[Yr],this.enabled=c,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var c,e,i;(e=(c=this._bumpMapExtension)===null||c===void 0?void 0:c.setDirty)===null||e===void 0||e.call(c),(i=this._viewer)===null||i===void 0||i.setDirty()}async onAdded(c){var e,i;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.registerMaterialExtension(this._bumpMapExtension),super.onAdded(c)}async onRemove(c){var e,i;return(i=(e=c.getPlugin(Yr))===null||e===void 0?void 0:e.materials)===null||i===void 0||i.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(c)}};r_.PluginType="ReliefParallaxMapping",dS([pn(a1.prototype._updateExtension),ns("Enabled")],r_.prototype,"enabled",void 0),dS([pn(a1.prototype._updateExtension),ns("Debug Normals")],r_.prototype,"debugNormals",void 0),dS([pn(a1.prototype._updateExtension),ns("Debug Hit Height")],r_.prototype,"debugHitHeight",void 0),dS([Fn("PARALLAX_MAP_STEPS",void 0,!0,a1.prototype._updateExtension),ss("Step count",[1,32],1),jn()],r_.prototype,"stepCount",void 0),dS([Fn("PARALLAX_MAP_B_STEPS",void 0,!0,a1.prototype._updateExtension),ss("Binary search steps",[1,8],1),jn()],r_.prototype,"binaryStepCount",void 0),r_=a1=dS([Ys("Parallax Mapping")],r_);var s0=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};class Av extends Wl{constructor(e,i,s,a=!1){super({vertexShader:rv,fragmentShader:`

${B1}
${Gw}
${sv}
${GS}
${s}

${k1}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!a},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new b.yGw},screenSize:{value:new b.FM8},cameraPositionWorld:{value:new b.Pa4},cameraNearFar:{value:new b.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:a?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(h,d,_)=>{if(!h.defines.SSRTAO_ENABLED)return;const et="vec3 totalDiffuse =";h.fragmentShader=h.fragmentShader.replace(et,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${et}`),h.fragmentShader=h.fragmentShader.replace("#include <aomap_fragment>",""),h.vertexUvs=!0},onObjectRender:(h,d,_)=>{var et,nt,it;this.materialExtension.extraUniforms.tSSGIMap.value=(et=this._target)===null||et===void 0?void 0:et.texture;const lt=d.materialObject,dt=!lt.transparent&&lt.transmission<.001;let pt=this.enabled&&dt&&(this.renderWithCamera||this._renderer.frameCount>1)&&_.userData.screenSpaceRendering!==!1&&!(!((nt=lt.userData)===null||nt===void 0)&&nt.ssrtaoDisabled)&&!(!((it=lt.userData)===null||it===void 0)&&it.ssaoDisabled)?1:0;lt.defines.SSRTAO_ENABLED!==pt&&(lt.defines.SSRTAO_ENABLED=pt,lt.needsUpdate=!0),pt=this.material.defines.SSGI_ENABLED,lt.defines.SSGI_ENABLED!==pt&&(lt.defines.SSGI_ENABLED=pt,lt.needsUpdate=!0),pt=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==pt&&(this.materialExtension.extraUniforms.tSSGIMap.value=pt,lt.needsUpdate=!0)},parsFragmentSnippet:h=>{var d;return Qt`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${$n("tSSGIMap",(d=this._target)===null||d===void 0?void 0:d.texture,h.capabilities.isWebGL2)}

            ${L1}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:h=>{var d,_;return this.enabled?"1":"0"+((_=(d=this._target)===null||d===void 0?void 0:d.texture)===null||_===void 0?void 0:_.encoding)},isCompatible:h=>{var d;return!(!((d=h.materialObject.userData)===null||d===void 0)&&d.ssaoDisabled)&&h.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Mv(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=i,this.needsSwap=!0,this._giActivated=a,this.ssgiEnabled=a,this.bilateralPass=new N1(this._target,s,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,i,s,a,h){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,i),this.uniforms.tLastThis.value=i.texture,super.render(e,this._target,s,a,h),this.smoothEnabled&&this.bilateralPass.render(e,i,s,a,h))}}s0([jn()],Av.prototype,"bilateralPass",void 0),s0([ss("Intensity",[0,4]),jn(),rn()],Av.prototype,"intensity",void 0),s0([ss("Power",[0,3]),jn(),rn()],Av.prototype,"power",void 0),s0([ns("Auto radius"),jn(),rn()],Av.prototype,"autoRadius",void 0),s0([ss("Object Radius",[.01,10]),jn(),rn()],Av.prototype,"objectRadius",void 0),s0([ss("Tolerance",[.1,5]),jn(),rn()],Av.prototype,"tolerance",void 0),s0([ss("Bias",[-.3,.3]),jn(),rn()],Av.prototype,"bias",void 0),s0([ss("Falloff",[1e-4,4]),jn(),rn()],Av.prototype,"falloff",void 0),s0([ss("Ray Count",[1,5],1),jn(),rn()],Av.prototype,"rayCount",void 0),s0([ss("Step count",[1,16],1),jn(),Fn("RTAO_STEP_COUNT")],Av.prototype,"stepCount",void 0),s0([ns("Smooth Enabled"),jn()],Av.prototype,"smoothEnabled",void 0),s0([ns("Render with Camera")],Av.prototype,"renderWithCamera",void 0);class _2 extends Qw{constructor(e=!0){super(),this.dependencies=[Yr,Bo,Nu],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var i,s;await super.onAdded(e),this.enabled=this._initEnabled,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}get enabled(){var e,i;return((i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.enabled)||!1}set enabled(e){var i;!((i=this.passes.ssrtgi)===null||i===void 0)&&i.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var i,s,a;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let h=!1;return(i=this._viewer)===null||i===void 0||i.getPluginByType("debug"),[Oy(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Av(e.renderer,this._rtgiTarget,(a=(s=e.getPlugin(Bo))===null||s===void 0?void 0:s.getUnpackSnippet())!==null&&a!==void 0?a:"",!0),update:()=>{var d;let _=this.enabled;if(_&&!h){const et=(d=this._viewer)===null||d===void 0?void 0:d.getPluginByType("SSAO");et!=null&&et.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?et.enabled=!1:(this.enabled=!1,_=!1))}h=_,_&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(Bo)])}},()=>[e.getPlugin(Bo),e.getPlugin(Nu),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s,a,h;const d=(s=(i=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||i===void 0?void 0:i.uiConfig)!==null&&s!==void 0?s:{};return(h=(a=d.children)===null||a===void 0?void 0:a.map(_=>Yt(_)))===null||h===void 0||h.flat(2).forEach(_=>_&&(_.onChange=this.setDirty)),d}}_2.PluginType="SSGI";class vw extends Ns{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[Yr],this.variations=[],this._selectedSwitchNode=()=>{var e;const i=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;const s=this.variations.map(h=>h.name);let a;return i.traverseAncestors(h=>{a||s.includes(h.name)&&(a=h)}),a},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(i=>i.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var i,s;await super.onAdded(e),this._picking=(i=this._viewer)===null||i===void 0?void 0:i.getPluginByType("Picking"),(s=this._picking)===null||s===void 0||s.addEventListener("selectedObjectChanged",()=>{var a,h;(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;a.selected||(a.selected=h.children[0].name||h.children[0].uuid);for(const d of h.children)d.visible=(d.name||d.uuid)===a.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);if(!h||h.children.length<1)return;for(const d of h.children)d.visible=!0}}),this.addEventListener("deserialize",async()=>{await Dl(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,i,s;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,t_.RemoveAll(vw.PluginType);for(const a of this.variations){const h=this._viewer.scene.getObjectByName(a.name);h?(h.children.length<1&&console.warn("SwitchNode does not have enough children",a),t_.Create(vw.PluginType,a.title,Math.min(5,h.children.length),20,0,h.children.map(d=>{const _=a.camView,et=new b.Pa4((_.includes("right")?1:0)-(_.includes("left")?1:0),(_.includes("top")?1:0)-(_.includes("bottom")?1:0),(_.includes("front")?1:0)-(_.includes("back")?1:0));a.camDistance||(a.camDistance=1);const nt=nP(this._viewer,d,void 0,7,et.multiplyScalar(.5*a.camDistance));return{id:d.uuid,image:nt,onClick:()=>{var it;a.selected=d.name||d.uuid,(it=this._viewer)===null||it===void 0||it.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:d.name||d.uuid}}),(d,_)=>SP(d,{placement:"bottom",content:_.tooltip}))):console.warn("no object found for variation, skipping",a)}t_.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i)}}}vw.PluginType="SwitchNodePlugin",function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);h>3&&d&&Object.defineProperty(e,i,d)}([jn()],vw.prototype,"variations",void 0);class CP extends b.u9r{constructor(e,i,s=32,a=64,h=!1,d=new b.FM8(1,1),_="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:i,shape:e,shapeSegments:s,tubularSegments:a,closed:h,primary:_,shapeScale:d.clone()};const et=i.computeFrenetFrames(a,h);this.frames=et;const nt=new b.Pa4,it=new b.Pa4,lt=new b.Pa4,dt=new b.FM8;let pt=new b.Pa4;const gt=[],vt=[],Ct=[],wt=e.getSpacedPoints(s);for(const Pt of wt)Pt.multiply(d);(function(){for(let Pt=0;Pt<a;Pt++)_t(Pt);_t(h===!1?a:0),function(){for(let Pt=0;Pt<=a;Pt++)for(let Rt=0;Rt<=s;Rt++)dt.x=Pt/a,dt.y=Rt/s,vt.push(dt.x,dt.y)}(),function(){const Pt=_==="shape",Rt=Pt?s:a,Lt=Pt?a:s;for(let Ot=1;Ot<=Rt;Ot++)for(let qt=1;qt<=Lt;qt++){const[en,cn]=Pt?[qt,Ot]:[Ot,qt],An=(s+1)*(en-1)+(cn-1),fn=(s+1)*en+(cn-1),Tn=(s+1)*en+cn,gn=(s+1)*(en-1)+cn;Ct.push(An,fn,gn),Ct.push(fn,Tn,gn)}}()})(),this.setIndex(Ct),this.setAttribute("position",new b.a$l(gt,3)),this.setAttribute("uv",new b.a$l(vt,2)),this.computeVertexNormals();const xt=this.attributes.normal;function _t(Pt){pt=i.getPointAt(Pt/a,pt);const Rt=et.normals[Pt],Lt=et.binormals[Pt];for(let Ot=0;Ot<=s;Ot++){const qt=wt[Ot%s];it.set(0,0,0).addScaledVector(Rt,qt.x).addScaledVector(Lt,qt.y),nt.copy(pt).add(it),gt.push(nt.x,nt.y,nt.z)}}(function(){for(let Rt=1;Rt<s;Rt++){const Lt=Rt+a*(s+1);it.fromBufferAttribute(xt,Rt),lt.fromBufferAttribute(xt,Lt),it.add(lt).normalize(),xt.setXYZ(Rt,it.x,it.y,it.z),xt.setXYZ(Lt,it.x,it.y,it.z)}for(let Rt=1;Rt<a;Rt++){const Lt=Rt*(s+1),Ot=Lt+s;it.fromBufferAttribute(xt,Lt),lt.fromBufferAttribute(xt,Ot),it.add(lt).normalize(),xt.setXYZ(Lt,it.x,it.y,it.z),xt.setXYZ(Ot,it.x,it.y,it.z)}it.fromBufferAttribute(xt,0),lt.fromBufferAttribute(xt,s),it.add(lt);const Pt=a*(s+1);lt.fromBufferAttribute(xt,Pt),it.add(lt),lt.fromBufferAttribute(xt,Pt+s),it.add(lt),it.normalize(),xt.setXYZ(0,it.x,it.y,it.z),xt.setXYZ(s,it.x,it.y,it.z),xt.setXYZ(Pt,it.x,it.y,it.z),xt.setXYZ(Pt+s,it.x,it.y,it.z),xt.needsUpdate=!0})()}createSplits(e){this.clearGroups();const i=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,s=this.index.count,a=[...e,1].sort();let h=0,d=0;for(const _ of a){const et=Math.round(i*_)*s/i;this.addGroup(h,et-h,d++),h=et}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var MP,_w=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let yv=MP=class extends Ns{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new b.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var c,e;const i=(e=(c=this._viewer)===null||c===void 0?void 0:c.getPlugin(mo))===null||e===void 0?void 0:e.getSelectedObject();if(!i)return;let s=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!s)return;s=parseFloat(s);const a=new TP(0,0,s,s,0,2*Math.PI,!0,0);await this.extrudeObject(i,a)}}async onAdded(c){await super.onAdded(c)}static CreateCurve(c,e){var i,s;if(c==="circle")return new TP(0,0,(i=e.radius)!==null&&i!==void 0?i:1,(s=e.radius)!==null&&s!==void 0?s:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(c,e,i=this.shapeSegments,s=this.tubularSegments,a=this.shapeScale,h=this.materialSplits.split(",").map(_=>parseFloat(_.trim())),d=this.horizontalSplits){var _,et,nt,it,lt,dt,pt,gt;if(c.userData.isExtrudedTube,c.userData._extrudeSource){const Pt=c.userData._extrudeSource;if(c=(_=c.parent)===null||_===void 0?void 0:_.children.find(Rt=>Pt===Rt.uuid),!c)return void console.warn("Could not find extrude source with uuid",Pt)}if(c.userData.extrudedObject){const Pt=c.userData.extrudedObject,Rt=(et=c.parent)===null||et===void 0?void 0:et.children.find(Lt=>Pt===Lt.uuid);Rt&&(Rt.removeFromParent(),Rt.geometry.dispose(),Rt.geometry=null,Rt.material=null),delete c.userData.extrudedObject}const vt=c.geometry;if(!vt)return void((nt=this._viewer)===null||nt===void 0||nt.alert("Extrude: No geometry to extrude"));const Ct=[c.material];let wt;try{const Pt=MP.ConvertGeometryToFlatShape(vt);wt=new CP(Pt,e,i,s,!0,a,d?"shape":"path"),wt.computeBoundingBox(),wt.createSplits(h)}catch(Pt){return void((it=this._viewer)===null||it===void 0||it.alert(typeof Pt=="string"?Pt:Pt==null?void 0:Pt.message))}Ct[0].color.set(16777215);for(let Pt=Ct.length;Pt<wt.groups.length;Pt++){const Rt=Ct[0].clone();Ct.push(Rt),Rt.color.set(16777215*Math.random())}const xt=new b.Kj0(wt,Ct);xt.userData._extrudeSource=c.uuid,xt.userData.isExtrudedTube=!0,c.visible=!1,c.userData.bboxVisible=!1,xt.name=c.name+"_extruded";const _t=await((pt=(dt=(lt=this._viewer)===null||lt===void 0?void 0:lt.getManager())===null||dt===void 0?void 0:dt.importer)===null||pt===void 0?void 0:pt.processImportedSingle(xt,{autoCenter:!1,autoScale:!1}));_t&&((gt=c.parent)===null||gt===void 0||gt.add(_t.modelObject),c.userData.extrudedObject=_t.modelObject.uuid,_t.dispatchEvent({type:"select",ui:!0,value:_t}))}static ExtrudeShape(c,e,i,s,a,h,d,_){const et=new CP(c,s,e,i,!0,new b.FM8(a,h),_?"shape":"path");et.computeBoundingBox(),et.createSplits(d);const nt=new b.Kj0(et,[]);return nt.userData.isExtrudedTube=!0,nt}static ConvertGeometryToFlatShape(c,e=!0){if(c.userData.__planarShape)return c.userData.__planarShape;let i=c.attributes.position;if(!i)throw"no position attribute";if(i.count>500)throw"too large to extrude";const s=c;i=s.attributes.position,s.boundingBox||s.computeBoundingBox();const a=s.boundingBox.getSize(new b.Pa4),h=a.x<.001?"x":a.y<.001?"y":a.z<.001?"z":null;if(!h)throw"geometry is not axis aligned not planar";let d=[];for(let et=0;et<i.count;et++){const nt=new b.FM8;h==="x"?nt.set(i.getY(et),i.getZ(et)):h==="y"?nt.set(i.getX(et),i.getZ(et)):nt.set(i.getX(et),i.getY(et)),d.push(nt)}if(e){let et=0;for(let nt=0;nt<d.length;nt++)(d[nt].x<d[et].x||d[nt].x===d[et].x&&d[nt].y<d[et].y)&&(et=nt);et!==0&&(d=d.slice(et).concat(d.slice(0,et)))}const _=new b.bnF(d);return c.userData.__planarShape=_,_}};yv.PluginType="ShapeTubeExtrudePlugin",_w([ns("Enabled")],yv.prototype,"enabled",void 0),_w([ss("Shape Segments (X)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"shapeSegments",void 0),_w([ss("Tube Segments (Y)",[1,100],1,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"tubularSegments",void 0),_w([Kp("Shape scale",[.01,10],.01,c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"shapeScale",void 0),_w([qs("Material Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"materialSplits",void 0),_w([ns("Horizontal Splits",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"horizontalSplits",void 0),_w([ho("Extrude Circle Tube",c=>({hidden:()=>{var e,i;return!(!((i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0)&&i.getSelectedObject())}}))],yv.prototype,"extrudeCirceTube",void 0),yv=MP=_w([Ys("Extrude Tube Shapes")],yv);class TP extends b.Ny0{getPoint(e,i){return super.getPoint(e,i||new b.Pa4)}}class mM extends Ns{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var i,s;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((i=this._viewer.getPluginByType("FrameFade"))===null||i===void 0||i.enable(mM.PluginType),this._fadeDisabled=!1));const a=Xs()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=a-1/60);let h=a-this._lastFrameTime;this._lastFrameTime=a;const d=(s=this._viewer.getPluginByType("Progressive"))===null||s===void 0?void 0:s.postFrameConvergedRecordingDelta();if(d&&d>0&&(h=d),d!==0&&(h*=1e3,!(h<=.001)&&(this._updaters.forEach(_=>{let et=h;_.time+et<0&&(et=-_.time),_.time+=et,Math.abs(et)>.001&&_.u(et)}),!this._fadeDisabled&&this.disableFrameFade))){const _=this._viewer.getPluginByType("FrameFade");_&&(_.disable(mM.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=i=>({start:()=>this._updaters.push({u:i,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(s=>s.u===i),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const i=Au(),s={id:i,options:e,stop:()=>{var a,h,d;!((a=this.animations[i])===null||a===void 0)&&a._stop?(d=(h=this.animations[i])===null||h===void 0?void 0:h._stop)===null||d===void 0||d.call(h):console.warn("Animation not started")}};return this.animations[i]=s,s.promise=new Promise((a,h)=>{const d={driver:this.defaultDriver,onComplete:()=>{var et;(et=e.onComplete)===null||et===void 0||et.call(e),a()},onStop:()=>{var et;(et=e.onStop)===null||et===void 0||et.call(e),a()},...e},_=Wy(d);this.animations[i]._stop=_.stop,this.animations[i].options=d}).then(()=>(delete this.animations[i],i)),this.animations[i]}async animateAsync(e){return this.animate(e).promise}}mM.PluginType="PopmotionPlugin";const xN=async c=>Fl(await(await fetch(c)).blob());async function H3(c,e=xN){const i=c.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(i)for(const s of i){const a=await e(s);c=c.replace(s,a)}return c}function IP(c,e,{width:i,height:s},a=!0){const h=`
<svg viewBox="0 0 ${i} ${s}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${c}
        </div>
    </foreignObject>
</svg>
    `;return a?En(h):h}async function bN(c,e,i){const s=IP(c,e,i);return await rP(s,i)}async function EN(c,e,i){const s=IP(c,e,i);return await XB(s,i)}var DP,s_,Ql=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const fm=c=>({onChange:e=>{e.last&&c.onChange()}});let Vu=DP=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(c){Object.assign(this,c)}reset(){const c=this.onChange;Object.assign(this,new DP),this.onChange=c}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};Ql([qs("Text",fm)],Vu.prototype,"text",void 0),Ql([ss("Font Size",[2,400],1,fm)],Vu.prototype,"fontSize",void 0),Ql([ss("Width",[2,4096],1,fm)],Vu.prototype,"width",void 0),Ql([ss("Height",[2,4096],1,fm)],Vu.prototype,"height",void 0),Ql([ss("X Offset",[-1024,1024],1,fm)],Vu.prototype,"xOffset",void 0),Ql([ss("Y Offset",[-1024,1024],1,fm)],Vu.prototype,"yOffset",void 0),Ql([ss("V-Width",[2,4096],1,fm)],Vu.prototype,"boxWidth",void 0),Ql([ss("V-Height",[2,4096],1,fm)],Vu.prototype,"boxHeight",void 0),Ql([qs("Font",fm)],Vu.prototype,"fontFamily",void 0),Ql([qs("Font Url",fm)],Vu.prototype,"fontPath",void 0),Ql([ns("Mask Text",fm)],Vu.prototype,"maskText",void 0),Ql([ns("Inner Shadow",fm)],Vu.prototype,"innerShadow",void 0),Ql([Wm("Text Color",fm)],Vu.prototype,"textColor",void 0),Ql([Wm("BG Fill",fm)],Vu.prototype,"bgFillColor",void 0),Ql([Wm("SVG BG",fm)],Vu.prototype,"svgBackground",void 0),Vu=DP=Ql([Ys("Text SVG Options")],Vu);const W3={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},gM=c=>({hidden:()=>{const e=c.getSelected();return!e||!e.userData[wv.PluginType]}});let wv=s_=class extends Ns{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var c,e;return(e=(c=this._viewer)===null||c===void 0?void 0:c.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new Vu,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(c){var e;await super.onAdded(c),(e=c.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var c,e,i,s,a,h;if(!this.enabled)return;const d=this.getSelected();if(!d)return void((e=(c=this.uiConfig).uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0));const _=d.userData[s_.PluginType];if(!_)return this.options.reset(),this._lastMeta=void 0,void((s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0));this._lastMeta!==_&&(this.options.set(_),this._lastMeta=_),(h=(a=this.uiConfig).uiRefresh)===null||h===void 0||h.call(a,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const c=this.getSelected();c&&c.isMesh&&c.userData[s_.PluginType]&&this.updateText(c,this.options.toJSON())}async addTextToSelected(){var c;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[s_.PluginType]||!e.material.map||await((c=this._viewer)===null||c===void 0?void 0:c.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(c,e){return this.updateText(c,Object.assign(this.options.toJSON(),e))}async updateText(c,e){var i,s;if(!c.isMesh)return;if(!c.material)return void console.error("updateText: no material on mesh");let a=c.userData[s_.PluginType];a||(c.userData[s_.PluginType]=a={}),Object.assign(a,e);const h=c.material;h.map&&(h.map._isSimpleTextTexture&&h.map.dispose(),h.map=void 0),h.alphaMap&&(h.alphaMap._isSimpleTextTexture&&h.alphaMap.dispose(),h.alphaMap=void 0),h.bumpMap&&(h.bumpMap._isSimpleTextTexture&&h.bumpMap.dispose(),h.bumpMap=void 0);const d=await this.makeTextSvg(a);this.applyToMap&&(h.map=d),this.applyToAlphaMap&&(h.alphaMap=d,h.transparent=!0),this.applyToBumpMap&&(h.bumpMap=d),h.userData.inverseAlphaMap=this.inverseAlphaMap,h.setDirty(),h.needsUpdate=!0,(s=(i=this.uiConfig).uiRefresh)===null||s===void 0||s.call(i,"postFrame",!0)}async makeTextSvg(c){const e=c.fontFamily||"Arial",i=c.fontPath||this.fonts[e]||"";let s=c.style;if(i.length>0){const d=i.split("?")[0].split(".").pop()||"woff";s+=`
`+(i.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${i}) format(${W3[d]||d});
            }`:"")}let a=function({text:d="Custom Text",svgBackground:_="#ffffff",xOffset:et=0,yOffset:nt=0,width:it=1024,height:lt=1024,boxWidth:dt=1024,boxHeight:pt=1024,fontFamily:gt="",fontSize:vt=32,maskText:Ct=!0,innerShadow:wt=!0,bgFillColor:xt="#000000",textColor:_t="#ffffff",style:Pt=""}){return`
<svg style="background-color:${_}" width="${it}" height="${lt}" viewBox="0 0 ${dt} ${pt}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${Pt}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${vt}px; font-family: ${gt||"Arial"}">
        <defs>

`+(Ct?`
<mask id="textMask">
<text style="fill:white; font-size: ${vt}px;" x="${et+dt/2}" y="${pt/2+nt+vt/4}" > ${d} </text>
</mask>
`:"")+`

`+(wt?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(Ct?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${dt}" height="${pt}" style="fill:${xt}"/>
        <text style="${wt?"filter: url(#innerShadow);":""} fill:${_t};" x="${et+dt/2}" y="${pt/2+nt+vt/4}"> ${d} </text>

`+(Ct?`
        </g>
`:"")+`

    </g>
</svg>
`}({...c,fontFamily:e,style:s});a=await H3(a,async d=>this._getAssetData(d)),a=En(a);const h=await this._viewer.getManager().importer.importSinglePath(a,{generateMipmaps:!1,minFilter:b.wem});return h._isSimpleTextTexture=!0,h.flipY=!1,h.needsUpdate=!0,h}async _getAssetData(c){var e,i;if(c.startsWith("http://www.w3.org"))return c;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||i===void 0?void 0:i.importer;if(!s)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new ko(s.loadingManager),processImported:!1};try{return await s.importPath(c,this._assetLoadOptions)}catch(a){return console.error(a),""}}};wv.PluginType="SimpleTextPlugin",Ql([_c(void 0,{params:gM})],wv.prototype,"options",void 0),Ql([ns("Apply Map",gM),pn(s_.prototype._paramsChanged)],wv.prototype,"applyToMap",void 0),Ql([ns("Apply Bump Map",gM),pn(s_.prototype._paramsChanged)],wv.prototype,"applyToBumpMap",void 0),Ql([ns("Apply Alpha Map",gM),pn(s_.prototype._paramsChanged)],wv.prototype,"applyToAlphaMap",void 0),Ql([ns("Invert Alpha Map",gM),pn(s_.prototype._paramsChanged)],wv.prototype,"inverseAlphaMap",void 0),Ql([ho("Add Text",c=>({hidden:()=>!c.getSelected()}))],wv.prototype,"addTextToSelected",null),wv=s_=Ql([Ys("Simple Text")],wv);class PP{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class SN{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class sA{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new sA;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(i=>i.clone()),e}invert(){for(let i=0;i<this.polygons.length;i++)this.polygons[i].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let i=new Array,s=new Array;for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],i,s,i,s);return this.front&&(i=this.front.clipPolygons(i)),s=this.back?this.back.clipPolygons(s):[],i.concat(s)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const i=[],s=[];for(let a=0;a<e.length;a++)this.plane.splitPolygon(e[a],this.polygons,this.polygons,i,s);i.length&&(this.front||(this.front=new sA),this.front.build(i)),s.length&&(this.back||(this.back=new sA),this.back.build(s))}}class Vm{constructor(e=0,i=0,s=0){this.x=e,this.y=i,this.z=s}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new Vm(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,i){return this.add(new Vm().copy(e).sub(this).times(i))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const i=this.clone(),s=i.x,a=i.y,h=i.z,d=e.x,_=e.y,et=e.z;return this.x=a*et-h*_,this.y=h*d-s*et,this.z=s*_-a*d,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new b.Pa4(this.x,this.y,this.z)}}class l1{constructor(e,i){this.normal=e,this.w=i,this.normal=e,this.w=i}clone(){return new l1(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,i,s,a,h){let d=0;const _=[];for(let et=0;et<e.vertices.length;et++){const nt=this.normal.dot(e.vertices[et].pos)-this.w,it=nt<-l1.EPSILON?2:nt>l1.EPSILON?1:0;d|=it,_.push(it)}switch(d){case 0:(this.normal.dot(e.plane.normal)>0?i:s).push(e);break;case 1:a.push(e);break;case 2:h.push(e);break;case 3:{const et=[],nt=[];for(let it=0;it<e.vertices.length;it++){const lt=(it+1)%e.vertices.length,dt=_[it],pt=_[lt],gt=e.vertices[it],vt=e.vertices[lt];if(dt!=2&&et.push(gt),dt!=1&&nt.push(dt!=2?gt.clone():gt),(dt|pt)==3){const Ct=(this.w-this.normal.dot(gt.pos))/this.normal.dot(new Vm().copy(vt.pos).sub(gt.pos)),wt=gt.interpolate(vt,Ct);et.push(wt),nt.push(wt.clone())}}et.length>=3&&a.push(new pS(et,e.shared)),nt.length>=3&&h.push(new pS(nt,e.shared));break}}}static fromPoints(e,i,s){const a=new Vm().copy(i).sub(e).cross(new Vm().copy(s).sub(e)).normalize();return new l1(a.clone(),a.dot(e))}}l1.EPSILON=1e-5;class pS{constructor(e,i){this.vertices=e,this.shared=i,this.plane=l1.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new pS(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class A2{constructor(e,i,s,a){this.pos=new Vm().copy(e),this.normal=new Vm().copy(i),this.uv=new Vm().copy(s),this.uv.z=0,a&&(this.color=new Vm().copy(a))}clone(){return new A2(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,i){return new A2(this.pos.clone().lerp(e.pos,i),this.normal.clone().lerp(e.normal,i),this.uv.clone().lerp(e.uv,i),this.color&&e.color&&this.color.clone().lerp(e.color,i))}}class $l{constructor(){this.polygons=new Array}static fromPolygons(e){const i=new $l;return i.polygons=e,i}static fromGeometry(e,i){let s=[];const a=e.attributes.position,h=e.attributes.normal,d=e.attributes.uv,_=e.attributes.color,et=e.groups;let nt;if(e.index)nt=e.index.array;else{nt=new Array(a.array.length/a.itemSize|0);for(let lt=0;lt<nt.length;lt++)nt[lt]=lt}const it=nt.length/3|0;s=new Array(it);for(let lt=0,dt=0,pt=nt.length;lt<pt;lt+=3,dt++){const gt=new Array(3);for(let vt=0;vt<3;vt++){const Ct=nt[lt+vt],wt=3*Ct,xt=2*Ct,_t=a.array[wt],Pt=a.array[wt+1],Rt=a.array[wt+2],Lt=h.array[wt],Ot=h.array[wt+1],qt=h.array[wt+2],en=d==null?void 0:d.array[xt],cn=d==null?void 0:d.array[xt+1];gt[vt]=new A2(new Vm(_t,Pt,Rt),new Vm(Lt,Ot,qt),new Vm(en,cn,0),_&&new Vm(_.array[xt],_.array[xt+1],_.array[xt+2]))}if(i===void 0&&et&&et.length>0)for(const vt of et)lt>=vt.start&&lt<vt.start+vt.count&&(s[dt]=new pS(gt,vt.materialIndex));else s[dt]=new pS(gt,i)}return $l.fromPolygons(s.filter(lt=>!isNaN(lt.plane.normal.x)))}static toGeometry(e,i){let s=0;const a=e.polygons;for(const pt of a)s+=pt.vertices.length-2;const h=new b.u9r,d=new PP(3*s*3),_=new PP(3*s*3),et=new SN(2*s*3);let nt;const it=[],lt=[];for(const pt of a){const gt=pt.vertices,vt=gt.length;pt.shared!==void 0&&(it[pt.shared]||(it[pt.shared]=[])),vt&&gt[0].color!==void 0&&(nt||(nt=new PP(3*s*3)));for(let Ct=3;Ct<=vt;Ct++)(pt.shared===void 0?lt:it[pt.shared]).push(d.top/3,d.top/3+1,d.top/3+2),d.write(gt[0].pos),d.write(gt[Ct-2].pos),d.write(gt[Ct-1].pos),_.write(gt[0].normal),_.write(gt[Ct-2].normal),_.write(gt[Ct-1].normal),et&&(et.write(gt[0].uv),et.write(gt[Ct-2].uv),et.write(gt[Ct-1].uv)),nt&&(nt.write(gt[0].color),nt.write(gt[Ct-2].color),nt.write(gt[Ct-1].color))}h.setAttribute("position",new b.TlE(d.array,3)),h.setAttribute("normal",new b.TlE(_.array,3)),et&&h.setAttribute("uv",new b.TlE(et.array,2)),nt&&h.setAttribute("color",new b.TlE(nt.array,3));for(let pt=0;pt<it.length;pt++)it[pt]===void 0&&(it[pt]=[]);if(it.length){let pt=[],gt=0;for(let vt=0;vt<it.length;vt++)h.addGroup(gt,it[vt].length,vt),gt+=it[vt].length,pt=pt.concat(it[vt]);h.addGroup(gt,lt.length,it.length),pt=pt.concat(lt),h.setIndex(pt)}const dt=new b.yGw().copy(i).invert();return h.applyMatrix4(dt),h.computeBoundingSphere(),h.computeBoundingBox(),h}static fromMesh(e,i){const s=$l.fromGeometry(e.geometry,i),a=new b.Pa4,h=new b.Vkp;h.getNormalMatrix(e.matrix);for(let d=0;d<s.polygons.length;d++){const _=s.polygons[d];for(let et=0;et<_.vertices.length;et++){const nt=_.vertices[et];nt.pos.copy(a.copy(nt.pos.toVector3()).applyMatrix4(e.matrix)),nt.normal.copy(a.copy(nt.normal.toVector3()).applyMatrix3(h))}}return s}static toMesh(e,i,s){const a=$l.toGeometry(e,i),h=new b.Kj0(a,s);return h.matrix.copy(i),h.matrix.decompose(h.position,h.quaternion,h.scale),h.rotation.setFromQuaternion(h.quaternion),h.updateMatrixWorld(),h.castShadow=h.receiveShadow=!0,h}static union(e,i){const s=$l.fromMesh(e),a=$l.fromMesh(i);return $l.toMesh(s.union(a),e.matrix,e.material)}static subtract(e,i){const s=$l.fromMesh(e),a=$l.fromMesh(i);return $l.toMesh(s.subtract(a),e.matrix,e.material)}static intersect(e,i){const s=$l.fromMesh(e),a=$l.fromMesh(i);return $l.toMesh(s.intersect(a),e.matrix,e.material)}clone(){const e=new $l;return e.polygons=this.polygons.map(i=>i.clone()).filter(i=>Number.isFinite(i.plane.w)),e}toPolygons(){return this.polygons}union(e){const i=new sA(this.clone().polygons),s=new sA(e.clone().polygons);return i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),$l.fromPolygons(i.allPolygons())}subtract(e){const i=new sA(this.clone().polygons),s=new sA(e.clone().polygons);return i.invert(),i.clipTo(s),s.clipTo(i),s.invert(),s.clipTo(i),s.invert(),i.build(s.allPolygons()),i.invert(),$l.fromPolygons(i.allPolygons())}intersect(e){const i=new sA(this.clone().polygons),s=new sA(e.clone().polygons);return i.invert(),s.clipTo(i),s.invert(),i.clipTo(s),s.clipTo(i),i.build(s.allPolygons()),i.invert(),$l.fromPolygons(i.allPolygons())}inverse(){const e=this.clone();for(const i of e.polygons)i.flip();return e}toMesh(e,i){return $l.toMesh(this,e,i)}toGeometry(e){return $l.toGeometry(this,e)}}var fS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const RP=["union","subtract","intersect"];class ey extends Ns{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[mo],this.rootMesh=new b.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var i;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(i=e.getPlugin(mo))===null||i===void 0||i.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.geometry&&(s.userData._isCSGMesh||(s.userData.csgBrush||(s.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&eu(e,"csg."+e.ext)}async exportObject(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||i===void 0?void 0:i.exporter;if(!s||!this.rootObject)return;const a=this.rootMesh.visible;this.rootMesh.visible=!0;const h=await s.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=a,h}_updateSelectedProperties(){var e,i;const s=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();s&&s.userData.csgBrush&&(s.userData.csgBrush.enabled=this.csgSelectedEnabled,s.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,i,s,a,h,d,_,et;const nt=(i=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();nt&&(this.csgSelectedEnabled=(a=(s=nt.userData.csgBrush)===null||s===void 0?void 0:s.enabled)!==null&&a!==void 0&&a,this.csgSelectedOperation=(d=(h=nt.userData.csgBrush)===null||h===void 0?void 0:h.operation)!==null&&d!==void 0?d:"union"),(et=(_=this.uiConfig)===null||_===void 0?void 0:_.uiRefresh)===null||et===void 0||et.call(_,"postFrame",!0)}_preFrame(){var e,i,s;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const a=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((i=this.rootMesh.userData.dispose)!==null&&i!==void 0?i:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(a)),this.rootMesh&&!this.rootMesh.parent&&((s=this.rootObject)===null||s===void 0||s.modelObject.add(this.rootMesh)),this.showResult?(a.forEach(h=>{h[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(a.forEach(h=>{h[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const i=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(s=>{var a;s.isMesh&&s.geometry&&(!((a=s.userData.csgBrush)===null||a===void 0)&&a.enabled)&&i.push([s,s.userData.csgBrush.operation])}),i}_sceneUpdate(e){var i,s;!((s=(i=e==null?void 0:e.object)===null||i===void 0?void 0:i.userData)===null||s===void 0)&&s._isCSGMesh||(this._csgNeedsUpdate=!0)}}fS([ns("Show Result",c=>({onChange:()=>{var e;return(e=c._viewer)===null||e===void 0?void 0:e.setDirty()}}))],ey.prototype,"showResult",void 0),fS([ho("Make CSG Brush",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();return!(s!=null&&s.userData)||!!s.userData.csgBrush||s.userData._isCSGMesh}}))],ey.prototype,"makeSelectedCSGBrush",null),fS([ns("Enabled",c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],ey.prototype,"csgSelectedEnabled",void 0),fS([Cv("Operation",RP.map(c=>({label:c})),c=>({hidden:()=>{var e,i;const s=(i=(e=c._viewer)===null||e===void 0?void 0:e.getPlugin(mo))===null||i===void 0?void 0:i.getSelectedObject();return!s||!s.userData.csgBrush},onChange:c._updateSelectedProperties}))],ey.prototype,"csgSelectedOperation",void 0),fS([ho("Refresh CSG")],ey.prototype,"refreshCSG",null),fS([ho("Export Result",c=>({hidden:()=>{var e;return!(!((e=c._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],ey.prototype,"downloadObject",null);function q3(c,e){let i=new $l;const s=c.map(h=>h[0].material).flatMap(h=>h);c.forEach(([h,d])=>{if(!RP.includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const _=h.matrix;h.matrix=h.matrixWorld;let et=0;et=Array.isArray(h.material)?void 0:s.indexOf(h.material),i=i[d]($l.fromMesh(h,et)),h.matrix=_});const a=i.toMesh(e??new b.yGw().identity(),s);return a.userData._isCSGMesh=!0,a.geometry.groups=a.geometry.groups.filter(h=>h.count>0),a}let y2=class extends ey{_buildCSGMesh(c){return q3(c)}};y2.PluginType="CSGPluginBSP",y2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("CSG Plugin (BSP)")],y2);class ty{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,i){let s=1/0,a=-1/0;for(let h=0,d=e.length;h<d;h++){const _=e[h][i];s=_<s?_:s,a=_>a?_:a}this.min=s,this.max=a}setFromPoints(e,i){let s=1/0,a=-1/0;for(let h=0,d=i.length;h<d;h++){const _=i[h],et=e.dot(_);s=et<s?et:s,a=et>a?et:a}this.min=s,this.max=a}isSeparated(e){return this.min>e.max||e.min>this.max}}ty.prototype.setFromBox=function(){const c=new b.Pa4;return function(e,i){const s=i.min,a=i.max;let h=1/0,d=-1/0;for(let _=0;_<=1;_++)for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++){c.x=s.x*_+a.x*(1-_),c.y=s.y*et+a.y*(1-et),c.z=s.z*nt+a.z*(1-nt);const it=e.dot(c);h=Math.min(it,h),d=Math.max(it,d)}this.min=h,this.max=d}}();const CN=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.Pa4;return function(s,a,h){const d=s.start,_=c,et=a.start,nt=e;i.subVectors(d,et),c.subVectors(s.end,a.start),e.subVectors(a.end,a.start);const it=i.dot(nt),lt=nt.dot(_),dt=nt.dot(nt),pt=i.dot(_),gt=_.dot(_)*dt-lt*lt;let vt,Ct;vt=gt!==0?(it*lt-pt*dt)/gt:0,Ct=(it+vt*lt)/dt,h.x=vt,h.y=Ct}}(),BP=function(){const c=new b.FM8,e=new b.Pa4,i=new b.Pa4;return function(s,a,h,d){CN(s,a,c);let _=c.x,et=c.y;if(_>=0&&_<=1&&et>=0&&et<=1)return s.at(_,h),void a.at(et,d);if(_>=0&&_<=1)return et<0?a.at(0,d):a.at(1,d),void s.closestPointToPoint(d,!0,h);if(et>=0&&et<=1)return _<0?s.at(0,h):s.at(1,h),void a.closestPointToPoint(h,!0,d);{let nt,it;nt=_<0?s.start:s.end,it=et<0?a.start:a.end;const lt=e,dt=i;return s.closestPointToPoint(it,!0,e),a.closestPointToPoint(nt,!0,i),lt.distanceToSquared(it)<=dt.distanceToSquared(nt)?(h.copy(lt),void d.copy(it)):(h.copy(nt),void d.copy(dt))}}}(),MN=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.JOQ,s=new b.Zzh;return function(a,h){const{radius:d,center:_}=a,{a:et,b:nt,c:it}=h;if(s.start=et,s.end=nt,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d||(s.start=et,s.end=it,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d)||(s.start=nt,s.end=it,s.closestPointToPoint(_,!0,c).distanceTo(_)<=d))return!0;const lt=h.getPlane(i);if(Math.abs(lt.distanceToPoint(_))<=d){const dt=lt.projectPoint(_,e);if(h.containsPoint(dt))return!0}return!1}}();function mS(c){return Math.abs(c)<1e-15}class oA extends b.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new b.Pa4),this.satBounds=new Array(4).fill().map(()=>new ty),this.points=[this.a,this.b,this.c],this.sphere=new b.aLr,this.plane=new b.JOQ,this.needsUpdate=!0}intersectsSphere(e){return MN(e,this)}update(){const e=this.a,i=this.b,s=this.c,a=this.points,h=this.satAxes,d=this.satBounds,_=h[0],et=d[0];this.getNormal(_),et.setFromPoints(_,a);const nt=h[1],it=d[1];nt.subVectors(e,i),it.setFromPoints(nt,a);const lt=h[2],dt=d[2];lt.subVectors(i,s),dt.setFromPoints(lt,a);const pt=h[3],gt=d[3];pt.subVectors(s,e),gt.setFromPoints(pt,a),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(_,e),this.needsUpdate=!1}}oA.prototype.closestPointToSegment=function(){const c=new b.Pa4,e=new b.Pa4,i=new b.Zzh;return function(s,a=null,h=null){const{start:d,end:_}=s,et=this.points;let nt,it=1/0;for(let lt=0;lt<3;lt++){const dt=(lt+1)%3;i.start.copy(et[lt]),i.end.copy(et[dt]),BP(i,s,c,e),nt=c.distanceToSquared(e),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(e))}return this.closestPointToPoint(d,c),nt=d.distanceToSquared(c),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(d)),this.closestPointToPoint(_,c),nt=_.distanceToSquared(c),nt<it&&(it=nt,a&&a.copy(c),h&&h.copy(_)),Math.sqrt(it)}}(),oA.prototype.intersectsTriangle=function(){const c=new oA,e=new Array(3),i=new Array(3),s=new ty,a=new ty,h=new b.Pa4,d=new b.Pa4,_=new b.Pa4,et=new b.Pa4,nt=new b.Zzh,it=new b.Zzh,lt=new b.Zzh;return function(dt,pt=null){this.needsUpdate&&this.update(),dt.isExtendedTriangle?dt.needsUpdate&&dt.update():(c.copy(dt),c.update(),dt=c);const gt=this.plane,vt=dt.plane;if(Math.abs(gt.normal.dot(vt.normal))>1-1e-10){const Ct=this.satBounds,wt=this.satAxes;i[0]=dt.a,i[1]=dt.b,i[2]=dt.c;for(let Pt=0;Pt<4;Pt++){const Rt=Ct[Pt],Lt=wt[Pt];if(s.setFromPoints(Lt,i),Rt.isSeparated(s))return!1}const xt=dt.satBounds,_t=dt.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let Pt=0;Pt<4;Pt++){const Rt=xt[Pt],Lt=_t[Pt];if(s.setFromPoints(Lt,e),Rt.isSeparated(s))return!1}for(let Pt=0;Pt<4;Pt++){const Rt=wt[Pt];for(let Lt=0;Lt<4;Lt++){const Ot=_t[Lt];if(h.crossVectors(Rt,Ot),s.setFromPoints(h,e),a.setFromPoints(h,i),s.isSeparated(a))return!1}}return pt&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),pt.start.set(0,0,0),pt.end.set(0,0,0)),!0}{const Ct=this.points;let wt=!1,xt=0;for(let fn=0;fn<3;fn++){const Tn=Ct[fn],gn=Ct[(fn+1)%3];nt.start.copy(Tn),nt.end.copy(gn),nt.delta(d);const xn=wt?it.start:it.end,Nn=mS(vt.distanceToPoint(Tn));if(mS(vt.normal.dot(d))&&Nn){it.copy(nt),xt=2;break}if((vt.intersectLine(nt,xn)||Nn)&&!mS(xn.distanceTo(gn))){if(xt++,wt)break;wt=!0}}if(xt===1&&this.containsPoint(it.start))return pt&&(pt.start.copy(it.start),pt.end.copy(it.start)),!0;if(xt!==2)return!1;const _t=dt.points;let Pt=!1,Rt=0;for(let fn=0;fn<3;fn++){const Tn=_t[fn],gn=_t[(fn+1)%3];nt.start.copy(Tn),nt.end.copy(gn),nt.delta(_);const xn=Pt?lt.start:lt.end,Nn=mS(gt.distanceToPoint(Tn));if(mS(gt.normal.dot(_))&&Nn){lt.copy(nt),Rt=2;break}if((gt.intersectLine(nt,xn)||Nn)&&!mS(xn.distanceTo(gn))){if(Rt++,Pt)break;Pt=!0}}if(Rt===1&&this.containsPoint(lt.start))return pt&&(pt.start.copy(lt.start),pt.end.copy(lt.start)),!0;if(Rt!==2)return!1;if(it.delta(d),lt.delta(_),d.dot(_)<0){let fn=lt.start;lt.start=lt.end,lt.end=fn}const Lt=it.start.dot(d),Ot=it.end.dot(d),qt=lt.start.dot(d),en=lt.end.dot(d),cn=Ot<qt,An=Lt<en;return(Lt===en||qt===Ot||cn!==An)&&(pt&&(et.subVectors(it.start,lt.start),et.dot(d)>0?pt.start.copy(it.start):pt.start.copy(lt.start),et.subVectors(it.end,lt.end),et.dot(d)<0?pt.end.copy(it.end):pt.end.copy(lt.end)),!0)}}}(),oA.prototype.distanceToPoint=function(){const c=new b.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),oA.prototype.distanceToTriangle=function(){const c=new b.Pa4,e=new b.Pa4,i=["a","b","c"],s=new b.Zzh,a=new b.Zzh;return function(h,d=null,_=null){const et=d||_?s:null;if(this.intersectsTriangle(h,et))return(d||_)&&(d&&et.getCenter(d),_&&et.getCenter(_)),0;let nt=1/0;for(let it=0;it<3;it++){let lt;const dt=i[it],pt=h[dt];this.closestPointToPoint(pt,c),lt=pt.distanceToSquared(c),lt<nt&&(nt=lt,d&&d.copy(c),_&&_.copy(pt));const gt=this[dt];h.closestPointToPoint(gt,c),lt=gt.distanceToSquared(c),lt<nt&&(nt=lt,d&&d.copy(gt),_&&_.copy(c))}for(let it=0;it<3;it++){const lt=i[it],dt=i[(it+1)%3];s.set(this[lt],this[dt]);for(let pt=0;pt<3;pt++){const gt=i[pt],vt=i[(pt+1)%3];a.set(h[gt],h[vt]),BP(s,a,c,e);const Ct=c.distanceToSquared(e);Ct<nt&&(nt=Ct,d&&d.copy(c),_&&_.copy(e))}}return Math.sqrt(nt)}}();class Y3{constructor(){this.intersectionSet={},this.ids=[]}add(e,i){const{intersectionSet:s,ids:a}=this;s[e]||(s[e]=[],a.push(e)),s[e].push(i)}}const c1=new b.zHn,X3=new b.yGw,mm=new b.CJI,ny=new b.Pa4,K3=new b.Ltg,J3=new b.Ltg,Z3=new b.Ltg,kP=new b.Ltg,w2=new b.Ltg,x2=new b.Ltg,LP=new b.Zzh,OP=1e-8;let b2=null;function $3(c){b2=c}function eL(c,e){function i(){return Math.random()-.5}c1.origin.copy(c.a).add(c.b).add(c.c).multiplyScalar(1/3),c.getNormal(c1.direction);let s=0,a=1/0;for(let h=0;h<3;h++){c1.direction.x+=i()*OP,c1.direction.y+=i()*OP,c1.direction.z+=i()*OP;const d=e.raycastFirst(c1,b.ehD);if(Boolean(d&&c1.direction.dot(d.face.normal)>0)&&s++,d!==null&&(a=Math.min(a,d.distance)),a===0||s/3>.5||(h-s+1)/3>.5)break}return a===0?0:s/3>.5?-1:1}function tL(c,e,i,s,a,h,d=!1){const _=i.attributes,et=i.index,nt=3*c,it=et.getX(nt+0),lt=et.getX(nt+1),dt=et.getX(nt+2);for(const pt in h){const gt=_[pt],vt=h[pt];if(!(pt in _))throw new Error(`CSG Operations: Attribute ${pt} not available on geometry.`);const Ct=gt.itemSize;pt==="position"?(mm.a.fromBufferAttribute(gt,it).applyMatrix4(s),mm.b.fromBufferAttribute(gt,lt).applyMatrix4(s),mm.c.fromBufferAttribute(gt,dt).applyMatrix4(s),NP(mm.a,mm.b,mm.c,e,3,vt,d)):pt==="normal"?(mm.a.fromBufferAttribute(gt,it).applyNormalMatrix(a),mm.b.fromBufferAttribute(gt,lt).applyNormalMatrix(a),mm.c.fromBufferAttribute(gt,dt).applyNormalMatrix(a),d&&(mm.a.multiplyScalar(-1),mm.b.multiplyScalar(-1),mm.c.multiplyScalar(-1)),NP(mm.a,mm.b,mm.c,e,3,vt,d,!0)):(K3.fromBufferAttribute(gt,it),J3.fromBufferAttribute(gt,lt),Z3.fromBufferAttribute(gt,dt),NP(K3,J3,Z3,e,Ct,vt,d))}}function nL(c,e,i,s,a,h,d,_=!1){UP(c,s,a,h,d,_),UP(e,s,a,h,d,_),UP(i,s,a,h,d,_)}function iL(c,e,i=!1){switch(c){case 0:if(e===1||e===0&&i)return 1;break;case 1:if(i){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&i)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${c}".`)}return 2}function NP(c,e,i,s,a,h,d=!1,_=!1){const et=nt=>{h.push(nt.x),a>1&&h.push(nt.y),a>2&&h.push(nt.z),a>3&&h.push(nt.w)};kP.set(0,0,0,0).addScaledVector(c,s.a.x).addScaledVector(e,s.a.y).addScaledVector(i,s.a.z),w2.set(0,0,0,0).addScaledVector(c,s.b.x).addScaledVector(e,s.b.y).addScaledVector(i,s.b.z),x2.set(0,0,0,0).addScaledVector(c,s.c.x).addScaledVector(e,s.c.y).addScaledVector(i,s.c.z),_&&(kP.normalize(),w2.normalize(),x2.normalize()),et(kP),d?(et(x2),et(w2)):(et(w2),et(x2))}function UP(c,e,i,s,a,h=!1){for(const d in a){const _=e[d],et=a[d];if(!(d in e))throw new Error(`CSG Operations: Attribute ${d} no available on geometry.`);const nt=_.itemSize;d==="position"?(ny.fromBufferAttribute(_,c).applyMatrix4(i),et.push(ny.x,ny.y,ny.z)):d==="normal"?(ny.fromBufferAttribute(_,c).applyNormalMatrix(s),h&&ny.multiplyScalar(-1),et.push(ny.x,ny.y,ny.z)):(et.push(_.getX(c)),nt>1&&et.push(_.getY(c)),nt>2&&et.push(_.getZ(c)),nt>3&&et.push(_.getW(c)))}}const Aw=1e-14,E2=1e-7,aA=new b.Zzh,mu=new b.Zzh,o_=new b.Pa4,rL=new b.Pa4,vM=new b.JOQ,TN=new oA;function _M(c){return c.a.distanceToSquared(c.b)<Aw||c.a.distanceToSquared(c.c)<Aw||c.b.distanceToSquared(c.c)<Aw}class IN extends b.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,i=null,s=-1){if(this.originalSide!==null&&this.side===null)return;o_.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const a=e.distanceToPoint(o_)<0?-1:1;i&&s!==-1?a===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=a,this.side=a),a!==this.side&&(this.side=null))}}class DN{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new IN);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class PN{constructor(){this.trianglePool=new DN,this.triangles=[],this.normal=new b.Pa4}initialize(e){const{triangles:i,trianglePool:s,normal:a}=this;if(i.length=0,s.clear(),Array.isArray(e))for(let h=0,d=e.length;h<d;h++){const _=e[h];if(h===0)_.getNormal(a);else if(Math.abs(1-_.getNormal(o_).dot(a))>Aw)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const et=s.getTriangle();et.copy(_),i.push(et)}else{e.getNormal(a);const h=s.getTriangle();h.copy(e),i.push(h)}}splitByTriangle(e){const{normal:i,triangles:s}=this;if(e.getPlane(vM),Math.abs(1-Math.abs(vM.normal.dot(i)))<E2){const a=[e.a,e.b,e.c];for(let h=0;h<3;h++){const d=(h+1)%3,_=a[h],et=a[d];o_.subVectors(et,_).normalize(),rL.crossVectors(i,o_),vM.setFromNormalAndCoplanarPoint(rL,_),this.splitByPlane(vM,e,h)}for(let h=0,d=s.length;h<d;h++)s[h].coplanarCount=0}else this.splitByPlane(vM,e)}splitByPlane(e,i=null,s=-1){const{triangles:a,trianglePool:h}=this;let d=null;i!==null&&(d=TN,d.copy(i),d.needsUpdate=!0);for(let _=0,et=a.length;_<et;_++){const nt=a[_],{a:it,b:lt,c:dt}=nt;if(d&&(!d.intersectsTriangle(nt,aA)||aA.distance()<1e-5)){nt.updateSide(e,d,s),nt.side=null;continue}let pt=0,gt=-1,vt=0,Ct=0,wt=!1;const xt=[it,lt,dt];for(let _t=0;_t<3;_t++){const Pt=(_t+1)%3;aA.start.copy(xt[_t]),aA.end.copy(xt[Pt]);const Rt=e.distanceToPoint(aA.start),Lt=e.distanceToPoint(aA.end);Math.abs(Rt)<Aw?Ct++:Rt>0&&vt++,Math.abs(Rt)<E2&&Math.abs(Lt)<E2&&(wt=!0);let Ot=!!e.intersectLine(aA,o_);!Ot&&Math.abs(Lt)<Aw&&(o_.copy(aA.end),Ot=!0),!Ot||o_.distanceTo(aA.start)<Aw||(o_.distanceTo(aA.end)<Aw&&(gt=_t),pt===0?mu.start.copy(o_):mu.end.copy(o_),pt++)}if(!wt&&Ct<2&&pt===2&&mu.distance()>E2)if(gt!==-1){gt=(gt+1)%3;let _t=0;_t===gt&&(_t=(_t+1)%3);let Pt=_t+1;Pt===gt&&(Pt=(Pt+1)%3);const Rt=h.getTriangle();Rt.a.copy(xt[Pt]),Rt.b.copy(mu.end),Rt.c.copy(mu.start),_M(Rt)||(a.push(Rt),Rt.initFrom(nt),Rt.updateSide(e,d,s)),nt.a.copy(xt[_t]),nt.b.copy(mu.start),nt.c.copy(mu.end),_M(nt)?(a.splice(_,1),_--,et--):nt.updateSide(e,d,s)}else{const _t=xt.findIndex(qt=>vt>=2?e.distanceToPoint(qt)<0:e.distanceToPoint(qt)>0);if(_t===0){let qt=mu.start;mu.start=mu.end,mu.end=qt}else if(_t===-1)continue;const Pt=(_t+1)%3,Rt=(_t+2)%3,Lt=h.getTriangle(),Ot=h.getTriangle();xt[Pt].distanceToSquared(mu.start)<xt[Rt].distanceToSquared(mu.end)?(Lt.a.copy(xt[Pt]),Lt.b.copy(mu.start),Lt.c.copy(mu.end),Ot.a.copy(xt[Pt]),Ot.b.copy(xt[Rt]),Ot.c.copy(mu.start)):(Lt.a.copy(xt[Rt]),Lt.b.copy(mu.start),Lt.c.copy(mu.end),Ot.a.copy(xt[Pt]),Ot.b.copy(xt[Rt]),Ot.c.copy(mu.end)),nt.a.copy(xt[_t]),nt.b.copy(mu.end),nt.c.copy(mu.start),_M(Lt)||(a.push(Lt),Lt.initFrom(nt),Lt.updateSide(e,d,s)),_M(Ot)||(a.push(Ot),Ot.initFrom(nt),Ot.updateSide(e,d,s)),_M(nt)?(a.splice(_,1),_--,et--):nt.updateSide(e,d,s)}else pt===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function sL(){return typeof SharedArrayBuffer<"u"}function RN(c){if(c.buffer instanceof SharedArrayBuffer)return c;const e=c.constructor,i=c.buffer,s=new SharedArrayBuffer(i.byteLength),a=new Uint8Array(i);return new Uint8Array(s).set(a,0),new e(s)}class oL{constructor(e,i=500){const s=sL()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new s(i*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:i,array:s,expansionFactor:a}=this;e===null&&(e=~~(s.length*a));const h=new i(e);h.set(s,0),this.array=h}push(...e){let{array:i,length:s}=this;s+e.length>i.length&&(this.expand(),i=this.array);for(let a=0,h=e.length;a<h;a++)i[s+a]=e[a];this.length+=e.length}clear(){this.length=0}}class BN{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:i,groupAttributes:s}=this;let a=0;for(let h=0;h<i;h++)a+=s[h][e].length;return a}getGroupSet(e=0){const{groupAttributes:i}=this;if(i[e])return this.groupCount=Math.max(this.groupCount,e+1),i[e];const s=i[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=i.length;){const a={};i.push(a);for(const h in s)a[h]=new oL(s[h].type)}return i[e]}getGroupArray(e,i=0){const{groupAttributes:s}=this;if(!s[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(i)[e]}initializeArray(e,i){const{groupAttributes:s}=this,a=s[0][e];if(a){if(a.type!==i)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let h=0,d=s.length;h<d;h++)s[h][e]=new oL(i)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(i=>{for(const s in i)i[s].clear()})}delete(e){this.groupAttributes.forEach(i=>{delete i[e]})}reset(){this.groupAttributes=[]}}class kN{constructor(e){this.triangle=new b.CJI().copy(e),this.intersects={}}addTriangle(e,i){this.intersects[e]=new b.CJI().copy(i)}getIntersectArray(){const e=[],{intersects:i}=this;for(const s in i)e.push(i[s]);return e}}class aL{constructor(){this.data={}}addTriangleIntersection(e,i,s,a){const{data:h}=this;h[e]||(h[e]=new kN(i)),h[e].addTriangle(s,a)}getTrianglesAsArray(e=null){const{data:i}=this,s=[];if(e!==null)e in i&&s.push(i[e].triangle);else for(const a in i)s.push(i[a].triangle);return s}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:i}=this;return i[e]?Object.keys(i[e].intersects).map(s=>parseInt(s)):[]}getIntersectionsAsArray(e=null,i=null){const{data:s}=this,a=new Set,h=[],d=_=>{if(s[_])if(i!==null)s[_].intersects[i]&&h.push(s[_].intersects[i]);else{const et=s[_].intersects;for(const nt in et)a.has(nt)||(a.add(nt),h.push(et[nt]))}};if(e!==null)d(e);else for(const _ in s)d(_);return h}reset(){this.data={}}}class LN{constructor(){this.enabled=!1,this.triangleIntersectsA=new aL,this.triangleIntersectsB=new aL,this.intersectionEdges=[]}addIntersectingTriangles(e,i,s,a){const{triangleIntersectsA:h,triangleIntersectsB:d}=this;h.addTriangleIntersection(e,i,s,a),d.addTriangleIntersection(s,a,e,i)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const yw=new b.yGw,gS=new b.Vkp,u1=new b.CJI,S2=new b.CJI,C2=new b.CJI,AM=new b.CJI;function ON(c){for(const e of c)return e}function lL(c,e,i,s,a,h,d,_=0){yw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),gS.getNormalMatrix(c.matrixWorld);const et=c.geometry.groupIndices,nt=c.geometry.index,it=c.geometry.attributes.position,lt=e.geometry.boundsTree,dt=e.geometry.index,pt=e.geometry.attributes.position,gt=i.ids,vt=i.intersectionSet;for(let Ct=0,wt=gt.length;Ct<wt;Ct++){const xt=gt[Ct],_t=_===-1?0:et[xt]+_,Pt=d.getGroupSet(_t),Rt=3*xt,Lt=nt.getX(Rt+0),Ot=nt.getX(Rt+1),qt=nt.getX(Rt+2);u1.a.fromBufferAttribute(it,Lt).applyMatrix4(yw),u1.b.fromBufferAttribute(it,Ot).applyMatrix4(yw),u1.c.fromBufferAttribute(it,qt).applyMatrix4(yw),h.initialize(u1);const en=vt[xt];for(let An=0,fn=en.length;An<fn;An++){const Tn=3*en[An],gn=dt.getX(Tn+0),xn=dt.getX(Tn+1),Nn=dt.getX(Tn+2);S2.a.fromBufferAttribute(pt,gn),S2.b.fromBufferAttribute(pt,xn),S2.c.fromBufferAttribute(pt,Nn),h.splitByTriangle(S2)}const cn=h.triangles;for(let An=0,fn=cn.length;An<fn;An++){const Tn=cn[An],gn=iL(s,eL(Tn,lt),a);if(gn!==2)switch(u1.getBarycoord(Tn.a,AM.a),u1.getBarycoord(Tn.b,AM.b),u1.getBarycoord(Tn.c,AM.c),gn){case 1:tL(xt,AM,c.geometry,c.matrixWorld,gS,Pt);break;case 0:tL(xt,AM,c.geometry,c.matrixWorld,gS,Pt,!0)}}}return gt.length}function cL(c,e,i,s,a,h,d=0){yw.copy(e.matrixWorld).invert().multiply(c.matrixWorld),gS.getNormalMatrix(c.matrixWorld);const _=e.geometry.boundsTree,et=c.geometry.groupIndices,nt=c.geometry.index,it=c.geometry.attributes,lt=it.position,dt=[],pt=c.geometry.halfEdges,gt=new Set;for(let vt=0,Ct=nt.count/3;vt<Ct;vt++)vt in i.intersectionSet||gt.add(vt);for(;gt.size>0;){const vt=ON(gt);gt.delete(vt),dt.push(vt);const Ct=3*vt,wt=nt.getX(Ct+0),xt=nt.getX(Ct+1),_t=nt.getX(Ct+2);C2.a.fromBufferAttribute(lt,wt).applyMatrix4(yw),C2.b.fromBufferAttribute(lt,xt).applyMatrix4(yw),C2.c.fromBufferAttribute(lt,_t).applyMatrix4(yw);const Pt=iL(s,eL(C2,_),a);for(;dt.length>0;){const Rt=dt.pop(),Lt=d===-1?0:et[Rt]+d,Ot=h.getGroupSet(Lt);for(let fn=0;fn<3;fn++){const Tn=pt.getSiblingTriangleIndex(Rt,fn);Tn!==-1&&gt.has(Tn)&&(dt.push(Tn),gt.delete(Tn))}const qt=3*Rt,en=nt.getX(qt+0),cn=nt.getX(qt+1),An=nt.getX(qt+2);switch(Pt){case 1:nL(en,cn,An,it,c.matrixWorld,gS,Ot);break;case 0:nL(An,cn,en,it,c.matrixWorld,gS,Ot,a)}}}}const FP=1.25,jP=65535,NN=Math.pow(2,-24);class M2{constructor(){}}function lA(c,e,i){return i.min.x=e[c],i.min.y=e[c+1],i.min.z=e[c+2],i.max.x=e[c+3],i.max.y=e[c+4],i.max.z=e[c+5],i}function uL(c){let e=-1,i=-1/0;for(let s=0;s<3;s++){const a=c[s+3]-c[s];a>i&&(i=a,e=s)}return e}function hL(c,e){e.set(c)}function dL(c,e,i){let s,a;for(let h=0;h<3;h++){const d=h+3;s=c[h],a=e[h],i[h]=s<a?s:a,s=c[d],a=e[d],i[d]=s>a?s:a}}function T2(c,e,i){for(let s=0;s<3;s++){const a=e[c+2*s],h=e[c+2*s+1],d=a-h,_=a+h;d<i[s]&&(i[s]=d),_>i[s+3]&&(i[s+3]=_)}}function yM(c){const e=c[3]-c[0],i=c[4]-c[1],s=c[5]-c[2];return 2*(e*i+i*s+s*e)}function zP(c,e,i,s,a=null){let h=1/0,d=1/0,_=1/0,et=-1/0,nt=-1/0,it=-1/0,lt=1/0,dt=1/0,pt=1/0,gt=-1/0,vt=-1/0,Ct=-1/0;const wt=a!==null;for(let xt=6*e,_t=6*(e+i);xt<_t;xt+=6){const Pt=c[xt+0],Rt=c[xt+1],Lt=Pt-Rt,Ot=Pt+Rt;Lt<h&&(h=Lt),Ot>et&&(et=Ot),wt&&Pt<lt&&(lt=Pt),wt&&Pt>gt&&(gt=Pt);const qt=c[xt+2],en=c[xt+3],cn=qt-en,An=qt+en;cn<d&&(d=cn),An>nt&&(nt=An),wt&&qt<dt&&(dt=qt),wt&&qt>vt&&(vt=qt);const fn=c[xt+4],Tn=c[xt+5],gn=fn-Tn,xn=fn+Tn;gn<_&&(_=gn),xn>it&&(it=xn),wt&&fn<pt&&(pt=fn),wt&&fn>Ct&&(Ct=fn)}s[0]=h,s[1]=d,s[2]=_,s[3]=et,s[4]=nt,s[5]=it,wt&&(a[0]=lt,a[1]=dt,a[2]=pt,a[3]=gt,a[4]=vt,a[5]=Ct)}const UN=(c,e)=>c.candidate-e.candidate,ww=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),I2=new Float32Array(6);class cA extends b.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new b.yGw,this.invMatrix=new b.yGw,this.points=new Array(8).fill().map(()=>new b.Pa4),this.satAxes=new Array(3).fill().map(()=>new b.Pa4),this.satBounds=new Array(3).fill().map(()=>new ty),this.alignedSatBounds=new Array(3).fill().map(()=>new ty),this.needsUpdate=!1}set(e,i,s){super.set(e,i),this.matrix.copy(s),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}cA.prototype.update=function(){const c=this.matrix,e=this.min,i=this.max,s=this.points;for(let et=0;et<=1;et++)for(let nt=0;nt<=1;nt++)for(let it=0;it<=1;it++){const lt=s[1*et|2*nt|4*it];lt.x=et?i.x:e.x,lt.y=nt?i.y:e.y,lt.z=it?i.z:e.z,lt.applyMatrix4(c)}const a=this.satBounds,h=this.satAxes,d=s[0];for(let et=0;et<3;et++){const nt=h[et],it=a[et],lt=s[1<<et];nt.subVectors(d,lt),it.setFromPoints(nt,s)}const _=this.alignedSatBounds;_[0].setFromPointsField(s,"x"),_[1].setFromPointsField(s,"y"),_[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},cA.prototype.intersectsBox=function(){const c=new ty;return function(e){this.needsUpdate&&this.update();const i=e.min,s=e.max,a=this.satBounds,h=this.satAxes,d=this.alignedSatBounds;if(c.min=i.x,c.max=s.x,d[0].isSeparated(c)||(c.min=i.y,c.max=s.y,d[1].isSeparated(c))||(c.min=i.z,c.max=s.z,d[2].isSeparated(c)))return!1;for(let _=0;_<3;_++){const et=h[_],nt=a[_];if(c.setFromBox(et,e),nt.isSeparated(c))return!1}return!0}}(),cA.prototype.intersectsTriangle=function(){const c=new oA,e=new Array(3),i=new ty,s=new ty,a=new b.Pa4;return function(h){this.needsUpdate&&this.update(),h.isExtendedTriangle?h.needsUpdate&&h.update():(c.copy(h),c.update(),h=c);const d=this.satBounds,_=this.satAxes;e[0]=h.a,e[1]=h.b,e[2]=h.c;for(let lt=0;lt<3;lt++){const dt=d[lt],pt=_[lt];if(i.setFromPoints(pt,e),dt.isSeparated(i))return!1}const et=h.satBounds,nt=h.satAxes,it=this.points;for(let lt=0;lt<3;lt++){const dt=et[lt],pt=nt[lt];if(i.setFromPoints(pt,it),dt.isSeparated(i))return!1}for(let lt=0;lt<3;lt++){const dt=_[lt];for(let pt=0;pt<4;pt++){const gt=nt[pt];if(a.crossVectors(dt,gt),i.setFromPoints(a,e),s.setFromPoints(a,it),i.isSeparated(s))return!1}}return!0}}(),cA.prototype.closestPointToPoint=function(c,e){return this.needsUpdate&&this.update(),e.copy(c).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},cA.prototype.distanceToPoint=function(){const c=new b.Pa4;return function(e){return this.closestPointToPoint(e,c),e.distanceTo(c)}}(),cA.prototype.distanceToBox=function(){const c=["x","y","z"],e=new Array(12).fill().map(()=>new b.Zzh),i=new Array(12).fill().map(()=>new b.Zzh),s=new b.Pa4,a=new b.Pa4;return function(h,d=0,_=null,et=null){if(this.needsUpdate&&this.update(),this.intersectsBox(h))return(_||et)&&(h.getCenter(a),this.closestPointToPoint(a,s),h.closestPointToPoint(s,a),_&&_.copy(s),et&&et.copy(a)),0;const nt=d*d,it=h.min,lt=h.max,dt=this.points;let pt=1/0;for(let vt=0;vt<8;vt++){const Ct=dt[vt];a.copy(Ct).clamp(it,lt);const wt=Ct.distanceToSquared(a);if(wt<pt&&(pt=wt,_&&_.copy(Ct),et&&et.copy(a),wt<nt))return Math.sqrt(wt)}let gt=0;for(let vt=0;vt<3;vt++)for(let Ct=0;Ct<=1;Ct++)for(let wt=0;wt<=1;wt++){const xt=(vt+1)%3,_t=(vt+2)%3,Pt=1<<vt|Ct<<xt|wt<<_t,Rt=dt[Ct<<xt|wt<<_t],Lt=dt[Pt];e[gt].set(Rt,Lt);const Ot=c[vt],qt=c[xt],en=c[_t],cn=i[gt],An=cn.start,fn=cn.end;An[Ot]=it[Ot],An[qt]=Ct?it[qt]:lt[qt],An[en]=wt?it[en]:lt[qt],fn[Ot]=lt[Ot],fn[qt]=Ct?it[qt]:lt[qt],fn[en]=wt?it[en]:lt[qt],gt++}for(let vt=0;vt<=1;vt++)for(let Ct=0;Ct<=1;Ct++)for(let wt=0;wt<=1;wt++){a.x=vt?lt.x:it.x,a.y=Ct?lt.y:it.y,a.z=wt?lt.z:it.z,this.closestPointToPoint(a,s);const xt=a.distanceToSquared(s);if(xt<pt&&(pt=xt,_&&_.copy(s),et&&et.copy(a),xt<nt))return Math.sqrt(xt)}for(let vt=0;vt<12;vt++){const Ct=e[vt];for(let wt=0;wt<12;wt++){const xt=i[wt];BP(Ct,xt,s,a);const _t=s.distanceToSquared(a);if(_t<pt&&(pt=_t,_&&_.copy(s),et&&et.copy(a),_t<nt))return Math.sqrt(_t)}}return Math.sqrt(pt)}}();const D2=new b.Pa4,P2=new b.Pa4,R2=new b.Pa4,pL=new b.FM8,fL=new b.FM8,mL=new b.FM8,gL=new b.Pa4;function vL(c,e,i,s,a){const h=3*s,d=c.index.getX(h),_=c.index.getX(h+1),et=c.index.getX(h+2),nt=function(it,lt,dt,pt,gt,vt,Ct){D2.fromBufferAttribute(lt,pt),P2.fromBufferAttribute(lt,gt),R2.fromBufferAttribute(lt,vt);const wt=function(xt,_t,Pt,Rt,Lt,Ot){let qt;return qt=Ot===b._Li?xt.intersectTriangle(Rt,Pt,_t,!0,Lt):xt.intersectTriangle(_t,Pt,Rt,Ot!==b.ehD,Lt),qt===null?null:{distance:xt.origin.distanceTo(Lt),point:Lt.clone()}}(it,D2,P2,R2,gL,Ct);if(wt){dt&&(pL.fromBufferAttribute(dt,pt),fL.fromBufferAttribute(dt,gt),mL.fromBufferAttribute(dt,vt),wt.uv=b.CJI.getUV(gL,D2,P2,R2,pL,fL,mL,new b.FM8));const xt={a:pt,b:gt,c:vt,normal:new b.Pa4,materialIndex:0};b.CJI.getNormal(D2,P2,R2,xt.normal),wt.face=xt,wt.faceIndex=pt}return wt}(i,c.attributes.position,c.attributes.uv,d,_,et,e);return nt?(nt.faceIndex=s,a&&a.push(nt),nt):null}function _L(c,e,i){return c===null?null:(c.point.applyMatrix4(e.matrixWorld),c.distance=c.point.distanceTo(i.ray.origin),c.object=e,c.distance<i.near||c.distance>i.far?null:c)}function uA(c,e,i,s){const a=c.a,h=c.b,d=c.c;let _=e,et=e+1,nt=e+2;i&&(_=i.getX(e),et=i.getX(e+1),nt=i.getX(e+2)),a.x=s.getX(_),a.y=s.getY(_),a.z=s.getZ(_),h.x=s.getX(et),h.y=s.getY(et),h.z=s.getZ(et),d.x=s.getX(nt),d.y=s.getY(nt),d.z=s.getZ(nt)}function AL(c,e,i,s,a,h,d){const _=i.index,et=i.attributes.position;for(let nt=c,it=e+c;nt<it;nt++)if(uA(d,3*nt,_,et),d.needsUpdate=!0,s(d,nt,a,h))return!0;return!1}class yL{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function xw(c,e){return e[c+15]===65535}function vS(c,e){return e[c+6]}function wM(c,e){return e[c+14]}function xM(c){return c+8}function bM(c,e){return e[c+6]}const _S=new b.ZzF,B2=new b.Pa4,FN=["x","y","z"];function VP(c,e,i,s,a){let h=2*c,d=AS,_=bw,et=Ew;if(xw(h,_))(function(nt,it,lt,dt,pt,gt){for(let vt=dt,Ct=dt+pt;vt<Ct;vt++)vL(nt,it,lt,vt,gt)})(e,i,s,vS(c,et),wM(h,_),a);else{const nt=xM(c);k2(nt,d,s,B2)&&VP(nt,e,i,s,a);const it=bM(c,et);k2(it,d,s,B2)&&VP(it,e,i,s,a)}}function QP(c,e,i,s){let a=2*c,h=AS,d=bw,_=Ew;if(xw(a,d))return function(et,nt,it,lt,dt){let pt=1/0,gt=null;for(let vt=lt,Ct=lt+dt;vt<Ct;vt++){const wt=vL(et,nt,it,vt);wt&&wt.distance<pt&&(gt=wt,pt=wt.distance)}return gt}(e,i,s,vS(c,_),wM(a,d));{const et=function(vt,Ct){return Ct[vt+7]}(c,_),nt=FN[et],it=s.direction[nt]>=0;let lt,dt;it?(lt=xM(c),dt=bM(c,_)):(lt=bM(c,_),dt=xM(c));const pt=k2(lt,h,s,B2)?QP(lt,e,i,s):null;if(pt){const vt=pt.point[nt];if(it?vt<=h[dt+et]:vt>=h[dt+et+3])return pt}const gt=k2(dt,h,s,B2)?QP(dt,e,i,s):null;return pt&&gt?pt.distance<=gt.distance?pt:gt:pt||gt||null}}const jN=function(){let c,e;const i=[],s=new yL(()=>new b.ZzF);return function(...h){c=s.getPrimitive(),e=s.getPrimitive(),i.push(c,e);const d=a(...h);s.releasePrimitive(c),s.releasePrimitive(e),i.pop(),i.pop();const _=i.length;return _>0&&(e=i[_-1],c=i[_-2]),d};function a(h,d,_,et,nt=null,it=0,lt=0){function dt(xt){let _t=2*xt,Pt=bw,Rt=Ew;for(;!xw(_t,Pt);)_t=2*(xt=xM(xt));return vS(xt,Rt)}function pt(xt){let _t=2*xt,Pt=bw,Rt=Ew;for(;!xw(_t,Pt);)_t=2*(xt=bM(xt,Rt));return vS(xt,Rt)+wM(_t,Pt)}let gt=2*h,vt=AS,Ct=bw,wt=Ew;if(xw(gt,Ct)){const xt=vS(h,wt),_t=wM(gt,Ct);return lA(h,vt,c),et(xt,_t,!1,lt,it+h,c)}{const xt=xM(h),_t=bM(h,wt);let Pt,Rt,Lt,Ot,qt=xt,en=_t;if(nt&&(Lt=c,Ot=e,lA(qt,vt,Lt),lA(en,vt,Ot),Pt=nt(Lt),Rt=nt(Ot),Rt<Pt)){qt=_t,en=xt;const gn=Pt;Pt=Rt,Rt=gn,Lt=Ot}Lt||(Lt=c,lA(qt,vt,Lt));const cn=_(Lt,xw(2*qt,Ct),Pt,lt+1,it+qt);let An;if(cn===2){const gn=dt(qt);An=et(gn,pt(qt)-gn,!0,lt+1,it+qt,Lt)}else An=cn&&a(qt,d,_,et,nt,it,lt+1);if(An)return!0;Ot=e,lA(en,vt,Ot);const fn=_(Ot,xw(2*en,Ct),Rt,lt+1,it+en);let Tn;if(fn===2){const gn=dt(en);Tn=et(gn,pt(en)-gn,!0,lt+1,it+en,Ot)}else Tn=fn&&a(en,d,_,et,nt,it,lt+1);return!!Tn}}}(),zN=function(){const c=new oA,e=new oA,i=new b.yGw,s=new cA,a=new cA;return function h(d,_,et,nt,it=null){let lt=2*d,dt=AS,pt=bw,gt=Ew;if(it===null&&(et.boundingBox||et.computeBoundingBox(),s.set(et.boundingBox.min,et.boundingBox.max,nt),it=s),!xw(lt,pt)){const vt=d+8,Ct=gt[d+6];return lA(vt,dt,_S),it.intersectsBox(_S)&&h(vt,_,et,nt,it)?!0:(lA(Ct,dt,_S),!(!it.intersectsBox(_S)||!h(Ct,_,et,nt,it)))}{const vt=_,Ct=vt.index,wt=vt.attributes.position,xt=et.index,_t=et.attributes.position,Pt=vS(d,gt),Rt=wM(lt,pt);if(i.copy(nt).invert(),et.boundsTree)return lA(d,dt,a),a.matrix.copy(i),a.needsUpdate=!0,et.boundsTree.shapecast({intersectsBounds:Ot=>a.intersectsBox(Ot),intersectsTriangle:Ot=>{Ot.a.applyMatrix4(nt),Ot.b.applyMatrix4(nt),Ot.c.applyMatrix4(nt),Ot.needsUpdate=!0;for(let qt=3*Pt,en=3*(Rt+Pt);qt<en;qt+=3)if(uA(e,qt,Ct,wt),e.needsUpdate=!0,Ot.intersectsTriangle(e))return!0;return!1}});for(let Lt=3*Pt,Ot=Rt+3*Pt;Lt<Ot;Lt+=3){uA(c,Lt,Ct,wt),c.a.applyMatrix4(i),c.b.applyMatrix4(i),c.c.applyMatrix4(i),c.needsUpdate=!0;for(let qt=0,en=xt.count;qt<en;qt+=3)if(uA(e,qt,xt,_t),e.needsUpdate=!0,c.intersectsTriangle(e))return!0}}}}();function k2(c,e,i,s){return lA(c,e,_S),i.intersectBox(_S,s)}const GP=[];let L2,AS,bw,Ew;function EM(c){L2&&GP.push(L2),L2=c,AS=new Float32Array(c),bw=new Uint16Array(c),Ew=new Uint32Array(c)}function O2(){L2=null,AS=null,bw=null,Ew=null,GP.length&&EM(GP.pop())}const HP=Symbol("skip tree generation"),WP=new b.ZzF,qP=new b.ZzF,yS=new b.yGw,h1=new cA,SM=new cA,CM=new b.Pa4,N2=new b.Pa4,VN=new b.Pa4,QN=new b.Pa4,GN=new b.Pa4,wL=new b.ZzF,hA=new yL(()=>new oA);class vp{static serialize(e,i={}){if(i.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),vp.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});i={cloneBuffers:!0,...i};const s=e.geometry,a=e._roots,h=s.getIndex();let d;return d=i.cloneBuffers?{roots:a.map(_=>_.slice()),index:h.array.slice()}:{roots:a,index:h.array},d}static deserialize(e,i,s={}){if(typeof s=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),vp.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});s={setIndex:!0,...s};const{index:a,roots:h}=e,d=new vp(i,{...s,[HP]:!0});if(d._roots=h,s.setIndex){const _=i.getIndex();if(_===null){const et=new b.TlE(e.index,1,!1);i.setIndex(et)}else _.array!==a&&(_.array.set(a),_.needsUpdate=!0)}return d}constructor(e,i={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((i=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[HP]:!1},i)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,i[HP]||(this._roots=function(s,a){const h=function(pt,gt){function vt(gn){en&&en(gn/cn)}function Ct(gn,xn,Nn,Mn=null,Hn=0){if(!An&&Hn>=Rt&&(An=!0,Lt&&(console.warn(`MeshBVH: Max depth of ${Rt} reached when generating BVH. Consider increasing maxDepth.`),console.warn(pt))),Nn<=Ot||Hn>=Rt)return vt(xn+Nn),gn.offset=xn,gn.count=Nn,gn;const rr=function(_i,xr,Mr,Tr,Lr,os){let pr=-1,Bs=0;if(os===0)pr=uL(xr),pr!==-1&&(Bs=(xr[pr]+xr[pr+3])/2);else if(os===1)pr=uL(_i),pr!==-1&&(Bs=function(Ws,ks,uo,Mo){let or=0;for(let Rr=ks,Br=ks+uo;Rr<Br;Rr++)or+=Ws[6*Rr+2*Mo];return or/uo}(Mr,Tr,Lr,pr));else if(os===2){const Ws=yM(_i);let ks=FP*Lr;const uo=6*Tr,Mo=6*(Tr+Lr);for(let or=0;or<3;or++){const Rr=xr[or],Br=(xr[or+3]-Rr)/32;if(Lr<8){const Ls=[...ww];Ls.length=Lr;let So=0;for(let On=uo;On<Mo;On+=6,So++){const on=Ls[So];on.candidate=Mr[On+2*or],on.count=0;const{bounds:Qn,leftCacheBounds:Jn,rightCacheBounds:Vn}=on;for(let sr=0;sr<3;sr++)Vn[sr]=1/0,Vn[sr+3]=-1/0,Jn[sr]=1/0,Jn[sr+3]=-1/0,Qn[sr]=1/0,Qn[sr+3]=-1/0;T2(On,Mr,Qn)}Ls.sort(UN);let nn=Lr;for(let On=0;On<nn;On++){const on=Ls[On];for(;On+1<nn&&Ls[On+1].candidate===on.candidate;)Ls.splice(On+1,1),nn--}for(let On=uo;On<Mo;On+=6){const on=Mr[On+2*or];for(let Qn=0;Qn<nn;Qn++){const Jn=Ls[Qn];on>=Jn.candidate?T2(On,Mr,Jn.rightCacheBounds):(T2(On,Mr,Jn.leftCacheBounds),Jn.count++)}}for(let On=0;On<nn;On++){const on=Ls[On],Qn=on.count,Jn=Lr-on.count,Vn=on.leftCacheBounds,sr=on.rightCacheBounds;let Fr=0;Qn!==0&&(Fr=yM(Vn)/Ws);let Jr=0;Jn!==0&&(Jr=yM(sr)/Ws);const rs=1+FP*(Fr*Qn+Jr*Jn);rs<ks&&(pr=or,ks=rs,Bs=on.candidate)}}else{for(let nn=0;nn<32;nn++){const On=ww[nn];On.count=0,On.candidate=Rr+Br+nn*Br;const on=On.bounds;for(let Qn=0;Qn<3;Qn++)on[Qn]=1/0,on[Qn+3]=-1/0}for(let nn=uo;nn<Mo;nn+=6){let On=~~((Mr[nn+2*or]-Rr)/Br);On>=32&&(On=31);const on=ww[On];on.count++,T2(nn,Mr,on.bounds)}const Ls=ww[31];hL(Ls.bounds,Ls.rightCacheBounds);for(let nn=30;nn>=0;nn--){const On=ww[nn],on=ww[nn+1];dL(On.bounds,on.rightCacheBounds,On.rightCacheBounds)}let So=0;for(let nn=0;nn<31;nn++){const On=ww[nn],on=On.count,Qn=On.bounds,Jn=ww[nn+1].rightCacheBounds;on!==0&&(So===0?hL(Qn,I2):dL(Qn,I2,I2)),So+=on;let Vn=0,sr=0;So!==0&&(Vn=yM(I2)/Ws);const Fr=Lr-So;Fr!==0&&(sr=yM(Jn)/Ws);const Jr=1+FP*(Vn*So+sr*Fr);Jr<ks&&(pr=or,ks=Jr,Bs=On.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${os} used.`);return{axis:pr,pos:Bs}}(gn.boundingData,Mn,_t,xn,Nn,qt);if(rr.axis===-1)return vt(xn+Nn),gn.offset=xn,gn.count=Nn,gn;const cr=function(_i,xr,Mr,Tr,Lr){let os=Mr,pr=Mr+Tr-1;const Bs=Lr.pos,Ws=2*Lr.axis;for(;;){for(;os<=pr&&xr[6*os+Ws]<Bs;)os++;for(;os<=pr&&xr[6*pr+Ws]>=Bs;)pr--;if(!(os<pr))return os;for(let ks=0;ks<3;ks++){let uo=_i[3*os+ks];_i[3*os+ks]=_i[3*pr+ks],_i[3*pr+ks]=uo;let Mo=xr[6*os+2*ks+0];xr[6*os+2*ks+0]=xr[6*pr+2*ks+0],xr[6*pr+2*ks+0]=Mo;let or=xr[6*os+2*ks+1];xr[6*os+2*ks+1]=xr[6*pr+2*ks+1],xr[6*pr+2*ks+1]=or}os++,pr--}}(Pt,_t,xn,Nn,rr);if(cr===xn||cr===xn+Nn)vt(xn+Nn),gn.offset=xn,gn.count=Nn;else{gn.splitAxis=rr.axis;const _i=new M2,xr=xn,Mr=cr-xn;gn.left=_i,_i.boundingData=new Float32Array(6),zP(_t,xr,Mr,_i.boundingData,xt),Ct(_i,xr,Mr,xt,Hn+1);const Tr=new M2,Lr=cr,os=Nn-Mr;gn.right=Tr,Tr.boundingData=new Float32Array(6),zP(_t,Lr,os,Tr.boundingData,xt),Ct(Tr,Lr,os,xt,Hn+1)}return gn}(function(gn,xn){if(!gn.index){const Nn=gn.attributes.position.count,Mn=xn.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let Hn;Hn=Nn>65535?new Uint32Array(new Mn(4*Nn)):new Uint16Array(new Mn(2*Nn)),gn.setIndex(new b.TlE(Hn,1));for(let rr=0;rr<Nn;rr++)Hn[rr]=rr}})(pt,gt);const wt=new Float32Array(6),xt=new Float32Array(6),_t=function(gn,xn){const Nn=gn.attributes.position,Mn=Nn.array,Hn=gn.index.array,rr=Hn.length/3,cr=new Float32Array(6*rr),_i=Nn.offset||0;let xr=3;Nn.isInterleavedBufferAttribute&&(xr=Nn.data.stride);for(let Mr=0;Mr<rr;Mr++){const Tr=3*Mr,Lr=6*Mr,os=Hn[Tr+0]*xr+_i,pr=Hn[Tr+1]*xr+_i,Bs=Hn[Tr+2]*xr+_i;for(let Ws=0;Ws<3;Ws++){const ks=Mn[os+Ws],uo=Mn[pr+Ws],Mo=Mn[Bs+Ws];let or=ks;uo<or&&(or=uo),Mo<or&&(or=Mo);let Rr=ks;uo>Rr&&(Rr=uo),Mo>Rr&&(Rr=Mo);const Br=(Rr-or)/2,Ls=2*Ws;cr[Lr+Ls+0]=or+Br,cr[Lr+Ls+1]=Br+(Math.abs(or)+Br)*NN,or<xn[Ws]&&(xn[Ws]=or),Rr>xn[Ws+3]&&(xn[Ws+3]=Rr)}}return cr}(pt,wt),Pt=pt.index.array,Rt=gt.maxDepth,Lt=gt.verbose,Ot=gt.maxLeafTris,qt=gt.strategy,en=gt.onProgress,cn=pt.index.count/3;let An=!1;const fn=[],Tn=function(gn){if(!gn.groups||!gn.groups.length)return[{offset:0,count:gn.index.count/3}];const xn=[],Nn=new Set;for(const Hn of gn.groups)Nn.add(Hn.start),Nn.add(Hn.start+Hn.count);const Mn=Array.from(Nn.values()).sort((Hn,rr)=>Hn-rr);for(let Hn=0;Hn<Mn.length-1;Hn++){const rr=Mn[Hn],cr=Mn[Hn+1];xn.push({offset:rr/3,count:(cr-rr)/3})}return xn}(pt);if(Tn.length===1){const gn=Tn[0],xn=new M2;xn.boundingData=wt,function(Nn,Mn,Hn,rr){let cr=1/0,_i=1/0,xr=1/0,Mr=-1/0,Tr=-1/0,Lr=-1/0;for(let os=6*Mn,pr=6*(Mn+Hn);os<pr;os+=6){const Bs=Nn[os+0];Bs<cr&&(cr=Bs),Bs>Mr&&(Mr=Bs);const Ws=Nn[os+2];Ws<_i&&(_i=Ws),Ws>Tr&&(Tr=Ws);const ks=Nn[os+4];ks<xr&&(xr=ks),ks>Lr&&(Lr=ks)}rr[0]=cr,rr[1]=_i,rr[2]=xr,rr[3]=Mr,rr[4]=Tr,rr[5]=Lr}(_t,gn.offset,gn.count,xt),Ct(xn,gn.offset,gn.count,xt),fn.push(xn)}else for(let gn of Tn){const xn=new M2;xn.boundingData=new Float32Array(6),zP(_t,gn.offset,gn.count,xn.boundingData,xt),Ct(xn,gn.offset,gn.count,xt),fn.push(xn)}return fn}(s,a);let d,_,et;const nt=[],it=a.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let pt=0;pt<h.length;pt++){const gt=h[pt],vt=new it(32*lt(gt));d=new Float32Array(vt),_=new Uint32Array(vt),et=new Uint16Array(vt),dt(0,gt),nt.push(vt)}return nt;function lt(pt){return pt.count?1:1+lt(pt.left)+lt(pt.right)}function dt(pt,gt){const vt=pt/4,Ct=pt/2,wt=!!gt.count,xt=gt.boundingData;for(let _t=0;_t<6;_t++)d[vt+_t]=xt[_t];if(wt){const _t=gt.offset,Pt=gt.count;return _[vt+6]=_t,et[Ct+14]=Pt,et[Ct+15]=jP,pt+32}{const _t=gt.left,Pt=gt.right,Rt=gt.splitAxis;let Lt;if(Lt=dt(pt+32,_t),Lt/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return _[vt+6]=Lt/4,Lt=dt(Lt,Pt),_[vt+7]=Rt,Lt}}}(e,i),!e.boundingBox&&i.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new b.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const i=this.geometry,s=i.index.array,a=i.attributes.position,h=a.array,d=a.offset||0;let _,et,nt,it,lt=3;a.isInterleavedBufferAttribute&&(lt=a.data.stride);let dt=0;const pt=this._roots;for(let vt=0,Ct=pt.length;vt<Ct;vt++)_=pt[vt],et=new Uint32Array(_),nt=new Uint16Array(_),it=new Float32Array(_),gt(0,dt),dt+=_.byteLength;function gt(vt,Ct,wt=!1){const xt=2*vt;if(nt[xt+15]===jP){const _t=et[vt+6];let Pt=1/0,Rt=1/0,Lt=1/0,Ot=-1/0,qt=-1/0,en=-1/0;for(let cn=3*_t,An=3*(_t+nt[xt+14]);cn<An;cn++){const fn=s[cn]*lt+d,Tn=h[fn+0],gn=h[fn+1],xn=h[fn+2];Tn<Pt&&(Pt=Tn),Tn>Ot&&(Ot=Tn),gn<Rt&&(Rt=gn),gn>qt&&(qt=gn),xn<Lt&&(Lt=xn),xn>en&&(en=xn)}return(it[vt+0]!==Pt||it[vt+1]!==Rt||it[vt+2]!==Lt||it[vt+3]!==Ot||it[vt+4]!==qt||it[vt+5]!==en)&&(it[vt+0]=Pt,it[vt+1]=Rt,it[vt+2]=Lt,it[vt+3]=Ot,it[vt+4]=qt,it[vt+5]=en,!0)}{const _t=vt+8,Pt=et[vt+6],Rt=_t+Ct,Lt=Pt+Ct;let Ot=wt,qt=!1,en=!1;e?Ot||(qt=e.has(Rt),en=e.has(Lt),Ot=!qt&&!en):(qt=!0,en=!0);const cn=Ot||en;let An=!1;(Ot||qt)&&(An=gt(_t,Ct,Ot));let fn=!1;cn&&(fn=gt(Pt,Ct,Ot));const Tn=An||fn;if(Tn)for(let gn=0;gn<3;gn++){const xn=_t+gn,Nn=Pt+gn,Mn=it[xn],Hn=it[xn+3],rr=it[Nn],cr=it[Nn+3];it[vt+gn]=Mn<rr?Mn:rr,it[vt+gn+3]=Hn>cr?Hn:cr}return Tn}}}traverse(e,i=0){const s=this._roots[i],a=new Uint32Array(s),h=new Uint16Array(s);(function d(_,et=0){const nt=2*_,it=h[nt+15]===jP;if(it){const lt=a[_+6],dt=h[nt+14];e(et,it,new Float32Array(s,4*_,6),lt,dt)}else{const lt=_+8,dt=a[_+6],pt=a[_+7];e(et,it,new Float32Array(s,4*_,6),pt)||(d(lt,et+1),d(dt,et+1))}})(0)}raycast(e,i=b.Wl3){const s=this._roots,a=this.geometry,h=[],d=i.isMaterial,_=Array.isArray(i),et=a.groups,nt=d?i.side:i;for(let it=0,lt=s.length;it<lt;it++){const dt=_?i[et[it].materialIndex].side:nt,pt=h.length;if(EM(s[it]),VP(0,a,dt,e,h),O2(),_){const gt=et[it].materialIndex;for(let vt=pt,Ct=h.length;vt<Ct;vt++)h[vt].face.materialIndex=gt}}return h}raycastFirst(e,i=b.Wl3){const s=this._roots,a=this.geometry,h=i.isMaterial,d=Array.isArray(i);let _=null;const et=a.groups,nt=h?i.side:i;for(let it=0,lt=s.length;it<lt;it++){const dt=d?i[et[it].materialIndex].side:nt;EM(s[it]);const pt=QP(0,a,dt,e);O2(),pt!=null&&(_==null||pt.distance<_.distance)&&(_=pt,d&&(pt.face.materialIndex=et[it].materialIndex))}return _}intersectsGeometry(e,i){const s=this.geometry;let a=!1;for(const h of this._roots)if(EM(h),a=zN(0,s,e,i),O2(),a)break;return a}shapecast(e,i,s){const a=this.geometry;if(e instanceof Function){if(i){const dt=i;i=(pt,gt,vt,Ct)=>{const wt=3*gt;return dt(pt,wt,wt+1,wt+2,vt,Ct)}}e={boundsTraverseOrder:s,intersectsBounds:e,intersectsTriangle:i,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const h=hA.getPrimitive();let{boundsTraverseOrder:d,intersectsBounds:_,intersectsRange:et,intersectsTriangle:nt}=e;if(et&&nt){const dt=et;et=(pt,gt,vt,Ct,wt)=>!!dt(pt,gt,vt,Ct,wt)||AL(pt,gt,a,nt,vt,Ct,h)}else et||(et=nt?(dt,pt,gt,vt)=>AL(dt,pt,a,nt,gt,vt,h):(dt,pt,gt)=>gt);let it=!1,lt=0;for(const dt of this._roots){if(EM(dt),it=jN(0,a,_,et,d,lt),O2(),it)break;lt+=dt.byteLength}return hA.releasePrimitive(h),it}bvhcast(e,i,s){let{intersectsRanges:a,intersectsTriangles:h}=s;const d=this.geometry.index,_=this.geometry.attributes.position,et=e.geometry.index,nt=e.geometry.attributes.position;yS.copy(i).invert();const it=hA.getPrimitive(),lt=hA.getPrimitive();if(h){let gt=function(vt,Ct,wt,xt,_t,Pt,Rt,Lt){for(let Ot=wt,qt=wt+xt;Ot<qt;Ot++){uA(lt,3*Ot,et,nt),lt.a.applyMatrix4(i),lt.b.applyMatrix4(i),lt.c.applyMatrix4(i),lt.needsUpdate=!0;for(let en=vt,cn=vt+Ct;en<cn;en++)if(uA(it,3*en,d,_),it.needsUpdate=!0,h(it,lt,en,Ot,_t,Pt,Rt,Lt))return!0}return!1};var pt=gt;if(a){const vt=a;a=function(Ct,wt,xt,_t,Pt,Rt,Lt,Ot){return!!vt(Ct,wt,xt,_t,Pt,Rt,Lt,Ot)||gt(Ct,wt,xt,_t,Pt,Rt,Lt,Ot)}}else a=gt}e.getBoundingBox(qP),qP.applyMatrix4(i);const dt=this.shapecast({intersectsBounds:gt=>qP.intersectsBox(gt),intersectsRange:(gt,vt,Ct,wt,xt,_t)=>(WP.copy(_t),WP.applyMatrix4(yS),e.shapecast({intersectsBounds:Pt=>WP.intersectsBox(Pt),intersectsRange:(Pt,Rt,Lt,Ot,qt)=>a(gt,vt,Pt,Rt,wt,xt,Ot,qt)}))});return hA.releasePrimitive(it),hA.releasePrimitive(lt),dt}intersectsBox(e,i){return h1.set(e.min,e.max,i),h1.needsUpdate=!0,this.shapecast({intersectsBounds:s=>h1.intersectsBox(s),intersectsTriangle:s=>h1.intersectsTriangle(s)})}intersectsSphere(e){return this.shapecast({intersectsBounds:i=>e.intersectsBox(i),intersectsTriangle:i=>i.intersectsSphere(e)})}closestPointToGeometry(e,i,s={},a={},h=0,d=1/0){e.boundingBox||e.computeBoundingBox(),h1.set(e.boundingBox.min,e.boundingBox.max,i),h1.needsUpdate=!0;const _=this.geometry,et=_.attributes.position,nt=_.index,it=e.attributes.position,lt=e.index,dt=hA.getPrimitive(),pt=hA.getPrimitive();let gt=N2,vt=VN,Ct=null,wt=null;a&&(Ct=QN,wt=GN);let xt=1/0,_t=null,Pt=null;return yS.copy(i).invert(),SM.matrix.copy(yS),this.shapecast({boundsTraverseOrder:Rt=>h1.distanceToBox(Rt),intersectsBounds:(Rt,Lt,Ot)=>Ot<xt&&Ot<d&&(Lt&&(SM.min.copy(Rt.min),SM.max.copy(Rt.max),SM.needsUpdate=!0),!0),intersectsRange:(Rt,Lt)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:Ot=>SM.distanceToBox(Ot),intersectsBounds:(Ot,qt,en)=>en<xt&&en<d,intersectsRange:(Ot,qt)=>{for(let en=3*Ot,cn=3*(Ot+qt);en<cn;en+=3){uA(pt,en,lt,it),pt.a.applyMatrix4(i),pt.b.applyMatrix4(i),pt.c.applyMatrix4(i),pt.needsUpdate=!0;for(let An=3*Rt,fn=3*(Rt+Lt);An<fn;An+=3){uA(dt,An,nt,et),dt.needsUpdate=!0;const Tn=dt.distanceToTriangle(pt,gt,Ct);if(Tn<xt&&(vt.copy(gt),wt&&wt.copy(Ct),xt=Tn,_t=An/3,Pt=en/3),Tn<h)return!0}}}});for(let Ot=0,qt=lt?lt.count:it.count;Ot<qt;Ot+=3){uA(pt,Ot,lt,it),pt.a.applyMatrix4(i),pt.b.applyMatrix4(i),pt.c.applyMatrix4(i),pt.needsUpdate=!0;for(let en=3*Rt,cn=3*(Rt+Lt);en<cn;en+=3){uA(dt,en,nt,et),dt.needsUpdate=!0;const An=dt.distanceToTriangle(pt,gt,Ct);if(An<xt&&(vt.copy(gt),wt&&wt.copy(Ct),xt=An,_t=en/3,Pt=Ot/3),An<h)return!0}}}}),hA.releasePrimitive(dt),hA.releasePrimitive(pt),xt===1/0?null:(s.point?s.point.copy(vt):s.point=vt.clone(),s.distance=xt,s.faceIndex=_t,a&&(a.point?a.point.copy(wt):a.point=wt.clone(),a.point.applyMatrix4(yS),vt.applyMatrix4(yS),a.distance=vt.sub(a.point).length(),a.faceIndex=Pt),s)}closestPointToPoint(e,i={},s=0,a=1/0){const h=s*s,d=a*a;let _=1/0,et=null;if(this.shapecast({boundsTraverseOrder:it=>(CM.copy(e).clamp(it.min,it.max),CM.distanceToSquared(e)),intersectsBounds:(it,lt,dt)=>dt<_&&dt<d,intersectsTriangle:(it,lt)=>{it.closestPointToPoint(e,CM);const dt=e.distanceToSquared(CM);return dt<_&&(N2.copy(CM),_=dt,et=lt),dt<h}}),_===1/0)return null;const nt=Math.sqrt(_);return i.point?i.point.copy(N2):i.point=N2.clone(),i.distance=nt,i.faceIndex=et,i}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(i=>{lA(0,new Float32Array(i),wL),e.union(wL)}),e}}const xL=vp.prototype.raycast;vp.prototype.raycast=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,i,s,a]=c;return xL.call(this,s,e.material).forEach(h=>{(h=_L(h,e,i))&&a.push(h)}),a}return xL.apply(this,c)};const bL=vp.prototype.raycastFirst;vp.prototype.raycastFirst=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,i,s]=c;return _L(bL.call(this,s,e.material),e,i)}return bL.apply(this,c)};const EL=vp.prototype.closestPointToPoint;vp.prototype.closestPointToPoint=function(...c){if(c[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),c.unshift();const e=c[1],i={};return c[1]=i,EL.apply(this,c),e&&e.copy(i.point),i.distance}return EL.apply(this,c)};const SL=vp.prototype.closestPointToGeometry;vp.prototype.closestPointToGeometry=function(...c){const e=c[2],i=c[3];if(e&&e.isVector3||i&&i.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const s={},a={},h=c[1];return c[2]=s,c[3]=a,SL.apply(this,c),e&&e.copy(s.point),i&&i.copy(a.point).applyMatrix4(h),s.distance}return SL.apply(this,c)};const CL=vp.prototype.refit;vp.prototype.refit=function(...c){const e=c[0],i=c[1];if(i&&(i instanceof Set||Array.isArray(i))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const s=new Set;i.forEach(a=>s.add(a)),e&&e.forEach(a=>s.add(a)),CL.call(this,s)}else CL.apply(this,c)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(c=>{const e=vp.prototype[c];vp.prototype[c]=function(...i){return(i[0]===null||i[0].isMesh)&&(i.shift(),console.warn(`MeshBVH: The function signature for "${c}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,i)}});const YP=[new b.Pa4,new b.Pa4,new b.Pa4];function XP(c){return~~(1e4*c)}function ML(c){return`${XP(c.x)},${XP(c.y)},${XP(c.z)}`}class HN{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:~~(s/3)}getSiblingEdgeIndex(e,i){const s=this.data[3*e+i];return s===-1?-1:s%3}updateFrom(e){const i=new Map,{attributes:s}=e,a=e.index,h=s.position;let d=a?a.count/3:h.count/3;const _=d;let et=0;this.useDrawRange&&(et=e.drawRange.start,e.drawRange.count!==1/0&&(d=~~(e.drawRange.count/3)));let nt=this.data;(!nt||nt.length<3*_)&&(nt=new Int32Array(3*_)),nt.fill(-1);let it=0,lt=0;for(let dt=0;dt<d;dt++){const pt=3*dt+et;for(let gt=0;gt<3;gt++){let vt=pt+gt;a&&(vt=a.getX(vt)),YP[gt].fromBufferAttribute(h,vt)}for(let gt=0;gt<3;gt++){const vt=(gt+1)%3,Ct=YP[gt],wt=YP[vt],xt=ML(Ct),_t=ML(wt),Pt=`${_t}_${xt}`;if(i.has(Pt)){const Rt=i.get(Pt);nt[pt+gt]=Rt,nt[Rt]=pt+gt,i.delete(Pt),it--,lt++}else{const Rt=`${xt}_${_t}`;i.set(Rt,pt+gt),it++}}}this.matchedEdges=lt,this.unmatchedEdges=it,this.data=nt}}class U2 extends b.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new b.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:i}=this,s=e.elements,a=i.elements;for(let h=0;h<16;h++)if(s[h]!==a[h])return!0;return!1}prepareGeometry(){const e=this.geometry,i=e.attributes;if(sL())for(const s in i){const a=i[s];if(a.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");a.array=RN(a.array)}if(e.boundsTree||(e.boundsTree=new vp(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new HN(e)),!e.groupIndices){const s=e.index.count/3,a=new Uint16Array(s),h=e.groups;for(let d=0,_=h.length;d<_;d++){const{start:et,count:nt}=h[d];for(let it=et/3,lt=(et+nt)/3;it<lt;it++)a[it]=d}e.groupIndices=a}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function TL(c,e){let i=e;return Array.isArray(e)||(i=[],c.forEach(s=>{i[s.materialIndex]=e})),i}class WN{constructor(){this.triangleSplitter=new PN,this.attributeData=new BN,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new LN}evaluate(e,i,s,a=new U2){e.prepareGeometry(),i.prepareGeometry();const{triangleSplitter:h,attributeData:d,attributes:_,useGroups:et,debug:nt}=this,it=a.geometry,lt=e.geometry.attributes;for(let wt=0,xt=_.length;wt<xt;wt++){const _t=_[wt],Pt=lt[_t];d.initializeArray(_t,Pt.array.constructor)}for(const wt in d.attributes)_.includes(wt)||d.delete(wt);for(const wt in it.attributes)_.includes(wt)||(it.deleteAttribute(wt),it.dispose());d.clear(),nt.enabled&&(nt.reset(),$3(nt)),function(wt,xt,_t,Pt,Rt,Lt){const{useGroups:Ot=!0}=Lt,{aIntersections:qt,bIntersections:en}=function(An,fn){const Tn=new Y3,gn=new Y3;return X3.copy(An.matrixWorld).invert().multiply(fn.matrixWorld),An.geometry.boundsTree.bvhcast(fn.geometry.boundsTree,X3,{intersectsTriangles:(xn,Nn,Mn,Hn)=>(xn.intersectsTriangle(Nn,LP)&&LP.distance()>1e-5&&(Tn.add(Mn,Hn),gn.add(Hn,Mn),b2&&(b2.addEdge(LP),b2.addIntersectingTriangles(Mn,xn,Hn,Nn))),!1)}),{aIntersections:Tn,bIntersections:gn}}(wt,xt);let cn;cn=Ot?0:-1,cL(wt,xt,qt,_t,!1,Rt,cn),lL(wt,xt,qt,_t,!1,Pt,Rt,cn),cn=Ot?wt.geometry.groups.length||1:-1,cL(xt,wt,en,_t,!0,Rt,cn),lL(xt,wt,en,_t,!0,Pt,Rt,cn)}(e,i,s,h,d,{useGroups:et}),nt.enabled&&$3(null);const dt=et&&e.geometry.groups.length!==0?e.geometry.groups.map(wt=>({...wt})):[{start:0,count:1/0,materialIndex:0}],pt=et&&i.geometry.groups.length!==0?i.geometry.groups.map(wt=>({...wt})):[{start:0,count:1/0,materialIndex:0}],gt=TL(dt,e.material),vt=TL(pt,i.material);pt.forEach(wt=>{wt.materialIndex+=gt.length}),function(wt,xt,_t,Pt){let Rt=!1,Lt=-1;const Ot=Pt.groupCount,qt=wt.attributes,en=Pt.groupAttributes[0];for(const An in en){const fn=Pt.getTotalLength(An,Ot),Tn=en[An].type;let gn=qt[An];if(!gn||gn.array.length<fn){const Nn=xt.attributes[An];gn=new b.TlE(new Tn(fn),Nn.itemSize,Nn.normalized),wt.setAttribute(An,gn),Rt=!0}let xn=0;for(let Nn=0;Nn<Ot;Nn++){const{array:Mn,type:Hn,length:rr}=Pt.groupAttributes[Nn][An],cr=new Hn(Mn.buffer,0,rr);gn.array.set(cr,xn),xn+=cr.length}gn.needsUpdate=!0,Lt=fn/gn.itemSize}wt.setDrawRange(0,Lt),wt.clearGroups();let cn=0;for(let An=0;An<Ot;An++){const fn=Pt.getGroupArray("position",An).length/3;if(fn!==0){const Tn=_t[An];wt.addGroup(cn,fn,Tn.materialIndex),cn+=fn}}if(wt.index){const An=wt.index.array;if(An.length<Lt)wt.index=null,Rt=!0;else for(let fn=0,Tn=An.length;fn<Tn;fn++)An[fn]=fn}wt.boundsTree=null,Rt&&wt.dispose()}(it,e.geometry,[...dt,...pt],d);const Ct=it.groups;if(et){const wt=new Map,xt=[...gt,...vt];let _t=0;for(let Pt=0,Rt=xt.length;Pt<Rt;Pt++)Boolean(Ct.find(Lt=>Lt.materialIndex===Pt))?(wt.set(Pt,_t),_t++):xt[Pt]=null;for(let Pt=0,Rt=Ct.length;Pt<Rt;Pt++){const Lt=Ct[Pt];Lt.materialIndex=wt.get(Lt.materialIndex)}a.material=xt.filter(Pt=>Pt)}return a}evaluateHierarchy(e,i=new U2){e.updateMatrixWorld(!0);const s=(h,d)=>{const _=h.children;for(let et=0,nt=_.length;et<nt;et++){const it=_[et];it.isOperationGroup?s(it,d):d(it)}},a=h=>{const d=h.children;let _=!1;for(let nt=0,it=d.length;nt<it;nt++){const lt=d[nt];_=a(lt)||_}const et=h.isDirty();if(et&&h.markUpdated(),_&&!h.isOperationGroup){let nt;return s(h,it=>{nt=nt?this.evaluate(nt,it,it.operation):this.evaluate(h,it,it.operation)}),h._cachedGeometry=nt.geometry,h._cachedMaterials=nt.material,!0}return _||et};return a(e),i.geometry=e._cachedGeometry,i.material=e._cachedMaterials,i}reset(){this.triangleSplitter.reset()}}const IL={union:0,subtract:1,intersect:4,difference:3};function DL(c,e){const i=new WN;i.useGroups=!0,i.attributes=["position","normal","uv"],c.forEach(h=>{for(const d of[...i.attributes])h[0].geometry.getAttribute(d)||i.attributes.splice(i.attributes.indexOf(d),1)});let s=new U2(new b._12(.01,.01,2,2));c.forEach(([h,d])=>{if(!Object.keys(IL).includes(d))return void console.error(`Unknown operation ${d}`);h.updateMatrix(),h.updateMatrixWorld();const _=new U2;_.geometry=h.geometry,_.material=h.material,h.matrixWorld.decompose(_.position,_.quaternion,_.scale),_.updateMatrix(),_.updateMatrixWorld(),s=i.evaluate(s,_,IL[d])});const a=s;return a.userData._isCSGMesh=!0,a}let F2=class extends ey{_buildCSGMesh(c){return DL(c)}};F2.PluginType="CSGPluginBVH",F2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d}([Ys("CSG Plugin (BVH)")],F2);var PL=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const qN=new b.Pa4(0,0,1),RL=new b.USm,YN=new b._fP,XN=new b._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),wS=new b._fP,KN={type:"change"};let MM=class extends st{constructor(c){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new b._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new b._fP,this._initQuaternionInvert=new b._fP,this._initQuaternionDest=new b._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=c,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(c=>{c=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(c=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",c)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new b._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const c=this.deviceOrientation;if(c){const e=c.alpha!==null?b.M8C.degToRad(c.alpha):0,i=c.beta!==null?b.M8C.degToRad(c.beta):0,s=c.gamma!==null?b.M8C.degToRad(c.gamma):0,a=this.screenOrientation?b.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,i,s,a),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(KN))}}dispose(){this.disconnect()}setObjectQuaternion(c,e,i,s){const a=Xs()/1e3;RL.set(e,c,-i,"YXZ"),wS.setFromEuler(RL),wS.multiply(XN),wS.multiply(YN.setFromAxisAngle(qN,-s)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(wS).invert(),this._initQuaternionDest.__init=!0),wS.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(wS,this.dampingFactor/(Math.min(1,a-this._lastTime)/(1/60))),this._lastTime=a}};PL([jn(),ss("Damping",[0,1],.01)],MM.prototype,"dampingFactor",void 0),MM=PL([Ys("Device Orientation Controls")],MM);class KP extends Ns{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var i,s,a,h;(s=(i=e.lastCamera)===null||i===void 0?void 0:i.removeControlsCtor)===null||s===void 0||s.call(i,this.controlsKey),(h=(a=e.camera)===null||a===void 0?void 0:a.setControlsCtor)===null||h===void 0||h.call(a,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class JP extends KP{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,i)=>new MM(e)}}JP.PluginType="DeviceOrientationControlsPlugin";var qp=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const BL=new b.Pa4,ZP=new b.$V,$P=new b.Pa4,JN={type:"change"};let Qu=class extends st{constructor(c,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new b.Pa4,this._lastTime=-1,this.object=c,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const c=this.object.quaternion;BL.set(0,0,-1).applyQuaternion(c),ZP.setFromVector3(BL),this.lat=90-b.M8C.radToDeg(ZP.phi),this.lon=b.M8C.radToDeg(ZP.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(c){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(c){if(this.activeLook)switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(c){this.domElement===document?(this.mouseX=c.pageX-this.viewHalfX,this.mouseY=c.pageY-this.viewHalfY):(this.mouseX=c.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=c.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(c){if(this.enableKeys)switch(c.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(c,e,i){return c.isVector3?$P.copy(c):e===void 0||i===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):$P.set(c,e,i),this.object.lookAt($P),this.setOrientation(),this}update(){const c=Xs(),e=(this._lastTime<0?16:Math.min(c-this._lastTime,1e3))/1e3;if(this._lastTime=c,!this.enabled)return;if(this.heightSpeed){const et=b.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(et*this.heightCoef)}else this.autoSpeedFactor=0;const i=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(i+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(i),this.moveLeft&&this.object.translateX(-i),this.moveRight&&this.object.translateX(i),this.moveUp&&this.object.translateY(i),this.moveDown&&this.object.translateY(-i);let s=e*this.lookSpeed;this.activeLook||(s=0);let a=1;this.constrainVertical&&(a=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*s,this.lookVertical&&(this.lat-=this.mouseY*s*a),this.lat=Math.max(-85,Math.min(85,this.lat));let h=b.M8C.degToRad(90-this.lat);const d=b.M8C.degToRad(this.lon);this.constrainVertical&&(h=b.M8C.mapLinear(h,0,Math.PI,this.verticalMin,this.verticalMax));const _=this.object.position;this.targetPosition.setFromSphericalCoords(1,h,d).add(_),this.object.lookAt(this.targetPosition),this.dispatchEvent(JN)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(c){this.enableKeys&&c.preventDefault()}};qp([jn(),ns()],Qu.prototype,"enabled",void 0),qp([jn(),ns()],Qu.prototype,"enableKeys",void 0),qp([jn(),qs()],Qu.prototype,"movementSpeed",void 0),qp([jn(),qs()],Qu.prototype,"lookSpeed",void 0),qp([jn(),ns()],Qu.prototype,"lookVertical",void 0),qp([jn(),ns()],Qu.prototype,"autoForward",void 0),qp([jn(),ns()],Qu.prototype,"activeLook",void 0),qp([jn(),ns()],Qu.prototype,"heightSpeed",void 0),qp([jn(),qs()],Qu.prototype,"heightCoef",void 0),qp([jn(),qs()],Qu.prototype,"heightMin",void 0),qp([jn(),qs()],Qu.prototype,"heightMax",void 0),qp([jn(),ns()],Qu.prototype,"constrainVertical",void 0),qp([jn(),qs()],Qu.prototype,"verticalMin",void 0),qp([jn(),qs()],Qu.prototype,"verticalMax",void 0),qp([jn(),ns()],Qu.prototype,"mouseDragOn",void 0),Qu=qp([Ys("First Person Controls")],Qu);class eR extends KP{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,i)=>new Qu(e,i)}}eR.PluginType="FirstPersonControlsPlugin";var xS=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};const bS=new b.USm(0,0,0,"YXZ"),ES=new b.Pa4,ZN={type:"change"},$N={type:"lock"},eU={type:"unlock"},kL=Math.PI/2;let iy=class extends st{constructor(c,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new b.Pa4(0,0,-1),this.domElement=e,this.object=c,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(c){this.isLocked||this.autoLockOnClick&&(c.preventDefault(),this.lock())}onMouseMove(c){this.isLocked&&(this._movementX+=c.movementX||c.mozMovementX||c.webkitMovementX||0,this._movementY+=c.movementY||c.mozMovementY||c.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent($N),this.isLocked=!0):(this.dispatchEvent(eU),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(c){return c.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(c){ES.setFromMatrixColumn(this.object.matrix,0),ES.crossVectors(this.object.up,ES),this.object.position.addScaledVector(ES,c)}moveRight(c){ES.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(ES,c)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){bS.setFromQuaternion(this.object.quaternion),bS.y-=.002*this._movementX*this.pointerSpeed,bS.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,bS.x=Math.max(kL-this.maxPolarAngle,Math.min(kL-this.minPolarAngle,bS.x)),this.object.quaternion.setFromEuler(bS),this.dispatchEvent(ZN)}};xS([ns(),jn()],iy.prototype,"enabled",void 0),xS([qs(),jn()],iy.prototype,"minPolarAngle",void 0),xS([qs(),jn()],iy.prototype,"maxPolarAngle",void 0),xS([qs(),jn()],iy.prototype,"pointerSpeed",void 0),xS([ns(),jn()],iy.prototype,"autoLockOnClick",void 0),iy=xS([Ys("Pointer Lock Controls")],iy);class tR extends KP{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,i)=>new iy(e,i.ownerDocument?i:i.documentElement)}}tR.PluginType="PointerLockControlsPlugin";var tU=__webpackgi_require__(819);class o0{static _initialize(){this._inited=!0,Dv(Wt`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,i,s){this._inited||this._initialize(),this.Element&&this.Remove();const a=No({id:"customContextMenu",addToBody:!1});a.style.top=s+"px",a.style.left=i+"px";for(const[h,d]of Object.entries(e)){const _=No({classList:["customContextMenuItems"],addToBody:!1,innerHTML:h});a.appendChild(_),_.onclick=d}return this.Element=a,a}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}o0.Element=void 0,o0._inited=!1;var nU=__webpackgi_require__(665);const iU=(c,e,i)=>{var s,a,h;const d=c.controller_,_=(a=(s=d.parent)===null||s===void 0?void 0:s.children)===null||a===void 0?void 0:a.indexOf(d);return!(((nt,it)=>it.controller_.rackController.rack===nt.controller_.parent)(c,e)&&_===i||(_!==void 0&&_>=0&&((h=d.parent)===null||h===void 0||h.remove(c)),e.add(c,i),0))},rU=(c,e,i,s)=>{var a,h,d,_,et;let nt=e.uiRef;const it=nt==null?void 0:nt.expanded;if(nt||(nt=c.addFolder({title:""}),nt.on("fold",Ct=>{var wt,xt,_t;let Pt=nt.expanded;bn(e,"expanded",Pt,!0),Pt=(wt=Yt(e.expanded))!==null&&wt!==void 0?wt:Pt,Pt!==nt.expanded&&(nt.expanded=Pt),(xt=e.uiRefresh)===null||xt===void 0||xt.call(e,"postFrame",!0),Pt&&((_t=e.onExpand)===null||_t===void 0||_t.call(e,e))})),!nt)return nt;nt.expanded=(h=(a=Yt(e.expanded))!==null&&a!==void 0?a:it)!==null&&h!==void 0&&h;const lt=((d=e.children)!==null&&d!==void 0?d:[]).map(Ct=>Ct&&Yt(Ct)).flat(2).filter(Ct=>Ct);let dt=0;for(const Ct of lt){let wt=Ct.uiRef;wt&&wt.controller_.viewProps.get("disposed")&&(Ct.uiRef=void 0),wt=Ct.uiRef,wt||(i.appendUiObject({uiConfig:Ct},nt),wt=Ct.uiRef),wt&&iU(wt,nt,dt++)&&i.appendUiObject({uiConfig:Ct},nt)}let pt=nt.children;for(;pt.length>dt;){const Ct=pt[pt.length-1];nt.remove(Ct),pt=nt.children}nt.controller_.props.set("title",(_=Yt(e.label))!==null&&_!==void 0?_:"");const gt=nt.controller_.view.containerElement,vt=Yt(e.domChildren,[]);if((vt==null?void 0:vt.length)!==void 0){const Ct=[];for(let wt=0;wt<gt.children.length;wt++){const xt=gt.children[wt];!((et=xt.dataset)===null||et===void 0)&&et.tpCustomDOM&&Ct.push(xt)}for(const wt of Ct)gt.removeChild(wt);for(const wt of vt)wt.parentElement!==gt&&(gt.appendChild(wt),wt.dataset.tpCustomDOM="true");nt.controller_.foldable.cleanUpTransition()}return nt},sU=(c,e,i,s)=>{var a,h;const[d,_]=(a=e.property)!==null&&a!==void 0?a:[void 0,void 0],et=(h=Yt(e.label))!==null&&h!==void 0?h:_;let nt=e.uiRef;return nt||(nt=c.addButton({title:""}),nt.on("click",async()=>{var it;const lt=[];e.prompt&&lt.push(await i.prompt(...e.prompt));const dt=(it=d&&_?d[_]:void 0)!==null&&it!==void 0?it:e.value;if(typeof dt=="function"){const pt=()=>{i.removeEventListener("postFrame",pt),dt(...lt)};i.addEventListener("postFrame",pt)}else console.warn("Invalid action type for button")})),nt&&(nt.title=et??"click me"),nt},oU=(c,e,i,s)=>{var a;const h=Object.fromEntries(((a=Yt(e.children))!==null&&a!==void 0?a:[]).map(d=>Yt(d)).flat(2).filter(d=>d).map(d=>{var _;const et=Yt(d.label);return[et,(_=d.value)!==null&&_!==void 0?_:et]}));return dA(c,e,i,{options:h,...s??{}})},aU=(c,e,i,s)=>{var a,h;const d=Yt(e.bounds),_=((a=d==null?void 0:d.length)!==null&&a!==void 0?a:0)>=2?d[1]:1,et=((h=d==null?void 0:d.length)!==null&&h!==void 0?h:0)>=1?d[0]:0,nt=e.stepSize||void 0;return dA(c,e,i,{min:et,max:_,step:nt,...s??{}})},j2=(c,e,i,s)=>{var a,h,d;const _=Yt(e.bounds);if(!_||_.length<1)return dA(c,e,i,{...s??{}});const et=((a=_.length)!==null&&a!==void 0?a:0)>=2?_[1]:1,nt=((h=_.length)!==null&&h!==void 0?h:0)>=1?_[0]:0,it={min:nt,max:et,step:(d=e.stepSize)!==null&&d!==void 0?d:(et-nt)/100},lt={x:it,y:it};e.type!=="vec3"&&e.type!=="vec4"||(lt.z=it),e.type==="vec4"&&(lt.w=it);const dt=e.property;if(e.value===void 0&&dt&&dt[0]&&typeof dt[0]=="object"&&dt[0][dt[1]]&&Array.isArray(dt[0][dt[1]])){const[pt,gt]=dt,vt=pt[gt],Ct=vt.length,wt=new(Ct===2?b.FM8:Ct===3?b.Pa4:b.Ltg)().fromArray(vt);e.value=wt,e.property=void 0,e.onChange=[()=>{pt[gt]=wt.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(xt=>xt),e.label===void 0&&(e.label=gt)}return dA(c,e,i,{...lt,...s??{}})},lU=(c,e,i,s)=>{var a;const h=e.property;if(e.value===void 0&&h&&typeof h[0]=="object"&&(!((a=h[0][h[1]])===null||a===void 0)&&a.isColor)){const[d,_]=h,et=new vo().set(d[_]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const nt=d[_];return nt?et.set(nt).convertLinearToSRGB().getHex():0},set:nt=>{const it=d[_];et.setHex(nt).convertSRGBToLinear(),it.isColor?it.copy(et):typeof it=="number"?d[_]=et.getHex():typeof it=="string"&&(d[_]="#"+et.getHexString()),typeof(d==null?void 0:d.setDirty)=="function"&&d.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(nt=>nt),e.label===void 0&&(e.label=_)}return(s=s??{}).view="color",Yt(e.inlinePicker)&&(s.picker="inline"),dA(c,e,i,s)},dA=(c,e,i,s)=>{var a;let h=Yt(e.property);if((e.getValue||e.setValue)&&h&&console.error("specify either property or value, or getValue and setValue",e),h)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var et;return(et=e.getValue)===null||et===void 0?void 0:et.call(e)},set:et=>{var nt;return(nt=e.setValue)===null||nt===void 0?void 0:nt.call(e,et)}}),h=[e,"value"]),h||e.value===void 0||(h=[e,"value"]),!h)return void console.error("cannot determine property",e);s=s??{};const d={label:(a=Yt(e.label))!==null&&a!==void 0?a:h[1],...s};let _=e.uiRef;if(!_&&typeof h[0]=="object"&&h[0]){const[et,nt]=h;try{_=e.isMonitor?c.addMonitor(et,nt,d):c.addInput(et,nt,d).on("change",it=>{[e.onChange].flat().forEach(lt=>typeof lt=="function"&&(lt==null?void 0:lt(it))),typeof(et==null?void 0:et.setDirty)=="function"&&et.setDirty(it)})}catch(it){if(!it.message.startsWith("No matching controller for"))throw it;_=void 0}}if(_){for(const[et,nt]of Object.entries(d)){const it=_.controller_.props.value(et);it!==void 0&&it.rawValue!==nt&&_.controller_.props.set(et,nt)}e.type==="slider"&&(d.min!==void 0&&_.controller_.valueController.sliderController.props.set("minValue",d.min),d.max!==void 0&&_.controller_.valueController.sliderController.props.set("maxValue",d.max)),_.refresh()}return _};class LL extends st{constructor(e=!1,i=!1,s=!1,a=!0,h=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={folder:rU,input:dA,slider:aU,dropdown:oU,checkbox:dA,color:lU,vec:j2,vec2:j2,vec3:j2,vec4:j2,button:sU,monitor:(_,et,nt,it)=>(et.isMonitor=!0,dA(_,et,nt,it)),dummy:(_,et,nt,it)=>dA(_,et,nt,it)},this.alert=async _=>alert(_),this.confirm=async _=>confirm(_),this.prompt=async(_,et,nt=!0)=>prompt(_,et),this._expand=e,this._limitedOptions=s;const d=this._createUiContainer();h.appendChild(d),this._pane=new nU.Pane({title:"Configuration",container:d}),this._pane.expanded=this._expand,a&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const i=this._refreshQueue[e],s=[],a=Xs(),h=a-this._lastModeTime[e];i.forEach(d=>{d[2]>.001?(d[2]-=h,s.push(d)):this._refreshUiObject(d[0],d[1],d[2])}),this._refreshQueue[e]=s,this._lastModeTime[e]=a}addToRefreshQueue(e,i){var s;const a=(s=i[0])===null||s===void 0?void 0:s.uiConfig,h=a==null?void 0:a.uuid,d=this._refreshQueue[e],_=d.find(et=>et[3]===h);_?_[2]=Math.max(_[2],i[2]):d.push([...i,h]),this._refreshQueue[e]=d}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,i){e&&this._appendUiObject(e,i)}_appendUiObject(e,i){var s,a,h,d;const{uiConfig:_}=e??{};if(_&&(!this._limitedOptions||_.limitedUi)&&(i=i??this._pane,_.type)){_.uuid||(_.uuid=Au()),_.uiRef&&_.uiRefType!==_.type&&(console.log("Removing UI object because of type mismatch",_.uiRef),this.removeUiConfig(_));const et=(a=(s=this._typeGenerators)[_.type])===null||a===void 0?void 0:a.call(s,i,_,this);et&&(et.hidden=(h=Yt(_.hidden))!==null&&h!==void 0&&h,et.disabled=(d=Yt(_.disabled))!==null&&d!==void 0&&d),_.uiRef=et,_.uiRefType=et?_.type:void 0,_.uiRefresh=(nt="postFrame",it=!1,lt=0)=>{var dt;return this._uiObjectRefresh(nt,(dt=e==null?void 0:e.uiConfig)!==null&&dt!==void 0?dt:_,i,it,lt)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var i,s;e&&e.uiRef&&((s=(i=e.uiRef).dispose)===null||s===void 0||s.call(i),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,i,s,a,h){(a?nR(i,s):[{uiConfig:i,parentFolder:s}]).forEach(d=>{const _=[{uiConfig:d.uiConfig},d.parentFolder,h];e==="immediate"?this._refreshUiObject(..._):this.addToRefreshQueue(e,_)})}_refreshUiObject(e,i,s=0){this._appendUiObject(e,i),s>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=No({id:"tweakpaneUiContainer",addToBody:!1});return Dv(Wt`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function nR(c,e,i){var s;return i=i??[],c&&(i.push({uiConfig:c,parentFolder:e}),(s=c.children)===null||s===void 0||s.forEach(a=>i=nR(a,c.uiRef,i))),i}class iR{constructor(){iR.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,i,s,a,h,d,_,et,nt){const it=this.elements;return it[0]=e,it[1]=a,it[2]=_,it[3]=i,it[4]=h,it[5]=et,it[6]=s,it[7]=d,it[8]=nt,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const i=this.elements,s=e.elements;return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],this}extractBasis(e,i,s){return e.setFromMatrix3Column(this,0),i.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const i=e.elements;return this.set(i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,i){const s=e.elements,a=i.elements,h=this.elements,d=s[0],_=s[3],et=s[6],nt=s[1],it=s[4],lt=s[7],dt=s[2],pt=s[5],gt=s[8],vt=a[0],Ct=a[3],wt=a[6],xt=a[1],_t=a[4],Pt=a[7],Rt=a[2],Lt=a[5],Ot=a[8];return h[0]=d*vt+_*xt+et*Rt,h[3]=d*Ct+_*_t+et*Lt,h[6]=d*wt+_*Pt+et*Ot,h[1]=nt*vt+it*xt+lt*Rt,h[4]=nt*Ct+it*_t+lt*Lt,h[7]=nt*wt+it*Pt+lt*Ot,h[2]=dt*vt+pt*xt+gt*Rt,h[5]=dt*Ct+pt*_t+gt*Lt,h[8]=dt*wt+pt*Pt+gt*Ot,this}multiplyScalar(e){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=e,i[4]*=e,i[7]*=e,i[2]*=e,i[5]*=e,i[8]*=e,this}determinant(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],_=e[5],et=e[6],nt=e[7],it=e[8];return i*d*it-i*_*nt-s*h*it+s*_*et+a*h*nt-a*d*et}invert(){const e=this.elements,i=e[0],s=e[1],a=e[2],h=e[3],d=e[4],_=e[5],et=e[6],nt=e[7],it=e[8],lt=it*d-_*nt,dt=_*et-it*h,pt=nt*h-d*et,gt=i*lt+s*dt+a*pt;if(gt===0)return this.set(0,0,0,0,0,0,0,0,0);const vt=1/gt;return e[0]=lt*vt,e[1]=(a*nt-it*s)*vt,e[2]=(_*s-a*d)*vt,e[3]=dt*vt,e[4]=(it*i-a*et)*vt,e[5]=(a*h-_*i)*vt,e[6]=pt*vt,e[7]=(s*et-nt*i)*vt,e[8]=(d*i-s*h)*vt,this}transpose(){let e;const i=this.elements;return e=i[1],i[1]=i[3],i[3]=e,e=i[2],i[2]=i[6],i[6]=e,e=i[5],i[5]=i[7],i[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const i=this.elements;return e[0]=i[0],e[1]=i[3],e[2]=i[6],e[3]=i[1],e[4]=i[4],e[5]=i[7],e[6]=i[2],e[7]=i[5],e[8]=i[8],this}setUvTransform(e,i,s,a,h,d,_){const et=Math.cos(h),nt=Math.sin(h);return this.set(s*et,s*nt,-s*(et*d+nt*_)+d+e,-a*nt,a*et,-a*(-nt*d+et*_)+_+i,0,0,1),this}scale(e,i){const s=this.elements;return s[0]*=e,s[3]*=e,s[6]*=e,s[1]*=i,s[4]*=i,s[7]*=i,this}rotate(e){const i=Math.cos(e),s=Math.sin(e),a=this.elements,h=a[0],d=a[3],_=a[6],et=a[1],nt=a[4],it=a[7];return a[0]=i*h+s*et,a[3]=i*d+s*nt,a[6]=i*_+s*it,a[1]=-s*h+i*et,a[4]=-s*d+i*nt,a[7]=-s*_+i*it,this}translate(e,i){const s=this.elements;return s[0]+=e*s[2],s[3]+=e*s[5],s[6]+=e*s[8],s[1]+=i*s[2],s[4]+=i*s[5],s[7]+=i*s[8],this}equals(e){const i=this.elements,s=e.elements;for(let a=0;a<9;a++)if(i[a]!==s[a])return!1;return!0}fromArray(e,i=0){for(let s=0;s<9;s++)this.elements[s]=e[s+i];return this}toArray(e=[],i=0){const s=this.elements;return e[i]=s[0],e[i+1]=s[1],e[i+2]=s[2],e[i+3]=s[3],e[i+4]=s[4],e[i+5]=s[5],e[i+6]=s[6],e[i+7]=s[7],e[i+8]=s[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function OL(c){return document.createElementNS("http://www.w3.org/1999/xhtml",c)}let SS;class cU{constructor(e=null){this.isSource=!0,this.uuid=qo(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const s={uuid:this.uuid,url:""},a=this.data;if(a!==null){let h;if(Array.isArray(a)){h=[];for(let d=0,_=a.length;d<_;d++)a[d].isDataTexture?h.push(rR(a[d].image)):h.push(rR(a[d]))}else h=rR(a);s.url=h}return i||(e.images[this.uuid]=s),s}}function rR(c){if(typeof HTMLImageElement<"u"&&c instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&c instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&c instanceof ImageBitmap)return class{static getDataURL(e,i=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let s;if(e instanceof HTMLCanvasElement)s=e;else{SS===void 0&&(SS=OL("canvas")),SS.width=e.width,SS.height=e.height;const a=SS.getContext("2d");e instanceof ImageData?a.putImageData(e,0,0):a.drawImage(e,0,0,e.width,e.height),s=SS}return!i&&(s.width>2048||s.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),s.toDataURL("image/jpeg",.6)):s.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const i=OL("canvas");i.width=e.width,i.height=e.height;const s=i.getContext("2d");s.drawImage(e,0,0,e.width,e.height);const a=s.getImageData(0,0,e.width,e.height),h=a.data;for(let d=0;d<h.length;d++)h[d]=255*Oo(h[d]/255);return s.putImageData(a,0,0),i}if(e.data){const i=e.data.slice(0);for(let s=0;s<i.length;s++)i instanceof Uint8Array||i instanceof Uint8ClampedArray?i[s]=Math.floor(255*Oo(i[s]/255)):i[s]=Oo(i[s]);return{data:i,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(c);if(c.data){let e=[];try{e=Array.from(c.data)}catch(i){i.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(i),e=c.data}return{data:e,width:c.width,height:c.height,type:c.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let uU=0;class CS extends class{addEventListener(e,i){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[e]===void 0&&(s[e]=[]),s[e].indexOf(i)===-1&&s[e].push(i)}hasEventListener(e,i){if(this._listeners===void 0)return!1;const s=this._listeners;return s[e]!==void 0&&s[e].indexOf(i)!==-1}removeEventListener(e,i){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(i);a!==-1&&s.splice(a,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const s=i.slice(0);for(let a=0,h=s.length;a<h;a++)s[a].call(this,e);e.target=null}}}{constructor(e=CS.DEFAULT_IMAGE,i=CS.DEFAULT_MAPPING,s=1001,a=1001,h=To,d=1008,_=1023,et=1009,nt=1,it=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:uU++}),this.uuid=qo(),this.name="",this.source=new cU(e),this.mipmaps=[],this.mapping=i,this.wrapS=s,this.wrapT=a,this.magFilter=h,this.minFilter=d,this.anisotropy=nt,this.format=_,this.internalFormat=null,this.type=et,this.offset=new Ir(0,0),this.repeat=new Ir(1,1),this.center=new Ir(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new iR,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=it,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const i=e===void 0||typeof e=="string";if(!i&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const s={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),i||(e.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}CS.DEFAULT_IMAGE=null,CS.DEFAULT_MAPPING=300;var z2=__webpackgi_require__(898),TM={};z2.Z&&z2.Z.locals&&(TM.locals=z2.Z.locals);var sR,oR=0,d1={};d1.styleTagTransform=LC(),d1.setAttributes=kC(),d1.insert=function(c,e){(e.target||document.head).appendChild(c)},d1.domAPI=bE(),d1.insertStyleElement=Ix(),TM.use=function(c){return d1.options=c||{},oR++||(sR=BC()(z2.Z,d1)),TM},TM.unuse=function(){oR>0&&!--oR&&(sR(),sR=null)};var hU=TM;class aR extends LL{constructor(e=!1,i=!1,s=!1,a=document.body){super(e,i,s,!1),this.dependencies=[Yr],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=h=>{this.dispatchEvent(h),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async h=>this._viewer?this._viewer.alert(h):super.alert(h),this.confirm=async h=>this._viewer?this._viewer.confirm(h):super.confirm(h),this.prompt=async(h,d,_=!0)=>this._viewer?this._viewer.prompt(h,d,_):super.prompt(h,d,_),this._pane.registerPlugin(tU),hU.use({target:a})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(i=>(s,a,h,d)=>{const _=a.property,et="placeholder";if(a.value===void 0&&_&&typeof _[0]=="object"){const[nt,it]=_,lt=lM("Render Target"),dt=lM("Data Texture"),pt=lM("CUBE Texture"),gt=lM("Compressed Texture"),vt={},Ct={};Object.defineProperty(a,"value",{get:()=>{var wt;let xt,_t=nt[it];if(_t!=null&&_t.get&&(_t=_t.get()),!_t)return et;if(_t.isRenderTargetTexture&&!_t.image.tp_src&&(_t.image.tp_src=lt),_t.isDataTexture&&!_t.image.tp_src&&(_t.image.tp_src=dt),_t.isCompressedTexture&&!_t.image.tp_src&&(_t.image.tp_src=gt),_t.isTexture?(_t.image&&(_t.image instanceof ImageBitmap||_t.image instanceof HTMLImageElement||_t.image instanceof HTMLVideoElement)&&!_t.image.tp_src&&(_t.image.tp_src=p0(_t.image,160)),_t.image&&(xt=_t.image.tp_src_uuid,xt=xt?vt[xt]:void 0,xt||(xt=_t.image.tp_src||_t.image.src))):typeof _t=="string"?xt=_t:_t.domainMin?(xt=_t.texture,_t.texture.image&&!_t.texture.image.tp_src&&(_t.texture.image.tp_src=pt),_t.texture.image&&(xt=_t.texture.image.tp_src_uuid,xt=xt?vt[xt]:void 0,xt||(xt=_t.texture.image.tp_src||_t.texture.image.src))):_t&&console.error("unknown value",_t),xt||(xt=et),_t.image&&!_t.image.tp_src_uuid){const Pt=Au();_t.image.tp_src_uuid=Pt,Ct[xt]=Pt}return typeof xt=="string"&&(xt=(wt=vt[xt])!==null&&wt!==void 0?wt:xt),xt},set:wt=>{var xt,_t,Pt,Rt,Lt,Ot,qt,en,cn,An,fn;const Tn=nt[it],gn=Nn=>{var Mn;nt[it]=Nn,Nn!=null&&Nn.isTexture&&(Nn.flipY=Nn.isDataTexture?Nn.flipY:(Mn=Tn==null?void 0:Tn.flipY)===null||Mn===void 0||Mn)};if(typeof wt=="string")return void(typeof Tn=="string"&&gn(wt));if(!wt)return void(a.value=et);if(wt.isPlaceholder)return void(Tn&&(gn(typeof Tn=="string"?"":null),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty()));let xn=wt.tp_src_uuid;if(xn||(xn=(xt=wt.src)!==null&&xt!==void 0?xt:wt.tp_src,xn=(_t=Ct[xn])!==null&&_t!==void 0?_t:xn,delete Ct[xn],wt.tp_src_uuid=xn),xn&&(vt[xn]=wt),typeof Tn!="string"){if(!((Tn==null?void 0:Tn.image)===wt||((Pt=Tn==null?void 0:Tn.image)===null||Pt===void 0?void 0:Pt.src)===wt.src||((Rt=Tn==null?void 0:Tn.image)===null||Rt===void 0?void 0:Rt.tp_src)===wt.tp_src&&wt.tp_src!=null||((Lt=Tn==null?void 0:Tn.image)===null||Lt===void 0?void 0:Lt.tp_src)===wt.src&&wt.src!=null||((Ot=Tn==null?void 0:Tn.image)===null||Ot===void 0?void 0:Ot.src)===wt.tp_src&&wt.tp_src!=null))if(wt instanceof File){const Nn=i==null?void 0:i.getPlugin(Yr);if(!Nn)throw"Viewer or AssetManagerPlugin not found";(qt=Nn.importer)===null||qt===void 0||qt.importSingle({file:wt,path:wt.src}).then(Mn=>{var Hn,rr,cr,_i;if(Mn){Mn.isDataTexture&&(Mn.needsUpdate=!0);const xr=(cr=(rr=(Hn=wt.src)===null||Hn===void 0?void 0:Hn.split("?"))===null||rr===void 0?void 0:rr[0])===null||cr===void 0?void 0:cr.split(".").pop();Mn.userData&&(Mn.userData.mimeType||(Mn.userData.mimeType="image/"+(["jpg","jpeg"].includes(xr)?"jpeg":"png"))),gn(Mn),[a.onChange].flat().forEach(Mr=>typeof Mr=="function"&&(Mr==null?void 0:Mr())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(_i=a.uiRefresh)===null||_i===void 0||_i.call(a,"postFrame",!1)}})}else{const Nn=new CS(wt);Nn.assetType="texture",Nn.needsUpdate=!0;const Mn=(An=(cn=(en=wt.src)===null||en===void 0?void 0:en.split("?"))===null||cn===void 0?void 0:cn[0])===null||An===void 0?void 0:An.split(".").pop();Nn.userData.mimeType||(Nn.userData.mimeType="image/"+(["jpg","jpeg"].includes(Mn)?"jpeg":"png")),gn(Nn);const Hn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(it);Nn.encoding=Hn?b.rnI:b.knz,Nn.wrapS=b.rpg,Nn.wrapT=b.rpg,[a.onChange].flat().forEach(rr=>typeof rr=="function"&&(rr==null?void 0:rr())),typeof(nt==null?void 0:nt.setDirty)=="function"&&nt.setDirty(),(fn=a.uiRefresh)===null||fn===void 0||fn.call(a,"postFrame",!1)}}else gn(xn)}}),a.property=void 0,a.label===void 0&&(a.label=it)}return(d=d??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],d.imageFit===void 0&&(d.imageFit="contain"),d.clickCallback===void 0&&(d.clickCallback=(nt,it)=>{var lt;const dt=nt==null?void 0:nt.target,pt=dt==null?void 0:dt.getBoundingClientRect();if(!pt)return void it.click();const gt=a.uiRef.controller_.valueController.value.rawValue,vt=gt===et||gt!=null&&gt.isPlaceholder?{}:{"remove image":()=>{var wt;a.uiRef.controller_.valueController.value.setRawValue("");const[xt,_t]=_||[a,"value"],Pt=typeof xt[_t]=="string";xt[_t]=Pt?"":null,[a.onChange].flat().forEach(Rt=>typeof Rt=="function"&&(Rt==null?void 0:Rt())),typeof(xt==null?void 0:xt.setDirty)=="function"&&xt.setDirty(),(wt=a.uiRefresh)===null||wt===void 0||wt.call(a,"postFrame",!1),o0.Remove()},"download image":()=>{var wt,xt,_t;const[Pt,Rt]=_||[a,"value"];let Lt=(xt=(wt=Pt[Rt])===null||wt===void 0?void 0:wt.image)!==null&&xt!==void 0?xt:a.uiRef.controller_.valueController.value.rawValue;Lt&&(Lt instanceof ImageBitmap||Lt instanceof HTMLImageElement||Lt instanceof HTMLVideoElement)&&!Lt.src&&(Lt=p0(Lt));const Ot=document.createElement("a");document.body.appendChild(Ot),Ot.style.display="none",Ot.href=(_t=Lt==null?void 0:Lt.src)!==null&&_t!==void 0?_t:Lt,Ot.download="image.png",Ot.click(),document.body.removeChild(Ot),o0.Remove()}},Ct=o0.Create({...vt,"set/replace image":()=>{it.click(),o0.Remove()},"from url":async()=>{var wt,xt;let _t="";if(_t&&(_t.startsWith("http")||_t.startsWith("data:image"))||(_t=""),_t=await h.prompt("Load texture: Enter Image/Texture URL",_t,!0),!_t||!_t.startsWith("http")&&!_t.startsWith("data:image"))return _t!==null&&await h.alert("Loading Image: Invalid URL"),void o0.Remove();const[Pt,Rt]=_||[a,"value"],Lt=Pt[Rt];if(typeof Lt=="string")Pt[Rt]=_t,[a.onChange].flat().forEach(Ot=>typeof Ot=="function"&&(Ot==null?void 0:Ot())),typeof(Pt==null?void 0:Pt.setDirty)=="function"&&Pt.setDirty(),(wt=a.uiRefresh)===null||wt===void 0||wt.call(a,"postFrame",!1);else{const Ot=i==null?void 0:i.getPlugin(Yr);if(!Ot)throw"Viewer or AssetManagerPlugin not found";(xt=Ot.importer)===null||xt===void 0||xt.importSinglePath(_t).then(qt=>{var en;if(qt){qt.isDataTexture?qt.needsUpdate=!0:qt&&(Lt==null?void 0:Lt.flipY)!==void 0&&(qt.flipY=Lt.flipY),Pt[Rt]=qt;const cn=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(Rt);qt.encoding=cn?b.rnI:b.knz,[a.onChange].flat().forEach(An=>typeof An=="function"&&(An==null?void 0:An())),typeof(Pt==null?void 0:Pt.setDirty)=="function"&&Pt.setDirty(),(en=a.uiRefresh)===null||en===void 0||en.call(a,"postFrame",!1)}})}o0.Remove()},cancel:()=>{o0.Remove()}},2,pt.height+8);(lt=dt.parentElement)===null||lt===void 0||lt.appendChild(Ct),pt.y>.7*document.body.clientHeight&&(Ct.style.top="auto",Ct.style.bottom=pt.height+8+"px")}),d.view="input-image",dA(s,a,h,d)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var i;const s=(i=this._viewer)===null||i===void 0?void 0:i.getPlugin(e);if(!s)return void console.warn("plugin not found:",e);this._plugins.push(s),s.uiConfig&&(s.uiConfig.limitedUi=!0),s.uiConfig&&s.uiConfig.hidden===void 0&&(s.uiConfig.hidden=!1),this._appendUiObject(s);const a=s.uiConfig;if(a!=null&&a.uiRef&&s.toJSON){const h=a.uiRef.controller_.view.element,d=No({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});d.onclick=_=>{const et={};typeof s.toJSON=="function"&&(et["download preset"]=async()=>{var it,lt;const dt=(lt=(it=this._viewer)===null||it===void 0?void 0:it.getPlugin(Yr))===null||lt===void 0?void 0:lt.exportPluginPreset(s);await eu(new Blob([JSON.stringify(dt,null,2)],{type:"application/json"}),"preset."+s.constructor.PluginType+".json"),o0.Remove()}),typeof s.fromJSON=="function"&&(et["upload preset"]=async()=>{var it,lt;o0.Remove();const dt=await d0(!1,!1);if(dt.length===0)return;const pt=dt[0],gt=await pt.text(),vt=JSON.parse(gt);await((lt=(it=this._viewer)===null||it===void 0?void 0:it.getPlugin(Yr))===null||lt===void 0?void 0:lt.importPluginPreset(vt,s))});const nt=o0.Create(et,h.clientWidth-120,12);h.append(nt),_.preventDefault()},h.appendChild(d)}return a}setupPlugins(...e){e.forEach(i=>this.setupPluginUi(i))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var i;const s=e.uiConfig;s&&(Yt(s.hidden)!==!0?(i=s.uiRefresh)===null||i===void 0||i.call(s,"postFrame",!0):s.uiRef&&(s.uiRef.hidden=!0))})}}aR.PluginType="TweakpaneUi";class V2 extends Ns{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,onChange:()=>{if(!this._viewer)return;const e=new vo(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const i=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return i&&(i.isTexture||i.assetType==="texture")?i:null}set sceneBackground(e){var i,s;e?(i=this._viewer)===null||i===void 0||i.setBackground(e):(s=this._viewer)===null||s===void 0||s.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var i;(i=this._viewer)===null||i===void 0||i.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,i,s;return(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||i===void 0?void 0:i.rotation)!==null&&s!==void 0?s:0}set sceneEnvironmentRotation(e){var i,s;const a=(i=this._viewer)===null||i===void 0?void 0:i.scene.getEnvironment();a&&(a.rotation=e,(s=this._viewer)===null||s===void 0||s.scene.setDirty())}get sceneEnvironmentIntensity(){var e,i;return(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&i!==void 0?i:1}set sceneEnvironmentIntensity(e){var i;!((i=this._viewer)===null||i===void 0)&&i.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===iv}set envmapBg(e){if(this._viewer)if(e){const i=this._viewer.getBackground(!0);i&&i!==iv&&(this.lastBgVal=i),this._viewer.setBackground(iv)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var i;await super.onAdded(e);const s=e.getBackground();this.bgUIConfig.value=typeof s=="string"&&s!==iv||typeof s=="number"||!((i=s)===null||i===void 0)&&i.isColor?"#"+new vo(s).getHexString():"#000000",this.lastBgVal=s}}V2.PluginType="SimpleBackgroundEnvUiPlugin1";class Q2 extends Ns{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,i;(i=(e=this._uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,i,s;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(s=(i=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||i===void 0?void 0:i.map(a=>a.assetType==="light"?null:a.uiConfig).filter(a=>a!=null))!==null&&s!==void 0?s:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,i;(i=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0)}}Q2.PluginType="SimpleUi";var dU=__webpackgi_require__(1),pU=__webpackgi_require__.n(dU)();class G2 extends Ns{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=No({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(i,s)=>(i.push({text:s.name||"unnamed",id:s.uuid,children:s.children.reduce(this._buildData,[])}),i),this._findVisible=(i,s)=>(s.visible&&(s.children.length<1?i.push(s.uuid):i.push(...s.children.reduce(this._findVisible,[]))),i),this._setVisible=i=>{var s,a,h;const d=(s=this._viewer)===null||s===void 0?void 0:s.scene.modelRoot;if(!d||i==null)return;const _=new Set;d.traverse(et=>{et!==d&&(et.visible=i.includes(et.uuid),et.visible&&et.traverseAncestors(nt=>_.add(nt)))}),_.forEach(et=>et.visible=!0),(h=(a=this._viewer)===null||a===void 0?void 0:a.scene)===null||h===void 0||h.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),Dv(Wt`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var i;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const s=(i=this._viewer)===null||i===void 0?void 0:i.scene.modelRoot;if(!s)return;const a=s.children.reduce(this._buildData,[]),h=s.children.reduce(this._findVisible,[]);let d=!1;return new Promise((_,et)=>{this.treeView=new pU(this.hierarchyDiv,{closeDepth:1,data:a,loaded:function(){this.values=h,_()},onChange:()=>{d?Dl(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):d=!0},onItemLabelClick:nt=>{var it;const lt=(it=this._viewer)===null||it===void 0?void 0:it.scene.modelRoot.modelObject.getObjectByProperty("uuid",nt);lt&&s.visible&&lt.dispatchEvent({type:"select",value:lt,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}G2.PluginType="HierarchyUiPlugin";class H2 extends Ns{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new Vv;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[Yr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.lightObject)return;const _=d.uiConfig;_&&!h.includes(_)&&h.push(_)}),[...this.uiConfig.children].forEach(d=>{var _;((_=d)===null||_===void 0?void 0:_.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}H2.PluginType="SimpleLightsUi";class W2 extends Ns{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[Yr],this._sceneUpdate=e=>{var i,s,a;if(!e.hierarchyChanged)return;const h=[];(i=this._viewer)===null||i===void 0||i.traverseSceneObjects(d=>{if(!d.cameraObject)return;const _=d.uiConfig;_&&!h.includes(_)&&h.push(_)}),[...this.uiConfig.children].forEach(d=>{var _;((_=d)===null||_===void 0?void 0:_.type)==="button"||h.includes(d)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(d),1)}),h.forEach(d=>{this.uiConfig.children.includes(d)||this.uiConfig.children.push(d)}),(a=(s=this.uiConfig).uiRefresh)===null||a===void 0||a.call(s,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}W2.PluginType="SimpleSceneCamerasUi";var IM,q2=function(c,e,i,s){var a,h=arguments.length,d=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(c,e,i,s);else for(var _=c.length-1;_>=0;_--)(a=c[_])&&(d=(h<3?a(d):h>3?a(e,i,d):a(e,i))||d);return h>3&&d&&Object.defineProperty(e,i,d),d};let ry=IM=class extends Ns{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var c;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},i=this._viewer.container.getBoundingClientRect();e.width>=i.width&&delete e.width,e.height>=i.height&&delete e.height,(c=this._viewer)===null||c===void 0||c.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(c){await super.onAdded(c);const e=c.canvas.clientWidth,i=c.canvas.clientHeight,s=c.renderer.displayCanvasScaling;this.width=e,this.height=i,this.scale=s,c.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(c){return this.removeEventListener("deserialize",this._sizeChanged),c.renderer.removeEventListener("resize",this._refresh),super.onRemove(c)}_refresh(){var c,e;(e=(c=this.uiConfig)===null||c===void 0?void 0:c.uiRefresh)===null||e===void 0||e.call(c,"postFrame",!0)}};ry.PluginType="RendererParamsUiPlugin",q2([jn(),pn(IM.prototype._sizeChanged),ss("Width",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],ry.prototype,"width",void 0),q2([jn(),pn(IM.prototype._sizeChanged),ss("Height",void 0,1,c=>({bounds:()=>{var e;return[10,((e=c._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],ry.prototype,"height",void 0),q2([jn(),pn(IM.prototype._sizeChanged),ss("Scale",[.25,4],.25,{limitedUi:!0})],ry.prototype,"scale",void 0),ry=IM=q2([Ys("Renderer")],ry);class Y2 extends Ns{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var i;const s=super.toJSON(e);return s.activeCamera=(i=this._viewer)===null||i===void 0?void 0:i.scene.activeCamera.toJSON(),s}fromJSON(e,i){var s;return e.activeCamera&&((s=this._viewer)===null||s===void 0||s.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,i)}_refresh(){var e,i;this._viewer&&((i=(e=this.uiConfig).uiRefresh)===null||i===void 0||i.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}Y2.PluginType="CameraUiPlugin";var fU={create:c=>{let e="button"+(c.type?" "+c.type:""),i=Ds.createDiv(e,c.text);return i.addEventListener("click",c.onClick),i}};let gm={createElement:(c,e,i,s)=>{let a=document.createElement(c);if(e&&(a.className=e),i&&(a.innerHTML=i),s)for(let h in s)a.setAttribute(h,s[h]);return a},createDiv:(c,e,i)=>gm.createElement("div",c,e,i),createDomTree:c=>{if(!c||!c.hasOwnProperty("dom"))return c;let e=c.dom;if(c.children)for(let i in c.children)c.children[i]&&e.appendChild(gm.createDomTree(c.children[i]));return e},removeElement:c=>{c!=null&&c.parentNode.removeChild(c)},appendToBody:c=>{document.body.appendChild(c)},makeIconHTML:c=>{let e="";return c=="ok"&&(e="#tick"),c=="error"&&(e="#cancel"),c=="info"&&(e="#info-button"),c=="caution"&&(e="#danger"),c=="min"&&(e="#line"),c=="close"&&(e="#close"),`<svg class="icon ${c}"><use xlink:href="${e}" /></svg>`},makeNftContent:c=>{let e=null;if(c.type){let i=null;i=typeof c.content=="string"?gm.createDiv("inner-content",c.content):gm.createDomTree({dom:gm.createDiv("inner-content"),children:[c.content]}),e=c.type=="text"?gm.createDomTree({dom:gm.createDiv("content text"),children:[i]}):gm.createDomTree({dom:gm.createDiv("content"),children:[gm.createDiv("state",gm.makeIconHTML(c.type)),i]})}else typeof c.content=="string"&&(e=gm.createDiv("content",c.content));return e},standardizeButtons:(c,e)=>{let i=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||i.push({key:27,text:"Cancel",onClick:c.close.bind(c,"cancel")}),i.push({key:13,text:"OK",type:"main",onClick:c.close.bind(c,"ok")}),i;i=e.buttons,i.constructor!==Array&&(i=[i]);for(let s in i)!i[s].onClick&&(i[s].onClick=c.close.bind(c,i[s].id));return i},makeButtons:c=>{let e=[];if(c)for(let i in c)e.push(fU.create({text:c[i].text?c[i].text:"OK",type:c[i].normal?null:"main",onClick:c[i].onClick}));return gm.createDomTree({dom:gm.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:c=>{let e=i=>{for(let s in c)if(c[s].key===i.keyCode)return void c[s].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:c=>{window.removeEventListener("keydown",c)}};var Ds=gm,gu=__webpackgi_require__(476),_p={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let a_={};a_.overlay_in=[new gu.Frame(_p["wwise-overlay-in-1"],0),new gu.Frame(_p["wwise-overlay-in-2"],400)],a_.overlay_out=[new gu.Frame(_p["wwise-overlay-out-1"],300)],a_.pop_in=[new gu.Frame(_p["wwise-pop-in-1"],0),new gu.Frame(_p["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new gu.Frame(_p["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new gu.Frame(_p["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],a_.pop_out=[new gu.Frame(_p["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],a_.flip_in=[new gu.Frame(_p["wwise-flip-in-1"],0),new gu.Frame(_p["wwise-flip-in-2"],500)],a_.flip_out=[new gu.Frame(_p["wwise-flip-out-1"],400)],a_.min_in=[new gu.Frame(_p["wwise-min-in-1"],0),new gu.Frame(_p["wwise-min-in-2"],350)],a_.min_out=[new gu.Frame(_p["wwise-min-out-1"],400)];let NL=["top","bottom","left","right"];for(let c in NL){let e=NL[c];a_[e+"_in"]=[new gu.Frame(_p["wwise-"+e+"-in-1"],0),new gu.Frame(_p["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],a_[e+"_out"]=[new gu.Frame(_p["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var X2=a_;let mU={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class lR{static create(e,i){let s=e.getElementsByClassName("title")[0];s&&(s=s.innerHTML);let a=e.getElementsByClassName("content")[0];return a&&(a=a.innerHTML),Ds.removeElement(e),i.title=s,i.content=a,new lR(i)}constructor(e){this.options=JSON.parse(JSON.stringify(mU));for(let et in e)e[et]!=null&&(this.options[et]=e[et]);let i=this.options.position;if(i.indexOf(" ")==-1&&(i=="left"||i=="right"?i+=" center":i=i=="top"||i=="bottom"?"center "+i:i+" "+i),this.options.position=i,this.options.overlay){let et=document.getElementsByClassName("wwise-overlay");et.length?(this.overlay=et[0],this.hasOverlay=!0):(this.overlay=Ds.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let s="content";if(this.options.topbar){let et=[];this.options.topbar.showMin&&(et.push(Ds.createDiv(null,Ds.makeIconHTML("min"))),et[et.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(et.push(Ds.createDiv(null,Ds.makeIconHTML("close"))),et[et.length-1].addEventListener("click",this.close.bind(this,void 0)));let nt=null;nt=typeof this.options.title=="string"?Ds.createDiv("title",this.options.title):Ds.createDomTree({dom:Ds.createDiv("title"),children:[this.options.title]}),this.topbar=Ds.createDomTree({dom:Ds.createDiv("topbar"),children:[{dom:Ds.createDiv("control"),children:et.map(it=>({dom:it}))},{dom:nt},{dom:Ds.createDiv("clear")}]})}else s+=" no-topbar";typeof this.options.content=="string"?this.content=Ds.createDomTree({dom:Ds.createDiv(s,this.options.content)}):this.content=Ds.createDomTree({dom:Ds.createDiv(s),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=Ds.createDomTree({dom:Ds.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let a=Ds.createDiv("wwise-wrapper");this.options.zIndex&&(a.style.zIndex=this.options.zIndex),this.wrapper=Ds.createDomTree({dom:a,children:[this.window]}),this.dom=Ds.createDomTree({dom:Ds.createDiv(),children:[this.wrapper]});let h=this.options.position.split(" "),d=-50,_=-50;if(h[0]=="left"?(d=0,this.wrapper.classList.add("left")):h[0]=="right"?(d=-100,this.wrapper.classList.add("right")):h[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=h[0],h[1]=="top"?(_=0,this.wrapper.classList.add("top")):h[1]=="bottom"?(_=-100,this.wrapper.classList.add("bottom")):h[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=i[1],this.window.style.transform=`translate(${d}%, ${_}%)`,this.options.style)for(let et in this.options.style)this.window.style[et]=this.options.style[et];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(s=>{this.promiseResolve=s}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let i=e?"min":this.options.animation;if(i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new gu.Queue(this.wrapper,X2[i+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&s.push(new gu.Queue(this.overlay,X2.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let i=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),i){i!="min"&&i!="flip"||this.dom.classList.add("wwise-perspective");let s=[new gu.Queue(this.wrapper,X2[i+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&s.push(new gu.Queue(this.overlay,X2.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(s).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(Ds.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),Ds.appendToBody(this.dom)}removeDoms(){Ds.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(Ds.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let i={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},s=window.getComputedStyle(this.wrapper),a=this.options.draggable,h=parseFloat(s.left),d=parseFloat(s.top);if(s.left.indexOf("%")!=-1){h=s.left,h=h.substr(0,h.length-1),h=parseInt(h);let _=window,et=document,nt=et.documentElement,it=et.getElementsByTagName("body")[0];h=h*(_.innerWidth||nt.clientWidth||it.clientWidth)/100}if(s.top.indexOf("%")!=-1){d=s.top,d=d.substr(0,d.length-1),d=parseInt(d);let _=window,et=document,nt=et.documentElement,it=et.getElementsByTagName("body")[0];d=d*(_.innerHeight||nt.clientHeight||it.clientHeight)/100}a!=1&&a!="horizontal"||(this.wrapper.style.left=h+i.x+"px"),a!=1&&a!="vertical"||(this.wrapper.style.top=d+i.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let i=e.relatedTarget;i&&i.nodeName!="HTML"||(this.inDragging=!1)}}var gU=lR,cR=class{constructor(c){let e=this.options=c;!e.type&&(e.type="ok");let i={topbar:!1};i.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),i.overlay=!0,i.keepOverlay=e.keepOverlay,i.clickOverlayToClose=!1,i.animation=e.animation,i.zIndex=e.zIndex,this.wwise=new gU(i)}constructContent(c){let e=Ds.createDiv("modal"),i=Ds.createDomTree({dom:Ds.createDiv("main "+c.type),children:[Ds.createDiv(null,Ds.makeIconHTML(c.type)),Ds.createDiv("title",c.title),Ds.createDiv("text",c.text)]});this.buttonArr=Ds.standardizeButtons(this,c);let s=Ds.makeButtons(this.buttonArr),a=null;c.content&&(a=typeof c.content=="string"?Ds.createDiv(null,c.content):c.content);let h=null;return s.innerHTML&&(h=Ds.createDomTree({dom:Ds.createDiv("operation "+c.type),children:[s]})),a||h||i.classList.add("no-op"),Ds.createDomTree({dom:e,children:[i,a,h]})}open(){if(this.wwise.opened)return;let c=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=Ds.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),c}close(c){if(this.wwise.opened)return this.value=c,Ds.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let vU={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},_U={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var K2=__webpackgi_require__(513),DM={};K2.Z&&K2.Z.locals&&(DM.locals=K2.Z.locals);var uR,hR=0,p1={};p1.styleTagTransform=LC(),p1.setAttributes=kC(),p1.insert=function(c,e){(e.target||document.head).appendChild(c)},p1.domAPI=bE(),p1.insertStyleElement=Ix(),DM.use=function(c){return p1.options=c||{},hR++||(uR=BC()(K2.Z,p1)),DM},DM.unuse=function(){hR>0&&!--hR&&(uR(),uR=null)};var AU=DM;class dR extends Ns{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},Ds.appendToBody=i=>{e.container.appendChild(i)},Ds.makeIconHTML=i=>"",AU.use({target:e.container}),e.alert=async i=>{const s=i==null?void 0:i.split(":")[0],a=new cR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return a.open(),a.getPromise()},e.confirm=async i=>{const s=i==null?void 0:i.split(":")[0],a=new cR({type:"info",title:s??"&ndsp;",text:(i==null?void 0:i.replace(s||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return a.open(),await a.getPromise()==="yes"},e.prompt=async(i,s,a=!0)=>{const h=i==null?void 0:i.split(":")[0],d=new class{constructor(_){this.options=JSON.parse(JSON.stringify(vU));for(let lt in _)_[lt]!=null&&(this.options[lt]=_[lt]);let et=this.options,nt=JSON.parse(JSON.stringify(_U));for(let lt in nt)et.hasOwnProperty(lt)&&(nt[lt]=et[lt]);let it=[];et.showCancel&&it.push({key:27,text:et.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),it.push({key:13,text:et.okText,onClick:this.handleOk.bind(this)}),nt.buttons=it,this.input=Ds.createElement("input","input",null,{placeholder:et.placeholder}),this.error=Ds.createDiv("error"),nt.content=Ds.createDomTree({dom:Ds.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new cR(nt)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},_=>{this.error.innerText=_}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let _=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((et,nt)=>{this.promiseResolve=et,this.promiseReject=nt}),_}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:h??"&ndsp;",placeholder:s??"",showCancel:a,animation:"overlay",text:(i==null?void 0:i.replace(h||"","").replace(":",""))||""});return d.open(),await d.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}dR.PluginType="WindowiseDialogPlugin";var yU=u2({defaultModifiers:[pP,mP,gP,d2]}),wU=__webpackgi_require__(388),xU=__webpackgi_require__.n(wU);function bU(c){const e=[];c.traverse(a=>{a.geometry&&e.push(a)});const i={},s={};e.forEach(a=>{var h;if(!i[a.geometry.uuid]){const et=a.geometry.toJSON().data,nt=et?xU()({a:et.attributes||{},b:et.index||[]}):"";i[a.geometry.uuid]=nt}const d=i[a.geometry.uuid],_=(h=s[d])!==null&&h!==void 0?h:s[d]=[];_.includes(a)||_.push(a)}),Object.values(s).forEach(a=>{if(a.length<2)return;const h=a[0].geometry;a.forEach((d,_)=>{_<1||(d.geometry.dispose(),d.geometry=h)})})}const sy=new b.Pa4,f1=new b.Pa4,J2=new b.Pa4,pR=new b.Pa4,Z2=new b.Pa4,MS=new b.Pa4;let fR=1;const EU=new b.Pa4(0,1,0);class SU extends Iv{constructor(e,i){super(e,i),this.targetOffset=new b.Pa4(0,0,0);const s=this.update;this.update=()=>this._update(s)}_update(e){this.target.add(this.targetOffset),sy.copy(this.object.position).sub(this.target),fR=sy.length(),MS.copy(this.target);const i=e();return MS.sub(this.target),sy.copy(this.object.position).sub(this.target),fR/=sy.length(),this.target.add(MS),this.object.position.copy(this.target).add(sy),sy.normalize(),f1.crossVectors(EU,sy).normalize(),J2.crossVectors(sy,f1).normalize(),pR.crossVectors(f1,J2).normalize().negate(),f1.length()>.1&&this.object.up.crossVectors(sy.clone().normalize(),f1),this.enablePan&&(Z2.set(0,0,0).addScaledVector(f1,MS.x).addScaledVector(J2,MS.y).addScaledVector(pR,MS.z),this.targetOffset.add(Z2),this.targetOffset.multiplyScalar(1/fR)),Z2.set(0,0,0).addScaledVector(f1,-this.targetOffset.x).addScaledVector(J2,-this.targetOffset.y).addScaledVector(pR,-this.targetOffset.z),this.object.lookAt(Z2.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),i}}class CU extends JS{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new b.cJO(1,0))}}function mR(c,e){var i,s;const a=Array.from(((i=c.access)!==null&&i!==void 0?i:"").split(".")),h=a.pop();let d=(s=c.targetObject)!==null&&s!==void 0?s:e;if(!h||h.length===0)return{key:void 0,tar:d};if(d=Nt(a,d),d&&!(h in d))throw console.error("invalid key",h,d,e,c),"";return{key:h,tar:d}}function gR(c,e,i,s){const{key:a,tar:h}=mR(c,e);return a&&h?ox(h,a,()=>{var d;i&&(!((d=c.updater)===null||d===void 0)&&d.length)&&c.updater.forEach(_=>i[_]()),s==null||s()}):d=>console.warn("Unable to set ",d,a,h,c,e)}async function $2(c,e,i){var s,a,h,d;const{key:_,tar:et}=mR(e,c),nt=e.animSet?[UL(et,e.animSet,i,(s=e.animSetParallel)!==null&&s!==void 0&&s)]:[];if(_&&et){const it=(d=e.updater)!==null&&d!==void 0?d:[],lt=async()=>ax(et,_,{...e,onUpdate:dt=>{var pt;(pt=e.onUpdate)===null||pt===void 0||pt.call(e,dt),it.forEach(gt=>{var vt;return(vt=i[gt])===null||vt===void 0?void 0:vt.call(i)})}});e.delay?nt.push(Dl(e.delay).then(lt)):nt.push(lt())}else(e.duration||e.delay)&&nt.push(Dl(((a=e.delay)!==null&&a!==void 0?a:0)+((h=e.duration)!==null&&h!==void 0?h:0)));return nt.length===1?nt[0]:Promise.all(nt)}async function UL(c,e,i,s=!1){if(s)return Promise.all(e.map(async a=>$2(c,a,i)));for(const a of e)await $2(c,a,i)}function FL(c,e,i,s){var a,h,d,_,et,nt,it;if(!c)return;e||(e=[]);const lt=s??{},dt=c;for(let pt=0,gt=e.length;pt<gt;pt++){const vt=e[pt];if(vt.uiRef){const wt=(et=dt==null?void 0:dt.indexOf(vt.uiRef))!==null&&et!==void 0?et:-1;wt!==pt&&(wt>=0&&(dt==null||dt.splice(wt,1)),dt==null||dt.splice(pt,0,vt.uiRef))}else{vt.uiRef={type:"folder",label:(a=vt.name)!==null&&a!==void 0?a:"Animation "+pt,children:[]};const wt=[{type:"button",label:"animate",value:()=>{$2(i,vt,lt).then(()=>{var xt;return console.log(((xt=vt.uiRef)===null||xt===void 0?void 0:xt.label)+" finished")})}}];vt.access!==void 0&&wt.push({type:"input",property:[vt,"access"]}),vt.from!==void 0&&wt.push({type:(h=vt.uiObjectType)!==null&&h!==void 0?h:"input",property:[vt,"from"],onChange:()=>{var xt;gR(vt,i)(vt.from),(xt=vt.updater)===null||xt===void 0||xt.forEach(_t=>_t in lt&&lt[_t]())}}),vt.to!==void 0&&wt.push({type:(d=vt.uiObjectType)!==null&&d!==void 0?d:"input",property:[vt,"to"],onChange:()=>{var xt;gR(vt,i)(vt.to),(xt=vt.updater)===null||xt===void 0||xt.forEach(_t=>_t in lt&&lt[_t]())}}),vt.duration!==void 0&&wt.push({type:"input",property:[vt,"duration"]}),vt.animSet&&(vt.animSetParallel||(vt.animSetParallel=!1),wt.push({type:"input",label:"run parallel",property:[vt,"animSetParallel"]})),vt.animSet&&wt.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(_=vt.uiRef.children)===null||_===void 0||_.push(...wt),dt==null||dt.splice(pt,0,vt.uiRef)}const Ct=(nt=vt.uiRef.children)===null||nt===void 0?void 0:nt.map(wt=>Yt(wt)).flat(2).find(wt=>wt==null?void 0:wt.animSetContainer);vt.animSet&&Ct&&FL(Ct.children,vt.animSet,(it=vt.targetObject)!==null&&it!==void 0?it:i,s)}}function jL(c,e){return e?c*(1e3/e):0}function MU(c){var e,i=c.from,s=i===void 0?0:i,a=c.velocity,h=a===void 0?0:a,d=c.min,_=c.max,et=c.power,nt=et===void 0?.8:et,it=c.timeConstant,lt=it===void 0?750:it,dt=c.bounceStiffness,pt=dt===void 0?500:dt,gt=c.bounceDamping,vt=gt===void 0?10:gt,Ct=c.restDelta,wt=Ct===void 0?1:Ct,xt=c.modifyTarget,_t=c.driver,Pt=c.onUpdate,Rt=c.onComplete;function Lt(xn){return d!==void 0&&xn<d||_!==void 0&&xn>_}function Ot(xn){return d===void 0?_:_===void 0||Math.abs(d-xn)<Math.abs(_-xn)?d:_}function qt(xn){e==null||e.stop(),e=Wy(Il(Il({},xn),{driver:_t,onUpdate:function(Nn){var Mn;Pt==null||Pt(Nn),(Mn=xn.onUpdate)===null||Mn===void 0||Mn.call(xn,Nn)},onComplete:Rt}))}function en(xn){qt(Il({type:"spring",stiffness:pt,damping:vt,restDelta:wt},xn))}if(Lt(s))en({from:s,velocity:h,to:Ot(s)});else{var cn=nt*h+s;xt!==void 0&&(cn=xt(cn));var An,fn,Tn=Ot(cn),gn=Tn===d?-1:1;qt({type:"decay",from:s,velocity:h,timeConstant:lt,power:nt,restDelta:wt,modifyTarget:xt,onUpdate:Lt(cn)?function(xn){An=fn,fn=xn,h=jL(xn-An,cE().delta),(gn===1&&xn>Tn||gn===-1&&xn<Tn)&&en({from:xn,to:Tn,velocity:h})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var zL=function(c){return 180*c/Math.PI},TU=function(c,e){return e===void 0&&(e=tx),zL(Math.atan2(e.y-c.y,e.x-c.x))},IU=function(c,e){var i=!0;return e===void 0&&(e=c,i=!1),function(s){return i?s-c+e:(c=s,i=!0,e)}},DU=function(c){return c},vR=function(c){return c===void 0&&(c=DU),function(e,i,s){var a=i-s,h=-(0-e+1)*(0-c(Math.abs(a)));return a<=0?i+h:i-h}},PU=vR(),RU=vR(Math.sqrt),VL=function(c){return c*Math.PI/180},eD=function(c){return c.hasOwnProperty("x")&&c.hasOwnProperty("y")},_R=function(c){return eD(c)&&c.hasOwnProperty("z")},tD=function(c,e){return Math.abs(c-e)};function BU(c,e){if($1(c)&&$1(e))return tD(c,e);if(eD(c)&&eD(e)){var i=tD(c.x,e.x),s=tD(c.y,e.y),a=_R(c)&&_R(e)?tD(c.z,e.z):0;return Math.sqrt(Math.pow(i,2)+Math.pow(s,2)+Math.pow(a,2))}}var kU=function(c,e,i){return e=VL(e),{x:i*Math.cos(e)+c.x,y:i*Math.sin(e)+c.y}},QL=function(c,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(c*e)/e},GL=function(c,e,i,s){return s===void 0&&(s=0),QL(c+i*(e-c)/Math.max(s,i))},LU=function(c){c===void 0&&(c=50);var e=0,i=0;return function(s){var a=cE().timestamp,h=a!==i?a-i:0,d=h?GL(e,s,h,c):e;return i=a,e=d,d}},OU=function(c){if(typeof c=="number")return function(s){return Math.round(s/c)*c};var e=0,i=c.length;return function(s){var a=Math.abs(c[0]-s);for(e=1;e<i;e++){var h=c[e],d=Math.abs(h-s);if(d===0)return h;if(d>a)return c[e-1];if(e===i-1)return h;a=d}}};function NU(c,e){return c/(1e3/e)}var UU=function(c,e,i){var s=e-c;return((i-c)%s+s)%s+c},HL=function(c,e){return 1-3*e+3*c},WL=function(c,e){return 3*e-6*c},qL=function(c){return 3*c},nD=function(c,e,i){return((HL(e,i)*c+WL(e,i))*c+qL(e))*c},YL=function(c,e,i){return 3*HL(e,i)*c*c+2*WL(e,i)*c+qL(e)},iD=.1;function FU(c,e,i,s){if(c===e&&i===s)return Kw;for(var a=new Float32Array(11),h=0;h<11;++h)a[h]=nD(h*iD,c,i);return function(d){return d===0||d===1?d:nD(function(_){for(var et=0,nt=1;nt!==10&&a[nt]<=_;++nt)et+=iD;--nt;var it=et+(_-a[nt])/(a[nt+1]-a[nt])*iD,lt=YL(it,c,i);return lt>=.001?function(dt,pt,gt,vt){for(var Ct=0;Ct<8;++Ct){var wt=YL(pt,gt,vt);if(wt===0)return pt;pt-=(nD(pt,gt,vt)-dt)/wt}return pt}(_,it,c,i):lt===0?it:function(dt,pt,gt,vt,Ct){var wt,xt,_t=0;do(wt=nD(xt=pt+(gt-pt)/2,vt,Ct)-dt)>0?gt=xt:pt=xt;while(Math.abs(wt)>1e-7&&++_t<10);return xt}(_,et,et+iD,c,i)}(d),e,s)}}var jU=function(c,e){return e===void 0&&(e="end"),function(i){var s=(i=e==="end"?Math.min(i,.999):Math.max(i,.001))*c,a=e==="end"?Math.floor(s):Math.ceil(s);return B_(0,1,a/c)}};async function zU(c,{debug:e=!1,ground:i=!0,bloom:s=!0,depthTonemap:a=!1,importPopup:h=!0,caching:d=!0}){const _=new Cm(c);_.enabled=!1,e&&await _.addPlugin(cv),await _.addPlugin(Yr,void 0,void 0,{storage:d&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await _.addPlugin(eM),await _.addPlugin(KD),h&&await _.addPlugin(Y0),await _.addPlugin(dR),await _.addPlugin(ZC),await _.addPlugin(Hs),await _.addPlugin(Zv),await _.addPlugin(KC),await _.addPlugin(pp),await _.addPlugin(WE),await _.addPlugin(XC),await _.addPlugin(Vw),await _.addPlugin(mo,ZS,!1,!0),await LE(_,{ground:i,bloom:s,depthTonemap:a}),await _.addPlugin(_2,!1),await _.addPlugin(r_,!1),await _.addPlugin($E,!1),await _.addPlugin(fw,!1),await _.addPlugin(JP),await _.addPlugin(eR),await _.addPlugin(tR),await _.addPlugin(ZA,!1),await _.addPlugin(rA),await _.addPlugin(yv),await _.addPlugin(wv),await _.addPlugin(o1),await _.addPlugin(vw),await _.addPlugin(gw),await _.addPlugin($_),await _.addPlugin(Gp),await _.addPlugin(G2),await _.addPlugin(Q2),await _.addPlugin(H2),await _.addPlugin(W2),await _.addPlugin(ry),await _.addPlugin(Y2),await _.addPlugin(V2);const et=await _.addPlugin(new aR(!Mw()));return _.renderer.refreshPipeline(),_.scene.addEventListener("textureAdded",nt=>{nt.texture&&_.scene.setEnvironment(nt.texture)}),et.setupPluginUi(Tl),et.setupPluginUi(ry),et.setupPluginUi(Y2),et.setupPluginUi(Vw),et.setupPluginUi(V2),et.setupPluginUi(eM),et.setupPluginUi(Go),et.setupPluginUi(j0),et.setupPluginUi(vw),et.setupPluginUi(o1),et.setupPluginUi(G2),et.setupPluginUi(gw),et.setupPluginUi($a),et.setupPluginUi(mo),i&&et.setupPluginUi(zp),et.setupPluginUi(O1),et.setupPluginUi(Pl),et.setupPluginUi($_),et.setupPluginUi(Px),et.setupPluginUi(RE),et.setupPluginUi(kE),et.setupPluginUi(IE),et.setupPluginUi(DE),et.setupPluginUi(Q0),et.setupPluginUi(U1),et.setupPluginUi($E),et.setupPluginUi(fw),et.setupPluginUi(Q2),et.setupPluginUi(rA),et.setupPluginUi(yv),et.setupPluginUi(Nu),et.setupPluginUi(H2),et.setupPluginUi(W2),et.setupPluginUi(sm),et.setupPluginUi(Uu),s&&et.setupPluginUi(F_),et.setupPluginUi(Gp),et.setupPluginUi(Qp),et.setupPluginUi(yx),et.setupPluginUi(Hp),et.setupPluginUi(_2),et.setupPluginUi(wv),et.setupPluginUi(N0),et.setupPluginUi(Ax),et.setupPluginUi(W0),et.setupPluginUi(Mu),et.setupPluginUi(r_),et.setupPluginUi(Y0),et.setupPluginUi(Wp),et.setupPluginUi(ZA),_.enabled=!0,_}})();__webpackgi_exports__.LY2;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;var __webpackgi_exports__AnisotropyPlugin=__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;var __webpackgi_exports__FullScreenPlugin=__webpackgi_exports__.DNz,__webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;var __webpackgi_exports__GroundPlugin=__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;var __webpackgi_exports__MaterialConfiguratorPlugin=__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;var __webpackgi_exports__SSAOPlugin=__webpackgi_exports__.iLN;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;var __webpackgi_exports__SSRPlugin=__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;var __webpackgi_exports__TemporalAAPlugin=__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;function WebGiViewer(){const j=reactExports.useRef(null),tt=reactExports.useCallback(async()=>{const st=new __webpackgi_exports__ViewerApp({canvas:j.current}),b=await st.addPlugin(__webpackgi_exports__AssetManagerPlugin);await st.addPlugin(__webpackgi_exports__GBufferPlugin),await st.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await st.addPlugin(new __webpackgi_exports__TonemapPlugin(!st.useRgbm)),await st.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await st.addPlugin(__webpackgi_exports__SSRPlugin),await st.addPlugin(__webpackgi_exports__SSAOPlugin),await st.addPlugin(__webpackgi_exports__GroundPlugin),await st.addPlugin(__webpackgi_exports__BloomPlugin),await st.addPlugin(__webpackgi_exports__TemporalAAPlugin),await st.addPlugin(__webpackgi_exports__AnisotropyPlugin),await st.addPlugin(__webpackgi_exports__MaterialConfiguratorPlugin),await st.addPlugin(__webpackgi_exports__FullScreenPlugin),st.scene.activeCamera.setCameraOptions({controlsEnabled:!0}),st.getPlugin(__webpackgi_exports__TonemapPlugin).config.clipBackground=!0,st.renderer.refreshPipeline(),await b.addFromPath("scene.glb")},[]);return reactExports.useEffect(()=>{tt()},[]),jsx("div",{id:"webgi-canvas-container",children:jsx("canvas",{id:"webgi-canvas",ref:j})})}function App(){return jsxs("div",{className:"App",children:[jsx(Loader,{}),jsx(WebGiViewer,{})]})}const index="";client.createRoot(document.getElementById("root")).render(jsx(App,{}));
